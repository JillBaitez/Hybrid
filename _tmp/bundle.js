var __getOwnPropNames = Object.getOwnPropertyNames;
var __require = /* @__PURE__ */ ((x) => typeof require !== "undefined" ? require : typeof Proxy !== "undefined" ? new Proxy(x, {
  get: (a, b) => (typeof require !== "undefined" ? require : a)[b]
}) : x)(function(x) {
  if (typeof require !== "undefined") return require.apply(this, arguments);
  throw Error('Dynamic require of "' + x + '" is not supported');
});
var __commonJS = (cb, mod) => function __require2() {
  return mod || (0, cb[__getOwnPropNames(cb)[0]])((mod = { exports: {} }).exports, mod), mod.exports;
};

// docs/bg.cleaned.simplified.js
var require_bg_cleaned_simplified = __commonJS({
  "docs/bg.cleaned.simplified.js"(exports) {
    (() => {
      let e;
      var t, n, a, o, i, r, s, l, c, u, p, d, m;
      (() => {
        if (e = globalThis["__app_hrp"], e) return;
        const o2 = {
          name: "__app_hrp",
          env: "production",
          get: (e2) => e2 in o2 ? o2[e2] : null,
          ...JSON.parse('{"version":"11.2.1"}')
        }, i2 = function e2(t2) {
          const n2 = t2 === o2, i3 = n2 && false, l2 = {}, c2 = (e3) => Object.assign(t2, e3), u2 = new Proxy(t2, {
            get(a2, o3) {
              if (o3 === "assign") return c2;
              if (n2 && !String(o3).startsWith("$")) return t2[o3];
              if (!(o3 in t2)) {
                if (t2[o3] = {}, n2) {
                  const e3 = r2.bind(null, "log", o3, false), n3 = r2.bind(null, "log", o3, true), a3 = r2.bind(null, "warn", o3, false), i4 = r2.bind(null, "warn", o3, true), l3 = r2.bind(null, "error", o3, false), c3 = r2.bind(null, "error", o3, true), u3 = s2.bind(null, o3);
                  Object.defineProperties(t2[o3], {
                    log: { get: () => e3 },
                    logDev: { get: () => n3 },
                    warn: { get: () => a3 },
                    warnDev: { get: () => i4 },
                    error: { get: () => l3 },
                    errorDev: { get: () => c3 },
                    Error: { get: () => u3 }
                  });
                }
                l2[o3] = e2(t2[o3]), i3 && (globalThis[o3] = t2[o3]);
              }
              return o3 in l2 ? l2[o3] : t2[o3];
            },
            set: (e3, n3, a2) => (t2[n3] = a2, l2[n3] = a2, i3 && (globalThis[n3] = t2[n3]), true)
          });
          return u2;
        }(o2);
        function r2(e2, t2, n2, ...a2) {
          if (n2) return;
          const [o3, i3, r3] = function(e3) {
            let t3 = 0;
            e3.split("").forEach((n3, a3) => {
              t3 = e3.charCodeAt(a3) + ((t3 << 5) - t3);
            });
            return [(16711680 & t3) >> 16, (65280 & t3) >> 8, 255 & t3];
          }(t2);
          console[e2](`%c[${t2}]`, `color: rgb(${o3}, ${i3}, ${r3})`, ...a2);
        }
        function s2(e2, t2, ...n2) {
          return n2.length > 0 && r2("error", e2, false, t2, ...n2), new Error(`[${e2}] ${t2}`);
        }
        globalThis["__app_hrp"] = i2, e = i2;
      })(), (() => {
        var t2 = Object.defineProperty, n2 = {};
        ((e2, n3) => {
          for (var a3 in ((e3) => {
            t2(e3, "__esModule", { value: true });
          })(e2), n3)
            t2(e2, a3, { get: n3[a3], enumerable: true });
        })(n2, {
          $mobx: () => Y,
          FlowCancellationError: () => bn,
          ObservableMap: () => Oa,
          ObservableSet: () => Pa,
          Reaction: () => Pt,
          _allowStateChanges: () => Be,
          _allowStateChangesInsideComputed: () => en,
          _allowStateReadsEnd: () => ht,
          _allowStateReadsStart: () => mt,
          _autoAction: () => Zt,
          _endAction: () => Ge,
          _getAdministration: () => Qa,
          _getGlobalState: () => kt,
          _interceptReads: () => Sn,
          _isComputingDerivation: () => rt,
          _resetGlobalState: () => Tt,
          _startAction: () => We,
          action: () => Qt,
          autorun: () => nn,
          comparer: () => X,
          computed: () => Le,
          configure: () => pn,
          createAtom: () => V,
          defineProperty: () => Hn,
          entries: () => Mn,
          extendObservable: () => dn,
          flow: () => Tn,
          flowResult: () => En,
          get: () => jn,
          getAtom: () => Ja,
          getDebugName: () => Za,
          getDependencyTree: () => mn,
          getObserverTree: () => gn,
          has: () => Fn,
          intercept: () => xn,
          isAction: () => tn,
          isBoxedObservable: () => Xe,
          isComputed: () => On,
          isComputedProp: () => Rn,
          isFlow: () => In,
          isFlowCancellationError: () => wn,
          isObservable: () => Pn,
          isObservableArray: () => Aa,
          isObservableMap: () => Ra,
          isObservableObject: () => ja,
          isObservableProp: () => Nn,
          isObservableSet: () => Na,
          keys: () => Dn,
          makeAutoObservable: () => ca,
          makeObservable: () => sa,
          observable: () => _e,
          observe: () => Wn,
          onBecomeObserved: () => sn,
          onBecomeUnobserved: () => ln,
          onReactionError: () => Nt,
          override: () => ee,
          ownKeys: () => qn,
          reaction: () => rn,
          remove: () => Un,
          runInAction: () => en,
          set: () => $n,
          spy: () => Wt,
          toJS: () => Yn,
          trace: () => Kn,
          transaction: () => Vn,
          untracked: () => ut,
          values: () => Ln,
          when: () => Xn
        });
        var a2 = {
          0: "Invalid value for configuration 'enforceActions', expected 'never', 'always' or 'observed'",
          1: function(e2, t3) {
            return "Cannot apply '" + e2 + "' to '" + t3.toString() + "': Field not found.";
          },
          5: "'keys()' can only be used on observable objects, arrays, sets and maps",
          6: "'values()' can only be used on observable objects, arrays, sets and maps",
          7: "'entries()' can only be used on observable objects, arrays and maps",
          8: "'set()' can only be used on observable objects, arrays and maps",
          9: "'remove()' can only be used on observable objects, arrays and maps",
          10: "'has()' can only be used on observable objects, arrays and maps",
          11: "'get()' can only be used on observable objects, arrays and maps",
          12: "Invalid annotation",
          13: "Dynamic observable objects cannot be frozen",
          14: "Intercept handlers should return nothing or a change object",
          15: "Observable arrays cannot be frozen",
          16: "Modification exception: the internal structure of an observable array was changed.",
          17: function(e2, t3) {
            return "[mobx.array] Index out of bounds, " + e2 + " is larger than " + t3;
          },
          18: "mobx.map requires Map polyfill for the current browser. Check babel-polyfill or core-js/es6/map.js",
          19: function(e2) {
            return "Cannot initialize from classes that inherit from Map: " + e2.constructor.name;
          },
          20: function(e2) {
            return "Cannot initialize map from " + e2;
          },
          21: function(e2) {
            return "Cannot convert to map from '" + e2 + "'";
          },
          22: "mobx.set requires Set polyfill for the current browser. Check babel-polyfill or core-js/es6/set.js",
          23: "It is not possible to get index atoms from arrays",
          24: function(e2) {
            return "Cannot obtain administration from " + e2;
          },
          25: function(e2, t3) {
            return "the entry '" + e2 + "' does not exist in the observable map '" + t3 + "'";
          },
          26: "please specify a property",
          27: function(e2, t3) {
            return "no observable property '" + e2.toString() + "' found on the observable object '" + t3 + "'";
          },
          28: function(e2) {
            return "Cannot obtain atom from " + e2;
          },
          29: "Expecting some object",
          30: "invalid action stack. did you forget to finish an action?",
          31: "missing option for computed: get",
          32: function(e2, t3) {
            return "Cycle detected in computation " + e2 + ": " + t3;
          },
          33: function(e2) {
            return "The setter of computed value '" + e2 + "' is trying to update itself. Did you intend to update an _observable_ value, instead of the computed property?";
          },
          34: function(e2) {
            return "[ComputedValue '" + e2 + "'] It is not possible to assign a new value to a computed value.";
          },
          35: "There are multiple, different versions of MobX active. Make sure MobX is loaded only once or use `configure({ isolateGlobalState: true })`",
          36: "isolateGlobalState should be called before MobX is running any reactions",
          37: function(e2) {
            return "[mobx] `observableArray." + e2 + "()` mutates the array in-place, which is not allowed inside a derivation. Use `array.slice()." + e2 + "()` instead";
          },
          38: "'ownKeys()' can only be used on observable objects",
          39: "'defineProperty()' can only be used on observable objects"
        };
        function o2(e2) {
          for (var t3 = arguments.length, n3 = new Array(t3 > 1 ? t3 - 1 : 0), o3 = 1; o3 < t3; o3++)
            n3[o3 - 1] = arguments[o3];
          var i3 = typeof e2 == "string" ? e2 : a2[e2];
          throw typeof i3 == "function" && (i3 = i3.apply(null, n3)), new Error("[MobX] " + i3);
        }
        var i2 = {};
        function r2() {
          return typeof globalThis != "undefined" ? globalThis : typeof window != "undefined" ? window : typeof global != "undefined" ? global : typeof self != "undefined" ? self : i2;
        }
        var s2 = Object.assign, l2 = Object.getOwnPropertyDescriptor, c2 = Object.defineProperty, u2 = Object.prototype, p2 = [];
        Object.freeze(p2);
        var d2 = {};
        Object.freeze(d2);
        var m2 = typeof Proxy != "undefined", h = Object.toString();
        function g() {
          m2 || o2(
            "`Proxy` objects are not available in the current environment. Please configure MobX to enable a fallback implementation.`"
          );
        }
        function f(e2) {
          vt.verifyProxies && o2(
            "MobX is currently configured to be able to run in ES5 mode, but in ES5 MobX won't be able to " + e2
          );
        }
        function y() {
          return ++vt.mobxGuid;
        }
        function b(e2) {
          var t3 = false;
          return function() {
            if (!t3) return t3 = true, e2.apply(this, arguments);
          };
        }
        var w = function() {
        };
        function v(e2) {
          return typeof e2 == "function";
        }
        function k(e2) {
          switch (typeof e2) {
            case "string":
            case "symbol":
            case "number":
              return true;
          }
          return false;
        }
        function T(e2) {
          return e2 !== null && typeof e2 == "object";
        }
        function A(e2) {
          var t3;
          if (!T(e2)) return false;
          var n3 = Object.getPrototypeOf(e2);
          return n3 == null || ((t3 = n3.constructor) == null ? void 0 : t3.toString()) === h;
        }
        function E(e2) {
          var t3 = e2 == null ? void 0 : e2.constructor;
          return !!t3 && (t3.name === "GeneratorFunction" || t3.displayName === "GeneratorFunction");
        }
        function I(e2, t3, n3) {
          c2(e2, t3, { enumerable: false, writable: true, configurable: true, value: n3 });
        }
        function S(e2, t3, n3) {
          c2(e2, t3, { enumerable: false, writable: false, configurable: true, value: n3 });
        }
        function x(e2, t3) {
          var n3 = "isMobX" + e2;
          return t3.prototype[n3] = true, function(e3) {
            return T(e3) && true === e3[n3];
          };
        }
        function C(e2) {
          return e2 instanceof Map;
        }
        function O(e2) {
          return e2 instanceof Set;
        }
        var R = void 0 !== Object.getOwnPropertySymbols, _ = typeof Reflect != "undefined" && Reflect.ownKeys ? Reflect.ownKeys : R ? function(e2) {
          return Object.getOwnPropertyNames(e2).concat(
            Object.getOwnPropertySymbols(e2)
          );
        } : Object.getOwnPropertyNames;
        function P(e2) {
          return typeof e2 == "string" ? e2 : typeof e2 == "symbol" ? e2.toString() : new String(e2).toString();
        }
        function N(e2) {
          return e2 === null ? null : typeof e2 == "object" ? "" + e2 : e2;
        }
        function D(e2, t3) {
          return u2.hasOwnProperty.call(e2, t3);
        }
        var L = Object.getOwnPropertyDescriptors || function(e2) {
          var t3 = {};
          return _(e2).forEach(function(n3) {
            t3[n3] = l2(e2, n3);
          }), t3;
        };
        function M(e2, t3) {
          for (var n3 = 0; n3 < t3.length; n3++) {
            var a3 = t3[n3];
            a3.enumerable = a3.enumerable || false, a3.configurable = true, "value" in a3 && (a3.writable = true), Object.defineProperty(e2, a3.key, a3);
          }
        }
        function $(e2, t3, n3) {
          return t3 && M(e2.prototype, t3), n3 && M(e2, n3), e2;
        }
        function U() {
          return U = Object.assign || function(e2) {
            for (var t3 = 1; t3 < arguments.length; t3++) {
              var n3 = arguments[t3];
              for (var a3 in n3)
                Object.prototype.hasOwnProperty.call(n3, a3) && (e2[a3] = n3[a3]);
            }
            return e2;
          }, U.apply(this, arguments);
        }
        function F(e2, t3) {
          e2.prototype = Object.create(t3.prototype), e2.prototype.constructor = e2, e2.__proto__ = t3;
        }
        function j(e2) {
          if (void 0 === e2)
            throw new ReferenceError(
              "this hasn't been initialised - super() hasn't been called"
            );
          return e2;
        }
        function H(e2, t3) {
          (t3 == null || t3 > e2.length) && (t3 = e2.length);
          for (var n3 = 0, a3 = new Array(t3); n3 < t3; n3++) a3[n3] = e2[n3];
          return a3;
        }
        function q(e2, t3) {
          var n3;
          if (typeof Symbol == "undefined" || e2[Symbol.iterator] == null) {
            if (Array.isArray(e2) || (n3 = function(e3, t4) {
              if (e3) {
                if (typeof e3 == "string") return H(e3, t4);
                var n4 = Object.prototype.toString.call(e3).slice(8, -1);
                return n4 === "Object" && e3.constructor && (n4 = e3.constructor.name), n4 === "Map" || n4 === "Set" ? Array.from(e3) : n4 === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n4) ? H(e3, t4) : void 0;
              }
            }(e2)) || t3 && e2 && typeof e2.length == "number") {
              n3 && (e2 = n3);
              var a3 = 0;
              return function() {
                return a3 >= e2.length ? { done: true } : { done: false, value: e2[a3++] };
              };
            }
            throw new TypeError(
              "Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."
            );
          }
          return (n3 = e2[Symbol.iterator]()).next.bind(n3);
        }
        var W = Symbol("mobx-stored-annotations");
        function G(e2) {
          return Object.assign(function(t3, n3) {
            B(t3, n3, e2);
          }, e2);
        }
        function B(e2, t3, n3) {
          D(e2, W) || I(e2, W, U({}, e2[W])), te(n3) && !D(e2[W], t3) && o2(
            "'" + e2.constructor.name + ".prototype." + t3.toString() + "' is decorated with 'override', but no such decorated member was found on prototype."
          ), function(e3, t4, n4) {
            if (!te(t4) && D(e3[W], n4)) {
              var a3 = e3.constructor.name + ".prototype." + n4.toString(), i3 = e3[W][n4].annotationType_;
              o2(
                "Cannot apply '@" + t4.annotationType_ + "' to '" + a3 + "':\nThe field is already decorated with '@" + i3 + "'.\nRe-decorating fields is not allowed.\nUse '@override' decorator for methods overriden by subclass."
              );
            }
          }(e2, n3, t3), te(n3) || (e2[W][t3] = n3);
        }
        var Y = Symbol("mobx administration"), K = function() {
          function e2(e3) {
            void 0 === e3 && (e3 = "Atom@" + y()), this.name_ = void 0, this.isPendingUnobservation_ = false, this.isBeingObserved_ = false, this.observers_ = /* @__PURE__ */ new Set(), this.diffValue_ = 0, this.lastAccessedBy_ = 0, this.lowestObserverState_ = Je.NOT_TRACKING_, this.onBOL = void 0, this.onBUOL = void 0, this.name_ = e3;
          }
          var t3 = e2.prototype;
          return t3.onBO = function() {
            this.onBOL && this.onBOL.forEach(function(e3) {
              return e3();
            });
          }, t3.onBUO = function() {
            this.onBUOL && this.onBUOL.forEach(function(e3) {
              return e3();
            });
          }, t3.reportObserved = function() {
            return Ct(this);
          }, t3.reportChanged = function() {
            St(), Ot(this), xt();
          }, t3.toString = function() {
            return this.name_;
          }, e2;
        }(), z = x("Atom", K);
        function V(e2, t3, n3) {
          void 0 === t3 && (t3 = w), void 0 === n3 && (n3 = w);
          var a3 = new K(e2);
          return t3 !== w && sn(a3, t3), n3 !== w && ln(a3, n3), a3;
        }
        var X = {
          identity: function(e2, t3) {
            return e2 === t3;
          },
          structural: function(e2, t3) {
            return to(e2, t3);
          },
          default: function(e2, t3) {
            return Object.is ? Object.is(e2, t3) : e2 === t3 ? e2 !== 0 || 1 / e2 == 1 / t3 : e2 != e2 && t3 != t3;
          },
          shallow: function(e2, t3) {
            return to(e2, t3, 1);
          }
        };
        function J(e2, t3, n3) {
          return Pn(e2) ? e2 : Array.isArray(e2) ? _e.array(e2, { name: n3 }) : A(e2) ? _e.object(e2, void 0, { name: n3 }) : C(e2) ? _e.map(e2, { name: n3 }) : O(e2) ? _e.set(e2, { name: n3 }) : typeof e2 != "function" || tn(e2) || In(e2) ? e2 : E(e2) ? Tn(e2) : Zt(n3, e2);
        }
        function Q(e2) {
          return e2;
        }
        var ee = G({
          annotationType_: "override",
          make_: function(e2, t3) {
            return e2.isPlainObject_ && o2(
              "Cannot apply '" + this.annotationType_ + "' to '" + e2.name_ + "." + t3.toString() + "':\n'" + this.annotationType_ + "' cannot be used on plain objects."
            ), D(e2.appliedAnnotations_, t3) || o2(
              "'" + e2.name_ + "." + t3.toString() + "' is annotated with '" + this.annotationType_ + "', but no such annotated member was found on prototype."
            ), 0;
          },
          extend_: function(e2, t3, n3, a3) {
            o2(
              "'" + this.annotationType_ + "' can only be used with 'makeObservable'"
            );
          }
        });
        function te(e2) {
          return e2.annotationType_ === "override";
        }
        function ne(e2, t3) {
          return { annotationType_: e2, options_: t3, make_: ae, extend_: oe };
        }
        function ae(e2, t3, n3, a3) {
          var o3;
          if ((o3 = this.options_) == null ? void 0 : o3.bound)
            return this.extend_(e2, t3, n3, false) === null ? 0 : 1;
          if (a3 === e2.target_) return this.extend_(e2, t3, n3, false) === null ? 0 : 2;
          if (tn(n3.value)) return 1;
          var i3 = ie(e2, this, t3, n3, false);
          return c2(a3, t3, i3), 2;
        }
        function oe(e2, t3, n3, a3) {
          var o3 = ie(e2, this, t3, n3);
          return e2.defineProperty_(t3, o3, a3);
        }
        function ie(e2, t3, n3, a3, i3) {
          var r3, s3, l3, c3, u3;
          void 0 === i3 && (i3 = vt.safeDescriptors), function(e3, t4, n4, a4) {
            var i4 = t4.annotationType_;
            v(a4.value) || o2(
              "Cannot apply '" + i4 + "' to '" + e3.name_ + "." + n4.toString() + "':\n'" + i4 + "' can only be used on properties with a function value."
            );
          }(e2, t3, n3, a3);
          var p3, d3 = a3.value;
          return ((r3 = t3.options_) == null ? void 0 : r3.bound) && (d3 = d3.bind((p3 = e2.proxy_) != null ? p3 : e2.target_)), {
            value: He(
              (s3 = (l3 = t3.options_) == null ? void 0 : l3.name) != null ? s3 : n3.toString(),
              d3,
              (c3 = (u3 = t3.options_) == null ? void 0 : u3.autoAction) != null && c3
            ),
            configurable: !i3 || e2.isPlainObject_,
            enumerable: false,
            writable: !i3
          };
        }
        function re(e2, t3) {
          return { annotationType_: e2, options_: t3, make_: se, extend_: le };
        }
        function se(e2, t3, n3, a3) {
          var o3;
          if (a3 === e2.target_) return this.extend_(e2, t3, n3, false) === null ? 0 : 2;
          if (((o3 = this.options_) == null ? void 0 : o3.bound) && !In(e2.target_[t3]) && this.extend_(e2, t3, n3, false) === null)
            return 0;
          if (In(n3.value)) return 1;
          var i3 = ce(e2, this, t3, n3, false, false);
          return c2(a3, t3, i3), 2;
        }
        function le(e2, t3, n3, a3) {
          var o3, i3 = ce(
            e2,
            this,
            t3,
            n3,
            (o3 = this.options_) == null ? void 0 : o3.bound
          );
          return e2.defineProperty_(t3, i3, a3);
        }
        function ce(e2, t3, n3, a3, i3, r3) {
          void 0 === r3 && (r3 = vt.safeDescriptors), function(e3, t4, n4, a4) {
            var i4 = t4.annotationType_;
            v(a4.value) || o2(
              "Cannot apply '" + i4 + "' to '" + e3.name_ + "." + n4.toString() + "':\n'" + i4 + "' can only be used on properties with a generator function value."
            );
          }(e2, t3, n3, a3);
          var s3, l3 = a3.value;
          return i3 && (l3 = l3.bind((s3 = e2.proxy_) != null ? s3 : e2.target_)), {
            value: Tn(l3),
            configurable: !r3 || e2.isPlainObject_,
            enumerable: false,
            writable: !r3
          };
        }
        function ue(e2, t3) {
          return { annotationType_: e2, options_: t3, make_: pe, extend_: de };
        }
        function pe(e2, t3, n3) {
          return this.extend_(e2, t3, n3, false) === null ? 0 : 1;
        }
        function de(e2, t3, n3, a3) {
          return function(e3, t4, n4, a4) {
            var i3 = t4.annotationType_;
            a4.get || o2(
              "Cannot apply '" + i3 + "' to '" + e3.name_ + "." + n4.toString() + "':\n'" + i3 + "' can only be used on getter(+setter) properties."
            );
          }(e2, this, t3, n3), e2.defineComputedProperty_(
            t3,
            U({}, this.options_, { get: n3.get, set: n3.set }),
            a3
          );
        }
        function me(e2, t3) {
          return { annotationType_: e2, options_: t3, make_: he, extend_: ge };
        }
        function he(e2, t3, n3) {
          return this.extend_(e2, t3, n3, false) === null ? 0 : 1;
        }
        function ge(e2, t3, n3, a3) {
          var i3, r3;
          return function(e3, t4, n4, a4) {
            var i4 = t4.annotationType_;
            "value" in a4 || o2(
              "Cannot apply '" + i4 + "' to '" + e3.name_ + "." + n4.toString() + "':\n'" + i4 + "' cannot be used on getter/setter properties"
            );
          }(e2, this, t3, n3), e2.defineObservableProperty_(
            t3,
            n3.value,
            (i3 = (r3 = this.options_) == null ? void 0 : r3.enhancer) != null ? i3 : J,
            a3
          );
        }
        var fe = ye();
        function ye(e2) {
          return { annotationType_: "true", options_: e2, make_: be, extend_: we };
        }
        function be(e2, t3, n3, a3) {
          var o3, i3, r3, s3;
          if (n3.get) return Le.make_(e2, t3, n3, a3);
          if (n3.set) {
            var l3 = He(t3.toString(), n3.set);
            return a3 === e2.target_ ? e2.defineProperty_(t3, {
              configurable: !vt.safeDescriptors || e2.isPlainObject_,
              set: l3
            }) === null ? 0 : 2 : (c2(a3, t3, { configurable: true, set: l3 }), 2);
          }
          if (a3 !== e2.target_ && typeof n3.value == "function")
            return E(n3.value) ? (((s3 = this.options_) == null ? void 0 : s3.autoBind) ? Tn.bound : Tn).make_(e2, t3, n3, a3) : (((r3 = this.options_) == null ? void 0 : r3.autoBind) ? Zt.bound : Zt).make_(e2, t3, n3, a3);
          var u3, p3 = false === ((o3 = this.options_) == null ? void 0 : o3.deep) ? _e.ref : _e;
          return typeof n3.value == "function" && ((i3 = this.options_) == null ? void 0 : i3.autoBind) && (n3.value = n3.value.bind((u3 = e2.proxy_) != null ? u3 : e2.target_)), p3.make_(e2, t3, n3, a3);
        }
        function we(e2, t3, n3, a3) {
          var o3, i3, r3;
          return n3.get ? Le.extend_(e2, t3, n3, a3) : n3.set ? e2.defineProperty_(
            t3,
            {
              configurable: !vt.safeDescriptors || e2.isPlainObject_,
              set: He(t3.toString(), n3.set)
            },
            a3
          ) : (typeof n3.value == "function" && ((o3 = this.options_) == null ? void 0 : o3.autoBind) && (n3.value = n3.value.bind(
            (r3 = e2.proxy_) != null ? r3 : e2.target_
          )), (false === ((i3 = this.options_) == null ? void 0 : i3.deep) ? _e.ref : _e).extend_(e2, t3, n3, a3));
        }
        var ve = {
          deep: true,
          name: void 0,
          defaultDecorator: void 0,
          proxy: true
        };
        function ke(e2) {
          return e2 || ve;
        }
        Object.freeze(ve);
        var Te = me("observable"), Ae = me("observable.ref", { enhancer: Q }), Ee = me("observable.shallow", {
          enhancer: function(e2, t3, n3) {
            return e2 == null || ja(e2) || Aa(e2) || Ra(e2) || Na(e2) ? e2 : Array.isArray(e2) ? _e.array(e2, { name: n3, deep: false }) : A(e2) ? _e.object(e2, void 0, { name: n3, deep: false }) : C(e2) ? _e.map(e2, { name: n3, deep: false }) : O(e2) ? _e.set(e2, { name: n3, deep: false }) : void o2(
              "The shallow modifier / decorator can only used in combination with arrays, objects, maps and sets"
            );
          }
        }), Ie = me("observable.struct", {
          enhancer: function(e2, t3) {
            return Pn(e2) && o2(
              "observable.struct should not be used with observable values"
            ), to(e2, t3) ? t3 : e2;
          }
        }), Se = G(Te);
        function xe(e2) {
          return true === e2.deep ? J : false === e2.deep ? Q : (t3 = e2.defaultDecorator) && (n3 = (a3 = t3.options_) == null ? void 0 : a3.enhancer) != null ? n3 : J;
          var t3, n3, a3;
        }
        function Ce(e2, t3, n3) {
          if (!k(t3))
            return Pn(e2) ? e2 : A(e2) ? _e.object(e2, t3, n3) : Array.isArray(e2) ? _e.array(e2, t3) : C(e2) ? _e.map(e2, t3) : O(e2) ? _e.set(e2, t3) : typeof e2 == "object" && e2 !== null ? e2 : _e.box(e2, t3);
          B(e2, t3, Te);
        }
        Object.assign(Ce, Se);
        var Oe, Re, _e = s2(Ce, {
          box: function(e2, t3) {
            var n3 = ke(t3);
            return new Ve(e2, xe(n3), n3.name, true, n3.equals);
          },
          array: function(e2, t3) {
            var n3 = ke(t3);
            return (false === vt.useProxies || false === n3.proxy ? Xa : ha)(
              e2,
              xe(n3),
              n3.name
            );
          },
          map: function(e2, t3) {
            var n3 = ke(t3);
            return new Oa(e2, xe(n3), n3.name);
          },
          set: function(e2, t3) {
            var n3 = ke(t3);
            return new Pa(e2, xe(n3), n3.name);
          },
          object: function(e2, t3, n3) {
            return dn(
              false === vt.useProxies || false === (n3 == null ? void 0 : n3.proxy) ? $a({}, n3) : function(e3, t4) {
                var n4, a3;
                return g(), e3 = $a(e3, t4), (a3 = (n4 = e3[Y]).proxy_) != null ? a3 : n4.proxy_ = new Proxy(e3, ea);
              }({}, n3),
              e2,
              t3
            );
          },
          ref: G(Ae),
          shallow: G(Ee),
          deep: Se,
          struct: G(Ie)
        }), Ne = ue("computed"), De = ue("computed.struct", { equals: X.structural }), Le = function(e2, t3) {
          if (k(t3)) return B(e2, t3, Ne);
          if (A(e2)) return G(ue("computed", e2));
          v(e2) || o2("First argument to `computed` should be an expression."), v(t3) && o2(
            "A setter as second argument is no longer supported, use `{ set: fn }` option instead"
          );
          var n3 = A(t3) ? t3 : {};
          return n3.get = e2, n3.name || (n3.name = e2.name || ""), new tt(n3);
        };
        Object.assign(Le, Ne), Le.struct = G(De);
        var Me, $e = 0, Ue = 1, Fe = (Oe = (Re = l2(function() {
        }, "name")) == null ? void 0 : Re.configurable) != null && Oe, je = {
          value: "action",
          configurable: true,
          writable: false,
          enumerable: false
        };
        function He(e2, t3, n3, a3) {
          function i3() {
            return qe(e2, n3, t3, a3 || this, arguments);
          }
          return void 0 === n3 && (n3 = false), v(t3) || o2("`action` can only be invoked on functions"), typeof e2 == "string" && e2 || o2("actions should have valid names, got: '" + e2 + "'"), i3.isMobxAction = true, Fe && (je.value = e2, Object.defineProperty(i3, "name", je)), i3;
        }
        function qe(e2, t3, n3, a3, o3) {
          var i3 = We(e2, t3, a3, o3);
          try {
            return n3.apply(a3, o3);
          } catch (e3) {
            throw i3.error_ = e3, e3;
          } finally {
            Ge(i3);
          }
        }
        function We(e2, t3, n3, a3) {
          var o3 = Ut() && !!e2, i3 = 0;
          if (o3) {
            i3 = Date.now();
            var r3 = a3 ? Array.from(a3) : p2;
            jt({ type: Gt, name: e2, object: n3, arguments: r3 });
          }
          var s3 = vt.trackingDerivation, l3 = !t3 || !s3;
          St();
          var c3 = vt.allowStateChanges;
          l3 && (pt(), c3 = Ye(true));
          var u3 = {
            runAsAction_: l3,
            prevDerivation_: s3,
            prevAllowStateChanges_: c3,
            prevAllowStateReads_: mt(true),
            notifySpy_: o3,
            startTime_: i3,
            actionId_: Ue++,
            parentActionId_: $e
          };
          return $e = u3.actionId_, u3;
        }
        function Ge(e2) {
          $e !== e2.actionId_ && o2(30), $e = e2.parentActionId_, void 0 !== e2.error_ && (vt.suppressReactionErrors = true), Ke(e2.prevAllowStateChanges_), ht(e2.prevAllowStateReads_), xt(), e2.runAsAction_ && dt(e2.prevDerivation_), e2.notifySpy_ && qt({ time: Date.now() - e2.startTime_ }), vt.suppressReactionErrors = false;
        }
        function Be(e2, t3) {
          var n3 = Ye(e2);
          try {
            return t3();
          } finally {
            Ke(n3);
          }
        }
        function Ye(e2) {
          var t3 = vt.allowStateChanges;
          return vt.allowStateChanges = e2, t3;
        }
        function Ke(e2) {
          vt.allowStateChanges = e2;
        }
        Me = Symbol.toPrimitive;
        var ze, Ve = function(e2) {
          function t3(t4, n4, a3, o3, i3) {
            var r3;
            return void 0 === a3 && (a3 = "ObservableValue@" + y()), void 0 === o3 && (o3 = true), void 0 === i3 && (i3 = X.default), (r3 = e2.call(this, a3) || this).enhancer = void 0, r3.name_ = void 0, r3.equals = void 0, r3.hasUnreportedChange_ = false, r3.interceptors_ = void 0, r3.changeListeners_ = void 0, r3.value_ = void 0, r3.dehancer = void 0, r3.enhancer = n4, r3.name_ = a3, r3.equals = i3, r3.value_ = n4(t4, void 0, a3), o3 && Ut() && Ft({
              type: "create",
              object: j(r3),
              observableKind: "value",
              debugObjectName: r3.name_,
              newValue: "" + r3.value_
            }), r3;
          }
          F(t3, e2);
          var n3 = t3.prototype;
          return n3.dehanceValue = function(e3) {
            return void 0 !== this.dehancer ? this.dehancer(e3) : e3;
          }, n3.set = function(e3) {
            var t4 = this.value_;
            if ((e3 = this.prepareNewValue_(e3)) !== vt.UNCHANGED) {
              var n4 = Ut();
              n4 && jt({
                type: pa,
                object: this,
                observableKind: "value",
                debugObjectName: this.name_,
                newValue: e3,
                oldValue: t4
              }), this.setNewValue_(e3), n4 && qt();
            }
          }, n3.prepareNewValue_ = function(e3) {
            if (st(this), ta(this)) {
              var t4 = aa(this, { object: this, type: pa, newValue: e3 });
              if (!t4) return vt.UNCHANGED;
              e3 = t4.newValue;
            }
            return e3 = this.enhancer(e3, this.value_, this.name_), this.equals(this.value_, e3) ? vt.UNCHANGED : e3;
          }, n3.setNewValue_ = function(e3) {
            var t4 = this.value_;
            this.value_ = e3, this.reportChanged(), oa(this) && ra(this, {
              type: pa,
              object: this,
              newValue: e3,
              oldValue: t4
            });
          }, n3.get = function() {
            return this.reportObserved(), this.dehanceValue(this.value_);
          }, n3.intercept_ = function(e3) {
            return na(this, e3);
          }, n3.observe_ = function(e3, t4) {
            return t4 && e3({
              observableKind: "value",
              debugObjectName: this.name_,
              object: this,
              type: pa,
              newValue: this.value_,
              oldValue: void 0
            }), ia(this, e3);
          }, n3.raw = function() {
            return this.value_;
          }, n3.toJSON = function() {
            return this.get();
          }, n3.toString = function() {
            return this.name_ + "[" + this.value_ + "]";
          }, n3.valueOf = function() {
            return N(this.get());
          }, n3[Me] = function() {
            return this.valueOf();
          }, t3;
        }(K), Xe = x("ObservableValue", Ve);
        ze = Symbol.toPrimitive;
        var Je, Qe, Ze, et, tt = function() {
          function e2(e3) {
            this.dependenciesState_ = Je.NOT_TRACKING_, this.observing_ = [], this.newObserving_ = null, this.isBeingObserved_ = false, this.isPendingUnobservation_ = false, this.observers_ = /* @__PURE__ */ new Set(), this.diffValue_ = 0, this.runId_ = 0, this.lastAccessedBy_ = 0, this.lowestObserverState_ = Je.UP_TO_DATE_, this.unboundDepsCount_ = 0, this.value_ = new at(null), this.name_ = void 0, this.triggeredBy_ = void 0, this.isComputing_ = false, this.isRunningSetter_ = false, this.derivation = void 0, this.setter_ = void 0, this.isTracing_ = Ze.NONE, this.scope_ = void 0, this.equals_ = void 0, this.requiresReaction_ = void 0, this.keepAlive_ = void 0, this.onBOL = void 0, this.onBUOL = void 0, e3.get || o2(31), this.derivation = e3.get, this.name_ = e3.name || "ComputedValue@" + y(), e3.set && (this.setter_ = He(this.name_ + "-setter", e3.set)), this.equals_ = e3.equals || (e3.compareStructural || e3.struct ? X.structural : X.default), this.scope_ = e3.context, this.requiresReaction_ = !!e3.requiresReaction, this.keepAlive_ = !!e3.keepAlive;
          }
          var t3 = e2.prototype;
          return t3.onBecomeStale_ = function() {
            var e3;
            (e3 = this).lowestObserverState_ === Je.UP_TO_DATE_ && (e3.lowestObserverState_ = Je.POSSIBLY_STALE_, e3.observers_.forEach(function(e4) {
              e4.dependenciesState_ === Je.UP_TO_DATE_ && (e4.dependenciesState_ = Je.POSSIBLY_STALE_, e4.onBecomeStale_());
            }));
          }, t3.onBO = function() {
            this.onBOL && this.onBOL.forEach(function(e3) {
              return e3();
            });
          }, t3.onBUO = function() {
            this.onBUOL && this.onBUOL.forEach(function(e3) {
              return e3();
            });
          }, t3.get = function() {
            if (this.isComputing_ && o2(32, this.name_, this.derivation), vt.inBatch !== 0 || this.observers_.size !== 0 || this.keepAlive_) {
              if (Ct(this), it(this)) {
                var e3 = vt.trackingContext;
                this.keepAlive_ && !e3 && (vt.trackingContext = this), this.trackAndCompute() && (t4 = this).lowestObserverState_ !== Je.STALE_ && (t4.lowestObserverState_ = Je.STALE_, t4.observers_.forEach(function(e4) {
                  e4.dependenciesState_ === Je.POSSIBLY_STALE_ ? (e4.dependenciesState_ = Je.STALE_, e4.isTracing_ !== Ze.NONE && Rt(e4, t4)) : e4.dependenciesState_ === Je.UP_TO_DATE_ && (t4.lowestObserverState_ = Je.UP_TO_DATE_);
                })), vt.trackingContext = e3;
              }
            } else
              it(this) && (this.warnAboutUntrackedRead_(), St(), this.value_ = this.computeValue_(false), xt());
            var t4, n3 = this.value_;
            if (ot(n3)) throw n3.cause;
            return n3;
          }, t3.set = function(e3) {
            if (this.setter_) {
              this.isRunningSetter_ && o2(33, this.name_), this.isRunningSetter_ = true;
              try {
                this.setter_.call(this.scope_, e3);
              } finally {
                this.isRunningSetter_ = false;
              }
            } else o2(34, this.name_);
          }, t3.trackAndCompute = function() {
            var e3 = this.value_, t4 = this.dependenciesState_ === Je.NOT_TRACKING_, n3 = this.computeValue_(true);
            Ut() && Ft({
              observableKind: "computed",
              debugObjectName: this.name_,
              object: this.scope_,
              type: "update",
              oldValue: this.value_,
              newValue: n3
            });
            var a3 = t4 || ot(e3) || ot(n3) || !this.equals_(e3, n3);
            return a3 && (this.value_ = n3), a3;
          }, t3.computeValue_ = function(e3) {
            this.isComputing_ = true;
            var t4, n3 = Ye(false);
            if (e3) t4 = lt(this, this.derivation, this.scope_);
            else if (true === vt.disableErrorBoundaries)
              t4 = this.derivation.call(this.scope_);
            else
              try {
                t4 = this.derivation.call(this.scope_);
              } catch (e4) {
                t4 = new at(e4);
              }
            return Ke(n3), this.isComputing_ = false, t4;
          }, t3.suspend_ = function() {
            this.keepAlive_ || (ct(this), this.value_ = void 0, this.isTracing_ !== Ze.NONE && console.log(
              "[mobx.trace] Computed value '" + this.name_ + "' was suspended and it will recompute on the next access."
            ));
          }, t3.observe_ = function(e3, t4) {
            var n3 = this, a3 = true, o3 = void 0;
            return nn(function() {
              var i3 = n3.get();
              if (!a3 || t4) {
                var r3 = pt();
                e3({
                  observableKind: "computed",
                  debugObjectName: n3.name_,
                  type: pa,
                  object: n3,
                  newValue: i3,
                  oldValue: o3
                }), dt(r3);
              }
              a3 = false, o3 = i3;
            });
          }, t3.warnAboutUntrackedRead_ = function() {
            this.isTracing_ !== Ze.NONE && console.log(
              "[mobx.trace] Computed value '" + this.name_ + "' is being read outside a reactive context. Doing a full recompute."
            ), (vt.computedRequiresReaction || this.requiresReaction_) && console.warn(
              "[mobx] Computed value '" + this.name_ + "' is being read outside a reactive context. Doing a full recompute."
            );
          }, t3.toString = function() {
            return this.name_ + "[" + this.derivation.toString() + "]";
          }, t3.valueOf = function() {
            return N(this.get());
          }, t3[ze] = function() {
            return this.valueOf();
          }, e2;
        }(), nt = x("ComputedValue", tt);
        (Qe = Je || (Je = {}))[Qe.NOT_TRACKING_ = -1] = "NOT_TRACKING_", Qe[Qe.UP_TO_DATE_ = 0] = "UP_TO_DATE_", Qe[Qe.POSSIBLY_STALE_ = 1] = "POSSIBLY_STALE_", Qe[Qe.STALE_ = 2] = "STALE_", (et = Ze || (Ze = {}))[et.NONE = 0] = "NONE", et[et.LOG = 1] = "LOG", et[et.BREAK = 2] = "BREAK";
        var at = function(e2) {
          this.cause = void 0, this.cause = e2;
        };
        function ot(e2) {
          return e2 instanceof at;
        }
        function it(e2) {
          switch (e2.dependenciesState_) {
            case Je.UP_TO_DATE_:
              return false;
            case Je.NOT_TRACKING_:
            case Je.STALE_:
              return true;
            case Je.POSSIBLY_STALE_:
              for (var t3 = mt(true), n3 = pt(), a3 = e2.observing_, o3 = a3.length, i3 = 0; i3 < o3; i3++) {
                var r3 = a3[i3];
                if (nt(r3)) {
                  if (vt.disableErrorBoundaries) r3.get();
                  else
                    try {
                      r3.get();
                    } catch (e3) {
                      return dt(n3), ht(t3), true;
                    }
                  if (e2.dependenciesState_ === Je.STALE_)
                    return dt(n3), ht(t3), true;
                }
              }
              return gt(e2), dt(n3), ht(t3), false;
          }
        }
        function rt() {
          return vt.trackingDerivation !== null;
        }
        function st(e2) {
          var t3 = e2.observers_.size > 0;
          vt.allowStateChanges || !t3 && vt.enforceActions !== "always" || console.warn(
            "[MobX] " + (vt.enforceActions ? "Since strict-mode is enabled, changing (observed) observable values without using an action is not allowed. Tried to modify: " : "Side effects like changing state are not allowed at this point. Are you trying to modify state from, for example, a computed value or the render function of a React component? You can wrap side effects in 'runInAction' (or decorate functions with 'action') if needed. Tried to modify: ") + e2.name_
          );
        }
        function lt(e2, t3, n3) {
          var a3 = mt(true);
          gt(e2), e2.newObserving_ = new Array(e2.observing_.length + 100), e2.unboundDepsCount_ = 0, e2.runId_ = ++vt.runId;
          var o3, i3 = vt.trackingDerivation;
          if (vt.trackingDerivation = e2, vt.inBatch++, true === vt.disableErrorBoundaries)
            o3 = t3.call(n3);
          else
            try {
              o3 = t3.call(n3);
            } catch (e3) {
              o3 = new at(e3);
            }
          return vt.inBatch--, vt.trackingDerivation = i3, function(e3) {
            for (var t4 = e3.observing_, n4 = e3.observing_ = e3.newObserving_, a4 = Je.UP_TO_DATE_, o4 = 0, i4 = e3.unboundDepsCount_, r3 = 0; r3 < i4; r3++) {
              var s3 = n4[r3];
              s3.diffValue_ === 0 && (s3.diffValue_ = 1, o4 !== r3 && (n4[o4] = s3), o4++), s3.dependenciesState_ > a4 && (a4 = s3.dependenciesState_);
            }
            for (n4.length = o4, e3.newObserving_ = null, i4 = t4.length; i4--; ) {
              var l3 = t4[i4];
              l3.diffValue_ === 0 && Et(l3, e3), l3.diffValue_ = 0;
            }
            for (; o4--; ) {
              var c3 = n4[o4];
              c3.diffValue_ === 1 && (c3.diffValue_ = 0, At(c3, e3));
            }
            a4 !== Je.UP_TO_DATE_ && (e3.dependenciesState_ = a4, e3.onBecomeStale_());
          }(e2), function(e3) {
            e3.observing_.length === 0 && (vt.reactionRequiresObservable || e3.requiresObservable_) && console.warn(
              "[mobx] Derivation '" + e3.name_ + "' is created/updated without reading any observable value."
            );
          }(e2), ht(a3), o3;
        }
        function ct(e2) {
          var t3 = e2.observing_;
          e2.observing_ = [];
          for (var n3 = t3.length; n3--; ) Et(t3[n3], e2);
          e2.dependenciesState_ = Je.NOT_TRACKING_;
        }
        function ut(e2) {
          var t3 = pt();
          try {
            return e2();
          } finally {
            dt(t3);
          }
        }
        function pt() {
          var e2 = vt.trackingDerivation;
          return vt.trackingDerivation = null, e2;
        }
        function dt(e2) {
          vt.trackingDerivation = e2;
        }
        function mt(e2) {
          var t3 = vt.allowStateReads;
          return vt.allowStateReads = e2, t3;
        }
        function ht(e2) {
          vt.allowStateReads = e2;
        }
        function gt(e2) {
          if (e2.dependenciesState_ !== Je.UP_TO_DATE_) {
            e2.dependenciesState_ = Je.UP_TO_DATE_;
            for (var t3 = e2.observing_, n3 = t3.length; n3--; )
              t3[n3].lowestObserverState_ = Je.UP_TO_DATE_;
          }
        }
        var ft = [
          "mobxGuid",
          "spyListeners",
          "enforceActions",
          "computedRequiresReaction",
          "reactionRequiresObservable",
          "observableRequiresReaction",
          "allowStateReads",
          "disableErrorBoundaries",
          "runId",
          "UNCHANGED",
          "useProxies"
        ], yt = function() {
          this.version = 6, this.UNCHANGED = {}, this.trackingDerivation = null, this.trackingContext = null, this.runId = 0, this.mobxGuid = 0, this.inBatch = 0, this.pendingUnobservations = [], this.pendingReactions = [], this.isRunningReactions = false, this.allowStateChanges = false, this.allowStateReads = true, this.enforceActions = true, this.spyListeners = [], this.globalReactionErrorHandlers = [], this.computedRequiresReaction = false, this.reactionRequiresObservable = false, this.observableRequiresReaction = false, this.disableErrorBoundaries = false, this.suppressReactionErrors = false, this.useProxies = true, this.verifyProxies = false, this.safeDescriptors = true;
        }, bt = true, wt = false, vt = function() {
          var e2 = r2();
          return e2.__mobxInstanceCount > 0 && !e2.__mobxGlobals && (bt = false), e2.__mobxGlobals && e2.__mobxGlobals.version !== new yt().version && (bt = false), bt ? e2.__mobxGlobals ? (e2.__mobxInstanceCount += 1, e2.__mobxGlobals.UNCHANGED || (e2.__mobxGlobals.UNCHANGED = {}), e2.__mobxGlobals) : (e2.__mobxInstanceCount = 1, e2.__mobxGlobals = new yt()) : (setTimeout(function() {
            wt || o2(35);
          }, 1), new yt());
        }();
        function kt() {
          return vt;
        }
        function Tt() {
          var e2 = new yt();
          for (var t3 in e2) -1 === ft.indexOf(t3) && (vt[t3] = e2[t3]);
          vt.allowStateChanges = !vt.enforceActions;
        }
        function At(e2, t3) {
          e2.observers_.add(t3), e2.lowestObserverState_ > t3.dependenciesState_ && (e2.lowestObserverState_ = t3.dependenciesState_);
        }
        function Et(e2, t3) {
          e2.observers_.delete(t3), e2.observers_.size === 0 && It(e2);
        }
        function It(e2) {
          false === e2.isPendingUnobservation_ && (e2.isPendingUnobservation_ = true, vt.pendingUnobservations.push(e2));
        }
        function St() {
          vt.inBatch++;
        }
        function xt() {
          if (--vt.inBatch == 0) {
            Lt();
            for (var e2 = vt.pendingUnobservations, t3 = 0; t3 < e2.length; t3++) {
              var n3 = e2[t3];
              n3.isPendingUnobservation_ = false, n3.observers_.size === 0 && (n3.isBeingObserved_ && (n3.isBeingObserved_ = false, n3.onBUO()), n3 instanceof tt && n3.suspend_());
            }
            vt.pendingUnobservations = [];
          }
        }
        function Ct(e2) {
          !function(e3) {
            !vt.allowStateReads && vt.observableRequiresReaction && console.warn(
              "[mobx] Observable '" + e3.name_ + "' being read outside a reactive context."
            );
          }(e2);
          var t3 = vt.trackingDerivation;
          return t3 !== null ? (t3.runId_ !== e2.lastAccessedBy_ && (e2.lastAccessedBy_ = t3.runId_, t3.newObserving_[t3.unboundDepsCount_++] = e2, !e2.isBeingObserved_ && vt.trackingContext && (e2.isBeingObserved_ = true, e2.onBO())), true) : (e2.observers_.size === 0 && vt.inBatch > 0 && It(e2), false);
        }
        function Ot(e2) {
          e2.lowestObserverState_ !== Je.STALE_ && (e2.lowestObserverState_ = Je.STALE_, e2.observers_.forEach(function(t3) {
            t3.dependenciesState_ === Je.UP_TO_DATE_ && (t3.isTracing_ !== Ze.NONE && Rt(t3, e2), t3.onBecomeStale_()), t3.dependenciesState_ = Je.STALE_;
          }));
        }
        function Rt(e2, t3) {
          if (console.log(
            "[mobx.trace] '" + e2.name_ + "' is invalidated due to a change in: '" + t3.name_ + "'"
          ), e2.isTracing_ === Ze.BREAK) {
            var n3 = [];
            _t(mn(e2), n3, 1), new Function(
              "debugger;\n/*\nTracing '" + e2.name_ + "'\n\nYou are entering this break point because derivation '" + e2.name_ + "' is being traced and '" + t3.name_ + "' is now forcing it to update.\nJust follow the stacktrace you should now see in the devtools to see precisely what piece of your code is causing this update\nThe stackframe you are looking for is at least ~6-8 stack-frames up.\n\n" + (e2 instanceof tt ? e2.derivation.toString().replace(/[*]\//g, "/") : "") + "\n\nThe dependencies for this derivation are:\n\n" + n3.join("\n") + "\n*/\n    "
            )();
          }
        }
        function _t(e2, t3, n3) {
          t3.length >= 1e3 ? t3.push("(and many more)") : (t3.push("" + new Array(n3).join("	") + e2.name), e2.dependencies && e2.dependencies.forEach(function(e3) {
            return _t(e3, t3, n3 + 1);
          }));
        }
        var Pt = function() {
          function e2(e3, t4, n3, a3) {
            void 0 === e3 && (e3 = "Reaction@" + y()), void 0 === a3 && (a3 = false), this.name_ = void 0, this.onInvalidate_ = void 0, this.errorHandler_ = void 0, this.requiresObservable_ = void 0, this.observing_ = [], this.newObserving_ = [], this.dependenciesState_ = Je.NOT_TRACKING_, this.diffValue_ = 0, this.runId_ = 0, this.unboundDepsCount_ = 0, this.isDisposed_ = false, this.isScheduled_ = false, this.isTrackPending_ = false, this.isRunning_ = false, this.isTracing_ = Ze.NONE, this.name_ = e3, this.onInvalidate_ = t4, this.errorHandler_ = n3, this.requiresObservable_ = a3;
          }
          var t3 = e2.prototype;
          return t3.onBecomeStale_ = function() {
            this.schedule_();
          }, t3.schedule_ = function() {
            this.isScheduled_ || (this.isScheduled_ = true, vt.pendingReactions.push(this), Lt());
          }, t3.isScheduled = function() {
            return this.isScheduled_;
          }, t3.runReaction_ = function() {
            if (!this.isDisposed_) {
              St(), this.isScheduled_ = false;
              var e3 = vt.trackingContext;
              if (vt.trackingContext = this, it(this)) {
                this.isTrackPending_ = true;
                try {
                  this.onInvalidate_(), this.isTrackPending_ && Ut() && Ft({ name: this.name_, type: "scheduled-reaction" });
                } catch (e4) {
                  this.reportExceptionInDerivation_(e4);
                }
              }
              vt.trackingContext = e3, xt();
            }
          }, t3.track = function(e3) {
            if (!this.isDisposed_) {
              St();
              var t4, n3 = Ut();
              n3 && (t4 = Date.now(), jt({ name: this.name_, type: "reaction" })), this.isRunning_ = true;
              var a3 = vt.trackingContext;
              vt.trackingContext = this;
              var o3 = lt(this, e3, void 0);
              vt.trackingContext = a3, this.isRunning_ = false, this.isTrackPending_ = false, this.isDisposed_ && ct(this), ot(o3) && this.reportExceptionInDerivation_(o3.cause), n3 && qt({ time: Date.now() - t4 }), xt();
            }
          }, t3.reportExceptionInDerivation_ = function(e3) {
            var t4 = this;
            if (this.errorHandler_) this.errorHandler_(e3, this);
            else {
              if (vt.disableErrorBoundaries) throw e3;
              var n3 = "[mobx] Encountered an uncaught exception that was thrown by a reaction or observer component, in: '" + this + "'";
              vt.suppressReactionErrors ? console.warn(
                "[mobx] (error in reaction '" + this.name_ + "' suppressed, fix error of causing action below)"
              ) : console.error(n3, e3), Ut() && Ft({
                type: "error",
                name: this.name_,
                message: n3,
                error: "" + e3
              }), vt.globalReactionErrorHandlers.forEach(function(n4) {
                return n4(e3, t4);
              });
            }
          }, t3.dispose = function() {
            this.isDisposed_ || (this.isDisposed_ = true, this.isRunning_ || (St(), ct(this), xt()));
          }, t3.getDisposer_ = function() {
            var e3 = this.dispose.bind(this);
            return e3[Y] = this, e3;
          }, t3.toString = function() {
            return "Reaction[" + this.name_ + "]";
          }, t3.trace = function(e3) {
            void 0 === e3 && (e3 = false), Kn(this, e3);
          }, e2;
        }();
        function Nt(e2) {
          return vt.globalReactionErrorHandlers.push(e2), function() {
            var t3 = vt.globalReactionErrorHandlers.indexOf(e2);
            t3 >= 0 && vt.globalReactionErrorHandlers.splice(t3, 1);
          };
        }
        var Dt = function(e2) {
          return e2();
        };
        function Lt() {
          vt.inBatch > 0 || vt.isRunningReactions || Dt(Mt);
        }
        function Mt() {
          vt.isRunningReactions = true;
          for (var e2 = vt.pendingReactions, t3 = 0; e2.length > 0; ) {
            ++t3 == 100 && (console.error(
              "Reaction doesn't converge to a stable state after 100 iterations. Probably there is a cycle in the reactive function: " + e2[0]
            ), e2.splice(0));
            for (var n3 = e2.splice(0), a3 = 0, o3 = n3.length; a3 < o3; a3++)
              n3[a3].runReaction_();
          }
          vt.isRunningReactions = false;
        }
        var $t = x("Reaction", Pt);
        function Ut() {
          return !!vt.spyListeners.length;
        }
        function Ft(e2) {
          if (vt.spyListeners.length)
            for (var t3 = vt.spyListeners, n3 = 0, a3 = t3.length; n3 < a3; n3++)
              t3[n3](e2);
        }
        function jt(e2) {
          Ft(U({}, e2, { spyReportStart: true }));
        }
        var Ht = { type: "report-end", spyReportEnd: true };
        function qt(e2) {
          Ft(e2 ? U({}, e2, { type: "report-end", spyReportEnd: true }) : Ht);
        }
        function Wt(e2) {
          return vt.spyListeners.push(e2), b(function() {
            vt.spyListeners = vt.spyListeners.filter(function(t3) {
              return t3 !== e2;
            });
          });
        }
        var Gt = "action", Kt = ne("action"), zt = ne("action.bound", { bound: true }), Vt = ne("autoAction", { autoAction: true }), Xt = ne("autoAction.bound", { autoAction: true, bound: true });
        function Jt(e2) {
          return function(t3, n3) {
            return v(t3) ? He(t3.name || "<unnamed action>", t3, e2) : v(n3) ? He(t3, n3, e2) : k(n3) ? B(t3, n3, e2 ? Vt : Kt) : k(t3) ? G(
              ne(e2 ? "autoAction" : "action", {
                name: t3,
                autoAction: e2
              })
            ) : void o2("Invalid arguments for `action`");
          };
        }
        var Qt = Jt(false);
        Object.assign(Qt, Kt);
        var Zt = Jt(true);
        function en(e2) {
          return qe(e2.name || "<unnamed action>", false, e2, this, void 0);
        }
        function tn(e2) {
          return v(e2) && true === e2.isMobxAction;
        }
        function nn(e2, t3) {
          var n3, a3;
          void 0 === t3 && (t3 = d2), v(e2) || o2("Autorun expects a function as first argument"), tn(e2) && o2("Autorun does not accept actions since actions are untrackable");
          var i3, r3 = (n3 = (a3 = t3) == null ? void 0 : a3.name) != null ? n3 : e2.name || "Autorun@" + y();
          if (t3.scheduler || t3.delay) {
            var s3 = on(t3), l3 = false;
            i3 = new Pt(
              r3,
              function() {
                l3 || (l3 = true, s3(function() {
                  l3 = false, i3.isDisposed_ || i3.track(c3);
                }));
              },
              t3.onError,
              t3.requiresObservable
            );
          } else
            i3 = new Pt(
              r3,
              function() {
                this.track(c3);
              },
              t3.onError,
              t3.requiresObservable
            );
          function c3() {
            e2(i3);
          }
          return i3.schedule_(), i3.getDisposer_();
        }
        Object.assign(Zt, Vt), Qt.bound = G(zt), Zt.bound = G(Xt);
        var an = function(e2) {
          return e2();
        };
        function on(e2) {
          return e2.scheduler ? e2.scheduler : e2.delay ? function(t3) {
            return setTimeout(t3, e2.delay);
          } : an;
        }
        function rn(e2, t3, n3) {
          var a3;
          void 0 === n3 && (n3 = d2), v(e2) && v(t3) || o2("First and second argument to reaction should be functions"), A(n3) || o2("Third argument of reactions should be an object");
          var i3, r3, s3, l3 = (a3 = n3.name) != null ? a3 : "Reaction@" + y(), c3 = Qt(
            l3,
            n3.onError ? (i3 = n3.onError, r3 = t3, function() {
              try {
                return r3.apply(this, arguments);
              } catch (e3) {
                i3.call(this, e3);
              }
            }) : t3
          ), u3 = !n3.scheduler && !n3.delay, p3 = on(n3), m3 = true, h2 = false, g2 = void 0, f2 = n3.compareStructural ? X.structural : n3.equals || X.default, b2 = new Pt(
            l3,
            function() {
              m3 || u3 ? w2() : h2 || (h2 = true, p3(w2));
            },
            n3.onError,
            n3.requiresObservable
          );
          function w2() {
            if (h2 = false, !b2.isDisposed_) {
              var t4 = false;
              b2.track(function() {
                var n4 = Be(false, function() {
                  return e2(b2);
                });
                t4 = m3 || !f2(s3, n4), g2 = s3, s3 = n4;
              }), (m3 && n3.fireImmediately || !m3 && t4) && c3(s3, g2, b2), m3 = false;
            }
          }
          return b2.schedule_(), b2.getDisposer_();
        }
        function sn(e2, t3, n3) {
          return cn("onBO", e2, t3, n3);
        }
        function ln(e2, t3, n3) {
          return cn("onBUO", e2, t3, n3);
        }
        function cn(e2, t3, n3, a3) {
          var o3 = typeof a3 == "function" ? Ja(t3, n3) : Ja(t3), i3 = v(a3) ? a3 : n3, r3 = e2 + "L";
          return o3[r3] ? o3[r3].add(i3) : o3[r3] = /* @__PURE__ */ new Set([i3]), function() {
            var e3 = o3[r3];
            e3 && (e3.delete(i3), e3.size === 0 && delete o3[r3]);
          };
        }
        function pn(e2) {
          true === e2.isolateGlobalState && function() {
            if ((vt.pendingReactions.length || vt.inBatch || vt.isRunningReactions) && o2(36), wt = true, bt) {
              var e3 = r2();
              --e3.__mobxInstanceCount == 0 && (e3.__mobxGlobals = void 0), vt = new yt();
            }
          }();
          var t3, n3, a3 = e2.useProxies, i3 = e2.enforceActions;
          if (void 0 !== a3 && (vt.useProxies = a3 === "always" || a3 !== "never" && typeof Proxy != "undefined"), a3 === "ifavailable" && (vt.verifyProxies = true), void 0 !== i3) {
            var s3 = i3 === "always" ? "always" : i3 === "observed";
            vt.enforceActions = s3, vt.allowStateChanges = true !== s3 && s3 !== "always";
          }
          [
            "computedRequiresReaction",
            "reactionRequiresObservable",
            "observableRequiresReaction",
            "disableErrorBoundaries",
            "safeDescriptors"
          ].forEach(function(t4) {
            t4 in e2 && (vt[t4] = !!e2[t4]);
          }), vt.allowStateReads = !vt.observableRequiresReaction, true === vt.disableErrorBoundaries && console.warn(
            "WARNING: Debug feature only. MobX will NOT recover from errors when `disableErrorBoundaries` is enabled."
          ), e2.reactionScheduler && (t3 = e2.reactionScheduler, n3 = Dt, Dt = function(e3) {
            return t3(function() {
              return n3(e3);
            });
          });
        }
        function dn(e2, t3, n3, a3) {
          arguments.length > 4 && o2("'extendObservable' expected 2-4 arguments"), typeof e2 != "object" && o2("'extendObservable' expects an object as first argument"), Ra(e2) && o2(
            "'extendObservable' should not be used on maps, use map.merge instead"
          ), A(t3) || o2(
            "'extendObservabe' only accepts plain objects as second argument"
          ), (Pn(t3) || Pn(n3)) && o2(
            "Extending an object with another observable (object) is not supported"
          );
          var i3 = L(t3), r3 = $a(e2, a3)[Y];
          St();
          try {
            _(i3).forEach(function(e3) {
              r3.extend_(e3, i3[e3], !n3 || !(e3 in n3) || n3[e3]);
            });
          } finally {
            xt();
          }
          return e2;
        }
        function mn(e2, t3) {
          return hn(Ja(e2, t3));
        }
        function hn(e2) {
          var t3, n3 = { name: e2.name_ };
          return e2.observing_ && e2.observing_.length > 0 && (n3.dependencies = (t3 = e2.observing_, Array.from(new Set(t3))).map(
            hn
          )), n3;
        }
        function gn(e2, t3) {
          return fn(Ja(e2, t3));
        }
        function fn(e2) {
          var t3, n3 = { name: e2.name_ };
          return (t3 = e2).observers_ && t3.observers_.size > 0 && (n3.observers = Array.from(
            function(e3) {
              return e3.observers_;
            }(e2)
          ).map(fn)), n3;
        }
        var yn = 0;
        function bn() {
          this.message = "FLOW_CANCELLED";
        }
        function wn(e2) {
          return e2 instanceof bn;
        }
        bn.prototype = Object.create(Error.prototype);
        var vn = re("flow"), kn = re("flow.bound", { bound: true }), Tn = Object.assign(function(e2, t3) {
          if (k(t3)) return B(e2, t3, vn);
          arguments.length !== 1 && o2("Flow expects single argument with generator function");
          var n3 = e2, a3 = n3.name || "<unnamed flow>", i3 = function() {
            var e3, t4 = this, o3 = arguments, i4 = ++yn, r3 = Qt(a3 + " - runid: " + i4 + " - init", n3).apply(t4, o3), s3 = void 0, l3 = new Promise(function(t5, n4) {
              var o4 = 0;
              function l4(e4) {
                var t6;
                s3 = void 0;
                try {
                  t6 = Qt(
                    a3 + " - runid: " + i4 + " - yield " + o4++,
                    r3.next
                  ).call(r3, e4);
                } catch (e5) {
                  return n4(e5);
                }
                u3(t6);
              }
              function c3(e4) {
                var t6;
                s3 = void 0;
                try {
                  t6 = Qt(
                    a3 + " - runid: " + i4 + " - yield " + o4++,
                    r3.throw
                  ).call(r3, e4);
                } catch (e5) {
                  return n4(e5);
                }
                u3(t6);
              }
              function u3(e4) {
                if (!v(e4 == null ? void 0 : e4.then))
                  return e4.done ? t5(e4.value) : (s3 = Promise.resolve(e4.value)).then(l4, c3);
                e4.then(u3, n4);
              }
              e3 = n4, l4(void 0);
            });
            return l3.cancel = Qt(a3 + " - runid: " + i4 + " - cancel", function() {
              try {
                s3 && An(s3);
                var t5 = r3.return(void 0), n4 = Promise.resolve(t5.value);
                n4.then(w, w), An(n4), e3(new bn());
              } catch (t6) {
                e3(t6);
              }
            }), l3;
          };
          return i3.isMobXFlow = true, i3;
        }, vn);
        function An(e2) {
          v(e2.cancel) && e2.cancel();
        }
        function En(e2) {
          return e2;
        }
        function In(e2) {
          return true === (e2 == null ? void 0 : e2.isMobXFlow);
        }
        function Sn(e2, t3, n3) {
          var a3;
          if (Ra(e2) || Aa(e2) || Xe(e2)) a3 = Qa(e2);
          else {
            if (!ja(e2))
              return o2("Expected observable map, object or array as first array");
            if (!k(t3))
              return o2(
                "InterceptReads can only be used with a specific property, not with an object in general"
              );
            a3 = Qa(e2, t3);
          }
          return void 0 !== a3.dehancer ? o2("An intercept reader was already established") : (a3.dehancer = typeof t3 == "function" ? t3 : n3, function() {
            a3.dehancer = void 0;
          });
        }
        function xn(e2, t3, n3) {
          return v(n3) ? function(e3, t4, n4) {
            return Qa(e3, t4).intercept_(n4);
          }(e2, t3, n3) : function(e3, t4) {
            return Qa(e3).intercept_(t4);
          }(e2, t3);
        }
        function Cn(e2, t3) {
          if (void 0 !== t3) {
            if (false === ja(e2)) return false;
            if (!e2[Y].values_.has(t3)) return false;
            var n3 = Ja(e2, t3);
            return nt(n3);
          }
          return nt(e2);
        }
        function On(e2) {
          return arguments.length > 1 ? o2(
            "isComputed expects only 1 argument. Use isComputedProp to inspect the observability of a property"
          ) : Cn(e2);
        }
        function Rn(e2, t3) {
          return k(t3) ? Cn(e2, t3) : o2("isComputed expected a property name as second argument");
        }
        function _n(e2, t3) {
          return !!e2 && (void 0 !== t3 ? Ra(e2) || Aa(e2) ? o2(
            "isObservable(object, propertyName) is not supported for arrays and maps. Use map.has or array.length instead."
          ) : !!ja(e2) && e2[Y].values_.has(t3) : ja(e2) || !!e2[Y] || z(e2) || $t(e2) || nt(e2));
        }
        function Pn(e2) {
          return arguments.length !== 1 && o2(
            "isObservable expects only 1 argument. Use isObservableProp to inspect the observability of a property"
          ), _n(e2);
        }
        function Nn(e2, t3) {
          return k(t3) ? _n(e2, t3) : o2("expected a property name as second argument");
        }
        function Dn(e2) {
          return ja(e2) ? e2[Y].keys_() : Ra(e2) || Na(e2) ? Array.from(e2.keys()) : Aa(e2) ? e2.map(function(e3, t3) {
            return t3;
          }) : void o2(5);
        }
        function Ln(e2) {
          return ja(e2) ? Dn(e2).map(function(t3) {
            return e2[t3];
          }) : Ra(e2) ? Dn(e2).map(function(t3) {
            return e2.get(t3);
          }) : Na(e2) ? Array.from(e2.values()) : Aa(e2) ? e2.slice() : void o2(6);
        }
        function Mn(e2) {
          return ja(e2) ? Dn(e2).map(function(t3) {
            return [t3, e2[t3]];
          }) : Ra(e2) ? Dn(e2).map(function(t3) {
            return [t3, e2.get(t3)];
          }) : Na(e2) ? Array.from(e2.entries()) : Aa(e2) ? e2.map(function(e3, t3) {
            return [t3, e3];
          }) : void o2(7);
        }
        function $n(e2, t3, n3) {
          if (arguments.length !== 2 || Na(e2))
            ja(e2) ? e2[Y].set_(t3, n3) : Ra(e2) ? e2.set(t3, n3) : Na(e2) ? e2.add(t3) : Aa(e2) ? (typeof t3 != "number" && (t3 = parseInt(t3, 10)), t3 < 0 && o2("Invalid index: '" + t3 + "'"), St(), t3 >= e2.length && (e2.length = t3 + 1), e2[t3] = n3, xt()) : o2(8);
          else {
            St();
            var a3 = t3;
            try {
              for (var i3 in a3) $n(e2, i3, a3[i3]);
            } finally {
              xt();
            }
          }
        }
        function Un(e2, t3) {
          ja(e2) ? e2[Y].delete_(t3) : Ra(e2) || Na(e2) ? e2.delete(t3) : Aa(e2) ? (typeof t3 != "number" && (t3 = parseInt(t3, 10)), e2.splice(t3, 1)) : o2(9);
        }
        function Fn(e2, t3) {
          return ja(e2) ? e2[Y].has_(t3) : Ra(e2) || Na(e2) ? e2.has(t3) : Aa(e2) ? t3 >= 0 && t3 < e2.length : void o2(10);
        }
        function jn(e2, t3) {
          if (Fn(e2, t3))
            return ja(e2) ? e2[Y].get_(t3) : Ra(e2) ? e2.get(t3) : Aa(e2) ? e2[t3] : void o2(11);
        }
        function Hn(e2, t3, n3) {
          if (ja(e2)) return e2[Y].defineProperty_(t3, n3);
          o2(39);
        }
        function qn(e2) {
          if (ja(e2)) return e2[Y].ownKeys_();
          o2(38);
        }
        function Wn(e2, t3, n3, a3) {
          return v(n3) ? function(e3, t4, n4, a4) {
            return Qa(e3, t4).observe_(n4, a4);
          }(e2, t3, n3, a3) : function(e3, t4, n4) {
            return Qa(e3).observe_(t4, n4);
          }(e2, t3, n3);
        }
        function Gn(e2, t3, n3) {
          return e2.set(t3, n3), n3;
        }
        function Bn(e2, t3) {
          if (e2 == null || typeof e2 != "object" || e2 instanceof Date || !Pn(e2))
            return e2;
          if (Xe(e2) || nt(e2)) return Bn(e2.get(), t3);
          if (t3.has(e2)) return t3.get(e2);
          if (Aa(e2)) {
            var n3 = Gn(t3, e2, new Array(e2.length));
            return e2.forEach(function(e3, a4) {
              n3[a4] = Bn(e3, t3);
            }), n3;
          }
          if (Na(e2)) {
            var a3 = Gn(t3, e2, /* @__PURE__ */ new Set());
            return e2.forEach(function(e3) {
              a3.add(Bn(e3, t3));
            }), a3;
          }
          if (Ra(e2)) {
            var o3 = Gn(t3, e2, /* @__PURE__ */ new Map());
            return e2.forEach(function(e3, n4) {
              o3.set(n4, Bn(e3, t3));
            }), o3;
          }
          var i3 = Gn(t3, e2, {});
          return qn(e2).forEach(function(n4) {
            u2.propertyIsEnumerable.call(e2, n4) && (i3[n4] = Bn(e2[n4], t3));
          }), i3;
        }
        function Yn(e2, t3) {
          return t3 && o2("toJS no longer supports options"), Bn(e2, /* @__PURE__ */ new Map());
        }
        function Kn() {
          for (var e2 = false, t3 = arguments.length, n3 = new Array(t3), a3 = 0; a3 < t3; a3++)
            n3[a3] = arguments[a3];
          typeof n3[n3.length - 1] == "boolean" && (e2 = n3.pop());
          var i3 = zn(n3);
          if (!i3)
            return o2(
              "'trace(break?)' can only be used inside a tracked computed value or a Reaction. Consider passing in the computed value or reaction explicitly"
            );
          i3.isTracing_ === Ze.NONE && console.log("[mobx.trace] '" + i3.name_ + "' tracing enabled"), i3.isTracing_ = e2 ? Ze.BREAK : Ze.LOG;
        }
        function zn(e2) {
          switch (e2.length) {
            case 0:
              return vt.trackingDerivation;
            case 1:
              return Ja(e2[0]);
            case 2:
              return Ja(e2[0], e2[1]);
          }
        }
        function Vn(e2, t3) {
          void 0 === t3 && (t3 = void 0), St();
          try {
            return e2.apply(t3);
          } finally {
            xt();
          }
        }
        function Xn(e2, t3, n3) {
          return arguments.length === 1 || t3 && typeof t3 == "object" ? Qn(e2, t3) : Jn(e2, t3, n3 || {});
        }
        function Jn(e2, t3, n3) {
          var a3;
          if (typeof n3.timeout == "number") {
            var o3 = new Error("WHEN_TIMEOUT");
            a3 = setTimeout(function() {
              if (!r3[Y].isDisposed_) {
                if (r3(), !n3.onError) throw o3;
                n3.onError(o3);
              }
            }, n3.timeout);
          }
          n3.name = n3.name || "When@" + y();
          var i3 = He(n3.name + "-effect", t3), r3 = nn(function(t4) {
            Be(false, e2) && (t4.dispose(), a3 && clearTimeout(a3), i3());
          }, n3);
          return r3;
        }
        function Qn(e2, t3) {
          if (t3 && t3.onError)
            return o2("the options 'onError' and 'promise' cannot be combined");
          var n3, a3 = new Promise(function(a4, o3) {
            var i3 = Jn(e2, a4, U({}, t3, { onError: o3 }));
            n3 = function() {
              i3(), o3("WHEN_CANCELLED");
            };
          });
          return a3.cancel = n3, a3;
        }
        function Zn(e2) {
          return e2[Y];
        }
        Tn.bound = G(kn);
        var ea = {
          has: function(e2, t3) {
            return vt.trackingDerivation && f(
              "detect new properties using the 'in' operator. Use 'has' from 'mobx' instead."
            ), Zn(e2).has_(t3);
          },
          get: function(e2, t3) {
            return Zn(e2).get_(t3);
          },
          set: function(e2, t3, n3) {
            var a3;
            return !!k(t3) && (Zn(e2).values_.has(t3) || f(
              "add a new observable property through direct assignment. Use 'set' from 'mobx' instead."
            ), (a3 = Zn(e2).set_(t3, n3, true)) == null || a3);
          },
          deleteProperty: function(e2, t3) {
            var n3;
            return f(
              "delete properties from an observable object. Use 'remove' from 'mobx' instead."
            ), !!k(t3) && ((n3 = Zn(e2).delete_(t3, true)) == null || n3);
          },
          defineProperty: function(e2, t3, n3) {
            var a3;
            return f(
              "define property on an observable object. Use 'defineProperty' from 'mobx' instead."
            ), (a3 = Zn(e2).defineProperty_(t3, n3)) == null || a3;
          },
          ownKeys: function(e2) {
            return vt.trackingDerivation && f(
              "iterate keys to detect added / removed properties. Use 'keys' from 'mobx' instead."
            ), Zn(e2).ownKeys_();
          },
          preventExtensions: function(e2) {
            o2(13);
          }
        };
        function ta(e2) {
          return void 0 !== e2.interceptors_ && e2.interceptors_.length > 0;
        }
        function na(e2, t3) {
          var n3 = e2.interceptors_ || (e2.interceptors_ = []);
          return n3.push(t3), b(function() {
            var e3 = n3.indexOf(t3);
            -1 !== e3 && n3.splice(e3, 1);
          });
        }
        function aa(e2, t3) {
          var n3 = pt();
          try {
            for (var a3 = [].concat(e2.interceptors_ || []), i3 = 0, r3 = a3.length; i3 < r3 && ((t3 = a3[i3](t3)) && !t3.type && o2(14), t3); i3++) ;
            return t3;
          } finally {
            dt(n3);
          }
        }
        function oa(e2) {
          return void 0 !== e2.changeListeners_ && e2.changeListeners_.length > 0;
        }
        function ia(e2, t3) {
          var n3 = e2.changeListeners_ || (e2.changeListeners_ = []);
          return n3.push(t3), b(function() {
            var e3 = n3.indexOf(t3);
            -1 !== e3 && n3.splice(e3, 1);
          });
        }
        function ra(e2, t3) {
          var n3 = pt(), a3 = e2.changeListeners_;
          if (a3) {
            for (var o3 = 0, i3 = (a3 = a3.slice()).length; o3 < i3; o3++) a3[o3](t3);
            dt(n3);
          }
        }
        function sa(e2, t3, n3) {
          var a3 = $a(e2, n3)[Y];
          St();
          try {
            t3 != null || (t3 = function(e3) {
              return D(e3, W) || (e3[W] || o2(
                "No annotations were passed to makeObservable, but no decorated members have been found either"
              ), I(e3, W, U({}, e3[W]))), e3[W];
            }(e2)), _(t3).forEach(function(e3) {
              return a3.make_(e3, t3[e3]);
            });
          } finally {
            xt();
          }
          return e2;
        }
        var la = Symbol("mobx-keys");
        function ca(e2, t3, n3) {
          if (A(e2) || A(Object.getPrototypeOf(e2)) || o2(
            "'makeAutoObservable' can only be used for classes that don't have a superclass"
          ), ja(e2) && o2(
            "makeAutoObservable can only be used on objects not already made observable"
          ), A(e2))
            return dn(e2, e2, t3, n3);
          var a3 = $a(e2, n3)[Y];
          if (!e2[la]) {
            var i3 = Object.getPrototypeOf(e2), r3 = new Set([].concat(_(e2), _(i3)));
            r3.delete("constructor"), r3.delete(Y), I(i3, la, r3);
          }
          St();
          try {
            e2[la].forEach(function(e3) {
              return a3.make_(e3, !t3 || !(e3 in t3) || t3[e3]);
            });
          } finally {
            xt();
          }
          return e2;
        }
        var pa = "update", da = {
          get: function(e2, t3) {
            var n3 = e2[Y];
            return t3 === Y ? n3 : t3 === "length" ? n3.getArrayLength_() : typeof t3 != "string" || isNaN(t3) ? D(ga, t3) ? ga[t3] : e2[t3] : n3.get_(parseInt(t3));
          },
          set: function(e2, t3, n3) {
            var a3 = e2[Y];
            return t3 === "length" && a3.setArrayLength_(n3), typeof t3 == "symbol" || isNaN(t3) ? e2[t3] = n3 : a3.set_(parseInt(t3), n3), true;
          },
          preventExtensions: function() {
            o2(15);
          }
        }, ma = function() {
          function e2(e3, t4, n3, a3) {
            void 0 === e3 && (e3 = "ObservableArray@" + y()), this.owned_ = void 0, this.legacyMode_ = void 0, this.atom_ = void 0, this.values_ = [], this.interceptors_ = void 0, this.changeListeners_ = void 0, this.enhancer_ = void 0, this.dehancer = void 0, this.proxy_ = void 0, this.lastKnownLength_ = 0, this.owned_ = n3, this.legacyMode_ = a3, this.atom_ = new K(e3), this.enhancer_ = function(n4, a4) {
              return t4(n4, a4, e3 + "[..]");
            };
          }
          var t3 = e2.prototype;
          return t3.dehanceValue_ = function(e3) {
            return void 0 !== this.dehancer ? this.dehancer(e3) : e3;
          }, t3.dehanceValues_ = function(e3) {
            return void 0 !== this.dehancer && e3.length > 0 ? e3.map(this.dehancer) : e3;
          }, t3.intercept_ = function(e3) {
            return na(this, e3);
          }, t3.observe_ = function(e3, t4) {
            return void 0 === t4 && (t4 = false), t4 && e3({
              observableKind: "array",
              object: this.proxy_,
              debugObjectName: this.atom_.name_,
              type: "splice",
              index: 0,
              added: this.values_.slice(),
              addedCount: this.values_.length,
              removed: [],
              removedCount: 0
            }), ia(this, e3);
          }, t3.getArrayLength_ = function() {
            return this.atom_.reportObserved(), this.values_.length;
          }, t3.setArrayLength_ = function(e3) {
            (typeof e3 != "number" || e3 < 0) && o2("Out of range: " + e3);
            var t4 = this.values_.length;
            if (e3 !== t4)
              if (e3 > t4) {
                for (var n3 = new Array(e3 - t4), a3 = 0; a3 < e3 - t4; a3++)
                  n3[a3] = void 0;
                this.spliceWithArray_(t4, 0, n3);
              } else this.spliceWithArray_(e3, t4 - e3);
          }, t3.updateArrayLength_ = function(e3, t4) {
            e3 !== this.lastKnownLength_ && o2(16), this.lastKnownLength_ += t4, this.legacyMode_ && t4 > 0 && Va(e3 + t4 + 1);
          }, t3.spliceWithArray_ = function(e3, t4, n3) {
            var a3 = this;
            st(this.atom_);
            var o3 = this.values_.length;
            if (void 0 === e3 ? e3 = 0 : e3 > o3 ? e3 = o3 : e3 < 0 && (e3 = Math.max(0, o3 + e3)), t4 = arguments.length === 1 ? o3 - e3 : t4 == null ? 0 : Math.max(0, Math.min(t4, o3 - e3)), void 0 === n3 && (n3 = p2), ta(this)) {
              var i3 = aa(this, {
                object: this.proxy_,
                type: "splice",
                index: e3,
                removedCount: t4,
                added: n3
              });
              if (!i3) return p2;
              t4 = i3.removedCount, n3 = i3.added;
            }
            n3 = n3.length === 0 ? n3 : n3.map(function(e4) {
              return a3.enhancer_(e4, void 0);
            }), this.legacyMode_;
            var r3 = n3.length - t4;
            this.updateArrayLength_(o3, r3);
            var s3 = this.spliceItemsIntoValues_(e3, t4, n3);
            return t4 === 0 && n3.length === 0 || this.notifyArraySplice_(e3, n3, s3), this.dehanceValues_(s3);
          }, t3.spliceItemsIntoValues_ = function(e3, t4, n3) {
            var a3;
            if (n3.length < 1e4)
              return (a3 = this.values_).splice.apply(a3, [e3, t4].concat(n3));
            var o3 = this.values_.slice(e3, e3 + t4), i3 = this.values_.slice(e3 + t4);
            this.values_.length = e3 + n3.length - t4;
            for (var r3 = 0; r3 < n3.length; r3++) this.values_[e3 + r3] = n3[r3];
            for (var s3 = 0; s3 < i3.length; s3++)
              this.values_[e3 + n3.length + s3] = i3[s3];
            return o3;
          }, t3.notifyArrayChildUpdate_ = function(e3, t4, n3) {
            var a3 = !this.owned_ && Ut(), o3 = oa(this), i3 = o3 || a3 ? {
              observableKind: "array",
              object: this.proxy_,
              type: "update",
              debugObjectName: this.atom_.name_,
              index: e3,
              newValue: t4,
              oldValue: n3
            } : null;
            a3 && jt(i3), this.atom_.reportChanged(), o3 && ra(this, i3), a3 && qt();
          }, t3.notifyArraySplice_ = function(e3, t4, n3) {
            var a3 = !this.owned_ && Ut(), o3 = oa(this), i3 = o3 || a3 ? {
              observableKind: "array",
              object: this.proxy_,
              debugObjectName: this.atom_.name_,
              type: "splice",
              index: e3,
              removed: n3,
              added: t4,
              removedCount: n3.length,
              addedCount: t4.length
            } : null;
            a3 && jt(i3), this.atom_.reportChanged(), o3 && ra(this, i3), a3 && qt();
          }, t3.get_ = function(e3) {
            if (e3 < this.values_.length)
              return this.atom_.reportObserved(), this.dehanceValue_(this.values_[e3]);
            console.warn("[mobx] Out of bounds read: " + e3);
          }, t3.set_ = function(e3, t4) {
            var n3 = this.values_;
            if (e3 < n3.length) {
              st(this.atom_);
              var a3 = n3[e3];
              if (ta(this)) {
                var i3 = aa(this, {
                  type: "update",
                  object: this.proxy_,
                  index: e3,
                  newValue: t4
                });
                if (!i3) return;
                t4 = i3.newValue;
              }
              (t4 = this.enhancer_(t4, a3)) !== a3 && (n3[e3] = t4, this.notifyArrayChildUpdate_(e3, t4, a3));
            } else
              e3 === n3.length ? this.spliceWithArray_(e3, 0, [t4]) : o2(17, e3, n3.length);
          }, e2;
        }();
        function ha(e2, t3, n3, a3) {
          void 0 === n3 && (n3 = "ObservableArray@" + y()), void 0 === a3 && (a3 = false), g();
          var o3 = new ma(n3, t3, a3, false);
          S(o3.values_, Y, o3);
          var i3 = new Proxy(o3.values_, da);
          if (o3.proxy_ = i3, e2 && e2.length) {
            var r3 = Ye(true);
            o3.spliceWithArray_(0, 0, e2), Ke(r3);
          }
          return i3;
        }
        var ga = {
          clear: function() {
            return this.splice(0);
          },
          replace: function(e2) {
            var t3 = this[Y];
            return t3.spliceWithArray_(0, t3.values_.length, e2);
          },
          toJSON: function() {
            return this.slice();
          },
          splice: function(e2, t3) {
            for (var n3 = arguments.length, a3 = new Array(n3 > 2 ? n3 - 2 : 0), o3 = 2; o3 < n3; o3++)
              a3[o3 - 2] = arguments[o3];
            var i3 = this[Y];
            switch (arguments.length) {
              case 0:
                return [];
              case 1:
                return i3.spliceWithArray_(e2);
              case 2:
                return i3.spliceWithArray_(e2, t3);
            }
            return i3.spliceWithArray_(e2, t3, a3);
          },
          spliceWithArray: function(e2, t3, n3) {
            return this[Y].spliceWithArray_(e2, t3, n3);
          },
          push: function() {
            for (var e2 = this[Y], t3 = arguments.length, n3 = new Array(t3), a3 = 0; a3 < t3; a3++)
              n3[a3] = arguments[a3];
            return e2.spliceWithArray_(e2.values_.length, 0, n3), e2.values_.length;
          },
          pop: function() {
            return this.splice(Math.max(this[Y].values_.length - 1, 0), 1)[0];
          },
          shift: function() {
            return this.splice(0, 1)[0];
          },
          unshift: function() {
            for (var e2 = this[Y], t3 = arguments.length, n3 = new Array(t3), a3 = 0; a3 < t3; a3++)
              n3[a3] = arguments[a3];
            return e2.spliceWithArray_(0, 0, n3), e2.values_.length;
          },
          reverse: function() {
            return vt.trackingDerivation && o2(37, "reverse"), this.replace(this.slice().reverse()), this;
          },
          sort: function() {
            vt.trackingDerivation && o2(37, "sort");
            var e2 = this.slice();
            return e2.sort.apply(e2, arguments), this.replace(e2), this;
          },
          remove: function(e2) {
            var t3 = this[Y], n3 = t3.dehanceValues_(t3.values_).indexOf(e2);
            return n3 > -1 && (this.splice(n3, 1), true);
          }
        };
        function fa(e2, t3) {
          typeof Array.prototype[e2] == "function" && (ga[e2] = t3(e2));
        }
        function ya(e2) {
          return function() {
            var t3 = this[Y];
            t3.atom_.reportObserved();
            var n3 = t3.dehanceValues_(t3.values_);
            return n3[e2].apply(n3, arguments);
          };
        }
        function ba(e2) {
          return function(t3, n3) {
            var a3 = this, o3 = this[Y];
            return o3.atom_.reportObserved(), o3.dehanceValues_(o3.values_)[e2](function(e3, o4) {
              return t3.call(n3, e3, o4, a3);
            });
          };
        }
        function wa(e2) {
          return function() {
            var t3 = this, n3 = this[Y];
            n3.atom_.reportObserved();
            var a3 = n3.dehanceValues_(n3.values_), o3 = arguments[0];
            return arguments[0] = function(e3, n4, a4) {
              return o3(e3, n4, a4, t3);
            }, a3[e2].apply(a3, arguments);
          };
        }
        fa("concat", ya), fa("flat", ya), fa("includes", ya), fa("indexOf", ya), fa("join", ya), fa("lastIndexOf", ya), fa("slice", ya), fa("toString", ya), fa("toLocaleString", ya), fa("every", ba), fa("filter", ba), fa("find", ba), fa("findIndex", ba), fa("flatMap", ba), fa("forEach", ba), fa("map", ba), fa("some", ba), fa("reduce", wa), fa("reduceRight", wa);
        var va, ka, Ta = x("ObservableArrayAdministration", ma);
        function Aa(e2) {
          return T(e2) && Ta(e2[Y]);
        }
        var Ea = {};
        va = Symbol.iterator, ka = Symbol.toStringTag;
        var xa, Ca, Oa = function() {
          function e2(e3, t4, n3) {
            void 0 === t4 && (t4 = J), void 0 === n3 && (n3 = "ObservableMap@" + y()), this.enhancer_ = void 0, this.name_ = void 0, this[Y] = Ea, this.data_ = void 0, this.hasMap_ = void 0, this.keysAtom_ = void 0, this.interceptors_ = void 0, this.changeListeners_ = void 0, this.dehancer = void 0, this.enhancer_ = t4, this.name_ = n3, v(Map) || o2(18), this.keysAtom_ = V(this.name_ + ".keys()"), this.data_ = /* @__PURE__ */ new Map(), this.hasMap_ = /* @__PURE__ */ new Map(), this.merge(e3);
          }
          var t3 = e2.prototype;
          return t3.has_ = function(e3) {
            return this.data_.has(e3);
          }, t3.has = function(e3) {
            var t4 = this;
            if (!vt.trackingDerivation) return this.has_(e3);
            var n3 = this.hasMap_.get(e3);
            if (!n3) {
              var a3 = n3 = new Ve(
                this.has_(e3),
                Q,
                this.name_ + "." + P(e3) + "?",
                false
              );
              this.hasMap_.set(e3, a3), ln(a3, function() {
                return t4.hasMap_.delete(e3);
              });
            }
            return n3.get();
          }, t3.set = function(e3, t4) {
            var n3 = this.has_(e3);
            if (ta(this)) {
              var a3 = aa(this, {
                type: n3 ? "update" : "add",
                object: this,
                newValue: t4,
                name: e3
              });
              if (!a3) return this;
              t4 = a3.newValue;
            }
            return n3 ? this.updateValue_(e3, t4) : this.addValue_(e3, t4), this;
          }, t3.delete = function(e3) {
            var t4 = this;
            if (st(this.keysAtom_), ta(this) && !aa(this, { type: "delete", object: this, name: e3 }))
              return false;
            if (this.has_(e3)) {
              var n3 = Ut(), a3 = oa(this), o3 = a3 || n3 ? {
                observableKind: "map",
                debugObjectName: this.name_,
                type: "delete",
                object: this,
                oldValue: this.data_.get(e3).value_,
                name: e3
              } : null;
              return n3 && jt(o3), Vn(function() {
                t4.keysAtom_.reportChanged(), t4.updateHasMapEntry_(e3, false), t4.data_.get(e3).setNewValue_(void 0), t4.data_.delete(e3);
              }), a3 && ra(this, o3), n3 && qt(), true;
            }
            return false;
          }, t3.updateHasMapEntry_ = function(e3, t4) {
            var n3 = this.hasMap_.get(e3);
            n3 && n3.setNewValue_(t4);
          }, t3.updateValue_ = function(e3, t4) {
            var n3 = this.data_.get(e3);
            if ((t4 = n3.prepareNewValue_(t4)) !== vt.UNCHANGED) {
              var a3 = Ut(), o3 = oa(this), i3 = o3 || a3 ? {
                observableKind: "map",
                debugObjectName: this.name_,
                type: "update",
                object: this,
                oldValue: n3.value_,
                name: e3,
                newValue: t4
              } : null;
              a3 && jt(i3), n3.setNewValue_(t4), o3 && ra(this, i3), a3 && qt();
            }
          }, t3.addValue_ = function(e3, t4) {
            var n3 = this;
            st(this.keysAtom_), Vn(function() {
              var a4 = new Ve(t4, n3.enhancer_, n3.name_ + "." + P(e3), false);
              n3.data_.set(e3, a4), t4 = a4.value_, n3.updateHasMapEntry_(e3, true), n3.keysAtom_.reportChanged();
            });
            var a3 = Ut(), o3 = oa(this), i3 = o3 || a3 ? {
              observableKind: "map",
              debugObjectName: this.name_,
              type: "add",
              object: this,
              name: e3,
              newValue: t4
            } : null;
            a3 && jt(i3), o3 && ra(this, i3), a3 && qt();
          }, t3.get = function(e3) {
            return this.has(e3) ? this.dehanceValue_(this.data_.get(e3).get()) : this.dehanceValue_(void 0);
          }, t3.dehanceValue_ = function(e3) {
            return void 0 !== this.dehancer ? this.dehancer(e3) : e3;
          }, t3.keys = function() {
            return this.keysAtom_.reportObserved(), this.data_.keys();
          }, t3.values = function() {
            var e3 = this, t4 = this.keys();
            return oo({
              next: function() {
                var n3 = t4.next(), a3 = n3.done, o3 = n3.value;
                return { done: a3, value: a3 ? void 0 : e3.get(o3) };
              }
            });
          }, t3.entries = function() {
            var e3 = this, t4 = this.keys();
            return oo({
              next: function() {
                var n3 = t4.next(), a3 = n3.done, o3 = n3.value;
                return { done: a3, value: a3 ? void 0 : [o3, e3.get(o3)] };
              }
            });
          }, t3[va] = function() {
            return this.entries();
          }, t3.forEach = function(e3, t4) {
            for (var n3, a3 = q(this); !(n3 = a3()).done; ) {
              var o3 = n3.value, i3 = o3[0], r3 = o3[1];
              e3.call(t4, r3, i3, this);
            }
          }, t3.merge = function(e3) {
            var t4 = this;
            return Ra(e3) && (e3 = new Map(e3)), Vn(function() {
              A(e3) ? function(e4) {
                var t5 = Object.keys(e4);
                if (!R) return t5;
                var n3 = Object.getOwnPropertySymbols(e4);
                return n3.length ? [].concat(
                  t5,
                  n3.filter(function(t6) {
                    return u2.propertyIsEnumerable.call(e4, t6);
                  })
                ) : t5;
              }(e3).forEach(function(n3) {
                return t4.set(n3, e3[n3]);
              }) : Array.isArray(e3) ? e3.forEach(function(e4) {
                var n3 = e4[0], a3 = e4[1];
                return t4.set(n3, a3);
              }) : C(e3) ? (e3.constructor !== Map && o2(19, e3), e3.forEach(function(e4, n3) {
                return t4.set(n3, e4);
              })) : e3 != null && o2(20, e3);
            }), this;
          }, t3.clear = function() {
            var e3 = this;
            Vn(function() {
              ut(function() {
                for (var t4, n3 = q(e3.keys()); !(t4 = n3()).done; ) {
                  var a3 = t4.value;
                  e3.delete(a3);
                }
              });
            });
          }, t3.replace = function(e3) {
            var t4 = this;
            return Vn(function() {
              for (var n3, a3 = function(e4) {
                if (C(e4) || Ra(e4)) return e4;
                if (Array.isArray(e4)) return new Map(e4);
                if (A(e4)) {
                  var t5 = /* @__PURE__ */ new Map();
                  for (var n4 in e4) t5.set(n4, e4[n4]);
                  return t5;
                }
                return o2(21, e4);
              }(e3), i3 = /* @__PURE__ */ new Map(), r3 = false, s3 = q(t4.data_.keys()); !(n3 = s3()).done; ) {
                var l3 = n3.value;
                if (!a3.has(l3))
                  if (t4.delete(l3)) r3 = true;
                  else {
                    var c3 = t4.data_.get(l3);
                    i3.set(l3, c3);
                  }
              }
              for (var u3, p3 = q(a3.entries()); !(u3 = p3()).done; ) {
                var d3 = u3.value, m3 = d3[0], h2 = d3[1], g2 = t4.data_.has(m3);
                if (t4.set(m3, h2), t4.data_.has(m3)) {
                  var f2 = t4.data_.get(m3);
                  i3.set(m3, f2), g2 || (r3 = true);
                }
              }
              if (!r3)
                if (t4.data_.size !== i3.size) t4.keysAtom_.reportChanged();
                else
                  for (var y2 = t4.data_.keys(), b2 = i3.keys(), w2 = y2.next(), v2 = b2.next(); !w2.done; ) {
                    if (w2.value !== v2.value) {
                      t4.keysAtom_.reportChanged();
                      break;
                    }
                    w2 = y2.next(), v2 = b2.next();
                  }
              t4.data_ = i3;
            }), this;
          }, t3.toString = function() {
            return "[object ObservableMap]";
          }, t3.toJSON = function() {
            return Array.from(this);
          }, t3.observe_ = function(e3, t4) {
            return true === t4 && o2(
              "`observe` doesn't support fireImmediately=true in combination with maps."
            ), ia(this, e3);
          }, t3.intercept_ = function(e3) {
            return na(this, e3);
          }, $(e2, [
            {
              key: "size",
              get: function() {
                return this.keysAtom_.reportObserved(), this.data_.size;
              }
            },
            {
              key: ka,
              get: function() {
                return "Map";
              }
            }
          ]), e2;
        }(), Ra = x("ObservableMap", Oa), _a = {};
        xa = Symbol.iterator, Ca = Symbol.toStringTag;
        var Pa = function() {
          function e2(e3, t4, n3) {
            void 0 === t4 && (t4 = J), void 0 === n3 && (n3 = "ObservableSet@" + y()), this.name_ = void 0, this[Y] = _a, this.data_ = /* @__PURE__ */ new Set(), this.atom_ = void 0, this.changeListeners_ = void 0, this.interceptors_ = void 0, this.dehancer = void 0, this.enhancer_ = void 0, this.name_ = n3, v(Set) || o2(22), this.atom_ = V(this.name_), this.enhancer_ = function(e4, a3) {
              return t4(e4, a3, n3);
            }, e3 && this.replace(e3);
          }
          var t3 = e2.prototype;
          return t3.dehanceValue_ = function(e3) {
            return void 0 !== this.dehancer ? this.dehancer(e3) : e3;
          }, t3.clear = function() {
            var e3 = this;
            Vn(function() {
              ut(function() {
                for (var t4, n3 = q(e3.data_.values()); !(t4 = n3()).done; ) {
                  var a3 = t4.value;
                  e3.delete(a3);
                }
              });
            });
          }, t3.forEach = function(e3, t4) {
            for (var n3, a3 = q(this); !(n3 = a3()).done; ) {
              var o3 = n3.value;
              e3.call(t4, o3, o3, this);
            }
          }, t3.add = function(e3) {
            var t4 = this;
            if (st(this.atom_), ta(this) && !aa(this, { type: "add", object: this, newValue: e3 }))
              return this;
            if (!this.has(e3)) {
              Vn(function() {
                t4.data_.add(t4.enhancer_(e3, void 0)), t4.atom_.reportChanged();
              });
              var n3 = Ut(), a3 = oa(this), o3 = a3 || n3 ? {
                observableKind: "set",
                debugObjectName: this.name_,
                type: "add",
                object: this,
                newValue: e3
              } : null;
              n3 && jt(o3), a3 && ra(this, o3), n3 && qt();
            }
            return this;
          }, t3.delete = function(e3) {
            var t4 = this;
            if (ta(this) && !aa(this, { type: "delete", object: this, oldValue: e3 }))
              return false;
            if (this.has(e3)) {
              var n3 = Ut(), a3 = oa(this), o3 = a3 || n3 ? {
                observableKind: "set",
                debugObjectName: this.name_,
                type: "delete",
                object: this,
                oldValue: e3
              } : null;
              return n3 && jt(o3), Vn(function() {
                t4.atom_.reportChanged(), t4.data_.delete(e3);
              }), a3 && ra(this, o3), n3 && qt(), true;
            }
            return false;
          }, t3.has = function(e3) {
            return this.atom_.reportObserved(), this.data_.has(this.dehanceValue_(e3));
          }, t3.entries = function() {
            var e3 = 0, t4 = Array.from(this.keys()), n3 = Array.from(this.values());
            return oo({
              next: function() {
                var a3 = e3;
                return e3 += 1, a3 < n3.length ? { value: [t4[a3], n3[a3]], done: false } : { done: true };
              }
            });
          }, t3.keys = function() {
            return this.values();
          }, t3.values = function() {
            this.atom_.reportObserved();
            var e3 = this, t4 = 0, n3 = Array.from(this.data_.values());
            return oo({
              next: function() {
                return t4 < n3.length ? { value: e3.dehanceValue_(n3[t4++]), done: false } : { done: true };
              }
            });
          }, t3.replace = function(e3) {
            var t4 = this;
            return Na(e3) && (e3 = new Set(e3)), Vn(function() {
              Array.isArray(e3) || O(e3) ? (t4.clear(), e3.forEach(function(e4) {
                return t4.add(e4);
              })) : e3 != null && o2("Cannot initialize set from " + e3);
            }), this;
          }, t3.observe_ = function(e3, t4) {
            return true === t4 && o2(
              "`observe` doesn't support fireImmediately=true in combination with sets."
            ), ia(this, e3);
          }, t3.intercept_ = function(e3) {
            return na(this, e3);
          }, t3.toJSON = function() {
            return Array.from(this);
          }, t3.toString = function() {
            return "[object ObservableSet]";
          }, t3[xa] = function() {
            return this.values();
          }, $(e2, [
            {
              key: "size",
              get: function() {
                return this.atom_.reportObserved(), this.data_.size;
              }
            },
            {
              key: Ca,
              get: function() {
                return "Set";
              }
            }
          ]), e2;
        }(), Na = x("ObservableSet", Pa), Da = /* @__PURE__ */ Object.create(null), Ma = function() {
          function e2(e3, t4, n3, a3) {
            void 0 === t4 && (t4 = /* @__PURE__ */ new Map()), void 0 === a3 && (a3 = fe), this.target_ = void 0, this.values_ = void 0, this.name_ = void 0, this.defaultAnnotation_ = void 0, this.keysAtom_ = void 0, this.changeListeners_ = void 0, this.interceptors_ = void 0, this.proxy_ = void 0, this.isPlainObject_ = void 0, this.appliedAnnotations_ = void 0, this.pendingKeys_ = void 0, this.target_ = e3, this.values_ = t4, this.name_ = n3, this.defaultAnnotation_ = a3, this.keysAtom_ = new K(this.name_ + ".keys"), this.isPlainObject_ = A(this.target_), ro(this.defaultAnnotation_) || o2("defaultAnnotation must be valid annotation"), this.appliedAnnotations_ = {};
          }
          var t3 = e2.prototype;
          return t3.getObservablePropValue_ = function(e3) {
            return this.values_.get(e3).get();
          }, t3.setObservablePropValue_ = function(e3, t4) {
            var n3 = this.values_.get(e3);
            if (n3 instanceof tt) return n3.set(t4), true;
            if (ta(this)) {
              var a3 = aa(this, {
                type: "update",
                object: this.proxy_ || this.target_,
                name: e3,
                newValue: t4
              });
              if (!a3) return null;
              t4 = a3.newValue;
            }
            if ((t4 = n3.prepareNewValue_(t4)) !== vt.UNCHANGED) {
              var o3 = oa(this), i3 = Ut(), r3 = o3 || i3 ? {
                type: "update",
                observableKind: "object",
                debugObjectName: this.name_,
                object: this.proxy_ || this.target_,
                oldValue: n3.value_,
                name: e3,
                newValue: t4
              } : null;
              i3 && jt(r3), n3.setNewValue_(t4), o3 && ra(this, r3), i3 && qt();
            }
            return true;
          }, t3.get_ = function(e3) {
            return vt.trackingDerivation && !D(this.target_, e3) && this.has_(e3), this.target_[e3];
          }, t3.set_ = function(e3, t4, n3) {
            return void 0 === n3 && (n3 = false), D(this.target_, e3) ? this.values_.has(e3) ? this.setObservablePropValue_(e3, t4) : n3 ? Reflect.set(this.target_, e3, t4) : (this.target_[e3] = t4, true) : this.extend_(
              e3,
              {
                value: t4,
                enumerable: true,
                writable: true,
                configurable: true
              },
              this.defaultAnnotation_,
              n3
            );
          }, t3.has_ = function(e3) {
            if (!vt.trackingDerivation) return e3 in this.target_;
            this.pendingKeys_ || (this.pendingKeys_ = /* @__PURE__ */ new Map());
            var t4 = this.pendingKeys_.get(e3);
            return t4 || (t4 = new Ve(
              e3 in this.target_,
              Q,
              this.name_ + "." + P(e3) + "?",
              false
            ), this.pendingKeys_.set(e3, t4)), t4.get();
          }, t3.make_ = function(e3, t4) {
            if (true === t4 && (t4 = this.defaultAnnotation_), false !== t4) {
              if (qa(this, t4, e3), !(e3 in this.target_)) {
                var n3;
                if ((n3 = this.target_[W]) == null ? void 0 : n3[e3]) return;
                o2(1, t4.annotationType_, this.name_ + "." + e3.toString());
              }
              for (var a3 = this.target_; a3 && a3 !== u2; ) {
                var i3 = l2(a3, e3);
                if (i3) {
                  var r3 = t4.make_(this, e3, i3, a3);
                  if (r3 === 0) return;
                  if (r3 === 1) break;
                }
                a3 = Object.getPrototypeOf(a3);
              }
              Ha(this, t4, e3);
            }
          }, t3.extend_ = function(e3, t4, n3, a3) {
            if (void 0 === a3 && (a3 = false), true === n3 && (n3 = this.defaultAnnotation_), false === n3)
              return this.defineProperty_(e3, t4, a3);
            qa(this, n3, e3);
            var o3 = n3.extend_(this, e3, t4, a3);
            return o3 && Ha(this, n3, e3), o3;
          }, t3.defineProperty_ = function(e3, t4, n3) {
            void 0 === n3 && (n3 = false);
            try {
              St();
              var a3 = this.delete_(e3);
              if (!a3) return a3;
              if (ta(this)) {
                var o3 = aa(this, {
                  object: this.proxy_ || this.target_,
                  name: e3,
                  type: "add",
                  newValue: t4.value
                });
                if (!o3) return null;
                var i3 = o3.newValue;
                t4.value !== i3 && (t4 = U({}, t4, { value: i3 }));
              }
              if (n3) {
                if (!Reflect.defineProperty(this.target_, e3, t4)) return false;
              } else c2(this.target_, e3, t4);
              this.notifyPropertyAddition_(e3, t4.value);
            } finally {
              xt();
            }
            return true;
          }, t3.defineObservableProperty_ = function(e3, t4, n3, a3) {
            void 0 === a3 && (a3 = false);
            try {
              St();
              var o3 = this.delete_(e3);
              if (!o3) return o3;
              if (ta(this)) {
                var i3 = aa(this, {
                  object: this.proxy_ || this.target_,
                  name: e3,
                  type: "add",
                  newValue: t4
                });
                if (!i3) return null;
                t4 = i3.newValue;
              }
              var r3 = Fa(e3), s3 = {
                configurable: !vt.safeDescriptors || this.isPlainObject_,
                enumerable: true,
                get: r3.get,
                set: r3.set
              };
              if (a3) {
                if (!Reflect.defineProperty(this.target_, e3, s3)) return false;
              } else c2(this.target_, e3, s3);
              var l3 = new Ve(t4, n3, this.name_ + "." + e3.toString(), false);
              this.values_.set(e3, l3), this.notifyPropertyAddition_(e3, l3.value_);
            } finally {
              xt();
            }
            return true;
          }, t3.defineComputedProperty_ = function(e3, t4, n3) {
            void 0 === n3 && (n3 = false);
            try {
              St();
              var a3 = this.delete_(e3);
              if (!a3) return a3;
              if (ta(this) && !aa(this, {
                object: this.proxy_ || this.target_,
                name: e3,
                type: "add",
                newValue: void 0
              }))
                return null;
              t4.name || (t4.name = this.name_ + "." + e3.toString()), t4.context = this.proxy_ || this.target_;
              var o3 = Fa(e3), i3 = {
                configurable: !vt.safeDescriptors || this.isPlainObject_,
                enumerable: false,
                get: o3.get,
                set: o3.set
              };
              if (n3) {
                if (!Reflect.defineProperty(this.target_, e3, i3)) return false;
              } else c2(this.target_, e3, i3);
              this.values_.set(e3, new tt(t4)), this.notifyPropertyAddition_(e3, void 0);
            } finally {
              xt();
            }
            return true;
          }, t3.delete_ = function(e3, t4) {
            if (void 0 === t4 && (t4 = false), !D(this.target_, e3)) return true;
            if (ta(this) && !aa(this, {
              object: this.proxy_ || this.target_,
              name: e3,
              type: "remove"
            }))
              return null;
            try {
              var n3, a3;
              St();
              var o3, i3 = oa(this), r3 = Ut(), s3 = this.values_.get(e3), c3 = void 0;
              if (s3 || !i3 && !r3 || (c3 = (o3 = l2(this.target_, e3)) == null ? void 0 : o3.value), t4) {
                if (!Reflect.deleteProperty(this.target_, e3)) return false;
              } else delete this.target_[e3];
              if (delete this.appliedAnnotations_[e3], s3 && (this.values_.delete(e3), s3 instanceof Ve && (c3 = s3.value_), Ot(s3)), this.keysAtom_.reportChanged(), (n3 = this.pendingKeys_) == null || (a3 = n3.get(e3)) == null || a3.set(e3 in this.target_), i3 || r3) {
                var u3 = {
                  type: "remove",
                  observableKind: "object",
                  object: this.proxy_ || this.target_,
                  debugObjectName: this.name_,
                  oldValue: c3,
                  name: e3
                };
                r3 && jt(u3), i3 && ra(this, u3), r3 && qt();
              }
            } finally {
              xt();
            }
            return true;
          }, t3.observe_ = function(e3, t4) {
            return true === t4 && o2(
              "`observe` doesn't support the fire immediately property for observable objects."
            ), ia(this, e3);
          }, t3.intercept_ = function(e3) {
            return na(this, e3);
          }, t3.notifyPropertyAddition_ = function(e3, t4) {
            var n3, a3, o3 = oa(this), i3 = Ut();
            if (o3 || i3) {
              var r3 = o3 || i3 ? {
                type: "add",
                observableKind: "object",
                debugObjectName: this.name_,
                object: this.proxy_ || this.target_,
                name: e3,
                newValue: t4
              } : null;
              i3 && jt(r3), o3 && ra(this, r3), i3 && qt();
            }
            (n3 = this.pendingKeys_) == null || (a3 = n3.get(e3)) == null || a3.set(true), this.keysAtom_.reportChanged();
          }, t3.ownKeys_ = function() {
            return this.keysAtom_.reportObserved(), _(this.target_);
          }, t3.keys_ = function() {
            return this.keysAtom_.reportObserved(), Object.keys(this.target_);
          }, e2;
        }();
        function $a(e2, t3) {
          var n3;
          if (t3 && ja(e2) && o2("Options can't be provided for already observable objects."), D(e2, Y))
            return Qa(e2) instanceof Ma || o2(
              "Cannot convert '" + Za(e2) + "' into observable object:\nThe target is already observable of different type.\nExtending builtins is not supported."
            ), e2;
          Object.isExtensible(e2) || o2(
            "Cannot make the designated object observable; it is not extensible"
          );
          var a3 = (n3 = t3 == null ? void 0 : t3.name) != null ? n3 : (A(e2) ? "ObservableObject" : e2.constructor.name) + "@" + y(), i3 = new Ma(
            e2,
            /* @__PURE__ */ new Map(),
            String(a3),
            function(e3) {
              var t4;
              return e3 ? (t4 = e3.defaultDecorator) != null ? t4 : ye(e3) : void 0;
            }(t3)
          );
          return I(e2, Y, i3), e2;
        }
        var Ua = x("ObservableObjectAdministration", Ma);
        function Fa(e2) {
          return Da[e2] || (Da[e2] = {
            get: function() {
              return this[Y].getObservablePropValue_(e2);
            },
            set: function(t3) {
              return this[Y].setObservablePropValue_(e2, t3);
            }
          });
        }
        function ja(e2) {
          return !!T(e2) && Ua(e2[Y]);
        }
        function Ha(e2, t3, n3) {
          var a3;
          e2.appliedAnnotations_[n3] = t3, (a3 = e2.target_[W]) == null || delete a3[n3];
        }
        function qa(e2, t3, n3) {
          if (ro(t3) || o2(
            "Cannot annotate '" + e2.name_ + "." + n3.toString() + "': Invalid annotation."
          ), !te(t3) && D(e2.appliedAnnotations_, n3)) {
            var a3 = e2.name_ + "." + n3.toString(), i3 = e2.appliedAnnotations_[n3].annotationType_;
            o2(
              "Cannot apply '" + t3.annotationType_ + "' to '" + a3 + "':\nThe field is already annotated with '" + i3 + "'.\nRe-annotating fields is not allowed.\nUse 'override' annotation for methods overriden by subclass."
            );
          }
        }
        var Wa, Ga, Ba = 0, Ya = function() {
        };
        Wa = Ya, Ga = Array.prototype, Object.setPrototypeOf ? Object.setPrototypeOf(Wa.prototype, Ga) : void 0 !== Wa.prototype.__proto__ ? Wa.prototype.__proto__ = Ga : Wa.prototype = Ga;
        var Ka = function(e2) {
          function t3(t4, n4, a3, o3) {
            var i3;
            void 0 === a3 && (a3 = "ObservableArray@" + y()), void 0 === o3 && (o3 = false), i3 = e2.call(this) || this;
            var r3 = new ma(a3, n4, o3, true);
            if (r3.proxy_ = j(i3), S(j(i3), Y, r3), t4 && t4.length) {
              var s3 = Ye(true);
              i3.spliceWithArray(0, 0, t4), Ke(s3);
            }
            return i3;
          }
          F(t3, e2);
          var n3 = t3.prototype;
          return n3.concat = function() {
            this[Y].atom_.reportObserved();
            for (var e3 = arguments.length, t4 = new Array(e3), n4 = 0; n4 < e3; n4++)
              t4[n4] = arguments[n4];
            return Array.prototype.concat.apply(
              this.slice(),
              t4.map(function(e4) {
                return Aa(e4) ? e4.slice() : e4;
              })
            );
          }, n3[Symbol.iterator] = function() {
            var e3 = this, t4 = 0;
            return oo({
              next: function() {
                return t4 < e3.length ? { value: e3[t4++], done: false } : { done: true, value: void 0 };
              }
            });
          }, $(t3, [
            {
              key: "length",
              get: function() {
                return this[Y].getArrayLength_();
              },
              set: function(e3) {
                this[Y].setArrayLength_(e3);
              }
            },
            {
              key: Symbol.toStringTag,
              get: function() {
                return "Array";
              }
            }
          ]), t3;
        }(Ya);
        function za(e2) {
          c2(
            Ka.prototype,
            "" + e2,
            /* @__PURE__ */ function(e3) {
              return {
                enumerable: false,
                configurable: true,
                get: function() {
                  return this[Y].get_(e3);
                },
                set: function(t3) {
                  this[Y].set_(e3, t3);
                }
              };
            }(e2)
          );
        }
        function Va(e2) {
          if (e2 > Ba) {
            for (var t3 = Ba; t3 < e2 + 100; t3++) za(t3);
            Ba = e2;
          }
        }
        function Xa(e2, t3, n3) {
          return new Ka(e2, t3, n3);
        }
        function Ja(e2, t3) {
          if (typeof e2 == "object" && e2 !== null) {
            if (Aa(e2)) return void 0 !== t3 && o2(23), e2[Y].atom_;
            if (Na(e2)) return e2[Y];
            if (Ra(e2)) {
              if (void 0 === t3) return e2.keysAtom_;
              var n3 = e2.data_.get(t3) || e2.hasMap_.get(t3);
              return n3 || o2(25, t3, Za(e2)), n3;
            }
            if (ja(e2)) {
              if (!t3) return o2(26);
              var a3 = e2[Y].values_.get(t3);
              return a3 || o2(27, t3, Za(e2)), a3;
            }
            if (z(e2) || nt(e2) || $t(e2)) return e2;
          } else if (v(e2) && $t(e2[Y])) return e2[Y];
          o2(28);
        }
        function Qa(e2, t3) {
          return e2 || o2(29), void 0 !== t3 ? Qa(Ja(e2, t3)) : z(e2) || nt(e2) || $t(e2) || Ra(e2) || Na(e2) ? e2 : e2[Y] ? e2[Y] : void o2(24, e2);
        }
        function Za(e2, t3) {
          var n3;
          if (void 0 !== t3) n3 = Ja(e2, t3);
          else {
            if (tn(e2)) return e2.name;
            n3 = ja(e2) || Ra(e2) || Na(e2) ? Qa(e2) : Ja(e2);
          }
          return n3.name_;
        }
        Object.entries(ga).forEach(function(e2) {
          var t3 = e2[0], n3 = e2[1];
          t3 !== "concat" && I(Ka.prototype, t3, n3);
        }), Va(1e3);
        var eo = u2.toString;
        function to(e2, t3, n3) {
          return void 0 === n3 && (n3 = -1), no(e2, t3, n3);
        }
        function no(e2, t3, n3, a3, o3) {
          if (e2 === t3) return e2 !== 0 || 1 / e2 == 1 / t3;
          if (e2 == null || t3 == null) return false;
          if (e2 != e2) return t3 != t3;
          var i3 = typeof e2;
          if (!v(i3) && i3 !== "object" && typeof t3 != "object") return false;
          var r3 = eo.call(e2);
          if (r3 !== eo.call(t3)) return false;
          switch (r3) {
            case "[object RegExp]":
            case "[object String]":
              return "" + e2 == "" + t3;
            case "[object Number]":
              return +e2 != +e2 ? +t3 != +t3 : +e2 == 0 ? 1 / +e2 == 1 / t3 : +e2 == +t3;
            case "[object Date]":
            case "[object Boolean]":
              return +e2 == +t3;
            case "[object Symbol]":
              return typeof Symbol != "undefined" && Symbol.valueOf.call(e2) === Symbol.valueOf.call(t3);
            case "[object Map]":
            case "[object Set]":
              n3 >= 0 && n3++;
          }
          e2 = ao(e2), t3 = ao(t3);
          var s3 = r3 === "[object Array]";
          if (!s3) {
            if (typeof e2 != "object" || typeof t3 != "object") return false;
            var l3 = e2.constructor, c3 = t3.constructor;
            if (l3 !== c3 && !(v(l3) && l3 instanceof l3 && v(c3) && c3 instanceof c3) && "constructor" in e2 && "constructor" in t3)
              return false;
          }
          if (n3 === 0) return false;
          n3 < 0 && (n3 = -1), o3 = o3 || [];
          for (var u3 = (a3 = a3 || []).length; u3--; )
            if (a3[u3] === e2) return o3[u3] === t3;
          if (a3.push(e2), o3.push(t3), s3) {
            if ((u3 = e2.length) !== t3.length) return false;
            for (; u3--; ) if (!no(e2[u3], t3[u3], n3 - 1, a3, o3)) return false;
          } else {
            var p3, d3 = Object.keys(e2);
            if (u3 = d3.length, Object.keys(t3).length !== u3) return false;
            for (; u3--; )
              if (!D(t3, p3 = d3[u3]) || !no(e2[p3], t3[p3], n3 - 1, a3, o3)) return false;
          }
          return a3.pop(), o3.pop(), true;
        }
        function ao(e2) {
          return Aa(e2) ? e2.slice() : C(e2) || Ra(e2) || O(e2) || Na(e2) ? Array.from(e2.entries()) : e2;
        }
        function oo(e2) {
          return e2[Symbol.iterator] = io, e2;
        }
        function io() {
          return this;
        }
        function ro(e2) {
          return e2 instanceof Object && typeof e2.annotationType_ == "string" && v(e2.make_) && v(e2.extend_);
        }
        ["Symbol", "Map", "Set"].forEach(function(e2) {
          void 0 === r2()[e2] && o2("MobX requires global '" + e2 + "' to be available or polyfilled");
        }), typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__ == "object" && __MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobx({
          spy: Wt,
          extras: { getDebugName: Za },
          $mobx: Y
        }), e.$mobx = n2;
      })(), i = Object.create, r = Object.defineProperty, s = Object.getOwnPropertyDescriptor, l = Object.getOwnPropertyNames, c = Object.getPrototypeOf, u = Object.prototype.hasOwnProperty, p = (e2) => {
        if (typeof __require != "undefined") return __require(e2);
        throw new Error('Dynamic require of "' + e2 + '" is not supported');
      }, t = {
        "node_modules/.pnpm/jszip@3.10.1/node_modules/jszip/dist/jszip.min.js"(e2, t2) {
          !function(n2) {
            typeof e2 == "object" && void 0 !== t2 ? t2.exports = n2() : typeof define == "function" && define.amd ? define([], n2) : (typeof window != "undefined" ? window : typeof global != "undefined" ? global : typeof self != "undefined" ? self : this).JSZip = n2();
          }(function() {
            return function e3(t3, n2, a2) {
              function o2(r3, s2) {
                if (!n2[r3]) {
                  if (!t3[r3]) {
                    if (!s2 && p) return p(r3);
                    if (i2) return i2(r3, true);
                    var l2 = new Error("Cannot find module '" + r3 + "'");
                    throw l2.code = "MODULE_NOT_FOUND", l2;
                  }
                  var c2 = n2[r3] = { exports: {} };
                  t3[r3][0].call(
                    c2.exports,
                    function(e4) {
                      return o2(t3[r3][1][e4] || e4);
                    },
                    c2,
                    c2.exports,
                    e3,
                    t3,
                    n2,
                    a2
                  );
                }
                return n2[r3].exports;
              }
              for (var i2 = p, r2 = 0; r2 < a2.length; r2++) o2(a2[r2]);
              return o2;
            }(
              {
                1: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = e3("./utils"), o2 = e3("./support"), i2 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
                    n2.encode = function(e4) {
                      for (var t4, n3, o3, r2, s2, l2, c2, u2 = [], p2 = 0, d2 = e4.length, m2 = d2, h = a2.getTypeOf(e4) !== "string"; p2 < e4.length; )
                        m2 = d2 - p2, o3 = h ? (t4 = e4[p2++], n3 = p2 < d2 ? e4[p2++] : 0, p2 < d2 ? e4[p2++] : 0) : (t4 = e4.charCodeAt(p2++), n3 = p2 < d2 ? e4.charCodeAt(p2++) : 0, p2 < d2 ? e4.charCodeAt(p2++) : 0), r2 = t4 >> 2, s2 = (3 & t4) << 4 | n3 >> 4, l2 = m2 > 1 ? (15 & n3) << 2 | o3 >> 6 : 64, c2 = m2 > 2 ? 63 & o3 : 64, u2.push(
                          "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(
                            r2
                          ) + "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(
                            s2
                          ) + "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(
                            l2
                          ) + "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(
                            c2
                          )
                        );
                      return u2.join("");
                    }, n2.decode = function(e4) {
                      var t4, n3, a3, r2, s2, l2, c2 = 0, u2 = 0, p2 = "data:";
                      if (e4.substr(0, "data:".length) === "data:")
                        throw new Error(
                          "Invalid base64 input, it looks like a data url."
                        );
                      var d2, m2 = 3 * (e4 = e4.replace(/[^A-Za-z0-9+/=]/g, "")).length / 4;
                      if (e4.charAt(e4.length - 1) === "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(
                        64
                      ) && m2--, e4.charAt(e4.length - 2) === "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(
                        64
                      ) && m2--, m2 % 1 != 0)
                        throw new Error(
                          "Invalid base64 input, bad content length."
                        );
                      for (d2 = o2.uint8array ? new Uint8Array(0 | m2) : new Array(0 | m2); c2 < e4.length; )
                        t4 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(
                          e4.charAt(c2++)
                        ) << 2 | (r2 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(
                          e4.charAt(c2++)
                        )) >> 4, n3 = (15 & r2) << 4 | (s2 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(
                          e4.charAt(c2++)
                        )) >> 2, a3 = (3 & s2) << 6 | (l2 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(
                          e4.charAt(c2++)
                        )), d2[u2++] = t4, s2 !== 64 && (d2[u2++] = n3), l2 !== 64 && (d2[u2++] = a3);
                      return d2;
                    };
                  },
                  { "./support": 30, "./utils": 32 }
                ],
                2: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = e3("./external"), o2 = e3("./stream/DataWorker"), i2 = e3("./stream/Crc32Probe"), r2 = e3("./stream/DataLengthProbe");
                    function s2(e4, t4, n3, a3, o3) {
                      this.compressedSize = e4, this.uncompressedSize = t4, this.crc32 = n3, this.compression = a3, this.compressedContent = o3;
                    }
                    s2.prototype = {
                      getContentWorker: function() {
                        var e4 = new o2(a2.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new r2("data_length")), t4 = this;
                        return e4.on("end", function() {
                          if (this.streamInfo.data_length !== t4.uncompressedSize)
                            throw new Error(
                              "Bug : uncompressed data size mismatch"
                            );
                        }), e4;
                      },
                      getCompressedWorker: function() {
                        return new o2(a2.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize", this.compressedSize).withStreamInfo(
                          "uncompressedSize",
                          this.uncompressedSize
                        ).withStreamInfo("crc32", this.crc32).withStreamInfo("compression", this.compression);
                      }
                    }, s2.createWorkerFrom = function(e4, t4, n3) {
                      return e4.pipe(new i2()).pipe(new r2("uncompressedSize")).pipe(t4.compressWorker(n3)).pipe(new r2("compressedSize")).withStreamInfo("compression", t4);
                    }, t3.exports = s2;
                  },
                  {
                    "./external": 6,
                    "./stream/Crc32Probe": 25,
                    "./stream/DataLengthProbe": 26,
                    "./stream/DataWorker": 27
                  }
                ],
                3: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = e3("./stream/GenericWorker");
                    n2.STORE = {
                      magic: "\0\0",
                      compressWorker: function() {
                        return new a2("STORE compression");
                      },
                      uncompressWorker: function() {
                        return new a2("STORE decompression");
                      }
                    }, n2.DEFLATE = e3("./flate");
                  },
                  { "./flate": 7, "./stream/GenericWorker": 28 }
                ],
                4: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = e3("./utils"), o2 = function() {
                      for (var e4, t4 = [], n3 = 0; n3 < 256; n3++) {
                        e4 = n3;
                        for (var a3 = 0; a3 < 8; a3++)
                          e4 = 1 & e4 ? 3988292384 ^ e4 >>> 1 : e4 >>> 1;
                        t4[n3] = e4;
                      }
                      return t4;
                    }();
                    t3.exports = function(e4, t4) {
                      return void 0 !== e4 && e4.length ? a2.getTypeOf(e4) !== "string" ? function(e5, t5, n3, a3) {
                        var i2 = o2, r2 = 0 + n3;
                        e5 ^= -1;
                        for (var s2 = 0; s2 < r2; s2++)
                          e5 = e5 >>> 8 ^ i2[255 & (e5 ^ t5[s2])];
                        return -1 ^ e5;
                      }(0 | t4, e4, e4.length) : function(e5, t5, n3, a3) {
                        var i2 = o2, r2 = 0 + n3;
                        e5 ^= -1;
                        for (var s2 = 0; s2 < r2; s2++)
                          e5 = e5 >>> 8 ^ i2[255 & (e5 ^ t5.charCodeAt(s2))];
                        return -1 ^ e5;
                      }(0 | t4, e4, e4.length) : 0;
                    };
                  },
                  { "./utils": 32 }
                ],
                5: [
                  function(e3, t3, n2) {
                    "use strict";
                    n2.base64 = false, n2.binary = false, n2.dir = false, n2.createFolders = true, n2.date = null, n2.compression = null, n2.compressionOptions = null, n2.comment = null, n2.unixPermissions = null, n2.dosPermissions = null;
                  },
                  {}
                ],
                6: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2;
                    a2 = typeof Promise != "undefined" ? Promise : e3("lie"), t3.exports = { Promise: a2 };
                  },
                  { lie: 37 }
                ],
                7: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = typeof Uint8Array != "undefined" && typeof Uint16Array != "undefined" && typeof Uint32Array != "undefined", o2 = e3("pako"), i2 = e3("./utils"), r2 = e3("./stream/GenericWorker"), s2 = a2 ? "uint8array" : "array";
                    function l2(e4, t4) {
                      r2.call(this, "FlateWorker/" + e4), this._pako = null, this._pakoAction = e4, this._pakoOptions = t4, this.meta = {};
                    }
                    n2.magic = "\b\0", i2.inherits(l2, r2), l2.prototype.processChunk = function(e4) {
                      this.meta = e4.meta, this._pako === null && this._createPako(), this._pako.push(i2.transformTo(s2, e4.data), false);
                    }, l2.prototype.flush = function() {
                      r2.prototype.flush.call(this), this._pako === null && this._createPako(), this._pako.push([], true);
                    }, l2.prototype.cleanUp = function() {
                      r2.prototype.cleanUp.call(this), this._pako = null;
                    }, l2.prototype._createPako = function() {
                      this._pako = new o2[this._pakoAction]({
                        raw: true,
                        level: this._pakoOptions.level || -1
                      });
                      var e4 = this;
                      this._pako.onData = function(t4) {
                        e4.push({ data: t4, meta: e4.meta });
                      };
                    }, n2.compressWorker = function(e4) {
                      return new l2("Deflate", e4);
                    }, n2.uncompressWorker = function() {
                      return new l2("Inflate", {});
                    };
                  },
                  { "./stream/GenericWorker": 28, "./utils": 32, pako: 38 }
                ],
                8: [
                  function(e3, t3, n2) {
                    "use strict";
                    function a2(e4, t4) {
                      var n3, a3 = "";
                      for (n3 = 0; n3 < t4; n3++)
                        a3 += String.fromCharCode(255 & e4), e4 >>>= 8;
                      return a3;
                    }
                    function o2(e4, t4, n3, o3, r3, u3) {
                      var p2, d2, m2 = e4.file, h = e4.compression, g = u3 !== s2.utf8encode, f = i2.transformTo("string", u3(m2.name)), y = i2.transformTo("string", s2.utf8encode(m2.name)), b = m2.comment, w = i2.transformTo("string", u3(b)), v = i2.transformTo("string", s2.utf8encode(b)), k = y.length !== m2.name.length, T = v.length !== b.length, A = "", E = "", I = "", S = m2.dir, x = m2.date, C = { crc32: 0, compressedSize: 0, uncompressedSize: 0 };
                      t4 && !n3 || (C.crc32 = e4.crc32, C.compressedSize = e4.compressedSize, C.uncompressedSize = e4.uncompressedSize);
                      var O = 0;
                      t4 && (O |= 8), g || !k && !T || (O |= 2048);
                      var R, _, P, N = 0, D = 0;
                      S && (N |= 16), r3 === "UNIX" ? (D = 798, N |= (R = m2.unixPermissions, _ = S, P = R, R || (P = _ ? 16893 : 33204), (65535 & P) << 16)) : (D = 20, N |= function(e5) {
                        return 63 & (e5 || 0);
                      }(m2.dosPermissions)), p2 = x.getUTCHours(), p2 <<= 6, p2 |= x.getUTCMinutes(), p2 <<= 5, p2 |= x.getUTCSeconds() / 2, d2 = x.getUTCFullYear() - 1980, d2 <<= 4, d2 |= x.getUTCMonth() + 1, d2 <<= 5, d2 |= x.getUTCDate(), k && (E = a2(1, 1) + a2(l2(f), 4) + y, A += "up" + a2(E.length, 2) + E), T && (I = a2(1, 1) + a2(l2(w), 4) + v, A += "uc" + a2(I.length, 2) + I);
                      var L = "";
                      return L += "\n\0", L += a2(O, 2), L += h.magic, L += a2(p2, 2), L += a2(d2, 2), L += a2(C.crc32, 4), L += a2(C.compressedSize, 4), L += a2(C.uncompressedSize, 4), L += a2(f.length, 2), L += a2(A.length, 2), {
                        fileRecord: c2.LOCAL_FILE_HEADER + L + f + A,
                        dirRecord: c2.CENTRAL_FILE_HEADER + a2(D, 2) + L + a2(w.length, 2) + "\0\0\0\0" + a2(N, 4) + a2(o3, 4) + f + A + w
                      };
                    }
                    var i2 = e3("../utils"), r2 = e3("../stream/GenericWorker"), s2 = e3("../utf8"), l2 = e3("../crc32"), c2 = e3("../signature");
                    function u2(e4, t4, n3, a3) {
                      r2.call(this, "ZipFileWorker"), this.bytesWritten = 0, this.zipComment = t4, this.zipPlatform = n3, this.encodeFileName = a3, this.streamFiles = e4, this.accumulate = false, this.contentBuffer = [], this.dirRecords = [], this.currentSourceOffset = 0, this.entriesCount = 0, this.currentFile = null, this._sources = [];
                    }
                    i2.inherits(u2, r2), u2.prototype.push = function(e4) {
                      var t4 = e4.meta.percent || 0, n3 = this.entriesCount, a3 = this._sources.length;
                      this.accumulate ? this.contentBuffer.push(e4) : (this.bytesWritten += e4.data.length, r2.prototype.push.call(this, {
                        data: e4.data,
                        meta: {
                          currentFile: this.currentFile,
                          percent: n3 ? (t4 + 100 * (n3 - a3 - 1)) / n3 : 100
                        }
                      }));
                    }, u2.prototype.openedSource = function(e4) {
                      this.currentSourceOffset = this.bytesWritten, this.currentFile = e4.file.name;
                      var t4 = this.streamFiles && !e4.file.dir;
                      if (t4) {
                        var n3 = o2(
                          e4,
                          t4,
                          false,
                          this.currentSourceOffset,
                          this.zipPlatform,
                          this.encodeFileName
                        );
                        this.push({ data: n3.fileRecord, meta: { percent: 0 } });
                      } else this.accumulate = true;
                    }, u2.prototype.closedSource = function(e4) {
                      this.accumulate = false;
                      var t4, n3 = this.streamFiles && !e4.file.dir, i3 = o2(
                        e4,
                        n3,
                        true,
                        this.currentSourceOffset,
                        this.zipPlatform,
                        this.encodeFileName
                      );
                      if (this.dirRecords.push(i3.dirRecord), n3)
                        this.push({
                          data: (t4 = e4, c2.DATA_DESCRIPTOR + a2(t4.crc32, 4) + a2(t4.compressedSize, 4) + a2(t4.uncompressedSize, 4)),
                          meta: { percent: 100 }
                        });
                      else
                        for (this.push({
                          data: i3.fileRecord,
                          meta: { percent: 0 }
                        }); this.contentBuffer.length; )
                          this.push(this.contentBuffer.shift());
                      this.currentFile = null;
                    }, u2.prototype.flush = function() {
                      for (var e4 = this.bytesWritten, t4 = 0; t4 < this.dirRecords.length; t4++)
                        this.push({
                          data: this.dirRecords[t4],
                          meta: { percent: 100 }
                        });
                      var n3, o3, r3, s3, l3, u3, p2 = this.bytesWritten - e4, d2 = (n3 = this.dirRecords.length, o3 = p2, r3 = e4, s3 = this.zipComment, l3 = this.encodeFileName, u3 = i2.transformTo("string", l3(s3)), c2.CENTRAL_DIRECTORY_END + "\0\0\0\0" + a2(n3, 2) + a2(n3, 2) + a2(o3, 4) + a2(r3, 4) + a2(u3.length, 2) + u3);
                      this.push({ data: d2, meta: { percent: 100 } });
                    }, u2.prototype.prepareNextSource = function() {
                      this.previous = this._sources.shift(), this.openedSource(this.previous.streamInfo), this.isPaused ? this.previous.pause() : this.previous.resume();
                    }, u2.prototype.registerPrevious = function(e4) {
                      this._sources.push(e4);
                      var t4 = this;
                      return e4.on("data", function(e5) {
                        t4.processChunk(e5);
                      }), e4.on("end", function() {
                        t4.closedSource(t4.previous.streamInfo), t4._sources.length ? t4.prepareNextSource() : t4.end();
                      }), e4.on("error", function(e5) {
                        t4.error(e5);
                      }), this;
                    }, u2.prototype.resume = function() {
                      return !!r2.prototype.resume.call(this) && (!this.previous && this._sources.length ? (this.prepareNextSource(), true) : this.previous || this._sources.length || this.generatedError ? void 0 : (this.end(), true));
                    }, u2.prototype.error = function(e4) {
                      var t4 = this._sources;
                      if (!r2.prototype.error.call(this, e4)) return false;
                      for (var n3 = 0; n3 < t4.length; n3++)
                        try {
                          t4[n3].error(e4);
                        } catch (e5) {
                        }
                      return true;
                    }, u2.prototype.lock = function() {
                      r2.prototype.lock.call(this);
                      for (var e4 = this._sources, t4 = 0; t4 < e4.length; t4++)
                        e4[t4].lock();
                    }, t3.exports = u2;
                  },
                  {
                    "../crc32": 4,
                    "../signature": 23,
                    "../stream/GenericWorker": 28,
                    "../utf8": 31,
                    "../utils": 32
                  }
                ],
                9: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = e3("../compressions"), o2 = e3("./ZipFileWorker");
                    n2.generateWorker = function(e4, t4, n3) {
                      var i2 = new o2(
                        t4.streamFiles,
                        n3,
                        t4.platform,
                        t4.encodeFileName
                      ), r2 = 0;
                      try {
                        e4.forEach(function(e5, n4) {
                          r2++;
                          var o3 = function(e6, t5) {
                            var n5 = e6 || t5, o4 = a2[n5];
                            if (!o4)
                              throw new Error(
                                n5 + " is not a valid compression method !"
                              );
                            return o4;
                          }(n4.options.compression, t4.compression), s2 = n4.options.compressionOptions || t4.compressionOptions || {}, l2 = n4.dir, c2 = n4.date;
                          n4._compressWorker(o3, s2).withStreamInfo("file", {
                            name: e5,
                            dir: l2,
                            date: c2,
                            comment: n4.comment || "",
                            unixPermissions: n4.unixPermissions,
                            dosPermissions: n4.dosPermissions
                          }).pipe(i2);
                        }), i2.entriesCount = r2;
                      } catch (e5) {
                        i2.error(e5);
                      }
                      return i2;
                    };
                  },
                  { "../compressions": 3, "./ZipFileWorker": 8 }
                ],
                10: [
                  function(e3, t3, n2) {
                    "use strict";
                    function a2() {
                      if (!(this instanceof a2)) return new a2();
                      if (arguments.length)
                        throw new Error(
                          "The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide."
                        );
                      this.files = /* @__PURE__ */ Object.create(null), this.comment = null, this.root = "", this.clone = function() {
                        var e4 = new a2();
                        for (var t4 in this)
                          typeof this[t4] != "function" && (e4[t4] = this[t4]);
                        return e4;
                      };
                    }
                    (a2.prototype = e3("./object")).loadAsync = e3("./load"), a2.support = e3("./support"), a2.defaults = e3("./defaults"), a2.version = "3.10.1", a2.loadAsync = function(e4, t4) {
                      return new a2().loadAsync(e4, t4);
                    }, a2.external = e3("./external"), t3.exports = a2;
                  },
                  {
                    "./defaults": 5,
                    "./external": 6,
                    "./load": 11,
                    "./object": 15,
                    "./support": 30
                  }
                ],
                11: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = e3("./utils"), o2 = e3("./external"), i2 = e3("./utf8"), r2 = e3("./zipEntries"), s2 = e3("./stream/Crc32Probe"), l2 = e3("./nodejsUtils");
                    function c2(e4) {
                      return new o2.Promise(function(t4, n3) {
                        var a3 = e4.decompressed.getContentWorker().pipe(new s2());
                        a3.on("error", function(e5) {
                          n3(e5);
                        }).on("end", function() {
                          a3.streamInfo.crc32 !== e4.decompressed.crc32 ? n3(new Error("Corrupted zip : CRC32 mismatch")) : t4();
                        }).resume();
                      });
                    }
                    t3.exports = function(e4, t4) {
                      var n3 = this;
                      return t4 = a2.extend(t4 || {}, {
                        base64: false,
                        checkCRC32: false,
                        optimizedBinaryString: false,
                        createFolders: false,
                        decodeFileName: i2.utf8decode
                      }), l2.isNode && l2.isStream(e4) ? o2.Promise.reject(
                        new Error(
                          "JSZip can't accept a stream when loading a zip file."
                        )
                      ) : a2.prepareContent(
                        "the loaded zip file",
                        e4,
                        true,
                        t4.optimizedBinaryString,
                        t4.base64
                      ).then(function(e5) {
                        var n4 = new r2(t4);
                        return n4.load(e5), n4;
                      }).then(function(e5) {
                        var n4 = [o2.Promise.resolve(e5)], a3 = e5.files;
                        if (t4.checkCRC32)
                          for (var i3 = 0; i3 < a3.length; i3++)
                            n4.push(c2(a3[i3]));
                        return o2.Promise.all(n4);
                      }).then(function(e5) {
                        for (var o3 = e5.shift(), i3 = o3.files, r3 = 0; r3 < i3.length; r3++) {
                          var s3 = i3[r3], l3 = s3.fileNameStr, c3 = a2.resolve(s3.fileNameStr);
                          n3.file(c3, s3.decompressed, {
                            binary: true,
                            optimizedBinaryString: true,
                            date: s3.date,
                            dir: s3.dir,
                            comment: s3.fileCommentStr.length ? s3.fileCommentStr : null,
                            unixPermissions: s3.unixPermissions,
                            dosPermissions: s3.dosPermissions,
                            createFolders: t4.createFolders
                          }), s3.dir || (n3.file(c3).unsafeOriginalName = l3);
                        }
                        return o3.zipComment.length && (n3.comment = o3.zipComment), n3;
                      });
                    };
                  },
                  {
                    "./external": 6,
                    "./nodejsUtils": 14,
                    "./stream/Crc32Probe": 25,
                    "./utf8": 31,
                    "./utils": 32,
                    "./zipEntries": 33
                  }
                ],
                12: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = e3("../utils"), o2 = e3("../stream/GenericWorker");
                    function i2(e4, t4) {
                      o2.call(this, "Nodejs stream input adapter for " + e4), this._upstreamEnded = false, this._bindStream(t4);
                    }
                    a2.inherits(i2, o2), i2.prototype._bindStream = function(e4) {
                      var t4 = this;
                      (this._stream = e4).pause(), e4.on("data", function(e5) {
                        t4.push({ data: e5, meta: { percent: 0 } });
                      }).on("error", function(e5) {
                        t4.isPaused ? this.generatedError = e5 : t4.error(e5);
                      }).on("end", function() {
                        t4.isPaused ? t4._upstreamEnded = true : t4.end();
                      });
                    }, i2.prototype.pause = function() {
                      return !!o2.prototype.pause.call(this) && (this._stream.pause(), true);
                    }, i2.prototype.resume = function() {
                      return !!o2.prototype.resume.call(this) && (this._upstreamEnded ? this.end() : this._stream.resume(), true);
                    }, t3.exports = i2;
                  },
                  { "../stream/GenericWorker": 28, "../utils": 32 }
                ],
                13: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = e3("readable-stream").Readable;
                    function o2(e4, t4, n3) {
                      a2.call(this, t4), this._helper = e4;
                      var o3 = this;
                      e4.on("data", function(e5, t5) {
                        o3.push(e5) || o3._helper.pause(), n3 && n3(t5);
                      }).on("error", function(e5) {
                        o3.emit("error", e5);
                      }).on("end", function() {
                        o3.push(null);
                      });
                    }
                    e3("../utils").inherits(o2, a2), o2.prototype._read = function() {
                      this._helper.resume();
                    }, t3.exports = o2;
                  },
                  { "../utils": 32, "readable-stream": 16 }
                ],
                14: [
                  function(e3, t3, n2) {
                    "use strict";
                    t3.exports = {
                      isNode: typeof Buffer != "undefined",
                      newBufferFrom: function(e4, t4) {
                        if (Buffer.from && Buffer.from !== Uint8Array.from)
                          return Buffer.from(e4, t4);
                        if (typeof e4 == "number")
                          throw new Error(
                            'The "data" argument must not be a number'
                          );
                        return new Buffer(e4, t4);
                      },
                      allocBuffer: function(e4) {
                        if (Buffer.alloc) return Buffer.alloc(e4);
                        var t4 = new Buffer(e4);
                        return t4.fill(0), t4;
                      },
                      isBuffer: function(e4) {
                        return Buffer.isBuffer(e4);
                      },
                      isStream: function(e4) {
                        return e4 && typeof e4.on == "function" && typeof e4.pause == "function" && typeof e4.resume == "function";
                      }
                    };
                  },
                  {}
                ],
                15: [
                  function(e3, t3, n2) {
                    "use strict";
                    function a2(e4, t4, n3) {
                      var a3, o3 = i2.getTypeOf(t4), s3 = i2.extend(n3 || {}, l2);
                      s3.date = s3.date || /* @__PURE__ */ new Date(), s3.compression !== null && (s3.compression = s3.compression.toUpperCase()), typeof s3.unixPermissions == "string" && (s3.unixPermissions = parseInt(s3.unixPermissions, 8)), s3.unixPermissions && 16384 & s3.unixPermissions && (s3.dir = true), s3.dosPermissions && 16 & s3.dosPermissions && (s3.dir = true), s3.dir && (e4 = g(e4)), s3.createFolders && (a3 = h(e4)) && f.call(this, a3, true);
                      var p3, y2 = o3 === "string" && false === s3.binary && false === s3.base64;
                      n3 && void 0 !== n3.binary || (s3.binary = !y2), (t4 instanceof c2 && t4.uncompressedSize === 0 || s3.dir || !t4 || t4.length === 0) && (s3.base64 = false, s3.binary = true, t4 = "", s3.compression = "STORE", o3 = "string"), p3 = t4 instanceof c2 || t4 instanceof r2 ? t4 : d2.isNode && d2.isStream(t4) ? new m2(e4, t4) : i2.prepareContent(
                        e4,
                        t4,
                        s3.binary,
                        s3.optimizedBinaryString,
                        s3.base64
                      );
                      var b2 = new u2(e4, p3, s3);
                      this.files[e4] = b2;
                    }
                    var o2 = e3("./utf8"), i2 = e3("./utils"), r2 = e3("./stream/GenericWorker"), s2 = e3("./stream/StreamHelper"), l2 = e3("./defaults"), c2 = e3("./compressedObject"), u2 = e3("./zipObject"), p2 = e3("./generate"), d2 = e3("./nodejsUtils"), m2 = e3("./nodejs/NodejsStreamInputAdapter"), h = function(e4) {
                      e4.slice(-1) === "/" && (e4 = e4.substring(0, e4.length - 1));
                      var t4 = e4.lastIndexOf("/");
                      return t4 > 0 ? e4.substring(0, t4) : "";
                    }, g = function(e4) {
                      return e4.slice(-1) !== "/" && (e4 += "/"), e4;
                    }, f = function(e4, t4) {
                      return t4 = void 0 !== t4 ? t4 : l2.createFolders, e4 = g(e4), this.files[e4] || a2.call(this, e4, null, { dir: true, createFolders: t4 }), this.files[e4];
                    };
                    function y(e4) {
                      return Object.prototype.toString.call(e4) === "[object RegExp]";
                    }
                    var b = {
                      load: function() {
                        throw new Error(
                          "This method has been removed in JSZip 3.0, please check the upgrade guide."
                        );
                      },
                      forEach: function(e4) {
                        var t4, n3, a3;
                        for (t4 in this.files)
                          a3 = this.files[t4], (n3 = t4.slice(this.root.length, t4.length)) && t4.slice(0, this.root.length) === this.root && e4(n3, a3);
                      },
                      filter: function(e4) {
                        var t4 = [];
                        return this.forEach(function(n3, a3) {
                          e4(n3, a3) && t4.push(a3);
                        }), t4;
                      },
                      file: function(e4, t4, n3) {
                        if (arguments.length !== 1)
                          return e4 = this.root + e4, a2.call(this, e4, t4, n3), this;
                        if (y(e4)) {
                          var o3 = e4;
                          return this.filter(function(e5, t5) {
                            return !t5.dir && o3.test(e5);
                          });
                        }
                        var i3 = this.files[this.root + e4];
                        return i3 && !i3.dir ? i3 : null;
                      },
                      folder: function(e4) {
                        if (!e4) return this;
                        if (y(e4))
                          return this.filter(function(t5, n4) {
                            return n4.dir && e4.test(t5);
                          });
                        var t4 = this.root + e4, n3 = f.call(this, t4), a3 = this.clone();
                        return a3.root = n3.name, a3;
                      },
                      remove: function(e4) {
                        e4 = this.root + e4;
                        var t4 = this.files[e4];
                        if (t4 || (e4.slice(-1) !== "/" && (e4 += "/"), t4 = this.files[e4]), t4 && !t4.dir)
                          delete this.files[e4];
                        else
                          for (var n3 = this.filter(function(t5, n4) {
                            return n4.name.slice(0, e4.length) === e4;
                          }), a3 = 0; a3 < n3.length; a3++)
                            delete this.files[n3[a3].name];
                        return this;
                      },
                      generate: function() {
                        throw new Error(
                          "This method has been removed in JSZip 3.0, please check the upgrade guide."
                        );
                      },
                      generateInternalStream: function(e4) {
                        var t4, n3 = {};
                        try {
                          if ((n3 = i2.extend(e4 || {}, {
                            streamFiles: false,
                            compression: "STORE",
                            compressionOptions: null,
                            type: "",
                            platform: "DOS",
                            comment: null,
                            mimeType: "application/zip",
                            encodeFileName: o2.utf8encode
                          })).type = n3.type.toLowerCase(), n3.compression = n3.compression.toUpperCase(), n3.type === "binarystring" && (n3.type = "string"), !n3.type)
                            throw new Error("No output type specified.");
                          i2.checkSupport(n3.type), n3.platform !== "darwin" && n3.platform !== "freebsd" && n3.platform !== "linux" && n3.platform !== "sunos" || (n3.platform = "UNIX"), n3.platform === "win32" && (n3.platform = "DOS");
                          var a3 = n3.comment || this.comment || "";
                          t4 = p2.generateWorker(this, n3, a3);
                        } catch (e5) {
                          (t4 = new r2("error")).error(e5);
                        }
                        return new s2(t4, n3.type || "string", n3.mimeType);
                      },
                      generateAsync: function(e4, t4) {
                        return this.generateInternalStream(e4).accumulate(t4);
                      },
                      generateNodeStream: function(e4, t4) {
                        return (e4 = e4 || {}).type || (e4.type = "nodebuffer"), this.generateInternalStream(e4).toNodejsStream(t4);
                      }
                    };
                    t3.exports = b;
                  },
                  {
                    "./compressedObject": 2,
                    "./defaults": 5,
                    "./generate": 9,
                    "./nodejs/NodejsStreamInputAdapter": 12,
                    "./nodejsUtils": 14,
                    "./stream/GenericWorker": 28,
                    "./stream/StreamHelper": 29,
                    "./utf8": 31,
                    "./utils": 32,
                    "./zipObject": 35
                  }
                ],
                16: [
                  function(e3, t3, n2) {
                    "use strict";
                    t3.exports = e3("stream");
                  },
                  { stream: void 0 }
                ],
                17: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = e3("./DataReader");
                    function o2(e4) {
                      a2.call(this, e4);
                      for (var t4 = 0; t4 < this.data.length; t4++)
                        e4[t4] = 255 & e4[t4];
                    }
                    e3("../utils").inherits(o2, a2), o2.prototype.byteAt = function(e4) {
                      return this.data[this.zero + e4];
                    }, o2.prototype.lastIndexOfSignature = function(e4) {
                      for (var t4 = e4.charCodeAt(0), n3 = e4.charCodeAt(1), a3 = e4.charCodeAt(2), o3 = e4.charCodeAt(3), i2 = this.length - 4; i2 >= 0; --i2)
                        if (this.data[i2] === t4 && this.data[i2 + 1] === n3 && this.data[i2 + 2] === a3 && this.data[i2 + 3] === o3)
                          return i2 - this.zero;
                      return -1;
                    }, o2.prototype.readAndCheckSignature = function(e4) {
                      var t4 = e4.charCodeAt(0), n3 = e4.charCodeAt(1), a3 = e4.charCodeAt(2), o3 = e4.charCodeAt(3), i2 = this.readData(4);
                      return t4 === i2[0] && n3 === i2[1] && a3 === i2[2] && o3 === i2[3];
                    }, o2.prototype.readData = function(e4) {
                      if (this.checkOffset(e4), e4 === 0) return [];
                      var t4 = this.data.slice(
                        this.zero + this.index,
                        this.zero + this.index + e4
                      );
                      return this.index += e4, t4;
                    }, t3.exports = o2;
                  },
                  { "../utils": 32, "./DataReader": 18 }
                ],
                18: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = e3("../utils");
                    function o2(e4) {
                      this.data = e4, this.length = e4.length, this.index = 0, this.zero = 0;
                    }
                    o2.prototype = {
                      checkOffset: function(e4) {
                        this.checkIndex(this.index + e4);
                      },
                      checkIndex: function(e4) {
                        if (this.length < this.zero + e4 || e4 < 0)
                          throw new Error(
                            "End of data reached (data length = " + this.length + ", asked index = " + e4 + "). Corrupted zip ?"
                          );
                      },
                      setIndex: function(e4) {
                        this.checkIndex(e4), this.index = e4;
                      },
                      skip: function(e4) {
                        this.setIndex(this.index + e4);
                      },
                      byteAt: function() {
                      },
                      readInt: function(e4) {
                        var t4, n3 = 0;
                        for (this.checkOffset(e4), t4 = this.index + e4 - 1; t4 >= this.index; t4--)
                          n3 = (n3 << 8) + this.byteAt(t4);
                        return this.index += e4, n3;
                      },
                      readString: function(e4) {
                        return a2.transformTo("string", this.readData(e4));
                      },
                      readData: function() {
                      },
                      lastIndexOfSignature: function() {
                      },
                      readAndCheckSignature: function() {
                      },
                      readDate: function() {
                        var e4 = this.readInt(4);
                        return new Date(
                          Date.UTC(
                            1980 + (e4 >> 25 & 127),
                            (e4 >> 21 & 15) - 1,
                            e4 >> 16 & 31,
                            e4 >> 11 & 31,
                            e4 >> 5 & 63,
                            (31 & e4) << 1
                          )
                        );
                      }
                    }, t3.exports = o2;
                  },
                  { "../utils": 32 }
                ],
                19: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = e3("./Uint8ArrayReader");
                    function o2(e4) {
                      a2.call(this, e4);
                    }
                    e3("../utils").inherits(o2, a2), o2.prototype.readData = function(e4) {
                      this.checkOffset(e4);
                      var t4 = this.data.slice(
                        this.zero + this.index,
                        this.zero + this.index + e4
                      );
                      return this.index += e4, t4;
                    }, t3.exports = o2;
                  },
                  { "../utils": 32, "./Uint8ArrayReader": 21 }
                ],
                20: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = e3("./DataReader");
                    function o2(e4) {
                      a2.call(this, e4);
                    }
                    e3("../utils").inherits(o2, a2), o2.prototype.byteAt = function(e4) {
                      return this.data.charCodeAt(this.zero + e4);
                    }, o2.prototype.lastIndexOfSignature = function(e4) {
                      return this.data.lastIndexOf(e4) - this.zero;
                    }, o2.prototype.readAndCheckSignature = function(e4) {
                      return e4 === this.readData(4);
                    }, o2.prototype.readData = function(e4) {
                      this.checkOffset(e4);
                      var t4 = this.data.slice(
                        this.zero + this.index,
                        this.zero + this.index + e4
                      );
                      return this.index += e4, t4;
                    }, t3.exports = o2;
                  },
                  { "../utils": 32, "./DataReader": 18 }
                ],
                21: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = e3("./ArrayReader");
                    function o2(e4) {
                      a2.call(this, e4);
                    }
                    e3("../utils").inherits(o2, a2), o2.prototype.readData = function(e4) {
                      if (this.checkOffset(e4), e4 === 0)
                        return new Uint8Array(0);
                      var t4 = this.data.subarray(
                        this.zero + this.index,
                        this.zero + this.index + e4
                      );
                      return this.index += e4, t4;
                    }, t3.exports = o2;
                  },
                  { "../utils": 32, "./ArrayReader": 17 }
                ],
                22: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = e3("../utils"), o2 = e3("../support"), i2 = e3("./ArrayReader"), r2 = e3("./StringReader"), s2 = e3("./NodeBufferReader"), l2 = e3("./Uint8ArrayReader");
                    t3.exports = function(e4) {
                      var t4 = a2.getTypeOf(e4);
                      return a2.checkSupport(t4), t4 !== "string" || o2.uint8array ? t4 === "nodebuffer" ? new s2(e4) : o2.uint8array ? new l2(a2.transformTo("uint8array", e4)) : new i2(a2.transformTo("array", e4)) : new r2(e4);
                    };
                  },
                  {
                    "../support": 30,
                    "../utils": 32,
                    "./ArrayReader": 17,
                    "./NodeBufferReader": 19,
                    "./StringReader": 20,
                    "./Uint8ArrayReader": 21
                  }
                ],
                23: [
                  function(e3, t3, n2) {
                    "use strict";
                    n2.LOCAL_FILE_HEADER = "PK", n2.CENTRAL_FILE_HEADER = "PK", n2.CENTRAL_DIRECTORY_END = "PK", n2.ZIP64_CENTRAL_DIRECTORY_LOCATOR = "PK\x07", n2.ZIP64_CENTRAL_DIRECTORY_END = "PK", n2.DATA_DESCRIPTOR = "PK\x07\b";
                  },
                  {}
                ],
                24: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = e3("./GenericWorker"), o2 = e3("../utils");
                    function i2(e4) {
                      a2.call(this, "ConvertWorker to " + e4), this.destType = e4;
                    }
                    o2.inherits(i2, a2), i2.prototype.processChunk = function(e4) {
                      this.push({
                        data: o2.transformTo(this.destType, e4.data),
                        meta: e4.meta
                      });
                    }, t3.exports = i2;
                  },
                  { "../utils": 32, "./GenericWorker": 28 }
                ],
                25: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = e3("./GenericWorker"), o2 = e3("../crc32");
                    function i2() {
                      a2.call(this, "Crc32Probe"), this.withStreamInfo("crc32", 0);
                    }
                    e3("../utils").inherits(i2, a2), i2.prototype.processChunk = function(e4) {
                      this.streamInfo.crc32 = o2(
                        e4.data,
                        this.streamInfo.crc32 || 0
                      ), this.push(e4);
                    }, t3.exports = i2;
                  },
                  { "../crc32": 4, "../utils": 32, "./GenericWorker": 28 }
                ],
                26: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = e3("../utils"), o2 = e3("./GenericWorker");
                    function i2(e4) {
                      o2.call(this, "DataLengthProbe for " + e4), this.propName = e4, this.withStreamInfo(e4, 0);
                    }
                    a2.inherits(i2, o2), i2.prototype.processChunk = function(e4) {
                      if (e4) {
                        var t4 = this.streamInfo[this.propName] || 0;
                        this.streamInfo[this.propName] = t4 + e4.data.length;
                      }
                      o2.prototype.processChunk.call(this, e4);
                    }, t3.exports = i2;
                  },
                  { "../utils": 32, "./GenericWorker": 28 }
                ],
                27: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = e3("../utils"), o2 = e3("./GenericWorker");
                    function i2(e4) {
                      o2.call(this, "DataWorker");
                      var t4 = this;
                      this.dataIsReady = false, this.index = 0, this.max = 0, this.data = null, this.type = "", this._tickScheduled = false, e4.then(
                        function(e5) {
                          t4.dataIsReady = true, t4.data = e5, t4.max = e5 && e5.length || 0, t4.type = a2.getTypeOf(e5), t4.isPaused || t4._tickAndRepeat();
                        },
                        function(e5) {
                          t4.error(e5);
                        }
                      );
                    }
                    a2.inherits(i2, o2), i2.prototype.cleanUp = function() {
                      o2.prototype.cleanUp.call(this), this.data = null;
                    }, i2.prototype.resume = function() {
                      return !!o2.prototype.resume.call(this) && (!this._tickScheduled && this.dataIsReady && (this._tickScheduled = true, a2.delay(this._tickAndRepeat, [], this)), true);
                    }, i2.prototype._tickAndRepeat = function() {
                      this._tickScheduled = false, this.isPaused || this.isFinished || (this._tick(), this.isFinished || (a2.delay(this._tickAndRepeat, [], this), this._tickScheduled = true));
                    }, i2.prototype._tick = function() {
                      if (this.isPaused || this.isFinished) return false;
                      var e4 = null, t4 = Math.min(this.max, this.index + 16384);
                      if (this.index >= this.max) return this.end();
                      switch (this.type) {
                        case "string":
                          e4 = this.data.substring(this.index, t4);
                          break;
                        case "uint8array":
                          e4 = this.data.subarray(this.index, t4);
                          break;
                        case "array":
                        case "nodebuffer":
                          e4 = this.data.slice(this.index, t4);
                      }
                      return this.index = t4, this.push({
                        data: e4,
                        meta: {
                          percent: this.max ? this.index / this.max * 100 : 0
                        }
                      });
                    }, t3.exports = i2;
                  },
                  { "../utils": 32, "./GenericWorker": 28 }
                ],
                28: [
                  function(e3, t3, n2) {
                    "use strict";
                    function a2(e4) {
                      this.name = e4 || "default", this.streamInfo = {}, this.generatedError = null, this.extraStreamInfo = {}, this.isPaused = true, this.isFinished = false, this.isLocked = false, this._listeners = { data: [], end: [], error: [] }, this.previous = null;
                    }
                    a2.prototype = {
                      push: function(e4) {
                        this.emit("data", e4);
                      },
                      end: function() {
                        if (this.isFinished) return false;
                        this.flush();
                        try {
                          this.emit("end"), this.cleanUp(), this.isFinished = true;
                        } catch (e4) {
                          this.emit("error", e4);
                        }
                        return true;
                      },
                      error: function(e4) {
                        return !this.isFinished && (this.isPaused ? this.generatedError = e4 : (this.isFinished = true, this.emit("error", e4), this.previous && this.previous.error(e4), this.cleanUp()), true);
                      },
                      on: function(e4, t4) {
                        return this._listeners[e4].push(t4), this;
                      },
                      cleanUp: function() {
                        this.streamInfo = this.generatedError = this.extraStreamInfo = null, this._listeners = [];
                      },
                      emit: function(e4, t4) {
                        if (this._listeners[e4])
                          for (var n3 = 0; n3 < this._listeners[e4].length; n3++)
                            this._listeners[e4][n3].call(this, t4);
                      },
                      pipe: function(e4) {
                        return e4.registerPrevious(this);
                      },
                      registerPrevious: function(e4) {
                        if (this.isLocked)
                          throw new Error(
                            "The stream '" + this + "' has already been used."
                          );
                        this.streamInfo = e4.streamInfo, this.mergeStreamInfo(), this.previous = e4;
                        var t4 = this;
                        return e4.on("data", function(e5) {
                          t4.processChunk(e5);
                        }), e4.on("end", function() {
                          t4.end();
                        }), e4.on("error", function(e5) {
                          t4.error(e5);
                        }), this;
                      },
                      pause: function() {
                        return !this.isPaused && !this.isFinished && (this.isPaused = true, this.previous && this.previous.pause(), true);
                      },
                      resume: function() {
                        if (!this.isPaused || this.isFinished) return false;
                        var e4 = this.isPaused = false;
                        return this.generatedError && (this.error(this.generatedError), e4 = true), this.previous && this.previous.resume(), !e4;
                      },
                      flush: function() {
                      },
                      processChunk: function(e4) {
                        this.push(e4);
                      },
                      withStreamInfo: function(e4, t4) {
                        return this.extraStreamInfo[e4] = t4, this.mergeStreamInfo(), this;
                      },
                      mergeStreamInfo: function() {
                        for (var e4 in this.extraStreamInfo)
                          Object.prototype.hasOwnProperty.call(
                            this.extraStreamInfo,
                            e4
                          ) && (this.streamInfo[e4] = this.extraStreamInfo[e4]);
                      },
                      lock: function() {
                        if (this.isLocked)
                          throw new Error(
                            "The stream '" + this + "' has already been used."
                          );
                        this.isLocked = true, this.previous && this.previous.lock();
                      },
                      toString: function() {
                        var e4 = "Worker " + this.name;
                        return this.previous ? this.previous + " -> " + e4 : e4;
                      }
                    }, t3.exports = a2;
                  },
                  {}
                ],
                29: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = e3("../utils"), o2 = e3("./ConvertWorker"), i2 = e3("./GenericWorker"), r2 = e3("../base64"), s2 = e3("../support"), l2 = e3("../external"), c2 = null;
                    if (s2.nodestream)
                      try {
                        c2 = e3("../nodejs/NodejsStreamOutputAdapter");
                      } catch (e4) {
                      }
                    function u2(e4, t4, n3) {
                      var r3 = t4;
                      switch (t4) {
                        case "blob":
                        case "arraybuffer":
                          r3 = "uint8array";
                          break;
                        case "base64":
                          r3 = "string";
                      }
                      try {
                        this._internalType = r3, this._outputType = t4, this._mimeType = n3, a2.checkSupport(r3), this._worker = e4.pipe(new o2(r3)), e4.lock();
                      } catch (e5) {
                        this._worker = new i2("error"), this._worker.error(e5);
                      }
                    }
                    u2.prototype = {
                      accumulate: function(e4) {
                        return function(e5, t4) {
                          return new l2.Promise(function(n3, o3) {
                            var i3 = [], s3 = e5._internalType, l3 = e5._outputType, c3 = e5._mimeType;
                            e5.on("data", function(e6, n4) {
                              i3.push(e6), t4 && t4(n4);
                            }).on("error", function(e6) {
                              i3 = [], o3(e6);
                            }).on("end", function() {
                              try {
                                var e6 = function(e7, t5, n4) {
                                  switch (e7) {
                                    case "blob":
                                      return a2.newBlob(
                                        a2.transformTo("arraybuffer", t5),
                                        n4
                                      );
                                    case "base64":
                                      return r2.encode(t5);
                                    default:
                                      return a2.transformTo(e7, t5);
                                  }
                                }(
                                  l3,
                                  function(e7, t5) {
                                    var n4, a3 = 0, o4 = null, i4 = 0;
                                    for (n4 = 0; n4 < t5.length; n4++)
                                      i4 += t5[n4].length;
                                    switch (e7) {
                                      case "string":
                                        return t5.join("");
                                      case "array":
                                        return Array.prototype.concat.apply(
                                          [],
                                          t5
                                        );
                                      case "uint8array":
                                        for (o4 = new Uint8Array(i4), n4 = 0; n4 < t5.length; n4++)
                                          o4.set(t5[n4], a3), a3 += t5[n4].length;
                                        return o4;
                                      case "nodebuffer":
                                        return Buffer.concat(t5);
                                      default:
                                        throw new Error(
                                          "concat : unsupported type '" + e7 + "'"
                                        );
                                    }
                                  }(s3, i3),
                                  c3
                                );
                                n3(e6);
                              } catch (e7) {
                                o3(e7);
                              }
                              i3 = [];
                            }).resume();
                          });
                        }(this, e4);
                      },
                      on: function(e4, t4) {
                        var n3 = this;
                        return e4 === "data" ? this._worker.on(e4, function(e5) {
                          t4.call(n3, e5.data, e5.meta);
                        }) : this._worker.on(e4, function() {
                          a2.delay(t4, arguments, n3);
                        }), this;
                      },
                      resume: function() {
                        return a2.delay(this._worker.resume, [], this._worker), this;
                      },
                      pause: function() {
                        return this._worker.pause(), this;
                      },
                      toNodejsStream: function(e4) {
                        if (a2.checkSupport("nodestream"), this._outputType !== "nodebuffer")
                          throw new Error(
                            this._outputType + " is not supported by this method"
                          );
                        return new c2(
                          this,
                          { objectMode: this._outputType !== "nodebuffer" },
                          e4
                        );
                      }
                    }, t3.exports = u2;
                  },
                  {
                    "../base64": 1,
                    "../external": 6,
                    "../nodejs/NodejsStreamOutputAdapter": 13,
                    "../support": 30,
                    "../utils": 32,
                    "./ConvertWorker": 24,
                    "./GenericWorker": 28
                  }
                ],
                30: [
                  function(e3, t3, n2) {
                    "use strict";
                    if (n2.base64 = true, n2.array = true, n2.string = true, n2.arraybuffer = typeof ArrayBuffer != "undefined" && typeof Uint8Array != "undefined", n2.nodebuffer = typeof Buffer != "undefined", n2.uint8array = typeof Uint8Array != "undefined", typeof ArrayBuffer == "undefined")
                      n2.blob = false;
                    else {
                      var a2 = new ArrayBuffer(0);
                      try {
                        n2.blob = new Blob([a2], { type: "application/zip" }).size === 0;
                      } catch (e4) {
                        try {
                          var o2 = new (self.BlobBuilder || self.WebKitBlobBuilder || self.MozBlobBuilder || self.MSBlobBuilder)();
                          o2.append(a2), n2.blob = o2.getBlob("application/zip").size === 0;
                        } catch (e5) {
                          n2.blob = false;
                        }
                      }
                    }
                    try {
                      n2.nodestream = !!e3("readable-stream").Readable;
                    } catch (e4) {
                      n2.nodestream = false;
                    }
                  },
                  { "readable-stream": 16 }
                ],
                31: [
                  function(e3, t3, n2) {
                    "use strict";
                    for (var a2 = e3("./utils"), o2 = e3("./support"), i2 = e3("./nodejsUtils"), r2 = e3("./stream/GenericWorker"), s2 = new Array(256), l2 = 0; l2 < 256; l2++)
                      s2[l2] = l2 >= 252 ? 6 : l2 >= 248 ? 5 : l2 >= 240 ? 4 : l2 >= 224 ? 3 : l2 >= 192 ? 2 : 1;
                    function c2() {
                      r2.call(this, "utf-8 decode"), this.leftOver = null;
                    }
                    function u2() {
                      r2.call(this, "utf-8 encode");
                    }
                    s2[254] = s2[254] = 1, n2.utf8encode = function(e4) {
                      return o2.nodebuffer ? i2.newBufferFrom(e4, "utf-8") : function(e5) {
                        var t4, n3, a3, i3, r3, s3 = e5.length, l3 = 0;
                        for (i3 = 0; i3 < s3; i3++)
                          (64512 & (n3 = e5.charCodeAt(i3))) == 55296 && i3 + 1 < s3 && (64512 & (a3 = e5.charCodeAt(i3 + 1))) == 56320 && (n3 = 65536 + (n3 - 55296 << 10) + (a3 - 56320), i3++), l3 += n3 < 128 ? 1 : n3 < 2048 ? 2 : n3 < 65536 ? 3 : 4;
                        for (t4 = o2.uint8array ? new Uint8Array(l3) : new Array(l3), i3 = r3 = 0; r3 < l3; i3++)
                          (64512 & (n3 = e5.charCodeAt(i3))) == 55296 && i3 + 1 < s3 && (64512 & (a3 = e5.charCodeAt(i3 + 1))) == 56320 && (n3 = 65536 + (n3 - 55296 << 10) + (a3 - 56320), i3++), n3 < 128 ? t4[r3++] = n3 : (n3 < 2048 ? t4[r3++] = 192 | n3 >>> 6 : (n3 < 65536 ? t4[r3++] = 224 | n3 >>> 12 : (t4[r3++] = 240 | n3 >>> 18, t4[r3++] = 128 | n3 >>> 12 & 63), t4[r3++] = 128 | n3 >>> 6 & 63), t4[r3++] = 128 | 63 & n3);
                        return t4;
                      }(e4);
                    }, n2.utf8decode = function(e4) {
                      return o2.nodebuffer ? a2.transformTo("nodebuffer", e4).toString("utf-8") : function(e5) {
                        var t4, n3, o3, i3, r3 = e5.length, l3 = new Array(2 * r3);
                        for (t4 = n3 = 0; t4 < r3; )
                          if ((o3 = e5[t4++]) < 128) l3[n3++] = o3;
                          else if ((i3 = s2[o3]) > 4)
                            l3[n3++] = 65533, t4 += i3 - 1;
                          else {
                            for (o3 &= i3 === 2 ? 31 : i3 === 3 ? 15 : 7; i3 > 1 && t4 < r3; )
                              o3 = o3 << 6 | 63 & e5[t4++], i3--;
                            i3 > 1 ? l3[n3++] = 65533 : o3 < 65536 ? l3[n3++] = o3 : (o3 -= 65536, l3[n3++] = 55296 | o3 >> 10 & 1023, l3[n3++] = 56320 | 1023 & o3);
                          }
                        return l3.length !== n3 && (l3.subarray ? l3 = l3.subarray(0, n3) : l3.length = n3), a2.applyFromCharCode(l3);
                      }(
                        e4 = a2.transformTo(
                          o2.uint8array ? "uint8array" : "array",
                          e4
                        )
                      );
                    }, a2.inherits(c2, r2), c2.prototype.processChunk = function(e4) {
                      var t4 = a2.transformTo(
                        o2.uint8array ? "uint8array" : "array",
                        e4.data
                      );
                      if (this.leftOver && this.leftOver.length) {
                        if (o2.uint8array) {
                          var i3 = t4;
                          (t4 = new Uint8Array(
                            i3.length + this.leftOver.length
                          )).set(this.leftOver, 0), t4.set(i3, this.leftOver.length);
                        } else t4 = this.leftOver.concat(t4);
                        this.leftOver = null;
                      }
                      var r3 = function(e5, t5) {
                        var n3;
                        for ((t5 = t5 || e5.length) > e5.length && (t5 = e5.length), n3 = t5 - 1; n3 >= 0 && (192 & e5[n3]) == 128; )
                          n3--;
                        return n3 < 0 || n3 === 0 ? t5 : n3 + s2[e5[n3]] > t5 ? n3 : t5;
                      }(t4), l3 = t4;
                      r3 !== t4.length && (o2.uint8array ? (l3 = t4.subarray(0, r3), this.leftOver = t4.subarray(r3, t4.length)) : (l3 = t4.slice(0, r3), this.leftOver = t4.slice(r3, t4.length))), this.push({ data: n2.utf8decode(l3), meta: e4.meta });
                    }, c2.prototype.flush = function() {
                      this.leftOver && this.leftOver.length && (this.push({
                        data: n2.utf8decode(this.leftOver),
                        meta: {}
                      }), this.leftOver = null);
                    }, n2.Utf8DecodeWorker = c2, a2.inherits(u2, r2), u2.prototype.processChunk = function(e4) {
                      this.push({ data: n2.utf8encode(e4.data), meta: e4.meta });
                    }, n2.Utf8EncodeWorker = u2;
                  },
                  {
                    "./nodejsUtils": 14,
                    "./stream/GenericWorker": 28,
                    "./support": 30,
                    "./utils": 32
                  }
                ],
                32: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = e3("./support"), o2 = e3("./base64"), i2 = e3("./nodejsUtils"), r2 = e3("./external");
                    function s2(e4) {
                      return e4;
                    }
                    function l2(e4, t4) {
                      for (var n3 = 0; n3 < e4.length; ++n3)
                        t4[n3] = 255 & e4.charCodeAt(n3);
                      return t4;
                    }
                    e3("setimmediate"), n2.newBlob = function(e4, t4) {
                      n2.checkSupport("blob");
                      try {
                        return new Blob([e4], { type: t4 });
                      } catch (n3) {
                        try {
                          var a3 = new (self.BlobBuilder || self.WebKitBlobBuilder || self.MozBlobBuilder || self.MSBlobBuilder)();
                          return a3.append(e4), a3.getBlob(t4);
                        } catch (e5) {
                          throw new Error("Bug : can't construct the Blob.");
                        }
                      }
                    };
                    var c2 = {
                      stringifyByChunk: function(e4, t4, n3) {
                        var a3 = [], o3 = 0, i3 = e4.length;
                        if (i3 <= n3) return String.fromCharCode.apply(null, e4);
                        for (; o3 < i3; )
                          t4 === "array" || t4 === "nodebuffer" ? a3.push(
                            String.fromCharCode.apply(
                              null,
                              e4.slice(o3, Math.min(o3 + n3, i3))
                            )
                          ) : a3.push(
                            String.fromCharCode.apply(
                              null,
                              e4.subarray(o3, Math.min(o3 + n3, i3))
                            )
                          ), o3 += n3;
                        return a3.join("");
                      },
                      stringifyByChar: function(e4) {
                        for (var t4 = "", n3 = 0; n3 < e4.length; n3++)
                          t4 += String.fromCharCode(e4[n3]);
                        return t4;
                      },
                      applyCanBeUsed: {
                        uint8array: function() {
                          try {
                            return a2.uint8array && String.fromCharCode.apply(null, new Uint8Array(1)).length === 1;
                          } catch (e4) {
                            return false;
                          }
                        }(),
                        nodebuffer: function() {
                          try {
                            return a2.nodebuffer && String.fromCharCode.apply(null, i2.allocBuffer(1)).length === 1;
                          } catch (e4) {
                            return false;
                          }
                        }()
                      }
                    };
                    function u2(e4) {
                      var t4 = 65536, a3 = n2.getTypeOf(e4), o3 = true;
                      if (a3 === "uint8array" ? o3 = c2.applyCanBeUsed.uint8array : a3 === "nodebuffer" && (o3 = c2.applyCanBeUsed.nodebuffer), o3)
                        for (; t4 > 1; )
                          try {
                            return c2.stringifyByChunk(e4, a3, t4);
                          } catch (e5) {
                            t4 = Math.floor(t4 / 2);
                          }
                      return c2.stringifyByChar(e4);
                    }
                    function p2(e4, t4) {
                      for (var n3 = 0; n3 < e4.length; n3++) t4[n3] = e4[n3];
                      return t4;
                    }
                    n2.applyFromCharCode = u2;
                    var d2 = {};
                    d2.string = {
                      string: s2,
                      array: function(e4) {
                        return l2(e4, new Array(e4.length));
                      },
                      arraybuffer: function(e4) {
                        return d2.string.uint8array(e4).buffer;
                      },
                      uint8array: function(e4) {
                        return l2(e4, new Uint8Array(e4.length));
                      },
                      nodebuffer: function(e4) {
                        return l2(e4, i2.allocBuffer(e4.length));
                      }
                    }, d2.array = {
                      string: u2,
                      array: s2,
                      arraybuffer: function(e4) {
                        return new Uint8Array(e4).buffer;
                      },
                      uint8array: function(e4) {
                        return new Uint8Array(e4);
                      },
                      nodebuffer: function(e4) {
                        return i2.newBufferFrom(e4);
                      }
                    }, d2.arraybuffer = {
                      string: function(e4) {
                        return u2(new Uint8Array(e4));
                      },
                      array: function(e4) {
                        return p2(new Uint8Array(e4), new Array(e4.byteLength));
                      },
                      arraybuffer: s2,
                      uint8array: function(e4) {
                        return new Uint8Array(e4);
                      },
                      nodebuffer: function(e4) {
                        return i2.newBufferFrom(new Uint8Array(e4));
                      }
                    }, d2.uint8array = {
                      string: u2,
                      array: function(e4) {
                        return p2(e4, new Array(e4.length));
                      },
                      arraybuffer: function(e4) {
                        return e4.buffer;
                      },
                      uint8array: s2,
                      nodebuffer: function(e4) {
                        return i2.newBufferFrom(e4);
                      }
                    }, d2.nodebuffer = {
                      string: u2,
                      array: function(e4) {
                        return p2(e4, new Array(e4.length));
                      },
                      arraybuffer: function(e4) {
                        return d2.nodebuffer.uint8array(e4).buffer;
                      },
                      uint8array: function(e4) {
                        return p2(e4, new Uint8Array(e4.length));
                      },
                      nodebuffer: s2
                    }, n2.transformTo = function(e4, t4) {
                      if (t4 = t4 || "", !e4) return t4;
                      n2.checkSupport(e4);
                      var a3 = n2.getTypeOf(t4);
                      return d2[a3][e4](t4);
                    }, n2.resolve = function(e4) {
                      for (var t4 = e4.split("/"), n3 = [], a3 = 0; a3 < t4.length; a3++) {
                        var o3 = t4[a3];
                        o3 === "." || o3 === "" && a3 !== 0 && a3 !== t4.length - 1 || (o3 === ".." ? n3.pop() : n3.push(o3));
                      }
                      return n3.join("/");
                    }, n2.getTypeOf = function(e4) {
                      return typeof e4 == "string" ? "string" : Object.prototype.toString.call(e4) === "[object Array]" ? "array" : a2.nodebuffer && i2.isBuffer(e4) ? "nodebuffer" : a2.uint8array && e4 instanceof Uint8Array ? "uint8array" : a2.arraybuffer && e4 instanceof ArrayBuffer ? "arraybuffer" : void 0;
                    }, n2.checkSupport = function(e4) {
                      if (!a2[e4.toLowerCase()])
                        throw new Error(
                          e4 + " is not supported by this platform"
                        );
                    }, n2.MAX_VALUE_16BITS = 65535, n2.MAX_VALUE_32BITS = -1, n2.pretty = function(e4) {
                      var t4, n3, a3 = "";
                      for (n3 = 0; n3 < (e4 || "").length; n3++)
                        a3 += "\\x" + ((t4 = e4.charCodeAt(n3)) < 16 ? "0" : "") + t4.toString(16).toUpperCase();
                      return a3;
                    }, n2.delay = function(e4, t4, n3) {
                      setImmediate(function() {
                        e4.apply(n3 || null, t4 || []);
                      });
                    }, n2.inherits = function(e4, t4) {
                      function n3() {
                      }
                      n3.prototype = t4.prototype, e4.prototype = new n3();
                    }, n2.extend = function() {
                      var e4, t4, n3 = {};
                      for (e4 = 0; e4 < arguments.length; e4++)
                        for (t4 in arguments[e4])
                          Object.prototype.hasOwnProperty.call(
                            arguments[e4],
                            t4
                          ) && void 0 === n3[t4] && (n3[t4] = arguments[e4][t4]);
                      return n3;
                    }, n2.prepareContent = function(e4, t4, i3, s3, c3) {
                      return r2.Promise.resolve(t4).then(function(e5) {
                        return a2.blob && (e5 instanceof Blob || -1 !== ["[object File]", "[object Blob]"].indexOf(
                          Object.prototype.toString.call(e5)
                        )) && typeof FileReader != "undefined" ? new r2.Promise(function(t5, n3) {
                          var a3 = new FileReader();
                          a3.onload = function(e6) {
                            t5(e6.target.result);
                          }, a3.onerror = function(e6) {
                            n3(e6.target.error);
                          }, a3.readAsArrayBuffer(e5);
                        }) : e5;
                      }).then(function(t5) {
                        var u3, p3 = n2.getTypeOf(t5);
                        return p3 ? (p3 === "arraybuffer" ? t5 = n2.transformTo("uint8array", t5) : p3 === "string" && (c3 ? t5 = o2.decode(t5) : i3 && true !== s3 && (t5 = l2(
                          u3 = t5,
                          a2.uint8array ? new Uint8Array(u3.length) : new Array(u3.length)
                        ))), t5) : r2.Promise.reject(
                          new Error(
                            "Can't read the data of '" + e4 + "'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"
                          )
                        );
                      });
                    };
                  },
                  {
                    "./base64": 1,
                    "./external": 6,
                    "./nodejsUtils": 14,
                    "./support": 30,
                    setimmediate: 54
                  }
                ],
                33: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = e3("./reader/readerFor"), o2 = e3("./utils"), i2 = e3("./signature"), r2 = e3("./zipEntry"), s2 = e3("./support");
                    function l2(e4) {
                      this.files = [], this.loadOptions = e4;
                    }
                    l2.prototype = {
                      checkSignature: function(e4) {
                        if (!this.reader.readAndCheckSignature(e4)) {
                          this.reader.index -= 4;
                          var t4 = this.reader.readString(4);
                          throw new Error(
                            "Corrupted zip or bug: unexpected signature (" + o2.pretty(t4) + ", expected " + o2.pretty(e4) + ")"
                          );
                        }
                      },
                      isSignature: function(e4, t4) {
                        var n3 = this.reader.index;
                        this.reader.setIndex(e4);
                        var a3 = this.reader.readString(4) === t4;
                        return this.reader.setIndex(n3), a3;
                      },
                      readBlockEndOfCentral: function() {
                        this.diskNumber = this.reader.readInt(2), this.diskWithCentralDirStart = this.reader.readInt(2), this.centralDirRecordsOnThisDisk = this.reader.readInt(2), this.centralDirRecords = this.reader.readInt(2), this.centralDirSize = this.reader.readInt(4), this.centralDirOffset = this.reader.readInt(4), this.zipCommentLength = this.reader.readInt(2);
                        var e4 = this.reader.readData(this.zipCommentLength), t4 = s2.uint8array ? "uint8array" : "array", n3 = o2.transformTo(t4, e4);
                        this.zipComment = this.loadOptions.decodeFileName(n3);
                      },
                      readBlockZip64EndOfCentral: function() {
                        this.zip64EndOfCentralSize = this.reader.readInt(8), this.reader.skip(4), this.diskNumber = this.reader.readInt(4), this.diskWithCentralDirStart = this.reader.readInt(4), this.centralDirRecordsOnThisDisk = this.reader.readInt(8), this.centralDirRecords = this.reader.readInt(8), this.centralDirSize = this.reader.readInt(8), this.centralDirOffset = this.reader.readInt(8), this.zip64ExtensibleData = {};
                        for (var e4, t4, n3, a3 = this.zip64EndOfCentralSize - 44; a3 > 0; )
                          e4 = this.reader.readInt(2), t4 = this.reader.readInt(4), n3 = this.reader.readData(t4), this.zip64ExtensibleData[e4] = {
                            id: e4,
                            length: t4,
                            value: n3
                          };
                      },
                      readBlockZip64EndOfCentralLocator: function() {
                        if (this.diskWithZip64CentralDirStart = this.reader.readInt(4), this.relativeOffsetEndOfZip64CentralDir = this.reader.readInt(8), this.disksCount = this.reader.readInt(4), this.disksCount > 1)
                          throw new Error("Multi-volumes zip are not supported");
                      },
                      readLocalFiles: function() {
                        var e4, t4;
                        for (e4 = 0; e4 < this.files.length; e4++)
                          t4 = this.files[e4], this.reader.setIndex(t4.localHeaderOffset), this.checkSignature(i2.LOCAL_FILE_HEADER), t4.readLocalPart(this.reader), t4.handleUTF8(), t4.processAttributes();
                      },
                      readCentralDir: function() {
                        var e4;
                        for (this.reader.setIndex(this.centralDirOffset); this.reader.readAndCheckSignature(
                          i2.CENTRAL_FILE_HEADER
                        ); )
                          (e4 = new r2(
                            { zip64: this.zip64 },
                            this.loadOptions
                          )).readCentralPart(this.reader), this.files.push(e4);
                        if (this.centralDirRecords !== this.files.length && this.centralDirRecords !== 0 && this.files.length === 0)
                          throw new Error(
                            "Corrupted zip or bug: expected " + this.centralDirRecords + " records in central dir, got " + this.files.length
                          );
                      },
                      readEndOfCentral: function() {
                        var e4 = this.reader.lastIndexOfSignature(
                          i2.CENTRAL_DIRECTORY_END
                        );
                        if (e4 < 0)
                          throw this.isSignature(0, i2.LOCAL_FILE_HEADER) ? new Error(
                            "Corrupted zip: can't find end of central directory"
                          ) : new Error(
                            "Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"
                          );
                        this.reader.setIndex(e4);
                        var t4 = e4;
                        if (this.checkSignature(i2.CENTRAL_DIRECTORY_END), this.readBlockEndOfCentral(), this.diskNumber === o2.MAX_VALUE_16BITS || this.diskWithCentralDirStart === o2.MAX_VALUE_16BITS || this.centralDirRecordsOnThisDisk === o2.MAX_VALUE_16BITS || this.centralDirRecords === o2.MAX_VALUE_16BITS || this.centralDirSize === o2.MAX_VALUE_32BITS || this.centralDirOffset === o2.MAX_VALUE_32BITS) {
                          if (this.zip64 = true, (e4 = this.reader.lastIndexOfSignature(
                            i2.ZIP64_CENTRAL_DIRECTORY_LOCATOR
                          )) < 0)
                            throw new Error(
                              "Corrupted zip: can't find the ZIP64 end of central directory locator"
                            );
                          if (this.reader.setIndex(e4), this.checkSignature(
                            i2.ZIP64_CENTRAL_DIRECTORY_LOCATOR
                          ), this.readBlockZip64EndOfCentralLocator(), !this.isSignature(
                            this.relativeOffsetEndOfZip64CentralDir,
                            i2.ZIP64_CENTRAL_DIRECTORY_END
                          ) && (this.relativeOffsetEndOfZip64CentralDir = this.reader.lastIndexOfSignature(
                            i2.ZIP64_CENTRAL_DIRECTORY_END
                          ), this.relativeOffsetEndOfZip64CentralDir < 0))
                            throw new Error(
                              "Corrupted zip: can't find the ZIP64 end of central directory"
                            );
                          this.reader.setIndex(
                            this.relativeOffsetEndOfZip64CentralDir
                          ), this.checkSignature(i2.ZIP64_CENTRAL_DIRECTORY_END), this.readBlockZip64EndOfCentral();
                        }
                        var n3 = this.centralDirOffset + this.centralDirSize;
                        this.zip64 && (n3 += 20, n3 += 12 + this.zip64EndOfCentralSize);
                        var a3 = t4 - n3;
                        if (a3 > 0)
                          this.isSignature(t4, i2.CENTRAL_FILE_HEADER) || (this.reader.zero = a3);
                        else if (a3 < 0)
                          throw new Error(
                            "Corrupted zip: missing " + Math.abs(a3) + " bytes."
                          );
                      },
                      prepareReader: function(e4) {
                        this.reader = a2(e4);
                      },
                      load: function(e4) {
                        this.prepareReader(e4), this.readEndOfCentral(), this.readCentralDir(), this.readLocalFiles();
                      }
                    }, t3.exports = l2;
                  },
                  {
                    "./reader/readerFor": 22,
                    "./signature": 23,
                    "./support": 30,
                    "./utils": 32,
                    "./zipEntry": 34
                  }
                ],
                34: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = e3("./reader/readerFor"), o2 = e3("./utils"), i2 = e3("./compressedObject"), r2 = e3("./crc32"), s2 = e3("./utf8"), l2 = e3("./compressions"), c2 = e3("./support");
                    function u2(e4, t4) {
                      this.options = e4, this.loadOptions = t4;
                    }
                    u2.prototype = {
                      isEncrypted: function() {
                        return (1 & this.bitFlag) == 1;
                      },
                      useUTF8: function() {
                        return (2048 & this.bitFlag) == 2048;
                      },
                      readLocalPart: function(e4) {
                        var t4, n3;
                        if (e4.skip(22), this.fileNameLength = e4.readInt(2), n3 = e4.readInt(2), this.fileName = e4.readData(this.fileNameLength), e4.skip(n3), -1 === this.compressedSize || -1 === this.uncompressedSize)
                          throw new Error(
                            "Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)"
                          );
                        if ((t4 = function(e5) {
                          for (var t5 in l2)
                            if (Object.prototype.hasOwnProperty.call(l2, t5) && l2[t5].magic === e5)
                              return l2[t5];
                          return null;
                        }(this.compressionMethod)) === null)
                          throw new Error(
                            "Corrupted zip : compression " + o2.pretty(this.compressionMethod) + " unknown (inner file : " + o2.transformTo("string", this.fileName) + ")"
                          );
                        this.decompressed = new i2(
                          this.compressedSize,
                          this.uncompressedSize,
                          this.crc32,
                          t4,
                          e4.readData(this.compressedSize)
                        );
                      },
                      readCentralPart: function(e4) {
                        this.versionMadeBy = e4.readInt(2), e4.skip(2), this.bitFlag = e4.readInt(2), this.compressionMethod = e4.readString(2), this.date = e4.readDate(), this.crc32 = e4.readInt(4), this.compressedSize = e4.readInt(4), this.uncompressedSize = e4.readInt(4);
                        var t4 = e4.readInt(2);
                        if (this.extraFieldsLength = e4.readInt(2), this.fileCommentLength = e4.readInt(2), this.diskNumberStart = e4.readInt(2), this.internalFileAttributes = e4.readInt(2), this.externalFileAttributes = e4.readInt(4), this.localHeaderOffset = e4.readInt(4), this.isEncrypted())
                          throw new Error("Encrypted zip are not supported");
                        e4.skip(t4), this.readExtraFields(e4), this.parseZIP64ExtraField(e4), this.fileComment = e4.readData(
                          this.fileCommentLength
                        );
                      },
                      processAttributes: function() {
                        this.unixPermissions = null, this.dosPermissions = null;
                        var e4 = this.versionMadeBy >> 8;
                        this.dir = !!(16 & this.externalFileAttributes), e4 == 0 && (this.dosPermissions = 63 & this.externalFileAttributes), e4 == 3 && (this.unixPermissions = this.externalFileAttributes >> 16 & 65535), this.dir || this.fileNameStr.slice(-1) !== "/" || (this.dir = true);
                      },
                      parseZIP64ExtraField: function() {
                        if (this.extraFields[1]) {
                          var e4 = a2(this.extraFields[1].value);
                          this.uncompressedSize === o2.MAX_VALUE_32BITS && (this.uncompressedSize = e4.readInt(8)), this.compressedSize === o2.MAX_VALUE_32BITS && (this.compressedSize = e4.readInt(8)), this.localHeaderOffset === o2.MAX_VALUE_32BITS && (this.localHeaderOffset = e4.readInt(8)), this.diskNumberStart === o2.MAX_VALUE_32BITS && (this.diskNumberStart = e4.readInt(4));
                        }
                      },
                      readExtraFields: function(e4) {
                        var t4, n3, a3, o3 = e4.index + this.extraFieldsLength;
                        for (this.extraFields || (this.extraFields = {}); e4.index + 4 < o3; )
                          t4 = e4.readInt(2), n3 = e4.readInt(2), a3 = e4.readData(n3), this.extraFields[t4] = {
                            id: t4,
                            length: n3,
                            value: a3
                          };
                        e4.setIndex(o3);
                      },
                      handleUTF8: function() {
                        var e4 = c2.uint8array ? "uint8array" : "array";
                        if (this.useUTF8())
                          this.fileNameStr = s2.utf8decode(this.fileName), this.fileCommentStr = s2.utf8decode(
                            this.fileComment
                          );
                        else {
                          var t4 = this.findExtraFieldUnicodePath();
                          if (t4 !== null) this.fileNameStr = t4;
                          else {
                            var n3 = o2.transformTo(e4, this.fileName);
                            this.fileNameStr = this.loadOptions.decodeFileName(n3);
                          }
                          var a3 = this.findExtraFieldUnicodeComment();
                          if (a3 !== null) this.fileCommentStr = a3;
                          else {
                            var i3 = o2.transformTo(e4, this.fileComment);
                            this.fileCommentStr = this.loadOptions.decodeFileName(i3);
                          }
                        }
                      },
                      findExtraFieldUnicodePath: function() {
                        var e4 = this.extraFields[28789];
                        if (e4) {
                          var t4 = a2(e4.value);
                          return t4.readInt(1) !== 1 || r2(this.fileName) !== t4.readInt(4) ? null : s2.utf8decode(t4.readData(e4.length - 5));
                        }
                        return null;
                      },
                      findExtraFieldUnicodeComment: function() {
                        var e4 = this.extraFields[25461];
                        if (e4) {
                          var t4 = a2(e4.value);
                          return t4.readInt(1) !== 1 || r2(this.fileComment) !== t4.readInt(4) ? null : s2.utf8decode(t4.readData(e4.length - 5));
                        }
                        return null;
                      }
                    }, t3.exports = u2;
                  },
                  {
                    "./compressedObject": 2,
                    "./compressions": 3,
                    "./crc32": 4,
                    "./reader/readerFor": 22,
                    "./support": 30,
                    "./utf8": 31,
                    "./utils": 32
                  }
                ],
                35: [
                  function(e3, t3, n2) {
                    "use strict";
                    function a2(e4, t4, n3) {
                      this.name = e4, this.dir = n3.dir, this.date = n3.date, this.comment = n3.comment, this.unixPermissions = n3.unixPermissions, this.dosPermissions = n3.dosPermissions, this._data = t4, this._dataBinary = n3.binary, this.options = {
                        compression: n3.compression,
                        compressionOptions: n3.compressionOptions
                      };
                    }
                    var o2 = e3("./stream/StreamHelper"), i2 = e3("./stream/DataWorker"), r2 = e3("./utf8"), s2 = e3("./compressedObject"), l2 = e3("./stream/GenericWorker");
                    a2.prototype = {
                      internalStream: function(e4) {
                        var t4 = null, n3 = "string";
                        try {
                          if (!e4) throw new Error("No output type specified.");
                          var a3 = (n3 = e4.toLowerCase()) === "string" || n3 === "text";
                          n3 !== "binarystring" && n3 !== "text" || (n3 = "string"), t4 = this._decompressWorker();
                          var i3 = !this._dataBinary;
                          i3 && !a3 && (t4 = t4.pipe(new r2.Utf8EncodeWorker())), !i3 && a3 && (t4 = t4.pipe(new r2.Utf8DecodeWorker()));
                        } catch (e5) {
                          (t4 = new l2("error")).error(e5);
                        }
                        return new o2(t4, n3, "");
                      },
                      async: function(e4, t4) {
                        return this.internalStream(e4).accumulate(t4);
                      },
                      nodeStream: function(e4, t4) {
                        return this.internalStream(
                          e4 || "nodebuffer"
                        ).toNodejsStream(t4);
                      },
                      _compressWorker: function(e4, t4) {
                        if (this._data instanceof s2 && this._data.compression.magic === e4.magic)
                          return this._data.getCompressedWorker();
                        var n3 = this._decompressWorker();
                        return this._dataBinary || (n3 = n3.pipe(new r2.Utf8EncodeWorker())), s2.createWorkerFrom(n3, e4, t4);
                      },
                      _decompressWorker: function() {
                        return this._data instanceof s2 ? this._data.getContentWorker() : this._data instanceof l2 ? this._data : new i2(this._data);
                      }
                    };
                    for (var c2 = [
                      "asText",
                      "asBinary",
                      "asNodeBuffer",
                      "asUint8Array",
                      "asArrayBuffer"
                    ], u2 = function() {
                      throw new Error(
                        "This method has been removed in JSZip 3.0, please check the upgrade guide."
                      );
                    }, p2 = 0; p2 < c2.length; p2++)
                      a2.prototype[c2[p2]] = u2;
                    t3.exports = a2;
                  },
                  {
                    "./compressedObject": 2,
                    "./stream/DataWorker": 27,
                    "./stream/GenericWorker": 28,
                    "./stream/StreamHelper": 29,
                    "./utf8": 31
                  }
                ],
                36: [
                  function(e3, t3, n2) {
                    (function(e4) {
                      "use strict";
                      var n3, a2, o2 = e4.MutationObserver || e4.WebKitMutationObserver;
                      if (o2) {
                        var i2 = 0, r2 = new o2(u2), s2 = e4.document.createTextNode("");
                        r2.observe(s2, { characterData: true }), n3 = function() {
                          s2.data = i2 = ++i2 % 2;
                        };
                      } else if (e4.setImmediate || void 0 === e4.MessageChannel)
                        n3 = "document" in e4 && "onreadystatechange" in e4.document.createElement("script") ? function() {
                          var t4 = e4.document.createElement("script");
                          t4.onreadystatechange = function() {
                            u2(), t4.onreadystatechange = null, t4.parentNode.removeChild(t4), t4 = null;
                          }, e4.document.documentElement.appendChild(t4);
                        } : function() {
                          setTimeout(u2, 0);
                        };
                      else {
                        var l2 = new e4.MessageChannel();
                        l2.port1.onmessage = u2, n3 = function() {
                          l2.port2.postMessage(0);
                        };
                      }
                      var c2 = [];
                      function u2() {
                        var e5, t4;
                        a2 = true;
                        for (var n4 = c2.length; n4; ) {
                          for (t4 = c2, c2 = [], e5 = -1; ++e5 < n4; ) t4[e5]();
                          n4 = c2.length;
                        }
                        a2 = false;
                      }
                      t3.exports = function(e5) {
                        c2.push(e5) !== 1 || a2 || n3();
                      };
                    }).call(
                      this,
                      typeof global != "undefined" ? global : typeof self != "undefined" ? self : typeof window != "undefined" ? window : {}
                    );
                  },
                  {}
                ],
                37: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = e3("immediate");
                    function o2() {
                    }
                    var i2 = {}, r2 = ["REJECTED"], s2 = ["FULFILLED"], l2 = ["PENDING"];
                    function c2(e4) {
                      if (typeof e4 != "function")
                        throw new TypeError("resolver must be a function");
                      this.state = l2, this.queue = [], this.outcome = void 0, e4 !== o2 && m2(this, e4);
                    }
                    function u2(e4, t4, n3) {
                      this.promise = e4, typeof t4 == "function" && (this.onFulfilled = t4, this.callFulfilled = this.otherCallFulfilled), typeof n3 == "function" && (this.onRejected = n3, this.callRejected = this.otherCallRejected);
                    }
                    function p2(e4, t4, n3) {
                      a2(function() {
                        var a3;
                        try {
                          a3 = t4(n3);
                        } catch (t5) {
                          return i2.reject(e4, t5);
                        }
                        a3 === e4 ? i2.reject(
                          e4,
                          new TypeError("Cannot resolve promise with itself")
                        ) : i2.resolve(e4, a3);
                      });
                    }
                    function d2(e4) {
                      var t4 = e4 && e4.then;
                      if (e4 && (typeof e4 == "object" || typeof e4 == "function") && typeof t4 == "function")
                        return function() {
                          t4.apply(e4, arguments);
                        };
                    }
                    function m2(e4, t4) {
                      var n3 = false;
                      function a3(t5) {
                        n3 || (n3 = true, i2.reject(e4, t5));
                      }
                      function o3(t5) {
                        n3 || (n3 = true, i2.resolve(e4, t5));
                      }
                      var r3 = h(function() {
                        t4(o3, a3);
                      });
                      r3.status === "error" && a3(r3.value);
                    }
                    function h(e4, t4) {
                      var n3 = {};
                      try {
                        n3.value = e4(t4), n3.status = "success";
                      } catch (e5) {
                        n3.status = "error", n3.value = e5;
                      }
                      return n3;
                    }
                    (t3.exports = c2).prototype.finally = function(e4) {
                      if (typeof e4 != "function") return this;
                      var t4 = this.constructor;
                      return this.then(
                        function(n3) {
                          return t4.resolve(e4()).then(function() {
                            return n3;
                          });
                        },
                        function(n3) {
                          return t4.resolve(e4()).then(function() {
                            throw n3;
                          });
                        }
                      );
                    }, c2.prototype.catch = function(e4) {
                      return this.then(null, e4);
                    }, c2.prototype.then = function(e4, t4) {
                      if (typeof e4 != "function" && this.state === s2 || typeof t4 != "function" && this.state === r2)
                        return this;
                      var n3 = new this.constructor(o2);
                      return this.state !== l2 ? p2(n3, this.state === s2 ? e4 : t4, this.outcome) : this.queue.push(new u2(n3, e4, t4)), n3;
                    }, u2.prototype.callFulfilled = function(e4) {
                      i2.resolve(this.promise, e4);
                    }, u2.prototype.otherCallFulfilled = function(e4) {
                      p2(this.promise, this.onFulfilled, e4);
                    }, u2.prototype.callRejected = function(e4) {
                      i2.reject(this.promise, e4);
                    }, u2.prototype.otherCallRejected = function(e4) {
                      p2(this.promise, this.onRejected, e4);
                    }, i2.resolve = function(e4, t4) {
                      var n3 = h(d2, t4);
                      if (n3.status === "error") return i2.reject(e4, n3.value);
                      var a3 = n3.value;
                      if (a3) m2(e4, a3);
                      else {
                        e4.state = s2, e4.outcome = t4;
                        for (var o3 = -1, r3 = e4.queue.length; ++o3 < r3; )
                          e4.queue[o3].callFulfilled(t4);
                      }
                      return e4;
                    }, i2.reject = function(e4, t4) {
                      e4.state = r2, e4.outcome = t4;
                      for (var n3 = -1, a3 = e4.queue.length; ++n3 < a3; )
                        e4.queue[n3].callRejected(t4);
                      return e4;
                    }, c2.resolve = function(e4) {
                      return e4 instanceof this ? e4 : i2.resolve(new this(o2), e4);
                    }, c2.reject = function(e4) {
                      var t4 = new this(o2);
                      return i2.reject(t4, e4);
                    }, c2.all = function(e4) {
                      var t4 = this;
                      if (Object.prototype.toString.call(e4) !== "[object Array]")
                        return this.reject(new TypeError("must be an array"));
                      var n3 = e4.length, a3 = false;
                      if (!n3) return this.resolve([]);
                      for (var r3 = new Array(n3), s3 = 0, l3 = -1, c3 = new this(o2); ++l3 < n3; )
                        u3(e4[l3], l3);
                      return c3;
                      function u3(e5, o3) {
                        t4.resolve(e5).then(
                          function(e6) {
                            r3[o3] = e6, ++s3 !== n3 || a3 || (a3 = true, i2.resolve(c3, r3));
                          },
                          function(e6) {
                            a3 || (a3 = true, i2.reject(c3, e6));
                          }
                        );
                      }
                    }, c2.race = function(e4) {
                      if (Object.prototype.toString.call(e4) !== "[object Array]")
                        return this.reject(new TypeError("must be an array"));
                      var t4 = e4.length, n3 = false;
                      if (!t4) return this.resolve([]);
                      for (var a3, r3 = -1, s3 = new this(o2); ++r3 < t4; )
                        a3 = e4[r3], this.resolve(a3).then(
                          function(e5) {
                            n3 || (n3 = true, i2.resolve(s3, e5));
                          },
                          function(e5) {
                            n3 || (n3 = true, i2.reject(s3, e5));
                          }
                        );
                      return s3;
                    };
                  },
                  { immediate: 36 }
                ],
                38: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = {};
                    (0, e3("./lib/utils/common").assign)(
                      a2,
                      e3("./lib/deflate"),
                      e3("./lib/inflate"),
                      e3("./lib/zlib/constants")
                    ), t3.exports = a2;
                  },
                  {
                    "./lib/deflate": 39,
                    "./lib/inflate": 40,
                    "./lib/utils/common": 41,
                    "./lib/zlib/constants": 44
                  }
                ],
                39: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = e3("./zlib/deflate"), o2 = e3("./utils/common"), i2 = e3("./utils/strings"), r2 = e3("./zlib/messages"), s2 = e3("./zlib/zstream"), l2 = Object.prototype.toString;
                    function c2(e4) {
                      if (!(this instanceof c2)) return new c2(e4);
                      this.options = o2.assign(
                        {
                          level: -1,
                          method: 8,
                          chunkSize: 16384,
                          windowBits: 15,
                          memLevel: 8,
                          strategy: 0,
                          to: ""
                        },
                        e4 || {}
                      );
                      var t4 = this.options;
                      t4.raw && t4.windowBits > 0 ? t4.windowBits = -t4.windowBits : t4.gzip && t4.windowBits > 0 && t4.windowBits < 16 && (t4.windowBits += 16), this.err = 0, this.msg = "", this.ended = false, this.chunks = [], this.strm = new s2(), this.strm.avail_out = 0;
                      var n3 = a2.deflateInit2(
                        this.strm,
                        t4.level,
                        t4.method,
                        t4.windowBits,
                        t4.memLevel,
                        t4.strategy
                      );
                      if (n3 !== 0) throw new Error(r2[n3]);
                      if (t4.header && a2.deflateSetHeader(this.strm, t4.header), t4.dictionary) {
                        var u3;
                        if (u3 = typeof t4.dictionary == "string" ? i2.string2buf(t4.dictionary) : l2.call(t4.dictionary) === "[object ArrayBuffer]" ? new Uint8Array(t4.dictionary) : t4.dictionary, (n3 = a2.deflateSetDictionary(this.strm, u3)) !== 0)
                          throw new Error(r2[n3]);
                        this._dict_set = true;
                      }
                    }
                    function u2(e4, t4) {
                      var n3 = new c2(t4);
                      if (n3.push(e4, true), n3.err) throw n3.msg || r2[n3.err];
                      return n3.result;
                    }
                    c2.prototype.push = function(e4, t4) {
                      var n3, r3, s3 = this.strm, c3 = this.options.chunkSize;
                      if (this.ended) return false;
                      r3 = t4 === ~~t4 ? t4 : true === t4 ? 4 : 0, typeof e4 == "string" ? s3.input = i2.string2buf(e4) : l2.call(e4) === "[object ArrayBuffer]" ? s3.input = new Uint8Array(e4) : s3.input = e4, s3.next_in = 0, s3.avail_in = s3.input.length;
                      do {
                        if (s3.avail_out === 0 && (s3.output = new o2.Buf8(c3), s3.next_out = 0, s3.avail_out = c3), (n3 = a2.deflate(s3, r3)) !== 1 && n3 !== 0)
                          return this.onEnd(n3), !(this.ended = true);
                        s3.avail_out !== 0 && (s3.avail_in !== 0 || r3 !== 4 && r3 !== 2) || (this.options.to === "string" ? this.onData(
                          i2.buf2binstring(o2.shrinkBuf(s3.output, s3.next_out))
                        ) : this.onData(o2.shrinkBuf(s3.output, s3.next_out)));
                      } while ((s3.avail_in > 0 || s3.avail_out === 0) && n3 !== 1);
                      return r3 === 4 ? (n3 = a2.deflateEnd(this.strm), this.onEnd(n3), this.ended = true, n3 === 0) : r3 != 2 || (this.onEnd(0), !(s3.avail_out = 0));
                    }, c2.prototype.onData = function(e4) {
                      this.chunks.push(e4);
                    }, c2.prototype.onEnd = function(e4) {
                      e4 === 0 && (this.options.to === "string" ? this.result = this.chunks.join("") : this.result = o2.flattenChunks(this.chunks)), this.chunks = [], this.err = e4, this.msg = this.strm.msg;
                    }, n2.Deflate = c2, n2.deflate = u2, n2.deflateRaw = function(e4, t4) {
                      return (t4 = t4 || {}).raw = true, u2(e4, t4);
                    }, n2.gzip = function(e4, t4) {
                      return (t4 = t4 || {}).gzip = true, u2(e4, t4);
                    };
                  },
                  {
                    "./utils/common": 41,
                    "./utils/strings": 42,
                    "./zlib/deflate": 46,
                    "./zlib/messages": 51,
                    "./zlib/zstream": 53
                  }
                ],
                40: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = e3("./zlib/inflate"), o2 = e3("./utils/common"), i2 = e3("./utils/strings"), r2 = e3("./zlib/constants"), s2 = e3("./zlib/messages"), l2 = e3("./zlib/zstream"), c2 = e3("./zlib/gzheader"), u2 = Object.prototype.toString;
                    function p2(e4) {
                      if (!(this instanceof p2)) return new p2(e4);
                      this.options = o2.assign(
                        { chunkSize: 16384, windowBits: 0, to: "" },
                        e4 || {}
                      );
                      var t4 = this.options;
                      t4.raw && t4.windowBits >= 0 && t4.windowBits < 16 && (t4.windowBits = -t4.windowBits, t4.windowBits === 0 && (t4.windowBits = -15)), !(t4.windowBits >= 0 && t4.windowBits < 16) || e4 && e4.windowBits || (t4.windowBits += 32), t4.windowBits > 15 && t4.windowBits < 48 && (15 & t4.windowBits) == 0 && (t4.windowBits |= 15), this.err = 0, this.msg = "", this.ended = false, this.chunks = [], this.strm = new l2(), this.strm.avail_out = 0;
                      var n3 = a2.inflateInit2(this.strm, t4.windowBits);
                      if (n3 !== r2.Z_OK) throw new Error(s2[n3]);
                      this.header = new c2(), a2.inflateGetHeader(this.strm, this.header);
                    }
                    function d2(e4, t4) {
                      var n3 = new p2(t4);
                      if (n3.push(e4, true), n3.err) throw n3.msg || s2[n3.err];
                      return n3.result;
                    }
                    p2.prototype.push = function(e4, t4) {
                      var n3, s3, l3, c3, p3, d3, m2 = this.strm, h = this.options.chunkSize, g = this.options.dictionary, f = false;
                      if (this.ended) return false;
                      s3 = t4 === ~~t4 ? t4 : true === t4 ? r2.Z_FINISH : r2.Z_NO_FLUSH, typeof e4 == "string" ? m2.input = i2.binstring2buf(e4) : u2.call(e4) === "[object ArrayBuffer]" ? m2.input = new Uint8Array(e4) : m2.input = e4, m2.next_in = 0, m2.avail_in = m2.input.length;
                      do {
                        if (m2.avail_out === 0 && (m2.output = new o2.Buf8(h), m2.next_out = 0, m2.avail_out = h), (n3 = a2.inflate(m2, r2.Z_NO_FLUSH)) === r2.Z_NEED_DICT && g && (d3 = typeof g == "string" ? i2.string2buf(g) : u2.call(g) === "[object ArrayBuffer]" ? new Uint8Array(g) : g, n3 = a2.inflateSetDictionary(this.strm, d3)), n3 === r2.Z_BUF_ERROR && true === f && (n3 = r2.Z_OK, f = false), n3 !== r2.Z_STREAM_END && n3 !== r2.Z_OK)
                          return this.onEnd(n3), !(this.ended = true);
                        m2.next_out && (m2.avail_out !== 0 && n3 !== r2.Z_STREAM_END && (m2.avail_in !== 0 || s3 !== r2.Z_FINISH && s3 !== r2.Z_SYNC_FLUSH) || (this.options.to === "string" ? (l3 = i2.utf8border(m2.output, m2.next_out), c3 = m2.next_out - l3, p3 = i2.buf2string(m2.output, l3), m2.next_out = c3, m2.avail_out = h - c3, c3 && o2.arraySet(m2.output, m2.output, l3, c3, 0), this.onData(p3)) : this.onData(o2.shrinkBuf(m2.output, m2.next_out)))), m2.avail_in === 0 && m2.avail_out === 0 && (f = true);
                      } while ((m2.avail_in > 0 || m2.avail_out === 0) && n3 !== r2.Z_STREAM_END);
                      return n3 === r2.Z_STREAM_END && (s3 = r2.Z_FINISH), s3 === r2.Z_FINISH ? (n3 = a2.inflateEnd(this.strm), this.onEnd(n3), this.ended = true, n3 === r2.Z_OK) : s3 !== r2.Z_SYNC_FLUSH || (this.onEnd(r2.Z_OK), !(m2.avail_out = 0));
                    }, p2.prototype.onData = function(e4) {
                      this.chunks.push(e4);
                    }, p2.prototype.onEnd = function(e4) {
                      e4 === r2.Z_OK && (this.options.to === "string" ? this.result = this.chunks.join("") : this.result = o2.flattenChunks(this.chunks)), this.chunks = [], this.err = e4, this.msg = this.strm.msg;
                    }, n2.Inflate = p2, n2.inflate = d2, n2.inflateRaw = function(e4, t4) {
                      return (t4 = t4 || {}).raw = true, d2(e4, t4);
                    }, n2.ungzip = d2;
                  },
                  {
                    "./utils/common": 41,
                    "./utils/strings": 42,
                    "./zlib/constants": 44,
                    "./zlib/gzheader": 47,
                    "./zlib/inflate": 49,
                    "./zlib/messages": 51,
                    "./zlib/zstream": 53
                  }
                ],
                41: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = typeof Uint8Array != "undefined" && typeof Uint16Array != "undefined" && typeof Int32Array != "undefined";
                    n2.assign = function(e4) {
                      for (var t4 = Array.prototype.slice.call(arguments, 1); t4.length; ) {
                        var n3 = t4.shift();
                        if (n3) {
                          if (typeof n3 != "object")
                            throw new TypeError(n3 + "must be non-object");
                          for (var a3 in n3) n3.hasOwnProperty(a3) && (e4[a3] = n3[a3]);
                        }
                      }
                      return e4;
                    }, n2.shrinkBuf = function(e4, t4) {
                      return e4.length === t4 ? e4 : e4.subarray ? e4.subarray(0, t4) : (e4.length = t4, e4);
                    };
                    var o2 = {
                      arraySet: function(e4, t4, n3, a3, o3) {
                        if (t4.subarray && e4.subarray)
                          e4.set(t4.subarray(n3, n3 + a3), o3);
                        else for (var i3 = 0; i3 < a3; i3++) e4[o3 + i3] = t4[n3 + i3];
                      },
                      flattenChunks: function(e4) {
                        var t4, n3, a3, o3, i3, r2;
                        for (t4 = a3 = 0, n3 = e4.length; t4 < n3; t4++)
                          a3 += e4[t4].length;
                        for (r2 = new Uint8Array(a3), t4 = o3 = 0, n3 = e4.length; t4 < n3; t4++)
                          i3 = e4[t4], r2.set(i3, o3), o3 += i3.length;
                        return r2;
                      }
                    }, i2 = {
                      arraySet: function(e4, t4, n3, a3, o3) {
                        for (var i3 = 0; i3 < a3; i3++) e4[o3 + i3] = t4[n3 + i3];
                      },
                      flattenChunks: function(e4) {
                        return [].concat.apply([], e4);
                      }
                    };
                    n2.setTyped = function(e4) {
                      e4 ? (n2.Buf8 = Uint8Array, n2.Buf16 = Uint16Array, n2.Buf32 = Int32Array, n2.assign(n2, o2)) : (n2.Buf8 = Array, n2.Buf16 = Array, n2.Buf32 = Array, n2.assign(n2, i2));
                    }, n2.setTyped(a2);
                  },
                  {}
                ],
                42: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = e3("./common"), o2 = true, i2 = true;
                    try {
                      String.fromCharCode.apply(null, [0]);
                    } catch (e4) {
                      o2 = false;
                    }
                    try {
                      String.fromCharCode.apply(null, new Uint8Array(1));
                    } catch (e4) {
                      i2 = false;
                    }
                    for (var r2 = new a2.Buf8(256), s2 = 0; s2 < 256; s2++)
                      r2[s2] = s2 >= 252 ? 6 : s2 >= 248 ? 5 : s2 >= 240 ? 4 : s2 >= 224 ? 3 : s2 >= 192 ? 2 : 1;
                    function l2(e4, t4) {
                      if (t4 < 65537 && (e4.subarray && i2 || !e4.subarray && o2))
                        return String.fromCharCode.apply(null, a2.shrinkBuf(e4, t4));
                      for (var n3 = "", r3 = 0; r3 < t4; r3++)
                        n3 += String.fromCharCode(e4[r3]);
                      return n3;
                    }
                    r2[254] = r2[254] = 1, n2.string2buf = function(e4) {
                      var t4, n3, o3, i3, r3, s3 = e4.length, l3 = 0;
                      for (i3 = 0; i3 < s3; i3++)
                        (64512 & (n3 = e4.charCodeAt(i3))) == 55296 && i3 + 1 < s3 && (64512 & (o3 = e4.charCodeAt(i3 + 1))) == 56320 && (n3 = 65536 + (n3 - 55296 << 10) + (o3 - 56320), i3++), l3 += n3 < 128 ? 1 : n3 < 2048 ? 2 : n3 < 65536 ? 3 : 4;
                      for (t4 = new a2.Buf8(l3), i3 = r3 = 0; r3 < l3; i3++)
                        (64512 & (n3 = e4.charCodeAt(i3))) == 55296 && i3 + 1 < s3 && (64512 & (o3 = e4.charCodeAt(i3 + 1))) == 56320 && (n3 = 65536 + (n3 - 55296 << 10) + (o3 - 56320), i3++), n3 < 128 ? t4[r3++] = n3 : (n3 < 2048 ? t4[r3++] = 192 | n3 >>> 6 : (n3 < 65536 ? t4[r3++] = 224 | n3 >>> 12 : (t4[r3++] = 240 | n3 >>> 18, t4[r3++] = 128 | n3 >>> 12 & 63), t4[r3++] = 128 | n3 >>> 6 & 63), t4[r3++] = 128 | 63 & n3);
                      return t4;
                    }, n2.buf2binstring = function(e4) {
                      return l2(e4, e4.length);
                    }, n2.binstring2buf = function(e4) {
                      for (var t4 = new a2.Buf8(e4.length), n3 = 0, o3 = t4.length; n3 < o3; n3++)
                        t4[n3] = e4.charCodeAt(n3);
                      return t4;
                    }, n2.buf2string = function(e4, t4) {
                      var n3, a3, o3, i3, s3 = t4 || e4.length, c2 = new Array(2 * s3);
                      for (n3 = a3 = 0; n3 < s3; )
                        if ((o3 = e4[n3++]) < 128) c2[a3++] = o3;
                        else if ((i3 = r2[o3]) > 4)
                          c2[a3++] = 65533, n3 += i3 - 1;
                        else {
                          for (o3 &= i3 === 2 ? 31 : i3 === 3 ? 15 : 7; i3 > 1 && n3 < s3; )
                            o3 = o3 << 6 | 63 & e4[n3++], i3--;
                          i3 > 1 ? c2[a3++] = 65533 : o3 < 65536 ? c2[a3++] = o3 : (o3 -= 65536, c2[a3++] = 55296 | o3 >> 10 & 1023, c2[a3++] = 56320 | 1023 & o3);
                        }
                      return l2(c2, a3);
                    }, n2.utf8border = function(e4, t4) {
                      var n3;
                      for ((t4 = t4 || e4.length) > e4.length && (t4 = e4.length), n3 = t4 - 1; n3 >= 0 && (192 & e4[n3]) == 128; )
                        n3--;
                      return n3 < 0 || n3 === 0 ? t4 : n3 + r2[e4[n3]] > t4 ? n3 : t4;
                    };
                  },
                  { "./common": 41 }
                ],
                43: [
                  function(e3, t3, n2) {
                    "use strict";
                    t3.exports = function(e4, t4, n3, a2) {
                      for (var o2 = 65535 & e4 | 0, i2 = e4 >>> 16 & 65535 | 0, r2 = 0; n3 !== 0; ) {
                        for (n3 -= r2 = n3 > 2e3 ? 2e3 : n3; i2 = i2 + (o2 = o2 + t4[a2++] | 0) | 0, --r2; ) ;
                        o2 %= 65521, i2 %= 65521;
                      }
                      return o2 | i2 << 16 | 0;
                    };
                  },
                  {}
                ],
                44: [
                  function(e3, t3, n2) {
                    "use strict";
                    t3.exports = {
                      Z_NO_FLUSH: 0,
                      Z_PARTIAL_FLUSH: 1,
                      Z_SYNC_FLUSH: 2,
                      Z_FULL_FLUSH: 3,
                      Z_FINISH: 4,
                      Z_BLOCK: 5,
                      Z_TREES: 6,
                      Z_OK: 0,
                      Z_STREAM_END: 1,
                      Z_NEED_DICT: 2,
                      Z_ERRNO: -1,
                      Z_STREAM_ERROR: -2,
                      Z_DATA_ERROR: -3,
                      Z_BUF_ERROR: -5,
                      Z_NO_COMPRESSION: 0,
                      Z_BEST_SPEED: 1,
                      Z_BEST_COMPRESSION: 9,
                      Z_DEFAULT_COMPRESSION: -1,
                      Z_FILTERED: 1,
                      Z_HUFFMAN_ONLY: 2,
                      Z_RLE: 3,
                      Z_FIXED: 4,
                      Z_DEFAULT_STRATEGY: 0,
                      Z_BINARY: 0,
                      Z_TEXT: 1,
                      Z_UNKNOWN: 2,
                      Z_DEFLATED: 8
                    };
                  },
                  {}
                ],
                45: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = function() {
                      for (var e4, t4 = [], n3 = 0; n3 < 256; n3++) {
                        e4 = n3;
                        for (var a3 = 0; a3 < 8; a3++)
                          e4 = 1 & e4 ? 3988292384 ^ e4 >>> 1 : e4 >>> 1;
                        t4[n3] = e4;
                      }
                      return t4;
                    }();
                    t3.exports = function(e4, t4, n3, o2) {
                      var i2 = a2, r2 = o2 + n3;
                      e4 ^= -1;
                      for (var s2 = o2; s2 < r2; s2++)
                        e4 = e4 >>> 8 ^ i2[255 & (e4 ^ t4[s2])];
                      return -1 ^ e4;
                    };
                  },
                  {}
                ],
                46: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2, o2 = e3("../utils/common"), i2 = e3("./trees"), r2 = e3("./adler32"), s2 = e3("./crc32"), l2 = e3("./messages"), c2 = -2, u2 = 258, p2 = 262, d2 = 113;
                    function m2(e4, t4) {
                      return e4.msg = l2[t4], t4;
                    }
                    function h(e4) {
                      return (e4 << 1) - (e4 > 4 ? 9 : 0);
                    }
                    function g(e4) {
                      for (var t4 = e4.length; --t4 >= 0; ) e4[t4] = 0;
                    }
                    function f(e4) {
                      var t4 = e4.state, n3 = t4.pending;
                      n3 > e4.avail_out && (n3 = e4.avail_out), n3 !== 0 && (o2.arraySet(
                        e4.output,
                        t4.pending_buf,
                        t4.pending_out,
                        n3,
                        e4.next_out
                      ), e4.next_out += n3, t4.pending_out += n3, e4.total_out += n3, e4.avail_out -= n3, t4.pending -= n3, t4.pending === 0 && (t4.pending_out = 0));
                    }
                    function y(e4, t4) {
                      i2._tr_flush_block(
                        e4,
                        e4.block_start >= 0 ? e4.block_start : -1,
                        e4.strstart - e4.block_start,
                        t4
                      ), e4.block_start = e4.strstart, f(e4.strm);
                    }
                    function b(e4, t4) {
                      e4.pending_buf[e4.pending++] = t4;
                    }
                    function w(e4, t4) {
                      e4.pending_buf[e4.pending++] = t4 >>> 8 & 255, e4.pending_buf[e4.pending++] = 255 & t4;
                    }
                    function v(e4, t4) {
                      var n3, a3, o3 = e4.max_chain_length, i3 = e4.strstart, r3 = e4.prev_length, s3 = e4.nice_match, l3 = e4.strstart > e4.w_size - 262 ? e4.strstart - (e4.w_size - 262) : 0, c3 = e4.window, d3 = e4.w_mask, m3 = e4.prev, h2 = e4.strstart + 258, g2 = c3[i3 + r3 - 1], f2 = c3[i3 + r3];
                      e4.prev_length >= e4.good_match && (o3 >>= 2), s3 > e4.lookahead && (s3 = e4.lookahead);
                      do {
                        if (c3[(n3 = t4) + r3] === f2 && c3[n3 + r3 - 1] === g2 && c3[n3] === c3[i3] && c3[++n3] === c3[i3 + 1]) {
                          i3 += 2, n3++;
                          do {
                          } while (c3[++i3] === c3[++n3] && c3[++i3] === c3[++n3] && c3[++i3] === c3[++n3] && c3[++i3] === c3[++n3] && c3[++i3] === c3[++n3] && c3[++i3] === c3[++n3] && c3[++i3] === c3[++n3] && c3[++i3] === c3[++n3] && i3 < h2);
                          if (a3 = 258 - (h2 - i3), i3 = h2 - 258, r3 < a3) {
                            if (e4.match_start = t4, s3 <= (r3 = a3)) break;
                            g2 = c3[i3 + r3 - 1], f2 = c3[i3 + r3];
                          }
                        }
                      } while ((t4 = m3[t4 & d3]) > l3 && --o3 != 0);
                      return r3 <= e4.lookahead ? r3 : e4.lookahead;
                    }
                    function k(e4) {
                      var t4, n3, a3, i3, l3, c3, u3, d3, m3, h2, g2 = e4.w_size;
                      do {
                        if (i3 = e4.window_size - e4.lookahead - e4.strstart, e4.strstart >= g2 + (g2 - 262)) {
                          for (o2.arraySet(e4.window, e4.window, g2, g2, 0), e4.match_start -= g2, e4.strstart -= g2, e4.block_start -= g2, t4 = n3 = e4.hash_size; a3 = e4.head[--t4], e4.head[t4] = g2 <= a3 ? a3 - g2 : 0, --n3; ) ;
                          for (t4 = n3 = g2; a3 = e4.prev[--t4], e4.prev[t4] = g2 <= a3 ? a3 - g2 : 0, --n3; ) ;
                          i3 += g2;
                        }
                        if (e4.strm.avail_in === 0) break;
                        if (c3 = e4.strm, u3 = e4.window, d3 = e4.strstart + e4.lookahead, h2 = void 0, (m3 = i3) < (h2 = c3.avail_in) && (h2 = m3), n3 = h2 === 0 ? 0 : (c3.avail_in -= h2, o2.arraySet(u3, c3.input, c3.next_in, h2, d3), c3.state.wrap === 1 ? c3.adler = r2(c3.adler, u3, h2, d3) : c3.state.wrap === 2 && (c3.adler = s2(c3.adler, u3, h2, d3)), c3.next_in += h2, c3.total_in += h2, h2), e4.lookahead += n3, e4.lookahead + e4.insert >= 3)
                          for (l3 = e4.strstart - e4.insert, e4.ins_h = e4.window[l3], e4.ins_h = (e4.ins_h << e4.hash_shift ^ e4.window[l3 + 1]) & e4.hash_mask; e4.insert && (e4.ins_h = (e4.ins_h << e4.hash_shift ^ e4.window[l3 + 3 - 1]) & e4.hash_mask, e4.prev[l3 & e4.w_mask] = e4.head[e4.ins_h], e4.head[e4.ins_h] = l3, l3++, e4.insert--, !(e4.lookahead + e4.insert < 3)); ) ;
                      } while (e4.lookahead < 262 && e4.strm.avail_in !== 0);
                    }
                    function T(e4, t4) {
                      for (var n3, a3; ; ) {
                        if (e4.lookahead < 262) {
                          if (k(e4), e4.lookahead < 262 && t4 === 0) return 1;
                          if (e4.lookahead === 0) break;
                        }
                        if (n3 = 0, e4.lookahead >= 3 && (e4.ins_h = (e4.ins_h << e4.hash_shift ^ e4.window[e4.strstart + 3 - 1]) & e4.hash_mask, n3 = e4.prev[e4.strstart & e4.w_mask] = e4.head[e4.ins_h], e4.head[e4.ins_h] = e4.strstart), n3 !== 0 && e4.strstart - n3 <= e4.w_size - 262 && (e4.match_length = v(e4, n3)), e4.match_length >= 3) {
                          if (a3 = i2._tr_tally(
                            e4,
                            e4.strstart - e4.match_start,
                            e4.match_length - 3
                          ), e4.lookahead -= e4.match_length, e4.match_length <= e4.max_lazy_match && e4.lookahead >= 3) {
                            for (e4.match_length--; e4.strstart++, e4.ins_h = (e4.ins_h << e4.hash_shift ^ e4.window[e4.strstart + 3 - 1]) & e4.hash_mask, n3 = e4.prev[e4.strstart & e4.w_mask] = e4.head[e4.ins_h], e4.head[e4.ins_h] = e4.strstart, --e4.match_length != 0; ) ;
                            e4.strstart++;
                          } else
                            e4.strstart += e4.match_length, e4.match_length = 0, e4.ins_h = e4.window[e4.strstart], e4.ins_h = (e4.ins_h << e4.hash_shift ^ e4.window[e4.strstart + 1]) & e4.hash_mask;
                        } else
                          a3 = i2._tr_tally(e4, 0, e4.window[e4.strstart]), e4.lookahead--, e4.strstart++;
                        if (a3 && (y(e4, false), e4.strm.avail_out === 0)) return 1;
                      }
                      return e4.insert = e4.strstart < 2 ? e4.strstart : 2, t4 === 4 ? (y(e4, true), e4.strm.avail_out === 0 ? 3 : 4) : e4.last_lit && (y(e4, false), e4.strm.avail_out === 0) ? 1 : 2;
                    }
                    function A(e4, t4) {
                      for (var n3, a3, o3; ; ) {
                        if (e4.lookahead < 262) {
                          if (k(e4), e4.lookahead < 262 && t4 === 0) return 1;
                          if (e4.lookahead === 0) break;
                        }
                        if (n3 = 0, e4.lookahead >= 3 && (e4.ins_h = (e4.ins_h << e4.hash_shift ^ e4.window[e4.strstart + 3 - 1]) & e4.hash_mask, n3 = e4.prev[e4.strstart & e4.w_mask] = e4.head[e4.ins_h], e4.head[e4.ins_h] = e4.strstart), e4.prev_length = e4.match_length, e4.prev_match = e4.match_start, e4.match_length = 2, n3 !== 0 && e4.prev_length < e4.max_lazy_match && e4.strstart - n3 <= e4.w_size - 262 && (e4.match_length = v(e4, n3), e4.match_length <= 5 && (e4.strategy === 1 || e4.match_length === 3 && e4.strstart - e4.match_start > 4096) && (e4.match_length = 2)), e4.prev_length >= 3 && e4.match_length <= e4.prev_length) {
                          for (o3 = e4.strstart + e4.lookahead - 3, a3 = i2._tr_tally(
                            e4,
                            e4.strstart - 1 - e4.prev_match,
                            e4.prev_length - 3
                          ), e4.lookahead -= e4.prev_length - 1, e4.prev_length -= 2; ++e4.strstart <= o3 && (e4.ins_h = (e4.ins_h << e4.hash_shift ^ e4.window[e4.strstart + 3 - 1]) & e4.hash_mask, n3 = e4.prev[e4.strstart & e4.w_mask] = e4.head[e4.ins_h], e4.head[e4.ins_h] = e4.strstart), --e4.prev_length != 0; ) ;
                          if (e4.match_available = 0, e4.match_length = 2, e4.strstart++, a3 && (y(e4, false), e4.strm.avail_out === 0))
                            return 1;
                        } else if (e4.match_available) {
                          if ((a3 = i2._tr_tally(e4, 0, e4.window[e4.strstart - 1])) && y(e4, false), e4.strstart++, e4.lookahead--, e4.strm.avail_out === 0)
                            return 1;
                        } else
                          e4.match_available = 1, e4.strstart++, e4.lookahead--;
                      }
                      return e4.match_available && (a3 = i2._tr_tally(e4, 0, e4.window[e4.strstart - 1]), e4.match_available = 0), e4.insert = e4.strstart < 2 ? e4.strstart : 2, t4 === 4 ? (y(e4, true), e4.strm.avail_out === 0 ? 3 : 4) : e4.last_lit && (y(e4, false), e4.strm.avail_out === 0) ? 1 : 2;
                    }
                    function E(e4, t4, n3, a3, o3) {
                      this.good_length = e4, this.max_lazy = t4, this.nice_length = n3, this.max_chain = a3, this.func = o3;
                    }
                    function I() {
                      this.strm = null, this.status = 0, this.pending_buf = null, this.pending_buf_size = 0, this.pending_out = 0, this.pending = 0, this.wrap = 0, this.gzhead = null, this.gzindex = 0, this.method = 8, this.last_flush = -1, this.w_size = 0, this.w_bits = 0, this.w_mask = 0, this.window = null, this.window_size = 0, this.prev = null, this.head = null, this.ins_h = 0, this.hash_size = 0, this.hash_bits = 0, this.hash_mask = 0, this.hash_shift = 0, this.block_start = 0, this.match_length = 0, this.prev_match = 0, this.match_available = 0, this.strstart = 0, this.match_start = 0, this.lookahead = 0, this.prev_length = 0, this.max_chain_length = 0, this.max_lazy_match = 0, this.level = 0, this.strategy = 0, this.good_match = 0, this.nice_match = 0, this.dyn_ltree = new o2.Buf16(1146), this.dyn_dtree = new o2.Buf16(122), this.bl_tree = new o2.Buf16(78), g(this.dyn_ltree), g(this.dyn_dtree), g(this.bl_tree), this.l_desc = null, this.d_desc = null, this.bl_desc = null, this.bl_count = new o2.Buf16(16), this.heap = new o2.Buf16(573), g(this.heap), this.heap_len = 0, this.heap_max = 0, this.depth = new o2.Buf16(573), g(this.depth), this.l_buf = 0, this.lit_bufsize = 0, this.last_lit = 0, this.d_buf = 0, this.opt_len = 0, this.static_len = 0, this.matches = 0, this.insert = 0, this.bi_buf = 0, this.bi_valid = 0;
                    }
                    function S(e4) {
                      var t4;
                      return e4 && e4.state ? (e4.total_in = e4.total_out = 0, e4.data_type = 2, (t4 = e4.state).pending = 0, t4.pending_out = 0, t4.wrap < 0 && (t4.wrap = -t4.wrap), t4.status = t4.wrap ? 42 : 113, e4.adler = t4.wrap === 2 ? 0 : 1, t4.last_flush = 0, i2._tr_init(t4), 0) : m2(e4, -2);
                    }
                    function x(e4) {
                      var t4, n3 = S(e4);
                      return n3 === 0 && ((t4 = e4.state).window_size = 2 * t4.w_size, g(t4.head), t4.max_lazy_match = a2[t4.level].max_lazy, t4.good_match = a2[t4.level].good_length, t4.nice_match = a2[t4.level].nice_length, t4.max_chain_length = a2[t4.level].max_chain, t4.strstart = 0, t4.block_start = 0, t4.lookahead = 0, t4.insert = 0, t4.match_length = t4.prev_length = 2, t4.match_available = 0, t4.ins_h = 0), n3;
                    }
                    function C(e4, t4, n3, a3, i3, r3) {
                      if (!e4) return -2;
                      var s3 = 1;
                      if (-1 === t4 && (t4 = 6), a3 < 0 ? (s3 = 0, a3 = -a3) : a3 > 15 && (s3 = 2, a3 -= 16), i3 < 1 || i3 > 9 || n3 !== 8 || a3 < 8 || a3 > 15 || t4 < 0 || t4 > 9 || r3 < 0 || r3 > 4)
                        return m2(e4, -2);
                      a3 === 8 && (a3 = 9);
                      var l3 = new I();
                      return (e4.state = l3).strm = e4, l3.wrap = s3, l3.gzhead = null, l3.w_bits = a3, l3.w_size = 1 << l3.w_bits, l3.w_mask = l3.w_size - 1, l3.hash_bits = i3 + 7, l3.hash_size = 1 << l3.hash_bits, l3.hash_mask = l3.hash_size - 1, l3.hash_shift = ~~((l3.hash_bits + 3 - 1) / 3), l3.window = new o2.Buf8(2 * l3.w_size), l3.head = new o2.Buf16(l3.hash_size), l3.prev = new o2.Buf16(l3.w_size), l3.lit_bufsize = 1 << i3 + 6, l3.pending_buf_size = 4 * l3.lit_bufsize, l3.pending_buf = new o2.Buf8(l3.pending_buf_size), l3.d_buf = 1 * l3.lit_bufsize, l3.l_buf = 3 * l3.lit_bufsize, l3.level = t4, l3.strategy = r3, l3.method = n3, x(e4);
                    }
                    a2 = [
                      new E(0, 0, 0, 0, function(e4, t4) {
                        var n3 = 65535;
                        for (n3 > e4.pending_buf_size - 5 && (n3 = e4.pending_buf_size - 5); ; ) {
                          if (e4.lookahead <= 1) {
                            if (k(e4), e4.lookahead === 0 && t4 === 0) return 1;
                            if (e4.lookahead === 0) break;
                          }
                          e4.strstart += e4.lookahead, e4.lookahead = 0;
                          var a3 = e4.block_start + n3;
                          if ((e4.strstart === 0 || e4.strstart >= a3) && (e4.lookahead = e4.strstart - a3, e4.strstart = a3, y(e4, false), e4.strm.avail_out === 0))
                            return 1;
                          if (e4.strstart - e4.block_start >= e4.w_size - 262 && (y(e4, false), e4.strm.avail_out === 0))
                            return 1;
                        }
                        return e4.insert = 0, t4 === 4 ? (y(e4, true), e4.strm.avail_out === 0 ? 3 : 4) : (e4.strstart > e4.block_start && (y(e4, false), e4.strm.avail_out), 1);
                      }),
                      new E(4, 4, 8, 4, T),
                      new E(4, 5, 16, 8, T),
                      new E(4, 6, 32, 32, T),
                      new E(4, 4, 16, 16, A),
                      new E(8, 16, 32, 32, A),
                      new E(8, 16, 128, 128, A),
                      new E(8, 32, 128, 256, A),
                      new E(32, 128, 258, 1024, A),
                      new E(32, 258, 258, 4096, A)
                    ], n2.deflateInit = function(e4, t4) {
                      return C(e4, t4, 8, 15, 8, 0);
                    }, n2.deflateInit2 = C, n2.deflateReset = x, n2.deflateResetKeep = S, n2.deflateSetHeader = function(e4, t4) {
                      return e4 && e4.state ? e4.state.wrap !== 2 ? -2 : (e4.state.gzhead = t4, 0) : -2;
                    }, n2.deflate = function(e4, t4) {
                      var n3, o3, r3, l3;
                      if (!e4 || !e4.state || t4 > 5 || t4 < 0)
                        return e4 ? m2(e4, -2) : -2;
                      if (o3 = e4.state, !e4.output || !e4.input && e4.avail_in !== 0 || o3.status === 666 && t4 !== 4)
                        return m2(e4, e4.avail_out === 0 ? -5 : -2);
                      if (o3.strm = e4, n3 = o3.last_flush, o3.last_flush = t4, o3.status === 42)
                        if (o3.wrap === 2)
                          e4.adler = 0, b(o3, 31), b(o3, 139), b(o3, 8), o3.gzhead ? (b(
                            o3,
                            (o3.gzhead.text ? 1 : 0) + (o3.gzhead.hcrc ? 2 : 0) + (o3.gzhead.extra ? 4 : 0) + (o3.gzhead.name ? 8 : 0) + (o3.gzhead.comment ? 16 : 0)
                          ), b(o3, 255 & o3.gzhead.time), b(o3, o3.gzhead.time >> 8 & 255), b(o3, o3.gzhead.time >> 16 & 255), b(o3, o3.gzhead.time >> 24 & 255), b(
                            o3,
                            o3.level === 9 ? 2 : o3.strategy >= 2 || o3.level < 2 ? 4 : 0
                          ), b(o3, 255 & o3.gzhead.os), o3.gzhead.extra && o3.gzhead.extra.length && (b(o3, 255 & o3.gzhead.extra.length), b(o3, o3.gzhead.extra.length >> 8 & 255)), o3.gzhead.hcrc && (e4.adler = s2(
                            e4.adler,
                            o3.pending_buf,
                            o3.pending,
                            0
                          )), o3.gzindex = 0, o3.status = 69) : (b(o3, 0), b(o3, 0), b(o3, 0), b(o3, 0), b(o3, 0), b(
                            o3,
                            o3.level === 9 ? 2 : o3.strategy >= 2 || o3.level < 2 ? 4 : 0
                          ), b(o3, 3), o3.status = 113);
                        else {
                          var p3 = 8 + (o3.w_bits - 8 << 4) << 8;
                          p3 |= (o3.strategy >= 2 || o3.level < 2 ? 0 : o3.level < 6 ? 1 : o3.level === 6 ? 2 : 3) << 6, o3.strstart !== 0 && (p3 |= 32), p3 += 31 - p3 % 31, o3.status = 113, w(o3, p3), o3.strstart !== 0 && (w(o3, e4.adler >>> 16), w(o3, 65535 & e4.adler)), e4.adler = 1;
                        }
                      if (o3.status === 69)
                        if (o3.gzhead.extra) {
                          for (r3 = o3.pending; o3.gzindex < (65535 & o3.gzhead.extra.length) && (o3.pending !== o3.pending_buf_size || (o3.gzhead.hcrc && o3.pending > r3 && (e4.adler = s2(
                            e4.adler,
                            o3.pending_buf,
                            o3.pending - r3,
                            r3
                          )), f(e4), r3 = o3.pending, o3.pending !== o3.pending_buf_size)); )
                            b(o3, 255 & o3.gzhead.extra[o3.gzindex]), o3.gzindex++;
                          o3.gzhead.hcrc && o3.pending > r3 && (e4.adler = s2(
                            e4.adler,
                            o3.pending_buf,
                            o3.pending - r3,
                            r3
                          )), o3.gzindex === o3.gzhead.extra.length && (o3.gzindex = 0, o3.status = 73);
                        } else o3.status = 73;
                      if (o3.status === 73)
                        if (o3.gzhead.name) {
                          r3 = o3.pending;
                          do {
                            if (o3.pending === o3.pending_buf_size && (o3.gzhead.hcrc && o3.pending > r3 && (e4.adler = s2(
                              e4.adler,
                              o3.pending_buf,
                              o3.pending - r3,
                              r3
                            )), f(e4), r3 = o3.pending, o3.pending === o3.pending_buf_size)) {
                              l3 = 1;
                              break;
                            }
                            l3 = o3.gzindex < o3.gzhead.name.length ? 255 & o3.gzhead.name.charCodeAt(o3.gzindex++) : 0, b(o3, l3);
                          } while (l3 !== 0);
                          o3.gzhead.hcrc && o3.pending > r3 && (e4.adler = s2(
                            e4.adler,
                            o3.pending_buf,
                            o3.pending - r3,
                            r3
                          )), l3 === 0 && (o3.gzindex = 0, o3.status = 91);
                        } else o3.status = 91;
                      if (o3.status === 91)
                        if (o3.gzhead.comment) {
                          r3 = o3.pending;
                          do {
                            if (o3.pending === o3.pending_buf_size && (o3.gzhead.hcrc && o3.pending > r3 && (e4.adler = s2(
                              e4.adler,
                              o3.pending_buf,
                              o3.pending - r3,
                              r3
                            )), f(e4), r3 = o3.pending, o3.pending === o3.pending_buf_size)) {
                              l3 = 1;
                              break;
                            }
                            l3 = o3.gzindex < o3.gzhead.comment.length ? 255 & o3.gzhead.comment.charCodeAt(o3.gzindex++) : 0, b(o3, l3);
                          } while (l3 !== 0);
                          o3.gzhead.hcrc && o3.pending > r3 && (e4.adler = s2(
                            e4.adler,
                            o3.pending_buf,
                            o3.pending - r3,
                            r3
                          )), l3 === 0 && (o3.status = 103);
                        } else o3.status = 103;
                      if (o3.status === 103 && (o3.gzhead.hcrc ? (o3.pending + 2 > o3.pending_buf_size && f(e4), o3.pending + 2 <= o3.pending_buf_size && (b(o3, 255 & e4.adler), b(o3, e4.adler >> 8 & 255), e4.adler = 0, o3.status = 113)) : o3.status = 113), o3.pending !== 0) {
                        if (f(e4), e4.avail_out === 0)
                          return o3.last_flush = -1, 0;
                      } else if (e4.avail_in === 0 && h(t4) <= h(n3) && t4 !== 4)
                        return m2(e4, -5);
                      if (o3.status === 666 && e4.avail_in !== 0) return m2(e4, -5);
                      if (e4.avail_in !== 0 || o3.lookahead !== 0 || t4 !== 0 && o3.status !== 666) {
                        var v2 = o3.strategy === 2 ? function(e5, t5) {
                          for (var n4; ; ) {
                            if (e5.lookahead === 0 && (k(e5), e5.lookahead === 0)) {
                              if (t5 === 0) return 1;
                              break;
                            }
                            if (e5.match_length = 0, n4 = i2._tr_tally(
                              e5,
                              0,
                              e5.window[e5.strstart]
                            ), e5.lookahead--, e5.strstart++, n4 && (y(e5, false), e5.strm.avail_out === 0))
                              return 1;
                          }
                          return e5.insert = 0, t5 === 4 ? (y(e5, true), e5.strm.avail_out === 0 ? 3 : 4) : e5.last_lit && (y(e5, false), e5.strm.avail_out === 0) ? 1 : 2;
                        }(o3, t4) : o3.strategy === 3 ? function(e5, t5) {
                          for (var n4, a3, o4, r4, s3 = e5.window; ; ) {
                            if (e5.lookahead <= 258) {
                              if (k(e5), e5.lookahead <= 258 && t5 === 0)
                                return 1;
                              if (e5.lookahead === 0) break;
                            }
                            if (e5.match_length = 0, e5.lookahead >= 3 && e5.strstart > 0 && (a3 = s3[o4 = e5.strstart - 1]) === s3[++o4] && a3 === s3[++o4] && a3 === s3[++o4]) {
                              r4 = e5.strstart + 258;
                              do {
                              } while (a3 === s3[++o4] && a3 === s3[++o4] && a3 === s3[++o4] && a3 === s3[++o4] && a3 === s3[++o4] && a3 === s3[++o4] && a3 === s3[++o4] && a3 === s3[++o4] && o4 < r4);
                              e5.match_length = 258 - (r4 - o4), e5.match_length > e5.lookahead && (e5.match_length = e5.lookahead);
                            }
                            if (e5.match_length >= 3 ? (n4 = i2._tr_tally(
                              e5,
                              1,
                              e5.match_length - 3
                            ), e5.lookahead -= e5.match_length, e5.strstart += e5.match_length, e5.match_length = 0) : (n4 = i2._tr_tally(
                              e5,
                              0,
                              e5.window[e5.strstart]
                            ), e5.lookahead--, e5.strstart++), n4 && (y(e5, false), e5.strm.avail_out === 0))
                              return 1;
                          }
                          return e5.insert = 0, t5 === 4 ? (y(e5, true), e5.strm.avail_out === 0 ? 3 : 4) : e5.last_lit && (y(e5, false), e5.strm.avail_out === 0) ? 1 : 2;
                        }(o3, t4) : a2[o3.level].func(o3, t4);
                        if (v2 !== 3 && v2 !== 4 || (o3.status = 666), v2 === 1 || v2 === 3)
                          return e4.avail_out === 0 && (o3.last_flush = -1), 0;
                        if (v2 === 2 && (t4 === 1 ? i2._tr_align(o3) : t4 != 5 && (i2._tr_stored_block(o3, 0, 0, false), t4 == 3 && (g(o3.head), o3.lookahead === 0 && (o3.strstart = 0, o3.block_start = 0, o3.insert = 0))), f(e4), e4.avail_out === 0))
                          return o3.last_flush = -1, 0;
                      }
                      return t4 !== 4 ? 0 : o3.wrap <= 0 ? 1 : (o3.wrap === 2 ? (b(o3, 255 & e4.adler), b(o3, e4.adler >> 8 & 255), b(o3, e4.adler >> 16 & 255), b(o3, e4.adler >> 24 & 255), b(o3, 255 & e4.total_in), b(o3, e4.total_in >> 8 & 255), b(o3, e4.total_in >> 16 & 255), b(o3, e4.total_in >> 24 & 255)) : (w(o3, e4.adler >>> 16), w(o3, 65535 & e4.adler)), f(e4), o3.wrap > 0 && (o3.wrap = -o3.wrap), o3.pending !== 0 ? 0 : 1);
                    }, n2.deflateEnd = function(e4) {
                      var t4;
                      return e4 && e4.state ? (t4 = e4.state.status) !== 42 && t4 !== 69 && t4 !== 73 && t4 !== 91 && t4 !== 103 && t4 !== 113 && t4 !== 666 ? m2(e4, -2) : (e4.state = null, t4 === 113 ? m2(e4, -3) : 0) : -2;
                    }, n2.deflateSetDictionary = function(e4, t4) {
                      var n3, a3, i3, s3, l3, u3, p3, d3, m3 = t4.length;
                      if (!e4 || !e4.state) return -2;
                      if ((s3 = (n3 = e4.state).wrap) === 2 || s3 === 1 && n3.status !== 42 || n3.lookahead)
                        return -2;
                      for (s3 === 1 && (e4.adler = r2(e4.adler, t4, m3, 0)), n3.wrap = 0, m3 >= n3.w_size && (s3 === 0 && (g(n3.head), n3.strstart = 0, n3.block_start = 0, n3.insert = 0), d3 = new o2.Buf8(n3.w_size), o2.arraySet(d3, t4, m3 - n3.w_size, n3.w_size, 0), t4 = d3, m3 = n3.w_size), l3 = e4.avail_in, u3 = e4.next_in, p3 = e4.input, e4.avail_in = m3, e4.next_in = 0, e4.input = t4, k(n3); n3.lookahead >= 3; ) {
                        for (a3 = n3.strstart, i3 = n3.lookahead - 2; n3.ins_h = (n3.ins_h << n3.hash_shift ^ n3.window[a3 + 3 - 1]) & n3.hash_mask, n3.prev[a3 & n3.w_mask] = n3.head[n3.ins_h], n3.head[n3.ins_h] = a3, a3++, --i3; ) ;
                        n3.strstart = a3, n3.lookahead = 2, k(n3);
                      }
                      return n3.strstart += n3.lookahead, n3.block_start = n3.strstart, n3.insert = n3.lookahead, n3.lookahead = 0, n3.match_length = n3.prev_length = 2, n3.match_available = 0, e4.next_in = u3, e4.input = p3, e4.avail_in = l3, n3.wrap = s3, 0;
                    }, n2.deflateInfo = "pako deflate (from Nodeca project)";
                  },
                  {
                    "../utils/common": 41,
                    "./adler32": 43,
                    "./crc32": 45,
                    "./messages": 51,
                    "./trees": 52
                  }
                ],
                47: [
                  function(e3, t3, n2) {
                    "use strict";
                    t3.exports = function() {
                      this.text = 0, this.time = 0, this.xflags = 0, this.os = 0, this.extra = null, this.extra_len = 0, this.name = "", this.comment = "", this.hcrc = 0, this.done = false;
                    };
                  },
                  {}
                ],
                48: [
                  function(e3, t3, n2) {
                    "use strict";
                    t3.exports = function(e4, t4) {
                      var n3, a2, o2, i2, r2, s2, l2, c2, u2, p2, d2, m2, h, g, f, y, b, w, v, k, T, A, E, I, S;
                      n3 = e4.state, a2 = e4.next_in, I = e4.input, o2 = a2 + (e4.avail_in - 5), i2 = e4.next_out, S = e4.output, r2 = i2 - (t4 - e4.avail_out), s2 = i2 + (e4.avail_out - 257), l2 = n3.dmax, c2 = n3.wsize, u2 = n3.whave, p2 = n3.wnext, d2 = n3.window, m2 = n3.hold, h = n3.bits, g = n3.lencode, f = n3.distcode, y = (1 << n3.lenbits) - 1, b = (1 << n3.distbits) - 1;
                      e: do {
                        h < 15 && (m2 += I[a2++] << h, h += 8, m2 += I[a2++] << h, h += 8), w = g[m2 & y];
                        t: for (; ; ) {
                          if (m2 >>>= v = w >>> 24, h -= v, (v = w >>> 16 & 255) == 0)
                            S[i2++] = 65535 & w;
                          else {
                            if (!(16 & v)) {
                              if ((64 & v) == 0) {
                                w = g[(65535 & w) + (m2 & (1 << v) - 1)];
                                continue t;
                              }
                              if (32 & v) {
                                n3.mode = 12;
                                break e;
                              }
                              e4.msg = "invalid literal/length code", n3.mode = 30;
                              break e;
                            }
                            k = 65535 & w, (v &= 15) && (h < v && (m2 += I[a2++] << h, h += 8), k += m2 & (1 << v) - 1, m2 >>>= v, h -= v), h < 15 && (m2 += I[a2++] << h, h += 8, m2 += I[a2++] << h, h += 8), w = f[m2 & b];
                            n: for (; ; ) {
                              if (m2 >>>= v = w >>> 24, h -= v, !(16 & (v = w >>> 16 & 255))) {
                                if ((64 & v) == 0) {
                                  w = f[(65535 & w) + (m2 & (1 << v) - 1)];
                                  continue n;
                                }
                                e4.msg = "invalid distance code", n3.mode = 30;
                                break e;
                              }
                              if (T = 65535 & w, h < (v &= 15) && (m2 += I[a2++] << h, (h += 8) < v && (m2 += I[a2++] << h, h += 8)), l2 < (T += m2 & (1 << v) - 1)) {
                                e4.msg = "invalid distance too far back", n3.mode = 30;
                                break e;
                              }
                              if (m2 >>>= v, h -= v, (v = i2 - r2) < T) {
                                if (u2 < (v = T - v) && n3.sane) {
                                  e4.msg = "invalid distance too far back", n3.mode = 30;
                                  break e;
                                }
                                if (E = d2, (A = 0) === p2) {
                                  if (A += c2 - v, v < k) {
                                    for (k -= v; S[i2++] = d2[A++], --v; ) ;
                                    A = i2 - T, E = S;
                                  }
                                } else if (p2 < v) {
                                  if (A += c2 + p2 - v, (v -= p2) < k) {
                                    for (k -= v; S[i2++] = d2[A++], --v; ) ;
                                    if (A = 0, p2 < k) {
                                      for (k -= v = p2; S[i2++] = d2[A++], --v; ) ;
                                      A = i2 - T, E = S;
                                    }
                                  }
                                } else if (A += p2 - v, v < k) {
                                  for (k -= v; S[i2++] = d2[A++], --v; ) ;
                                  A = i2 - T, E = S;
                                }
                                for (; k > 2; )
                                  S[i2++] = E[A++], S[i2++] = E[A++], S[i2++] = E[A++], k -= 3;
                                k && (S[i2++] = E[A++], k > 1 && (S[i2++] = E[A++]));
                              } else {
                                for (A = i2 - T; S[i2++] = S[A++], S[i2++] = S[A++], S[i2++] = S[A++], (k -= 3) > 2; ) ;
                                k && (S[i2++] = S[A++], k > 1 && (S[i2++] = S[A++]));
                              }
                              break;
                            }
                          }
                          break;
                        }
                      } while (a2 < o2 && i2 < s2);
                      a2 -= k = h >> 3, m2 &= (1 << (h -= k << 3)) - 1, e4.next_in = a2, e4.next_out = i2, e4.avail_in = a2 < o2 ? o2 - a2 + 5 : 5 - (a2 - o2), e4.avail_out = i2 < s2 ? s2 - i2 + 257 : 257 - (i2 - s2), n3.hold = m2, n3.bits = h;
                    };
                  },
                  {}
                ],
                49: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = e3("../utils/common"), o2 = e3("./adler32"), i2 = e3("./crc32"), r2 = e3("./inffast"), s2 = e3("./inftrees"), l2 = -2;
                    function c2(e4) {
                      return (e4 >>> 24 & 255) + (e4 >>> 8 & 65280) + ((65280 & e4) << 8) + ((255 & e4) << 24);
                    }
                    function u2() {
                      this.mode = 0, this.last = false, this.wrap = 0, this.havedict = false, this.flags = 0, this.dmax = 0, this.check = 0, this.total = 0, this.head = null, this.wbits = 0, this.wsize = 0, this.whave = 0, this.wnext = 0, this.window = null, this.hold = 0, this.bits = 0, this.length = 0, this.offset = 0, this.extra = 0, this.lencode = null, this.distcode = null, this.lenbits = 0, this.distbits = 0, this.ncode = 0, this.nlen = 0, this.ndist = 0, this.have = 0, this.next = null, this.lens = new a2.Buf16(320), this.work = new a2.Buf16(288), this.lendyn = null, this.distdyn = null, this.sane = 0, this.back = 0, this.was = 0;
                    }
                    function p2(e4) {
                      var t4;
                      return e4 && e4.state ? (t4 = e4.state, e4.total_in = e4.total_out = t4.total = 0, e4.msg = "", t4.wrap && (e4.adler = 1 & t4.wrap), t4.mode = 1, t4.last = 0, t4.havedict = 0, t4.dmax = 32768, t4.head = null, t4.hold = 0, t4.bits = 0, t4.lencode = t4.lendyn = new a2.Buf32(852), t4.distcode = t4.distdyn = new a2.Buf32(592), t4.sane = 1, t4.back = -1, 0) : -2;
                    }
                    function d2(e4) {
                      var t4;
                      return e4 && e4.state ? ((t4 = e4.state).wsize = 0, t4.whave = 0, t4.wnext = 0, p2(e4)) : -2;
                    }
                    function m2(e4, t4) {
                      var n3, a3;
                      return e4 && e4.state ? (a3 = e4.state, t4 < 0 ? (n3 = 0, t4 = -t4) : (n3 = 1 + (t4 >> 4), t4 < 48 && (t4 &= 15)), t4 && (t4 < 8 || t4 > 15) ? -2 : (a3.window !== null && a3.wbits !== t4 && (a3.window = null), a3.wrap = n3, a3.wbits = t4, d2(e4))) : -2;
                    }
                    function h(e4, t4) {
                      var n3, a3;
                      return e4 ? (a3 = new u2(), (e4.state = a3).window = null, (n3 = m2(e4, t4)) !== 0 && (e4.state = null), n3) : -2;
                    }
                    var g, f, y = true;
                    function b(e4) {
                      if (y) {
                        var t4;
                        for (g = new a2.Buf32(512), f = new a2.Buf32(32), t4 = 0; t4 < 144; )
                          e4.lens[t4++] = 8;
                        for (; t4 < 256; ) e4.lens[t4++] = 9;
                        for (; t4 < 280; ) e4.lens[t4++] = 7;
                        for (; t4 < 288; ) e4.lens[t4++] = 8;
                        for (s2(1, e4.lens, 0, 288, g, 0, e4.work, { bits: 9 }), t4 = 0; t4 < 32; )
                          e4.lens[t4++] = 5;
                        s2(2, e4.lens, 0, 32, f, 0, e4.work, { bits: 5 }), y = false;
                      }
                      e4.lencode = g, e4.lenbits = 9, e4.distcode = f, e4.distbits = 5;
                    }
                    function w(e4, t4, n3, o3) {
                      var i3, r3 = e4.state;
                      return r3.window === null && (r3.wsize = 1 << r3.wbits, r3.wnext = 0, r3.whave = 0, r3.window = new a2.Buf8(r3.wsize)), o3 >= r3.wsize ? (a2.arraySet(r3.window, t4, n3 - r3.wsize, r3.wsize, 0), r3.wnext = 0, r3.whave = r3.wsize) : (o3 < (i3 = r3.wsize - r3.wnext) && (i3 = o3), a2.arraySet(r3.window, t4, n3 - o3, i3, r3.wnext), (o3 -= i3) ? (a2.arraySet(r3.window, t4, n3 - o3, o3, 0), r3.wnext = o3, r3.whave = r3.wsize) : (r3.wnext += i3, r3.wnext === r3.wsize && (r3.wnext = 0), r3.whave < r3.wsize && (r3.whave += i3))), 0;
                    }
                    n2.inflateReset = d2, n2.inflateReset2 = m2, n2.inflateResetKeep = p2, n2.inflateInit = function(e4) {
                      return h(e4, 15);
                    }, n2.inflateInit2 = h, n2.inflate = function(e4, t4) {
                      var n3, u3, p3, d3, m3, h2, g2, f2, y2, v, k, T, A, E, I, S, x, C, O, R, _, P, N, D, L = 0, M = new a2.Buf8(4), $ = [
                        16,
                        17,
                        18,
                        0,
                        8,
                        7,
                        9,
                        6,
                        10,
                        5,
                        11,
                        4,
                        12,
                        3,
                        13,
                        2,
                        14,
                        1,
                        15
                      ];
                      if (!e4 || !e4.state || !e4.output || !e4.input && e4.avail_in !== 0)
                        return -2;
                      (n3 = e4.state).mode === 12 && (n3.mode = 13), m3 = e4.next_out, p3 = e4.output, g2 = e4.avail_out, d3 = e4.next_in, u3 = e4.input, h2 = e4.avail_in, f2 = n3.hold, y2 = n3.bits, v = h2, k = g2, P = 0;
                      e: for (; ; )
                        switch (n3.mode) {
                          case 1:
                            if (n3.wrap === 0) {
                              n3.mode = 13;
                              break;
                            }
                            for (; y2 < 16; ) {
                              if (h2 === 0) break e;
                              h2--, f2 += u3[d3++] << y2, y2 += 8;
                            }
                            if (2 & n3.wrap && f2 === 35615) {
                              M[n3.check = 0] = 255 & f2, M[1] = f2 >>> 8 & 255, n3.check = i2(n3.check, M, 2, 0), y2 = f2 = 0, n3.mode = 2;
                              break;
                            }
                            if (n3.flags = 0, n3.head && (n3.head.done = false), !(1 & n3.wrap) || (((255 & f2) << 8) + (f2 >> 8)) % 31) {
                              e4.msg = "incorrect header check", n3.mode = 30;
                              break;
                            }
                            if ((15 & f2) != 8) {
                              e4.msg = "unknown compression method", n3.mode = 30;
                              break;
                            }
                            if (y2 -= 4, _ = 8 + (15 & (f2 >>>= 4)), n3.wbits === 0)
                              n3.wbits = _;
                            else if (_ > n3.wbits) {
                              e4.msg = "invalid window size", n3.mode = 30;
                              break;
                            }
                            n3.dmax = 1 << _, e4.adler = n3.check = 1, n3.mode = 512 & f2 ? 10 : 12, y2 = f2 = 0;
                            break;
                          case 2:
                            for (; y2 < 16; ) {
                              if (h2 === 0) break e;
                              h2--, f2 += u3[d3++] << y2, y2 += 8;
                            }
                            if (n3.flags = f2, (255 & n3.flags) != 8) {
                              e4.msg = "unknown compression method", n3.mode = 30;
                              break;
                            }
                            if (57344 & n3.flags) {
                              e4.msg = "unknown header flags set", n3.mode = 30;
                              break;
                            }
                            n3.head && (n3.head.text = f2 >> 8 & 1), 512 & n3.flags && (M[0] = 255 & f2, M[1] = f2 >>> 8 & 255, n3.check = i2(n3.check, M, 2, 0)), y2 = f2 = 0, n3.mode = 3;
                          case 3:
                            for (; y2 < 32; ) {
                              if (h2 === 0) break e;
                              h2--, f2 += u3[d3++] << y2, y2 += 8;
                            }
                            n3.head && (n3.head.time = f2), 512 & n3.flags && (M[0] = 255 & f2, M[1] = f2 >>> 8 & 255, M[2] = f2 >>> 16 & 255, M[3] = f2 >>> 24 & 255, n3.check = i2(n3.check, M, 4, 0)), y2 = f2 = 0, n3.mode = 4;
                          case 4:
                            for (; y2 < 16; ) {
                              if (h2 === 0) break e;
                              h2--, f2 += u3[d3++] << y2, y2 += 8;
                            }
                            n3.head && (n3.head.xflags = 255 & f2, n3.head.os = f2 >> 8), 512 & n3.flags && (M[0] = 255 & f2, M[1] = f2 >>> 8 & 255, n3.check = i2(n3.check, M, 2, 0)), y2 = f2 = 0, n3.mode = 5;
                          case 5:
                            if (1024 & n3.flags) {
                              for (; y2 < 16; ) {
                                if (h2 === 0) break e;
                                h2--, f2 += u3[d3++] << y2, y2 += 8;
                              }
                              n3.length = f2, n3.head && (n3.head.extra_len = f2), 512 & n3.flags && (M[0] = 255 & f2, M[1] = f2 >>> 8 & 255, n3.check = i2(n3.check, M, 2, 0)), y2 = f2 = 0;
                            } else n3.head && (n3.head.extra = null);
                            n3.mode = 6;
                          case 6:
                            if (1024 & n3.flags && (h2 < (T = n3.length) && (T = h2), T && (n3.head && (_ = n3.head.extra_len - n3.length, n3.head.extra || (n3.head.extra = new Array(
                              n3.head.extra_len
                            )), a2.arraySet(n3.head.extra, u3, d3, T, _)), 512 & n3.flags && (n3.check = i2(n3.check, u3, T, d3)), h2 -= T, d3 += T, n3.length -= T), n3.length))
                              break e;
                            n3.length = 0, n3.mode = 7;
                          case 7:
                            if (2048 & n3.flags) {
                              if (h2 === 0) break e;
                              for (T = 0; _ = u3[d3 + T++], n3.head && _ && n3.length < 65536 && (n3.head.name += String.fromCharCode(_)), _ && T < h2; ) ;
                              if (512 & n3.flags && (n3.check = i2(n3.check, u3, T, d3)), h2 -= T, d3 += T, _)
                                break e;
                            } else n3.head && (n3.head.name = null);
                            n3.length = 0, n3.mode = 8;
                          case 8:
                            if (4096 & n3.flags) {
                              if (h2 === 0) break e;
                              for (T = 0; _ = u3[d3 + T++], n3.head && _ && n3.length < 65536 && (n3.head.comment += String.fromCharCode(_)), _ && T < h2; ) ;
                              if (512 & n3.flags && (n3.check = i2(n3.check, u3, T, d3)), h2 -= T, d3 += T, _)
                                break e;
                            } else n3.head && (n3.head.comment = null);
                            n3.mode = 9;
                          case 9:
                            if (512 & n3.flags) {
                              for (; y2 < 16; ) {
                                if (h2 === 0) break e;
                                h2--, f2 += u3[d3++] << y2, y2 += 8;
                              }
                              if (f2 !== (65535 & n3.check)) {
                                e4.msg = "header crc mismatch", n3.mode = 30;
                                break;
                              }
                              y2 = f2 = 0;
                            }
                            n3.head && (n3.head.hcrc = n3.flags >> 9 & 1, n3.head.done = true), e4.adler = n3.check = 0, n3.mode = 12;
                            break;
                          case 10:
                            for (; y2 < 32; ) {
                              if (h2 === 0) break e;
                              h2--, f2 += u3[d3++] << y2, y2 += 8;
                            }
                            e4.adler = n3.check = c2(f2), y2 = f2 = 0, n3.mode = 11;
                          case 11:
                            if (n3.havedict === 0)
                              return e4.next_out = m3, e4.avail_out = g2, e4.next_in = d3, e4.avail_in = h2, n3.hold = f2, n3.bits = y2, 2;
                            e4.adler = n3.check = 1, n3.mode = 12;
                          case 12:
                            if (t4 === 5 || t4 === 6) break e;
                          case 13:
                            if (n3.last) {
                              f2 >>>= 7 & y2, y2 -= 7 & y2, n3.mode = 27;
                              break;
                            }
                            for (; y2 < 3; ) {
                              if (h2 === 0) break e;
                              h2--, f2 += u3[d3++] << y2, y2 += 8;
                            }
                            switch (n3.last = 1 & f2, y2 -= 1, 3 & (f2 >>>= 1)) {
                              case 0:
                                n3.mode = 14;
                                break;
                              case 1:
                                if (b(n3), n3.mode = 20, t4 !== 6) break;
                                f2 >>>= 2, y2 -= 2;
                                break e;
                              case 2:
                                n3.mode = 17;
                                break;
                              case 3:
                                e4.msg = "invalid block type", n3.mode = 30;
                            }
                            f2 >>>= 2, y2 -= 2;
                            break;
                          case 14:
                            for (f2 >>>= 7 & y2, y2 -= 7 & y2; y2 < 32; ) {
                              if (h2 === 0) break e;
                              h2--, f2 += u3[d3++] << y2, y2 += 8;
                            }
                            if ((65535 & f2) != (f2 >>> 16 ^ 65535)) {
                              e4.msg = "invalid stored block lengths", n3.mode = 30;
                              break;
                            }
                            if (n3.length = 65535 & f2, y2 = f2 = 0, n3.mode = 15, t4 === 6)
                              break e;
                          case 15:
                            n3.mode = 16;
                          case 16:
                            if (T = n3.length) {
                              if (h2 < T && (T = h2), g2 < T && (T = g2), T === 0)
                                break e;
                              a2.arraySet(p3, u3, d3, T, m3), h2 -= T, d3 += T, g2 -= T, m3 += T, n3.length -= T;
                              break;
                            }
                            n3.mode = 12;
                            break;
                          case 17:
                            for (; y2 < 14; ) {
                              if (h2 === 0) break e;
                              h2--, f2 += u3[d3++] << y2, y2 += 8;
                            }
                            if (n3.nlen = 257 + (31 & f2), f2 >>>= 5, y2 -= 5, n3.ndist = 1 + (31 & f2), f2 >>>= 5, y2 -= 5, n3.ncode = 4 + (15 & f2), f2 >>>= 4, y2 -= 4, n3.nlen > 286 || n3.ndist > 30) {
                              e4.msg = "too many length or distance symbols", n3.mode = 30;
                              break;
                            }
                            n3.have = 0, n3.mode = 18;
                          case 18:
                            for (; n3.have < n3.ncode; ) {
                              for (; y2 < 3; ) {
                                if (h2 === 0) break e;
                                h2--, f2 += u3[d3++] << y2, y2 += 8;
                              }
                              n3.lens[$[n3.have++]] = 7 & f2, f2 >>>= 3, y2 -= 3;
                            }
                            for (; n3.have < 19; ) n3.lens[$[n3.have++]] = 0;
                            if (n3.lencode = n3.lendyn, n3.lenbits = 7, N = { bits: n3.lenbits }, P = s2(
                              0,
                              n3.lens,
                              0,
                              19,
                              n3.lencode,
                              0,
                              n3.work,
                              N
                            ), n3.lenbits = N.bits, P) {
                              e4.msg = "invalid code lengths set", n3.mode = 30;
                              break;
                            }
                            n3.have = 0, n3.mode = 19;
                          case 19:
                            for (; n3.have < n3.nlen + n3.ndist; ) {
                              for (; S = (L = n3.lencode[f2 & (1 << n3.lenbits) - 1]) >>> 16 & 255, x = 65535 & L, !((I = L >>> 24) <= y2); ) {
                                if (h2 === 0) break e;
                                h2--, f2 += u3[d3++] << y2, y2 += 8;
                              }
                              if (x < 16)
                                f2 >>>= I, y2 -= I, n3.lens[n3.have++] = x;
                              else {
                                if (x === 16) {
                                  for (D = I + 2; y2 < D; ) {
                                    if (h2 === 0) break e;
                                    h2--, f2 += u3[d3++] << y2, y2 += 8;
                                  }
                                  if (f2 >>>= I, y2 -= I, n3.have === 0) {
                                    e4.msg = "invalid bit length repeat", n3.mode = 30;
                                    break;
                                  }
                                  _ = n3.lens[n3.have - 1], T = 3 + (3 & f2), f2 >>>= 2, y2 -= 2;
                                } else if (x === 17) {
                                  for (D = I + 3; y2 < D; ) {
                                    if (h2 === 0) break e;
                                    h2--, f2 += u3[d3++] << y2, y2 += 8;
                                  }
                                  y2 -= I, _ = 0, T = 3 + (7 & (f2 >>>= I)), f2 >>>= 3, y2 -= 3;
                                } else {
                                  for (D = I + 7; y2 < D; ) {
                                    if (h2 === 0) break e;
                                    h2--, f2 += u3[d3++] << y2, y2 += 8;
                                  }
                                  y2 -= I, _ = 0, T = 11 + (127 & (f2 >>>= I)), f2 >>>= 7, y2 -= 7;
                                }
                                if (n3.have + T > n3.nlen + n3.ndist) {
                                  e4.msg = "invalid bit length repeat", n3.mode = 30;
                                  break;
                                }
                                for (; T--; ) n3.lens[n3.have++] = _;
                              }
                            }
                            if (n3.mode === 30) break;
                            if (n3.lens[256] === 0) {
                              e4.msg = "invalid code -- missing end-of-block", n3.mode = 30;
                              break;
                            }
                            if (n3.lenbits = 9, N = { bits: n3.lenbits }, P = s2(
                              1,
                              n3.lens,
                              0,
                              n3.nlen,
                              n3.lencode,
                              0,
                              n3.work,
                              N
                            ), n3.lenbits = N.bits, P) {
                              e4.msg = "invalid literal/lengths set", n3.mode = 30;
                              break;
                            }
                            if (n3.distbits = 6, n3.distcode = n3.distdyn, N = { bits: n3.distbits }, P = s2(
                              2,
                              n3.lens,
                              n3.nlen,
                              n3.ndist,
                              n3.distcode,
                              0,
                              n3.work,
                              N
                            ), n3.distbits = N.bits, P) {
                              e4.msg = "invalid distances set", n3.mode = 30;
                              break;
                            }
                            if (n3.mode = 20, t4 === 6) break e;
                          case 20:
                            n3.mode = 21;
                          case 21:
                            if (h2 >= 6 && g2 >= 258) {
                              e4.next_out = m3, e4.avail_out = g2, e4.next_in = d3, e4.avail_in = h2, n3.hold = f2, n3.bits = y2, r2(e4, k), m3 = e4.next_out, p3 = e4.output, g2 = e4.avail_out, d3 = e4.next_in, u3 = e4.input, h2 = e4.avail_in, f2 = n3.hold, y2 = n3.bits, n3.mode === 12 && (n3.back = -1);
                              break;
                            }
                            for (n3.back = 0; S = (L = n3.lencode[f2 & (1 << n3.lenbits) - 1]) >>> 16 & 255, x = 65535 & L, !((I = L >>> 24) <= y2); ) {
                              if (h2 === 0) break e;
                              h2--, f2 += u3[d3++] << y2, y2 += 8;
                            }
                            if (S && (240 & S) == 0) {
                              for (C = I, O = S, R = x; S = (L = n3.lencode[R + ((f2 & (1 << C + O) - 1) >> C)]) >>> 16 & 255, x = 65535 & L, !(C + (I = L >>> 24) <= y2); ) {
                                if (h2 === 0) break e;
                                h2--, f2 += u3[d3++] << y2, y2 += 8;
                              }
                              f2 >>>= C, y2 -= C, n3.back += C;
                            }
                            if (f2 >>>= I, y2 -= I, n3.back += I, n3.length = x, S === 0) {
                              n3.mode = 26;
                              break;
                            }
                            if (32 & S) {
                              n3.back = -1, n3.mode = 12;
                              break;
                            }
                            if (64 & S) {
                              e4.msg = "invalid literal/length code", n3.mode = 30;
                              break;
                            }
                            n3.extra = 15 & S, n3.mode = 22;
                          case 22:
                            if (n3.extra) {
                              for (D = n3.extra; y2 < D; ) {
                                if (h2 === 0) break e;
                                h2--, f2 += u3[d3++] << y2, y2 += 8;
                              }
                              n3.length += f2 & (1 << n3.extra) - 1, f2 >>>= n3.extra, y2 -= n3.extra, n3.back += n3.extra;
                            }
                            n3.was = n3.length, n3.mode = 23;
                          case 23:
                            for (; S = (L = n3.distcode[f2 & (1 << n3.distbits) - 1]) >>> 16 & 255, x = 65535 & L, !((I = L >>> 24) <= y2); ) {
                              if (h2 === 0) break e;
                              h2--, f2 += u3[d3++] << y2, y2 += 8;
                            }
                            if ((240 & S) == 0) {
                              for (C = I, O = S, R = x; S = (L = n3.distcode[R + ((f2 & (1 << C + O) - 1) >> C)]) >>> 16 & 255, x = 65535 & L, !(C + (I = L >>> 24) <= y2); ) {
                                if (h2 === 0) break e;
                                h2--, f2 += u3[d3++] << y2, y2 += 8;
                              }
                              f2 >>>= C, y2 -= C, n3.back += C;
                            }
                            if (f2 >>>= I, y2 -= I, n3.back += I, 64 & S) {
                              e4.msg = "invalid distance code", n3.mode = 30;
                              break;
                            }
                            n3.offset = x, n3.extra = 15 & S, n3.mode = 24;
                          case 24:
                            if (n3.extra) {
                              for (D = n3.extra; y2 < D; ) {
                                if (h2 === 0) break e;
                                h2--, f2 += u3[d3++] << y2, y2 += 8;
                              }
                              n3.offset += f2 & (1 << n3.extra) - 1, f2 >>>= n3.extra, y2 -= n3.extra, n3.back += n3.extra;
                            }
                            if (n3.offset > n3.dmax) {
                              e4.msg = "invalid distance too far back", n3.mode = 30;
                              break;
                            }
                            n3.mode = 25;
                          case 25:
                            if (g2 === 0) break e;
                            if (T = k - g2, n3.offset > T) {
                              if ((T = n3.offset - T) > n3.whave && n3.sane) {
                                e4.msg = "invalid distance too far back", n3.mode = 30;
                                break;
                              }
                              A = T > n3.wnext ? (T -= n3.wnext, n3.wsize - T) : n3.wnext - T, T > n3.length && (T = n3.length), E = n3.window;
                            } else
                              E = p3, A = m3 - n3.offset, T = n3.length;
                            for (g2 < T && (T = g2), g2 -= T, n3.length -= T; p3[m3++] = E[A++], --T; ) ;
                            n3.length === 0 && (n3.mode = 21);
                            break;
                          case 26:
                            if (g2 === 0) break e;
                            p3[m3++] = n3.length, g2--, n3.mode = 21;
                            break;
                          case 27:
                            if (n3.wrap) {
                              for (; y2 < 32; ) {
                                if (h2 === 0) break e;
                                h2--, f2 |= u3[d3++] << y2, y2 += 8;
                              }
                              if (k -= g2, e4.total_out += k, n3.total += k, k && (e4.adler = n3.check = n3.flags ? i2(n3.check, p3, k, m3 - k) : o2(n3.check, p3, k, m3 - k)), k = g2, (n3.flags ? f2 : c2(f2)) !== n3.check) {
                                e4.msg = "incorrect data check", n3.mode = 30;
                                break;
                              }
                              y2 = f2 = 0;
                            }
                            n3.mode = 28;
                          case 28:
                            if (n3.wrap && n3.flags) {
                              for (; y2 < 32; ) {
                                if (h2 === 0) break e;
                                h2--, f2 += u3[d3++] << y2, y2 += 8;
                              }
                              if (f2 !== (4294967295 & n3.total)) {
                                e4.msg = "incorrect length check", n3.mode = 30;
                                break;
                              }
                              y2 = f2 = 0;
                            }
                            n3.mode = 29;
                          case 29:
                            P = 1;
                            break e;
                          case 30:
                            P = -3;
                            break e;
                          case 31:
                            return -4;
                          default:
                            return -2;
                        }
                      return e4.next_out = m3, e4.avail_out = g2, e4.next_in = d3, e4.avail_in = h2, n3.hold = f2, n3.bits = y2, (n3.wsize || k !== e4.avail_out && n3.mode < 30 && (n3.mode < 27 || t4 !== 4)) && w(e4, e4.output, e4.next_out, k - e4.avail_out) ? (n3.mode = 31, -4) : (v -= e4.avail_in, k -= e4.avail_out, e4.total_in += v, e4.total_out += k, n3.total += k, n3.wrap && k && (e4.adler = n3.check = n3.flags ? i2(n3.check, p3, k, e4.next_out - k) : o2(n3.check, p3, k, e4.next_out - k)), e4.data_type = n3.bits + (n3.last ? 64 : 0) + (n3.mode === 12 ? 128 : 0) + (n3.mode === 20 || n3.mode === 15 ? 256 : 0), (v == 0 && k === 0 || t4 === 4) && P === 0 && (P = -5), P);
                    }, n2.inflateEnd = function(e4) {
                      if (!e4 || !e4.state) return -2;
                      var t4 = e4.state;
                      return t4.window && (t4.window = null), e4.state = null, 0;
                    }, n2.inflateGetHeader = function(e4, t4) {
                      var n3;
                      return e4 && e4.state ? (2 & (n3 = e4.state).wrap) == 0 ? -2 : ((n3.head = t4).done = false, 0) : -2;
                    }, n2.inflateSetDictionary = function(e4, t4) {
                      var n3, a3 = t4.length;
                      return e4 && e4.state ? (n3 = e4.state).wrap !== 0 && n3.mode !== 11 ? -2 : n3.mode === 11 && o2(1, t4, a3, 0) !== n3.check ? -3 : w(e4, t4, a3, a3) ? (n3.mode = 31, -4) : (n3.havedict = 1, 0) : -2;
                    }, n2.inflateInfo = "pako inflate (from Nodeca project)";
                  },
                  {
                    "../utils/common": 41,
                    "./adler32": 43,
                    "./crc32": 45,
                    "./inffast": 48,
                    "./inftrees": 50
                  }
                ],
                50: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = e3("../utils/common"), o2 = [
                      3,
                      4,
                      5,
                      6,
                      7,
                      8,
                      9,
                      10,
                      11,
                      13,
                      15,
                      17,
                      19,
                      23,
                      27,
                      31,
                      35,
                      43,
                      51,
                      59,
                      67,
                      83,
                      99,
                      115,
                      131,
                      163,
                      195,
                      227,
                      258,
                      0,
                      0
                    ], i2 = [
                      16,
                      16,
                      16,
                      16,
                      16,
                      16,
                      16,
                      16,
                      17,
                      17,
                      17,
                      17,
                      18,
                      18,
                      18,
                      18,
                      19,
                      19,
                      19,
                      19,
                      20,
                      20,
                      20,
                      20,
                      21,
                      21,
                      21,
                      21,
                      16,
                      72,
                      78
                    ], r2 = [
                      1,
                      2,
                      3,
                      4,
                      5,
                      7,
                      9,
                      13,
                      17,
                      25,
                      33,
                      49,
                      65,
                      97,
                      129,
                      193,
                      257,
                      385,
                      513,
                      769,
                      1025,
                      1537,
                      2049,
                      3073,
                      4097,
                      6145,
                      8193,
                      12289,
                      16385,
                      24577,
                      0,
                      0
                    ], s2 = [
                      16,
                      16,
                      16,
                      16,
                      17,
                      17,
                      18,
                      18,
                      19,
                      19,
                      20,
                      20,
                      21,
                      21,
                      22,
                      22,
                      23,
                      23,
                      24,
                      24,
                      25,
                      25,
                      26,
                      26,
                      27,
                      27,
                      28,
                      28,
                      29,
                      29,
                      64,
                      64
                    ];
                    t3.exports = function(e4, t4, n3, l2, c2, u2, p2, d2) {
                      var m2, h, g, f, y, b, w, v, k, T = d2.bits, A = 0, E = 0, I = 0, S = 0, x = 0, C = 0, O = 0, R = 0, _ = 0, P = 0, N = null, D = 0, L = new a2.Buf16(16), M = new a2.Buf16(16), $ = null, U = 0;
                      for (A = 0; A <= 15; A++) L[A] = 0;
                      for (E = 0; E < l2; E++) L[t4[n3 + E]]++;
                      for (x = T, S = 15; S >= 1 && L[S] === 0; S--) ;
                      if (S < x && (x = S), S == 0)
                        return c2[u2++] = 20971520, c2[u2++] = 20971520, d2.bits = 1, 0;
                      for (I = 1; I < S && L[I] === 0; I++) ;
                      for (x < I && (x = I), A = R = 1; A <= 15; A++)
                        if (R <<= 1, (R -= L[A]) < 0) return -1;
                      if (R > 0 && (e4 === 0 || S !== 1)) return -1;
                      for (M[1] = 0, A = 1; A < 15; A++) M[A + 1] = M[A] + L[A];
                      for (E = 0; E < l2; E++)
                        t4[n3 + E] !== 0 && (p2[M[t4[n3 + E]]++] = E);
                      if (b = e4 === 0 ? (N = $ = p2, 19) : e4 === 1 ? (N = o2, D -= 257, $ = i2, U -= 257, 256) : (N = r2, $ = s2, -1), A = I, y = u2, O = E = P = 0, g = -1, f = (_ = 1 << (C = x)) - 1, e4 === 1 && _ > 852 || e4 === 2 && _ > 592)
                        return 1;
                      for (; ; ) {
                        for (w = A - O, k = p2[E] < b ? (v = 0, p2[E]) : p2[E] > b ? (v = $[U + p2[E]], N[D + p2[E]]) : (v = 96, 0), m2 = 1 << A - O, I = h = 1 << C; c2[y + (P >> O) + (h -= m2)] = w << 24 | v << 16 | k | 0, h !== 0; ) ;
                        for (m2 = 1 << A - 1; P & m2; ) m2 >>= 1;
                        if (m2 !== 0 ? (P &= m2 - 1, P += m2) : P = 0, E++, --L[A] == 0) {
                          if (A === S) break;
                          A = t4[n3 + p2[E]];
                        }
                        if (x < A && (P & f) !== g) {
                          for (O === 0 && (O = x), y += I, R = 1 << (C = A - O); C + O < S && !((R -= L[C + O]) <= 0); )
                            C++, R <<= 1;
                          if (_ += 1 << C, e4 === 1 && _ > 852 || e4 === 2 && _ > 592)
                            return 1;
                          c2[g = P & f] = x << 24 | C << 16 | y - u2 | 0;
                        }
                      }
                      return P !== 0 && (c2[y + P] = A - O << 24 | 4194304 | 0), d2.bits = x, 0;
                    };
                  },
                  { "../utils/common": 41 }
                ],
                51: [
                  function(e3, t3, n2) {
                    "use strict";
                    t3.exports = {
                      2: "need dictionary",
                      1: "stream end",
                      0: "",
                      "-1": "file error",
                      "-2": "stream error",
                      "-3": "data error",
                      "-4": "insufficient memory",
                      "-5": "buffer error",
                      "-6": "incompatible version"
                    };
                  },
                  {}
                ],
                52: [
                  function(e3, t3, n2) {
                    "use strict";
                    var a2 = e3("../utils/common");
                    function o2(e4) {
                      for (var t4 = e4.length; --t4 >= 0; ) e4[t4] = 0;
                    }
                    var i2 = 256, r2 = 286, s2 = 30, l2 = 15, c2 = [
                      0,
                      0,
                      0,
                      0,
                      0,
                      0,
                      0,
                      0,
                      1,
                      1,
                      1,
                      1,
                      2,
                      2,
                      2,
                      2,
                      3,
                      3,
                      3,
                      3,
                      4,
                      4,
                      4,
                      4,
                      5,
                      5,
                      5,
                      5,
                      0
                    ], u2 = [
                      0,
                      0,
                      0,
                      0,
                      1,
                      1,
                      2,
                      2,
                      3,
                      3,
                      4,
                      4,
                      5,
                      5,
                      6,
                      6,
                      7,
                      7,
                      8,
                      8,
                      9,
                      9,
                      10,
                      10,
                      11,
                      11,
                      12,
                      12,
                      13,
                      13
                    ], p2 = [
                      0,
                      0,
                      0,
                      0,
                      0,
                      0,
                      0,
                      0,
                      0,
                      0,
                      0,
                      0,
                      0,
                      0,
                      0,
                      0,
                      2,
                      3,
                      7
                    ], d2 = [
                      16,
                      17,
                      18,
                      0,
                      8,
                      7,
                      9,
                      6,
                      10,
                      5,
                      11,
                      4,
                      12,
                      3,
                      13,
                      2,
                      14,
                      1,
                      15
                    ], m2 = new Array(576);
                    o2(m2);
                    var h = new Array(60);
                    o2(h);
                    var g = new Array(512);
                    o2(g);
                    var f = new Array(256);
                    o2(f);
                    var y = new Array(29);
                    o2(y);
                    var b, w, v, k = new Array(30);
                    function T(e4, t4, n3, a3, o3) {
                      this.static_tree = e4, this.extra_bits = t4, this.extra_base = n3, this.elems = a3, this.max_length = o3, this.has_stree = e4 && e4.length;
                    }
                    function A(e4, t4) {
                      this.dyn_tree = e4, this.max_code = 0, this.stat_desc = t4;
                    }
                    function E(e4) {
                      return e4 < 256 ? g[e4] : g[256 + (e4 >>> 7)];
                    }
                    function I(e4, t4) {
                      e4.pending_buf[e4.pending++] = 255 & t4, e4.pending_buf[e4.pending++] = t4 >>> 8 & 255;
                    }
                    function S(e4, t4, n3) {
                      e4.bi_valid > 16 - n3 ? (e4.bi_buf |= t4 << e4.bi_valid & 65535, I(e4, e4.bi_buf), e4.bi_buf = t4 >> 16 - e4.bi_valid, e4.bi_valid += n3 - 16) : (e4.bi_buf |= t4 << e4.bi_valid & 65535, e4.bi_valid += n3);
                    }
                    function x(e4, t4, n3) {
                      S(e4, n3[2 * t4], n3[2 * t4 + 1]);
                    }
                    function C(e4, t4) {
                      for (var n3 = 0; n3 |= 1 & e4, e4 >>>= 1, n3 <<= 1, --t4 > 0; ) ;
                      return n3 >>> 1;
                    }
                    function O(e4, t4, n3) {
                      var a3, o3, i3 = new Array(16), r3 = 0;
                      for (a3 = 1; a3 <= 15; a3++) i3[a3] = r3 = r3 + n3[a3 - 1] << 1;
                      for (o3 = 0; o3 <= t4; o3++) {
                        var s3 = e4[2 * o3 + 1];
                        s3 !== 0 && (e4[2 * o3] = C(i3[s3]++, s3));
                      }
                    }
                    function R(e4) {
                      var t4;
                      for (t4 = 0; t4 < 286; t4++) e4.dyn_ltree[2 * t4] = 0;
                      for (t4 = 0; t4 < 30; t4++) e4.dyn_dtree[2 * t4] = 0;
                      for (t4 = 0; t4 < 19; t4++) e4.bl_tree[2 * t4] = 0;
                      e4.dyn_ltree[512] = 1, e4.opt_len = e4.static_len = 0, e4.last_lit = e4.matches = 0;
                    }
                    function _(e4) {
                      e4.bi_valid > 8 ? I(e4, e4.bi_buf) : e4.bi_valid > 0 && (e4.pending_buf[e4.pending++] = e4.bi_buf), e4.bi_buf = 0, e4.bi_valid = 0;
                    }
                    function P(e4, t4, n3, a3) {
                      var o3 = 2 * t4, i3 = 2 * n3;
                      return e4[o3] < e4[i3] || e4[o3] === e4[i3] && a3[t4] <= a3[n3];
                    }
                    function N(e4, t4, n3) {
                      for (var a3 = e4.heap[n3], o3 = n3 << 1; o3 <= e4.heap_len && (o3 < e4.heap_len && P(t4, e4.heap[o3 + 1], e4.heap[o3], e4.depth) && o3++, !P(t4, a3, e4.heap[o3], e4.depth)); )
                        e4.heap[n3] = e4.heap[o3], n3 = o3, o3 <<= 1;
                      e4.heap[n3] = a3;
                    }
                    function D(e4, t4, n3) {
                      var a3, o3, r3, s3, l3 = 0;
                      if (e4.last_lit !== 0)
                        for (; a3 = e4.pending_buf[e4.d_buf + 2 * l3] << 8 | e4.pending_buf[e4.d_buf + 2 * l3 + 1], o3 = e4.pending_buf[e4.l_buf + l3], l3++, a3 === 0 ? x(e4, o3, t4) : (x(e4, (r3 = f[o3]) + 256 + 1, t4), (s3 = c2[r3]) !== 0 && S(e4, o3 -= y[r3], s3), x(e4, r3 = E(--a3), n3), (s3 = u2[r3]) !== 0 && S(e4, a3 -= k[r3], s3)), l3 < e4.last_lit; ) ;
                      x(e4, 256, t4);
                    }
                    function L(e4, t4) {
                      var n3, a3, o3, i3 = t4.dyn_tree, r3 = t4.stat_desc.static_tree, s3 = t4.stat_desc.has_stree, c3 = t4.stat_desc.elems, u3 = -1;
                      for (e4.heap_len = 0, e4.heap_max = 573, n3 = 0; n3 < c3; n3++)
                        i3[2 * n3] !== 0 ? (e4.heap[++e4.heap_len] = u3 = n3, e4.depth[n3] = 0) : i3[2 * n3 + 1] = 0;
                      for (; e4.heap_len < 2; )
                        i3[2 * (o3 = e4.heap[++e4.heap_len] = u3 < 2 ? ++u3 : 0)] = 1, e4.depth[o3] = 0, e4.opt_len--, s3 && (e4.static_len -= r3[2 * o3 + 1]);
                      for (t4.max_code = u3, n3 = e4.heap_len >> 1; n3 >= 1; n3--)
                        N(e4, i3, n3);
                      for (o3 = c3; n3 = e4.heap[1], e4.heap[1] = e4.heap[e4.heap_len--], N(e4, i3, 1), a3 = e4.heap[1], e4.heap[--e4.heap_max] = n3, e4.heap[--e4.heap_max] = a3, i3[2 * o3] = i3[2 * n3] + i3[2 * a3], e4.depth[o3] = (e4.depth[n3] >= e4.depth[a3] ? e4.depth[n3] : e4.depth[a3]) + 1, i3[2 * n3 + 1] = i3[2 * a3 + 1] = o3, e4.heap[1] = o3++, N(e4, i3, 1), e4.heap_len >= 2; ) ;
                      e4.heap[--e4.heap_max] = e4.heap[1], function(e5, t5) {
                        var n4, a4, o4, i4, r4, s4, c4 = t5.dyn_tree, u4 = t5.max_code, p3 = t5.stat_desc.static_tree, d3 = t5.stat_desc.has_stree, m3 = t5.stat_desc.extra_bits, h2 = t5.stat_desc.extra_base, g2 = t5.stat_desc.max_length, f2 = 0;
                        for (i4 = 0; i4 <= 15; i4++) e5.bl_count[i4] = 0;
                        for (c4[2 * e5.heap[e5.heap_max] + 1] = 0, n4 = e5.heap_max + 1; n4 < 573; n4++)
                          g2 < (i4 = c4[2 * c4[2 * (a4 = e5.heap[n4]) + 1] + 1] + 1) && (i4 = g2, f2++), c4[2 * a4 + 1] = i4, u4 < a4 || (e5.bl_count[i4]++, r4 = 0, h2 <= a4 && (r4 = m3[a4 - h2]), s4 = c4[2 * a4], e5.opt_len += s4 * (i4 + r4), d3 && (e5.static_len += s4 * (p3[2 * a4 + 1] + r4)));
                        if (f2 != 0) {
                          do {
                            for (i4 = g2 - 1; e5.bl_count[i4] === 0; ) i4--;
                            e5.bl_count[i4]--, e5.bl_count[i4 + 1] += 2, e5.bl_count[g2]--, f2 -= 2;
                          } while (f2 > 0);
                          for (i4 = g2; i4 !== 0; i4--)
                            for (a4 = e5.bl_count[i4]; a4 !== 0; )
                              u4 < (o4 = e5.heap[--n4]) || (c4[2 * o4 + 1] !== i4 && (e5.opt_len += (i4 - c4[2 * o4 + 1]) * c4[2 * o4], c4[2 * o4 + 1] = i4), a4--);
                        }
                      }(e4, t4), O(i3, u3, e4.bl_count);
                    }
                    function M(e4, t4, n3) {
                      var a3, o3, i3 = -1, r3 = t4[1], s3 = 0, l3 = 7, c3 = 4;
                      for (r3 === 0 && (l3 = 138, c3 = 3), t4[2 * (n3 + 1) + 1] = 65535, a3 = 0; a3 <= n3; a3++)
                        o3 = r3, r3 = t4[2 * (a3 + 1) + 1], ++s3 < l3 && o3 === r3 || (s3 < c3 ? e4.bl_tree[2 * o3] += s3 : o3 !== 0 ? (o3 !== i3 && e4.bl_tree[2 * o3]++, e4.bl_tree[32]++) : s3 <= 10 ? e4.bl_tree[34]++ : e4.bl_tree[36]++, i3 = o3, c3 = (s3 = 0) === r3 ? (l3 = 138, 3) : o3 === r3 ? (l3 = 6, 3) : (l3 = 7, 4));
                    }
                    function $(e4, t4, n3) {
                      var a3, o3, i3 = -1, r3 = t4[1], s3 = 0, l3 = 7, c3 = 4;
                      for (r3 === 0 && (l3 = 138, c3 = 3), a3 = 0; a3 <= n3; a3++)
                        if (o3 = r3, r3 = t4[2 * (a3 + 1) + 1], !(++s3 < l3 && o3 === r3)) {
                          if (s3 < c3) for (; x(e4, o3, e4.bl_tree), --s3 != 0; ) ;
                          else
                            o3 !== 0 ? (o3 !== i3 && (x(e4, o3, e4.bl_tree), s3--), x(e4, 16, e4.bl_tree), S(e4, s3 - 3, 2)) : s3 <= 10 ? (x(e4, 17, e4.bl_tree), S(e4, s3 - 3, 3)) : (x(e4, 18, e4.bl_tree), S(e4, s3 - 11, 7));
                          i3 = o3, c3 = (s3 = 0) === r3 ? (l3 = 138, 3) : o3 === r3 ? (l3 = 6, 3) : (l3 = 7, 4);
                        }
                    }
                    o2(k);
                    var U = false;
                    function F(e4, t4, n3, o3) {
                      var i3, r3, s3;
                      S(e4, 0 + (o3 ? 1 : 0), 3), r3 = t4, s3 = n3, _(i3 = e4), I(i3, s3), I(i3, ~s3), a2.arraySet(i3.pending_buf, i3.window, r3, s3, i3.pending), i3.pending += s3;
                    }
                    n2._tr_init = function(e4) {
                      U || (function() {
                        var e5, t4, n3, a3, o3, i3 = new Array(16);
                        for (a3 = n3 = 0; a3 < 28; a3++)
                          for (y[a3] = n3, e5 = 0; e5 < 1 << c2[a3]; e5++) f[n3++] = a3;
                        for (f[n3 - 1] = a3, a3 = o3 = 0; a3 < 16; a3++)
                          for (k[a3] = o3, e5 = 0; e5 < 1 << u2[a3]; e5++) g[o3++] = a3;
                        for (o3 >>= 7; a3 < 30; a3++)
                          for (k[a3] = o3 << 7, e5 = 0; e5 < 1 << u2[a3] - 7; e5++)
                            g[256 + o3++] = a3;
                        for (t4 = 0; t4 <= 15; t4++) i3[t4] = 0;
                        for (e5 = 0; e5 <= 143; )
                          m2[2 * e5 + 1] = 8, e5++, i3[8]++;
                        for (; e5 <= 255; ) m2[2 * e5 + 1] = 9, e5++, i3[9]++;
                        for (; e5 <= 279; ) m2[2 * e5 + 1] = 7, e5++, i3[7]++;
                        for (; e5 <= 287; ) m2[2 * e5 + 1] = 8, e5++, i3[8]++;
                        for (O(m2, 287, i3), e5 = 0; e5 < 30; e5++)
                          h[2 * e5 + 1] = 5, h[2 * e5] = C(e5, 5);
                        b = new T(m2, c2, 257, 286, 15), w = new T(h, u2, 0, 30, 15), v = new T(new Array(0), p2, 0, 19, 7);
                      }(), U = true), e4.l_desc = new A(e4.dyn_ltree, b), e4.d_desc = new A(e4.dyn_dtree, w), e4.bl_desc = new A(e4.bl_tree, v), e4.bi_buf = 0, e4.bi_valid = 0, R(e4);
                    }, n2._tr_stored_block = F, n2._tr_flush_block = function(e4, t4, n3, a3) {
                      var o3, r3, s3 = 0;
                      e4.level > 0 ? (e4.strm.data_type === 2 && (e4.strm.data_type = function(e5) {
                        var t5, n4 = 4093624447;
                        for (t5 = 0; t5 <= 31; t5++, n4 >>>= 1)
                          if (1 & n4 && e5.dyn_ltree[2 * t5] !== 0) return 0;
                        if (e5.dyn_ltree[18] !== 0 || e5.dyn_ltree[20] !== 0 || e5.dyn_ltree[26] !== 0)
                          return 1;
                        for (t5 = 32; t5 < 256; t5++)
                          if (e5.dyn_ltree[2 * t5] !== 0) return 1;
                        return 0;
                      }(e4)), L(e4, e4.l_desc), L(e4, e4.d_desc), s3 = function(e5) {
                        var t5;
                        for (M(e5, e5.dyn_ltree, e5.l_desc.max_code), M(e5, e5.dyn_dtree, e5.d_desc.max_code), L(e5, e5.bl_desc), t5 = 18; t5 >= 3 && e5.bl_tree[2 * d2[t5] + 1] === 0; t5--) ;
                        return e5.opt_len += 3 * (t5 + 1) + 5 + 5 + 4, t5;
                      }(e4), o3 = e4.opt_len + 3 + 7 >>> 3, (r3 = e4.static_len + 3 + 7 >>> 3) <= o3 && (o3 = r3)) : o3 = r3 = n3 + 5, n3 + 4 <= o3 && -1 !== t4 ? F(e4, t4, n3, a3) : e4.strategy === 4 || r3 === o3 ? (S(e4, 2 + (a3 ? 1 : 0), 3), D(e4, m2, h)) : (S(e4, 4 + (a3 ? 1 : 0), 3), function(e5, t5, n4, a4) {
                        var o4;
                        for (S(e5, t5 - 257, 5), S(e5, n4 - 1, 5), S(e5, a4 - 4, 4), o4 = 0; o4 < a4; o4++)
                          S(e5, e5.bl_tree[2 * d2[o4] + 1], 3);
                        $(e5, e5.dyn_ltree, t5 - 1), $(e5, e5.dyn_dtree, n4 - 1);
                      }(
                        e4,
                        e4.l_desc.max_code + 1,
                        e4.d_desc.max_code + 1,
                        s3 + 1
                      ), D(e4, e4.dyn_ltree, e4.dyn_dtree)), R(e4), a3 && _(e4);
                    }, n2._tr_tally = function(e4, t4, n3) {
                      return e4.pending_buf[e4.d_buf + 2 * e4.last_lit] = t4 >>> 8 & 255, e4.pending_buf[e4.d_buf + 2 * e4.last_lit + 1] = 255 & t4, e4.pending_buf[e4.l_buf + e4.last_lit] = 255 & n3, e4.last_lit++, t4 === 0 ? e4.dyn_ltree[2 * n3]++ : (e4.matches++, t4--, e4.dyn_ltree[2 * (f[n3] + 256 + 1)]++, e4.dyn_dtree[2 * E(t4)]++), e4.last_lit === e4.lit_bufsize - 1;
                    }, n2._tr_align = function(e4) {
                      var t4;
                      S(e4, 2, 3), x(e4, 256, m2), (t4 = e4).bi_valid === 16 ? (I(t4, t4.bi_buf), t4.bi_buf = 0, t4.bi_valid = 0) : t4.bi_valid >= 8 && (t4.pending_buf[t4.pending++] = 255 & t4.bi_buf, t4.bi_buf >>= 8, t4.bi_valid -= 8);
                    };
                  },
                  { "../utils/common": 41 }
                ],
                53: [
                  function(e3, t3, n2) {
                    "use strict";
                    t3.exports = function() {
                      this.input = null, this.next_in = 0, this.avail_in = 0, this.total_in = 0, this.output = null, this.next_out = 0, this.avail_out = 0, this.total_out = 0, this.msg = "", this.state = null, this.data_type = 2, this.adler = 0;
                    };
                  },
                  {}
                ],
                54: [
                  function(e3, t3, n2) {
                    (function(e4) {
                      !function(e5, t4) {
                        "use strict";
                        if (!e5.setImmediate) {
                          var n3, a2, o2, i2, r2 = 1, s2 = {}, l2 = false, c2 = e5.document, u2 = Object.getPrototypeOf && Object.getPrototypeOf(e5);
                          u2 = u2 && u2.setTimeout ? u2 : e5, n3 = {}.toString.call(e5.process) === "[object process]" ? function(e6) {
                            process.nextTick(function() {
                              d2(e6);
                            });
                          } : function() {
                            if (e5.postMessage && !e5.importScripts) {
                              var t5 = true, n4 = e5.onmessage;
                              return e5.onmessage = function() {
                                t5 = false;
                              }, e5.postMessage("", "*"), e5.onmessage = n4, t5;
                            }
                          }() ? (i2 = "setImmediate$" + Math.random() + "$", e5.addEventListener ? e5.addEventListener("message", m2, false) : e5.attachEvent("onmessage", m2), function(t5) {
                            e5.postMessage(i2 + t5, "*");
                          }) : e5.MessageChannel ? ((o2 = new MessageChannel()).port1.onmessage = function(e6) {
                            d2(e6.data);
                          }, function(e6) {
                            o2.port2.postMessage(e6);
                          }) : c2 && "onreadystatechange" in c2.createElement("script") ? (a2 = c2.documentElement, function(e6) {
                            var t5 = c2.createElement("script");
                            t5.onreadystatechange = function() {
                              d2(e6), t5.onreadystatechange = null, a2.removeChild(t5), t5 = null;
                            }, a2.appendChild(t5);
                          }) : function(e6) {
                            setTimeout(d2, 0, e6);
                          }, u2.setImmediate = function(e6) {
                            typeof e6 != "function" && (e6 = new Function("" + e6));
                            for (var t5 = new Array(arguments.length - 1), a3 = 0; a3 < t5.length; a3++)
                              t5[a3] = arguments[a3 + 1];
                            var o3 = { callback: e6, args: t5 };
                            return s2[r2] = o3, n3(r2), r2++;
                          }, u2.clearImmediate = p2;
                        }
                        function p2(e6) {
                          delete s2[e6];
                        }
                        function d2(e6) {
                          if (l2) setTimeout(d2, 0, e6);
                          else {
                            var t5 = s2[e6];
                            if (t5) {
                              l2 = true;
                              try {
                                !function(e7) {
                                  var t6 = e7.callback, n4 = e7.args;
                                  switch (n4.length) {
                                    case 0:
                                      t6();
                                      break;
                                    case 1:
                                      t6(n4[0]);
                                      break;
                                    case 2:
                                      t6(n4[0], n4[1]);
                                      break;
                                    case 3:
                                      t6(n4[0], n4[1], n4[2]);
                                      break;
                                    default:
                                      t6.apply(void 0, n4);
                                  }
                                }(t5);
                              } finally {
                                p2(e6), l2 = false;
                              }
                            }
                          }
                        }
                        function m2(t5) {
                          t5.source === e5 && typeof t5.data == "string" && t5.data.indexOf(i2) === 0 && d2(+t5.data.slice(i2.length));
                        }
                      }(
                        typeof self == "undefined" ? void 0 === e4 ? this : e4 : self
                      );
                    }).call(
                      this,
                      typeof global != "undefined" ? global : typeof self != "undefined" ? self : typeof window != "undefined" ? window : {}
                    );
                  },
                  {}
                ]
              },
              {},
              [10]
            )(10);
          });
        }
      }, n || (0, t[Object.keys(t)[0]])((n = { exports: {} }).exports, n), a = n.exports, d = ((e2, t2, n2) => {
        if (t2 && typeof t2 == "object" || typeof t2 == "function")
          for (let a2 of l(t2))
            u.call(e2, a2) || a2 === "default" || r(e2, a2, {
              get: () => t2[a2],
              enumerable: !(n2 = s(t2, a2)) || n2.enumerable
            });
        return e2;
      })(
        (o = r(
          a != null ? i(c(a)) : {},
          "default",
          a && a.__esModule && "default" in a ? { get: () => a.default, enumerable: true } : { value: a, enumerable: true }
        ), r(o, "__esModule", { value: true })),
        a
      ), e.$jszip = d.default, m = (e2) => crypto.getRandomValues(new Uint8Array(e2)), e.$nanoid = (e2 = 21) => {
        let t2 = "", n2 = crypto.getRandomValues(new Uint8Array(e2));
        for (; e2--; ) {
          let a2 = 63 & n2[e2];
          t2 += a2 < 36 ? a2.toString(36) : a2 < 62 ? (a2 - 26).toString(36).toUpperCase() : a2 < 63 ? "_" : "-";
        }
        return t2;
      }, e.$nanoid.customAlphabet = (e2, t2) => ((e3, t3, n2) => {
        let a2 = (2 << Math.log(e3.length - 1) / Math.LN2) - 1, o2 = -~(1.6 * a2 * t3 / e3.length);
        return () => {
          let i2 = "";
          for (; ; ) {
            let r2 = n2(o2), s2 = o2;
            for (; s2--; )
              if (i2 += e3[r2[s2] & a2] || "", i2.length === t3) return i2;
          }
        };
      })(e2, t2, m), (() => {
        function t2(e2) {
          return e2 == null;
        }
        var n2 = function(e2, t3) {
          var n3, a3, o3, i3;
          if (t3)
            for (n3 = 0, a3 = (i3 = Object.keys(t3)).length; n3 < a3; n3 += 1)
              e2[o3 = i3[n3]] = t3[o3];
          return e2;
        }, a2 = {
          isNothing: t2,
          isObject: function(e2) {
            return typeof e2 == "object" && e2 !== null;
          },
          toArray: function(e2) {
            return Array.isArray(e2) ? e2 : t2(e2) ? [] : [e2];
          },
          repeat: function(e2, t3) {
            var n3, a3 = "";
            for (n3 = 0; n3 < t3; n3 += 1) a3 += e2;
            return a3;
          },
          isNegativeZero: function(e2) {
            return e2 === 0 && Number.NEGATIVE_INFINITY === 1 / e2;
          },
          extend: n2
        };
        function o2(e2, t3) {
          var n3 = "", a3 = e2.reason || "(unknown reason)";
          return e2.mark ? (e2.mark.name && (n3 += 'in "' + e2.mark.name + '" '), n3 += "(" + (e2.mark.line + 1) + ":" + (e2.mark.column + 1) + ")", !t3 && e2.mark.snippet && (n3 += "\n\n" + e2.mark.snippet), a3 + " " + n3) : a3;
        }
        function i2(e2, t3) {
          Error.call(this), this.name = "YAMLException", this.reason = e2, this.mark = t3, this.message = o2(this, false), Error.captureStackTrace ? Error.captureStackTrace(this, this.constructor) : this.stack = new Error().stack || "";
        }
        i2.prototype = Object.create(Error.prototype), i2.prototype.constructor = i2, i2.prototype.toString = function(e2) {
          return this.name + ": " + o2(this, e2);
        };
        var r2 = i2;
        function s2(e2, t3, n3, a3, o3) {
          var i3 = "", r3 = "", s3 = Math.floor(o3 / 2) - 1;
          return a3 - t3 > s3 && (t3 = a3 - s3 + (i3 = " ... ").length), n3 - a3 > s3 && (n3 = a3 + s3 - (r3 = " ...").length), {
            str: i3 + e2.slice(t3, n3).replace(/\t/g, "\u2192") + r3,
            pos: a3 - t3 + i3.length
          };
        }
        function l2(e2, t3) {
          return a2.repeat(" ", t3 - e2.length) + e2;
        }
        var c2 = function(e2, t3) {
          if (t3 = Object.create(t3 || null), !e2.buffer) return null;
          t3.maxLength || (t3.maxLength = 79), typeof t3.indent != "number" && (t3.indent = 1), typeof t3.linesBefore != "number" && (t3.linesBefore = 3), typeof t3.linesAfter != "number" && (t3.linesAfter = 2);
          for (var n3, o3 = /\r?\n|\r|\0/g, i3 = [0], r3 = [], c3 = -1; n3 = o3.exec(e2.buffer); )
            r3.push(n3.index), i3.push(n3.index + n3[0].length), e2.position <= n3.index && c3 < 0 && (c3 = i3.length - 2);
          c3 < 0 && (c3 = i3.length - 1);
          var u3, p3, d3 = "", m3 = Math.min(e2.line + t3.linesAfter, r3.length).toString().length, h2 = t3.maxLength - (t3.indent + m3 + 3);
          for (u3 = 1; u3 <= t3.linesBefore && !(c3 - u3 < 0); u3++)
            p3 = s2(
              e2.buffer,
              i3[c3 - u3],
              r3[c3 - u3],
              e2.position - (i3[c3] - i3[c3 - u3]),
              h2
            ), d3 = a2.repeat(" ", t3.indent) + l2((e2.line - u3 + 1).toString(), m3) + " | " + p3.str + "\n" + d3;
          for (p3 = s2(e2.buffer, i3[c3], r3[c3], e2.position, h2), d3 += a2.repeat(" ", t3.indent) + l2((e2.line + 1).toString(), m3) + " | " + p3.str + "\n", d3 += a2.repeat("-", t3.indent + m3 + 3 + p3.pos) + "^\n", u3 = 1; u3 <= t3.linesAfter && !(c3 + u3 >= r3.length); u3++)
            p3 = s2(
              e2.buffer,
              i3[c3 + u3],
              r3[c3 + u3],
              e2.position - (i3[c3] - i3[c3 + u3]),
              h2
            ), d3 += a2.repeat(" ", t3.indent) + l2((e2.line + u3 + 1).toString(), m3) + " | " + p3.str + "\n";
          return d3.replace(/\n$/, "");
        }, u2 = [
          "kind",
          "multi",
          "resolve",
          "construct",
          "instanceOf",
          "predicate",
          "represent",
          "representName",
          "defaultStyle",
          "styleAliases"
        ], p2 = ["scalar", "sequence", "mapping"], d2 = function(e2, t3) {
          var n3, a3;
          if (t3 = t3 || {}, Object.keys(t3).forEach(function(t4) {
            if (-1 === u2.indexOf(t4))
              throw new r2(
                'Unknown option "' + t4 + '" is met in definition of "' + e2 + '" YAML type.'
              );
          }), this.options = t3, this.tag = e2, this.kind = t3.kind || null, this.resolve = t3.resolve || function() {
            return true;
          }, this.construct = t3.construct || function(e3) {
            return e3;
          }, this.instanceOf = t3.instanceOf || null, this.predicate = t3.predicate || null, this.represent = t3.represent || null, this.representName = t3.representName || null, this.defaultStyle = t3.defaultStyle || null, this.multi = t3.multi || false, this.styleAliases = (n3 = t3.styleAliases || null, a3 = {}, n3 !== null && Object.keys(n3).forEach(function(e3) {
            n3[e3].forEach(function(t4) {
              a3[String(t4)] = e3;
            });
          }), a3), -1 === p2.indexOf(this.kind))
            throw new r2(
              'Unknown kind "' + this.kind + '" is specified for "' + e2 + '" YAML type.'
            );
        };
        function m2(e2, t3) {
          var n3 = [];
          return e2[t3].forEach(function(e3) {
            var t4 = n3.length;
            n3.forEach(function(n4, a3) {
              n4.tag === e3.tag && n4.kind === e3.kind && n4.multi === e3.multi && (t4 = a3);
            }), n3[t4] = e3;
          }), n3;
        }
        function h(e2) {
          return this.extend(e2);
        }
        h.prototype.extend = function(e2) {
          var t3 = [], n3 = [];
          if (e2 instanceof d2) n3.push(e2);
          else if (Array.isArray(e2)) n3 = n3.concat(e2);
          else {
            if (!e2 || !Array.isArray(e2.implicit) && !Array.isArray(e2.explicit))
              throw new r2(
                "Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })"
              );
            e2.implicit && (t3 = t3.concat(e2.implicit)), e2.explicit && (n3 = n3.concat(e2.explicit));
          }
          t3.forEach(function(e3) {
            if (!(e3 instanceof d2))
              throw new r2(
                "Specified list of YAML types (or a single Type object) contains a non-Type object."
              );
            if (e3.loadKind && e3.loadKind !== "scalar")
              throw new r2(
                "There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported."
              );
            if (e3.multi)
              throw new r2(
                "There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit."
              );
          }), n3.forEach(function(e3) {
            if (!(e3 instanceof d2))
              throw new r2(
                "Specified list of YAML types (or a single Type object) contains a non-Type object."
              );
          });
          var a3 = Object.create(h.prototype);
          return a3.implicit = (this.implicit || []).concat(t3), a3.explicit = (this.explicit || []).concat(n3), a3.compiledImplicit = m2(a3, "implicit"), a3.compiledExplicit = m2(a3, "explicit"), a3.compiledTypeMap = function() {
            var e3, t4, n4 = {
              scalar: {},
              sequence: {},
              mapping: {},
              fallback: {},
              multi: { scalar: [], sequence: [], mapping: [], fallback: [] }
            };
            function a4(e4) {
              e4.multi ? (n4.multi[e4.kind].push(e4), n4.multi.fallback.push(e4)) : n4[e4.kind][e4.tag] = n4.fallback[e4.tag] = e4;
            }
            for (e3 = 0, t4 = arguments.length; e3 < t4; e3 += 1)
              arguments[e3].forEach(a4);
            return n4;
          }(a3.compiledImplicit, a3.compiledExplicit), a3;
        };
        var g = h, f = new d2("tag:yaml.org,2002:str", {
          kind: "scalar",
          construct: function(e2) {
            return e2 !== null ? e2 : "";
          }
        }), y = new d2("tag:yaml.org,2002:seq", {
          kind: "sequence",
          construct: function(e2) {
            return e2 !== null ? e2 : [];
          }
        }), b = new d2("tag:yaml.org,2002:map", {
          kind: "mapping",
          construct: function(e2) {
            return e2 !== null ? e2 : {};
          }
        }), w = new g({ explicit: [f, y, b] }), v = new d2("tag:yaml.org,2002:null", {
          kind: "scalar",
          resolve: function(e2) {
            if (e2 === null) return true;
            var t3 = e2.length;
            return t3 === 1 && e2 === "~" || t3 === 4 && (e2 === "null" || e2 === "Null" || e2 === "NULL");
          },
          construct: function() {
            return null;
          },
          predicate: function(e2) {
            return e2 === null;
          },
          represent: {
            canonical: function() {
              return "~";
            },
            lowercase: function() {
              return "null";
            },
            uppercase: function() {
              return "NULL";
            },
            camelcase: function() {
              return "Null";
            },
            empty: function() {
              return "";
            }
          },
          defaultStyle: "lowercase"
        }), k = new d2("tag:yaml.org,2002:bool", {
          kind: "scalar",
          resolve: function(e2) {
            if (e2 === null) return false;
            var t3 = e2.length;
            return t3 === 4 && (e2 === "true" || e2 === "True" || e2 === "TRUE") || t3 === 5 && (e2 === "false" || e2 === "False" || e2 === "FALSE");
          },
          construct: function(e2) {
            return e2 === "true" || e2 === "True" || e2 === "TRUE";
          },
          predicate: function(e2) {
            return Object.prototype.toString.call(e2) === "[object Boolean]";
          },
          represent: {
            lowercase: function(e2) {
              return e2 ? "true" : "false";
            },
            uppercase: function(e2) {
              return e2 ? "TRUE" : "FALSE";
            },
            camelcase: function(e2) {
              return e2 ? "True" : "False";
            }
          },
          defaultStyle: "lowercase"
        });
        function T(e2) {
          return e2 >= 48 && e2 <= 55;
        }
        function A(e2) {
          return e2 >= 48 && e2 <= 57;
        }
        var E = new d2("tag:yaml.org,2002:int", {
          kind: "scalar",
          resolve: function(e2) {
            if (e2 === null) return false;
            var t3, n3, a3 = e2.length, o3 = 0, i3 = false;
            if (!a3) return false;
            if ((t3 = e2[o3]) !== "-" && t3 !== "+" || (t3 = e2[++o3]), t3 === "0") {
              if (o3 + 1 === a3) return true;
              if ((t3 = e2[++o3]) === "b") {
                for (o3++; o3 < a3; o3++)
                  if ((t3 = e2[o3]) !== "_") {
                    if (t3 !== "0" && t3 !== "1") return false;
                    i3 = true;
                  }
                return i3 && t3 !== "_";
              }
              if (t3 === "x") {
                for (o3++; o3 < a3; o3++)
                  if ((t3 = e2[o3]) !== "_") {
                    if (!((n3 = e2.charCodeAt(o3)) >= 48 && n3 <= 57 || n3 >= 65 && n3 <= 70 || n3 >= 97 && n3 <= 102))
                      return false;
                    i3 = true;
                  }
                return i3 && t3 !== "_";
              }
              if (t3 === "o") {
                for (o3++; o3 < a3; o3++)
                  if ((t3 = e2[o3]) !== "_") {
                    if (!T(e2.charCodeAt(o3))) return false;
                    i3 = true;
                  }
                return i3 && t3 !== "_";
              }
            }
            if (t3 === "_") return false;
            for (; o3 < a3; o3++)
              if ((t3 = e2[o3]) !== "_") {
                if (!A(e2.charCodeAt(o3))) return false;
                i3 = true;
              }
            return !(!i3 || t3 === "_");
          },
          construct: function(e2) {
            var t3, n3 = e2, a3 = 1;
            if (-1 !== n3.indexOf("_") && (n3 = n3.replace(/_/g, "")), (t3 = n3[0]) !== "-" && t3 !== "+" || (t3 === "-" && (a3 = -1), t3 = (n3 = n3.slice(1))[0]), n3 === "0")
              return 0;
            if (t3 === "0") {
              if (n3[1] === "b") return a3 * parseInt(n3.slice(2), 2);
              if (n3[1] === "x") return a3 * parseInt(n3.slice(2), 16);
              if (n3[1] === "o") return a3 * parseInt(n3.slice(2), 8);
            }
            return a3 * parseInt(n3, 10);
          },
          predicate: function(e2) {
            return Object.prototype.toString.call(e2) === "[object Number]" && e2 % 1 == 0 && !a2.isNegativeZero(e2);
          },
          represent: {
            binary: function(e2) {
              return e2 >= 0 ? "0b" + e2.toString(2) : "-0b" + e2.toString(2).slice(1);
            },
            octal: function(e2) {
              return e2 >= 0 ? "0o" + e2.toString(8) : "-0o" + e2.toString(8).slice(1);
            },
            decimal: function(e2) {
              return e2.toString(10);
            },
            hexadecimal: function(e2) {
              return e2 >= 0 ? "0x" + e2.toString(16).toUpperCase() : "-0x" + e2.toString(16).toUpperCase().slice(1);
            }
          },
          defaultStyle: "decimal",
          styleAliases: {
            binary: [2, "bin"],
            octal: [8, "oct"],
            decimal: [10, "dec"],
            hexadecimal: [16, "hex"]
          }
        }), I = new RegExp(
          "^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$"
        ), S = /^[-+]?[0-9]+e/, x = new d2("tag:yaml.org,2002:float", {
          kind: "scalar",
          resolve: function(e2) {
            return e2 !== null && !(!I.test(e2) || e2[e2.length - 1] === "_");
          },
          construct: function(e2) {
            var t3, n3;
            return n3 = (t3 = e2.replace(/_/g, "").toLowerCase())[0] === "-" ? -1 : 1, "+-".indexOf(t3[0]) >= 0 && (t3 = t3.slice(1)), t3 === ".inf" ? n3 === 1 ? Number.POSITIVE_INFINITY : Number.NEGATIVE_INFINITY : t3 === ".nan" ? NaN : n3 * parseFloat(t3, 10);
          },
          predicate: function(e2) {
            return Object.prototype.toString.call(e2) === "[object Number]" && (e2 % 1 != 0 || a2.isNegativeZero(e2));
          },
          represent: function(e2, t3) {
            var n3;
            if (isNaN(e2))
              switch (t3) {
                case "lowercase":
                  return ".nan";
                case "uppercase":
                  return ".NAN";
                case "camelcase":
                  return ".NaN";
              }
            else if (Number.POSITIVE_INFINITY === e2)
              switch (t3) {
                case "lowercase":
                  return ".inf";
                case "uppercase":
                  return ".INF";
                case "camelcase":
                  return ".Inf";
              }
            else if (Number.NEGATIVE_INFINITY === e2)
              switch (t3) {
                case "lowercase":
                  return "-.inf";
                case "uppercase":
                  return "-.INF";
                case "camelcase":
                  return "-.Inf";
              }
            else if (a2.isNegativeZero(e2)) return "-0.0";
            return n3 = e2.toString(10), S.test(n3) ? n3.replace("e", ".e") : n3;
          },
          defaultStyle: "lowercase"
        }), C = w.extend({ implicit: [v, k, E, x] }), O = C, R = new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"), _ = new RegExp(
          "^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$"
        ), P = new d2("tag:yaml.org,2002:timestamp", {
          kind: "scalar",
          resolve: function(e2) {
            return e2 !== null && (R.exec(e2) !== null || _.exec(e2) !== null);
          },
          construct: function(e2) {
            var t3, n3, a3, o3, i3, r3, s3, l3, c3 = 0, u3 = null;
            if ((t3 = R.exec(e2)) === null && (t3 = _.exec(e2)), t3 === null)
              throw new Error("Date resolve error");
            if (n3 = +t3[1], a3 = +t3[2] - 1, o3 = +t3[3], !t3[4])
              return new Date(Date.UTC(n3, a3, o3));
            if (i3 = +t3[4], r3 = +t3[5], s3 = +t3[6], t3[7]) {
              for (c3 = t3[7].slice(0, 3); c3.length < 3; ) c3 += "0";
              c3 = +c3;
            }
            return t3[9] && (u3 = 6e4 * (60 * +t3[10] + +(t3[11] || 0)), t3[9] === "-" && (u3 = -u3)), l3 = new Date(Date.UTC(n3, a3, o3, i3, r3, s3, c3)), u3 && l3.setTime(l3.getTime() - u3), l3;
          },
          instanceOf: Date,
          represent: function(e2) {
            return e2.toISOString();
          }
        }), N = new d2("tag:yaml.org,2002:merge", {
          kind: "scalar",
          resolve: function(e2) {
            return e2 === "<<" || e2 === null;
          }
        }), D = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r", L = new d2("tag:yaml.org,2002:binary", {
          kind: "scalar",
          resolve: function(e2) {
            if (e2 === null) return false;
            var t3, n3, a3 = 0, o3 = e2.length, i3 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r";
            for (n3 = 0; n3 < o3; n3++)
              if (!((t3 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r".indexOf(
                e2.charAt(n3)
              )) > 64)) {
                if (t3 < 0) return false;
                a3 += 6;
              }
            return a3 % 8 == 0;
          },
          construct: function(e2) {
            var t3, n3, a3 = e2.replace(/[\r\n=]/g, ""), o3 = a3.length, i3 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r", r3 = 0, s3 = [];
            for (t3 = 0; t3 < o3; t3++)
              t3 % 4 == 0 && t3 && (s3.push(r3 >> 16 & 255), s3.push(r3 >> 8 & 255), s3.push(255 & r3)), r3 = r3 << 6 | "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r".indexOf(
                a3.charAt(t3)
              );
            return (n3 = o3 % 4 * 6) == 0 ? (s3.push(r3 >> 16 & 255), s3.push(r3 >> 8 & 255), s3.push(255 & r3)) : n3 === 18 ? (s3.push(r3 >> 10 & 255), s3.push(r3 >> 2 & 255)) : n3 == 12 && s3.push(r3 >> 4 & 255), new Uint8Array(s3);
          },
          predicate: function(e2) {
            return Object.prototype.toString.call(e2) === "[object Uint8Array]";
          },
          represent: function(e2) {
            var t3, n3, a3 = "", o3 = 0, i3 = e2.length, r3 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r";
            for (t3 = 0; t3 < i3; t3++)
              t3 % 3 == 0 && t3 && (a3 += "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r"[o3 >> 18 & 63], a3 += "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r"[o3 >> 12 & 63], a3 += "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r"[o3 >> 6 & 63], a3 += "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r"[63 & o3]), o3 = (o3 << 8) + e2[t3];
            return (n3 = i3 % 3) == 0 ? (a3 += "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r"[o3 >> 18 & 63], a3 += "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r"[o3 >> 12 & 63], a3 += "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r"[o3 >> 6 & 63], a3 += "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r"[63 & o3]) : n3 === 2 ? (a3 += "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r"[o3 >> 10 & 63], a3 += "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r"[o3 >> 4 & 63], a3 += "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r"[o3 << 2 & 63], a3 += "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r"[64]) : n3 == 1 && (a3 += "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r"[o3 >> 2 & 63], a3 += "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r"[o3 << 4 & 63], a3 += "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r"[64], a3 += "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r"[64]), a3;
          }
        }), M = Object.prototype.hasOwnProperty, $ = Object.prototype.toString, U = new d2("tag:yaml.org,2002:omap", {
          kind: "sequence",
          resolve: function(e2) {
            if (e2 === null) return true;
            var t3, n3, a3, o3, i3, r3 = [], s3 = e2;
            for (t3 = 0, n3 = s3.length; t3 < n3; t3 += 1) {
              if (a3 = s3[t3], i3 = false, $.call(a3) !== "[object Object]")
                return false;
              for (o3 in a3)
                if (M.call(a3, o3)) {
                  if (i3) return false;
                  i3 = true;
                }
              if (!i3) return false;
              if (-1 !== r3.indexOf(o3)) return false;
              r3.push(o3);
            }
            return true;
          },
          construct: function(e2) {
            return e2 !== null ? e2 : [];
          }
        }), F = Object.prototype.toString, j = new d2("tag:yaml.org,2002:pairs", {
          kind: "sequence",
          resolve: function(e2) {
            if (e2 === null) return true;
            var t3, n3, a3, o3, i3, r3 = e2;
            for (i3 = new Array(r3.length), t3 = 0, n3 = r3.length; t3 < n3; t3 += 1) {
              if (a3 = r3[t3], F.call(a3) !== "[object Object]") return false;
              if ((o3 = Object.keys(a3)).length !== 1) return false;
              i3[t3] = [o3[0], a3[o3[0]]];
            }
            return true;
          },
          construct: function(e2) {
            if (e2 === null) return [];
            var t3, n3, a3, o3, i3, r3 = e2;
            for (i3 = new Array(r3.length), t3 = 0, n3 = r3.length; t3 < n3; t3 += 1)
              a3 = r3[t3], o3 = Object.keys(a3), i3[t3] = [o3[0], a3[o3[0]]];
            return i3;
          }
        }), H = Object.prototype.hasOwnProperty, q = new d2("tag:yaml.org,2002:set", {
          kind: "mapping",
          resolve: function(e2) {
            if (e2 === null) return true;
            var t3, n3 = e2;
            for (t3 in n3) if (H.call(n3, t3) && n3[t3] !== null) return false;
            return true;
          },
          construct: function(e2) {
            return e2 !== null ? e2 : {};
          }
        }), W = O.extend({ implicit: [P, N], explicit: [L, U, j, q] }), G = Object.prototype.hasOwnProperty, B = /[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/, Y = /[\x85\u2028\u2029]/, K = /[,\[\]\{\}]/, z = /^(?:!|!!|![a-z\-]+!)$/i, V = /^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;
        function X(e2) {
          return Object.prototype.toString.call(e2);
        }
        function J(e2) {
          return e2 === 10 || e2 === 13;
        }
        function Q(e2) {
          return e2 === 9 || e2 === 32;
        }
        function Z(e2) {
          return e2 === 9 || e2 === 32 || e2 === 10 || e2 === 13;
        }
        function ee(e2) {
          return e2 === 44 || e2 === 91 || e2 === 93 || e2 === 123 || e2 === 125;
        }
        function te(e2) {
          var t3;
          return e2 >= 48 && e2 <= 57 ? e2 - 48 : (t3 = 32 | e2) >= 97 && t3 <= 102 ? t3 - 97 + 10 : -1;
        }
        function ne(e2) {
          return e2 === 48 ? "\0" : e2 === 97 ? "\x07" : e2 === 98 ? "\b" : e2 === 116 || e2 === 9 ? "	" : e2 === 110 ? "\n" : e2 === 118 ? "\v" : e2 === 102 ? "\f" : e2 === 114 ? "\r" : e2 === 101 ? "\x1B" : e2 === 32 ? " " : e2 === 34 ? '"' : e2 === 47 ? "/" : e2 === 92 ? "\\" : e2 === 78 ? "\x85" : e2 === 95 ? "\xA0" : e2 === 76 ? "\u2028" : e2 === 80 ? "\u2029" : "";
        }
        function ae(e2) {
          return e2 <= 65535 ? String.fromCharCode(e2) : String.fromCharCode(
            55296 + (e2 - 65536 >> 10),
            56320 + (e2 - 65536 & 1023)
          );
        }
        for (var oe = new Array(256), ie = new Array(256), re = 0; re < 256; re++)
          oe[re] = ne(re) ? 1 : 0, ie[re] = ne(re);
        function se(e2, t3) {
          this.input = e2, this.filename = t3.filename || null, this.schema = t3.schema || W, this.onWarning = t3.onWarning || null, this.legacy = t3.legacy || false, this.json = t3.json || false, this.listener = t3.listener || null, this.implicitTypes = this.schema.compiledImplicit, this.typeMap = this.schema.compiledTypeMap, this.length = e2.length, this.position = 0, this.line = 0, this.lineStart = 0, this.lineIndent = 0, this.firstTabInLine = -1, this.documents = [];
        }
        function le(e2, t3) {
          var n3 = {
            name: e2.filename,
            buffer: e2.input.slice(0, -1),
            position: e2.position,
            line: e2.line,
            column: e2.position - e2.lineStart
          };
          return n3.snippet = c2(n3), new r2(t3, n3);
        }
        function ce(e2, t3) {
          throw le(e2, t3);
        }
        function ue(e2, t3) {
          e2.onWarning && e2.onWarning.call(null, le(e2, t3));
        }
        var pe = {
          YAML: function(e2, t3, n3) {
            var a3, o3, i3;
            e2.version !== null && ce(e2, "duplication of %YAML directive"), n3.length !== 1 && ce(e2, "YAML directive accepts exactly one argument"), (a3 = /^([0-9]+)\.([0-9]+)$/.exec(n3[0])) === null && ce(e2, "ill-formed argument of the YAML directive"), o3 = parseInt(a3[1], 10), i3 = parseInt(a3[2], 10), o3 !== 1 && ce(e2, "unacceptable YAML version of the document"), e2.version = n3[0], e2.checkLineBreaks = i3 < 2, i3 !== 1 && i3 !== 2 && ue(e2, "unsupported YAML version of the document");
          },
          TAG: function(e2, t3, n3) {
            var a3, o3;
            n3.length !== 2 && ce(e2, "TAG directive accepts exactly two arguments"), a3 = n3[0], o3 = n3[1], z.test(a3) || ce(
              e2,
              "ill-formed tag handle (first argument) of the TAG directive"
            ), G.call(e2.tagMap, a3) && ce(
              e2,
              'there is a previously declared suffix for "' + a3 + '" tag handle'
            ), V.test(o3) || ce(
              e2,
              "ill-formed tag prefix (second argument) of the TAG directive"
            );
            try {
              o3 = decodeURIComponent(o3);
            } catch (t4) {
              ce(e2, "tag prefix is malformed: " + o3);
            }
            e2.tagMap[a3] = o3;
          }
        };
        function de(e2, t3, n3, a3) {
          var o3, i3, r3, s3;
          if (t3 < n3) {
            if (s3 = e2.input.slice(t3, n3), a3)
              for (o3 = 0, i3 = s3.length; o3 < i3; o3 += 1)
                (r3 = s3.charCodeAt(o3)) === 9 || r3 >= 32 && r3 <= 1114111 || ce(e2, "expected valid JSON character");
            else
              B.test(s3) && ce(e2, "the stream contains non-printable characters");
            e2.result += s3;
          }
        }
        function me(e2, t3, n3, o3) {
          var i3, r3, s3, l3;
          for (a2.isObject(n3) || ce(
            e2,
            "cannot merge mappings; the provided source object is unacceptable"
          ), s3 = 0, l3 = (i3 = Object.keys(n3)).length; s3 < l3; s3 += 1)
            r3 = i3[s3], G.call(t3, r3) || (t3[r3] = n3[r3], o3[r3] = true);
        }
        function he(e2, t3, n3, a3, o3, i3, r3, s3, l3) {
          var c3, u3;
          if (Array.isArray(o3))
            for (c3 = 0, u3 = (o3 = Array.prototype.slice.call(o3)).length; c3 < u3; c3 += 1)
              Array.isArray(o3[c3]) && ce(e2, "nested arrays are not supported inside keys"), typeof o3 == "object" && X(o3[c3]) === "[object Object]" && (o3[c3] = "[object Object]");
          if (typeof o3 == "object" && X(o3) === "[object Object]" && (o3 = "[object Object]"), o3 = String(o3), t3 === null && (t3 = {}), a3 === "tag:yaml.org,2002:merge") {
            if (Array.isArray(i3))
              for (c3 = 0, u3 = i3.length; c3 < u3; c3 += 1) me(e2, t3, i3[c3], n3);
            else me(e2, t3, i3, n3);
          } else
            e2.json || G.call(n3, o3) || !G.call(t3, o3) || (e2.line = r3 || e2.line, e2.lineStart = s3 || e2.lineStart, e2.position = l3 || e2.position, ce(e2, "duplicated mapping key")), o3 === "__proto__" ? Object.defineProperty(t3, o3, {
              configurable: true,
              enumerable: true,
              writable: true,
              value: i3
            }) : t3[o3] = i3, delete n3[o3];
          return t3;
        }
        function ge(e2) {
          var t3;
          (t3 = e2.input.charCodeAt(e2.position)) === 10 ? e2.position++ : t3 === 13 ? (e2.position++, e2.input.charCodeAt(e2.position) === 10 && e2.position++) : ce(e2, "a line break is expected"), e2.line += 1, e2.lineStart = e2.position, e2.firstTabInLine = -1;
        }
        function fe(e2, t3, n3) {
          for (var a3 = 0, o3 = e2.input.charCodeAt(e2.position); o3 !== 0; ) {
            for (; Q(o3); )
              o3 === 9 && -1 === e2.firstTabInLine && (e2.firstTabInLine = e2.position), o3 = e2.input.charCodeAt(++e2.position);
            if (t3 && o3 === 35)
              do {
                o3 = e2.input.charCodeAt(++e2.position);
              } while (o3 !== 10 && o3 !== 13 && o3 !== 0);
            if (!J(o3)) break;
            for (ge(e2), o3 = e2.input.charCodeAt(e2.position), a3++, e2.lineIndent = 0; o3 === 32; )
              e2.lineIndent++, o3 = e2.input.charCodeAt(++e2.position);
          }
          return -1 !== n3 && a3 !== 0 && e2.lineIndent < n3 && ue(e2, "deficient indentation"), a3;
        }
        function ye(e2) {
          var t3, n3 = e2.position;
          return !((t3 = e2.input.charCodeAt(n3)) !== 45 && t3 !== 46 || t3 !== e2.input.charCodeAt(n3 + 1) || t3 !== e2.input.charCodeAt(n3 + 2) || (n3 += 3, (t3 = e2.input.charCodeAt(n3)) !== 0 && !Z(t3)));
        }
        function be(e2, t3) {
          t3 === 1 ? e2.result += " " : t3 > 1 && (e2.result += a2.repeat("\n", t3 - 1));
        }
        function we(e2, t3) {
          var n3, a3, o3 = e2.tag, i3 = e2.anchor, r3 = [], s3 = false;
          if (-1 !== e2.firstTabInLine) return false;
          for (e2.anchor !== null && (e2.anchorMap[e2.anchor] = r3), a3 = e2.input.charCodeAt(e2.position); a3 !== 0 && (-1 !== e2.firstTabInLine && (e2.position = e2.firstTabInLine, ce(e2, "tab characters must not be used in indentation")), a3 === 45) && Z(e2.input.charCodeAt(e2.position + 1)); )
            if (s3 = true, e2.position++, fe(e2, true, -1) && e2.lineIndent <= t3)
              r3.push(null), a3 = e2.input.charCodeAt(e2.position);
            else if (n3 = e2.line, Te(e2, t3, 3, false, true), r3.push(e2.result), fe(e2, true, -1), a3 = e2.input.charCodeAt(e2.position), (e2.line === n3 || e2.lineIndent > t3) && a3 !== 0)
              ce(e2, "bad indentation of a sequence entry");
            else if (e2.lineIndent < t3) break;
          return !!s3 && (e2.tag = o3, e2.anchor = i3, e2.kind = "sequence", e2.result = r3, true);
        }
        function ve(e2) {
          var t3, n3, a3, o3, i3 = false, r3 = false;
          if ((o3 = e2.input.charCodeAt(e2.position)) !== 33) return false;
          if (e2.tag !== null && ce(e2, "duplication of a tag property"), (o3 = e2.input.charCodeAt(++e2.position)) === 60 ? (i3 = true, o3 = e2.input.charCodeAt(++e2.position)) : o3 === 33 ? (r3 = true, n3 = "!!", o3 = e2.input.charCodeAt(++e2.position)) : n3 = "!", t3 = e2.position, i3) {
            do {
              o3 = e2.input.charCodeAt(++e2.position);
            } while (o3 !== 0 && o3 !== 62);
            e2.position < e2.length ? (a3 = e2.input.slice(t3, e2.position), o3 = e2.input.charCodeAt(++e2.position)) : ce(e2, "unexpected end of the stream within a verbatim tag");
          } else {
            for (; o3 !== 0 && !Z(o3); )
              o3 === 33 && (r3 ? ce(e2, "tag suffix cannot contain exclamation marks") : (n3 = e2.input.slice(t3 - 1, e2.position + 1), z.test(n3) || ce(e2, "named tag handle cannot contain such characters"), r3 = true, t3 = e2.position + 1)), o3 = e2.input.charCodeAt(++e2.position);
            a3 = e2.input.slice(t3, e2.position), K.test(a3) && ce(e2, "tag suffix cannot contain flow indicator characters");
          }
          a3 && !V.test(a3) && ce(e2, "tag name cannot contain such characters: " + a3);
          try {
            a3 = decodeURIComponent(a3);
          } catch (t4) {
            ce(e2, "tag name is malformed: " + a3);
          }
          return i3 ? e2.tag = a3 : G.call(e2.tagMap, n3) ? e2.tag = e2.tagMap[n3] + a3 : n3 === "!" ? e2.tag = "!" + a3 : n3 === "!!" ? e2.tag = "tag:yaml.org,2002:" + a3 : ce(e2, 'undeclared tag handle "' + n3 + '"'), true;
        }
        function ke(e2) {
          var t3, n3;
          if ((n3 = e2.input.charCodeAt(e2.position)) !== 38) return false;
          for (e2.anchor !== null && ce(e2, "duplication of an anchor property"), n3 = e2.input.charCodeAt(++e2.position), t3 = e2.position; n3 !== 0 && !Z(n3) && !ee(n3); )
            n3 = e2.input.charCodeAt(++e2.position);
          return e2.position === t3 && ce(e2, "name of an anchor node must contain at least one character"), e2.anchor = e2.input.slice(t3, e2.position), true;
        }
        function Te(e2, t3, n3, o3, i3) {
          var r3, s3, l3, c3, u3, p3, d3, m3, h2, g2 = 1, f2 = false, y2 = false;
          if (e2.listener !== null && e2.listener("open", e2), e2.tag = null, e2.anchor = null, e2.kind = null, e2.result = null, r3 = s3 = l3 = n3 === 4 || n3 === 3, o3 && fe(e2, true, -1) && (f2 = true, e2.lineIndent > t3 ? g2 = 1 : e2.lineIndent === t3 ? g2 = 0 : e2.lineIndent < t3 && (g2 = -1)), g2 == 1)
            for (; ve(e2) || ke(e2); )
              fe(e2, true, -1) ? (f2 = true, l3 = r3, e2.lineIndent > t3 ? g2 = 1 : e2.lineIndent === t3 ? g2 = 0 : e2.lineIndent < t3 && (g2 = -1)) : l3 = false;
          if (l3 && (l3 = f2 || i3), g2 != 1 && n3 !== 4 || (m3 = n3 === 1 || n3 === 2 ? t3 : t3 + 1, h2 = e2.position - e2.lineStart, g2 === 1 ? l3 && (we(e2, h2) || function(e3, t4, n4) {
            var a3, o4, i4, r4, s4, l4, c4, u4 = e3.tag, p4 = e3.anchor, d4 = {}, m4 = /* @__PURE__ */ Object.create(null), h3 = null, g3 = null, f3 = null, y3 = false, b2 = false;
            if (-1 !== e3.firstTabInLine) return false;
            for (e3.anchor !== null && (e3.anchorMap[e3.anchor] = d4), c4 = e3.input.charCodeAt(e3.position); c4 !== 0; ) {
              if (y3 || -1 === e3.firstTabInLine || (e3.position = e3.firstTabInLine, ce(
                e3,
                "tab characters must not be used in indentation"
              )), a3 = e3.input.charCodeAt(e3.position + 1), i4 = e3.line, c4 !== 63 && c4 !== 58 || !Z(a3)) {
                if (r4 = e3.line, s4 = e3.lineStart, l4 = e3.position, !Te(e3, n4, 2, false, true))
                  break;
                if (e3.line === i4) {
                  for (c4 = e3.input.charCodeAt(e3.position); Q(c4); )
                    c4 = e3.input.charCodeAt(++e3.position);
                  if (c4 === 58)
                    Z(c4 = e3.input.charCodeAt(++e3.position)) || ce(
                      e3,
                      "a whitespace character is expected after the key-value separator within a block mapping"
                    ), y3 && (he(e3, d4, m4, h3, g3, null, r4, s4, l4), h3 = g3 = f3 = null), b2 = true, y3 = false, o4 = false, h3 = e3.tag, g3 = e3.result;
                  else {
                    if (!b2) return e3.tag = u4, e3.anchor = p4, true;
                    ce(
                      e3,
                      "can not read an implicit mapping pair; a colon is missed"
                    );
                  }
                } else {
                  if (!b2) return e3.tag = u4, e3.anchor = p4, true;
                  ce(
                    e3,
                    "can not read a block mapping entry; a multiline key may not be an implicit key"
                  );
                }
              } else
                c4 === 63 ? (y3 && (he(e3, d4, m4, h3, g3, null, r4, s4, l4), h3 = g3 = f3 = null), b2 = true, y3 = true, o4 = true) : y3 ? (y3 = false, o4 = true) : ce(
                  e3,
                  "incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"
                ), e3.position += 1, c4 = a3;
              if ((e3.line === i4 || e3.lineIndent > t4) && (y3 && (r4 = e3.line, s4 = e3.lineStart, l4 = e3.position), Te(e3, t4, 4, true, o4) && (y3 ? g3 = e3.result : f3 = e3.result), y3 || (he(e3, d4, m4, h3, g3, f3, r4, s4, l4), h3 = g3 = f3 = null), fe(e3, true, -1), c4 = e3.input.charCodeAt(e3.position)), (e3.line === i4 || e3.lineIndent > t4) && c4 !== 0)
                ce(e3, "bad indentation of a mapping entry");
              else if (e3.lineIndent < t4) break;
            }
            return y3 && he(e3, d4, m4, h3, g3, null, r4, s4, l4), b2 && (e3.tag = u4, e3.anchor = p4, e3.kind = "mapping", e3.result = d4), b2;
          }(e2, h2, m3)) || function(e3, t4) {
            var n4, a3, o4, i4, r4, s4, l4, c4, u4, p4, d4, m4, h3 = true, g3 = e3.tag, f3 = e3.anchor, y3 = /* @__PURE__ */ Object.create(null);
            if ((m4 = e3.input.charCodeAt(e3.position)) === 91)
              r4 = 93, c4 = false, i4 = [];
            else {
              if (m4 !== 123) return false;
              r4 = 125, c4 = true, i4 = {};
            }
            for (e3.anchor !== null && (e3.anchorMap[e3.anchor] = i4), m4 = e3.input.charCodeAt(++e3.position); m4 !== 0; ) {
              if (fe(e3, true, t4), (m4 = e3.input.charCodeAt(e3.position)) === r4)
                return e3.position++, e3.tag = g3, e3.anchor = f3, e3.kind = c4 ? "mapping" : "sequence", e3.result = i4, true;
              h3 ? m4 === 44 && ce(e3, "expected the node content, but found ','") : ce(e3, "missed comma between flow collection entries"), d4 = null, s4 = l4 = false, m4 === 63 && Z(e3.input.charCodeAt(e3.position + 1)) && (s4 = l4 = true, e3.position++, fe(e3, true, t4)), n4 = e3.line, a3 = e3.lineStart, o4 = e3.position, Te(e3, t4, 1, false, true), p4 = e3.tag, u4 = e3.result, fe(e3, true, t4), m4 = e3.input.charCodeAt(e3.position), !l4 && e3.line !== n4 || m4 !== 58 || (s4 = true, m4 = e3.input.charCodeAt(++e3.position), fe(e3, true, t4), Te(e3, t4, 1, false, true), d4 = e3.result), c4 ? he(e3, i4, y3, p4, u4, d4, n4, a3, o4) : s4 ? i4.push(he(e3, null, y3, p4, u4, d4, n4, a3, o4)) : i4.push(u4), fe(e3, true, t4), (m4 = e3.input.charCodeAt(e3.position)) === 44 ? (h3 = true, m4 = e3.input.charCodeAt(++e3.position)) : h3 = false;
            }
            ce(
              e3,
              "unexpected end of the stream within a flow collection"
            );
          }(e2, m3) ? y2 = true : (s3 && function(e3, t4) {
            var n4, o4, i4, r4, s4, l4 = 1, c4 = false, u4 = false, p4 = t4, d4 = 0, m4 = false;
            if ((r4 = e3.input.charCodeAt(e3.position)) === 124) o4 = false;
            else {
              if (r4 !== 62) return false;
              o4 = true;
            }
            for (e3.kind = "scalar", e3.result = ""; r4 !== 0; )
              if ((r4 = e3.input.charCodeAt(++e3.position)) === 43 || r4 === 45)
                l4 === 1 ? l4 = r4 === 43 ? 3 : 2 : ce(e3, "repeat of a chomping mode identifier");
              else {
                if (!((i4 = (s4 = r4) >= 48 && s4 <= 57 ? s4 - 48 : -1) >= 0))
                  break;
                i4 === 0 ? ce(
                  e3,
                  "bad explicit indentation width of a block scalar; it cannot be less than one"
                ) : u4 ? ce(
                  e3,
                  "repeat of an indentation width identifier"
                ) : (p4 = t4 + i4 - 1, u4 = true);
              }
            if (Q(r4)) {
              do {
                r4 = e3.input.charCodeAt(++e3.position);
              } while (Q(r4));
              if (r4 === 35)
                do {
                  r4 = e3.input.charCodeAt(++e3.position);
                } while (!J(r4) && r4 !== 0);
            }
            for (; r4 !== 0; ) {
              for (ge(e3), e3.lineIndent = 0, r4 = e3.input.charCodeAt(e3.position); (!u4 || e3.lineIndent < p4) && r4 === 32; )
                e3.lineIndent++, r4 = e3.input.charCodeAt(++e3.position);
              if (!u4 && e3.lineIndent > p4 && (p4 = e3.lineIndent), J(r4))
                d4++;
              else {
                if (e3.lineIndent < p4) {
                  l4 === 3 ? e3.result += a2.repeat("\n", c4 ? 1 + d4 : d4) : l4 == 1 && c4 && (e3.result += "\n");
                  break;
                }
                for (o4 ? Q(r4) ? (m4 = true, e3.result += a2.repeat("\n", c4 ? 1 + d4 : d4)) : m4 ? (m4 = false, e3.result += a2.repeat("\n", d4 + 1)) : d4 === 0 ? c4 && (e3.result += " ") : e3.result += a2.repeat("\n", d4) : e3.result += a2.repeat("\n", c4 ? 1 + d4 : d4), c4 = true, u4 = true, d4 = 0, n4 = e3.position; !J(r4) && r4 !== 0; )
                  r4 = e3.input.charCodeAt(++e3.position);
                de(e3, n4, e3.position, false);
              }
            }
            return true;
          }(e2, m3) || function(e3, t4) {
            var n4, a3, o4;
            if ((n4 = e3.input.charCodeAt(e3.position)) !== 39) return false;
            for (e3.kind = "scalar", e3.result = "", e3.position++, a3 = o4 = e3.position; (n4 = e3.input.charCodeAt(e3.position)) !== 0; )
              if (n4 === 39) {
                if (de(e3, a3, e3.position, true), (n4 = e3.input.charCodeAt(++e3.position)) !== 39)
                  return true;
                a3 = e3.position, e3.position++, o4 = e3.position;
              } else
                J(n4) ? (de(e3, a3, o4, true), be(e3, fe(e3, false, t4)), a3 = o4 = e3.position) : e3.position === e3.lineStart && ye(e3) ? ce(
                  e3,
                  "unexpected end of the document within a single quoted scalar"
                ) : (e3.position++, o4 = e3.position);
            ce(
              e3,
              "unexpected end of the stream within a single quoted scalar"
            );
          }(e2, m3) || function(e3, t4) {
            var n4, a3, o4, i4, r4, s4, l4;
            if ((s4 = e3.input.charCodeAt(e3.position)) !== 34) return false;
            for (e3.kind = "scalar", e3.result = "", e3.position++, n4 = a3 = e3.position; (s4 = e3.input.charCodeAt(e3.position)) !== 0; ) {
              if (s4 === 34)
                return de(e3, n4, e3.position, true), e3.position++, true;
              if (s4 === 92) {
                if (de(e3, n4, e3.position, true), J(s4 = e3.input.charCodeAt(++e3.position)))
                  fe(e3, false, t4);
                else if (s4 < 256 && oe[s4])
                  e3.result += ie[s4], e3.position++;
                else if ((r4 = (l4 = s4) === 120 ? 2 : l4 === 117 ? 4 : l4 === 85 ? 8 : 0) > 0) {
                  for (o4 = r4, i4 = 0; o4 > 0; o4--)
                    (r4 = te(s4 = e3.input.charCodeAt(++e3.position))) >= 0 ? i4 = (i4 << 4) + r4 : ce(e3, "expected hexadecimal character");
                  e3.result += ae(i4), e3.position++;
                } else ce(e3, "unknown escape sequence");
                n4 = a3 = e3.position;
              } else
                J(s4) ? (de(e3, n4, a3, true), be(e3, fe(e3, false, t4)), n4 = a3 = e3.position) : e3.position === e3.lineStart && ye(e3) ? ce(
                  e3,
                  "unexpected end of the document within a double quoted scalar"
                ) : (e3.position++, a3 = e3.position);
            }
            ce(
              e3,
              "unexpected end of the stream within a double quoted scalar"
            );
          }(e2, m3) ? y2 = true : function(e3) {
            var t4, n4, a3;
            if ((a3 = e3.input.charCodeAt(e3.position)) !== 42)
              return false;
            for (a3 = e3.input.charCodeAt(++e3.position), t4 = e3.position; a3 !== 0 && !Z(a3) && !ee(a3); )
              a3 = e3.input.charCodeAt(++e3.position);
            return e3.position === t4 && ce(
              e3,
              "name of an alias node must contain at least one character"
            ), n4 = e3.input.slice(t4, e3.position), G.call(e3.anchorMap, n4) || ce(e3, 'unidentified alias "' + n4 + '"'), e3.result = e3.anchorMap[n4], fe(e3, true, -1), true;
          }(e2) ? (y2 = true, e2.tag === null && e2.anchor === null || ce(e2, "alias node should not have any properties")) : function(e3, t4, n4) {
            var a3, o4, i4, r4, s4, l4, c4, u4, p4 = e3.kind, d4 = e3.result;
            if (Z(u4 = e3.input.charCodeAt(e3.position)) || ee(u4) || u4 === 35 || u4 === 38 || u4 === 42 || u4 === 33 || u4 === 124 || u4 === 62 || u4 === 39 || u4 === 34 || u4 === 37 || u4 === 64 || u4 === 96)
              return false;
            if ((u4 === 63 || u4 === 45) && (Z(a3 = e3.input.charCodeAt(e3.position + 1)) || n4 && ee(a3)))
              return false;
            for (e3.kind = "scalar", e3.result = "", o4 = i4 = e3.position, r4 = false; u4 !== 0; ) {
              if (u4 === 58) {
                if (Z(a3 = e3.input.charCodeAt(e3.position + 1)) || n4 && ee(a3))
                  break;
              } else if (u4 === 35) {
                if (Z(e3.input.charCodeAt(e3.position - 1))) break;
              } else {
                if (e3.position === e3.lineStart && ye(e3) || n4 && ee(u4))
                  break;
                if (J(u4)) {
                  if (s4 = e3.line, l4 = e3.lineStart, c4 = e3.lineIndent, fe(e3, false, -1), e3.lineIndent >= t4) {
                    r4 = true, u4 = e3.input.charCodeAt(e3.position);
                    continue;
                  }
                  e3.position = i4, e3.line = s4, e3.lineStart = l4, e3.lineIndent = c4;
                  break;
                }
              }
              r4 && (de(e3, o4, i4, false), be(e3, e3.line - s4), o4 = i4 = e3.position, r4 = false), Q(u4) || (i4 = e3.position + 1), u4 = e3.input.charCodeAt(++e3.position);
            }
            return de(e3, o4, i4, false), !!e3.result || (e3.kind = p4, e3.result = d4, false);
          }(e2, m3, n3 === 1) && (y2 = true, e2.tag === null && (e2.tag = "?")), e2.anchor !== null && (e2.anchorMap[e2.anchor] = e2.result)) : g2 == 0 && (y2 = l3 && we(e2, h2))), e2.tag === null)
            e2.anchor !== null && (e2.anchorMap[e2.anchor] = e2.result);
          else if (e2.tag === "?") {
            for (e2.result !== null && e2.kind !== "scalar" && ce(
              e2,
              'unacceptable node kind for !<?> tag; it should be "scalar", not "' + e2.kind + '"'
            ), c3 = 0, u3 = e2.implicitTypes.length; c3 < u3; c3 += 1)
              if ((d3 = e2.implicitTypes[c3]).resolve(e2.result)) {
                e2.result = d3.construct(e2.result), e2.tag = d3.tag, e2.anchor !== null && (e2.anchorMap[e2.anchor] = e2.result);
                break;
              }
          } else if (e2.tag !== "!") {
            if (G.call(e2.typeMap[e2.kind || "fallback"], e2.tag))
              d3 = e2.typeMap[e2.kind || "fallback"][e2.tag];
            else
              for (d3 = null, c3 = 0, u3 = (p3 = e2.typeMap.multi[e2.kind || "fallback"]).length; c3 < u3; c3 += 1)
                if (e2.tag.slice(0, p3[c3].tag.length) === p3[c3].tag) {
                  d3 = p3[c3];
                  break;
                }
            d3 || ce(e2, "unknown tag !<" + e2.tag + ">"), e2.result !== null && d3.kind !== e2.kind && ce(
              e2,
              "unacceptable node kind for !<" + e2.tag + '> tag; it should be "' + d3.kind + '", not "' + e2.kind + '"'
            ), d3.resolve(e2.result, e2.tag) ? (e2.result = d3.construct(e2.result, e2.tag), e2.anchor !== null && (e2.anchorMap[e2.anchor] = e2.result)) : ce(
              e2,
              "cannot resolve a node with !<" + e2.tag + "> explicit tag"
            );
          }
          return e2.listener !== null && e2.listener("close", e2), e2.tag !== null || e2.anchor !== null || y2;
        }
        function Ae(e2) {
          var t3, n3, a3, o3, i3 = e2.position, r3 = false;
          for (e2.version = null, e2.checkLineBreaks = e2.legacy, e2.tagMap = /* @__PURE__ */ Object.create(null), e2.anchorMap = /* @__PURE__ */ Object.create(null); (o3 = e2.input.charCodeAt(e2.position)) !== 0 && (fe(e2, true, -1), o3 = e2.input.charCodeAt(e2.position), !(e2.lineIndent > 0 || o3 !== 37)); ) {
            for (r3 = true, o3 = e2.input.charCodeAt(++e2.position), t3 = e2.position; o3 !== 0 && !Z(o3); )
              o3 = e2.input.charCodeAt(++e2.position);
            for (a3 = [], (n3 = e2.input.slice(t3, e2.position)).length < 1 && ce(
              e2,
              "directive name must not be less than one character in length"
            ); o3 !== 0; ) {
              for (; Q(o3); ) o3 = e2.input.charCodeAt(++e2.position);
              if (o3 === 35) {
                do {
                  o3 = e2.input.charCodeAt(++e2.position);
                } while (o3 !== 0 && !J(o3));
                break;
              }
              if (J(o3)) break;
              for (t3 = e2.position; o3 !== 0 && !Z(o3); )
                o3 = e2.input.charCodeAt(++e2.position);
              a3.push(e2.input.slice(t3, e2.position));
            }
            o3 !== 0 && ge(e2), G.call(pe, n3) ? pe[n3](e2, n3, a3) : ue(e2, 'unknown document directive "' + n3 + '"');
          }
          fe(e2, true, -1), e2.lineIndent === 0 && e2.input.charCodeAt(e2.position) === 45 && e2.input.charCodeAt(e2.position + 1) === 45 && e2.input.charCodeAt(e2.position + 2) === 45 ? (e2.position += 3, fe(e2, true, -1)) : r3 && ce(e2, "directives end mark is expected"), Te(e2, e2.lineIndent - 1, 4, false, true), fe(e2, true, -1), e2.checkLineBreaks && Y.test(e2.input.slice(i3, e2.position)) && ue(e2, "non-ASCII line breaks are interpreted as content"), e2.documents.push(e2.result), e2.position === e2.lineStart && ye(e2) ? e2.input.charCodeAt(e2.position) === 46 && (e2.position += 3, fe(e2, true, -1)) : e2.position < e2.length - 1 && ce(e2, "end of the stream or a document separator is expected");
        }
        function Ee(e2, t3) {
          t3 = t3 || {}, (e2 = String(e2)).length !== 0 && (e2.charCodeAt(e2.length - 1) !== 10 && e2.charCodeAt(e2.length - 1) !== 13 && (e2 += "\n"), e2.charCodeAt(0) === 65279 && (e2 = e2.slice(1)));
          var n3 = new se(e2, t3), a3 = e2.indexOf("\0");
          for (-1 !== a3 && (n3.position = a3, ce(n3, "null byte is not allowed in input")), n3.input += "\0"; n3.input.charCodeAt(n3.position) === 32; )
            n3.lineIndent += 1, n3.position += 1;
          for (; n3.position < n3.length - 1; ) Ae(n3);
          return n3.documents;
        }
        var Ie = {
          loadAll: function(e2, t3, n3) {
            t3 !== null && typeof t3 == "object" && void 0 === n3 && (n3 = t3, t3 = null);
            var a3 = Ee(e2, n3);
            if (typeof t3 != "function") return a3;
            for (var o3 = 0, i3 = a3.length; o3 < i3; o3 += 1) t3(a3[o3]);
          },
          load: function(e2, t3) {
            var n3 = Ee(e2, t3);
            if (n3.length !== 0) {
              if (n3.length === 1) return n3[0];
              throw new r2(
                "expected a single document in the stream, but found more"
              );
            }
          }
        }, Se = Object.prototype.toString, xe = Object.prototype.hasOwnProperty, Ce = 65279, Oe = {
          0: "\\0",
          7: "\\a",
          8: "\\b",
          9: "\\t",
          10: "\\n",
          11: "\\v",
          12: "\\f",
          13: "\\r",
          27: "\\e",
          34: '\\"',
          92: "\\\\",
          133: "\\N",
          160: "\\_",
          8232: "\\L",
          8233: "\\P"
        }, Re = [
          "y",
          "Y",
          "yes",
          "Yes",
          "YES",
          "on",
          "On",
          "ON",
          "n",
          "N",
          "no",
          "No",
          "NO",
          "off",
          "Off",
          "OFF"
        ], _e = /^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;
        function Pe(e2) {
          var t3, n3, o3;
          if (t3 = e2.toString(16).toUpperCase(), e2 <= 255)
            n3 = "x", o3 = 2;
          else if (e2 <= 65535) n3 = "u", o3 = 4;
          else {
            if (!(e2 <= 4294967295))
              throw new r2(
                "code point within a string may not be greater than 0xFFFFFFFF"
              );
            n3 = "U", o3 = 8;
          }
          return "\\" + n3 + a2.repeat("0", o3 - t3.length) + t3;
        }
        function Ne(e2) {
          this.schema = e2.schema || W, this.indent = Math.max(1, e2.indent || 2), this.noArrayIndent = e2.noArrayIndent || false, this.skipInvalid = e2.skipInvalid || false, this.flowLevel = a2.isNothing(e2.flowLevel) ? -1 : e2.flowLevel, this.styleMap = function(e3, t3) {
            var n3, a3, o3, i3, r3, s3, l3;
            if (t3 === null) return {};
            for (n3 = {}, o3 = 0, i3 = (a3 = Object.keys(t3)).length; o3 < i3; o3 += 1)
              r3 = a3[o3], s3 = String(t3[r3]), r3.slice(0, 2) === "!!" && (r3 = "tag:yaml.org,2002:" + r3.slice(2)), (l3 = e3.compiledTypeMap.fallback[r3]) && xe.call(l3.styleAliases, s3) && (s3 = l3.styleAliases[s3]), n3[r3] = s3;
            return n3;
          }(this.schema, e2.styles || null), this.sortKeys = e2.sortKeys || false, this.lineWidth = e2.lineWidth || 80, this.noRefs = e2.noRefs || false, this.noCompatMode = e2.noCompatMode || false, this.condenseFlow = e2.condenseFlow || false, this.quotingType = e2.quotingType === '"' ? 2 : 1, this.forceQuotes = e2.forceQuotes || false, this.replacer = typeof e2.replacer == "function" ? e2.replacer : null, this.implicitTypes = this.schema.compiledImplicit, this.explicitTypes = this.schema.compiledExplicit, this.tag = null, this.result = "", this.duplicates = [], this.usedDuplicates = null;
        }
        function De(e2, t3) {
          for (var n3, o3 = a2.repeat(" ", t3), i3 = 0, r3 = -1, s3 = "", l3 = e2.length; i3 < l3; )
            -1 === (r3 = e2.indexOf("\n", i3)) ? (n3 = e2.slice(i3), i3 = l3) : (n3 = e2.slice(i3, r3 + 1), i3 = r3 + 1), n3.length && n3 !== "\n" && (s3 += o3), s3 += n3;
          return s3;
        }
        function Le(e2, t3) {
          return "\n" + a2.repeat(" ", e2.indent * t3);
        }
        function Me(e2) {
          return e2 === 32 || e2 === 9;
        }
        function $e(e2) {
          return e2 >= 32 && e2 <= 126 || e2 >= 161 && e2 <= 55295 && e2 !== 8232 && e2 !== 8233 || e2 >= 57344 && e2 <= 65533 && e2 !== 65279 || e2 >= 65536 && e2 <= 1114111;
        }
        function Ue(e2) {
          return $e(e2) && e2 !== 65279 && e2 !== 13 && e2 !== 10;
        }
        function Fe(e2, t3, n3) {
          var a3 = Ue(e2), o3 = a3 && !Me(e2);
          return (n3 ? a3 : a3 && e2 !== 44 && e2 !== 91 && e2 !== 93 && e2 !== 123 && e2 !== 125) && e2 !== 35 && !(t3 === 58 && !o3) || Ue(t3) && !Me(t3) && e2 === 35 || t3 === 58 && o3;
        }
        function je(e2, t3) {
          var n3, a3 = e2.charCodeAt(t3);
          return a3 >= 55296 && a3 <= 56319 && t3 + 1 < e2.length && (n3 = e2.charCodeAt(t3 + 1)) >= 56320 && n3 <= 57343 ? 1024 * (a3 - 55296) + n3 - 56320 + 65536 : a3;
        }
        function He(e2) {
          return /^\n* /.test(e2);
        }
        function qe(e2, t3, n3, a3, o3, i3, r3, s3) {
          var l3, c3, u3 = 0, p3 = null, d3 = false, m3 = false, h2 = -1 !== a3, g2 = -1, f2 = $e(c3 = je(e2, 0)) && c3 !== 65279 && !Me(c3) && c3 !== 45 && c3 !== 63 && c3 !== 58 && c3 !== 44 && c3 !== 91 && c3 !== 93 && c3 !== 123 && c3 !== 125 && c3 !== 35 && c3 !== 38 && c3 !== 42 && c3 !== 33 && c3 !== 124 && c3 !== 61 && c3 !== 62 && c3 !== 39 && c3 !== 34 && c3 !== 37 && c3 !== 64 && c3 !== 96 && function(e3) {
            return !Me(e3) && e3 !== 58;
          }(je(e2, e2.length - 1));
          if (t3 || r3)
            for (l3 = 0; l3 < e2.length; u3 >= 65536 ? l3 += 2 : l3++) {
              if (!$e(u3 = je(e2, l3))) return 5;
              f2 = f2 && Fe(u3, p3, s3), p3 = u3;
            }
          else {
            for (l3 = 0; l3 < e2.length; u3 >= 65536 ? l3 += 2 : l3++) {
              if ((u3 = je(e2, l3)) === 10)
                d3 = true, h2 && (m3 = m3 || l3 - g2 - 1 > a3 && e2[g2 + 1] !== " ", g2 = l3);
              else if (!$e(u3)) return 5;
              f2 = f2 && Fe(u3, p3, s3), p3 = u3;
            }
            m3 = m3 || h2 && l3 - g2 - 1 > a3 && e2[g2 + 1] !== " ";
          }
          return d3 || m3 ? n3 > 9 && He(e2) ? 5 : r3 ? i3 === 2 ? 5 : 2 : m3 ? 4 : 3 : !f2 || r3 || o3(e2) ? i3 === 2 ? 5 : 2 : 1;
        }
        function We(e2, t3, n3, a3, o3) {
          e2.dump = function() {
            if (t3.length === 0) return e2.quotingType === 2 ? '""' : "''";
            if (!e2.noCompatMode && (-1 !== Re.indexOf(t3) || _e.test(t3)))
              return e2.quotingType === 2 ? '"' + t3 + '"' : "'" + t3 + "'";
            var i3 = e2.indent * Math.max(1, n3), s3 = -1 === e2.lineWidth ? -1 : Math.max(Math.min(e2.lineWidth, 40), e2.lineWidth - i3), l3 = a3 || e2.flowLevel > -1 && n3 >= e2.flowLevel;
            switch (qe(
              t3,
              l3,
              e2.indent,
              s3,
              function(t4) {
                return function(e3, t5) {
                  var n4, a4;
                  for (n4 = 0, a4 = e3.implicitTypes.length; n4 < a4; n4 += 1)
                    if (e3.implicitTypes[n4].resolve(t5)) return true;
                  return false;
                }(e2, t4);
              },
              e2.quotingType,
              e2.forceQuotes && !a3,
              o3
            )) {
              case 1:
                return t3;
              case 2:
                return "'" + t3.replace(/'/g, "''") + "'";
              case 3:
                return "|" + Ge(t3, e2.indent) + Be(De(t3, i3));
              case 4:
                return ">" + Ge(t3, e2.indent) + Be(
                  De(
                    function(e3, t4) {
                      for (var n4, a4, o4, i4 = /(\n+)([^\n]*)/g, r3 = (o4 = -1 !== (o4 = e3.indexOf("\n")) ? o4 : e3.length, i4.lastIndex = o4, Ye(e3.slice(0, o4), t4)), s4 = e3[0] === "\n" || e3[0] === " "; a4 = i4.exec(e3); ) {
                        var l4 = a4[1], c3 = a4[2];
                        n4 = c3[0] === " ", r3 += l4 + (s4 || n4 || c3 === "" ? "" : "\n") + Ye(c3, t4), s4 = n4;
                      }
                      return r3;
                    }(t3, s3),
                    i3
                  )
                );
              case 5:
                return '"' + function(e3) {
                  for (var t4, n4 = "", a4 = 0, o4 = 0; o4 < e3.length; a4 >= 65536 ? o4 += 2 : o4++)
                    a4 = je(e3, o4), !(t4 = Oe[a4]) && $e(a4) ? (n4 += e3[o4], a4 >= 65536 && (n4 += e3[o4 + 1])) : n4 += t4 || Pe(a4);
                  return n4;
                }(t3) + '"';
              default:
                throw new r2("impossible error: invalid scalar style");
            }
          }();
        }
        function Ge(e2, t3) {
          var n3 = He(e2) ? String(t3) : "", a3 = e2[e2.length - 1] === "\n";
          return n3 + (!a3 || e2[e2.length - 2] !== "\n" && e2 !== "\n" ? a3 ? "" : "-" : "+") + "\n";
        }
        function Be(e2) {
          return e2[e2.length - 1] === "\n" ? e2.slice(0, -1) : e2;
        }
        function Ye(e2, t3) {
          if (e2 === "" || e2[0] === " ") return e2;
          for (var n3, a3, o3 = / [^ ]/g, i3 = 0, r3 = 0, s3 = 0, l3 = ""; n3 = o3.exec(e2); )
            (s3 = n3.index) - i3 > t3 && (a3 = r3 > i3 ? r3 : s3, l3 += "\n" + e2.slice(i3, a3), i3 = a3 + 1), r3 = s3;
          return l3 += "\n", e2.length - i3 > t3 && r3 > i3 ? l3 += e2.slice(i3, r3) + "\n" + e2.slice(r3 + 1) : l3 += e2.slice(i3), l3.slice(1);
        }
        function Ke(e2, t3, n3, a3) {
          var o3, i3, r3, s3 = "", l3 = e2.tag;
          for (o3 = 0, i3 = n3.length; o3 < i3; o3 += 1)
            r3 = n3[o3], e2.replacer && (r3 = e2.replacer.call(n3, String(o3), r3)), (Ve(e2, t3 + 1, r3, true, true, false, true) || void 0 === r3 && Ve(e2, t3 + 1, null, true, true, false, true)) && (a3 && s3 === "" || (s3 += Le(e2, t3)), e2.dump && e2.dump.charCodeAt(0) === 10 ? s3 += "-" : s3 += "- ", s3 += e2.dump);
          e2.tag = l3, e2.dump = s3 || "[]";
        }
        function ze(e2, t3, n3) {
          var a3, o3, i3, s3, l3, c3;
          for (i3 = 0, s3 = (o3 = n3 ? e2.explicitTypes : e2.implicitTypes).length; i3 < s3; i3 += 1)
            if (((l3 = o3[i3]).instanceOf || l3.predicate) && (!l3.instanceOf || typeof t3 == "object" && t3 instanceof l3.instanceOf) && (!l3.predicate || l3.predicate(t3))) {
              if (n3 ? l3.multi && l3.representName ? e2.tag = l3.representName(t3) : e2.tag = l3.tag : e2.tag = "?", l3.represent) {
                if (c3 = e2.styleMap[l3.tag] || l3.defaultStyle, Se.call(l3.represent) === "[object Function]")
                  a3 = l3.represent(t3, c3);
                else {
                  if (!xe.call(l3.represent, c3))
                    throw new r2(
                      "!<" + l3.tag + '> tag resolver accepts not "' + c3 + '" style'
                    );
                  a3 = l3.represent[c3](t3, c3);
                }
                e2.dump = a3;
              }
              return true;
            }
          return false;
        }
        function Ve(e2, t3, n3, a3, o3, i3, s3) {
          e2.tag = null, e2.dump = n3, ze(e2, n3, false) || ze(e2, n3, true);
          var l3, c3 = Se.call(e2.dump), u3 = a3;
          a3 && (a3 = e2.flowLevel < 0 || e2.flowLevel > t3);
          var p3, d3, m3 = c3 === "[object Object]" || c3 === "[object Array]";
          if (m3 && (d3 = -1 !== (p3 = e2.duplicates.indexOf(n3))), (e2.tag !== null && e2.tag !== "?" || d3 || e2.indent !== 2 && t3 > 0) && (o3 = false), d3 && e2.usedDuplicates[p3])
            e2.dump = "*ref_" + p3;
          else {
            if (m3 && d3 && !e2.usedDuplicates[p3] && (e2.usedDuplicates[p3] = true), c3 === "[object Object]")
              a3 && Object.keys(e2.dump).length !== 0 ? (function(e3, t4, n4, a4) {
                var o4, i4, s4, l4, c4, u4, p4 = "", d4 = e3.tag, m4 = Object.keys(n4);
                if (true === e3.sortKeys) m4.sort();
                else if (typeof e3.sortKeys == "function") m4.sort(e3.sortKeys);
                else if (e3.sortKeys)
                  throw new r2("sortKeys must be a boolean or a function");
                for (o4 = 0, i4 = m4.length; o4 < i4; o4 += 1)
                  u4 = "", a4 && p4 === "" || (u4 += Le(e3, t4)), l4 = n4[s4 = m4[o4]], e3.replacer && (l4 = e3.replacer.call(n4, s4, l4)), Ve(e3, t4 + 1, s4, true, true, true) && ((c4 = e3.tag !== null && e3.tag !== "?" || e3.dump && e3.dump.length > 1024) && (e3.dump && e3.dump.charCodeAt(0) === 10 ? u4 += "?" : u4 += "? "), u4 += e3.dump, c4 && (u4 += Le(e3, t4)), Ve(e3, t4 + 1, l4, true, c4) && (e3.dump && e3.dump.charCodeAt(0) === 10 ? u4 += ":" : u4 += ": ", p4 += u4 += e3.dump));
                e3.tag = d4, e3.dump = p4 || "{}";
              }(e2, t3, e2.dump, o3), d3 && (e2.dump = "&ref_" + p3 + e2.dump)) : (function(e3, t4, n4) {
                var a4, o4, i4, r3, s4, l4 = "", c4 = e3.tag, u4 = Object.keys(n4);
                for (a4 = 0, o4 = u4.length; a4 < o4; a4 += 1)
                  s4 = "", l4 !== "" && (s4 += ", "), e3.condenseFlow && (s4 += '"'), r3 = n4[i4 = u4[a4]], e3.replacer && (r3 = e3.replacer.call(n4, i4, r3)), Ve(e3, t4, i4, false, false) && (e3.dump.length > 1024 && (s4 += "? "), s4 += e3.dump + (e3.condenseFlow ? '"' : "") + ":" + (e3.condenseFlow ? "" : " "), Ve(e3, t4, r3, false, false) && (l4 += s4 += e3.dump));
                e3.tag = c4, e3.dump = "{" + l4 + "}";
              }(e2, t3, e2.dump), d3 && (e2.dump = "&ref_" + p3 + " " + e2.dump));
            else if (c3 === "[object Array]")
              a3 && e2.dump.length !== 0 ? (e2.noArrayIndent && !s3 && t3 > 0 ? Ke(e2, t3 - 1, e2.dump, o3) : Ke(e2, t3, e2.dump, o3), d3 && (e2.dump = "&ref_" + p3 + e2.dump)) : (function(e3, t4, n4) {
                var a4, o4, i4, r3 = "", s4 = e3.tag;
                for (a4 = 0, o4 = n4.length; a4 < o4; a4 += 1)
                  i4 = n4[a4], e3.replacer && (i4 = e3.replacer.call(n4, String(a4), i4)), (Ve(e3, t4, i4, false, false) || void 0 === i4 && Ve(e3, t4, null, false, false)) && (r3 !== "" && (r3 += "," + (e3.condenseFlow ? "" : " ")), r3 += e3.dump);
                e3.tag = s4, e3.dump = "[" + r3 + "]";
              }(e2, t3, e2.dump), d3 && (e2.dump = "&ref_" + p3 + " " + e2.dump));
            else {
              if (c3 !== "[object String]") {
                if (c3 === "[object Undefined]") return false;
                if (e2.skipInvalid) return false;
                throw new r2("unacceptable kind of an object to dump " + c3);
              }
              e2.tag !== "?" && We(e2, e2.dump, t3, i3, u3);
            }
            e2.tag !== null && e2.tag !== "?" && (l3 = encodeURI(e2.tag[0] === "!" ? e2.tag.slice(1) : e2.tag).replace(
              /!/g,
              "%21"
            ), l3 = e2.tag[0] === "!" ? "!" + l3 : l3.slice(0, 18) === "tag:yaml.org,2002:" ? "!!" + l3.slice(18) : "!<" + l3 + ">", e2.dump = l3 + " " + e2.dump);
          }
          return true;
        }
        function Xe(e2, t3) {
          var n3, a3, o3 = [], i3 = [];
          for (Je(e2, o3, i3), n3 = 0, a3 = i3.length; n3 < a3; n3 += 1)
            t3.duplicates.push(o3[i3[n3]]);
          t3.usedDuplicates = new Array(a3);
        }
        function Je(e2, t3, n3) {
          var a3, o3, i3;
          if (e2 !== null && typeof e2 == "object")
            if (-1 !== (o3 = t3.indexOf(e2))) -1 === n3.indexOf(o3) && n3.push(o3);
            else if (t3.push(e2), Array.isArray(e2))
              for (o3 = 0, i3 = e2.length; o3 < i3; o3 += 1) Je(e2[o3], t3, n3);
            else
              for (o3 = 0, i3 = (a3 = Object.keys(e2)).length; o3 < i3; o3 += 1)
                Je(e2[a3[o3]], t3, n3);
        }
        function Qe(e2, t3) {
          return function() {
            throw new Error(
              "Function yaml." + e2 + " is removed in js-yaml 4. Use yaml." + t3 + " instead, which is now safe by default."
            );
          };
        }
        var Ze = {
          Type: d2,
          Schema: g,
          FAILSAFE_SCHEMA: w,
          JSON_SCHEMA: C,
          CORE_SCHEMA: O,
          DEFAULT_SCHEMA: W,
          load: Ie.load,
          loadAll: Ie.loadAll,
          dump: function(e2, t3) {
            var n3 = new Ne(t3 = t3 || {});
            n3.noRefs || Xe(e2, n3);
            var a3 = e2;
            return n3.replacer && (a3 = n3.replacer.call({ "": a3 }, "", a3)), Ve(n3, 0, a3, true, true) ? n3.dump + "\n" : "";
          },
          YAMLException: r2,
          types: {
            binary: L,
            float: x,
            map: b,
            null: v,
            pairs: j,
            set: q,
            timestamp: P,
            bool: k,
            int: E,
            merge: N,
            omap: U,
            seq: y,
            str: f
          },
          safeLoad: Qe("safeLoad", "load"),
          safeLoadAll: Qe("safeLoadAll", "loadAll"),
          safeDump: Qe("safeDump", "dump")
        };
        e.$jsyaml = Ze;
      })(), (() => {
        const { $utils: t2 } = e;
        t2.aggregation = {
          aggregate(e2, t3 = "daily") {
            if (!e2 || e2.length === 0 || t3 === "none") return e2;
            const n2 = this.aggregators[t3];
            if (!n2) throw new Error(`not supported aggregation period ${t3}`);
            const a2 = [];
            let o2 = null;
            e2.forEach((e3) => {
              const t4 = new Date(e3.ms);
              if (n2.toStartOfPeriod(t4), !o2) return a2.push(e3), void (o2 = t4);
              if (t4.getTime() !== o2.getTime()) {
                do {
                  n2.advance(o2), a2.push({ ms: o2.getTime() });
                } while (o2.getTime() < t4.getTime());
                a2[a2.length - 1] = e3, o2 = t4;
              } else a2[a2.length - 1] = e3;
            });
            const i2 = /* @__PURE__ */ new Date();
            for (n2.toStartOfPeriod(i2), n2.advance(o2); o2.getTime() <= i2.getTime(); )
              a2.push({ ms: o2.getTime() }), n2.advance(o2);
            return a2;
          },
          aggregators: {
            hourly: {
              toStartOfPeriod: (e2) => e2.setMinutes(0, 0, 0),
              advance: (e2) => e2.setHours(e2.getHours() + 1)
            },
            daily: {
              toStartOfPeriod: (e2) => e2.setHours(0, 0, 0, 0),
              advance: (e2) => e2.setDate(e2.getDate() + 1)
            },
            weekly: {
              toStartOfPeriod: (e2) => {
                e2.setHours(0, 0, 0, 0);
                const t3 = e2.getDay() || 7;
                return t3 !== 1 && e2.setHours(-24 * (t3 - 1)), e2;
              },
              advance: (e2) => e2.setDate(e2.getDate() + 7)
            },
            monthly: {
              toStartOfPeriod: (e2) => {
                e2.setHours(0, 0, 0, 0);
                const t3 = e2.getDate();
                return t3 !== 1 && e2.setHours(-24 * (t3 - 1)), e2;
              },
              advance: (e2) => e2.setMonth(e2.getMonth() + 1)
            }
          }
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.array = {
          remove(e2, t3) {
            const n2 = e2.indexOf(t3);
            -1 !== n2 && e2.splice(n2, 1);
          },
          toggle(e2, n2, a2 = true) {
            if (!t2.is.array(e2))
              throw new Error(
                "$utils.array.toggle expects an array as a parameter"
              );
            if (a2) {
              let t3 = e2.indexOf(n2);
              if (-1 === t3) return [...e2, n2];
              do {
                e2 = [...e2.slice(0, t3), ...e2.slice(t3 + 1)];
              } while (-1 !== (t3 = e2.indexOf(n2)));
              return e2;
            }
            {
              let t3 = e2.indexOf(n2);
              if (-1 === t3) return e2.push(n2), e2;
              do {
                e2.splice(t3, 1);
              } while (-1 !== (t3 = e2.indexOf(n2)));
              return e2;
            }
          }
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.bindMethods = (e2) => {
          if (!t2.is.object(e2))
            throw new Error("$utils.bindMethods accepts object as a parameter");
          Object.keys(e2).forEach((t3) => {
            typeof e2[t3] == "function" && (e2[t3] = e2[t3].bind(e2));
          });
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.blobToDataUrl = async (e2) => new Promise((t3, n2) => {
          const a2 = new FileReader();
          a2.onload = () => t3(a2.result), a2.onerror = n2, a2.readAsDataURL(e2);
        });
      })(), (() => {
        const { $utils: t2 } = e;
        t2.byteSizeOf = (e2) => {
          let n2 = /* @__PURE__ */ new Set(), a2 = [e2], o2 = 0;
          for (; a2.length; ) {
            let e3 = a2.pop();
            if (typeof e3 == "boolean") o2 += 4;
            else if (typeof e3 == "string") o2 += 2 * e3.length;
            else if (typeof e3 == "number") o2 += 8;
            else if (t2.is.blob(e3)) o2 += e3.size;
            else if (typeof e3 == "object" && !n2.has(e3)) {
              n2.add(e3);
              for (let t3 in e3)
                e3.hasOwnProperty(t3) && (o2 += 2 * t3.length, a2.push(e3[t3]));
            }
          }
          return o2;
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.callAsync = async (e2, ...t3) => new Promise((n2) => e2(...t3, n2));
      })(), (() => {
        const { $utils: t2 } = e;
        t2.canvasToBlob = async (e2, t3 = "image/webp", n2 = 0.9) => await new Promise((a2, o2) => {
          try {
            e2.toBlob(
              (t4) => {
                t4 ? a2(t4) : e2.width === 0 || e2.height === 0 ? o2("canvas.toBlob failed, canvas has no dimensions") : o2("canvas.toBlob failed");
              },
              t3,
              n2
            );
          } catch (e3) {
            o2(e3);
          }
        });
      })(), (() => {
        const { $utils: t2, $nanoid: n2 } = e;
        t2.chrome = {
          tabs: {
            remove: async function(e2) {
              if (!e2) return;
              await chrome.tabs.get(e2) && await chrome.tabs.remove(e2);
            }
          },
          alarms: {
            run: (e2, t3 = {}) => {
              const a2 = {
                name: t3.name || n2(),
                once: t3.once || false,
                immediately: t3.immediately || false,
                delayInMinutes: t3.delayInMinutes || 1,
                periodInMinutes: t3.once ? null : t3.periodInMinutes || 1,
                listener: (t4) => {
                  t4.name === a2.name && (a2.once && (chrome.alarms.onAlarm.removeListener(a2.listener), chrome.alarms.clear(a2.name)), e2());
                }
              };
              return chrome.alarms.onAlarm.addListener(a2.listener), chrome.alarms.create(a2.name, {
                delayInMinutes: a2.delayInMinutes,
                periodInMinutes: a2.periodInMinutes
              }), a2.immediately && e2(), a2;
            },
            off: (e2) => {
              e2 && (typeof e2 == "string" ? chrome.alarms.clear(e2) : (chrome.alarms.onAlarm.removeListener(e2.listener), chrome.alarms.clear(e2.name)));
            }
          }
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.chunkify = function(e2, t3) {
          if (e2 == null) return [];
          if (e2 === "") return [""];
          let a2 = e2.match(/.*?[.!?][\s\n\t]+|.*$/gs).filter((e3) => e3.length > 0);
          a2 = a2 ? a2.filter(Boolean) : [e2];
          for (let e3 = 0; e3 < a2.length; e3++) {
            if (t3(a2[e3])) continue;
            const o3 = n2(a2[e3], t3, "\n");
            o3.length > 1 && a2.splice(e3, 1, ...o3);
          }
          for (let e3 = 0; e3 < a2.length; e3++) {
            if (t3(a2[e3])) continue;
            const o3 = n2(a2[e3], t3, " ");
            o3.length > 1 && a2.splice(e3, 1, ...o3);
          }
          const o2 = [];
          for (let e3 = 0; e3 < a2.length - 1; e3++)
            t3(a2[e3] + a2[e3 + 1]) ? (o2.push(a2[e3] + a2[e3 + 1]), e3++) : o2.push(a2[e3]);
          return o2;
        };
        const n2 = function(e2, t3, n3 = " ") {
          const a2 = e2.split(n3);
          if (a2.length === 0) return [];
          let o2 = [], i2 = a2[0];
          for (let e3 = 1; e3 < a2.length; e3++) {
            const r2 = i2 + n3 + a2[e3];
            t3(r2) ? i2 = r2 : (o2.push(i2 + n3), i2 = a2[e3]);
          }
          return i2 && o2.push(i2), o2;
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.clamp = (e2, t3, n2) => Math.min(Math.max(e2, t3), n2);
      })(), (() => {
        const { $utils: t2 } = e;
        t2.clearFromTags = (e2) => e2 ? (t2.is.string(e2) || (e2 = String(e2)), e2.replaceAll(/<\w+>/g, "").replaceAll(/<\/\w+>/g, "").replaceAll(/<\w+\/>/g, "")) : e2;
      })(), (() => {
        const { $utils: t2 } = e;
        t2.clipboard = {
          async writeText(e2) {
            try {
              await navigator.clipboard.writeText(e2);
            } catch (t3) {
              const n2 = document.activeElement, a2 = document.createElement("input");
              a2.style.position = "fixed", a2.style.opacity = 0, a2.value = e2, document.body.append(a2), a2.select(), document.execCommand("copy"), a2.remove(), n2.focus();
            }
          }
        };
      })(), (() => {
        const { $utils: t2 } = e;
        function n2(e2, t3, a2, o2) {
          if (o2 && (e2 = o2(e2)), !e2) return e2;
          if (typeof e2 != "object") return e2;
          let i2, r2 = Array.isArray(e2) ? [] : {};
          for (const s2 in e2)
            e2.hasOwnProperty && !e2.hasOwnProperty(s2) || (i2 = e2[s2], t3.has(i2) ? a2.push({ clone: r2, key: s2, value: i2 }) : (t3.set(i2, true), r2[s2] = n2(i2, t3, a2, o2), t3.set(i2, r2[s2])));
          return r2;
        }
        t2.cloneDeep = (e2, t3 = null, a2 = false) => {
          if (!t3 && globalThis.structuredClone && !a2 && !Array.isArray(e2))
            return structuredClone(e2);
          const o2 = /* @__PURE__ */ new Map(), i2 = [], r2 = n2(e2, o2, i2, t3);
          return i2.forEach(({ clone: e3, key: t4, value: n3 }) => {
            e3[t4] = o2.get(n3);
          }), r2;
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.computePricing = ({ plan: e2, tier: t3, annual: n2, spacePlanId: a2 }) => {
          if (e2.id === "free") return e2.pricing;
          if (e2.id === "x") return e2.pricing.lifetime;
          if (e2.id === "cloudgpt") {
            const n3 = (100 - (a2 === "x" ? 40 : t3.discount)) / 100, o2 = e2.pricing.unit.price * t3.units * n3;
            return { ...e2.pricing.unit, price: Number(o2.toFixed(1)) };
          }
          return n2 ? e2.pricing.annually : e2.pricing.monthly;
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.cookies = {
          noExpirationDate: () => Math.round((Date.now() + t2.time.MILLENNIUM) / 1e3)
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.copyright = {
          formatCopyright: (e2, t3, n2) => ["\xA9", e2, t3, n2].filter((e3) => Boolean(e3)).join(" ")
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.countVisionTokens = (e2, n2 = []) => {
          if (n2 = t2.ensureArray(n2), e2 === "openai")
            return n2.reduce((e3, { width: t3, height: n3, detail: a2 }) => {
              if (a2 === "low") return e3 + 85;
              if (a2 === "high") {
                return e3 + 85 + Math.ceil(t3 / 512) * Math.ceil(n3 / 512) * 170;
              }
              throw new Error(`unsupported detail: "${a2}"`);
            }, 0);
          if (e2 === "anthropic")
            return n2.reduce((e3, { width: t3, height: n3 }) => e3 + t3 * n3 / 750, 0);
          if (e2 === "google") return 1 + 258 * n2.length;
          throw new Error(`unsupported strategy: "${e2}"`);
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.createCsv = (e2, t3) => [t3.map((e3) => e3[0]), ...e2.map((e3) => t3.map((t4) => n2(t4[1](e3))))].map((e3) => e3.join(",")).join("\n");
        const n2 = (e2) => ((e2 = String(e2).replace(/\n/g, " ").replace(/"/g, '""')).includes(",") && (e2 = `"${e2}"`), e2);
      })(), (() => {
        const { $utils: t2 } = e;
        t2.createError = (e2, n2 = {}) => class extends Error {
          constructor(a2, o2 = null) {
            super(n2[a2 = a2 in n2 ? a2 : "unknown"] || "Unknown error"), this.name = e2, this.is = { [a2]: true }, this.type = a2, this.details = t2.is.error(o2) ? o2.message : o2;
          }
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.createPromise = () => {
          let e2 = null, t3 = null;
          const n2 = new Promise((n3, a2) => {
            e2 = n3, t3 = a2;
          });
          return Object.defineProperty(n2, "resolve", { get: () => e2 }), Object.defineProperty(n2, "reject", { get: () => t3 }), n2;
        };
      })(), (() => {
        const { $utils: t2 } = e, n2 = [
          {
            name: "US Dollar",
            symbol: "$",
            symbolNative: "$",
            code: "USD",
            namePlural: "US dollars",
            alt: ["US$", "US $"]
          },
          {
            name: "Canadian Dollar",
            symbol: "CA$",
            symbolNative: "$",
            code: "CAD",
            namePlural: "Canadian dollars",
            alt: ["CA $", "CAN$", "CAN $", "C$"]
          },
          {
            name: "Euro",
            symbol: "\u20AC",
            symbolNative: "\u20AC",
            code: "EUR",
            namePlural: "euros"
          },
          {
            name: "United Arab Emirates Dirham",
            symbol: "AED",
            symbolNative: "\u062F.\u0625.\u200F",
            code: "AED",
            namePlural: "UAE dirhams"
          },
          {
            name: "Afghan Afghani",
            symbol: "Af",
            symbolNative: "\u060B",
            code: "AFN",
            namePlural: "Afghan Afghanis"
          },
          {
            name: "Albanian Lek",
            symbol: "ALL",
            symbolNative: "Lek",
            code: "ALL",
            namePlural: "Albanian lek\xEB"
          },
          {
            name: "Armenian Dram",
            symbol: "AMD",
            symbolNative: "\u0564\u0580.",
            code: "AMD",
            namePlural: "Armenian drams"
          },
          {
            name: "Argentine Peso",
            symbol: "AR$",
            symbolNative: "$",
            code: "ARS",
            namePlural: "Argentine pesos",
            alt: ["AR $"]
          },
          {
            name: "Australian Dollar",
            symbol: "AU$",
            symbolNative: "$",
            code: "AUD",
            namePlural: "Australian dollars",
            alt: ["AU $"]
          },
          {
            name: "Azerbaijani Manat",
            symbol: "\u20BC",
            symbolNative: "\u043C\u0430\u043D.",
            code: "AZN",
            namePlural: "Azerbaijani manats"
          },
          {
            name: "Bosnia-Herzegovina Convertible Mark",
            symbol: "KM",
            symbolNative: "KM",
            code: "BAM",
            namePlural: "Bosnia-Herzegovina convertible marks"
          },
          {
            name: "Bangladeshi Taka",
            symbol: "Tk",
            symbolNative: "\u09F3",
            code: "BDT",
            namePlural: "Bangladeshi takas"
          },
          {
            name: "Bulgarian Lev",
            symbol: "BGN",
            symbolNative: "\u043B\u0432.",
            code: "BGN",
            namePlural: "Bulgarian leva"
          },
          {
            name: "Bahraini Dinar",
            symbol: "BD",
            symbolNative: "\u062F.\u0628.\u200F",
            code: "BHD",
            namePlural: "Bahraini dinars"
          },
          {
            name: "Burundian Franc",
            symbol: "FBu",
            symbolNative: "FBu",
            code: "BIF",
            namePlural: "Burundian francs"
          },
          {
            name: "Brunei Dollar",
            symbol: "BN$",
            symbolNative: "$",
            code: "BND",
            namePlural: "Brunei dollars",
            alt: ["BN $"]
          },
          {
            name: "Bolivian Boliviano",
            symbol: "Bs",
            symbolNative: "Bs",
            code: "BOB",
            namePlural: "Bolivian bolivianos"
          },
          {
            name: "Brazilian Real",
            symbol: "R$",
            symbolNative: "R$",
            code: "BRL",
            namePlural: "Brazilian reals"
          },
          {
            name: "Botswanan Pula",
            symbol: "BWP",
            symbolNative: "P",
            code: "BWP",
            namePlural: "Botswanan pulas"
          },
          {
            name: "Belarusian Ruble",
            symbol: "Br",
            symbolNative: "\u0440\u0443\u0431.",
            code: "BYN",
            namePlural: "Belarusian rubles"
          },
          {
            name: "Belize Dollar",
            symbol: "BZ$",
            symbolNative: "$",
            code: "BZD",
            namePlural: "Belize dollars",
            alt: ["BZ $"]
          },
          {
            name: "Congolese Franc",
            symbol: "CDF",
            symbolNative: "FrCD",
            code: "CDF",
            namePlural: "Congolese francs"
          },
          {
            name: "Swiss Franc",
            symbol: "CHF",
            symbolNative: "CHF",
            code: "CHF",
            namePlural: "Swiss francs"
          },
          {
            name: "Chilean Peso",
            symbol: "CL$",
            symbolNative: "$",
            code: "CLP",
            namePlural: "Chilean pesos",
            alt: ["CL $"]
          },
          {
            name: "Chinese Yuan",
            symbol: "CN\xA5",
            symbolNative: "CN\xA5",
            code: "CNY",
            namePlural: "Chinese yuan"
          },
          {
            name: "Colombian Peso",
            symbol: "CO$",
            symbolNative: "$",
            code: "COP",
            namePlural: "Colombian pesos",
            alt: ["CO $"]
          },
          {
            name: "Costa Rican Col\xF3n",
            symbol: "\u20A1",
            symbolNative: "\u20A1",
            code: "CRC",
            namePlural: "Costa Rican col\xF3ns"
          },
          {
            name: "Cape Verdean Escudo",
            symbol: "CV$",
            symbolNative: "CV$",
            code: "CVE",
            namePlural: "Cape Verdean escudos",
            alt: ["CV $"]
          },
          {
            name: "Czech Republic Koruna",
            symbol: "K\u010D",
            symbolNative: "K\u010D",
            code: "CZK",
            namePlural: "Czech Republic korunas"
          },
          {
            name: "Djiboutian Franc",
            symbol: "Fdj",
            symbolNative: "Fdj",
            code: "DJF",
            namePlural: "Djiboutian francs"
          },
          {
            name: "Danish Krone",
            symbol: "Dkr",
            symbolNative: "kr",
            code: "DKK",
            namePlural: "Danish kroner"
          },
          {
            name: "Dominican Peso",
            symbol: "RD$",
            symbolNative: "RD$",
            code: "DOP",
            namePlural: "Dominican pesos",
            alt: ["RD $"]
          },
          {
            name: "Algerian Dinar",
            symbol: "DA",
            symbolNative: "\u062F.\u062C.\u200F",
            code: "DZD",
            namePlural: "Algerian dinars"
          },
          {
            name: "Estonian Kroon",
            symbol: "Ekr",
            symbolNative: "kr",
            code: "EEK",
            namePlural: "Estonian kroons"
          },
          {
            name: "Egyptian Pound",
            symbol: "EGP",
            symbolNative: "\u062C.\u0645.\u200F",
            code: "EGP",
            namePlural: "Egyptian pounds"
          },
          {
            name: "Eritrean Nakfa",
            symbol: "Nfk",
            symbolNative: "Nfk",
            code: "ERN",
            namePlural: "Eritrean nakfas"
          },
          {
            name: "Ethiopian Birr",
            symbol: "Br",
            symbolNative: "Br",
            code: "ETB",
            namePlural: "Ethiopian birrs"
          },
          {
            name: "British Pound Sterling",
            symbol: "\xA3",
            symbolNative: "\xA3",
            code: "GBP",
            namePlural: "British pounds sterling"
          },
          {
            name: "Georgian Lari",
            symbol: "GEL",
            symbolNative: "GEL",
            code: "GEL",
            namePlural: "Georgian laris"
          },
          {
            name: "Ghanaian Cedi",
            symbol: "GH\u20B5",
            symbolNative: "GH\u20B5",
            code: "GHS",
            namePlural: "Ghanaian cedis"
          },
          {
            name: "Guinean Franc",
            symbol: "FG",
            symbolNative: "FG",
            code: "GNF",
            namePlural: "Guinean francs"
          },
          {
            name: "Guatemalan Quetzal",
            symbol: "GTQ",
            symbolNative: "Q",
            code: "GTQ",
            namePlural: "Guatemalan quetzals"
          },
          {
            name: "Hong Kong Dollar",
            symbol: "HK$",
            symbolNative: "$",
            code: "HKD",
            namePlural: "Hong Kong dollars",
            alt: ["HK $"]
          },
          {
            name: "Honduran Lempira",
            symbol: "HNL",
            symbolNative: "L",
            code: "HNL",
            namePlural: "Honduran lempiras"
          },
          {
            name: "Croatian Kuna",
            symbol: "kn",
            symbolNative: "kn",
            code: "HRK",
            namePlural: "Croatian kunas"
          },
          {
            name: "Hungarian Forint",
            symbol: "Ft",
            symbolNative: "Ft",
            code: "HUF",
            namePlural: "Hungarian forints"
          },
          {
            name: "Indonesian Rupiah",
            symbol: "Rp",
            symbolNative: "Rp",
            code: "IDR",
            namePlural: "Indonesian rupiahs"
          },
          {
            name: "Israeli New Sheqel",
            symbol: "\u20AA",
            symbolNative: "\u20AA",
            code: "ILS",
            namePlural: "Israeli new sheqels"
          },
          {
            name: "Indian Rupee",
            symbol: "Rs",
            symbolNative: "\u099F\u0995\u09BE",
            code: "INR",
            namePlural: "Indian rupees"
          },
          {
            name: "Iraqi Dinar",
            symbol: "IQD",
            symbolNative: "\u062F.\u0639.\u200F",
            code: "IQD",
            namePlural: "Iraqi dinars"
          },
          {
            name: "Iranian Rial",
            symbol: "IRR",
            symbolNative: "\uFDFC",
            code: "IRR",
            namePlural: "Iranian rials"
          },
          {
            name: "Icelandic Kr\xF3na",
            symbol: "Ikr",
            symbolNative: "kr",
            code: "ISK",
            namePlural: "Icelandic kr\xF3nur"
          },
          {
            name: "Jamaican Dollar",
            symbol: "J$",
            symbolNative: "$",
            code: "JMD",
            namePlural: "Jamaican dollars"
          },
          {
            name: "Jordanian Dinar",
            symbol: "JD",
            symbolNative: "\u062F.\u0623.\u200F",
            code: "JOD",
            namePlural: "Jordanian dinars"
          },
          {
            name: "Japanese Yen",
            symbol: "\xA5",
            symbolNative: "\uFFE5",
            code: "JPY",
            namePlural: "Japanese yen"
          },
          {
            name: "Kenyan Shilling",
            symbol: "Ksh",
            symbolNative: "Ksh",
            code: "KES",
            namePlural: "Kenyan shillings"
          },
          {
            name: "Cambodian Riel",
            symbol: "KHR",
            symbolNative: "\u17DB",
            code: "KHR",
            namePlural: "Cambodian riels"
          },
          {
            name: "Comorian Franc",
            symbol: "CF",
            symbolNative: "FC",
            code: "KMF",
            namePlural: "Comorian francs"
          },
          {
            name: "South Korean Won",
            symbol: "\u20A9",
            symbolNative: "\u20A9",
            code: "KRW",
            namePlural: "South Korean won"
          },
          {
            name: "Kuwaiti Dinar",
            symbol: "KD",
            symbolNative: "\u062F.\u0643.\u200F",
            code: "KWD",
            namePlural: "Kuwaiti dinars"
          },
          {
            name: "Kazakhstani Tenge",
            symbol: "KZT",
            symbolNative: "\u0442\u04A3\u0433.",
            code: "KZT",
            namePlural: "Kazakhstani tenges"
          },
          {
            name: "Lebanese Pound",
            symbol: "LB\xA3",
            symbolNative: "\u0644.\u0644.\u200F",
            code: "LBP",
            namePlural: "Lebanese pounds"
          },
          {
            name: "Sri Lankan Rupee",
            symbol: "SLRs",
            symbolNative: "SL Re",
            code: "LKR",
            namePlural: "Sri Lankan rupees"
          },
          {
            name: "Lithuanian Litas",
            symbol: "Lt",
            symbolNative: "Lt",
            code: "LTL",
            namePlural: "Lithuanian litai"
          },
          {
            name: "Libyan Dinar",
            symbol: "LD",
            symbolNative: "\u062F.\u0644.\u200F",
            code: "LYD",
            namePlural: "Libyan dinars"
          },
          {
            name: "Moroccan Dirham",
            symbol: "MAD",
            symbolNative: "\u062F.\u0645.\u200F",
            code: "MAD",
            namePlural: "Moroccan dirhams"
          },
          {
            name: "Moldovan Leu",
            symbol: "MDL",
            symbolNative: "MDL",
            code: "MDL",
            namePlural: "Moldovan lei"
          },
          {
            name: "Malagasy Ariary",
            symbol: "MGA",
            symbolNative: "MGA",
            code: "MGA",
            namePlural: "Malagasy Ariaries"
          },
          {
            name: "Macedonian Denar",
            symbol: "MKD",
            symbolNative: "MKD",
            code: "MKD",
            namePlural: "Macedonian denari"
          },
          {
            name: "Myanma Kyat",
            symbol: "MMK",
            symbolNative: "K",
            code: "MMK",
            namePlural: "Myanma kyats"
          },
          {
            name: "Macanese Pataca",
            symbol: "MOP$",
            symbolNative: "MOP$",
            code: "MOP",
            namePlural: "Macanese patacas",
            alt: ["MOP $"]
          },
          {
            name: "Mauritian Rupee",
            symbol: "MURs",
            symbolNative: "MURs",
            code: "MUR",
            namePlural: "Mauritian rupees"
          },
          {
            name: "Mexican Peso",
            symbol: "MX$",
            symbolNative: "$",
            code: "MXN",
            namePlural: "Mexican pesos",
            alt: ["MX $"]
          },
          {
            name: "Malaysian Ringgit",
            symbol: "RM",
            symbolNative: "RM",
            code: "MYR",
            namePlural: "Malaysian ringgits"
          },
          {
            name: "Mozambican Metical",
            symbol: "MTn",
            symbolNative: "MTn",
            code: "MZN",
            namePlural: "Mozambican meticals"
          },
          {
            name: "Namibian Dollar",
            symbol: "N$",
            symbolNative: "N$",
            code: "NAD",
            namePlural: "Namibian dollars"
          },
          {
            name: "Nigerian Naira",
            symbol: "\u20A6",
            symbolNative: "\u20A6",
            code: "NGN",
            namePlural: "Nigerian nairas"
          },
          {
            name: "Nicaraguan C\xF3rdoba",
            symbol: "C$",
            symbolNative: "C$",
            code: "NIO",
            namePlural: "Nicaraguan c\xF3rdobas"
          },
          {
            name: "Norwegian Krone",
            symbol: "Nkr",
            symbolNative: "kr",
            code: "NOK",
            namePlural: "Norwegian kroner"
          },
          {
            name: "Nepalese Rupee",
            symbol: "NPRs",
            symbolNative: "\u0928\u0947\u0930\u0942",
            code: "NPR",
            namePlural: "Nepalese rupees"
          },
          {
            name: "New Zealand Dollar",
            symbol: "NZ$",
            symbolNative: "$",
            code: "NZD",
            namePlural: "New Zealand dollars",
            alt: ["NZ $"]
          },
          {
            name: "Omani Rial",
            symbol: "OMR",
            symbolNative: "\u0631.\u0639.\u200F",
            code: "OMR",
            namePlural: "Omani rials"
          },
          {
            name: "Panamanian Balboa",
            symbol: "B/.",
            symbolNative: "B/.",
            code: "PAB",
            namePlural: "Panamanian balboas"
          },
          {
            name: "Peruvian Nuevo Sol",
            symbol: "S/.",
            symbolNative: "S/.",
            code: "PEN",
            namePlural: "Peruvian nuevos soles"
          },
          {
            name: "Philippine Peso",
            symbol: "\u20B1",
            symbolNative: "\u20B1",
            code: "PHP",
            namePlural: "Philippine pesos"
          },
          {
            name: "Pakistani Rupee",
            symbol: "PKRs",
            symbolNative: "\u20A8",
            code: "PKR",
            namePlural: "Pakistani rupees"
          },
          {
            name: "Polish Zloty",
            symbol: "z\u0142",
            symbolNative: "z\u0142",
            code: "PLN",
            namePlural: "Polish zlotys"
          },
          {
            name: "Paraguayan Guarani",
            symbol: "\u20B2",
            symbolNative: "\u20B2",
            code: "PYG",
            namePlural: "Paraguayan guaranis"
          },
          {
            name: "Qatari Rial",
            symbol: "QR",
            symbolNative: "\u0631.\u0642.\u200F",
            code: "QAR",
            namePlural: "Qatari rials"
          },
          {
            name: "Romanian Leu",
            symbol: "RON",
            symbolNative: "RON",
            code: "RON",
            namePlural: "Romanian lei"
          },
          {
            name: "Serbian Dinar",
            symbol: "din.",
            symbolNative: "\u0434\u0438\u043D.",
            code: "RSD",
            namePlural: "Serbian dinars"
          },
          {
            name: "Russian Ruble",
            symbol: "RUB",
            symbolNative: "\u20BD.",
            code: "RUB",
            namePlural: "Russian rubles"
          },
          {
            name: "Rwandan Franc",
            symbol: "RWF",
            symbolNative: "FR",
            code: "RWF",
            namePlural: "Rwandan francs"
          },
          {
            name: "Saudi Riyal",
            symbol: "SR",
            symbolNative: "\u0631.\u0633.\u200F",
            code: "SAR",
            namePlural: "Saudi riyals"
          },
          {
            name: "Sudanese Pound",
            symbol: "SDG",
            symbolNative: "SDG",
            code: "SDG",
            namePlural: "Sudanese pounds"
          },
          {
            name: "Swedish Krona",
            symbol: "Skr",
            symbolNative: "kr",
            code: "SEK",
            namePlural: "Swedish kronor"
          },
          {
            name: "Singapore Dollar",
            symbol: "S$",
            symbolNative: "$",
            code: "SGD",
            namePlural: "Singapore dollars"
          },
          {
            name: "Somali Shilling",
            symbol: "Ssh",
            symbolNative: "Ssh",
            code: "SOS",
            namePlural: "Somali shillings"
          },
          {
            name: "Syrian Pound",
            symbol: "SY\xA3",
            symbolNative: "\u0644.\u0633.\u200F",
            code: "SYP",
            namePlural: "Syrian pounds"
          },
          {
            name: "Thai Baht",
            symbol: "\u0E3F",
            symbolNative: "\u0E3F",
            code: "THB",
            namePlural: "Thai baht"
          },
          {
            name: "Tunisian Dinar",
            symbol: "DT",
            symbolNative: "\u062F.\u062A.\u200F",
            code: "TND",
            namePlural: "Tunisian dinars"
          },
          {
            name: "Tongan Pa\u02BBanga",
            symbol: "T$",
            symbolNative: "T$",
            code: "TOP",
            namePlural: "Tongan pa\u02BBanga",
            alt: ["T $"]
          },
          {
            name: "Turkish Lira",
            symbol: "\u20BA",
            symbolNative: "\u20BA",
            code: "TRY",
            namePlural: "Turkish Lira"
          },
          {
            name: "Trinidad and Tobago Dollar",
            symbol: "TT$",
            symbolNative: "$",
            code: "TTD",
            namePlural: "Trinidad and Tobago dollars",
            alt: ["TT $"]
          },
          {
            name: "New Taiwan Dollar",
            symbol: "NT$",
            symbolNative: "NT$",
            code: "TWD",
            namePlural: "New Taiwan dollars",
            alt: ["NT $"]
          },
          {
            name: "Tanzanian Shilling",
            symbol: "TSh",
            symbolNative: "TSh",
            code: "TZS",
            namePlural: "Tanzanian shillings"
          },
          {
            name: "Ukrainian Hryvnia",
            symbol: "\u20B4",
            symbolNative: "\u20B4",
            code: "UAH",
            namePlural: "Ukrainian hryvnias"
          },
          {
            name: "Ugandan Shilling",
            symbol: "USh",
            symbolNative: "USh",
            code: "UGX",
            namePlural: "Ugandan shillings"
          },
          {
            name: "Uruguayan Peso",
            symbol: "$U",
            symbolNative: "$",
            code: "UYU",
            namePlural: "Uruguayan pesos"
          },
          {
            name: "Uzbekistan Som",
            symbol: "UZS",
            symbolNative: "UZS",
            code: "UZS",
            namePlural: "Uzbekistan som"
          },
          {
            name: "Venezuelan Bol\xEDvar",
            symbol: "Bs.F.",
            symbolNative: "Bs.F.",
            code: "VEF",
            namePlural: "Venezuelan bol\xEDvars"
          },
          {
            name: "Vietnamese Dong",
            symbol: "\u20AB",
            symbolNative: "\u20AB",
            code: "VND",
            namePlural: "Vietnamese dong"
          },
          {
            name: "CFA Franc BEAC",
            symbol: "FCFA",
            symbolNative: "FCFA",
            code: "XAF",
            namePlural: "CFA francs BEAC"
          },
          {
            name: "CFA Franc BCEAO",
            symbol: "CFA",
            symbolNative: "CFA",
            code: "XOF",
            namePlural: "CFA francs BCEAO"
          },
          {
            name: "Yemeni Rial",
            symbol: "YR",
            symbolNative: "\u0631.\u064A.\u200F",
            code: "YER",
            namePlural: "Yemeni rials"
          },
          {
            name: "South African Rand",
            symbol: "R",
            symbolNative: "R",
            code: "ZAR",
            namePlural: "South African rand"
          },
          {
            name: "Zambian Kwacha",
            symbol: "ZK",
            symbolNative: "ZK",
            code: "ZMK",
            namePlural: "Zambian kwachas"
          },
          {
            name: "Zimbabwean Dollar",
            symbol: "ZWL$",
            symbolNative: "ZWL$",
            code: "ZWL",
            namePlural: "Zimbabwean Dollar",
            alt: ["ZWL $"]
          }
        ], a2 = {};
        n2.forEach((e2) => {
          const t3 = e2.symbolNative;
          t3.endsWith(".") && (e2.symbolNative = t3.slice(0, -1)), a2[e2.code] = e2;
        });
        t2.currency = {
          list: n2,
          byCode: a2,
          formatCurrency: (e2, n3 = "name") => {
            const a3 = e2.indexOf(":"), o2 = -1 === a3 ? e2 : e2.slice(a3 + 1);
            return t2.currency.byCode[o2]?.[n3] || e2;
          }
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.debounce = function(e2, t3 = 300, n2 = false) {
          let a2;
          return n2 ? (...n3) => {
            a2 || e2.apply(this, n3), clearTimeout(a2), a2 = setTimeout(() => {
              a2 = void 0;
            }, t3);
          } : (...n3) => {
            clearTimeout(a2), a2 = setTimeout(() => {
              e2.apply(this, n3);
            }, t3);
          };
        };
      })(), (() => {
        const { $utils: t2 } = e;
        function n2(e2) {
          return !e2 || e2 !== Object(e2);
        }
        t2.deepEqual = function(e2, a2) {
          if (e2 === a2) return true;
          if (n2(e2)) return !!n2(a2) && e2 === a2;
          if (n2(a2)) return false;
          if (Object.keys(e2).length !== Object.keys(a2).length) return false;
          for (const n3 in e2) {
            if (!(n3 in a2)) return false;
            if (!t2.deepEqual(e2[n3], a2[n3])) return false;
          }
          return true;
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.delete = (e2, t3) => {
          const n2 = (t3 || "").split(".");
          let a2 = e2;
          for (let e3 = 0; e3 < n2.length - 1; e3++) {
            let t4 = n2[e3];
            if (void 0 === a2) return false;
            if (a2 === null) return false;
            if (Array.isArray(a2) && (t4 = Number(t4), Number.isNaN(t4) || t4 < 0 || t4 >= a2.length))
              return false;
            a2 = a2[t4];
          }
          if (void 0 === a2) return false;
          if (a2 === null) return false;
          let o2 = n2.at(-1);
          if (Array.isArray(a2)) {
            if (o2 = Number(o2), Number.isNaN(o2) || o2 < 0 || o2 >= a2.length)
              return false;
            a2.splice(o2, 1);
          } else {
            if (!(o2 in a2)) return false;
            delete a2[o2];
          }
          return true;
        };
      })(), (() => {
        const { $utils: t2 } = e, n2 = { html: /[:=[\](){};,<>/"\s]+/g, text: /\s+/g }, a2 = (e2, t3) => {
          const n3 = /* @__PURE__ */ new Map();
          return e2.split(t3).filter((e3) => e3.length > 0).forEach((e3) => {
            const t4 = n3.get(e3);
            n3.set(e3, (t4 || 0) + 1);
          }), n3;
        };
        t2.diff = (e2, t3, o2) => {
          if (e2 === t3) return 0;
          e2 = e2 || "", t3 = t3 || "";
          const i2 = n2[o2];
          if (!i2) {
            const e3 = Object.keys(n2).join(", ");
            throw new Error(`$utils.diff type argument must be one of: ${e3}`);
          }
          e2 = a2(e2, i2), t3 = a2(t3, i2);
          let r2 = 0, s2 = 0;
          return e2.forEach((e3, n3) => {
            const a3 = t3.get(n3) || 0;
            s2 += n3.length * Math.abs(e3 - a3), r2 += n3.length * Math.max(e3, a3), t3.set(n3, 0);
          }), t3.forEach((e3, t4) => {
            e3 !== 0 && (s2 += t4.length * e3, r2 += t4.length * e3);
          }), r2 != 0 ? s2 / r2 : 0;
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.durationOf = async function(e2, t3) {
          t3 = { catch: true, ...t3 };
          const n2 = Date.now(), a2 = {};
          if (t3.catch)
            try {
              a2.result = await e2(), a2.hasResult = true;
            } catch (e3) {
              a2.error = e3, a2.hasError = true;
            }
          else a2.result = await e2();
          return a2.ms = Date.now() - n2, a2.s = Number(((Date.now() - n2) / 1e3).toFixed(1)), a2;
        };
      })(), (() => {
        const { $utils: t2 } = e;
        function n2(e2, t3, n3) {
          if (n3 = { minLength: 2, ...n3 }, t3.length <= n3.minLength) return "";
          if (e2.includes(t3)) return "";
          for (let n4 = 1; n4 < t3.length; n4++) {
            const a3 = t3.substring(0, n4), o2 = t3.substring(n4), i2 = new RegExp(`${a3}.${o2.substring(1)}`);
            if (i2.test(e2)) return e2.replace(i2, t3);
            const r2 = new RegExp(`${a3}.${o2}`);
            if (r2.test(e2)) return e2.replace(r2, t3);
            if (o2 !== "mail") {
              const n5 = new RegExp(`${a3}{0}${o2}`);
              if (n5.test(e2)) return e2.replace(n5, t3);
            }
            const s2 = [
              t3.substring(0, n4 - 1),
              t3.charAt(n4),
              t3.charAt(n4 - 1),
              t3.substring(n4 + 1)
            ].join("");
            if (e2.includes(s2)) return e2.replace(s2, t3);
          }
          return null;
        }
        function a2(e2, t3) {
          const [a3, o2] = e2.split("@"), i2 = n2(a3, t3, { minLength: 3 });
          return i2 ? `${i2}@${o2}` : null;
        }
        t2.email = {
          regex: /("[^"]+"\s+)?<?(?<email>[^\s,]+@[^\s,>]+)>?/gm,
          check: (e2) => {
            if (!e2) return { status: "error", error: "email is required" };
            let t3, o2, i2;
            if (typeof e2 == "string" ? t3 = (e2 || "").trim().toLowerCase() : (t3 = (e2.email || "").trim().toLowerCase(), o2 = e2.firstName, i2 = e2.lastName), !t3)
              return { status: "error", error: "email is required" };
            if (t3.split("@").length !== 2)
              return { status: "error", error: "unsupported email format" };
            const r2 = function(e3) {
              const t4 = [
                { pattern: /,com$/, fix: (e4) => e4.replace(/,com$/, ".com") },
                {
                  pattern: /,\w\w\w?$/,
                  fix: (e4) => e4.replace(/,(\w\w\w?)/, ".$1")
                },
                {
                  pattern: /,co\.\w{2}$/,
                  fix: (e4) => e4.replace(/,(co\.\w{2}$)/, ".$1")
                },
                { pattern: /@\w*$/, fix: (e4) => e4 + ".com" }
              ].find((t5) => t5.pattern.test(e3));
              if (t4) return t4.fix(e3);
              return null;
            }(t3) || function(e3) {
              const t4 = [
                "gmail",
                "hotmail",
                "outlook",
                "yahoo",
                "icloud",
                "zoho",
                "yandex",
                "mail",
                "msn"
              ], [a3, o3] = e3.split("@");
              for (let e4 = 0; e4 < t4.length; e4++) {
                const i3 = n2(o3, t4[e4], { minLength: 0 });
                if (i3) return `${a3}@${i3}`;
              }
              return null;
            }(t3) || o2 && a2(t3, o2.trim().toLowerCase()) || i2 && a2(t3, i2.trim().toLowerCase());
            return r2 ? { status: "typo", fix: r2 } : { status: "ok" };
          },
          parse: (e2) => t2.unique(
            Array.from((e2 || "").matchAll(t2.email.regex)).map((e3) => e3.groups?.email?.trim()).filter((e3) => Boolean(e3))
          )
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.enqueue = (e2, n2) => {
          let a2;
          return async (...o2) => {
            const i2 = a2, r2 = t2.createPromise();
            a2 = r2, i2 && await i2;
            try {
              const t3 = await e2.call(n2, ...o2);
              return r2.resolve(), t3;
            } catch (e3) {
              throw r2.resolve(), e3;
            }
          };
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.ensureArray = (e2) => Array.isArray(e2) ? e2 : [e2];
      })(), (() => {
        const { $utils: t2 } = e;
        t2.extractor = {
          extract(e2) {
            this.init();
            const t3 = this._cache.get(e2);
            if (t3) return t3;
            let n2 = { value: e2, template: null, items: [] };
            return e2 ? (n2.value.match(/\d/) && (n2 = this._parseTime(n2), n2 = this._parseDuration(n2), n2 = this._parseCopyright(n2), n2 = this._parseDate(n2, this.config.regex.date_triplex, true), n2 = this._parseDate(n2, this.config.regex.date_dmy, true), n2 = this._parseDate(n2, this.config.regex.date_mdy, true), n2 = this._parseDate(n2, this.config.regex.date_my, true), n2.value = e2, n2 = this._parseNumber(n2), n2 = this._mergeNumbers(n2), n2 = this._cleanSourceMetrics(n2)), this._maskItemsInValue(n2), n2 = this._parseCurrency(n2), this._maskItemsInValue(n2, "currency"), n2.template = this._replaceMask(n2.value), n2.value = e2, n2.items = n2.items.sort((e3, t4) => e3.index - t4.index), this._cache.set(e2, n2), n2) : (this._cache.set(e2, n2), n2);
          },
          config: {
            currencies: t2.currency.list,
            time: { millisecond: 1, second: 1e3, minute: 6e4, hour: 36e5 },
            monthsMap: {},
            currenciesMap: {},
            metricsMap: {
              \u03BCs: { to: "ms", mult: 1e-3 },
              microsecond: { to: "ms", mult: 1e-3 },
              microseconds: { to: "ms", mult: 1e-3 },
              ms: { to: "ms", mult: 1 },
              millisecond: { to: "ms", mult: 1 },
              milliseconds: { to: "ms", mult: 1 },
              s: { to: "ms", mult: 1e3 },
              second: { to: "ms", mult: 1e3 },
              seconds: { to: "ms", mult: 1e3 },
              m: { to: "ms", mult: 6e4 },
              min: { to: "ms", mult: 6e4 },
              minute: { to: "ms", mult: 6e4 },
              minutes: { to: "ms", mult: 6e4 },
              h: { to: "ms", mult: 36e5 },
              hour: { to: "ms", mult: 36e5 },
              hours: { to: "ms", mult: 36e5 },
              d: { to: "ms", mult: 864e5 },
              day: { to: "ms", mult: 864e5 },
              days: { to: "ms", mult: 864e5 },
              w: { to: "ms", mult: 6048e5 },
              week: { to: "ms", mult: 6048e5 },
              weeks: { to: "ms", mult: 6048e5 },
              mo: { to: "ms", mult: 2592e6 },
              month: { to: "ms", mult: 2592e6 },
              months: { to: "ms", mult: 2592e6 },
              y: { to: "ms", mult: 31536e6 },
              year: { to: "ms", mult: 31536e6 },
              years: { to: "ms", mult: 31536e6 },
              \u03BCm: { to: "meters", mult: 1e-6 },
              micrometre: { to: "meters", mult: 1e-6 },
              micrometer: { to: "meters", mult: 1e-6 },
              micrometres: { to: "meters", mult: 1e-6 },
              micrometers: { to: "meters", mult: 1e-6 },
              mm: { to: "meters", mult: 1e-3 },
              millimetre: { to: "meters", mult: 1e-3 },
              millimeter: { to: "meters", mult: 1e-3 },
              millimetres: { to: "meters", mult: 1e-3 },
              millimeters: { to: "meters", mult: 1e-3 },
              cm: { to: "meters", mult: 0.01 },
              centimetre: { to: "meters", mult: 0.01 },
              centimeter: { to: "meters", mult: 0.01 },
              centimetres: { to: "meters", mult: 0.01 },
              centimeters: { to: "meters", mult: 0.01 },
              dm: { to: "meters", mult: 0.1 },
              decimetre: { to: "meters", mult: 0.01 },
              decimeter: { to: "meters", mult: 0.01 },
              decimetres: { to: "meters", mult: 0.01 },
              decimeters: { to: "meters", mult: 0.01 },
              metre: { to: "meters", mult: 1 },
              metres: { to: "meters", mult: 1 },
              meter: { to: "meters", mult: 1 },
              meters: { to: "meters", mult: 1 },
              km: { to: "meters", mult: 1e3 },
              kilometre: { to: "meters", mult: 1e3 },
              kilometer: { to: "meters", mult: 1e3 },
              kilometres: { to: "meters", mult: 1e3 },
              kilometers: { to: "meters", mult: 1e3 },
              inch: { to: "meters", mult: 0.0254 },
              inches: { to: "meters", mult: 0.0254 },
              foot: { to: "meters", mult: 0.3048 },
              feet: { to: "meters", mult: 0.3048 },
              yard: { to: "meters", mult: 0.9144 },
              yards: { to: "meters", mult: 0.9144 },
              mile: { to: "meters", mult: 1609.344 },
              miles: { to: "meters", mult: 1609.344 },
              \u03BCg: { to: "grams", mult: 1e-6 },
              microgram: { to: "grams", mult: 1e-6 },
              micrograms: { to: "grams", mult: 1e-6 },
              mg: { to: "grams", mult: 1e-3 },
              milligram: { to: "grams", mult: 1e-3 },
              milligrams: { to: "grams", mult: 1e-3 },
              g: { to: "grams", mult: 1 },
              gram: { to: "grams", mult: 1 },
              grams: { to: "grams", mult: 1 },
              kg: { to: "grams", mult: 1e3 },
              kilogram: { to: "grams", mult: 1e3 },
              kilograms: { to: "grams", mult: 1e3 },
              tonne: { to: "grams", mult: 1e6 },
              tonnes: { to: "grams", mult: 1e6 },
              oz: { to: "grams", mult: 28.349523125 },
              ounce: { to: "grams", mult: 28.349523125 },
              ounces: { to: "grams", mult: 28.349523125 },
              lb: { to: "grams", mult: 453.59237 },
              pound: { to: "grams", mult: 453.59237 },
              pounds: { to: "grams", mult: 453.59237 },
              byte: { to: "bytes", mult: 1 },
              bytes: { to: "bytes", mult: 1 },
              kb: { to: "bytes", mult: 1e3 },
              kilobyte: { to: "bytes", mult: 1e3 },
              kilobytes: { to: "bytes", mult: 1e3 },
              mb: { to: "bytes", mult: 1e6 },
              megabyte: { to: "bytes", mult: 1e6 },
              megabytes: { to: "bytes", mult: 1e6 },
              gb: { to: "bytes", mult: 1e9 },
              gigabyte: { to: "bytes", mult: 1e9 },
              gigabytes: { to: "bytes", mult: 1e9 },
              tb: { to: "bytes", mult: 1e12 },
              terabyte: { to: "bytes", mult: 1e12 },
              terabytes: { to: "bytes", mult: 1e12 },
              pb: { to: "bytes", mult: 1e15 },
              petabyte: { to: "bytes", mult: 1e15 },
              petabytes: { to: "bytes", mult: 1e15 },
              "%": { to: "%", mult: 1 },
              percent: { to: "%", mult: 1 }
            },
            regex: {
              delimiter: /^(,\s|,|\s| and )$/gi,
              number: /LA(?<content>(?:(?<currency>CURRENCY)\s?)?(?<sign>>|~|\+|±|-|\+-|-\+)?(?<value>(?<integer>\d+(?:(?: \d\d\d)*|(?:,\d\d\d)*|(?:\.\d\d\d)*))(?<decimal>[,.]\d+)?(?<multiplier>(k|m|b|t| ?thousands?| ?millions?| ?billions?| ?trillions?)(?!\w))?\+?)(?:[ -]?(?<metric>METRIC|CURRENCY))?)LB/gim,
              time: /LA(?<content>((?<hours>\d?\d):)?(?<minutes>\d?\d):(?<seconds>\d\d)(?:.(?<ms>\d?\d?\d))?\s*(?<ampm>am|pm|a\.m\.|p\.m\.)?)LB/gim,
              duration: /LA(?<content>(?:(?<hours>\d+):)?(?<minutes>\d?\d):(?<seconds>\d\d)(?:.(?<ms>\d?\d?\d))?)LB/gim,
              copyright: /LA(?<content>(?:©|\(c\))\s(?<year>(\d\d)?\d\d))LB/gim,
              date_triplex: /LA(?<content>(?<date>\d?\d)(?<sep1>[/.])(?<month>\d?\d)((?<sep2>[/.])(?<year>(\d?\d?\d\d)))?)LB/gim,
              date_dmy: /LA(?<content>(?<date>\d?\d)(?:st|nd|rd|th)?(?:[ -]| of )(?<month>MONTH)((, |,| |-)(?<year>\d?\d?\d\d)?)?)LB/gim,
              date_mdy: /LA(?<content>(?<month>MONTH)(?: |-| the )(?<date>\d?\d)(?:st|nd|rd|th)?((?:, |,| |-)(?<year>\d?\d?\d\d)?)?)LB/gim,
              date_my: /LA(?<content>(?<month>MONTH)((?:, |,| |-| of )(?<year>\d?\d?\d\d)))LB/gim,
              currency: /LA(?<content>CURRENCY)LB/gim
            }
          },
          init() {
            this._initialized || (this._initialized = true, this._cache = /* @__PURE__ */ new Map(), this._maskCache = [], this._enrichConfigWithMonths(), this._enrichConfigWithCurrencies(), this._enrichRegexes("LA", /(?<=^|\s|\w-|\w\/|"|'|\()/), this._enrichRegexes("LB", /(?=\/\w|°|-\w|\s|\W\s|\W$|\)|$)/), this._parseNumber = this._createRegexParser(
              this._parseNumber,
              this.config.regex.number
            ), this._parseTime = this._createRegexParser(
              this._parseTime,
              this.config.regex.time
            ), this._parseDuration = this._createRegexParser(
              this._parseDuration,
              this.config.regex.duration
            ), this._parseCopyright = this._createRegexParser(
              this._parseCopyright,
              this.config.regex.copyright
            ), this._parseDate = this._createRegexParser(
              this._parseDate,
              this.config.regex.date_triplex
            ), this._parseCurrency = this._createRegexParser(
              this._parseCurrency,
              this.config.regex.currency
            ));
          },
          _enrichConfigWithMonths() {
            let e2 = ["en"];
            if (globalThis.navigator) {
              const t4 = navigator.languages;
              t4 && e2.push(...t4);
            }
            if (globalThis.document?.documentElement) {
              const t4 = document.documentElement.getAttribute("lang");
              t4 && e2.push(t4);
            }
            let t3 = [];
            e2 = Array.from(new Set(e2)), e2.forEach((e3) => {
              try {
                [
                  ...this._getMonthList(e3, "short"),
                  ...this._getMonthList(e3, "long")
                ].forEach((e4, n2) => {
                  e4 = e4.toLowerCase(), void 0 === this.config.monthsMap[e4] && (this.config.monthsMap[e4] = n2 % 12, t3.push(e4));
                });
              } catch {
              }
            }), t3 = t3.join("|"), this._enrichRegexes("MONTH", t3);
          },
          _enrichConfigWithCurrencies() {
            let e2 = ["$", "USD", "kr"], t3 = "all,lvl,try,top,bob,pen,php,af,fc,fr,bs,km,rm,qr,tl,ft,jd,k,r,p,l,q";
            t3 = new Set(t3.split(",")), this.config.currenciesMap = { $: "USD", USD: "USD", kr: "SEK" };
            const n2 = (n3, a3) => {
              this.config.currenciesMap[n3] || t3.has(n3) || (this.config.currenciesMap[n3] = a3, e2.push(n3));
            };
            this.config.currencies.forEach((e3) => {
              n2(e3.code.toLowerCase(), e3.code), n2(e3.name.toLowerCase(), e3.code), n2(e3.namePlural.toLowerCase(), e3.code), n2(e3.symbol.toLowerCase(), e3.code), n2(e3.symbolNative.toLowerCase(), e3.code), (e3.alt || []).forEach((t4) => n2(t4.toLowerCase(), e3.code));
            }), e2 = e2.map((e3) => e3.replace("$", "\\$").replace(".", "\\.")).join("|"), this._enrichRegexes("CURRENCY", e2);
            const a2 = Object.keys(this.config.metricsMap).join("|");
            this._enrichRegexes("METRIC", a2);
          },
          _enrichRegexes(e2, t3) {
            Object.prototype.toString.call(t3).toLowerCase() === "[object regexp]" && (t3 = t3.source), Object.keys(this.config.regex).forEach((n2) => {
              this.config.regex[n2].source.includes(e2) && (this.config.regex[n2] = new RegExp(
                this.config.regex[n2].source.replaceAll(e2, t3),
                this.config.regex[n2].flags
              ));
            });
          },
          _getMonthList: (e2 = "en", t3 = "long") => e2 === "auto" ? [] : Array.from(
            Array(12).keys(),
            (n2) => Intl.DateTimeFormat(e2, {
              month: { s: "short", n: "numeric" }[t3[0]] || "long"
            }).format(new Date(0, n2))
          ),
          _createRegexParser(e2, t3) {
            const n2 = t3;
            return function({ value: t4, items: a2 }, o2, i2 = false) {
              const r2 = Array.from(t4.matchAll(o2 || n2)).filter((e3) => e3.groups);
              return r2.length === 0 ? arguments[0] : (r2.forEach((n3) => {
                let o3 = e2(n3, this.config);
                o3 && (o3 = Array.isArray(o3) ? o3 : [o3], o3.length !== 0 && (o3.forEach((e3) => {
                  e3.hasOwnProperty("content") || (e3.content = n3.groups.content), e3.hasOwnProperty("index") || (e3.index = n3.index);
                }), a2 = [...a2, ...o3], i2 && (t4 = this._replaceMatch(t4, n3))));
              }), { value: t4, items: a2 });
            };
          },
          _replaceMatch(e2, t3, n2 = "#") {
            const a2 = t3.groups.content, o2 = t3.index + t3.input.slice(t3.index).indexOf(a2), i2 = e2.slice(0, o2), r2 = e2.slice(o2 + a2.length);
            return i2 + n2.repeat(a2.length) + r2;
          },
          _parseTime(e2, t3) {
            let n2 = Number(e2.groups.hours), a2 = Number(e2.groups.minutes), o2 = Number(e2.groups.seconds);
            const i2 = e2.groups.ms ? 1e3 * Number("0." + e2.groups.ms) : 0;
            Number.isNaN(n2) && (n2 = a2, a2 = o2, o2 = 0);
            const r2 = (e2.groups.ampm || "").toLowerCase().replaceAll(/\./g, "").trim();
            return r2 && n2 > 12 ? null : (r2 === "am" ? n2 === 12 && (n2 = 0) : r2 === "pm" && n2 < 12 && (n2 += 12), {
              type: "time",
              value: i2 * t3.time.millisecond + o2 * t3.time.second + a2 * t3.time.minute + n2 * t3.time.hour,
              content: e2.groups.content,
              index: e2.index
            });
          },
          _parseDuration(e2, t3) {
            const n2 = Number(e2.groups.hours) || 0, a2 = Number(e2.groups.minutes) || 0, o2 = Number(e2.groups.seconds) || 0;
            return {
              type: "number",
              value: (e2.groups.ms ? 1e3 * Number("0." + e2.groups.ms) : 0) * t3.time.millisecond + o2 * t3.time.second + a2 * t3.time.minute + n2 * t3.time.hour,
              metric: "ms"
            };
          },
          _parseCopyright(e2) {
            const t3 = Number(e2.groups.year);
            return Number.isNaN(t3) ? null : { type: "copyright", value: t3 };
          },
          _parseDate(e2, t3) {
            if (e2.groups.sep1 && e2.groups.sep2 && e2.groups.sep1 !== e2.groups.sep2)
              return null;
            let n2 = e2.groups.date ? Number(e2.groups.date) : 1, a2 = e2.groups.month;
            if (e2.groups.sep1)
              e2.groups.sep1 === "/" && ([a2, n2] = [n2, a2]), a2 > 12 && ([a2, n2] = [n2, a2]), a2 -= 1;
            else if (a2 = t3.monthsMap[e2.groups.month.toLowerCase()], void 0 === a2)
              return null;
            if (Number.isNaN(n2) || n2 < 1 || n2 > 31) return null;
            if (Number.isNaN(a2) || a2 < 0 || a2 > 11) return null;
            let o2 = Number(e2.groups.year || (/* @__PURE__ */ new Date()).getFullYear());
            if (o2 < 100) {
              const e3 = (/* @__PURE__ */ new Date()).getFullYear();
              o2 = Number(e3.toString().slice(0, 2) + o2), o2 > e3 && (o2 -= 100);
            }
            const i2 = new Date(Date.UTC(o2, a2, n2));
            return { type: "date", value: i2.getTime(), date: i2 };
          },
          _parseNumber(e2, t3) {
            let {
              integer: n2,
              decimal: a2,
              sign: o2,
              multiplier: i2,
              currency: r2,
              metric: s2
            } = e2.groups;
            r2 = r2 && r2.toLowerCase(), s2 = s2 && s2.toLowerCase(), a2 = a2 || "";
            const l2 = { type: "number" }, c2 = [l2];
            if (a2.length === 4 && n2.length < 4 && (n2 += a2, a2 = ""), !a2.startsWith(",") || a2.length !== 4 || n2.includes(".") || n2.includes(" ") || (n2 += a2, a2 = ""), n2 = n2.replaceAll(/[ ,.]/g, ""), a2 = a2.replaceAll(/[ ,.]/g, "."), l2.value = Number(n2 + a2), o2 === "-" && (l2.value *= -1), i2 = i2 ? i2.toLowerCase() : i2 || "", i2 === "k" || i2.includes("thousand") ? l2.value *= 1e3 : i2 === "m" || i2.includes("million") ? l2.value *= 1e6 : i2 === "b" || i2.includes("billion") ? l2.value *= 1e9 : (i2 === "t" || i2.includes("trillion")) && (l2.value *= 1e12), l2.value = parseFloat(l2.value.toFixed(6)), (r2 || s2) && (l2.metric = r2 || s2), i2 === "m" && !s2 && l2.value % 1e6 == 0) {
              const e3 = { ...l2 };
              e3.value /= 1e6, e3.metric = "minutes", c2.push(e3);
              const t4 = { ...l2 };
              t4.value /= 1e6, t4.metric = "meters", c2.push(t4);
            }
            return c2.filter((e3) => e3.metric).forEach((e3) => {
              const n3 = e3.metric;
              t3.currenciesMap[n3] ? (e3.type = "price", e3.sourceMetric = n3, e3.metric = "CUR:" + t3.currenciesMap[n3]) : (e3.sourceMetric = n3, e3.metric = t3.metricsMap[n3].to, e3.value = e3.value * t3.metricsMap[n3].mult);
            }), c2;
          },
          _mergeNumbers(e2) {
            if (e2.items.length < 2) return e2;
            let t3 = false;
            const n2 = {};
            return e2.items.forEach((e3, a2) => {
              e3.metric && !e3.type !== "number" && (n2[e3.metric] = n2[e3.metric] || [], n2[e3.metric].push({ item: e3, index: a2 }), n2[e3.metric].length > 1 && (t3 = true));
            }), t3 ? (Object.values(n2).forEach((t4) => {
              let n3 = [];
              const a2 = () => {
                if (n3.length < 2) n3 = [];
                else
                  for (let t5 = 1; t5 < n3.length; t5++) {
                    const a3 = n3[t5], o2 = n3[t5 - 1];
                    e2.items[n3[0].index].value += a3.item.value, e2.items[n3[0].index].content = e2.items[n3[0].index].content + e2.value.substring(
                      o2.item.index + o2.item.content.length,
                      a3.item.index
                    ) + a3.item.content, e2.items[a3.index] = null;
                  }
              };
              n3.push(t4[0]);
              for (let o2 = 1; o2 < t4.length; o2++) {
                const i2 = t4[o2 - 1], r2 = t4[o2];
                i2.item.sourceMetric !== r2.item.sourceMetric && this.config.metricsMap[i2.item.sourceMetric]?.mult > this.config.metricsMap[r2.item.sourceMetric]?.mult && e2.value.substring(
                  i2.item.index + i2.item.content.length,
                  r2.item.index
                ).match(this.config.regex.delimiter) ? n3.push(r2) : (a2(), n3.push(r2));
              }
              a2();
            }), e2.items = e2.items.filter((e3) => Boolean(e3)), e2) : e2;
          },
          _cleanSourceMetrics: (e2) => (e2.items.forEach((e3) => {
            e3.sourceMetric && delete e3.sourceMetric;
          }), e2),
          _parseCurrency(e2, t3) {
            const { content: n2 } = e2.groups;
            return {
              type: "currency",
              value: "CUR:" + t3.currenciesMap[n2.toLowerCase()]
            };
          },
          _maskItemsInValue(e2, t3 = null) {
            let n2 = e2.value, a2 = e2.items;
            if (t3 && (a2 = a2.filter((e3) => e3.type === t3)), a2.length === 0)
              return n2.trim();
            a2.forEach((e3) => {
              const t4 = n2.slice(0, e3.index), a3 = n2.slice(e3.index + e3.content.length);
              let o2 = this._maskCache[e3.content.length];
              o2 || (o2 = "\u0489".repeat(e3.content.length), this._maskCache[e3.content.length] = o2), n2 = t4 + o2 + a3;
            }), e2.value = n2;
          },
          _replaceMask: (e2, t3 = "{{data}}") => e2.replace(/҉+/gi, t3).trim()
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.formatTokens = (e2 = 0, t3 = false) => {
          const n2 = e2 < 0;
          let a2, o2;
          return (e2 = Math.abs(Math.round(e2))) === 1 ? (a2 = 1, o2 = "token") : e2 < 1e5 ? (a2 = e2, o2 = "tokens") : (a2 = (e2 / 1e6).toFixed(2), o2 = "MTs"), n2 && (a2 = -a2), t3 ? `${a2} ${o2}` : { value: a2, suffix: o2 };
        };
      })(), (() => {
        const { $utils: t2 } = e, n2 = (e2) => e2 === 0 ? { value: 0, metric: "meters" } : e2 === 1 ? { value: 1, metric: "meter" } : e2 < 1e-3 ? { value: 1e6 * e2, metric: "\xB5m" } : e2 < 1 ? { value: 1e3 * e2, metric: "mm" } : e2 < 1e3 ? { value: e2, metric: "meters" } : { value: e2 / 1e3, metric: "km" }, a2 = (e2) => e2 === 0 ? { value: 0, metric: "grams" } : e2 === 1 ? { value: 1, metric: "gram" } : e2 < 1e-3 ? { value: 1e6 * e2, metric: "\xB5g" } : e2 < 1 ? { value: 1e3 * e2, metric: "mg" } : e2 < 1e3 ? { value: e2, metric: "grams" } : { value: e2 / 1e3, metric: "kg" }, o2 = (e2) => e2 === 0 ? { value: 0, metric: "bytes" } : e2 === 1 ? { value: 1, metric: "byte" } : e2 < 1e3 ? { value: e2, metric: "bytes" } : e2 < 1e6 ? { value: e2 / 1e3, metric: "kB" } : e2 < 1e9 ? { value: e2 / 1e6, metric: "MB" } : e2 < 1e12 ? { value: e2 / 1e9, metric: "GB" } : e2 < 1e15 ? { value: e2 / 1e12, metric: "TB" } : { value: e2 / 1e15, metric: "PB" }, i2 = (e2, t3 = 45) => {
          if (e2.length <= t3) return e2;
          const n3 = e2.split("/");
          let a3 = n3.at(-1);
          if (a3.length > t3) return `...${a3.slice(a3.length - t3, a3.length)}`;
          for (let e3 = n3.length - 2; e3 > 0; e3--) {
            if (a3.length + n3[e3].length + 1 > t3) return `.../${a3}`;
            a3 = `${n3[e3]}/${a3}`;
          }
          return `.../${a3}`;
        };
        t2.formatter = {
          format: (e2, r2, s2 = {}) => {
            if (e2 == null) return e2;
            const l2 = s2.format || "string", c2 = s2.long || false, u2 = s2.maxInt || 1e3;
            let p2 = "";
            if ((r2 = r2 === "number" ? "" : r2 || "") == "text" || r2 === "element")
              return l2 === "string" ? e2 : { value: e2 };
            if (r2 === "link" || r2 === "image" || r2 === "icon" || r2 === "video")
              return e2 = i2(e2), l2 === "string" ? e2 : { value: e2 };
            if (r2 === "currency") {
              const n3 = s2.currencyFormat || "name";
              return e2 = t2.currency.formatCurrency(e2, n3), l2 === "string" ? e2 : { value: e2 };
            }
            if (r2 === "date")
              return e2 = t2.time.formatDate(e2), l2 === "string" ? e2 : { value: e2 };
            if (r2 === "time")
              return e2 = t2.time.formatTime(e2), l2 === "string" ? e2 : { value: e2 };
            if (r2 === "copyright")
              return e2 = t2.copyright.formatCopyright(e2), l2 === "string" ? e2 : { value: e2 };
            if (r2 === "duration" || r2 === "ms")
              return e2 = t2.time.formatDuration(e2), l2 === "string" ? e2 : { value: e2 };
            if (r2 === "distance" || r2 === "meters") {
              const t3 = n2(e2);
              e2 = t3.value, r2 = t3.metric;
            }
            if (r2 === "matches" && (e2 === 0 ? (e2 = "No", r2 = "") : r2 = e2 === 1 ? "match" : "matches"), r2 === "weight" || r2 === "grams") {
              const t3 = a2(e2);
              e2 = t3.value, r2 = t3.metric;
            }
            if (r2 === "information" || r2 === "bytes") {
              const t3 = o2(e2);
              e2 = t3.value, r2 = t3.metric;
            }
            if (r2?.startsWith("CUR:")) {
              const e3 = s2.currencyFormat || "symbolNative";
              e3 !== "symbolNative" || r2 !== "CUR:USD" && r2 !== "CUR:EUR" ? (r2 = r2.slice(4), r2 = t2.currency.byCode[r2]?.[e3] || r2) : (p2 = r2.slice(4), p2 = t2.currency.byCode[p2]?.[e3] || p2, r2 = "");
            }
            const d2 = c2 ? { sign: "", value: e2, suffix: "" } : t2.number.toShort(e2, { maxInt: u2, format: "object" });
            let m2 = {
              prefix: p2,
              sign: d2.sign,
              value: typeof d2.value == "number" ? d2.value.toLocaleString("en-US", s2).replaceAll(",", "\u2009") : d2.value,
              suffix: d2.suffix,
              metric: r2 || ""
            };
            return l2 === "string" ? `${m2.prefix}${m2.sign}${m2.value}${m2.suffix} ${m2.metric}`.trim() : m2;
          },
          formatDistance: n2,
          formatWeight: a2,
          formatInformation: o2
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.frequency = (e2, n2) => {
          const a2 = /* @__PURE__ */ new Map();
          if (!e2) return;
          let o2 = null;
          if (t2.is.object(e2)) o2 = Object.values(e2);
          else {
            if (!t2.is.array(e2))
              throw new Error(
                "$utils.frequency works for Arrays and Object sources"
              );
            o2 = e2;
          }
          return typeof n2 == "function" ? o2.forEach((e3) => {
            const t3 = n2(e3), o3 = a2.get(t3);
            a2.set(t3, (o3 || 0) + 1);
          }) : o2.forEach((e3) => {
            const t3 = e3[n2], o3 = a2.get(t3);
            a2.set(t3, (o3 || 0) + 1);
          }), a2;
        };
      })(), (() => {
        const { $utils: t2 } = e;
        function n2(e2, t3) {
          if (e2[0] !== t3[0]) return false;
          const a3 = Math.min(e2.length, t3.length);
          if (a3 === 0) return "";
          const o2 = e2.slice(0, a3);
          return o2 === t3.slice(0, a3) ? o2 : n2(e2.slice(0, a3 - 1), t3.slice(0, a3 - 1));
        }
        function a2(e2) {
          return e2.toLowerCase().replace(/[ .,?!\-—–+=_%:;$#@/{}()]/g, "");
        }
        t2.fuzzyCheck = (e2, t3, o2 = 1) => {
          if (e2 = a2(e2), (t3 = a2(t3)) === "") return true;
          for (; e2.length > 0; ) {
            const a3 = n2(e2, t3);
            if (a3.length >= o2 || a3.length > 0 && t3.length < o2) {
              if (e2 = e2.slice(a3.length), (t3 = t3.slice(a3.length)) === "")
                return true;
            } else e2 = e2.slice(1);
          }
          return false;
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.gaussianRand = function() {
          let e2 = 0;
          for (let t3 = 0; t3 < 6; t3 += 1) e2 += Math.random();
          return e2 / 6;
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.generateOtp = (e2 = 6) => {
          let t3 = "";
          const n2 = "aabcdeefghjklmnpqrstuuvwxyyz2233445566778899";
          for (let a2 = 0; a2 < e2; a2++) {
            const e3 = Math.floor(Math.random() * n2.length);
            t3 += n2.charAt(e3);
          }
          return t3.toUpperCase();
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.getReqIp = (e2) => e2.headers["x-forwarded-for"] || e2.headers["x-real-ip"] || e2.connection.remoteAddress;
      })(), (() => {
        const { $utils: t2 } = e;
        t2.get = (e2, n2, a2 = true) => {
          const o2 = (n2 || "").split(".");
          let i2 = e2;
          for (let e3 of o2) {
            if (void 0 === i2) return;
            if (i2 === null) return;
            if (t2.is.array(i2)) {
              const t3 = Number(e3);
              if (!Number.isNaN(t3)) {
                if (t3 < -i2.length || t3 >= i2.length) return;
                i2 = i2.at(t3);
                continue;
              }
            }
            a2 && t2.is.function(i2[e3]) ? i2 = i2[e3]() : i2 = i2[e3];
          }
          return i2;
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.hasExtraKeys = (e2, t3) => !!e2 && (t3 = t3 instanceof Set ? t3 : new Set(t3), (t3 = Object.keys(e2).filter((e3) => !t3.has(e3))).length !== 0 && t3);
      })(), (() => {
        const { $utils: t2 } = e;
        t2.hashCode = (e2) => {
          if (typeof e2 != "string")
            throw new Error("$utils.hashCode source parameter must be a string");
          if (e2.length === 0) return 0;
          let t3, n2 = 0;
          for (let a2 = 0; a2 < e2.length; a2++)
            t3 = e2.charCodeAt(a2), n2 = (n2 << 5) - n2 + t3, n2 |= 0;
          return n2;
        };
      })(), (() => {
        const { $utils: t2, $env: n2 } = e;
        t2.hotkey = {
          on(e2, t3) {
            if (!e2) return;
            this._init(), this._listenerCount += 1;
            const { code: n3, modifiers: a2 } = this._parse(e2), o2 = this._listenerCount, i2 = { code: n3, ...a2 };
            return this._listeners.push({ id: o2, match: i2, callback: t3 }), o2;
          },
          off(e2) {
            e2 && this._listeners && (this._listeners = this._listeners.filter((t3) => t3.id !== e2));
          },
          fromEvent(e2, { singleModifier: t3 = false } = {}) {
            let n3 = [
              e2.ctrlKey && "ctrl",
              e2.metaKey && "meta",
              e2.altKey && "alt",
              e2.shiftKey && "shift"
            ].filter(Boolean);
            return t3 && n3.length > 0 && (n3 = [n3[0]]), [...n3, e2.code].join(" ");
          },
          render(e2, t3 = "") {
            if (!e2) return "";
            const { code: a2, modifiers: o2 } = this._parse(e2);
            let i2;
            return i2 = a2.startsWith("Key") ? a2.slice(3) : n2.platform === "mac" ? a2 === "Enter" ? "\u21B5" : a2 === "Backspace" ? "\u232B" : a2 === "Escape" ? "\u238B" : a2 : a2 === "Enter" ? "Enter" : a2 === "Backspace" ? "Backspace" : a2 === "Escape" ? "Esc" : a2, n2.platform === "mac" ? (o2.meta && (i2 = "\u2318" + i2), o2.shift && (i2 = "\u21E7" + i2), o2.alt && (i2 = "\u2325" + i2), o2.ctrl && (i2 = "\u2303" + i2)) : (o2.shift && (i2 = "Shift + " + i2), o2.meta && (i2 = "Meta + " + i2), o2.alt && (i2 = "Alt + " + i2), o2.ctrl && (i2 = "Ctrl + " + i2)), `${t3}${i2}`;
          },
          equal(e2, t3) {
            if (e2 === t3) return true;
            if (!e2 || !t3) return false;
            const { code: n3, modifiers: a2 } = this._parse(e2), { code: o2, modifiers: i2 } = this._parse(t3);
            return n3 === o2 && a2.alt === i2.alt && a2.ctrl === i2.ctrl && a2.meta === i2.meta && a2.shift === i2.shift;
          },
          _init() {
            this._initialized || (this._initialized = true, this._listeners = [], this._listenerCount = 0, document.addEventListener("keydown", (e2) => this._handle(e2)));
          },
          _parse(e2) {
            const t3 = e2.split(" "), a2 = {
              alt: t3.includes("alt"),
              ctrl: t3.includes("ctrl"),
              meta: t3.includes("meta"),
              shift: t3.includes("shift"),
              auto: t3.includes("auto"),
              cmd: t3.includes("cmd")
            }, o2 = t3.find((e3) => !(e3 in a2));
            return a2.auto && (a2.alt = n2.platform !== "mac", a2.ctrl = n2.platform === "mac"), delete a2.auto, a2.cmd && (a2.meta = n2.platform === "mac", a2.ctrl = n2.platform !== "mac"), delete a2.cmd, { code: o2, modifiers: a2 };
          },
          _handle(e2) {
            const { code: t3, shiftKey: n3, ctrlKey: a2, altKey: o2, metaKey: i2 } = e2;
            this._listeners.filter((e3) => {
              const { match: r2 } = e3;
              return (r2.code === "*" || r2.code === t3) && (r2.ctrl === "*" || r2.ctrl === a2) && (r2.alt === "*" || r2.alt === o2) && (r2.shift === "*" || r2.shift === n3) && (r2.meta === "*" || r2.meta === i2);
            }).forEach((t4) => t4.callback(e2));
          }
        };
      })(), (() => {
        const { $utils: t2, $nanoid: n2 } = e;
        t2.id = {
          pico(e2 = []) {
            const t3 = "0123456789abcdefghijklmnopqrstuvwxyz";
            if (e2.length >= "0123456789abcdefghijklmnopqrstuvwxyz".length ** 4)
              throw new Error("Cannot generate more IDs");
            let n3;
            do {
              n3 = "";
              for (let e3 = 0; e3 < 4; e3++) {
                const e4 = Math.floor(Math.random() * t3.length);
                n3 += t3.charAt(e4);
              }
            } while (e2.includes(n3));
            return n3;
          },
          nano(e2 = []) {
            let t3;
            do {
              t3 = n2();
            } while (e2.includes(t3));
            return t3;
          },
          uuid(e2 = []) {
            let t3;
            do {
              t3 = crypto.randomUUID();
            } while (e2.includes(t3));
            return t3;
          }
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.image = {
          async crop(e2, { x: t3, y: n2, width: a2, height: o2 }) {
            const i2 = await createImageBitmap(e2), r2 = new OffscreenCanvas(a2, o2);
            return r2.getContext("2d").drawImage(i2, -t3, -n2), await r2.convertToBlob({ type: e2.type });
          },
          async process(e2, {
            width: t3 = null,
            height: n2 = null,
            size: a2 = null,
            cover: o2 = false,
            type: i2 = "image/webp",
            quality: r2 = 0.9
          } = {}) {
            const s2 = await createImageBitmap(e2), l2 = s2.width / s2.height;
            let c2, u2, p2, d2;
            t3 = a2 || t3, n2 = a2 || n2;
            let m2 = 0, h = 0;
            if (o2 && t3 && n2) {
              const e3 = Math.max(t3 / s2.width, n2 / s2.height);
              c2 = t3, u2 = n2, p2 = Math.round(e3 * s2.width), d2 = Math.round(e3 * s2.height), m2 = Math.round((t3 - p2) / 2), h = Math.round((n2 - d2) / 2);
            } else if (t3 && n2) {
              const e3 = Math.min(1, t3 / s2.width, n2 / s2.height);
              p2 = Math.round(e3 * s2.width), d2 = Math.round(e3 * s2.height);
            } else
              t3 ? (p2 = Math.min(t3, s2.width), d2 = Math.round(p2 / l2)) : n2 ? (d2 = Math.min(n2, s2.height), p2 = Math.round(d2 * l2)) : (p2 = t3, d2 = n2);
            const g = new OffscreenCanvas(c2 || p2, u2 || d2);
            return g.getContext("2d").drawImage(s2, m2, h, p2, d2), await g.convertToBlob({ type: i2, quality: r2 });
          },
          async analyze(e2) {
            const t3 = document.createElement("img");
            t3.src = e2;
            if (!await new Promise((e3) => {
              t3.onload = () => e3(true), t3.onerror = () => e3(false);
            }))
              return null;
            const { width: n2, height: a2 } = t3, o2 = document.createElement("canvas");
            o2.width = n2, o2.height = a2;
            const i2 = o2.getContext("2d");
            i2.drawImage(t3, 0, 0);
            const r2 = i2.getImageData(0, 0, n2, a2).data, s2 = Math.ceil(n2 * a2 / 576);
            let l2 = 0, c2 = 0, u2 = false;
            for (let e3 = 0; e3 < r2.length; e3 += 4 * s2) {
              const t4 = r2[e3], n3 = r2[e3 + 1], a3 = r2[e3 + 2];
              r2[e3 + 3] !== 0 && (c2 += 1, l2 += (t4 + n3 + a3) / 3, u2 || (u2 = Math.abs(t4 - n3) > 20 || Math.abs(n3 - a3) > 20 || Math.abs(t4 - a3) > 20));
            }
            return l2 = l2 / c2 / 255, {
              brightness: l2,
              dark: l2 < 0.5,
              light: l2 >= 0.5,
              grayscale: !u2,
              width: t3.width,
              height: t3.height,
              data: r2
            };
          }
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.isTopFrame = () => globalThis.top === globalThis;
      })(), (() => {
        const { $utils: t2 } = e;
        t2.is = {
          null: (e2) => e2 === null,
          defined: (e2) => void 0 !== e2,
          undefined: (e2) => void 0 === e2,
          nil: (e2) => e2 == null,
          boolean: (e2) => typeof e2 == "boolean",
          number: (e2) => typeof e2 == "number",
          string: (e2) => typeof e2 == "string",
          symbol: (e2) => typeof e2 == "symbol",
          function: (e2) => typeof e2 == "function",
          map: (e2) => e2 instanceof Map,
          set: (e2) => e2 instanceof Set,
          url: (e2) => e2 instanceof URL,
          blob: (e2) => e2 instanceof Blob,
          file: (e2) => e2 instanceof File,
          error: (e2) => e2 instanceof Error,
          regexp: (e2) => e2 instanceof RegExp,
          array: (e2) => Array.isArray(e2),
          object: (e2) => Object.prototype.toString.call(e2) === "[object Object]",
          nan: (e2) => Number.isNaN(e2),
          nonPrimitive: (e2) => t2.is.object(e2) || t2.is.array(e2),
          numeric: (e2) => !t2.is.nan(Number(e2)),
          empty: (e2) => !!t2.is.nil(e2) || (t2.is.array(e2) ? e2.length === 0 : t2.is.object(e2) ? Object.keys(e2).length === 0 : !!t2.is.string(e2) && e2.trim().length === 0)
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.json = {
          parse(e2, t3 = {}) {
            try {
              return JSON.parse(e2);
            } catch (e3) {
              if (t3.throw) throw e3;
              return t3?.fallback;
            }
          },
          stringify(e2, t3 = {}) {
            try {
              return JSON.stringify(e2, t3.replacer, t3.space);
            } catch (e3) {
              if (t3.throw) throw e3;
              return t3?.fallback;
            }
          }
        };
      })(), (() => {
        const { $utils: t2, $bus: n2 } = e;
        t2.ls = {
          get(e2, t3) {
            if (!this._supported()) return n2.send("utils.ls.get", e2, t3);
            if (!this.has(e2)) return t3;
            const a2 = localStorage.getItem(e2);
            if (a2 === "undefined") return;
            if (a2 === "null") return null;
            if (a2 === "true") return true;
            if (a2 === "false") return false;
            if (a2.startsWith("[") || a2.startsWith("{")) return JSON.parse(a2);
            const o2 = Number(a2);
            return Number.isNaN(o2) ? a2 : o2;
          },
          set(e2, t3) {
            if (!this._supported()) return n2.send("utils.ls.set", e2, t3);
            try {
              typeof t3 == "string" ? localStorage.setItem(e2, t3) : localStorage.setItem(e2, JSON.stringify(t3));
            } catch (n3) {
              console.error("$utils.ls.set failed to store the given value", {
                key: e2,
                value: t3,
                error: n3
              });
            }
          },
          has(e2) {
            return this._supported() ? e2 in localStorage : n2.send("utils.ls.has", e2);
          },
          remove(e2) {
            if (!this._supported()) return n2.send("utils.ls.remove", e2);
            localStorage.removeItem(e2);
          },
          _supported: () => !!globalThis.localStorage
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.mapBy = (e2, t3, n2 = "object") => {
          if (!e2 || e2.length === 0) return {};
          if (n2 === "object") {
            const n3 = {};
            return typeof t3 == "function" ? e2.forEach((e3) => n3[t3(e3)] = e3) : e2.forEach((e3) => n3[e3[t3]] = e3), n3;
          }
          if (n2 === "map") {
            const n3 = /* @__PURE__ */ new Map();
            return typeof t3 == "function" ? e2.forEach((e3) => {
              n3.set(t3(e3), e3);
            }) : e2.forEach((e3) => {
              n3.set(e3[t3], e3);
            }), n3;
          }
          throw new Error("$utils.mapBy format is not supported", n2);
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.match = (e2, n2) => !n2 || (t2.is.string(n2) ? !!t2.get(e2, n2) : !!t2.is.object(n2) && Object.keys(n2).every((a2) => {
          const o2 = n2[a2], i2 = t2.get(e2, a2);
          return t2.is.object(o2) ? t2.match(i2, o2) : i2 == o2;
        }));
      })(), (() => {
        const { $utils: t2 } = e;
        t2.memoize = function(e2, t3 = {}) {
          const n2 = /* @__PURE__ */ new Map(), a2 = async function(...a3) {
            if (a3.length > 1 && !t3.resolver)
              throw new Error(
                `memoized function received ${a3.length} arguments`
              );
            const o2 = Date.now();
            let i2, r2;
            if (t3.ttl && n2.forEach((e3, a4) => {
              o2 - e3.ts >= t3.ttl && n2.delete(a4);
            }), t3.resolver ? (i2 = t3.resolver.call(this, ...a3), r2 = void 0 !== i2) : (i2 = a3[0], r2 = true), r2) {
              const e3 = n2.get(i2);
              if (void 0 !== e3) return e3.value;
            }
            const s2 = await e2.call(this, ...a3);
            return r2 && n2.set(i2, { ts: o2, value: s2 }), s2;
          };
          return a2.cache = n2, a2;
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.mergeDeep = (e2, n2) => {
          const a2 = { ...e2 };
          for (const o2 in n2)
            a2[o2] = t2.is.object(e2[o2]) && t2.is.object(n2[o2]) ? t2.mergeDeep(e2[o2], n2[o2]) : n2[o2];
          return a2;
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.mutation = {
          addedNodes: (e2) => {
            const t3 = /* @__PURE__ */ new Set(), n2 = (e3) => {
              if (!t3.has(e3)) {
                t3.add(e3);
                for (const t4 of e3.childNodes) n2(t4);
              }
            };
            for (const t4 of e2) for (const e3 of t4.addedNodes) n2(e3);
            return Array.from(t3);
          },
          addedElements: (e2) => {
            const t3 = /* @__PURE__ */ new Set(), n2 = (e3) => {
              if (e3.nodeType === Element.ELEMENT_NODE && !t3.has(e3)) {
                t3.add(e3);
                for (const t4 of e3.children) n2(t4);
              }
            };
            for (const t4 of e2) for (const e3 of t4.addedNodes) n2(e3);
            return Array.from(t3);
          },
          removedNodes: (e2) => {
            const t3 = /* @__PURE__ */ new Set(), n2 = (e3) => {
              if (!t3.has(e3)) {
                t3.add(e3);
                for (const t4 of e3.childNodes) n2(t4);
              }
            };
            for (const t4 of e2) for (const e3 of t4.removedNodes) n2(e3);
            return Array.from(t3);
          },
          removedElements: (e2) => {
            const t3 = /* @__PURE__ */ new Set(), n2 = (e3) => {
              if (e3.nodeType === Element.ELEMENT_NODE && !t3.has(e3)) {
                t3.add(e3);
                for (const t4 of e3.children) n2(t4);
              }
            };
            for (const t4 of e2) for (const e3 of t4.removedNodes) n2(e3);
            return Array.from(t3);
          },
          on: (e2, t3, n2) => {
            if (!n2 && (n2 = t3, t3 = e2, e2 = null, !n2 && (n2 = t3, t3 = null, !n2)))
              throw new Error("$utils.mutation.on listener must be specified");
            if (e2 = e2 || document.documentElement, typeof (t3 = t3 || { childList: true, subtree: true }) == "string")
              t3 = { [t3]: true };
            else if (Array.isArray(t3)) {
              const e3 = {};
              t3.forEach((t4) => e3[t4] = true), t3 = e3;
            }
            const a2 = new MutationObserver(n2);
            return a2.observe(e2, t3), a2;
          },
          off: (e2) => {
            e2.disconnect();
          }
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.noThrow = (e2, t3 = null) => {
          if (!e2) return;
          let n2;
          try {
            n2 = e2();
          } catch {
            n2 = t3;
          }
          return n2 instanceof Promise ? new Promise(async (e3) => {
            try {
              n2 = await n2;
            } catch {
              n2 = t3;
            }
            e3(n2);
          }) : n2;
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.number = {
          minmax: (e2, n2, a2) => {
            if (!t2.is.number(e2))
              throw new Error("$utils.number.minmax expects a numeric value");
            return n2 !== null && e2 < n2 ? n2 : a2 !== null && e2 > a2 ? a2 : e2;
          },
          toShort: (e2, t3 = {}) => {
            const n2 = t3.format || "string", a2 = t3.maxInt || 1e3, o2 = n2 === "string" ? ({ sign: e3, value: t4, suffix: n3 }) => `${e3 || ""}${String(t4)}${n3 || ""}` : (e3) => e3;
            if (typeof e2 != "number")
              return o2({ sign: "", value: e2, suffix: "" });
            let i2 = "", r2 = "";
            if (e2 < 0 && (i2 = "-", e2 = -e2), e2 < 10)
              return o2({
                sign: i2,
                value: Number(Number.isInteger(e2) ? e2 : e2.toFixed(3)),
                suffix: r2
              });
            if (e2 < 100)
              return o2({
                sign: i2,
                value: Number(Number.isInteger(e2) ? e2 : e2.toFixed(2)),
                suffix: r2
              });
            if (e2 < 1e3)
              return o2({
                sign: i2,
                value: Number(Number.isInteger(e2) ? e2 : e2.toFixed(2)),
                suffix: r2
              });
            if (e2 < 1e4)
              return o2({
                sign: i2,
                value: Number(Number.isInteger(e2) ? e2 : e2.toFixed(1)),
                suffix: r2
              });
            const s2 = ["k", "m", "b", "t"];
            let l2 = null;
            for (let t4 = 0; t4 < s2.length; t4++) {
              if (e2 < a2) {
                l2 = e2;
                break;
              }
              e2 /= 1e3, r2 = s2[t4];
            }
            return l2 === null && (l2 = e2, e2 > 999) ? o2({ sign: i2, value: "999", suffix: "t+" }) : (l2 = Math.round(10 * l2) / 10, o2({ sign: i2, value: l2, suffix: r2 }));
          },
          format: (e2, t3 = ".") => Number.isInteger(e2) ? e2.toString().replace(/\B(?=(\d{3})+(?!\d))/g, t3) : String(e2)
        };
      })(), (() => {
        const { $utils: t2, $bus: n2 } = e;
        t2.objectUrl = {
          create(e2, a2 = false) {
            if (!URL.createObjectURL)
              return n2.send("utils.objectUrl.create", e2, a2);
            const o2 = URL.createObjectURL(e2);
            if (a2) {
              const e3 = t2.is.number(a2) ? a2 : 6e4;
              setTimeout(() => URL.revokeObjectURL(o2), e3);
            }
            return o2;
          },
          revoke(e2) {
            if (!URL.revokeObjectURL) return n2.send("utils.objectUrl.revoke", e2);
            URL.revokeObjectURL(e2);
          }
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.occurrences = {
          regex: (e2, n2) => (typeof n2 == "string" && (n2 = n2.split("\n")), (n2 = t2.ensureArray(n2)).length === 0 ? 0 : (n2 = n2.map((e3) => t2.string.toRegex(e3)).filter((e3) => !!e3)).reduce(
            (t3, n3) => t3 + (e2.match(n3) || []).length,
            0
          )),
          string(e2, t3, n2 = false) {
            if (t3.length <= 0) return e2.length + 1;
            let a2 = 0, o2 = 0, i2 = n2 ? 1 : t3.length;
            for (; o2 = e2.indexOf(t3, o2), o2 >= 0; ) ++a2, o2 += i2;
            return a2;
          }
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.pickRandom = (e2) => e2[Math.floor(Math.random() * e2.length)];
      })(), Array.prototype.toReversed && (Array.prototype.toReversed = function() {
        return [...this].reverse();
      }), Array.prototype.at || (Array.prototype.at = function(e2) {
        return this[e2 >= 0 ? e2 : this.length + e2];
      }), Array.prototype.findLastIndex || (Array.prototype.findLastIndex = function(e2, t2) {
        for (let n2 = this.length - 1; n2 >= 0; n2--)
          if (e2.call(t2, this[n2], n2, this)) return n2;
        return -1;
      }), (() => {
        const { $utils: t2 } = e;
        t2.raf = async (e2 = 1) => {
          e2 !== 0 && (await new Promise((e3) => requestAnimationFrame(e3)), await t2.raf(e2 - 1));
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.range = (e2, t3 = 0) => Array.from({ length: e2 }, (e3, n2) => n2 + t3);
      })(), (() => {
        const { $utils: t2 } = e;
        t2.removeKeys = (e2, n2 = null) => {
          if (!e2 || !t2.is.object(e2))
            throw new Error("$utils.removeKeys accepts non-null objects");
          return n2 = n2 || ((e3, n3) => t2.is.nil(n3)), Object.getOwnPropertyNames(e2).forEach((a2) => {
            const o2 = e2[a2];
            t2.is.object(o2) ? t2.removeKeys(e2[a2], n2) : n2(a2, o2) && delete e2[a2];
          }), e2;
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.selectFiles = async (e2 = "*") => await new Promise((t3) => {
          const n2 = document.createElement("input");
          n2.type = "file", n2.accept = e2, n2.multiple = true, n2.onchange = (e3) => t3([...e3.target.files]), n2.click();
        });
      })(), (() => {
        const { $utils: t2 } = e;
        t2.set = (e2, t3, n2, a2 = {}) => {
          const { flatten: o2, create: i2 } = { flatten: false, create: false, ...a2 }, r2 = (t3 || "").split(".");
          let s2 = e2;
          for (let e3 = 0; e3 < r2.length - 1; e3++) {
            let t4 = r2[e3];
            if (void 0 === s2) return false;
            if (s2 === null) return false;
            if (Array.isArray(s2) && (t4 = Number(t4), Number.isNaN(t4) || t4 < 0 || t4 >= s2.length))
              return false;
            i2 && !s2.hasOwnProperty(t4) && (s2[t4] = {}), s2 = s2[t4];
          }
          if (void 0 === s2) return false;
          if (s2 === null) return false;
          let l2 = r2.at(-1);
          if (Array.isArray(s2)) {
            if (l2 = Number(l2), Number.isNaN(l2) || l2 < 0 || l2 >= s2.length)
              return false;
            o2 ? (Array.isArray(n2) || (n2 = [n2]), s2.splice(l2, 1, ...n2)) : s2[l2] = n2;
          } else s2[l2] = n2;
          return true;
        };
      })(), (() => {
        const { $utils: t2 } = e, n2 = Symbol("running");
        t2.singleExecution = (e2, t3 = null) => async (...a2) => {
          if (!e2[n2]) {
            e2[n2] = true;
            try {
              return await e2.call(t3, ...a2);
            } catch (e3) {
              throw e3;
            } finally {
              delete e2[n2];
            }
          }
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.sleep = async (e2) => new Promise((t3) => {
          setTimeout(t3, e2);
        });
      })(), (() => {
        const { $utils: t2 } = e;
        t2.stringSimilarity = (e2, t3) => {
          if ((e2 = e2.replace(/\s+/g, "")) === (t3 = t3.replace(/\s+/g, "")))
            return 1;
          if (e2.length < 2 || t3.length < 2) return 0;
          let n2 = /* @__PURE__ */ new Map();
          for (let t4 = 0; t4 < e2.length - 1; t4++) {
            const a3 = e2.substring(t4, t4 + 2), o2 = n2.has(a3) ? n2.get(a3) + 1 : 1;
            n2.set(a3, o2);
          }
          let a2 = 0;
          for (let e3 = 0; e3 < t3.length - 1; e3++) {
            const o2 = t3.substring(e3, e3 + 2), i2 = n2.has(o2) ? n2.get(o2) : 0;
            i2 > 0 && (n2.set(o2, i2 - 1), a2++);
          }
          return 2 * a2 / (e2.length + t3.length - 2);
        };
      })(), (() => {
        const { $utils: t2 } = e, n2 = (e2, t3 = "-_", n3 = false) => {
          let a3 = String(e2);
          return n3 || (a3 = a3.replace(/(\p{Ll})(\p{Lu})/gu, "$1-$2")), a3.toLowerCase().replace(new RegExp(`[${t3}]+`, "g"), " ").trim().replaceAll(" ", "-");
        }, a2 = (e2) => {
          if (e2 == null) return e2;
          return (typeof e2 != "string" ? String(e2) : e2).length > 0 ? `${e2[0].toLowerCase()}${e2.substring(1)}` : "";
        }, o2 = (e2) => {
          if (e2 == null) return e2;
          return (typeof e2 != "string" ? String(e2) : e2).replace(
            /[-/\\^$*+?.()|[\]{}]/g,
            "\\$&"
          );
        };
        t2.string = {
          shorten: (e2, t3 = 40, n3 = "", a3 = "\u2026") => {
            if (e2 == null) return n3;
            const o3 = typeof e2 != "string" ? String(e2) : e2;
            return o3.length > t3 ? o3.slice(0, t3) + a3 : o3;
          },
          toSentenceCase: (e2) => {
            if (e2 == null) return e2;
            let t3 = typeof e2 != "string" ? String(e2) : e2;
            return t3 = t3.replace(
              /(^|[.!?]\s*)([a-z])/g,
              (e3, t4, n3) => t4 + n3.toUpperCase()
            ), t3;
          },
          toTitleCase: (e2) => {
            if (e2 == null) return e2;
            let t3 = typeof e2 != "string" ? String(e2) : e2;
            return t3 = t3.replace(/(^|\s)([a-z])/g, (e3, t4, n3) => t4 + n3.toUpperCase()), t3;
          },
          toPascalCase: (e2, t3 = " -_") => {
            if (e2 == null) return e2;
            t3 = o2(t3);
            const n3 = new RegExp(`[${t3}]+`, "g");
            let a3 = typeof e2 != "string" ? String(e2) : e2;
            return a3 = a3.split(n3).map((e3) => e3[0].toUpperCase() + e3.slice(1)).join(""), a3;
          },
          toCamelCase: (e2, t3 = " -_") => {
            if (e2 == null) return e2;
            t3 = o2(t3);
            const n3 = new RegExp(`[${t3}]+`, "g");
            let i2 = typeof e2 != "string" ? String(e2) : e2;
            return i2 = i2.split(n3).map((e3) => e3[0].toUpperCase() + e3.slice(1)).join(""), i2 = a2(i2), i2;
          },
          toKebabCase: n2,
          toSlugCase: (e2, { encode: t3 = true } = {}) => {
            let a3 = String(e2);
            return a3 = n2(a3.replaceAll(".", "")), t3 && (a3 = encodeURIComponent(a3)), a3;
          },
          toUnderscoreCase: (e2, t3 = "-_", n3 = false) => {
            let a3 = String(e2);
            return n3 || (a3 = a3.replace(/(\p{Ll})(\p{Lu})/gu, "$1-$2")), a3.toLowerCase().replace(new RegExp(`[${t3}]+`, "g"), " ").trim().replaceAll(" ", "_");
          },
          toCapitalFirst: (e2) => {
            if (e2 == null) return e2;
            return (typeof e2 != "string" ? String(e2) : e2).length > 0 ? `${e2[0].toUpperCase()}${e2.substring(1)}` : "";
          },
          toLowerFirst: a2,
          containsInMiddle: (e2, t3) => {
            const n3 = e2.indexOf(t3);
            return -1 !== n3 && n3 !== 0 && n3 !== e2.length - t3.length;
          },
          escapeRegExp: o2,
          toRegex: (e2, t3 = "gi") => {
            if (e2 == null) return e2;
            if (e2 instanceof RegExp) return e2;
            if (typeof e2 != "string" || e2.length === 0) return null;
            if (e2.startsWith("/") && -1 !== e2.indexOf("/", 2))
              try {
                const t4 = e2.replace(/.*\/([gimy]*)$/, "$1"), n3 = e2.replace(new RegExp("^/(.*?)/" + t4 + "$"), "$1");
                return RegExp(n3, t4);
              } catch (e3) {
              }
            return e2 = o2(e2), new RegExp(e2, t3);
          },
          incrementNumberSuffix: (e2) => {
            if (e2 == null) return e2;
            const t3 = typeof e2 != "string" ? String(e2) : e2;
            let n3 = t3.match(/ #(\d+)$/) || t3.match(/ (\d+)$/);
            if (!n3) return `${t3} #2`;
            const a3 = Number(n3[1]) || 1, o3 = n3[0].includes("#") ? "#" : "";
            return `${t3.slice(0, n3.index)} ${o3}${a3 + 1}`;
          },
          empty: (e2) => e2.trim().length === 0,
          rotate: (e2, t3 = 1) => {
            const n3 = e2.length;
            return t3 > 0 ? e2.substring(t3, n3) + e2.substring(0, t3) : e2.substring(n3 + t3, n3) + e2.substring(0, n3 + t3);
          },
          abbreviationCheck: (e2, t3, n3 = 30) => {
            e2 = e2.toLowerCase().substring(0, n3);
            const a3 = (t3 = t3.toLowerCase()).split(" "), o3 = e2.split(" ");
            e: {
              for (const e3 of o3) if (!a3.find((t4) => t4.startsWith(e3))) break e;
              return true;
            }
            e2 = e2.replaceAll(" ", "");
            let i2 = 0;
            for (const t4 of a3)
              for (const n4 of t4) {
                if (e2[i2] !== n4) break;
                if (i2++, i2 >= e2.length) return true;
              }
            return i2 >= e2.length;
          },
          random: (e2 = 50) => {
            const t3 = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
            let n3 = "";
            for (let a3 = 0; a3 < e2; a3++)
              n3 += t3[Math.floor(Math.random() * t3.length)];
            return n3;
          }
        };
      })(), (() => {
        const { $utils: t2 } = e, n2 = Symbol("original-styles");
        t2.style = {
          override(e2, t3, a2) {
            e2[n2] ??= [], e2[n2].push({
              key: t3,
              value: e2.style.getPropertyValue(t3),
              priority: e2.style.getPropertyPriority(t3)
            }), e2.style.setProperty(t3, a2, "important");
          },
          reset(e2) {
            (e2[n2] || []).forEach(
              (t3) => e2.style.setProperty(t3.key, t3.value, t3.priority)
            ), delete e2[n2];
          }
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.sum = (e2) => {
          let t3 = 0;
          return e2.forEach((e3) => t3 += e3), t3;
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.systemTheme = {
          get value() {
            return window?.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches ? "night" : "day";
          },
          onChange(e2, t3 = false) {
            window?.matchMedia && (window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change", () => {
              e2(this.value);
            }), t3 && e2(this.value));
          }
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.TempMap = class {
          constructor(e2 = t2.time.MINUTE) {
            this._timeout = e2, this._map = /* @__PURE__ */ new Map(), this._usages = /* @__PURE__ */ new Map(), this._setupCleanup();
          }
          get(e2) {
            if (this._map.has(e2)) return this._updateUsage(e2), this._map.get(e2);
          }
          has(e2) {
            return !!this._map.has(e2) && (this._updateUsage(e2), true);
          }
          set(e2, t3) {
            this._updateUsage(e2), this._map.set(e2, t3);
          }
          delete(e2) {
            this._map.delete(e2), this._usages.delete(e2);
          }
          _updateUsage(e2) {
            this._usages.set(e2, Date.now());
          }
          _setupCleanup() {
            t2.chrome.alarms.run(() => this._cleanup(), {
              periodInMinutes: this._timeout / t2.time.MINUTE
            });
          }
          _cleanup() {
            const e2 = Date.now();
            for (const t3 of this._usages) {
              const [n2, a2] = t3;
              e2 - a2 < this._timeout || this.delete(n2);
            }
          }
        };
      })(), (() => {
        const { $utils: t2 } = e, n2 = 36e5, a2 = 864e5, o2 = 31536e6, i2 = [
          "Jan",
          "Feb",
          "Mar",
          "Apr",
          "May",
          "Jun",
          "Jul",
          "Aug",
          "Sep",
          "Oct",
          "Nov",
          "Dec"
        ], r2 = (e2) => {
          if (!e2) return null;
          if (typeof e2 == "string") return "string";
          const t3 = /* @__PURE__ */ new Date();
          if (e2 > t3.getTime()) {
            if (t3.setHours(0, 0, 0, 0), e2 <= t3.getTime() + a2) return "today";
            if (e2 <= t3.getTime() + 1728e5) return "tomorrow";
            if (t3.setHours(23, 59, 59, 999), t3.setMonth(11, 31), e2 <= t3)
              return "year";
          } else {
            if (t3.setHours(0, 0, 0, 0), e2 >= t3.getTime()) return "today";
            if (e2 >= t3.getTime() - a2) return "yesterday";
            if (t3.setMonth(0, 1), e2 >= t3.getTime()) return "year";
          }
          return "other";
        };
        t2.time = {
          SECOND: 1e3,
          MINUTE: 6e4,
          HOUR: 36e5,
          DAY: 864e5,
          WEEK: 6048e5,
          MONTH: 26784e5,
          YEAR: 31536e6,
          MILLENNIUM: 31536e9,
          months: i2,
          fullMonths: [
            "January",
            "February",
            "March",
            "April",
            "May",
            "June",
            "July",
            "August",
            "September",
            "October",
            "November",
            "December"
          ],
          relativeDateType: r2,
          formatTime: (e2, t3) => (t3 = t3 || { hour12: false, timeZone: "UTC" }, (e2 = (e2 = e2 || /* @__PURE__ */ new Date()) instanceof Date ? e2 : new Date(e2)).toLocaleTimeString("en-UK", t3)),
          formatDate: (e2, t3) => e2 ? (e2 = e2 instanceof Date ? e2 : new Date(e2), t3 = {
            day: "numeric",
            month: "short",
            year: "numeric",
            hour12: false,
            ...t3
          }, e2.getUTCHours() === 0 && e2.getUTCMinutes() === 0 && e2.getUTCSeconds() === 0 ? e2.toLocaleDateString("en-UK", t3) : e2.toLocaleTimeString("en-UK", t3)) : null,
          formatRelativeDate: (e2, t3 = false) => {
            if (!e2) return null;
            const n3 = r2(e2);
            if (n3 === "string") return e2;
            function a3(e3) {
              return e3 < 10 ? `0${e3}` : e3;
            }
            const o3 = new Date(e2), s2 = (!t3 || o3.getHours() !== 0 || o3.getMinutes() !== 0) && `${a3(o3.getHours())}:${a3(o3.getMinutes())}`;
            if (n3 === "tomorrow") return s2 ? `Tomorrow ${s2}` : "Tomorrow";
            if (n3 === "today") return s2 ? `${s2}, Today` : "Today";
            if (n3 === "yesterday") return s2 ? `Yesterday ${s2}` : "Yesterday";
            const l2 = o3.getDate(), c2 = i2[o3.getMonth()];
            if (n3 === "year") return s2 ? `${l2} ${c2} ${s2}` : `${l2} ${c2}`;
            const u2 = o3.getFullYear();
            return n3 === "other" ? s2 ? `${l2} ${c2} ${u2}, ${s2}` : `${l2} ${c2} ${u2}` : e2;
          },
          formatDuration: (e2) => {
            if (e2 === 0) return "0s";
            const t3 = Math.abs(e2 / 1e3);
            let n3 = 1e3 * t3 % 1e3;
            n3 = n3 && `${n3}ms`;
            let a3 = Math.floor(t3 % 60);
            a3 = a3 && `${a3}s`;
            let o3 = Math.floor(t3 / 60) % 60;
            o3 = o3 && `${o3}m`;
            let i3 = Math.floor(t3 / 3600) % 24;
            i3 = i3 && `${i3}h`;
            let r3 = Math.floor(t3 / 86400);
            return r3 = r3 && `${r3}d`, [r3, i3, o3, a3, n3].filter((e3) => Boolean(e3)).join(" ");
          },
          frequencyToMs: (e2) => {
            const n3 = {
              s: t2.time.SECOND,
              m: t2.time.MINUTE,
              h: t2.time.HOUR,
              d: t2.time.DAY,
              w: t2.time.WEEK,
              mo: t2.time.MONTH
            }, a3 = parseInt(e2.match(/\d+/));
            if (!a3) return 0;
            const o3 = n3[e2.match(/\D+/)] || 0;
            return o3 && a3 * o3 || 0;
          },
          startOfDayGmt0: () => new Date((/* @__PURE__ */ new Date()).setUTCHours(0, 0, 0, 0)),
          since: (e2) => Date.now() - Number(e2)
        };
      })(), (() => {
        const { createVNode: t2 } = e.$inferno, { $utils: n2 } = e;
        n2.toElement = (e2) => {
          if (!n2.is.string(e2)) return e2;
          if (!e2.includes("<b>")) return e2;
          let a2, o2, i2 = [];
          for (; e2 && -1 !== (a2 = e2.indexOf("<b>")); )
            o2 = e2.indexOf("</b>", a2), i2.push(e2.substring(0, a2)), i2.push(t2(1, "b", null, e2.substring(a2 + 3, o2), 0)), e2 = e2.substring(o2 + 4);
          return i2.push(e2), i2 = i2.filter((e3) => !n2.is.string(e3) || e3.length > 0), i2.length === 0 ? null : t2(1, "span", null, i2, 0);
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.toSafeHtml = (e2) => e2.replaceAll("&", "&amp;").replaceAll('"', "&quot;").replaceAll("'", "&#39").replaceAll("<", "&lt;").replaceAll(">", "&gt;");
      })(), (() => {
        const { $utils: t2 } = e;
        t2.unique = (e2) => Array.from(new Set(e2));
      })(), (() => {
        const { $utils: t2 } = e, n2 = "aaa,aarp,abarth,abb,abbott,abbvie,abc,able,abogado,abudhabi,ac,academy,accenture,accountant,accountants,aco,active,actor,ad,adac,ads,adult,ae,aeg,aero,aetna,af,afamilycompany,afl,africa,ag,agakhan,agency,ai,aig,aigo,airbus,airforce,airtel,akdn,al,alfaromeo,alibaba,alipay,allfinanz,allstate,ally,alsace,alstom,am,americanexpress,americanfamily,amex,amfam,amica,amsterdam,an,analytics,android,anquan,anz,ao,aol,apartments,app,apple,aq,aquarelle,ar,arab,aramco,archi,army,arpa,art,arte,as,asda,asia,associates,at,athleta,attorney,au,auction,audi,audible,audio,auspost,author,auto,autos,avianca,aw,aws,ax,axa,az,azure,ba,baby,baidu,banamex,bananarepublic,band,bank,bar,barcelona,barclaycard,barclays,barefoot,bargains,baseball,basketball,bauhaus,bayern,bb,bbc,bbt,bbva,bcg,bcn,bd,be,beats,beauty,beer,bentley,berlin,best,bestbuy,bet,bf,bg,bh,bharti,bi,bible,bid,bike,bing,bingo,bio,biz,bj,bl,black,blackfriday,blanco,blockbuster,blog,bloomberg,blue,bm,bms,bmw,bn,bnl,bnpparibas,bo,boats,boehringer,bofa,bom,bond,boo,book,booking,boots,bosch,bostik,boston,bot,boutique,box,bq,br,bradesco,bridgestone,broadway,broker,brother,brussels,bs,bt,budapest,bugatti,build,builders,business,buy,buzz,bv,bw,by,bz,bzh,ca,cab,cafe,cal,call,calvinklein,cam,camera,camp,cancerresearch,canon,capetown,capital,capitalone,car,caravan,cards,care,career,careers,cars,cartier,casa,case,caseih,cash,casino,cat,catering,catholic,cba,cbn,cbre,cbs,cc,cd,ceb,center,ceo,cern,cf,cfa,cfd,cg,ch,chanel,channel,charity,chase,chat,cheap,chintai,chloe,christmas,chrome,chrysler,church,ci,cipriani,circle,cisco,citadel,citi,citic,city,cityeats,ck,cl,claims,cleaning,click,clinic,clinique,clothing,cloud,club,clubmed,cm,cn,co,coach,codes,coffee,college,cologne,com,comcast,commbank,community,company,compare,computer,comsec,condos,construction,consulting,contact,contractors,cooking,cookingchannel,cool,coop,corsica,country,coupon,coupons,courses,cr,credit,creditcard,creditunion,cricket,crown,crs,cruise,cruises,csc,cu,cuisinella,cv,cw,cx,cy,cymru,cyou,cz,dabur,dad,dance,data,date,dating,datsun,day,dclk,dds,de,deal,dealer,deals,degree,delivery,dell,deloitte,delta,democrat,dental,dentist,desi,design,dev,dhl,diamonds,diet,digital,direct,directory,discount,discover,dish,diy,dj,dk,dm,dnp,do,docs,doctor,dodge,dog,doha,domains,doosan,dot,download,drive,dtv,dubai,duck,dunlop,duns,dupont,durban,dvag,dvr,dz,earth,eat,ec,eco,edeka,edu,education,ee,eg,eh,email,emerck,energy,engineer,engineering,enterprises,epost,epson,equipment,er,ericsson,erni,es,esq,estate,esurance,et,etisalat,eu,eurovision,eus,events,everbank,exchange,expert,exposed,express,extraspace,fage,fail,fairwinds,faith,family,fan,fans,farm,farmers,fashion,fast,fedex,feedback,ferrari,ferrero,fi,fiat,fidelity,fido,film,final,finance,financial,fire,firestone,firmdale,fish,fishing,fit,fitness,fj,fk,flickr,flights,flir,florist,flowers,flsmidth,fly,fm,fo,foo,food,foodnetwork,football,ford,forex,forsale,forum,foundation,fox,fr,free,fresenius,frl,frogans,frontdoor,frontier,ftr,fujitsu,fujixerox,fun,fund,furniture,futbol,fyi,ga,gal,gallery,gallo,gallup,game,games,gap,garden,gb,gbiz,gd,gdn,ge,gea,gent,genting,george,gf,gg,ggee,gh,gi,gift,gifts,gives,giving,gl,glade,glass,gle,global,globo,gm,gmail,gmbh,gmo,gmx,gn,godaddy,gold,goldpoint,golf,goo,goodhands,goodyear,goog,google,gop,got,gov,gp,gq,gr,grainger,graphics,gratis,green,gripe,grocery,group,gs,gt,gu,guardian,gucci,guge,guide,guitars,guru,gw,gy,hair,hamburg,hangout,haus,hbo,hdfc,hdfcbank,health,healthcare,help,helsinki,here,hermes,hgtv,hiphop,hisamitsu,hitachi,hiv,hk,hkt,hm,hn,hockey,holdings,holiday,homedepot,homegoods,homes,homesense,honda,honeywell,horse,hospital,host,hosting,hot,hoteles,hotels,hotmail,house,how,hr,hsbc,ht,htc,hu,hughes,hyatt,hyundai,inc,ibm,icbc,ice,icu,id,ie,ieee,ifm,iinet,ikano,il,im,imamat,imdb,immo,immobilien,in,industries,infiniti,info,ing,ink,institute,insurance,insure,int,intel,international,intuit,investments,io,ipiranga,iq,ir,irish,is,iselect,ismaili,ist,istanbul,it,itau,itv,iveco,iwc,jaguar,java,jcb,jcp,je,jeep,jetzt,jewelry,jio,jlc,jll,jm,jmp,jnj,jo,jobs,joburg,jot,joy,jp,jpmorgan,jprs,juegos,juniper,kaufen,kddi,ke,kerryhotels,kerrylogistics,kerryproperties,kfh,kg,kh,ki,kia,kim,kinder,kindle,kitchen,kiwi,km,kn,koeln,komatsu,kosher,kp,kpmg,kpn,kr,krd,kred,kuokgroup,kw,ky,kyoto,kz,la,lacaixa,ladbrokes,lamborghini,lamer,lancaster,lancia,lancome,land,landrover,lanxess,lasalle,lat,latino,latrobe,law,lawyer,lb,lc,lds,lease,leclerc,lefrak,legal,lego,lexus,lgbt,li,liaison,lidl,life,lifeinsurance,lifestyle,lighting,like,lilly,limited,limo,lincoln,linde,link,lipsy,live,living,lixil,lk,llc,loan,loans,locker,locus,loft,lol,london,lotte,lotto,love,lpl,lplfinancial,lr,ls,lt,ltd,ltda,lu,lundbeck,lupin,luxe,luxury,lv,ly,ma,macys,madrid,maif,maison,makeup,man,management,mango,map,market,marketing,markets,marriott,marshalls,maserati,mattel,mba,mc,mcd,mcdonalds,mckinsey,md,me,med,media,meet,melbourne,meme,memorial,men,menu,meo,merckmsd,metlife,mf,mg,mh,miami,microsoft,mil,mini,mint,mit,mitsubishi,mk,ml,mlb,mls,mm,mma,mn,mo,mobi,mobile,mobily,moda,moe,moi,mom,monash,money,monster,montblanc,mopar,mormon,mortgage,moscow,moto,motorcycles,mov,movie,movistar,mp,mq,mr,ms,msd,mt,mtn,mtpc,mtr,mu,museum,mutual,mutuelle,mv,mw,mx,my,mz,na,nab,nadex,nagoya,name,nationwide,natura,navy,nba,nc,ne,nec,net,netbank,netflix,network,neustar,new,newholland,news,next,nextdirect,nexus,nf,nfl,ng,ngo,nhk,ni,nico,nike,nikon,ninja,nissan,nissay,nl,no,nokia,northwesternmutual,norton,now,nowruz,nowtv,np,nr,nra,nrw,ntt,nu,nyc,nz,obi,observer,off,office,okinawa,olayan,olayangroup,oldnavy,ollo,om,omega,one,ong,onl,online,onyourside,ooo,open,oracle,orange,org,organic,orientexpress,origins,osaka,otsuka,ott,ovh,pa,page,pamperedchef,panasonic,panerai,paris,pars,partners,parts,party,passagens,pay,pccw,pe,pet,pf,pfizer,pg,ph,pharmacy,phd,philips,phone,photo,photography,photos,physio,piaget,pics,pictet,pictures,pid,pin,ping,pink,pioneer,pizza,pk,pl,place,play,playstation,plumbing,plus,pm,pn,pnc,pohl,poker,politie,porn,post,pr,pramerica,praxi,press,prime,pro,prod,productions,prof,progressive,promo,properties,property,protection,pru,prudential,ps,pt,pub,pw,pwc,py,qa,qpon,quebec,quest,qvc,racing,radio,raid,re,read,realestate,realtor,realty,recipes,red,redstone,redumbrella,rehab,reise,reisen,reit,reliance,ren,rent,rentals,repair,report,republican,rest,restaurant,review,reviews,rexroth,rich,richardli,ricoh,rightathome,ril,rio,rip,rmit,ro,rocher,rocks,rodeo,rogers,room,rs,rsvp,ru,rugby,ruhr,run,rw,rwe,ryukyu,sa,saarland,safe,safety,sakura,sale,salon,samsclub,samsung,sandvik,sandvikcoromant,sanofi,sap,sapo,sarl,sas,save,saxo,sb,sbi,sbs,sc,sca,scb,schaeffler,schmidt,scholarships,school,schule,schwarz,science,scjohnson,scor,scot,sd,se,search,seat,secure,security,seek,select,sener,services,ses,seven,sew,sex,sexy,sfr,sg,sh,shangrila,sharp,shaw,shell,shia,shiksha,shoes,shop,shopping,shouji,show,showtime,shriram,si,silk,sina,singles,site,sj,sk,ski,skin,sky,skype,sl,sling,sm,smart,smile,sn,sncf,so,soccer,social,softbank,software,sohu,solar,solutions,song,sony,soy,space,spiegel,sport,spot,spreadbetting,sr,srl,srt,ss,st,stada,staples,star,starhub,statebank,statefarm,statoil,stc,stcgroup,stockholm,storage,store,stream,studio,study,style,su,sucks,supplies,supply,support,surf,surgery,suzuki,sv,swatch,swiftcover,swiss,sx,sy,sydney,symantec,systems,sz,tab,taipei,talk,taobao,target,tatamotors,tatar,tattoo,tax,taxi,tc,tci,td,tdk,team,tech,technology,tel,telecity,telefonica,temasek,tennis,teva,tf,tg,th,thd,theater,theatre,tiaa,tickets,tienda,tiffany,tips,tires,tirol,tj,tjmaxx,tjx,tk,tkmaxx,tl,tm,tmall,tn,to,today,tokyo,tools,top,toray,toshiba,total,tours,town,toyota,toys,tp,tr,trade,trading,training,travel,travelchannel,travelers,travelersinsurance,trust,trv,tt,tube,tui,tunes,tushu,tv,tvs,tw,tz,ua,ubank,ubs,uconnect,ug,uk,um,unicom,university,uno,uol,ups,us,uy,uz,va,vacations,vana,vanguard,vc,ve,vegas,ventures,verisign,versicherung,vet,vg,vi,viajes,video,vig,viking,villas,vin,vip,virgin,visa,vision,vista,vistaprint,viva,vivo,vlaanderen,vn,vodka,volkswagen,volvo,vote,voting,voto,voyage,vu,vuelos,wales,walmart,walter,wang,wanggou,warman,watch,watches,weather,weatherchannel,webcam,weber,website,wed,wedding,weibo,weir,wf,whoswho,wien,wiki,williamhill,win,windows,wine,winners,wme,wolterskluwer,woodside,work,works,world,wow,ws,wtc,wtf,xbox,xerox,xfinity,xihuan,xin,\u6D4B\u8BD5,\u0915\u0949\u092E,\u092A\u0930\u0940\u0915\u094D\u0937\u093E,\u30BB\u30FC\u30EB,\u4F5B\u5C71,\u0CAD\u0CBE\u0CB0\u0CA4,\u6148\u5584,\u96C6\u56E2,\u5728\u7EBF,\uD55C\uAD6D,\u0B2D\u0B3E\u0B30\u0B24,\u5927\u4F17\u6C7D\u8F66,\u70B9\u770B,\u0E04\u0E2D\u0E21,\u09AD\u09BE\u09F0\u09A4,\u09AD\u09BE\u09B0\u09A4,\u516B\u5366,\u0645\u0648\u0642\u0639,\u09AC\u09BE\u0982\u09B2\u09BE,\u516C\u76CA,\u516C\u53F8,\u9999\u683C\u91CC\u62C9,\u7F51\u7AD9,\u79FB\u52A8,\u6211\u7231\u4F60,\u043C\u043E\u0441\u043A\u0432\u0430,\u0438\u0441\u043F\u044B\u0442\u0430\u043D\u0438\u0435,\u049B\u0430\u0437,\u043A\u0430\u0442\u043E\u043B\u0438\u043A,\u043E\u043D\u043B\u0430\u0439\u043D,\u0441\u0430\u0439\u0442,\u8054\u901A,\u0441\u0440\u0431,\u0431\u0433,\u0431\u0435\u043B,\u05E7\u05D5\u05DD,\u65F6\u5C1A,\u5FAE\u535A,\uD14C\uC2A4\uD2B8,\u6DE1\u9A6C\u9521,\u30D5\u30A1\u30C3\u30B7\u30E7\u30F3,\u043E\u0440\u0433,\u0928\u0947\u091F,\u30B9\u30C8\u30A2,\uC0BC\uC131,\u0B9A\u0BBF\u0B99\u0BCD\u0B95\u0BAA\u0BCD\u0BAA\u0BC2\u0BB0\u0BCD,\u5546\u6807,\u5546\u5E97,\u5546\u57CE,\u0434\u0435\u0442\u0438,\u043C\u043A\u0434,\u05D8\u05E2\u05E1\u05D8,\u0435\u044E,\u30DD\u30A4\u30F3\u30C8,\u65B0\u95FB,\u5DE5\u884C,\u5BB6\u96FB,\u0643\u0648\u0645,\u4E2D\u6587\u7F51,\u4E2D\u4FE1,\u4E2D\u56FD,\u4E2D\u570B,\u5A31\u4E50,\u8C37\u6B4C,\u0C2D\u0C3E\u0C30\u0C24\u0C4D,\u0DBD\u0D82\u0D9A\u0DCF,\u96FB\u8A0A\u76C8\u79D1,\u8D2D\u7269,\u6E2C\u8A66,\u30AF\u30E9\u30A6\u30C9,\u0AAD\u0ABE\u0AB0\u0AA4,\u901A\u8CA9,\u092D\u093E\u0930\u0924\u092E\u094D,\u092D\u093E\u0930\u0924,\u092D\u093E\u0930\u094B\u0924,\u0622\u0632\u0645\u0627\u06CC\u0634\u06CC,\u0BAA\u0BB0\u0BBF\u0B9F\u0BCD\u0B9A\u0BC8,\u7F51\u5E97,\u0938\u0902\u0917\u0920\u0928,\u9910\u5385,\u7F51\u7EDC,\u043A\u043E\u043C,\u0443\u043A\u0440,\u9999\u6E2F,\u8BFA\u57FA\u4E9A,\u98DF\u54C1,\u03B4\u03BF\u03BA\u03B9\u03BC\u03AE,\u98DE\u5229\u6D66,\u0625\u062E\u062A\u0628\u0627\u0631,\u53F0\u6E7E,\u53F0\u7063,\u624B\u8868,\u624B\u673A,\u043C\u043E\u043D,\u0627\u0644\u062C\u0632\u0627\u0626\u0631,\u0639\u0645\u0627\u0646,\u0627\u0631\u0627\u0645\u0643\u0648,\u0627\u06CC\u0631\u0627\u0646,\u0627\u0644\u0639\u0644\u064A\u0627\u0646,\u0627\u062A\u0635\u0627\u0644\u0627\u062A,\u0627\u0645\u0627\u0631\u0627\u062A,\u0628\u0627\u0632\u0627\u0631,\u0645\u0648\u0631\u064A\u062A\u0627\u0646\u064A\u0627,\u067E\u0627\u06A9\u0633\u062A\u0627\u0646,\u0627\u0644\u0627\u0631\u062F\u0646,\u0645\u0648\u0628\u0627\u064A\u0644\u064A,\u0628\u0627\u0631\u062A,\u0628\u06BE\u0627\u0631\u062A,\u0627\u0644\u0645\u063A\u0631\u0628,\u0627\u0628\u0648\u0638\u0628\u064A,\u0627\u0644\u0633\u0639\u0648\u062F\u064A\u0629,\u0680\u0627\u0631\u062A,\u0643\u0627\u062B\u0648\u0644\u064A\u0643,\u0633\u0648\u062F\u0627\u0646,\u0647\u0645\u0631\u0627\u0647,\u0639\u0631\u0627\u0642,\u0645\u0644\u064A\u0633\u064A\u0627,\u6FB3\u9580,\uB2F7\uCEF4,\u653F\u5E9C,\u0634\u0628\u0643\u0629,\u0628\u064A\u062A\u0643,\u0639\u0631\u0628,\u10D2\u10D4,\u673A\u6784,\u7EC4\u7EC7\u673A\u6784,\u5065\u5EB7,\u0E44\u0E17\u0E22,\u0633\u0648\u0631\u064A\u0629,\u62DB\u8058,\u0440\u0443\u0441,\u0440\u0444,\u73E0\u5B9D,\u062A\u0648\u0646\u0633,\u5927\u62FF,\u307F\u3093\u306A,\u30B0\u30FC\u30B0\u30EB,\u03B5\u03BB,\u4E16\u754C,\u66F8\u7C4D,\u0D2D\u0D3E\u0D30\u0D24\u0D02,\u0A2D\u0A3E\u0A30\u0A24,\u7F51\u5740,\uB2F7\uB137,\u30B3\u30E0,\u5929\u4E3B\u6559,\u6E38\u620F,verm\xF6gensberater,verm\xF6gensberatung,\u4F01\u4E1A,\u4FE1\u606F,\u5609\u91CC\u5927\u9152\u5E97,\u5609\u91CC,\u0645\u0635\u0631,\u0642\u0637\u0631,\u5E7F\u4E1C,\u0B87\u0BB2\u0B99\u0BCD\u0B95\u0BC8,\u0B87\u0BA8\u0BCD\u0BA4\u0BBF\u0BAF\u0BBE,\u0570\u0561\u0575,\u65B0\u52A0\u5761,\u0641\u0644\u0633\u0637\u064A\u0646,\u30C6\u30B9\u30C8,\u653F\u52A1,xperia,xxx,xyz,yachts,yahoo,yamaxun,yandex,ye,yodobashi,yoga,yokohama,you,youtube,yt,yun,za,zappos,zara,zero,zip,zippo,zm,zone,zuerich,zw";
        t2.url = {
          URL_PROTOCOLS: [
            "http://",
            "https://",
            "mailto:",
            "tel:",
            "ftp://",
            "data:",
            "ws://",
            "wss://",
            "file://",
            "git://",
            "git+https://",
            "git+http://",
            "git+ssh://",
            "ssh://",
            "sftp://",
            "ftps://",
            "svn://",
            "chrome-extension://"
          ],
          smartEncode: (e2) => t2.url.URL_PROTOCOLS.some((t3) => e2.startsWith(t3)) ? encodeURI(e2) : encodeURIComponent(e2),
          smartDecode: (e2) => t2.url.URL_PROTOCOLS.some((t3) => e2.startsWith(t3)) ? decodeURI(e2) : decodeURIComponent(e2),
          get tlds() {
            return this._tlds || (this._tlds = n2.split(",")), this._tlds;
          },
          ext(e2, t3 = {}) {
            e2.startsWith("/") && (e2 = e2.slice(1));
            const n3 = chrome.runtime.getURL("/");
            return this.create(n3 + e2, t3);
          },
          create(e2, n3 = {}) {
            const a2 = this.parse(e2);
            if (!a2) return null;
            const o2 = [];
            Object.entries(n3).forEach(([e3, n4]) => {
              if (t2.is.nil(n4)) return null;
              true === n4 ? o2.push(e3) : ((t2.is.object(n4) || t2.is.array(n4)) && (n4 = JSON.stringify(n4)), e3 = this.toSafeSearchPart(e3), n4 = this.toSafeSearchPart(n4), o2.push(`${e3}=${n4}`));
            });
            const i2 = o2.join("&");
            return this.build({
              protocol: a2.protocol,
              domain: a2.domain,
              port: a2.port,
              path: a2.path,
              search: a2.search ? a2.search + (i2 ? `&${i2}` : "") : i2,
              hash: a2.hash
            });
          },
          check(e2) {
            return !!this.parse(e2);
          },
          getDomain(e2, t3 = {}) {
            const {
              canonical: n3,
              noTld: a2,
              anyTld: o2,
              keepWww: i2
            } = { canonical: false, noTld: false, anyTld: false, keepWww: false, ...t3 }, r2 = this.parse(e2, { anyTld: o2 });
            if (!r2) return null;
            let s2 = i2 ? r2.domain : r2.domain.replace(/^www\./, "");
            if (!a2 && !n3) return s2;
            let l2 = s2.split("."), c2 = l2.length;
            for (; c2 > 1 && !(l2[c2 - 1].length > 3); c2--) ;
            return a2 && (l2 = l2.slice(0, Math.max(0, c2))), n3 && (l2 = l2.slice(c2 - 1)), l2.join(".");
          },
          parse(e2, n3 = {}) {
            const { defaultProtocol: a2, anyTld: o2 } = {
              defaultProtocol: "https",
              anyTld: false,
              ...n3
            };
            if (!e2) return null;
            let i2, r2, s2, l2, c2, u2;
            if (e2.startsWith("//") && (e2 = `${a2}:${e2}`), t2.string.containsInMiddle(e2, ":/")) {
              const t3 = e2.split(":/");
              i2 = t3[0], e2 = t3.slice(1).join(":/").replace(/^\/*/, "");
            }
            {
              const t3 = /^([^/?]+)(\/?\??.*)?$/, n4 = e2.match(t3);
              if (!n4) return null;
              let a3;
              a3 = (n4[1] || "").split(":"), r2 = a3[0], s2 = a3[1] || "", a3 = (n4[2] || "").split("?"), l2 = a3[0] || "/", a3 = (a3[1] || "").split("#"), c2 = a3[0], u2 = a3[1] || "";
            }
            {
              const e3 = t2.string.containsInMiddle(r2, ".");
              if (/[!#$%^&*()-+=,/'";~` ]/.test(r2)) return null;
              if (!e3 && !i2 && !s2) return null;
              if (!e3 && /^\d+$/.test(r2)) return null;
            }
            {
              const e3 = r2.split(".");
              if (e3.length > 1 && e3.some((e4) => !/^\d+$/.test(e4))) {
                const t3 = e3.at(-1);
                if (t3.includes(",")) return null;
                if (!o2 && !this.tlds.includes(t3)) return null;
              }
            }
            i2 || (i2 = a2);
            const p2 = this.build({
              protocol: i2,
              domain: r2,
              port: s2,
              path: l2,
              search: c2,
              hash: u2
            });
            try {
              new URL(p2);
            } catch {
              return null;
            }
            return {
              href: p2,
              protocol: i2,
              domain: r2,
              port: s2,
              path: l2,
              search: c2,
              hash: u2
            };
          },
          build: ({
            protocol: e2,
            domain: t3,
            port: n3 = "",
            path: a2 = "/",
            search: o2 = "",
            hash: i2 = ""
          }) => e2 + "://" + t3 + (n3 ? `:${n3}` : "") + a2 + (o2 ? `?${o2}` : "") + (i2 ? `#${i2}` : ""),
          dropProtocol(e2) {
            return this.check(e2) && e2.includes(":") ? e2.split(":").slice(1).join(":").replace(/^\/*/, "") : e2;
          },
          dropTrailingSlash(e2) {
            return this.check(e2) ? e2.includes("?") || e2.includes("#") ? e2 : e2.endsWith("/") ? e2.slice(0, -1) : e2 : e2;
          },
          toSafeSearchPart: (e2) => String(e2).replaceAll("?", "%3F").replaceAll("=", "%3D").replaceAll("&", "%26").replaceAll("+", "%2B").replaceAll(" ", "%20").replaceAll("#", "%23").replaceAll("{", "%7B").replaceAll("}", "%7D").replaceAll("\n", "%0A").replaceAll("`", "%60"),
          hostname(e2) {
            if (e2 instanceof URL) return e2.hostname;
            try {
              return new URL(e2).hostname;
            } catch (e3) {
              return null;
            }
          }
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.versionNumber = (e2) => {
          e2 = e2 || "0.0.0";
          const [t3, n2, a2] = e2.split(".");
          return 1e6 * (Number(t3) || 0) + 1e3 * (Number(n2) || 0) + (Number(a2) || 0);
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.waitFor = async (e2, { interval: n2 = 100, timeout: a2 = 6e4 } = {}) => {
          if (a2 <= 0) throw new Error("$utils.waitFor: timeout exceeded");
          const o2 = Date.now(), i2 = await e2();
          if (i2) return i2;
          await t2.sleep(n2);
          const r2 = Date.now() - o2;
          return t2.waitFor(e2, { interval: n2, timeout: a2 - r2 });
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.walkObject = async (e2, t3, a2 = {}) => {
          if (!(a2 = { skipRoot: false, onUndefined: "ignore", ...a2 }).skipRoot) {
            const n3 = await t3(e2, null, "");
            if (void 0 === n3) {
              if (a2.onUndefined === "apply") return;
              if (a2.onUndefined === "delete") return;
            } else e2 = n3;
          }
          return await n2(e2, t3, null, "", a2), e2;
        };
        const n2 = async (e2, a2, o2, i2, r2) => {
          if (t2.is.array(e2))
            for (let t3 = 0; t3 < e2.length; t3++) {
              const o3 = i2 ? `${i2}.${t3}` : `${t3}`, s2 = await a2(e2[t3], e2, o3);
              void 0 === s2 ? r2.onUndefined === "delete" ? (e2.splice(t3, 1), t3--) : r2.onUndefined === "apply" ? e2[t3] = void 0 : await n2(e2[t3], a2, e2, o3, r2) : (e2[t3] = s2, await n2(e2[t3], a2, e2, o3, r2));
            }
          else if (t2.is.object(e2))
            for (const t3 in e2) {
              const o3 = i2 ? `${i2}.${t3}` : `${t3}`, s2 = await a2(e2[t3], e2, o3);
              void 0 === s2 ? r2.onUndefined === "delete" ? delete e2[t3] : r2.onUndefined === "apply" ? e2[t3] = void 0 : await n2(e2[t3], a2, e2, o3, r2) : (e2[t3] = s2, await n2(e2[t3], a2, e2, o3, r2));
            }
        };
      })(), (() => {
        const { $utils: t2 } = e;
        t2.without = (e2, n2 = null) => {
          if (!e2) return e2;
          if (n2 = n2 || /* @__PURE__ */ new Set([void 0, null]), t2.is.function(n2) || t2.is.set(n2) || (n2 = new Set(t2.ensureArray(n2))), t2.is.array(e2))
            return t2.is.function(n2) ? e2.filter((e3) => !n2(e3)) : e2.filter((e3) => !n2.has(e3));
          if (t2.is.object(e2)) {
            const a2 = {};
            return Object.keys(e2).filter((a3) => t2.is.function(n2) ? !n2(a3, e2[a3]) : !n2.has(a3)).forEach((t3) => a2[t3] = e2[t3]), a2;
          }
          throw new Error("source argument must either be an array or object");
        };
      })(), (() => {
        const { $utils: t2, $jsyaml: n2 } = e;
        t2.yaml = {
          parse(e2, t3 = {}) {
            try {
              return n2.load(e2);
            } catch (e3) {
              if (t3.throw) throw e3;
              return t3?.fallback;
            }
          },
          stringify(e2, t3 = {}) {
            try {
              return n2.dump(e2, {
                lineWidth: -1,
                noRefs: true,
                noCompatMode: true,
                ...t3
              });
            } catch (e3) {
              if (t3.throw) throw e3;
              return t3?.fallback;
            }
          }
        };
      })(), (() => {
        const { $type: t2, $env: n2, $utils: a2 } = e, o2 = Symbol("type.custom"), i2 = Symbol("type.extends"), r2 = class extends Array {
        }, s2 = class extends Array {
        }, l2 = class extends Array {
        };
        t2.controller = {
          async init() {
            const e2 = n2.is.development;
            t2.is = a2.is, t2.assert = this._assert.bind(this), t2.assert.dev = (...t3) => e2 ? this._assert(...t3) : null, t2.check = this._check.bind(this), t2.report = this._report.bind(this), t2.report.dev = (...t3) => e2 ? this._report(...t3) : null, t2.display = this._display.bind(this), t2.custom = this._custom.bind(this), t2.Any = this._extend("*"), t2.Boolean = this._extend(Boolean), t2.Number = this._extend(Number), t2.String = this._extend(String), t2.Object = this._extend(Object), t2.Array = this._extend(Array), t2.Symbol = this._extend(Symbol), t2.Function = this._extend(Function), t2.Null = this._extend(null), t2.Undefined = this._extend(void 0), t2.Numeric = this._custom(a2.is.numeric);
          },
          _assert(e2, n3, a3 = "Invalid type") {
            if (this._check(e2, n3)) return;
            t2.error({ value: e2, expected: this._display(n3) });
            const o3 = new Error(a3);
            throw Error.captureStackTrace(o3, this._assert), o3;
          },
          _report(e2, n3, a3 = "Invalid type") {
            this._check(e2, n3) || t2.warn(a3, { value: e2, expected: this._display(n3) });
          },
          _check(e2, n3) {
            if (n3 === "*") return true;
            if (n3 === e2) return true;
            if (n3 === Boolean) return a2.is.boolean(e2);
            if (n3 === Number) return a2.is.number(e2);
            if (n3 === String) return a2.is.string(e2);
            if (n3 === Object) return a2.is.object(e2);
            if (n3 === Array) return a2.is.array(e2);
            if (n3 === Symbol) return a2.is.symbol(e2);
            if (n3 === Function) return a2.is.function(e2);
            if (n3 === null) return a2.is.null(e2);
            if (void 0 === n3) return a2.is.undefined(e2);
            if (a2.is.regexp(n3)) return n3.test(e2);
            const r3 = a2.is.object(n3);
            if (r3 && n3[o2]) return !!n3.fn(e2);
            if (r3 && i2 in n3) return this._check(e2, n3[i2]);
            if (a2.is.function(n3)) return e2 instanceof n3;
            if (a2.is.array(n3) && n3.length === 1) {
              if (!a2.is.array(e2)) return false;
              for (let t3 = 0; t3 < e2.length; t3++) {
                if (!this._check(e2[t3], n3[0])) return false;
              }
              return true;
            }
            if (a2.is.array(n3)) return n3.some((t3) => this._check(e2, t3));
            if (a2.is.object(n3)) {
              if (!a2.is.object(e2)) return false;
              const o3 = /* @__PURE__ */ new Set();
              for (const i3 in n3) {
                if (i3 == "*") continue;
                const r4 = i3.endsWith("?"), s3 = r4 ? i3.slice(0, -1) : i3;
                if (o3.has(s3)) return t2.error(`duplicate key "${s3}"`, n3), false;
                if (o3.add(s3), r4 && a2.is.undefined(e2[s3])) continue;
                if (!this._check(e2[s3], n3[i3])) return false;
              }
              for (const t3 in e2)
                if (!(o3.has(t3) || "*" in n3 && this._check(e2[t3], n3["*"])))
                  return false;
              return true;
            }
            return false;
          },
          _display(e2) {
            if (e2?.[o2]) return e2.display || e2.fn;
            if (e2 && i2 in e2) return this._display(e2[i2]);
            if (a2.is.object(e2)) {
              const t4 = {};
              for (const n3 in e2) t4[n3] = this._display(e2[n3]);
              return t4;
            }
            if (a2.is.array(e2))
              return e2.length === 1 ? new s2(this._display(e2[0])) : new r2(...e2.map((e3) => this._display(e3)));
            const t3 = String(e2);
            return t3.startsWith("function ") ? t3.split(" ")[1].split("(")[0] : t3;
          },
          _custom: (e2) => ({ [o2]: true, fn: e2 }),
          _extend(e2) {
            const t3 = (t4) => {
              const n3 = this._custom((n4) => this._check(n4, e2) && (!t4 || t4(n4)));
              return n3.display = new l2(e2, t4), n3;
            };
            return t3[i2] = e2, t3;
          }
        }, t2.controller.init();
      })(), (() => {
        const { $store: t2 } = e, n2 = {}, a2 = (e2) => {
          Object.keys(e2).forEach((e3) => n2[e3] = "*");
        };
        Object.defineProperties(n2, {
          init: { get: () => a2 },
          transaction: { get: () => t2.transaction }
        }), e.$s = new Proxy(n2, {
          get: (e2, a3) => a3 === "init" || a3 === "transaction" ? n2[a3] : t2.state[a3],
          set: (e2, a3, o2) => (t2.state[a3] = o2, n2[a3] = "*", true),
          deleteProperty: (e2, a3) => (delete t2.state[a3], delete n2[a3], true),
          defineProperty: (e2, a3, o2) => (Object.defineProperty(t2.state, a3, o2), n2[a3] = "*", true)
        });
      })(), (() => {
        const { $feature: t2 } = e;
        t2.config = {
          version: 25,
          sv: 5002e3,
          billing: { enabled: true },
          "billing.pm": { enabled: true, max: 50 },
          "billing.sm": { enabled: true, max: 10, recover: 10 },
          "billing.commands": { enabled: true, max: 2 },
          "billing.tasks": { enabled: true, max: 2 },
          "billing.history": { enabled: true },
          "analytics.pageview": { enabled: 10 },
          "creator.home-button": { enabled: true },
          "creator.run-command": { enabled: true },
          "commands.clone-predefined": { enabled: true },
          promo: null,
          grid: { enabled: true },
          attachments: {
            max: 10,
            maxImageFileSize: 5e7,
            maxImageFileSizeStr: "50 MB",
            maxPdfFileSize: 15e6,
            maxPdfFileSizeStr: "15 MB"
          },
          connectionStatus: {},
          functionToCommand: {
            summarize: {
              command: "summary",
              inputs: [{ arg: "format", fallback: "report" }]
            },
            "summarize-youtube": {
              command: "youtube-summary",
              inputs: [{ arg: "format", fallback: "nested" }]
            },
            explain: { command: "explain", inputs: [{ arg: "what" }] },
            extract: {
              command: "extract",
              inputs: [{ arg: "what", fallback: "tabular" }]
            },
            help: { command: "help", inputs: [{ arg: "question" }] },
            "search-agent": { command: "search", inputs: [{ arg: "query" }] },
            "repurpose-text": {
              command: "repurpose-text",
              inputs: [{ arg: "format" }]
            },
            "repurpose-video": {
              command: "repurpose-video",
              inputs: [{ arg: "format" }]
            },
            compose: { command: "compose" }
          },
          cloudgpt: {
            v3models: [
              {
                id: "harpa-v1",
                name: "HARPA AI",
                title: "HARPA AI",
                description: "Your personal AI companion with superpowers. Switches to appropriate model automatically. Context size \u2014 128k tokens. Input tokens cost x5. Output tokens cost x20. Thinking mode consumes 6 times more tokens at x30:x120.",
                model: "harpa-v1",
                provider: "harpaai",
                limits: {
                  maxTokens: 128e3,
                  maxResponseTokens: 4096,
                  temperature: [0, 2],
                  presencePenalty: [-2, 2],
                  frequencyPenalty: [-2, 2]
                },
                weight: {
                  input: 5,
                  output: 20,
                  think: { input: 30, output: 120 }
                },
                features: ["functions", "vision", "reason"],
                icon: "cloudgpt-harpa"
              },
              {
                id: "cloudgpt-3.5",
                name: "GPT-3.5",
                title: "OpenAI GPT-3.5",
                description: "OpenAI GPT-3.5 model. Context size \u2014 16k tokens.",
                model: "gpt-3.5-turbo-0125",
                provider: "openai",
                limits: {
                  maxTokens: 16385,
                  maxResponseTokens: 4096,
                  temperature: [0, 2],
                  presencePenalty: [-2, 2],
                  frequencyPenalty: [-2, 2]
                },
                weight: { input: 1, output: 1 },
                features: ["functions"],
                maxVersion: "8.10.3",
                icon: "openai-session"
              },
              {
                id: "cloudgpt-4o-mini",
                name: "GPT-4o Mini",
                title: "OpenAI GPT-4o Mini",
                description: "OpenAI GPT-4o model. Context size \u2014 128k tokens.",
                model: "gpt-4o-mini",
                provider: "openai",
                limits: {
                  maxTokens: 128e3,
                  maxResponseTokens: 16384,
                  temperature: [0, 2],
                  presencePenalty: [-2, 2],
                  frequencyPenalty: [-2, 2]
                },
                weight: { input: 1, output: 1 },
                features: ["functions", "vision"],
                minVersion: "8.10.4",
                icon: "openai-session"
              },
              {
                id: "cloudgpt-4o",
                name: "GPT-4o",
                title: "OpenAI GPT-4o",
                description: "OpenAI GPT-4o multimodal model, faster and cheaper than GPT-4. Context size \u2014 128k tokens.",
                model: "gpt-4o",
                provider: "openai",
                limits: {
                  maxTokens: 128e3,
                  maxResponseTokens: 4096,
                  temperature: [0, 2],
                  presencePenalty: [-2, 2],
                  frequencyPenalty: [-2, 2]
                },
                weight: { input: 5, output: 20 },
                features: ["functions", "vision"],
                icon: "openai-session"
              },
              {
                id: "cloudgpt-o3-mini",
                name: "o3 Mini",
                title: "OpenAI o3 Mini",
                description: "Small cost-efficient reasoning model that\u2019s optimized for coding, math, and science.",
                model: "o3-mini",
                provider: "openai",
                limits: {
                  maxTokens: 2e5,
                  maxResponseTokens: 1e5,
                  temperature: [1, 1],
                  presencePenalty: [0, 0],
                  frequencyPenalty: [0, 0]
                },
                weight: { input: 2.5, output: 10 },
                features: ["reason"],
                noSystemMessages: true,
                useMaxCompletionTokens: true,
                icon: "openai-session"
              },
              {
                id: "cloudgpt-o1-mini",
                name: "o1 Mini",
                title: "OpenAI o1 Mini",
                description: "A faster and cheaper version of OpenAI's o1, particularly adept at coding, math, and science tasks where extensive general knowledge isn't required.",
                model: "o1-mini",
                provider: "openai",
                limits: {
                  maxTokens: 128e3,
                  maxResponseTokens: 65536,
                  temperature: [1, 1],
                  presencePenalty: [0, 0],
                  frequencyPenalty: [0, 0]
                },
                weight: { input: 6, output: 24 },
                features: ["reason"],
                noSystemMessages: true,
                useMaxCompletionTokens: true,
                icon: "openai-session"
              },
              {
                id: "cloudgpt-o1",
                name: "o1",
                title: "OpenAI o1",
                description: "OpenAI o1 model, designed to reason about hard problems using broad general knowledge about the world.",
                model: "o1",
                provider: "openai",
                limits: {
                  maxTokens: 2e5,
                  maxResponseTokens: 1e5,
                  temperature: [1, 1],
                  presencePenalty: [0, 0],
                  frequencyPenalty: [0, 0]
                },
                weight: { input: 30, output: 120 },
                features: ["reason"],
                noSystemMessages: true,
                useMaxCompletionTokens: true,
                icon: "openai-session"
              },
              {
                id: "cloudgpt-claude-haiku",
                name: "Haiku 3",
                title: "Claude 3 Haiku",
                description: "Claude 3 Haiku. Fastest and most compact model for near-instant responsiveness. Context size \u2014 200k tokens. Supports vision.",
                model: "claude-3-haiku-20240307",
                provider: "anthropic",
                limits: {
                  maxTokens: 2e5,
                  maxResponseTokens: 4096,
                  temperature: [0, 1]
                },
                weight: { input: 0.5, output: 2.5 },
                features: ["vision"],
                icon: "claude-session"
              },
              {
                id: "cloudgpt-claude-haiku-3-5",
                name: "Haiku 3.5",
                title: "Claude 3.5 Haiku",
                description: "Claude 3.5 Haiku. Anthropic's fastest model. Context size \u2014 200k tokens. No vision support.",
                model: "claude-3-5-haiku-20241022",
                provider: "anthropic",
                limits: {
                  maxTokens: 2e5,
                  maxResponseTokens: 8192,
                  temperature: [0, 1]
                },
                weight: { input: 2, output: 8 },
                icon: "claude-session"
              },
              {
                id: "cloudgpt-claude-sonnet",
                name: "Sonnet 3.5",
                title: "Claude 3.5 Sonnet",
                description: "Claude 3.5 Sonnet model. Intelligent content creation model. Context size \u2014 200k tokens. Supports vision.",
                model: "claude-3-5-sonnet-20241022",
                provider: "anthropic",
                limits: {
                  maxTokens: 2e5,
                  maxResponseTokens: 8192,
                  temperature: [0, 1]
                },
                weight: { input: 6, output: 30 },
                features: ["vision"],
                icon: "claude-session"
              },
              {
                id: "cloudgpt-claude-sonnet-3-7",
                name: "Sonnet 3.7",
                title: "Claude 3.7 Sonnet",
                description: "Claude 3.7 Sonnet model. Intelligent content creation model. Context size \u2014 200k tokens. Supports vision.",
                model: "claude-3-7-sonnet-20250219",
                provider: "anthropic",
                limits: {
                  maxTokens: 2e5,
                  maxResponseTokens: 64e3,
                  temperature: [0, 1]
                },
                weight: { input: 6, output: 30 },
                features: ["vision", "reason"],
                icon: "claude-session"
              },
              {
                id: "cloudgpt-claude-sonnet-4",
                name: "Sonnet 4",
                title: "Claude 4 Sonnet",
                description: "Claude 4 Sonnet model. Anthropic's most intelligent model, especially capable at coding tasks and assistance. Context size \u2014 200k tokens. Supports vision.",
                model: "claude-sonnet-4-20250514",
                provider: "anthropic",
                limits: {
                  maxTokens: 2e5,
                  maxResponseTokens: 64e3,
                  temperature: [0, 1]
                },
                weight: { input: 6, output: 30 },
                features: ["vision"],
                icon: "claude-session"
              },
              {
                id: "cloudgpt-claude-opus-4",
                name: "Opus 4",
                title: "Claude 4 Opus",
                description: "Claude 4 Opus model. Expensive and intelligent model with superior reasoning capabilities. Context size \u2014 200k tokens. Supports vision.",
                model: "claude-opus-4-20250514",
                provider: "anthropic",
                limits: {
                  maxTokens: 2e5,
                  maxResponseTokens: 32e3,
                  temperature: [0, 1]
                },
                weight: { input: 30, output: 150 },
                features: ["vision"],
                icon: "claude-session"
              },
              {
                id: "cloudgpt-deepseek-v3",
                name: "DeepSeek V3",
                title: "DeepSeek V3",
                description: "Powerful and cost-efficient OpenSource Assistance AI model, deployed securely over the U.S. servers. Context size \u2014 64k tokens.",
                model: "deepseek/deepseek_v3",
                provider: "novita",
                limits: {
                  maxTokens: 64e3,
                  maxResponseTokens: 64e3,
                  temperature: [0, 2],
                  presencePenalty: [-2, 2],
                  frequencyPenalty: [-2, 2]
                },
                weight: { input: 2, output: 2 },
                icon: "deepseek"
              },
              {
                id: "cloudgpt-deepseek-r1",
                name: "DeepSeek R1",
                title: "DeepSeek R1",
                description: "Powerful and cost-efficient OpenSource Reasoning AI model, deployed securely over the U.S. servers. Context size \u2014 64k tokens.",
                model: "deepseek/deepseek_r1",
                provider: "novita",
                limits: {
                  maxTokens: 64e3,
                  maxResponseTokens: 64e3,
                  temperature: [0, 2],
                  presencePenalty: [-2, 2],
                  frequencyPenalty: [-2, 2]
                },
                weight: { input: 8, output: 8 },
                features: ["reason"],
                icon: "deepseek"
              },
              {
                id: "cloudgpt-llama-4-scout-17b-16e-instruct",
                name: "Llama 4.0 Scout",
                title: "Llama 4.0 Scout",
                description: "Blazingly fast cutting-edge Llama 4.0 17B parameters, 16 experts model.",
                model: "meta-llama/llama-4-scout-17b-16e-instruct",
                provider: "groq",
                limits: {
                  maxTokens: 1e7,
                  maxResponseTokens: 32768,
                  temperature: [0, 2],
                  presencePenalty: [-2, 2],
                  frequencyPenalty: [-2, 2]
                },
                weight: { input: 1, output: 2 },
                badges: ["fast"],
                icon: "meta"
              },
              {
                id: "cloudgpt-llama-4-maverick-17b-128e-instruct",
                name: "Llama 4.0 Maverick",
                title: "Llama 4.0 Maverick",
                description: "Smart and fast cutting-edge Llama 4.0 17B, 128 experts model.",
                model: "meta-llama/llama-4-maverick-17b-128e-instruct",
                provider: "groq",
                limits: {
                  maxTokens: 1e7,
                  maxResponseTokens: 32768,
                  temperature: [0, 2],
                  presencePenalty: [-2, 2],
                  frequencyPenalty: [-2, 2]
                },
                weight: { input: 1, output: 2 },
                icon: "meta"
              },
              {
                id: "cloudgpt-llama-3.3-70b-versatile",
                name: "Llama 3.3",
                title: "Llama 3.3",
                description: "Llama 3.3 70B model with large context size of 128k tokens.",
                model: "llama-3.3-70b-versatile",
                provider: "groq",
                limits: {
                  maxTokens: 128e3,
                  maxResponseTokens: 32768,
                  temperature: [0, 2],
                  presencePenalty: [-2, 2],
                  frequencyPenalty: [-2, 2]
                },
                weight: { input: 1, output: 2 },
                icon: "meta"
              },
              {
                id: "cloudgpt-gemini-2.0-flash",
                name: "Gemini 2.0 Flash",
                title: "Gemini 2.0 Flash",
                description: "Google Gemini 2.0 Flash model. Context size \u2014 1M tokens.",
                model: "gemini-2.0-flash",
                provider: "google",
                limits: {
                  maxTokens: 1048576,
                  maxResponseTokens: 8192,
                  temperature: [0, 2],
                  presencePenalty: [0, 0],
                  frequencyPenalty: [0, 0]
                },
                weight: { input: 1, output: 1 },
                features: ["vision"],
                minVersion: "9.9.4",
                icon: "gemini"
              },
              {
                id: "cloudgpt-gemini-1.5-pro",
                name: "Gemini 1.5 Pro",
                title: "Gemini 1.5 Pro",
                description: "Google Gemini 1.5 Pro model. Context size \u2014 128k tokens.",
                model: "gemini-1.5-pro",
                provider: "google",
                limits: {
                  maxTokens: 128e3,
                  maxResponseTokens: 8192,
                  temperature: [0, 2],
                  presencePenalty: [0, 0],
                  frequencyPenalty: [0, 0]
                },
                weight: { input: 2.5, output: 10 },
                features: ["vision"],
                minVersion: "9.9.4",
                icon: "gemini"
              },
              {
                id: "cloudgpt-sonar",
                name: "Perplexity",
                title: "Perplexity",
                description: "AI model by Perplexity, with integrated realtime web-search. Each search uses extra 6k input tokens. Context size \u2014 127k tokens.",
                model: "sonar",
                provider: "perplexity",
                limits: {
                  maxTokens: 127e3,
                  maxResponseTokens: 8e3,
                  temperature: [0, 2],
                  presencePenalty: [-2, 2],
                  frequencyPenalty: [-2, 2]
                },
                weight: { input: 2, output: 10, think: { input: 2, output: 10 } },
                features: ["reason"],
                minVersion: "10.0.0",
                icon: "perplexity",
                noSystemMessages: true,
                searchContextSize: "low",
                extraInputTokensPerQuery: 6e3
              },
              {
                id: "cloudgpt-sonar-pro",
                name: "Perplexity Pro",
                title: "Perplexity Pro",
                description: "Sonar Pro model by Perplexity, with integrated realtime web-search. Each search uses extra 6k input tokens. Context size \u2014 127k tokens.",
                model: "sonar-pro",
                provider: "perplexity",
                limits: {
                  maxTokens: 127e3,
                  maxResponseTokens: 8e3,
                  temperature: [0, 2],
                  presencePenalty: [-2, 2],
                  frequencyPenalty: [-2, 2]
                },
                weight: { input: 6, output: 30, think: { input: 6, output: 30 } },
                features: ["reason"],
                minVersion: "10.0.0",
                icon: "perplexity",
                noSystemMessages: true,
                searchContextSize: "low",
                extraInputTokensPerQuery: 6e3
              },
              {
                id: "sonar-deep-research",
                name: "Perplexity Deep",
                title: "Perplexity Deep",
                description: "Sonar Deep Research model by Perplexity, generating highly detailed analyses. Each search uses extra 60k input tokens. Context size \u2014 127k tokens.",
                model: "sonar-deep-research",
                provider: "perplexity",
                limits: {
                  maxTokens: 127e3,
                  maxResponseTokens: 8e3,
                  temperature: [0, 2],
                  presencePenalty: [-2, 2],
                  frequencyPenalty: [-2, 2]
                },
                weight: { input: 6, output: 30 },
                features: ["reason"],
                minVersion: "10.0.0",
                icon: "perplexity",
                noSystemMessages: true,
                searchContextSize: "low",
                extraInputTokensPerQuery: 6e4
              },
              {
                id: "harpa-v1-smart",
                name: "Smart Agent",
                title: "Smart Agent",
                description: "Your personal AI companion with superpowers. Smarter, uses more tokens. Best for content generation tasks. Powered by GPT-4o. Context size \u2014 128k tokens.",
                model: "harpa-v1-smart",
                provider: "harpaai",
                limits: {
                  maxTokens: 128e3,
                  maxResponseTokens: 4096,
                  temperature: [0, 2],
                  presencePenalty: [-2, 2],
                  frequencyPenalty: [-2, 2]
                },
                weight: { input: 5, output: 20 },
                features: ["functions", "vision"],
                deprecated: true
              },
              {
                id: "harpa-v2-fast",
                name: "Fast Agent",
                title: "Fast Agent",
                description: "Your personal AI companion with superpowers. Best for summarization tasks. Powered by GPT-4o-Mini. Context size \u2014 128k tokens.",
                model: "harpa-v2-fast",
                provider: "harpaai",
                limits: {
                  maxTokens: 128e3,
                  maxResponseTokens: 16384,
                  temperature: [0, 2],
                  presencePenalty: [-2, 2],
                  frequencyPenalty: [-2, 2]
                },
                weight: { input: 1, output: 1 },
                features: ["functions", "vision"],
                minVersion: "8.10.4",
                deprecated: true
              },
              {
                id: "cloudgpt-4",
                name: "GPT-4",
                title: "OpenAI GPT-4",
                description: "OpenAI GPT-4 model. Context size \u2014 128k tokens.",
                model: "gpt-4-0125-preview",
                provider: "openai",
                limits: {
                  maxTokens: 128e3,
                  maxResponseTokens: 4096,
                  temperature: [0, 2],
                  presencePenalty: [-2, 2],
                  frequencyPenalty: [-2, 2]
                },
                weight: { input: 20, output: 60 },
                features: ["functions"],
                deprecated: true
              },
              {
                id: "cloudgpt-o1-preview",
                name: "o1 Preview",
                title: "OpenAI o1 Preview",
                description: "Early preview of OpenAI o1 model, designed to reason about hard problems using broad general knowledge about the world.",
                model: "o1-preview",
                provider: "openai",
                limits: {
                  maxTokens: 128e3,
                  maxResponseTokens: 32768,
                  temperature: [1, 1],
                  presencePenalty: [0, 0],
                  frequencyPenalty: [0, 0]
                },
                weight: { input: 30, output: 120 },
                noSystemMessages: true,
                useMaxCompletionTokens: true,
                deprecated: true
              }
            ]
          },
          claude: {
            model: "auto",
            models: [
              {
                model: "auto",
                name: "Auto",
                description: "Use the latest available model",
                maxTokens: 19e4
              },
              {
                model: "claude-sonnet-4-20250514-claude-ai",
                name: "Claude 4 Sonnet",
                description: "Smart, efficient model for everyday use",
                maxTokens: 19e4
              },
              {
                model: "claude-opus-4-20250514-claude-ai-pro",
                name: "Claude 4 Opus ",
                description: "Powerful, large model for complex challenges",
                maxTokens: 19e4
              },
              {
                model: "claude-3-7-sonnet-20250219",
                name: "Claude 3.7 Sonnet",
                description: "Smart, efficient model for everyday use",
                maxTokens: 19e4
              },
              {
                model: "claude-3-5-haiku-20241022",
                name: "Claude 3.5 Haiku",
                description: "Fastest model for daily tasks",
                maxTokens: 19e4
              }
            ],
            endpoints: {
              fetchOrgId: { path: "/api/organizations", response: "0.uuid" },
              createChat: {
                path: "/api/organizations/{{orgId}}/chat_conversations",
                payload: {
                  method: "POST",
                  headers: { "content-type": "application/json" },
                  body: { uuid: "{{chatId}}", name: "{{title}}" }
                }
              },
              ask: {
                path: "/api/organizations/{{orgId}}/chat_conversations/{{chatId}}/completion",
                payload: {
                  method: "POST",
                  headers: {
                    Accept: "text/event-stream, text/event-stream",
                    "Content-Type": "application/json",
                    Origin: "https://claude.ai",
                    Referer: "https://claude.ai/{{chatId}}"
                  },
                  body: {
                    attachments: "{{attachments}}",
                    files: [],
                    prompt: "{{text}}",
                    model: "{{model}}",
                    timezone: "{{timezone}}"
                  }
                }
              },
              setChatTitle: {
                path: "/api/organizations/{{orgId}}/chat_conversations/{{chatId}}",
                payload: {
                  method: "PUT",
                  headers: { "content-type": "application/json" },
                  body: { name: "{{title}}" }
                }
              },
              deleteChat: {
                path: "/api/organizations/{{orgId}}/chat_conversations/{{chatId}}",
                payload: { method: "DELETE", body: "{{chatId}}" }
              }
            }
          },
          openai: {
            models: {
              "gpt-3.5-turbo-1106": {
                description: "Improved instruction following, JSON mode, reproducible outputs, parallel function calling, and more. Returns a maximum of 4,096 output tokens.",
                maxTokens: 16385,
                new: true
              },
              "gpt-3.5-turbo": {
                description: "Most capable GPT-3.5 model and optimized for chat at 1/10th the cost of text-davinci-003.",
                maxTokens: 4096
              },
              "gpt-3.5-turbo-16k": {
                description: "Same capabilities as the standard gpt-3.5-turbo model but with 4 times the context.",
                maxTokens: 16385
              },
              "gpt-3.5-turbo-instruct": {
                description: "Similar capabilities as text-davinci-003 but compatible with legacy Completions endpoint and not Chat Completions.",
                maxTokens: 16385
              },
              "gpt-3.5-turbo-0613": {
                description: "Snapshot of gpt-3.5-turbo from June 13th 2023 with function calling data. Unlike gpt-3.5-turbo, this model will not receive updates, and will be deprecated 3 months after a new version is released.",
                maxTokens: 4096,
                legacy: true
              },
              "gpt-3.5-turbo-16k-0613": {
                description: "Snapshot of gpt-3.5-turbo-16k from June 13th 2023. Unlike gpt-3.5-turbo-16k, this model will not receive updates, and will be deprecated 3 months after a new version is released.",
                maxTokens: 16384,
                legacy: true
              },
              "gpt-3.5-turbo-0301": {
                description: "Snapshot of gpt-3.5-turbo from March 1st 2023. Will be deprecated on June 13th 2024.",
                maxTokens: 4096,
                legacy: true
              },
              "text-davinci-003": {
                description: "Can do any language task with better quality, longer output, and consistent instruction-following than the curie, babbage, or ada models. Also supports some additional features such as inserting text.",
                maxTokens: 4096,
                legacy: true
              },
              "text-davinci-002": {
                description: "Similar capabilities to text-davinci-003 but trained with supervised fine-tuning instead of reinforcement learning.",
                maxTokens: 4096,
                legacy: true
              },
              "code-davinci-002": {
                description: "Optimized for code-completion tasks.",
                maxTokens: 8001,
                legacy: true
              },
              "gpt-4o": {
                description: "The most advanced model. Multimodal, and has the same high intelligence as GPT-4 Turbo but generates text 2x faster and is 50% cheaper.",
                maxTokens: 128e3,
                new: true
              },
              "gpt-4o-2024-05-13": {
                description: "The most advanced model. Multimodal, and has the same high intelligence as GPT-4 Turbo but generates text 2x faster and is 50% cheaper.",
                maxTokens: 128e3,
                new: true
              },
              "gpt-4o-2024-08-06": {
                description: "The most advanced model. Multimodal, and has the same high intelligence as GPT-4 Turbo but generates text 2x faster and is 50% cheaper. Supports Structured Outputs.",
                maxTokens: 128e3,
                new: true
              },
              "gpt-4-turbo": {
                description: "The latest GPT-4 Turbo model with vision capabilities. Vision requests can now use JSON mode and function calling.",
                maxTokens: 128e3
              },
              "gpt-4-turbo-2024-04-09": {
                description: "The latest GPT-4 Turbo model with vision capabilities. Vision requests can now use JSON mode and function calling.",
                maxTokens: 128e3
              },
              "gpt-4-turbo-preview": {
                description: "GPT-4 Turbo preview model intended to reduce cases of \u201Claziness\u201D where the model doesn\u2019t complete a task. Returns a maximum of 4,096 output tokens. This preview model is not yet suited for production traffic.",
                maxTokens: 128e3
              },
              "gpt-4-0125-preview": {
                description: "GPT-4 Turbo preview model intended to reduce cases of \u201Claziness\u201D where the model doesn\u2019t complete a task. Returns a maximum of 4,096 output tokens. This preview model is not yet suited for production traffic.",
                maxTokens: 128e3
              },
              "gpt-4-1106-preview": {
                description: "Improved instruction following, JSON mode, reproducible outputs, parallel function calling, and more. Returns a maximum of 4,096 output tokens. This preview model is not yet suited for production traffic.",
                maxTokens: 128e3
              },
              "gpt-4-vision-preview": {
                description: "Ability to understand images, in addition to all other GPT-4 Turbo capabilities. Returns a maximum of 4,096 output tokens. This is a preview model version and not suited yet for production traffic.",
                maxTokens: 128e3
              },
              "gpt-4": {
                description: "Currently points to gpt-4-0613.",
                maxTokens: 8192
              },
              "gpt-4-32k": {
                description: "Currently points to gpt-4-32k-0613.",
                maxTokens: 32768
              },
              "gpt-4-0613": {
                description: "Snapshot of gpt-4 from June 13th 2023 with improved function calling support.",
                maxTokens: 8192
              },
              "gpt-4-32k-0613": {
                description: "Snapshot of gpt-4-32k from June 13th 2023 with improved function calling support.",
                maxTokens: 32768
              }
            }
          },
          chatgpt: {
            url: "https://chatgpt.com",
            o1ToolName: "a8km123",
            headers: { "content-type": "application/json" },
            endpoints: {
              accessToken: {
                path: "/api/auth/session",
                payload: { credentials: "include" }
              },
              ask: {
                path: "/backend-api/conversation",
                payload: {
                  method: "POST",
                  headers: {
                    accept: "text/event-stream",
                    origin: "https://chatgpt.com",
                    referer: "https://chatgpt.com/"
                  },
                  body: {
                    action: "{{action}}",
                    messages: "{{messages}}",
                    model: "{{model}}",
                    parent_message_id: "{{parentMessageId}}",
                    conversation_id: "{{chatId}}",
                    timezone_offset_min: "{{timezoneOffset}}",
                    websocket_request_id: "{{wsRequestId}}",
                    force_paragen: false,
                    force_nulligen: false,
                    force_rate_limit: false,
                    force_paragen_model_slug: "",
                    history_and_training_disabled: false,
                    conversation_mode: { kind: "primary_assistant" }
                  }
                }
              },
              likeAnswer: {
                path: "/backend-api/conversation/message_feedback",
                payload: {
                  method: "POST",
                  body: {
                    rating: "thumbsUp",
                    message_id: "{{answerId}}",
                    conversation_id: "{{chatId}}"
                  }
                }
              },
              dislikeAnswer: {
                path: "/backend-api/conversation/message_feedback",
                payload: {
                  method: "POST",
                  body: {
                    rating: "thumbsDown",
                    message_id: "{{answerId}}",
                    conversation_id: "{{chatId}}"
                  }
                }
              },
              setChatTitle: {
                path: "/backend-api/conversation/{{chatId}}",
                payload: { method: "PATCH", body: { title: "{{title}}" } }
              },
              deleteChat: {
                path: "/backend-api/conversation/{{chatId}}",
                payload: { method: "PATCH", body: { is_visible: false } }
              },
              listGizmos: {
                path: "/backend-api/gizmos/bootstrap?limit=20",
                payload: { method: "GET" }
              },
              files: {
                path: "/backend-api/files",
                payload: {
                  method: "POST",
                  body: {
                    file_name: "{{name}}",
                    file_size: "{{size}}",
                    use_case: "multimodal",
                    timezone_offset_min: "{{timezoneOffset}}",
                    reset_rate_limits: false
                  }
                }
              },
              upload: {
                payload: {
                  headers: {
                    "x-ms-blob-type": "BlockBlob",
                    "x-ms-version": "2020-04-08"
                  },
                  method: "PUT",
                  credentials: "omit"
                }
              },
              uploaded: {
                path: "/backend-api/files/{{fileId}}/uploaded",
                payload: { method: "POST" }
              }
            },
            models: {
              path: "/backend-api/models",
              ignore: ["gpt-4-plugins", "gpt-4-magic-create"],
              auto: {},
              "text-davinci-002-render-sha": {},
              "gpt-4": { maxTokens: 8191 },
              "gpt-4o": { maxTokens: 8191 }
            },
            gizmos: {
              cloneModel: "gpt-4o",
              model: "gpt-4-gizmo",
              askBody: {
                model: "o1-preview",
                conversation_mode: {
                  kind: "gizmo_interaction",
                  gizmo_id: "{{id}}"
                }
              }
            },
            ask: {
              res: { wssUrlKey: "wss_url", resIdKey: "response_id" },
              wss: {
                protocol: "json.reliable.webpubsub.azure.v1",
                closeDelay: 6e4,
                headerName: "content-type",
                headerValue: "application/json"
              },
              msg: {
                typeKey: "type",
                typeValue: "message",
                dataKey: "data",
                resIdKey: "response_id",
                bodyKey: "body"
              }
            },
            sessionCookie: {
              url: "https://chatgpt.com",
              domain: "chatgpt.com",
              v2domain: ".chatgpt.com",
              name: "__Secure-next-auth.session-token"
            },
            defaultModel: { slug: "auto", title: "CHAT AUTO", maxTokens: 8191 }
          },
          encodings: {
            "openai-session:text-davinci-002-render-sha": "p50k_base"
          },
          notes: [],
          ae: {
            modelRegex: ".*",
            scriptLoadTimeout: 5e3,
            tokenFetchTimeout: 5e3,
            requirements: {
              $p: "p",
              url: "https://chatgpt.com/backend-api/sentinel/chat-requirements",
              headerName: "Openai-Sentinel-Chat-Requirements-Token",
              dxPath: "arkose.dx",
              arkoseRequiredPath: "arkose.required",
              tokenPath: "token",
              payload: { body: '{"conversation_mode_kind":"primary_assistant"}' }
            },
            iframeUrl: "https://tcr9i.chat.openai.com/",
            dxUrl: "https://chatgpt.com/backend-api/sentinel/arkose/dx",
            chatUrl: "https://chatgpt.com",
            bodyStartsWith: "bda=",
            siteParam: "site",
            dataSiteParam: "data[site]",
            dataKey: "data",
            blobKey: "blob",
            selectorKey: "selector",
            onErrorKey: "onError",
            onCompletedKey: "onCompleted",
            resultTokenKey: "token",
            headerName: "Openai-Sentinel-Arkose-Token",
            script: {
              src: null,
              "data-status": "loading",
              "data-callback": "useArkoseSetupEnforcement"
            },
            params: { mode: "inline" },
            parameters: {
              capi_mode: "lightbox",
              capi_version: "1.5.2",
              capi_settings: null,
              public_key: "35536E1E-65B4-4D96-9D97-6ADB7EFF8147",
              target_html: "challenge",
              surl: "https://tcr9i.chat.openai.com",
              data: void 0,
              language: void 0,
              isSDK: void 0,
              siteData: {
                location: {
                  ancestorOrigins: {},
                  href: "https://chatgpt.com/?model=gpt-4",
                  origin: "https://chatgpt.com",
                  protocol: "https:",
                  host: "chatgpt.com",
                  hostname: "chatgpt.com",
                  port: "",
                  pathname: "/",
                  hash: ""
                }
              },
              styletheme: "default",
              accessibilitySettings: { lockFocusToModal: true }
            },
            pow: {
              $required: "required",
              $proofofwork: "proofofwork",
              $seed: "seed",
              $difficulty: "difficulty",
              $dpl: "dpl",
              prefix: "gAAAAAB",
              headerName: "Openai-Sentinel-Proof-Token"
            },
            enforcement: {
              $ef: "ef",
              $sent: "sent",
              $isSDK: "isSDK",
              $config: "config",
              ef: {
                window__tree_index: [1],
                window__tree_structure: "[[],[]]",
                window__ancestor_origins: ["https://chatgpt.com"],
                document__referrer: "https://chatgpt.com/",
                client_config__sitedata_location_href: "https://chatgpt.com/"
              },
              config: {
                siteData: {
                  location: {
                    ancestorOrigins: {},
                    href: "https://chatgpt.com/",
                    origin: "https://chatgpt.com",
                    protocol: "https:",
                    host: "chatgpt.com",
                    hostname: "chatgpt.com",
                    port: "",
                    pathname: "/",
                    search: "",
                    hash: ""
                  }
                },
                pageLevel: { chref: "https://chatgpt.com/c/" }
              }
            }
          }
        }, Object.keys(t2.config.openai.models).forEach((e2) => {
          t2.config.openai.models[e2].slug = e2;
        });
      })(), (() => {
        const { $feature: t2, $env: n2, $utils: a2, $s: o2 } = e;
        t2.controller = {
          async init() {
            await this.updateOnInit(), a2.chrome.alarms.run(this._update, {
              name: "feature.update",
              delayInMinutes: 3 * a2.time.HOUR / a2.time.MINUTE,
              periodInMinutes: 3 * a2.time.HOUR / a2.time.MINUTE,
              immediately: false
            });
          },
          async updateOnInit() {
            try {
              await this.update();
            } catch (e2) {
              if (t2.error("failed fetching config", e2), o2.feature.updatedAt)
                return;
              o2.feature = t2.config, this.retryDelay = this.retryDelay ? Math.min(2 * this.retryDelay, a2.time.HOUR) : a2.time.SECOND, setTimeout(() => this.updateOnInit(), this.retryDelay);
            }
          },
          async update() {
            await this._update(true);
          },
          async _update(e2 = false) {
            if (e2 || o2.feature.shouldUpdate)
              try {
                const e3 = o2.feature.hash, i2 = e3 ? `${n2.apiUrl}/feature?hash=${e3}&v=${n2.versionNumber}` : `${n2.apiUrl}/feature?v=${n2.versionNumber}`, r2 = await fetch(i2).then((e4) => e4.json());
                if (r2.status !== "ok")
                  throw new Error(`invalid response status: ${r2.status}`);
                if (!a2.is.object(r2))
                  throw new Error(`invalid response data: ${r2}`);
                const s2 = r2.version || 0;
                if (t2.config.version > s2)
                  return void Object.assign(o2.feature, t2.config);
                if (!r2.hash) return void (o2.feature.updatedAt = Date.now());
                delete r2.status, r2.updatedAt = Date.now(), o2.feature = r2;
              } catch (e3) {
                t2.warn("failed fetching feature data", e3?.message);
              }
          }
        };
      })(), (() => {
        const { $ai: t2, $utils: n2, $s: a2 } = e;
        t2.ClaudeSessionApi = class {
          constructor() {
            this._logs = true, this.ask = this._wrapMethod(this.ask);
          }
          isOwnError(e2) {
            return e2 instanceof t2.ClaudeSessionApi.Error;
          }
          async fetchOrgId() {
            const e2 = this.interpolate("endpoints.fetchOrgId.path"), t3 = this.interpolate("endpoints.fetchOrgId.response"), a3 = await this._fetchAuth(e2);
            let o2 = await a3.json();
            return n2.is.array(o2) && (o2 = o2.sort(
              (e3, t4) => (e3?.capabilities || []).includes("chat") ? -1 : (t4?.capabilities || []).includes("chat") ? 1 : 0
            )), n2.get(o2, t3) || null;
          }
          async setChatTitle(e2, t3, n3 = null) {
            n3 || (n3 = await this.fetchOrgId()), await this._fetchAuth(
              this.interpolate("endpoints.setChatTitle.path", {
                orgId: n3,
                chatId: e2
              }),
              this.interpolate("endpoints.setChatTitle.payload", {
                title: t3.replaceAll("\xA0\xA0", " ")
              })
            );
          }
          async deleteChat(e2, t3 = null) {
            t3 || (t3 = await this.fetchOrgId()), await this._fetchAuth(
              this.interpolate("endpoints.deleteChat.path", {
                orgId: t3,
                chatId: e2
              }),
              this.interpolate("endpoints.deleteChat.payload", { chatId: e2 })
            );
          }
          interpolate(e2, t3) {
            return a2.feature.interpolate(`claude.${e2}`, t3);
          }
          updateModels() {
            const e2 = a2.ai.connections.get("claude-session");
            if (!e2) return;
            const t3 = this._model, n3 = (a2.feature.claude.models || []).map((e3) => ({
              id: e3.model,
              name: e3.name,
              description: e3.description,
              maxTokens: e3.maxTokens
            }));
            e2.options = n3, e2.selectedOption = n3.find((e3) => e3.id === t3) || n3[0], e2.maxTokens = e2.selectedOption?.maxTokens || null;
          }
          async ask(e2, {
            orgId: t3 = null,
            chatId: a3 = null,
            signal: o2 = null,
            emoji: i2 = null
          } = {}, r2 = () => {
          }) {
            arguments.length === 2 && typeof arguments[1] == "function" && (r2 = arguments[1]), t3 || (t3 = await this.fetchOrgId()), a3 || (a3 = await this._createChat(t3, i2));
            const s2 = [];
            e2.length > 5e3 && (s2.push({
              extracted_content: e2,
              file_name: "paste.txt",
              file_size: e2.length,
              file_type: "txt"
            }), e2 = "");
            const l2 = this.interpolate("endpoints.ask.path", {
              orgId: t3,
              chatId: a3
            }), c2 = this._model === "auto" ? void 0 : this._model, u2 = this.interpolate("endpoints.ask.payload", {
              model: c2,
              timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
              attachments: s2,
              text: e2,
              chatId: a3
            });
            u2.signal = o2, u2.prompt = u2.prompt || e2;
            const p2 = await this._fetchAuth(l2, u2);
            if (p2.status !== 200) {
              const e3 = await n2.noThrow(() => p2.json(), null), t4 = e3?.error?.code;
              t4 === "too_many_completions" && this._throw("freeLimitExceeded"), t4 === "model_not_allowed" && this._throw("badModel", this._model), p2.status === 429 && this._throw("tooManyRequests", e3), this._throw("unknown", e3);
            }
            let d2 = "", m2 = true;
            const h = p2.body.getReader(), g = { carryOver: "" };
            for (; ; )
              try {
                const { done: e3, value: n3 } = await h.read();
                if (e3) break;
                d2 = (d2 + this._parseChunk(n3, g)).trimStart(), r2({ text: d2, chatId: a3, orgId: t3 }, m2), m2 = false;
              } catch (e3) {
                e3.message?.includes("aborted") && this._throw("aborted", e3.message), this._throw("failedToReadResponse", e3);
              }
            return h.releaseLock(), { orgId: t3, chatId: a3, text: d2 };
          }
          _parseChunk(e2, n3) {
            const a3 = new TextDecoder().decode(e2).trim().split("\n").filter((e3) => e3.trim().length > 0 && !e3.startsWith("event:"));
            return a3.map((e3, o2) => {
              let i2, r2 = "";
              o2 === 0 && n3.carryOver && (r2 = n3.carryOver, n3.carryOver = "");
              const s2 = r2 + e3.replace("data: ", "");
              try {
                i2 = JSON.parse(s2);
              } catch (i3) {
                return o2 === a3.length - 1 ? (n3.carryOver = s2, "") : (t2.error(
                  "failed to parse claude ai response:",
                  i3.message,
                  e3
                ), "");
              }
              return i2.type === "error" ? i2.error?.type === "overloaded_error" ? "\u{1F494} Due to unexpected capacity constraints, Claude is unable to respond to your message. Please try again soon, or consider upgrading to Claude Pro." : i2.error?.message || "\u{1F494} ClaudeAI failed replying to prompt. Please try again." : i2.completion;
            }).join("");
          }
          async _createChat(e2, t3) {
            const a3 = n2.id.uuid(), o2 = `${t3 || "\u{1F9EC}"} New Chat`, i2 = await this._fetchAuth(
              this.interpolate("endpoints.createChat.path", { orgId: e2 }),
              this.interpolate("endpoints.createChat.payload", {
                chatId: a3,
                title: o2
              })
            );
            return i2.status === 400 && this._throw("badOrgId", { orgId: e2 }), i2.status === 404 && this._throw("badOrgId", { orgId: e2 }), a3;
          }
          async _fetchAuth(e2, t3 = {}) {
            let a3;
            t3.body && (t3.body = JSON.stringify(t3.body));
            try {
              if (a3 = await fetch(`https://claude.ai${e2}`, {
                credentials: "include",
                ...t3
              }), a3.status === 403) {
                const e3 = await n2.noThrow(() => a3.json());
                e3?.error?.message === "Invalid model" && this._throw("badModel"), e3?.error?.details?.error_code === "model_not_available" && this._throw("badModel");
                const t4 = "https://claude.ai/api/organizations";
                (await fetch("https://claude.ai/api/organizations", {
                  credentials: "include"
                })).status === 403 && this._throw("login"), this._throw("badOrgId");
              }
            } catch (e3) {
              try {
                a3 = await a3.json();
              } catch {
              }
              if (a3?.error?.code === "model_not_allowed")
                this._throw("badModel", e3.message);
              else if (String(e3) === "TypeError: Failed to fetch")
                this._throw("network", e3.message);
              else {
                if (String(e3) !== "AbortError: The user aborted a request.")
                  throw e3;
                this._throw("aborted", e3.message);
              }
            }
            return a3;
          }
          _wrapMethod(e2) {
            return async (...t3) => {
              try {
                return await e2.call(this, ...t3);
              } catch (e3) {
                let t4;
                throw t4 = this.isOwnError(e3) ? e3 : this._createError("unknown", e3.message), t4.details ? this._logError(t4.message, t4.details) : this._logError(t4.message), t4;
              }
            };
          }
          get _model() {
            return a2.ai.connections.get("claude-session")?.selectedOption?.id || a2.feature.claude.model || "auto";
          }
          _throw(e2, t3 = null) {
            throw this._createError(e2, t3);
          }
          _createError(e2, n3 = null) {
            return new t2.ClaudeSessionApi.Error(e2, n3);
          }
          _logError(e2, ...n3) {
            this._logs && t2.error("ClaudeSessionApi:", e2, ...n3);
          }
        }, t2.ClaudeSessionApi.Error = n2.createError(
          "$ai.ClaudeSessionApi.Error",
          {
            login: "Need to login to claude.ai",
            tooManyRequests: "Too many requests",
            failedToReadResponse: "Failed to read response",
            freeLimitExceeded: "Free limit exceeded",
            badOrgId: "Bad organization id",
            badModel: "Model not allowed",
            aborted: "Request was aborted",
            network: "Network error",
            unknown: "Unknown error"
          }
        );
      })(), (() => {
        const { $ai: t2, $env: n2, $utils: a2, $s: o2 } = e;
        t2.CloudgptApi = class {
          constructor() {
            this._logs = n2.is.development, this.ask = this._wrapMethod(this.ask);
          }
          async ask({
            messages: e2,
            modelName: i2 = null,
            temperature: r2 = null,
            presencePenalty: s2 = null,
            frequencyPenalty: l2 = null,
            maxResponseTokens: c2 = null,
            url: u2 = null,
            title: p2 = null,
            functions: d2 = null,
            fblacklist: m2 = null,
            stream: h = false,
            signal: g = null,
            think: f = null,
            onResult: y = () => {
            }
          }) {
            o2.billing.account || this._throw("noLogin"), o2.billing.space || this._throw("noSpace");
            const b = {
              messages: e2,
              stream: h,
              short: true,
              spaceId: o2.billing.spaceId,
              ...!a2.is.nil(i2) && { modelName: i2 },
              ...!a2.is.nil(r2) && { temperature: r2 },
              ...!a2.is.nil(s2) && { presencePenalty: s2 },
              ...!a2.is.nil(l2) && { frequencyPenalty: l2 },
              ...!a2.is.nil(c2) && { maxResponseTokens: c2 },
              ...!a2.is.nil(u2) && { url: u2 },
              ...!a2.is.nil(p2) && { title: p2 },
              ...!a2.is.nil(m2) && { fblacklist: m2 },
              ...!a2.is.nil(f) && { think: f }
            };
            a2.is.nil(d2?.declaration) || (b.functions = a2.ensureArray(d2?.declaration).filter(Boolean).map((e3) => e3.function || e3), b.functionCall = d2?.call || "auto", b.functionCall === "required" && (b.functionCall = { name: b.functions[0]?.name }));
            const w = await fetch(`${n2.apiUrl}/ai/ask`, {
              method: "POST",
              signal: g,
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${o2.billing.jwt}`,
                ...h && { Accept: "text/event-stream" }
              },
              body: JSON.stringify(b)
            }), v = w.headers.get("Content-Type")?.startsWith("application/json") ? await w.json() : null;
            if ((w.status !== 200 || v && v.status !== "ok") && (v?.status === "space-not-found" && this._throw("noSpace"), v?.status === "insufficient-balance" && this._throw("noTokens"), v?.status === "functions-not-supported" && this._throw("functionsNotSupported"), this._throw("unknown", v || `HTTP status ${w.status}`)), v)
              return void y(this._parseResult(v.result));
            const k = w.body.getReader(), T = new TextDecoder();
            try {
              let e3 = "";
              for (; ; ) {
                const { value: t3, done: n3 } = await k.read();
                if (n3) break;
                const a3 = e3 + T.decode(t3, { stream: true });
                e3 = "";
                const o3 = a3.split("\n").filter((e4) => e4.trim());
                for (let t4 = 0; t4 < o3.length; t4++) {
                  const n4 = o3[t4];
                  try {
                    y(this._parseResult(JSON.parse(n4)));
                  } catch (a4) {
                    if (!(t4 === o3.length - 1)) throw a4;
                    e3 = n4;
                  }
                }
              }
            } catch (e3) {
              e3.message?.includes("aborted") && this._throw("aborted"), t2.error("failed to read response", e3), this._throw("failedToReadResponse", e3);
            } finally {
              k.releaseLock();
            }
          }
          updateModels() {
            o2.transaction(() => {
              const e2 = o2.ai.cloudgptModels;
              for (const t3 of o2.ai.connections) {
                if (t3.type !== "cloudgpt") continue;
                e2.find((e3) => e3.id === t3.selectedModelId) || (t3.selectedModelId = e2[0].id);
              }
            });
          }
          isOwnError(e2) {
            return e2 instanceof t2.CloudgptApi.Error;
          }
          _parseResult(e2) {
            return a2.is.object(e2) ? e2 : {
              content: e2[0],
              usage: {
                input: e2[1],
                output: e2[2],
                total: e2[3],
                weight: { input: e2[4], output: e2[5] }
              },
              func: { name: e2[6], args: e2[7] }
            };
          }
          _wrapMethod(e2) {
            return async (...n3) => {
              try {
                return await e2.call(this, ...n3);
              } catch (e3) {
                let n4;
                throw n4 = this.isOwnError(e3) ? e3 : String(e3) === "TypeError: Failed to fetch" ? new t2.CloudgptApi.Error("network", e3.message) : String(e3) === "AbortError: The user aborted a request." ? new t2.CloudgptApi.Error("aborted", e3.message) : new t2.CloudgptApi.Error("unknown", e3.message), n4.details ? this._logError(n4.message, n4.details) : this._logError(n4.message), n4;
              }
            };
          }
          _throw(e2, n3 = null) {
            throw new t2.CloudgptApi.Error(e2, n3);
          }
          _logError(e2, ...n3) {
            this._logs && t2.error("CloudgptApi:", e2, ...n3);
          }
        }, t2.CloudgptApi.Error = a2.createError("$ai.CloudgptApi.Error", {
          network: "Network error",
          aborted: "Request was aborted",
          unknown: "Unknown error",
          noLogin: "Login required",
          noSpace: "Space not found",
          noTokens: "Insufficient balance",
          functionsNotSupported: "Functions not supported",
          failedToReadResponse: "Failed to read response"
        });
      })(), (() => {
        const { $ai: t2, $utils: n2, $s: a2 } = e;
        t2.GeminiSessionApi = class {
          constructor() {
            this._logs = true, this.ask = this._wrapMethod(this.ask);
          }
          isOwnError(e2) {
            return e2 instanceof t2.GeminiSessionApi.Error;
          }
          async ask(e2, { token: t3 = null, cursor: a3 = ["", "", ""], signal: o2 = null } = {}, i2 = false) {
            t3 || (t3 = await this._fetchToken());
            const r2 = await this._fetch(
              "/_/BardChatUi/data/assistant.lamda.BardFrontendService/StreamGenerate",
              {
                method: "POST",
                headers: {
                  "content-type": "application/x-www-form-urlencoded;charset=UTF-8"
                },
                signal: o2,
                query: {
                  bl: t3.bl,
                  rt: "c",
                  _reqid: Math.floor(9e5 * Math.random()) + 1e5
                },
                body: new URLSearchParams({
                  at: t3.at,
                  "f.req": JSON.stringify([
                    null,
                    JSON.stringify([[e2.slice(0, this._maxTokens)], null, a3])
                  ])
                })
              }
            ), s2 = (t4 = "") => (i2 && this._throw("badToken", t4), this.ask(e2, { token: null, cursor: a3, signal: o2 }, true));
            if (r2.status !== 200) {
              const e3 = await n2.noThrow(() => r2.text(), null);
              if (r2.status === 400) return s2(e3);
              this._throw("unknown", e3);
            }
            let l2, c2, u2, p2;
            try {
              const e3 = (await r2.text()).slice(6);
              l2 = JSON.parse(e3);
            } catch (e3) {
              this._throw("failedToReadResponse", { step: "data", error: e3 });
            }
            try {
              c2 = l2[0][5]?.[0] ?? null;
            } catch (e3) {
              this._throw("failedToReadResponse", {
                step: "errorCode",
                error: e3
              });
            }
            return c2 === 9 && this._throw("noGeminiAccess"), c2 === 7 ? s2() : (l2.find((e3) => {
              try {
                const t4 = JSON.parse(e3[2]);
                return u2 = {
                  text: t4[0]?.[0] || t4[4]?.[0]?.[1]?.[0] || "",
                  cursor: [...t4[1], t4[4][0][0]]
                }, true;
              } catch (e4) {
                return p2 = e4, false;
              }
            }), u2 || this._throw("failedToReadResponse", {
              step: "answer",
              error: p2
            }), { text: u2.text, cursor: u2.cursor, token: t3 });
          }
          get _maxTokens() {
            return a2.ai.connections.get("gemini-session").modelMaxTokens;
          }
          async _fetchToken() {
            const e2 = await this._fetch("/faq"), t3 = await e2.text();
            let n3;
            t3.includes("$authuser") || this._throw("login");
            try {
              n3 = {
                at: this._extractKeyValue(t3, "SNlM0e"),
                bl: this._extractKeyValue(t3, "cfb2h")
              };
            } catch (e3) {
              this._throw("failedToExtractToken", e3);
            }
            return n3;
          }
          _extractKeyValue(e2, t3) {
            return e2.split(t3)[1].split('":"')[1].split('"')[0];
          }
          async _fetch(e2, t3 = {}) {
            return await fetch(`https://gemini.google.com${e2}`, {
              credentials: "include",
              ...t3
            });
          }
          _wrapMethod(e2) {
            return async (...t3) => {
              try {
                return await e2.call(this, ...t3);
              } catch (e3) {
                let t4;
                throw t4 = this.isOwnError(e3) ? e3 : String(e3) === "TypeError: Failed to fetch" ? this._createError("network", e3.message) : String(e3) === "AbortError: The user aborted a request." ? this._createError("aborted", e3.message) : this._createError("unknown", e3.message), t4.details ? this._logError(t4.message, t4.details) : this._logError(t4.message), t4;
              }
            };
          }
          _throw(e2, t3 = null) {
            throw this._createError(e2, t3);
          }
          _createError(e2, n3 = null) {
            return new t2.GeminiSessionApi.Error(e2, n3);
          }
          _logError(e2, ...n3) {
            this._logs && t2.error("GeminiSessionApi:", e2, ...n3);
          }
        }, t2.GeminiSessionApi.Error = n2.createError(
          "$ai.GeminiSessionApi.Error",
          {
            login: "Need to login to google.com",
            badToken: "Bad token",
            failedToExtractToken: "Failed to extract token",
            failedToReadResponse: "Failed to read response",
            noGeminiAccess: "Gemini is not available for your account",
            aborted: "Request was aborted",
            network: "Network error",
            unknown: "Unknown error"
          }
        );
      })(), (() => {
        const { $ai: t2, $utils: n2 } = e;
        t2.OpenaiLicenseApi = class {
          constructor() {
            this._logs = true, this.ask = this._wrapMethod(this.ask);
          }
          isOwnError(e2) {
            return e2 instanceof t2.OpenaiLicenseApi.Error;
          }
          async ask({
            messages: e2,
            connection: t3,
            functions: a2,
            signal: o2 = null,
            onChunk: i2
          }) {
            const r2 = t3.stream ?? true, s2 = { model: t3.slug, stream: r2 };
            s2.messages = e2.map((e3) => ({
              role: e3.role,
              content: (e3.attachments || []).length > 0 ? [
                ...e3.attachments.map((e4) => ({
                  type: "image_url",
                  image_url: { url: e4.dataUrl, detail: e4.detail }
                })),
                ...e3.text && [{ type: "text", text: e3.text }]
              ] : e3.text
            })), n2.is.nil(t3.temperature) || (s2.temperature = t3.temperature), n2.is.nil(t3.presencePenalty) || (s2.presence_penalty = t3.presencePenalty), n2.is.nil(t3.frequencyPenalty) || (s2.frequency_penalty = t3.frequencyPenalty), n2.is.nil(t3.maxResponseTokens) || (s2.max_tokens = t3.maxResponseTokens), n2.is.nil(a2?.declaration) || (s2.functions = n2.ensureArray(a2?.declaration).filter(Boolean).map((e3) => e3.function || e3), s2.function_call = a2?.call || "auto", s2.function_call === "required" && (s2.function_call = { name: s2.functions[0]?.name }));
            const l2 = await this._fetchAuth(t3.proxyPath, {
              method: "POST",
              signal: o2,
              body: s2,
              apiKey: t3.apiKey,
              proxyUrl: t3.proxyUrl,
              headers: n2.is.object(t3.headers) ? t3.headers : {}
            });
            if (l2.status !== 200) {
              const e3 = await n2.noThrow(() => l2.json(), null);
              l2.status === 404 && (e3?.error?.message.startsWith("The model") || e3?.error?.message.startsWith("This is not a chat model")) && this._throw("badModel", e3), l2.status === 429 && this._throw("reachedRequestsLimit", e3), e3?.error?.code === "context_length_exceeded" && this._throw("messageTooLong", e3), e3?.error?.message?.includes("image_url is only") && this._throw("visionNotSupported", e3), this._throw("unknown", e3 || `HTTP status ${l2.status}`);
            }
            if (!r2) {
              const e3 = await l2.json();
              e3 || this._throw("failedToReadResponse");
              const t4 = { id: e3.id };
              t4.text = e3.choices?.[0]?.message?.content, void 0 === t4.text && (t4.text = e3.content?.[0].text), void 0 === t4.text && this._throw("failedToReadResponse");
              const n3 = e3?.choices?.[0]?.message?.function_call;
              return n3 && (t4.text = t4.text || "", t4.func = { name: n3.name, args: n3.arguments, progress: 100 }), void i2(t4, true);
            }
            if (r2) {
              const e3 = { text: "" }, t4 = l2.body.getReader();
              let n3 = true;
              for (; ; )
                try {
                  const { done: a3, value: o3 } = await t4.read(), r3 = this._parseAskChunk(o3, e3);
                  if (r3.hasData && (i2(e3, n3), n3 = false), r3.done || a3) break;
                } catch (e4) {
                  if (e4.message?.includes("aborted")) break;
                  this._throw("failedToReadResponse", e4);
                }
              t4.releaseLock();
            }
          }
          _parseAskChunk(e2, t3) {
            const n3 = { done: false, data: null };
            let a2 = "";
            try {
              a2 = new TextDecoder().decode(e2).trim();
            } catch (e3) {
              return this._logWarn("failed to decode chunk", e3), n3;
            }
            const o2 = "data: [DONE]", i2 = a2.split("\n");
            n3.done = i2.includes("data: [DONE]");
            const r2 = i2.filter((e3) => e3.startsWith("data:") && e3 !== o2);
            if (r2.length === 0) return n3;
            for (const e3 of r2)
              try {
                const a3 = e3.replace("data:", "").trim(), o3 = JSON.parse(a3);
                t3.id = t3.id || o3.id, t3.text += (o3.choices?.[0]?.delta?.content || "") + (o3.error?.message || "");
                const i3 = o3.choices?.[0]?.delta?.function_call;
                i3 && (t3.text = t3.text || "", t3.func = t3.func || { name: "", args: "", progress: 100 }, t3.func.name += i3.name || "", t3.func.args += i3.arguments || ""), n3.hasData = true;
              } catch {
              }
            return n3;
          }
          async _fetchAuth(e2, t3 = {}) {
            t3.headers = {
              "content-type": "application/json",
              ...t3.apiKey ? { authorization: `Bearer ${t3.apiKey}` } : {},
              ...t3.headers
            }, t3.body && (t3.body = JSON.stringify(t3.body));
            let n3 = t3.proxyUrl;
            delete t3.proxyUrl, delete t3.apiKey, n3 && n3.trim() || (n3 = "https://api.openai.com"), n3.endsWith("/") && (n3 = n3.slice(0, -1)), e2.startsWith("/") || (e2 = `/${e2}`);
            const a2 = await fetch(`${n3}${e2}`, t3);
            return a2.status === 401 && this._throw("badApiKey"), a2;
          }
          _wrapMethod(e2) {
            return async (...t3) => {
              try {
                return await e2.call(this, ...t3);
              } catch (e3) {
                let t4;
                throw t4 = this.isOwnError(e3) ? e3 : String(e3) === "TypeError: Failed to fetch" ? this._createError("network", e3.message) : String(e3) === "AbortError: The user aborted a request." ? this._createError("aborted", e3.message) : this._createError("unknown", e3.message), t4.details ? this._logError(t4.message, t4.details) : this._logError(t4.message), t4;
              }
            };
          }
          _throw(e2, t3 = null) {
            throw this._createError(e2, t3);
          }
          _createError(e2, n3 = null) {
            return new t2.OpenaiLicenseApi.Error(e2, n3);
          }
          _logError(e2, ...n3) {
            this._logs && t2.error("OpenaiLicenseApi:", e2, ...n3);
          }
          _logWarn(e2, ...n3) {
            this._logs && t2.warn("OpenaiLicenseApi:", e2, ...n3);
          }
        }, t2.OpenaiLicenseApi.Error = n2.createError(
          "$ai.OpenaiLicenseApi.Error",
          {
            badModel: "Model does not exist",
            badApiKey: "Bad API key",
            messageTooLong: "Message is too long",
            tooManyRequests: "Too many requests",
            failedToReadResponse: "Failed to read response",
            reachedRequestsLimit: "Reached requests limit",
            visionNotSupported: "Vision not supported",
            aborted: "Request was aborted",
            network: "Network error",
            unknown: "Unknown error"
          }
        );
      })(), (() => {
        const { $ai: t2, $utils: n2, $feature: a2, $s: o2 } = e;
        t2.OpenaiSessionApi = class {
          constructor() {
            this._logs = true, this._plus = null, this._socket = null, this._socketDisabled = false, this._closeSocketTimeout = null, this._socketMsgHandlers = /* @__PURE__ */ new Set(), this._socketMsgQueuePromise = null, this._toolDalle = new t2.ToolDalle(this), this.ask = this._wrapMethod(this.ask), this.updateModels = this._wrapMethod(this.updateModels), this.updateAccessToken = this._wrapMethod(
              this.updateAccessToken
            );
          }
          get config() {
            return o2.feature.chatgpt;
          }
          get plus() {
            return this._plus;
          }
          isOwnError(e2) {
            return e2 instanceof t2.OpenaiSessionApi.Error;
          }
          async updateAccessToken() {
            const e2 = await fetch(
              this._url(this.config.endpoints.accessToken.path),
              this.config.endpoints.accessToken.payload
            );
            e2.status === 429 && this._throw("tooManyRequests"), e2.status === 403 && this._throw("cloudflare");
            const t3 = await e2.json();
            return this._accessToken = t3?.accessToken || null, this._accessToken;
          }
          async updateModels() {
            if (!this._accessToken) {
              const e3 = [o2.feature.chatgpt.defaultModel];
              return o2.ai.applyOpenaiSessionModels(e3), e3;
            }
            const e2 = await this._fetchAuth(this.config.models.path), t3 = await e2.json(), n3 = new Set(this.config.models.ignore);
            let i2 = t3?.models.filter((e3) => !n3.has(e3.slug));
            i2 && i2.length !== 0 || this._throw("noModels", t3);
            const r2 = /(\d+)/gm;
            return i2 = i2.map((e3) => {
              e3.title.includes(" (All Tools)") && (e3.title = e3.title.replace(" (All Tools)", ""));
              let t4 = e3.slug === "auto" ? 1e5 : 1e3 * (Number(e3.slug?.match(r2)?.[0]) || 0) + (e3.slug?.length || 0);
              e3.description.length > 0 && !e3.description.endsWith(".") && (e3.description += ".");
              const n4 = [e3.slug, e3.title, e3.description].filter(Boolean).map((e4) => String(e4).toLowerCase()).join("\n");
              return n4.includes("gpt-4") && (t4 = 2), e3.slug.includes("mobile") && (e3.title = `${e3.title} Mobile`), n4.includes("legacy") && (t4 = 1), e3.title = e3.title.replace(/^Default \((.+)\)$/, "$1"), e3.title = `Chat ${e3.title}`, { model: e3, priority: t4 };
            }).sort((e3, t4) => t4.priority - e3.priority).map((e3) => ({
              slug: e3.model.slug,
              title: e3.model.title,
              description: e3.model.description,
              maxTokens: e3.model.max_tokens,
              unsupported: false,
              ...a2.config.chatgpt.models[e3.model.slug] || {}
            })), this._updatePlusStatus(i2), await this._updateGizmos(i2), o2.ai.applyOpenaiSessionModels(i2), i2;
          }
          _updatePlusStatus(e2) {
            const t3 = e2.some((e3) => e3.slug === "gpt-4");
            this._plus = t3;
          }
          async _updateGizmos(e2) {
            const a3 = o2.feature.chatgpt.gizmos?.model;
            if (!a3) return;
            const i2 = o2.feature.chatgpt.gizmos?.cloneModel || "gpt-4o", r2 = e2.findIndex((e3) => e3.slug === i2);
            if (-1 === r2) return;
            let s2 = e2[r2];
            s2 = n2.cloneDeep(s2);
            try {
              s2.title = "Chat GPTs", s2.slug = a3, s2.description = "Connect more GPTs through web interface.";
              let e3 = await this._fetchAuth(
                this.config.endpoints.listGizmos.path,
                this.config.endpoints.listGizmos.payload
              );
              if (e3 = await e3.json(), e3 = e3.gizmos.map((e4) => ({
                id: e4.resource.gizmo.id,
                name: e4.resource.gizmo.display.name,
                description: e4.resource.gizmo.display.description,
                picture: e4.resource.gizmo.display.profile_picture_url
              })), e3.length > 0) {
                s2.options = e3;
                const t3 = o2.ai.connections.find(
                  (e4) => e4.slug === s2.slug
                )?.selectedOption;
                s2.selectedOption = t3 ? s2.options.find((e4) => e4.id === t3.id) : s2.options[0];
              }
            } catch (e3) {
              t2.warn("failed retrieving GPTs", e3);
            }
            e2.splice(r2 + 1, 0, s2);
          }
          async testConnection() {
            try {
              return await this.ask("hi"), true;
            } catch {
              return false;
            }
          }
          async ask(e2, {
            chatId: i2 = null,
            parentMessageId: r2 = null,
            signal: s2 = null,
            model: l2 = null,
            connection: c2 = null,
            attachments: u2 = []
          } = {}, p2 = () => {
          }) {
            arguments.length === 2 && typeof arguments[1] == "function" && (p2 = arguments[1]), l2 || (l2 = a2.config.chatgpt.defaultModel.slug);
            let d2 = true, m2 = null, h = "", g = "", f = 0, y = await this._ensureSocket(null);
            do {
              const a3 = m2 === "max_tokens" ? null : await this._prepareMessage(e2, u2), b = this._interpolate("endpoints.ask.payload", {
                model: l2,
                chatId: i2,
                wsRequestId: n2.id.uuid(),
                parentMessageId: r2 || n2.id.uuid(),
                timezoneOffset: (/* @__PURE__ */ new Date()).getTimezoneOffset(),
                action: m2 === "max_tokens" ? "continue" : "next",
                messages: a3 ? [a3] : void 0
              });
              if (b.body.history_and_training_disabled = !o2.settings.chatGptHistory, b.signal = s2, l2 === this.config.gizmos.model && c2.selectedOption?.id) {
                const e3 = this._interpolate("gizmos.askBody", {
                  id: c2.selectedOption.id
                });
                Object.assign(b.body, e3);
              }
              await t2.arkoseController.injectToken(b), m2 === "max_tokens" && await n2.sleep(1e3);
              const w = n2.createPromise();
              this._socketMsgQueuePromise = w;
              const v = await this._fetchAuth(this.config.endpoints.ask.path, b);
              if (v.status !== 200) {
                const e3 = await n2.noThrow(() => v.json(), null);
                v.status === 503 && this._throw("serverError", e3), v.status === 413 && this._throw("messageTooLong", e3), v.status === 429 && this._throw("tooManyRequests", e3), v.status === 404 && this._throw("chatNotFound", e3), v.status === 400 && e3?.detail?.message === "Conversation key not found. Try starting a new conversation." && this._throw("chatNotFound", e3), this._throw("unknown", e3);
              }
              const k = this.config.ask.wss.headerName || "content-type", T = this.config.ask.wss.headerValue || "application/json";
              if ((v.headers.get(k) || "").startsWith(T)) {
                this._socketDisabled && (this._socketDisabled = false, this._throw("switchToWssRequired")), t2.log("connecting via web socket");
                const e3 = this.config.ask;
                let n3, a4;
                try {
                  const t3 = await v.json();
                  n3 = t3[e3.res.wssUrlKey], a4 = t3[e3.res.resIdKey];
                } catch (e4) {
                  this._throw("failedToReadResponse", e4.message);
                }
                const o3 = { chatId: null, messages: [], carryOver: "" };
                let l3 = false;
                s2 && s2.addEventListener("abort", () => l3 = true), y = await this._ensureSocket(n3), y || this._throw(
                  "failedToReadResponse",
                  "failed to connect socket"
                ), await new Promise((t3, n4) => {
                  y.resolveFns.add(t3);
                  const s3 = async (c3) => {
                    let u3, f2;
                    try {
                      if (u3 = JSON.parse(c3), u3[e3.msg.typeKey] !== e3.msg.typeValue)
                        return;
                      if (!u3[e3.msg.dataKey]) return;
                      const t4 = u3[e3.msg.dataKey][e3.msg.resIdKey];
                      if (!t4) throw new Error("failed to read response id");
                      if (a4 !== t4) return;
                    } catch (e4) {
                      return y.resolveFns.delete(t3), this._socketMsgHandlers.delete(s3), void n4(
                        this._createError("failedToReadResponse", e4.message)
                      );
                    }
                    if (l3)
                      return y.resolveFns.delete(t3), this._socketMsgHandlers.delete(s3), void t3();
                    try {
                      const t4 = atob(u3[e3.msg.dataKey][e3.msg.bodyKey]);
                      if (f2 = await this._parseAskChunk(t4, o3), f2.data) {
                        if (i2 = f2.data.chatId, m2 = f2.data.finishDetails, r2 = f2.data.id, f2.data.text) {
                          const e4 = this._cleanText(f2.data.text);
                          g = h + e4, f2.data.text = g;
                        }
                        p2(f2.data, d2), d2 = false;
                      }
                    } catch (e4) {
                      return y.resolveFns.delete(t3), this._socketMsgHandlers.delete(s3), void n4(
                        this._createError("failedToReadResponse", e4.message)
                      );
                    }
                    f2.done && (y.resolveFns.delete(t3), this._socketMsgHandlers.delete(s3), t3());
                  };
                  this._socketMsgHandlers.add(s3), y.addEventListener("error", () => {
                    y.resolveFns.delete(t3), this._socketMsgHandlers.delete(s3), n4(
                      this._createError("network", "failed to start socket")
                    );
                  }), y.addEventListener("close", () => {
                    y.resolveFns.delete(t3), this._socketMsgHandlers.delete(s3), n4(
                      this._createError(
                        "network",
                        "socket closed prematurely"
                      )
                    );
                  }), w.resolve();
                });
              } else {
                t2.log("connecting via event stream"), this._socketDisabled = true;
                const e3 = v.body.getReader(), n3 = { chatId: null, messages: [], carryOver: "" };
                for (; ; )
                  try {
                    const { done: t3, value: a4 } = await e3.read();
                    if (t3) break;
                    const o3 = await this._parseAskChunk(a4, n3);
                    if (o3.data) {
                      if (i2 = o3.data.chatId, m2 = o3.data.finishDetails, r2 = o3.data.id, o3.data.text) {
                        const e4 = this._cleanText(o3.data.text);
                        g = h + e4, o3.data.text = g;
                      }
                      p2(o3.data, d2), d2 = false;
                    }
                    if (o3.done) break;
                  } catch (e4) {
                    if (e4.message?.includes("aborted")) break;
                    this._throw("failedToReadResponse", e4);
                  }
                e3.releaseLock();
              }
              h = g, f++;
            } while (m2 === "max_tokens" && f <= 5);
          }
          async setChatTitle(e2, t3) {
            this._accessToken && o2.settings.chatGptHistory && await this._fetchAuth(
              this._interpolate("endpoints.setChatTitle.path", { chatId: e2 }),
              this._interpolate("endpoints.setChatTitle.payload", { title: t3 })
            );
          }
          async deleteChat(e2) {
            await this._fetchAuth(
              this._interpolate("endpoints.deleteChat.path", { chatId: e2 }),
              this._interpolate("endpoints.deleteChat.payload")
            );
          }
          async _upload(e2) {
            const t3 = e2.type.split("/")[1], a3 = `${n2.id.nano()}.${t3}`, { width: o3, height: i2 } = await createImageBitmap(e2);
            let r2, s2;
            {
              const t4 = this._interpolate("endpoints.files.path"), n3 = this._interpolate("endpoints.files.payload", {
                name: a3,
                size: e2.size,
                timezoneOffset: (/* @__PURE__ */ new Date()).getTimezoneOffset()
              }), o4 = await this._fetchAuth(t4, n3);
              o4.status === 429 && this._throw("tooManyRequestsFiles");
              const i3 = await o4.json();
              r2 = i3.file_id, s2 = i3.upload_url;
            }
            {
              const t4 = this._interpolate("endpoints.upload.payload");
              await fetch(s2, { ...t4, body: e2 });
            }
            {
              const e3 = this._interpolate("endpoints.uploaded.path", {
                fileId: r2
              }), t4 = this._interpolate("endpoints.uploaded.payload");
              await this._fetchAuth(e3, t4);
            }
            return {
              id: r2,
              name: a3,
              type: e2.type,
              size: e2.size,
              width: o3,
              height: i2,
              assetPointer: `file-service://${r2}`
            };
          }
          get _accessToken() {
            return o2.ai.openaiSession.accessToken;
          }
          set _accessToken(e2) {
            o2.ai.openaiSession.accessToken = e2;
          }
          async _parseAskChunk(e2, t3) {
            const a3 = { done: false, data: null };
            let o3 = "";
            if (n2.is.string(e2)) o3 = e2;
            else
              try {
                o3 = new TextDecoder().decode(e2).trim();
              } catch (e3) {
                return this._logWarn("failed to decode chunk", e3), a3;
              }
            t3.carryOver && (o3 = t3.carryOver + o3);
            const i2 = o3.split("\n");
            a3.done = i2.includes("data: [DONE]");
            let r2 = null;
            const s2 = i2.filter((e3) => e3.startsWith("data: {"));
            if (s2.forEach((e3) => {
              try {
                const n3 = e3.replace("data: ", "").trim(), a4 = JSON.parse(n3);
                if (a4.error) throw new Error(a4.error);
                const o4 = a4.message, i3 = a4.conversation_id || t3.chatId;
                if (!o4 || !o4.id || !i3) return;
                t3.chatId = i3, t3.messages = t3.messages.filter((e4) => e4.id !== o4.id), t3.messages.push(o4);
              } catch (e4) {
                if (e4.name !== "SyntaxError") throw e4;
                r2 = e4;
              }
            }), s2.length > 0 && !r2 ? t3.carryOver = "" : o3.startsWith("data: {") && (t3.carryOver = o3), !t3.chatId)
              return a3;
            a3.data = {
              id: null,
              text: "",
              chatId: t3.chatId,
              finishDetails: null
            };
            for (const e3 of t3.messages) {
              if (e3.author && e3.content && (e3.recipient === "all" || !e3.recipient))
                if (e3.author.role !== "assistant" || e3.content.content_type !== "text") {
                  if (e3.author.role !== "assistant" || e3.content.content_type !== "code") {
                    if (e3.author.role === "tool") {
                      if (a3.data.id = a3.data.id || e3.id, e3.author.name === this.config.o1ToolName) {
                        a3.data.text += "\n```hrp-text\n\u{1F914} Thinking...\n```\n";
                        continue;
                      }
                      if (this._toolDalle.accept(e3)) {
                        await this._toolDalle.process(e3, a3);
                        continue;
                      }
                      {
                        const t4 = (e3.author.name || "").split(".")[0];
                        a3.data.text += "\n```hrp-text\n\u{1F6E0} Using " + t4 + "...\n```\n";
                        continue;
                      }
                    }
                  } else {
                    a3.data.id = a3.data.id || e3.id;
                    const t4 = e3.content.text.startsWith("# ") ? e3.content.text.slice(2) : e3.content.text;
                    a3.data.text += "\n```text\n\u{1F914} " + t4 + "\n```\n";
                  }
                } else
                  a3.data.id = e3.id, a3.data.finishDetails = e3.metadata?.finish_details?.type || a3.data.finishDetails, a3.data.text += this._injectCitations(
                    e3.content.parts.join(""),
                    e3.metadata?.citations
                  );
            }
            return a3;
          }
          async _fetchAuth(e2, t3 = {}) {
            const n3 = await chrome.cookies.get({
              url: "https://chatgpt.com",
              name: "oai-did"
            });
            t3.headers = {
              "OAI-Device-Id": n3?.value || void 0,
              "OAI-Language": "en-US",
              ...t3.headers,
              ...this.config.headers,
              ...this._accessToken && {
                Authorization: `Bearer ${this._accessToken}`
              }
            }, t3.body && (t3.body = JSON.stringify(t3.body));
            let a3 = await fetch(this._url(e2), t3);
            return a3.status === 401 && (await this.updateAccessToken(), this._accessToken || this._throw("badAccessToken"), t3.headers.authorization = `Bearer ${this._accessToken}`, a3 = await fetch(this._url(e2), t3), a3.status === 401 && (this._accessToken = null, this._throw("badAccessToken"))), a3.status !== 403 && a3.status !== 418 || this._throw("cloudflare"), a3;
          }
          _injectCitations(e2, t3) {
            if ((t3 = (t3 || []).filter(
              (e3) => void 0 !== e3.start_ix && void 0 !== e3.end_ix && e3.metadata?.url
            ).sort((e3, t4) => e3.start_ix - t4.start_ix)).length === 0)
              return e2;
            let n3 = 0;
            for (let a3 = 0; a3 < t3.length; a3++) {
              const o3 = t3[a3], { url: i2, title: r2 } = o3.metadata, s2 = `[${a3 + 1}](${i2}){: title="${r2}"}`;
              e2 = e2.slice(0, o3.start_ix + n3) + s2 + e2.slice(o3.end_ix + n3), n3 += s2.length - (o3.end_ix - o3.start_ix);
            }
            return e2;
          }
          _url(e2) {
            return `${this.config.url}${e2}`;
          }
          async _prepareMessage(e2, t3 = []) {
            if (t3.length === 0)
              return {
                id: n2.id.uuid(),
                author: { role: "user" },
                content: { content_type: "text", parts: [e2] },
                metadata: {}
              };
            const a3 = await Promise.all(
              t3.map(async (e3) => {
                try {
                  return await this._upload(e3);
                } catch (e4) {
                  if (this.isOwnError(e4)) throw e4;
                  return this._logError("failed to upload", e4), null;
                }
              })
            ).then((e3) => e3.filter(Boolean));
            return {
              id: n2.id.uuid(),
              author: { role: "user" },
              content: {
                content_type: "multimodal_text",
                parts: [
                  ...a3.map((e3) => ({
                    content_type: "image_asset_pointer",
                    asset_pointer: e3.assetPointer,
                    size_bytes: e3.size,
                    width: e3.width,
                    height: e3.height
                  })),
                  e2
                ]
              },
              metadata: {
                attachments: a3.map((e3) => ({
                  id: e3.id,
                  size: e3.size,
                  name: e3.name,
                  mime_type: e3.type,
                  width: e3.width,
                  height: e3.height
                }))
              }
            };
          }
          async _ensureSocket(e2) {
            if (!this._accessToken) return;
            if (this._socketDisabled)
              return t2.log("socket disabled, skip wss connection"), null;
            if (this._socket?.readyState === WebSocket.CONNECTING || this._socket?.readyState === WebSocket.OPEN)
              return t2.log("reusing existing socket"), this._socket;
            if (!e2)
              try {
                const t3 = await this._fetchAuth(
                  "/backend-api/register-websocket",
                  { method: "POST" }
                ), n3 = await t3.json();
                return (e2 = n3[this.config.ask.res.wssUrlKey]) ? this._ensureSocket(e2) : null;
              } catch (e3) {
                return t2.log("failed registering shared websocket", e3), null;
              }
            const a3 = n2.createPromise();
            let o3 = 1, i2 = 0, r2 = null;
            const s2 = () => {
              t2.log("socket error before open"), this._closeSocket(), a3.reject(null);
            }, l2 = (e3) => {
              e3.code !== 1e3 ? o3 >= 4 ? (t2.warn(
                "could not open socket, too many attempts, giving up"
              ), this._socket.removeEventListener("open", c2), this._socket.removeEventListener("error", s2), this._socket.removeEventListener("close", l2), a3.reject(null)) : (t2.log(`socket closed, reopening in ${o3}s...`), setTimeout(g, 1e3 * o3), o3 *= 2) : t2.log("socket closed gracefully");
            }, c2 = () => {
              t2.log("socket opened"), this._socket.removeEventListener("open", c2), this._socket.removeEventListener("error", s2), this._socket.removeEventListener("close", l2), this._socket.addEventListener("message", p2), this._socket.addEventListener("message", u2), this._socket.addEventListener("error", d2), this._socket.addEventListener("close", m2), a3.resolve(this._socket);
            }, u2 = (e3) => {
              try {
                const t3 = JSON.parse(e3.data).sequenceId;
                if (!t3) return;
                const n3 = "sequenceAck";
                t3 - i2 >= 25 ? (clearTimeout(r2), i2 = t3, this._socket.send(
                  JSON.stringify({ type: "sequenceAck", sequenceId: t3 })
                )) : (clearTimeout(r2), r2 = setTimeout(
                  () => {
                    i2 = t3, this._socket.send(
                      JSON.stringify({ type: n3, sequenceId: t3 })
                    );
                  },
                  1e3 + Math.round(2e3 * Math.random())
                ));
              } finally {
              }
            }, p2 = () => {
              clearTimeout(this._closeSocketTimeout), this._closeSocketTimeout = setTimeout(() => {
                t2.log("closing socket due to inactivity"), this._closeSocket();
              }, this.config.ask.wss.closeDelay);
            }, d2 = () => {
              t2.log("event: socket error"), this._closeSocket();
            }, m2 = () => {
              t2.log("event: socket closed"), this._closeSocket();
            }, h = async (e3) => {
              const t3 = e3.data, a4 = this._socketMsgQueuePromise, o4 = n2.createPromise();
              this._socketMsgQueuePromise = o4, a4 && await a4;
              for (const e4 of this._socketMsgHandlers)
                try {
                  await e4(t3);
                } finally {
                }
              o4.resolve();
            }, g = () => {
              this._socket = new WebSocket(e2, this.config.ask.wss.protocol), this._socket.resolveFns = /* @__PURE__ */ new Set(), this._socket.addEventListener("open", c2), this._socket.addEventListener("close", l2), this._socket.addEventListener("message", h);
            };
            return g(), a3;
          }
          _closeSocket() {
            const e2 = this._socket;
            if (!e2) return;
            this._socket = null;
            const t3 = Array.from(e2.resolveFns);
            e2.resolveFns = /* @__PURE__ */ new Set(), t3.forEach((e3) => e3()), clearTimeout(this._closeSocketTimeout), e2.readyState !== WebSocket.CLOSING && e2.readyState !== WebSocket.CLOSED && e2.close();
          }
          _interpolate(e2, t3) {
            return o2.feature.interpolate(`chatgpt.${e2}`, t3);
          }
          _cleanText(e2) {
            return e2.replace(/[]/g, "").replace(/citeturn\d+search\d+/g, "");
          }
          _wrapMethod(e2) {
            return async (...t3) => {
              try {
                return await e2.call(this, ...t3);
              } catch (e3) {
                let t4;
                throw t4 = this.isOwnError(e3) ? e3 : String(e3) === "TypeError: Failed to fetch" ? this._createError("network", e3.message) : String(e3) === "AbortError: The user aborted a request." ? this._createError("aborted", e3.message) : this._createError("unknown", e3.message), t4.details ? this._logError(t4.message, t4.details) : this._logError(t4.message), t4;
              }
            };
          }
          _throw(e2, t3 = null) {
            throw this._createError(e2, t3);
          }
          _createError(e2, n3 = null) {
            return new t2.OpenaiSessionApi.Error(e2, n3);
          }
          _logError(e2, ...n3) {
            this._logs && t2.error("OpenaiSessionApi:", e2, ...n3);
          }
          _logWarn(e2, ...n3) {
            this._logs && t2.warn("OpenaiSessionApi:", e2, ...n3);
          }
        }, t2.OpenaiSessionApi.Error = n2.createError(
          "$ai.OpenaiSessionApi.Error",
          {
            login: "Need to login to openai.com",
            cloudflare: "Cloudflare check required",
            badAccessToken: "Bad access token",
            noModels: "Failed to extract models",
            messageTooLong: "Message is too long",
            chatNotFound: "Chat not found",
            serverError: "Server error",
            tooManyRequests: "Too many requests",
            tooManyRequestsFiles: "Too many requests for files",
            failedToReadResponse: "Failed to read response",
            aborted: "Request was aborted",
            switchToWssRequired: "Switch to WebSocket approach is required",
            network: "Network error",
            unknown: "Unknown error"
          }
        );
      })(), (() => {
        const { $ai: t2 } = e;
        t2.ToolDalle = class {
          constructor(e2) {
            this.api = e2, this.cache = {};
          }
          accept(e2) {
            return e2.author?.name === "dalle.text2im";
          }
          async process(e2, t3) {
            const n2 = e2.content?.content_type;
            if (n2 !== "multimodal_text") return;
            const a2 = e2.content?.parts?.[0]?.asset_pointer;
            if (!a2.startsWith("file-service://")) return;
            let o2 = a2.replace("file-service://", "");
            try {
              const e3 = await this.fetchFile(o2);
              if (e3.status !== "success")
                throw "file service response is not a success";
              if (!e3.download_url)
                throw "file service response does not contain download_url";
              o2 = e3.download_url, t3.data.text += `
\`\`\`text
\u{1F5BC} Using DALL\xB7E...
\`\`\`
![Generated by DALL\xB7E](${o2})

`;
            } catch (e3) {
              this.api._logWarn("tool dalle failed", e3);
            }
          }
          async fetchFile(e2) {
            return e2 = `/backend-api/files/${e2}/download`, this.cache[e2] || (this.cache[e2] = this.api._fetchAuth(e2).then((e3) => e3.json()).catch((e3) => e3)), this.cache[e2];
          }
        };
      })(), (() => {
        const { $ai: t2, $bus: n2, $s: a2, $mobx: o2, $utils: i2 } = e;
        t2.api = {
          init() {
            this.cloudgpt = new t2.CloudgptApi(), this.geminiSession = new t2.GeminiSessionApi(), this.claudeSession = new t2.ClaudeSessionApi(), this.openaiSession = new t2.OpenaiSessionApi(), this.openaiLicense = new t2.OpenaiLicenseApi(), this._openaiModelsUpdatedAt = null, n2.on("ai.setChatTitle", this.setChatTitle, this), n2.on("ai.updateOpenaiModels", this._updateOpenaiModels, this), n2.on("ai.updateClaudeModels", this._updateClaudeModels, this), n2.on("ai.updateCloudgptModels", this._updateCloudgptModels, this), o2.reaction(
              () => a2.feature.claude,
              () => this._updateClaudeModels(),
              { fireImmediately: true }
            ), o2.reaction(
              () => a2.feature.cloudgpt,
              () => this._updateCloudgptModels(),
              { fireImmediately: true }
            );
          },
          async setChatTitle({ openaiChatId: e2, claudeChatId: n3 }, o3) {
            if (e2)
              try {
                await t2.api.openaiSession.setChatTitle(e2, o3);
              } catch (e3) {
                t2.error("failed to set title", e3);
              }
            if (n3)
              try {
                const e3 = a2.ai.connections.get("claude-session").orgId;
                await t2.api.claudeSession.setChatTitle(n3, o3, e3);
              } catch (e3) {
                t2.error("failed to set title", e3);
              }
          },
          async deleteChat({ openaiChatId: e2, claudeChatId: n3 }) {
            if (e2)
              try {
                await t2.api.openaiSession.deleteChat(e2);
              } catch (e3) {
                t2.error("failed to delete chat", e3);
              }
            if (n3)
              try {
                const e3 = a2.ai.connections.get("claude-session").orgId;
                await t2.api.claudeSession.deleteChat(n3, e3);
              } catch (e3) {
                t2.error("failed to delete chat", e3);
              }
          },
          async checkOpenaiAuth() {
            try {
              const e2 = await this.openaiSession.updateAccessToken();
              return await this.openaiSession.updateModels(), !!e2;
            } catch {
              return false;
            }
          },
          async _updateOpenaiModels() {
            if (!this._openaiModelsUpdatedAt || Date.now() - this._openaiModelsUpdatedAt > 15 * i2.time.MINUTE) {
              this._openaiModelsUpdatedAt = Date.now();
              try {
                await this.openaiSession.updateModels();
              } catch (e2) {
                return void t2.error(e2);
              }
            }
          },
          _updateClaudeModels() {
            this.claudeSession.updateModels();
          },
          _updateCloudgptModels() {
            this.cloudgpt.updateModels();
          }
        };
      })(), (() => {
        const {
          $ai: t2,
          $analytics: n2,
          $bus: a2,
          $mobx: o2,
          $netRules: i2,
          $utils: r2,
          $s: s2
        } = e;
        t2.arkoseController = {
          async init() {
            this._config = this._getConfig(), this._retrieveArkoseToken = r2.enqueue(
              this._retrieveArkoseToken,
              this
            ), this._scripts = null, this._scriptsTimeout = null, this._requirementsProofToken = null, this._requirementsProofTokenTimeout = null, this._actualizeConfigOnChanges(), await this._allowArkoseIframe();
          },
          async injectToken(e2) {
            const a3 = e2.body?.model;
            if (!a3) return;
            const o3 = this._config;
            if (o3) {
              if (o3.modelRegex) {
                if (!new RegExp(o3.modelRegex).test(a3)) return;
              }
              try {
                const t3 = await this._fetchRequirements(), n3 = r2.get(t3, o3.requirements?.tokenPath);
                n3 && o3.requirements?.headerName && (e2.headers = e2.headers || {}, e2.headers[o3.requirements?.headerName] = n3);
                const a4 = t3[o3.pow.$proofofwork];
                if (a4?.[o3.pow.$required]) {
                  const t4 = await this._generateProofToken({
                    seed: a4[o3.pow.$seed],
                    difficulty: a4[o3.pow.$difficulty]
                  });
                  e2.headers[o3.pow.headerName] = t4;
                }
                if (!(!r2.get(t3, o3.requirements?.arkoseRequiredPath) || !o3.script?.src)) {
                  const n4 = r2.get(t3, o3.requirements?.dxPath), a5 = await this._retrieveArkoseToken(n4);
                  a5 && (e2.headers = e2.headers || {}, e2.headers[o3.headerName] = a5);
                }
              } catch (e3) {
                t2.error("failed to get ae-token", e3), n2.controller.sendError(e3, "ai");
              }
            }
          },
          async _fetchRequirements() {
            const e2 = this._config.requirements?.url;
            if (!e2) return null;
            const t3 = await this._getRequirementsProofToken(), n3 = s2.ai.openaiSession.accessToken, a3 = {
              method: "POST",
              ...n3 && { headers: { Authorization: `Bearer ${n3}` } },
              body: JSON.stringify({ [this._config.requirements.$p]: t3 })
            };
            return await fetch(e2, a3).then((e3) => e3.json());
          },
          async _retrieveArkoseToken(e2) {
            return await a2.send("ai.retrieveArkoseToken", {
              dx: e2,
              config: this._config,
              accessToken: s2.ai.openaiSession.accessToken
            });
          },
          _getConfig() {
            const e2 = s2.feature.ae;
            if (typeof e2 != "string") return e2;
            try {
              return JSON.parse(atob(e2));
            } catch {
              return null;
            }
          },
          _actualizeConfigOnChanges() {
            o2.reaction(
              () => JSON.stringify(s2.feature.ae),
              () => {
                const e2 = this._getConfig();
                e2 && (this._config = e2);
              }
            );
          },
          async _allowArkoseIframe() {
            await i2.register({
              condition: { urlFilter: `${this._config.iframeUrl}*` },
              action: {
                type: "modifyHeaders",
                responseHeaders: [
                  { header: "content-security-policy", operation: "remove" },
                  { header: "permissions-policy", operation: "remove" }
                ]
              }
            });
          },
          async _generateProofToken({ seed: e2, difficulty: t3 }) {
            const n3 = await this._getScripts(), o3 = await this._getDpl(), i3 = await a2.send("ai.generateProofToken", {
              seed: e2,
              difficulty: t3,
              scripts: n3,
              dpl: o3
            });
            return `${this._config.pow.prefix}${i3}`;
          },
          async _getRequirementsProofToken() {
            return clearTimeout(this._requirementsProofTokenTimeout), this._requirementsProofTokenTimeout = setTimeout(
              () => this._requirementsProofToken = null,
              10 * r2.time.MINUTE
            ), this._requirementsProofToken || (this._requirementsProofToken = await this._generateProofToken({
              seed: Math.random().toString(),
              difficulty: "0"
            })), this._requirementsProofToken;
          },
          async _getScripts() {
            if (clearTimeout(this._scriptsTimeout), this._scriptsTimeout = setTimeout(
              () => this._scripts = null,
              r2.time.HOUR
            ), !this._scripts)
              try {
                const e2 = await fetch(this._config.chatUrl).then((e3) => e3.text());
                this._scripts = [...e2.matchAll(/src="([^"]*)"/g)].map(
                  (e3) => e3[1]
                );
              } catch (e2) {
                t2.error("failed to extract scripts", e2), this._scripts = [null];
              }
            return this._scripts;
          },
          async _getDpl() {
            const e2 = await this._getScripts();
            let t3;
            const n3 = this._config.pow;
            for (const a3 of e2)
              if (t3 = r2.noThrow(() => new URL(a3).searchParams.get(n3.$dpl)), t3)
                break;
            return t3 ? `${n3.$dpl}=${t3}` : null;
          }
        };
      })(), (() => {
        const { $ai: t2, $netRules: n2, $bus: a2 } = e;
        t2.controller = {
          async init() {
            t2.api.init(), await t2.arkoseController.init(), await this._registerNetRules();
          },
          countTextTokens: async (e2, t3) => await a2.send("ai.countTextTokens", e2, t3),
          async _registerNetRules() {
            await n2.register(
              [
                "https://chatgpt.com/backend-api/conversation",
                "https://chatgpt.com/*/chat-requirements"
              ].map((e2) => ({
                condition: { urlFilter: e2, resourceTypes: ["xmlhttprequest"] },
                action: {
                  type: "modifyHeaders",
                  requestHeaders: [
                    {
                      header: "origin",
                      operation: "set",
                      value: "https://chatgpt.com"
                    },
                    {
                      header: "referer",
                      operation: "set",
                      value: "https://chatgpt.com/"
                    },
                    {
                      header: "sec-fetch-site",
                      operation: "set",
                      value: "same-origin"
                    }
                  ]
                }
              }))
            );
          }
        };
      })(), (() => {
        const { $ai: t2, $utils: n2 } = e;
        t2.tokenizer = {
          async countTextTokens(e2, t3) {
            const a2 = this._ensureWorker(), o2 = n2.id.nano();
            return await new Promise((n3, i2) => {
              const r2 = (e3) => {
                e3.data && e3.data.resId === o2 && (a2.removeEventListener("message", r2), n3(e3.data.tokens));
              };
              a2.addEventListener("message", r2), a2.addEventListener("error", (e3) => i2(e3)), a2.postMessage({ text: e2, encoding: t3, reqId: o2 });
            });
          },
          _ensureWorker() {
            return this._worker || (this._worker = new Worker("/gpt-tokenizer.js")), clearTimeout(this._terminateWorkerTimer), this._terminateWorkerTimer = setTimeout(() => {
              this._worker && (this._worker.terminate(), this._worker = null);
            }, 10 * n2.time.MINUTE), this._worker;
          }
        };
      })(), (() => {
        const {
          $analytics: t2,
          $bus: n2,
          $env: a2,
          $utils: o2,
          $tabs: i2,
          $ai: r2,
          $s: s2
        } = e;
        t2.controller = {
          init() {
            a2.is.bg && n2.on("analytics.send", this.send, this);
          },
          sendInstall() {
            this.send("install");
          },
          sendPageview() {
            this.send("pageview", { domain: i2.proxy.currentTabDomain });
          },
          sendCommandRun(e2) {
            const t3 = this._commandPayload(e2);
            this.send("command-run", t3);
          },
          sendCommandStepAnalytics(e2) {
            this.send(e2.analytics);
          },
          sendCommandUpdated(e2) {
            const t3 = e2.fresh ? "command-created" : "command-updated", n3 = this._commandPayload(e2);
            this.send(t3, n3);
          },
          sendCommandStepAdded(e2) {
            this.send("command-step-added", { type: e2 });
          },
          sendAutomate(e2, t3) {
            this.send("automate", { title: e2, url: t3 });
          },
          sendContextMenuClick(e2) {
            this.send("context-menu-click", { menuItemId: e2 });
          },
          sendGrabClick() {
            this.send("grab-click", { domain: i2.proxy.currentTabDomain });
          },
          sendChatAsk(e2, { hasImage: t3 = false } = {}) {
            const n3 = s2.billing.hasXPlan() ? "x" : s2.billing.hasSPlan() ? "s" : "free", a3 = r2.api?.openaiSession?.plus, o3 = `${e2.type}:${e2.selectedModelId || e2.slug || e2.selectedOption?.id || "default"}`;
            this.send("chat-ask", { plan: n3, plus: a3, type: o3, hasImage: t3 });
          },
          sendError(e2, t3 = "unspecified", n3 = {}) {
            const a3 = o2.is.string(e2) ? e2 : e2.message;
            this.send("error", { message: a3, actor: t3, ...n3 });
          },
          sendNoteShown(e2) {
            this.send("note-shown", { noteId: e2 });
          },
          sendNoteAcknowledged(e2) {
            this.send("note-acknowledged", { noteId: e2 });
          },
          sendNoteClicked(e2) {
            this.send("note-clicked", { noteId: e2 });
          },
          sendNoteClosed(e2) {
            this.send("note-closed", { noteId: e2 });
          },
          async send(e2, n3 = null) {
            n3 = { env: a2.env, locus: a2.locus, version: a2.version, ...n3 };
            const i3 = {
              time: Date.now(),
              token: a2.mixpanel.token,
              distinct_id: s2.agentId || ""
            };
            if ((e2 = o2.ensureArray(e2 || []).map((e3) => typeof e3 == "string" ? { event: e3 } : e3).map((e3) => ({ ...e3, ...n3 })).filter((e3) => !!e3.event).map((e3) => ({
              event: e3.event,
              properties: { $insert_id: o2.id.uuid(), ...i3, ...e3 }
            })).filter((e3) => this._shouldSend(e3))).length !== 0)
              return e2.forEach((e3) => delete e3.properties.event), e2 = this._breakBySize(e2), this._logToConsole(e2), Promise.all(
                e2.map(async (e3) => {
                  try {
                    await fetch("https://api.mixpanel.com/track?ip=1", {
                      method: "POST",
                      headers: {
                        accept: "text/plain",
                        "content-type": "application/json"
                      },
                      body: JSON.stringify(e3)
                    });
                  } catch (n4) {
                    t2.warn("sending event failed", e3, n4?.message);
                  }
                })
              );
          },
          _commandPayload(e2) {
            const t3 = { title: e2.meta.title, category: e2.meta.category };
            return t3.category === "User" && (t3.steps = o2.string.shorten(
              e2.steps.map((e3) => e3.type?.toUpperCase()).join(" \u2022 "),
              255
            )), t3;
          },
          _breakBySize(e2, t3 = 50) {
            const n3 = [];
            let a3 = 0;
            for (; a3 < e2.length; ) n3.push(e2.slice(a3, a3 + t3)), a3 += t3;
            return n3;
          },
          _logToConsole(e2) {
            if (!a2.is.development) return;
            const n3 = /* @__PURE__ */ new Set([
              "$insert_id",
              "distinct_id",
              "env",
              "locus",
              "time",
              "token",
              "version"
            ]);
            for (const a3 of e2.flat()) t2.log(a3.event, o2.without(a3.properties, n3));
          },
          _shouldSend: (e2) => !!a2.is.development || e2.event !== "pageview" || s2.feature.enabled("analytics.pageview")
        };
      })(), (() => {
        const { $badge: t2, $bus: n2, $utils: a2, $mobx: o2, $s: i2 } = e;
        t2.controller = {
          init() {
            n2.on("badge.applyTheme", this._applyThemeToBadge.bind(this)), this._highlightedTabIds = /* @__PURE__ */ new Set(), this._highlightAutomatedTabBadges();
          },
          get hasUpdate() {
            return Boolean(i2.note.nextNote("*", true));
          },
          _applyThemeToBadge(e2) {
            chrome.action.setIcon({ path: this._getPath(e2) });
          },
          _highlightAutomatedTabBadges() {
            o2.reaction(
              () => i2.tasks.map((e2) => e2.inputs?.schedule.mediumId).filter((e2) => !!e2 && !this._highlightedTabIds.has(e2)),
              (e2) => {
                e2.length !== 0 && this._highlightTabsBadge(e2);
              },
              { fireImmediately: true }
            ), o2.reaction(
              () => this.hasUpdate,
              () => this._applyThemeToBadge(i2.theme),
              { fireImmediately: true }
            ), chrome.tabs.onUpdated.addListener((e2, t3) => {
              t3.status === "loading" && this._highlightedTabIds.has(e2) && this._highlightTabsBadge(e2);
            });
          },
          _highlightTabsBadge(e2) {
            const t3 = () => chrome.runtime.lastError;
            a2.ensureArray(e2).forEach((e3) => {
              this._highlightedTabIds.add(e3), chrome.action.setIcon(
                { tabId: e3, path: this._getPath("highlight") },
                t3
              ), chrome.action.setTitle(
                { tabId: e3, title: "This tab is automated by HARPA" },
                t3
              );
            });
          },
          _getPath(e2) {
            return !this.hasUpdate || e2 !== "day" && e2 !== "night" || (e2 += "-update"), { 48: `img/badges/badge-48-${e2}.png` };
          }
        };
      })(), (() => {
        const {
          $billing: t2,
          $env: n2,
          $bus: a2,
          $utils: o2,
          $netRules: i2,
          $s: r2
        } = e;
        t2.accountController = {
          async init() {
            this._saveSpaceConnectionsTimeouts = {}, this._accountUpdatedAt = null, this._updateAccount = o2.singleExecution(
              this._updateAccount,
              this
            ), await this._allowLoginIframeInsideExt(), await this._ensureSameSiteNoneForJwtCookie(), await this._updateAccount({ force: true }), this._updateAccountOnJwtCookieChange(), a2.on("billing.updateAccount", this._updateAccount, this), a2.on(
              "billing.saveSpaceConnections",
              this.saveSpaceConnections,
              this
            );
          },
          async _allowLoginIframeInsideExt() {
            await i2.register({
              condition: {
                initiatorDomains: [chrome.runtime.id],
                urlFilter: "https://harpa.ai/*",
                resourceTypes: ["sub_frame"]
              },
              action: {
                type: "modifyHeaders",
                responseHeaders: [
                  { header: "x-frame-options", operation: "remove" }
                ]
              }
            });
          },
          async _ensureSameSiteNoneForJwtCookie() {
            const e2 = await this._readJwtCookie();
            e2 && e2.sameSite !== "no_restriction" && await chrome.cookies.set({
              url: n2.jwtCookieUrl,
              expirationDate: o2.cookies.noExpirationDate(),
              name: e2.name,
              value: e2.value,
              secure: true,
              sameSite: "no_restriction"
            });
          },
          async _updateAccount({ force: e2 = false } = {}) {
            const n3 = (await this._readJwtCookie())?.value || null, a3 = Date.now() - (this._accountUpdatedAt || 0);
            if (!(e2 || n3 !== r2.billing.jwt || a3 > o2.time.HOUR)) return;
            if (!n3)
              return void r2.transaction(() => {
                r2.billing.jwt = null, r2.billing.account = null, r2.settings.singleChat = false;
              });
            r2.billing.jwt = n3;
            const i3 = await t2.apiProxy.call(
              "/auth/account?withConnections=true",
              { auth: true }
            );
            i3.status === "ok" && (this._accountUpdatedAt = Date.now()), r2.transaction(() => {
              if (i3.status !== "ok")
                return r2.billing.jwt = null, r2.billing.account = null, void (r2.settings.singleChat = false);
              const e3 = i3.account;
              e3.stats.pm = Math.max(
                e3.stats.pm,
                r2.billing.account?.stats?.pm || 0
              );
              const t3 = r2.billing.account?.spaces || [];
              r2.billing.account = e3;
              const n4 = r2.billing.account?.spaces || [];
              if (!r2.ai.connectionsSavedAccountIds.includes(e3.id)) {
                r2.ai.connectionsSavedAccountIds.push(e3.id);
                if (!n4.some((e4) => e4.connections.length > 0)) {
                  const e4 = n4.filter(
                    (e5) => e5.ownerId === r2.billing.account?.id
                  );
                  for (const t4 of e4)
                    t4.applyAiConnections(), this.saveSpaceConnections(t4.id);
                }
              }
              for (const e4 of t3) {
                if (!e4.hasUnsavedChanges) continue;
                const t4 = n4.find((t5) => t5.id === e4.id);
                t4 && (t4.connections = e4.connections, t4.initialConnectionId = e4.initialConnectionId, this.saveSpaceConnections(t4.id));
              }
              for (const e4 of t3) {
                const t4 = n4.find((t5) => t5.id === e4.id);
                if (!t4) continue;
                const a4 = e4.initialConnectionId, o3 = t4.initialConnectionId;
                a4 !== o3 && (r2.settings.spaceConnectionId = o3);
              }
              r2.ai.applySpaceConnections(r2.billing.space), e3.spaces.find((e4) => e4.id === r2.billing.spaceId) || r2.billing.switchToSpace(e3.spaces[0]?.id);
            });
          },
          saveSpaceConnections(e2) {
            const t3 = r2.billing.account;
            if (!t3) return;
            const n3 = r2.billing.getSpace(e2);
            n3 && t3.id === n3.ownerId && (clearTimeout(this._saveSpaceConnectionsTimeouts[e2]), this._saveSpaceConnectionsTimeouts[e2] = setTimeout(
              () => this._saveSpaceConnectionsDebounced(n3),
              1e3
            ));
          },
          async _saveSpaceConnectionsDebounced(e2) {
            e2.hasUnsavedChanges = true;
            const n3 = (e2.connections || []).map(
              (e3) => o2.without(e3, "showAdvanced")
            ), a3 = e2.initialConnectionId ?? null, { status: i3 } = await t2.apiProxy.call(`/auth/spaces/${e2.id}`, {
              auth: true,
              method: "PATCH",
              body: { connections: n3, initialConnectionId: a3 }
            });
            i3 === "ok" && delete e2.hasUnsavedChanges;
          },
          _updateAccountOnJwtCookieChange() {
            let e2;
            chrome.cookies.onChanged.addListener(({ cookie: t3 }) => {
              t3 && t3.domain === n2.jwtCookieDomain && t3.name === "jwt" && (clearTimeout(e2), e2 = setTimeout(() => this._updateAccount(), 500));
            });
          },
          _readJwtCookie: async () => await chrome.cookies.get({ url: n2.jwtCookieUrl, name: "jwt" })
        };
      })(), (() => {
        const { $billing: t2, $mobx: n2, $utils: a2, $s: o2 } = e;
        t2.agentController = {
          init() {
            this.pushHrpCookie(), this.updateHrpCookie();
          },
          pushHrpCookie() {
            n2.reaction(
              () => o2.billing.hrpCookie,
              (e2) => {
                e2 = btoa(JSON.stringify(e2) || ""), chrome.cookies.set({
                  url: "https://harpa.ai",
                  name: "__hrp",
                  expirationDate: a2.cookies.noExpirationDate(),
                  value: e2
                });
              },
              { fireImmediately: false }
            );
          },
          async updateHrpCookie() {
            o2.billing.hrpCookie = { agentId: o2.agentId };
          }
        };
      })(), (() => {
        const { $billing: t2 } = e;
        t2.controller = {
          async init() {
            t2.agentController.init(), t2.plansController.init(), t2.powerMessageController.init(), t2.standardMessageController.init(), t2.upsellController.init(), await t2.accountController.init();
          }
        };
      })(), (() => {
        const { $billing: t2, $bus: n2, $utils: a2, $s: o2 } = e;
        t2.plansController = {
          init() {
            this.updatePlans(), n2.on("billing.updatePlans", this.updatePlans, this);
          },
          async updatePlans({ force: e2 = false, pricing: n3 = false } = {}) {
            const i2 = Date.now() - (this._lastUpdatedAt || 0);
            if (!e2 && i2 < a2.time.HOUR) return;
            let r2 = `/billing/plans?pricing=${n3}`;
            o2.billing.plansHash && (r2 += `&hash=${o2.billing.plansHash}`);
            const s2 = await t2.apiProxy.call(r2);
            s2.status === "ok" && (this._lastUpdatedAt = Date.now(), s2.plans && (o2.billing.plans = s2.plans, o2.billing.plansHash = s2.hash, n3 && (o2.billing.pricingLastUpdatedAt = Date.now())));
          }
        };
      })(), (() => {
        const { $billing: t2, $mobx: n2, $s: a2 } = e;
        t2.powerMessageController = {
          init() {
            n2.reaction(
              () => a2.billing.account?.stats?.pm,
              this._synchValue.bind(this),
              { fireImmediately: false }
            );
          },
          async reducePowerMessages() {
            try {
              const e2 = await t2.apiProxy.call("/auth/account/rpm", {
                method: "POST",
                auth: true
              }), n3 = a2.billing.account;
              n3 && e2.stats && n3.stats.pm !== e2.stats.pm && (a2.billing.account.stats.pm = e2.stats.pm);
            } catch {
              t2.error("failed reducing pm count");
            }
          },
          async _synchValue(e2) {
            if ((e2 = Number(e2) || 0) <= 0) return;
            if (e2 > (a2.feature["billing.pm"].max || 0)) return;
            const n3 = { pm: e2 };
            try {
              const e3 = await t2.apiProxy.call("/auth/account/stats", {
                body: n3,
                auth: true
              }), o2 = a2.billing.account;
              o2 && e3.stats && o2.stats.pm !== e3.stats.pm && (a2.billing.account.stats.pm = e3.stats.pm);
            } catch {
              t2.error("failed updating pm count");
            }
          }
        };
      })(), (() => {
        const { $billing: t2, $utils: n2, $mobx: a2, $s: o2 } = e;
        t2.standardMessageController = {
          init() {
            this.cookie = { url: "https://app.harpa.ai", name: "__sm" }, this._synchToCookie(), this._scheduleReduce();
          },
          async _synchToCookie() {
            const e2 = await chrome.cookies.get(this.cookie), t3 = Number(e2?.value) || 0;
            t3 && t3 > o2.billing.standardMessages && o2.transaction((e3) => e3.billing.standardMessages = t3), a2.reaction(
              () => o2.billing.standardMessages,
              this._saveToCookies.bind(this),
              { fireImmediately: true }
            );
          },
          _saveToCookies(e2) {
            chrome.cookies.set({
              ...this.cookie,
              expirationDate: n2.cookies.noExpirationDate(),
              value: String(e2)
            });
          },
          async _scheduleReduce() {
            n2.chrome.alarms.run(this._reduceStandardMessages.bind(this), {
              name: "billing.sm",
              delayInMinutes: 60,
              periodInMinutes: 60
            });
          },
          _reduceStandardMessages() {
            if (!o2.feature.enabled("billing.sm")) return true;
            const { max: e2, recover: t3 } = o2.feature["billing.sm"], a3 = o2.billing.standardMessageRecoveryAt || Date.now() - n2.time.HOUR, i2 = (Date.now() - a3) / n2.time.DAY * t3;
            o2.transaction((t4) => {
              t4.billing.standardMessages = n2.number.minmax(
                t4.billing.standardMessages - i2,
                0,
                e2
              ), t4.billing.standardMessageRecoveryAt = Date.now();
            });
          }
        };
      })(), (() => {
        const { $billing: t2, $mobx: n2, $s: a2 } = e;
        t2.upsellController = {
          init() {
            this._handleUpsellDisabled();
          },
          _handleUpsellDisabled() {
            let e2;
            n2.reaction(
              () => a2.billing.upsell.disabledTill,
              (t3) => {
                clearTimeout(e2), t3 && (e2 = setTimeout(
                  () => a2.billing.upsell.disabledTill = null,
                  t3 - Date.now()
                ));
              },
              { fireImmediately: true }
            );
          }
        };
      })(), (() => {
        const { $billing: t2, $env: n2, $s: a2 } = e;
        t2.apiProxy = {
          async call(e2, t3) {
            const o2 = {
              method: t3?.method || (t3?.body ? "POST" : "GET"),
              headers: { "Content-Type": "text/plain" }
            };
            if (t3?.auth) {
              const e3 = a2.billing.jwt;
              if (!e3) return { status: "unauthorized", error: "no jwt token" };
              o2.headers.Authorization = `Bearer ${e3}`;
            }
            return t3?.body && (o2.body = JSON.stringify(t3.body), o2.headers["Content-Type"] = "application/json"), await fetch(`${n2.apiUrl}${e2}`, o2).then((e3) => e3.json()).then((e3) => ({ status: "nok", ...e3 })).catch((e3) => ({ status: "error", error: e3 }));
          }
        };
      })(), (() => {
        const {
          $browser: t2,
          $bus: n2,
          $engine: a2,
          $store: o2,
          $sidePanel: i2,
          $s: r2
        } = e;
        t2.controller = {
          init() {
            this._browser = null, this._pages = /* @__PURE__ */ new Map(), this._cleanupDestroyedPages(), this._handleExtButtonClick(), n2.on("browser.showFrame", this.showFrame, this), n2.on("browser.hideFrame", this.hideFrame, this), n2.on("browser.toggleFrame", this.toggleFrame, this), n2.on("browser.setFrameWidth", this.setFrameWidth, this), n2.on("browser.connectTab", this._connectTabNoReturn, this), n2.on("browser.ejectFrame", this._ejectFrame, this);
          },
          get browser() {
            return this._browser ? this._browser : this._browser = new a2.Browser();
          },
          async connectTab(e2) {
            let t3 = this._pages.get(e2);
            if (t3) return t3;
            const n3 = {
              mediumId: e2,
              autoCloseTab: false,
              muter: false,
              waitForDocumentBody: true,
              waitForDocumentReady: false,
              noPatches: true
            };
            return t3 = await this.browser.newPage(n3), this._pages.set(e2, t3), this._initTabState(e2), t3;
          },
          async createTab(e2, t3 = {}) {
            t3 = {
              ...t3,
              mediumType: "tab",
              autoCloseTab: false,
              muter: false,
              waitForDocumentBody: true,
              waitForDocumentReady: false,
              noPatches: true
            };
            const n3 = await this.browser.newPage(e2, t3);
            return this._pages.set(n3.mediumId, n3), this._initTabState(n3.mediumId), n3;
          },
          async showFrame(e2) {
            await this.toggleFrame(e2, true);
          },
          async hideFrame(e2) {
            await this.toggleFrame(e2, false);
          },
          async toggleFrame(e2, t3) {
            if (!!await n2.send(e2, "sidePanel.isOpen")) return;
            await this.connectTab(e2);
            const a3 = r2.tabs[e2];
            a3 && (a3.creator.trapper.grabbing = false, a3.creator.screen !== "trapper" && (await this._injectFrame(e2), a3.creator.frame.open = t3 ?? !a3.creator.frame.open));
          },
          async setFrameWidth(e2, t3) {
            const n3 = await this.connectTab(e2);
            await n3.frame.setWidth(t3);
          },
          async _injectFrame(e2) {
            const t3 = await this.connectTab(e2);
            await t3.frame.injected() || (r2.tabs[e2].creator.frame.open = false, await t3.frame.inject());
          },
          async _ejectFrame(e2) {
            const t3 = await this.connectTab(e2);
            await t3.frame.injected() && await t3.frame.eject();
          },
          async _connectTabNoReturn(e2) {
            await this.connectTab(e2);
          },
          _cleanupDestroyedPages() {
            chrome.tabs.onRemoved.addListener((e2) => {
              const t3 = this._pages.get(e2);
              t3 && (t3.isClosed || t3.close(), this._pages.delete(t3));
            });
          },
          _handleExtButtonClick() {
            chrome.action.onClicked.addListener(async (e2) => {
              const t3 = e2.url.startsWith("https://app.harpa.ai/");
              if (a2.isAutomatable(e2.url) && !t3) {
                if (r2.settings.preferSidePanel) {
                  const t4 = n2.send(e2.id, "sidePanel.isOpen");
                  await i2.controller.open(e2.id);
                  !!await t4 && await i2.controller.close(e2.id);
                } else await this.toggleFrame(e2.id);
                return;
              }
              const o3 = await new Promise((e3) => {
                chrome.tabs.query(
                  { url: "https://app.harpa.ai/*", currentWindow: true },
                  (t4) => e3(t4[0] || null)
                );
              });
              o3 && !o3.url.includes("#") ? chrome.tabs.update(o3.id, { active: true }) : chrome.tabs.create({
                url: `https://app.harpa.ai/?t=${r2.theme}`,
                active: true
              });
            });
          },
          _initTabState(e2) {
            r2.tabs[e2] || (r2.tabs[e2] = o2.template.tab(e2));
          }
        };
      })(), (() => {
        const { $capture: t2, $bus: n2, $browser: a2, $utils: o2 } = e;
        t2.controller = {
          init() {
            this._capture = o2.singleExecution(this._capture, this), n2.on("capture.attachArea", this.attachArea, this), n2.on("capture.attachView", this.attachView, this), n2.on("capture.captureArea", this.captureArea, this), n2.on("capture.captureView", this.captureView, this);
          },
          async attachArea(e2, t3) {
            const a3 = await this.captureArea(e2, t3);
            a3 && await n2.send(e2, "chat.attach", [a3]);
          },
          async attachView(e2) {
            const t3 = await this.captureView(e2);
            t3 && await n2.send(e2, "chat.attach", [t3]);
          },
          async captureArea(e2, t3) {
            return await this._capture(e2, "area", t3);
          },
          async captureView(e2) {
            return await this._capture(e2, "view");
          },
          async _capture(e2, t3, i2 = null) {
            const r2 = (async () => {
              await a2.controller.hideFrame(e2), await n2.poll(e2, "startup.ppReady");
            })(), s2 = async () => {
              await r2, await a2.controller.showFrame(e2);
            };
            let l2;
            if (await Promise.all([
              n2.send(e2, "startup.insert", "/nj-engine.js"),
              n2.send(e2, "startup.insert", "/nj-engine.css")
            ]), t3 === "area") {
              if (l2 = await n2.send(e2, "capture.selectArea", i2), !l2)
                return await s2(), null;
            } else t3 === "view" && await o2.sleep(300);
            if (!await n2.send(e2, "capture.requestPermission"))
              return await s2(), null;
            let c2 = await n2.send(e2, "capture.takeScreenshot");
            return t3 === "area" && (c2 = await o2.image.crop(c2, {
              x: l2.x,
              y: l2.y,
              width: l2.width,
              height: l2.height
            })), await s2(), c2;
          }
        };
      })(), (() => {
        const { $chat: t2, $utils: n2, $s: a2 } = e;
        t2.contextualize = async (e2, t3, o2, i2) => {
          if (!t3) return "\u2014";
          if ((i2 = i2 || 0) <= 10 || i2 === Number.MAX_SAFE_INTEGER)
            return t3.replace(/ +/g, " ");
          const r2 = a2.chats.getByTabId(e2), s2 = await r2.connection.countTextTokens(t3);
          if (s2 <= i2) return t3.replace(/ +/g, " ");
          const l2 = t3.length / s2;
          let c2 = n2.chunkify(t3, (e3) => e3.length / l2 < 250);
          if (c2.length === 0) return "\u2014";
          o2 = o2.trim().toLowerCase();
          let u2 = 0;
          c2 = c2.map((e3, t4) => ({ text: e3, index: t4 }));
          for (const e3 of c2) {
            e3.tokens = await r2.connection.countTextTokens(e3.text) + 1;
            const t4 = e3.text.toLowerCase().match(/.*?[.!?][\s\n\t]+|.*$/gs).filter((e4) => e4.length > 0).map((e4) => e4.split("\n")).flat().filter(Boolean);
            t4.push(e3.text);
            const a3 = t4.map((e4) => 100 * n2.stringSimilarity(e4.toLowerCase(), o2));
            e3.weight = a3.reduce((e4, t5) => Math.max(e4, t5), 0), u2 < 300 && (e3.weight *= 1.2, u2 += e3.tokens);
          }
          let p2 = [];
          const d2 = [...c2];
          c2 = c2.sort((e3, t4) => t4.weight - e3.weight);
          const m2 = (e3) => {
            !e3 || e3.taken || e3.tokens > i2 || (e3.taken = true, i2 -= e3.tokens, p2.push(e3));
          };
          for (; i2 > 0; ) {
            const e3 = c2.findIndex((e4) => !e4.taken && e4.tokens <= i2), t4 = c2[e3];
            if (!t4) break;
            const n3 = d2[t4.index + 1], a3 = d2[t4.index - 1];
            m2(t4), m2(n3), m2(a3);
          }
          return p2 = p2.sort((e3, t4) => e3.index - t4.index), p2 = p2.reduce((e3, t4) => {
            const n3 = e3.at(-1);
            return n3 && n3.index === t4.index - 1 ? (n3.index = t4.index, n3.text += t4.text) : e3.push(t4), e3;
          }, []), p2.map((e3) => e3.text).join(" \u2026 ").replace(/ +/g, " ");
        };
      })(), (() => {
        const { $chat: t2 } = e;
        t2.errors = {
          csp: "csp",
          oldVersion: "old-version",
          tooManyRequests: "too-many-requests",
          commandConfigError: "command-config-error",
          functionsNotSupported: "functions-not-supported",
          visionNotSupported: "vision-not-supported",
          openaiLogin: "openai-login",
          openaiCloudflare: "openai-cloudflare",
          openaiBadModel: "openai-bad-model",
          openaiBadApiKey: "openai-bad-api-key",
          openaiChatNotFound: "openai-chat-not-found",
          openaiServerError: "openai-server-error",
          openaiSessionFailedToFetch: "openai-session-failed-to-fetch",
          openaiLicenseFailedToFetch: "openai-license-failed-to-fetch",
          openaiRequestsLimit: "openai-requests-limit",
          openaiMessageTooLong: "openai-message-too-long",
          openaiSwitchToWssRequired: "openai-switch-to-wss-required",
          openaiTooManyRequestsFiles: "openai-too-many-requests-files",
          geminiLogin: "gemini-login",
          geminiNoAccess: "gemini-no-access",
          geminiUnexpected: "gemini-unexpected",
          claudeLogin: "claude-login",
          claudeBadModel: "claude-bad-model",
          claudeUnexpected: "claude-unexpected",
          claudeFreeLimitExceeded: "claude-free-limit-exceeded",
          cloudgptNetwork: "cloudgpt-network",
          cloudgptUnknown: "cloudgpt-unknwon",
          cloudgptUnexpected: "cloudgpt-unexpeceted",
          cloudgptNoLogin: "cloudgpt-no-login",
          cloudgptNoSpace: "cloudgpt-no-space",
          cloudgptNoTokens: "cloudgpt-no-tokens",
          cloudgptFunctionsNotSupported: "functions-not-supported",
          cloudgptFailedToReadResponse: "cloudgpt-failed-to-read-response"
        };
      })(), (() => {
        const { $chat: t2, $utils: n2, $s: a2 } = e;
        t2.paramAssert = ({ tabId: e2, args: o2 }) => {
          const i2 = a2.chats.getByTabId(e2), [r2, s2] = o2.trim().split(/\s+/), l2 = i2.getParam(s2);
          if (r2 === "exists") return n2.is.defined(l2);
          if (r2 === "text") {
            const e3 = t2.attachmentsController.getPlaceholderRegex(), a3 = l2.replaceAll(e3, "");
            return !n2.is.empty(a3);
          }
          if (r2 === "image") {
            const e3 = t2.attachmentsController.getPlaceholderRegex();
            return (l2.match(e3) || []).length > 0;
          }
          return false;
        };
      })(), (() => {
        const { $chat: t2, $utils: n2, $mobx: a2, $s: o2 } = e;
        t2.paramConnection = (e2) => {
          const t3 = o2.chats.getByTabId(e2.tab.id), i2 = n2.without(a2.toJS(t3.connection), ["showAdvanced"]);
          return i2.label = t3.connection.label, i2;
        };
      })(), (() => {
        const { $chat: t2, $utils: n2, $s: a2 } = e;
        t2.paramContext = async (e2) => {
          const o2 = a2.chats.getByTabId(e2.tab.id), i2 = await t2.paramPage(e2, { noPageTitle: true });
          if (!i2) return "\u2014";
          let r2 = e2.maxTokens || 0;
          if (r2 <= 10) return i2;
          const s2 = await o2.connection.countTextTokens(i2);
          if (s2 <= r2) return i2;
          const l2 = i2.length / s2;
          let c2 = n2.chunkify(i2, (e3) => e3.length / l2 < 100);
          if (c2.length === 0) return "\u2014";
          const u2 = ((e2.args || "").trim() || (e2.prompt || "").trim()).toLowerCase();
          let p2 = 0;
          c2 = c2.map((e3, t3) => ({ text: e3, index: t3 }));
          for (const e3 of c2) {
            e3.tokens = await o2.connection.countTextTokens(e3.text) + 1;
            const t3 = e3.text.toLowerCase().match(/.*?[.!?][\s\n\t]+|.*$/gs).filter((e4) => e4.length > 0).map((e4) => e4.split("\n")).flat().filter(Boolean);
            t3.push(e3.text);
            const a3 = t3.map((e4) => 100 * n2.stringSimilarity(e4.toLowerCase(), u2));
            e3.weight = a3.reduce((e4, t4) => Math.max(e4, t4), 0), p2 < 300 && (e3.weight *= 1.2, p2 += e3.tokens);
          }
          let d2 = [];
          const m2 = [...c2];
          c2 = c2.sort((e3, t3) => t3.weight - e3.weight);
          const h = (e3) => {
            !e3 || e3.taken || e3.tokens > r2 || (e3.taken = true, r2 -= e3.tokens, d2.push(e3));
          };
          for (; r2 > 0; ) {
            const e3 = c2.findIndex((e4) => !e4.taken && e4.tokens <= r2), t3 = c2[e3];
            if (!t3) break;
            const n3 = m2[t3.index + 1], a3 = m2[t3.index - 1];
            h(t3), h(n3), h(a3);
          }
          return d2 = d2.sort((e3, t3) => e3.index - t3.index), d2 = d2.reduce((e3, t3) => {
            const n3 = e3.at(-1);
            return n3 && n3.index === t3.index - 1 ? (n3.index = t3.index, n3.text += t3.text) : e3.push(t3), e3;
          }, []), d2.map((e3) => e3.text).join(" \u2026 ");
        };
      })(), (() => {
        const { $chat: t2, $s: n2 } = e;
        t2.paramCost = (e2) => {
          let t3 = n2.chats.getByTabId(e2.tab.id).messagesAfterReset.filter((e3) => e3.usage);
          const a2 = e2.args, o2 = a2 === "" ? "all" : a2 === "last" ? t3.length - 1 : a2 === "first" ? 0 : Number(a2);
          o2 === "all" || isNaN(o2) || (t3 = t3.slice(o2, o2 + 1).filter((e3) => Boolean(e3)));
          const i2 = { input: 0, output: 0, total: 0 };
          return t3.forEach((e3) => {
            i2.input += e3.usage.input || 0, i2.output += e3.usage.output || 0, i2.total += e3.usage.total || 0;
          }), i2;
        };
      })(), (() => {
        const { $chat: t2 } = e;
        t2.paramDate = () => (/* @__PURE__ */ new Date()).toLocaleDateString("en-US", {
          year: "numeric",
          month: "long",
          day: "2-digit"
        });
      })(), (() => {
        const { $chat: t2 } = e;
        t2.paramPageEmail = async (e2) => {
          try {
            const r2 = await e2.page.url(), s2 = e2.page.mediumId;
            return t2.testUrl.regexGMail.test(r2) ? await chrome.executeScript(s2, n2) : t2.testUrl.regexOutlook.test(r2) ? await chrome.executeScript(s2, a2) : t2.testUrl.regexProtonmail.test(r2) ? await chrome.executeScript(s2, o2) : t2.testUrl.regexFastmail.test(r2) ? await chrome.executeScript(s2, i2) : void 0;
          } catch (e3) {
            return;
          }
        };
        const n2 = async () => {
          const e2 = document.querySelectorAll(
            '[href^="https://accounts.google.com/"]'
          ), t3 = Array.from(e2).map((e3) => e3.getAttribute("aria-label").split(": ")[1].trim()).join("").replace(/[\n\r]/g, "");
          const n3 = document.querySelector('span.g3[role="gridcell"]')?.getAttribute("title") || null;
          let a3 = window.location.href.match(/[^/\s]{20,}(?=[^/]*$)/), o3 = a3 ? a3[0] : null, i3 = Array.from(
            document.querySelectorAll("div[role=listitem] [data-message-id]")
          ).at(-1);
          if (!i3) return null;
          const r2 = i3.querySelector("table"), s2 = Array.from(r2.querySelectorAll('[role="gridcell"]')).at(
            0
          )?.innerText, l2 = Array.from(r2.querySelectorAll("table")).at(-1)?.innerText;
          let c2 = i3.querySelector('[aria-label="Show trimmed content"]');
          c2 && window.$harpa && await window.$harpa.simulator.click(c2);
          const u2 = Array.from(
            document.querySelectorAll(
              'div[role=listitem] table[role="presentation"]'
            )
          ), p2 = { table: null, parent: null };
          u2.length > 0 && (p2.table = u2.at(-1), p2.parent = p2.table.parentElement, p2.table.remove());
          const d2 = (e3) => {
            if (!e3) return e3;
            const t4 = e3.split("\n").map((e4) => e4.trim()).filter((e4) => !e4.startsWith("Translate to ")).filter(
              (e4) => ![
                "You can't react to a message with a reply-to address",
                "You can't react with an emoji to a group"
              ].includes(e4)
            );
            return t4.reduce(
              (e4, n4, a4) => (n4 === "" && t4[a4 - 1] === "" || e4.push(n4), e4),
              []
            ).join("\n").replaceAll(/\n\s+/g, "\n");
          };
          let m2 = d2(i3.innerText);
          const h = d2(i3.querySelector(".gmail_quote")?.innerText);
          h && (m2 = m2.split(h).shift().trim()), l2 ? m2 = m2.split(l2).pop().trim() : s2 && (m2 = m2.split(s2).pop().trim()), p2.table && p2.parent.appendChild(p2.table), c2 && window.$harpa && await window.$harpa.simulator.click(c2);
          return {
            user: t3,
            id: o3,
            sentTime: n3,
            from: s2,
            to: l2,
            subject: Array.from(
              document.querySelectorAll(
                'h2[tabindex="-1"][data-thread-perm-id]'
              )
            ).at(-1)?.innerText?.trim() || "No subject",
            content: m2,
            history: h
          };
        }, a2 = async () => {
          let e2 = null;
          const t3 = document.querySelector("#meInitialsButton");
          t3 && (t3.click(), await new Promise((e3) => setTimeout(e3, 100)), e2 = [
            document.querySelector("#mectrl_currentAccount_primary")?.textContent,
            document.querySelector("#mectrl_currentAccount_secondary")?.textContent
          ].filter(Boolean).join(" ") || null, t3.click());
          let n3 = window.location.href.match(/[^/\s]{20,}(?=[^/]*$)/), a3 = n3 ? n3[0] : null;
          const o3 = Array.from(
            document.querySelectorAll('[data-testid="SentReceivedSavedTime"]')
          ), i3 = document.querySelector("div[role=heading].allowTextSelection")?.innerText || null, r2 = o3.map((e3) => {
            const t4 = e3.textContent.trim(), n4 = e3.closest(
              '[data-app-section="ConversationContainer"] > div > div > div'
            ) || e3.closest('[aria-label="Email message"]') || e3.closest(".wide-content-host");
            return {
              from: (Array.from(n4.querySelectorAll("span[role=button]")).at(1) || n4.querySelector(
                ".allowTextSelection > span > div > span"
              ) || n4.querySelector(".OZZZK"))?.textContent?.trim() || "",
              time: t4,
              content: (n4.querySelector("[role=document]")?.innerText || (n4.innerText || "").split("\n")[3] || "").replaceAll(/\n\s+/g, "\n")
            };
          });
          if (r2.length === 0) return null;
          const s2 = r2.at(-1).time || null, l2 = r2.at(-1)?.from || null, c2 = r2.at(-1)?.content || null;
          r2.pop();
          return {
            user: e2,
            id: a3,
            sentTime: s2,
            from: l2,
            subject: i3,
            content: c2,
            history: r2
          };
        }, o2 = async () => {
          const e2 = document.querySelector("button.user-dropdown-button")?.getAttribute("title") || null, t3 = document.querySelector("h1.message-conversation-summary-header")?.getAttribute("title") || null, n3 = window.location.href.match(/[^/\s]{20,}(?=[^/]*$)/), a3 = n3 ? n3[0] : null, o3 = Array.from(document.querySelectorAll("time")).at(-1)?.getAttribute("datetime") || null, i3 = Array.from(document.querySelectorAll("article")).at(-1), r2 = (i3.querySelector(".message-recipient-item") || i3.querySelector('[data-testid="recipients:sender"]'))?.getAttribute("title") || null;
          let s2 = document.body.innerText;
          const l2 = (document.querySelector(".message-content iframe") || document.querySelector(
            '[data-testid="message-content:body"] iframe'
          ))?.contentWindow?.document?.body;
          return l2 && (s2 = l2.innerText.trim() || l2.textContent.trim(), s2 = s2.replace("Show original message", "").replaceAll(/\n\s+/g, "\n").trim()), { user: e2, id: a3, sentTime: o3, from: r2, subject: t3, content: s2 };
        }, i2 = async () => {
          const e2 = document.querySelector(".v-MainNavToolbar-userName")?.textContent || null;
          let t3 = window.location.href.match(/[^/\s]{20,}(?=[^/]*$)/), n3 = t3 ? t3[0] : null;
          if (document.querySelector(".v-Thread-title") || document.querySelector(".v-MessageCard")) {
            const t4 = document.querySelector(".v-Thread-title")?.innerText || null;
            let a3 = Array.from(document.querySelectorAll(".v-MessageCard")).map(
              (e3) => ({
                from: e3.querySelector(".v-MessageCard-from")?.innerText || null,
                time: e3.querySelector(".v-MessageCard-time")?.innerText || null,
                content: (e3.querySelector(".v-Message-body > div > div")?.innerText || e3.querySelector(".v-MessageCard-preview")?.innerText || "").replaceAll(/\n\s+/g, "\n")
              })
            );
            if (a3.length === 0) return null;
            const o3 = a3.at(-1).time || null, i3 = a3.at(-1)?.from || null, r2 = a3.at(-1)?.content || null;
            a3.pop();
            return {
              user: e2,
              id: n3,
              sentTime: o3,
              from: i3,
              subject: t4,
              content: r2,
              history: a3
            };
          }
          if (document.querySelector(".v-Compose")) {
            const t4 = document.querySelector(
              ".v-Compose-section.s-compose-subject > div"
            )?.childNodes?.[0]?.textContent;
            let a3 = null, o3 = document.querySelector(".v-RichText blockquote")?.innerText.replaceAll(/\n\s+/g, "\n");
            if (o3) {
              a3 = o3.split(/On [^\n]+ wrote:\n/)[0], o3 = o3.substring(a3.length);
            }
            return { user: e2, id: n3, subject: t4, content: a3, history: o3 };
          }
          return null;
        };
      })(), (() => {
        const { $chat: t2, $s: n2 } = e;
        t2.paramGpt = (e2) => {
          const t3 = n2.chats.getByTabId(e2.tab.id).messagesAfterReset.filter((e3) => e3.type === "answer" || !e3.silent);
          let a2 = t3.findLastIndex(
            (e3) => e3.type === "answer" && e3.role === "assistant" && e3.done
          );
          if (-1 === a2) return "\u2014";
          const o2 = [t3[a2].text];
          for (; --a2 >= 0; ) {
            const e3 = t3[a2];
            if (e3.type !== "answer" || !e3.done) break;
            o2.unshift(e3.text);
          }
          return o2.join("\n\n");
        };
      })(), (() => {
        const { $chat: t2 } = e;
        t2.paramGrab = async (e2) => {
          const { selector: t3, take: a2, at: o2, by: i2 } = n2(e2), r2 = await e2.page.grab(t3, a2, o2, i2);
          return r2 === null ? "\u2014" : r2;
        };
        const n2 = (e2) => {
          let { args: t3 } = e2;
          const n3 = t3.match(/\s?by=(auto|css|xpath|text)/);
          let a2 = "auto";
          n3 && (a2 = n3[1], t3 = t3.replace(n3[0], ""));
          const o2 = t3.match(
            /\s?take=(innerText|textContent|id|class|className|nodeName|nodeType|attributes|styles|innerHTML|outerHTML|value|href|\[\w+]|\(\w+\))/
          );
          let i2 = "innerText";
          o2 && (i2 = o2[1], t3 = t3.replace(o2[0], ""));
          const r2 = t3.match(/\s?at=(all|first|last|-?\d+)/);
          let s2 = "first";
          r2 && (s2 = r2[1], t3 = t3.replace(r2[0], ""));
          return { selector: t3.trim(), take: i2, at: s2, by: a2 };
        };
      })(), (() => {
        const { $chat: t2 } = e;
        t2.paramPageInput = async (e2) => {
          try {
            return (await e2.page.input() || "").trim() || "\u2014";
          } catch (e3) {
            return "\u2014";
          }
        };
      })(), (() => {
        const { $chat: t2, $s: n2 } = e;
        t2.paramLanguage = () => n2.settings.promptLanguageValue;
      })(), (() => {
        const { $chat: t2, $utils: n2, $s: a2 } = e;
        t2.paramMessage = (e2) => {
          const o2 = a2.chats.getByTabId(e2.tab.id).messagesAfterReset.filter((e3) => !e3.silent).filter((e3) => !e3.system).filter((e3) => !!e3.text || !n2.is.empty(e3.attachments)), i2 = e2.args, r2 = i2 === "" || i2 === "last" ? o2.length - 1 : i2 === "first" ? 0 : Number(i2);
          if (isNaN(r2)) return "\u2014";
          const s2 = o2.at(r2);
          if (!s2) return "\u2014";
          const l2 = t2.attachmentsController.toPlaceholder(s2.attachments || []);
          return [s2.text || "", l2].filter(Boolean).join(" ") || "\u2014";
        };
      })(), (() => {
        const { $chat: t2 } = e;
        t2.paramPageDesc = async (e2) => [e2.tab?.title || "", await e2.page.description() || ""].filter(Boolean).filter((e3) => e3 !== "\u2014").join(" | ");
      })(), (() => {
        const { $chat: t2, $utils: n2 } = e;
        t2.paramPageDomain = (e2) => n2.url.getDomain(e2.tab?.url) || "Unknown Domain";
      })(), (() => {
        const { $chat: t2 } = e;
        t2.paramPageSelection = async (e2) => await e2.page.selection() || "\u2014";
      })(), (() => {
        const { $chat: t2 } = e;
        t2.paramPageTitle = async (e2) => e2.tab.title || await e2.page.title() || "\u2014";
      })(), (() => {
        const { $chat: t2 } = e;
        t2.paramPageUrl = (e2) => e2.tab?.url || "Unknown URL";
      })(), (() => {
        const { $chat: t2, $engine: n2 } = e;
        t2.paramPage = async (e2, c2 = {}) => {
          const { url: u2, query: p2, type: d2, maxTokens: m2, timeout: h } = a2(e2), g = `${d2}::${u2}`;
          let f = e2.cache?.get(g);
          return f ? t2.contextualize(e2.tab.id, f, p2, m2) : u2 ? (f = await t2.linkCacheController.fetchLink(e2.page, d2, u2, h), f && f !== "failed" ? await t2.contextualize(e2.tab.id, f, p2, m2) : "Failed fetching URL") : n2.isAutomatable(e2.tab.url) ? (f || true === c2.noPdf || (f = await r2(e2)), f || true === c2.noGdocs || (f = await s2(e2)), f || true === c2.noTranscript || (f = await l2(e2)), f || (f = await o2(e2)), p2 || (f = await i2(e2, f)), e2.cache?.set(g, f), t2.contextualize(e2.tab.id, f, p2, m2)) : "\u2014";
        }, t2.paramPagePreprocess = async (e2, n3) => {
          e2.cache = e2.cache || /* @__PURE__ */ new Map();
          const o3 = n3.map((e3) => a2({ args: e3.placeholder })).filter((e3) => Boolean(e3.url));
          await Promise.all(
            o3.map(
              (n4) => t2.linkCacheController.fetchLink(e2.page, n4.type, n4.url, n4.timeout)
            )
          );
        };
        const a2 = (e2) => {
          let {
            args: t3,
            query: n3,
            timeout: a3,
            url: o3,
            maxTokens: i3,
            type: r3
          } = e2;
          t3 = t3 || "";
          const s3 = t3.match(/\s?type=(render|fetch|html)/);
          s3 && (r3 = s3[1], t3 = t3.replace(s3[0], "")), r3 = r3 || "render";
          const l3 = t3.match(/\s?limit=(\d+)%?/);
          if (l3 && (i3 = l3[0].endsWith("%") ? Math.round(e2.modelMaxTokens * Number(l3[1]) / 100) : Number(l3[1]), e2.maxTokens && (i3 = Math.min(i3, e2.maxTokens)), t3 = t3.replace(l3[0], "")), void 0 === o3 && (o3 = ((e3) => (e3?.endsWith("}}") && (e3 = e3.slice(0, -2)), e3.split(" ").map((e4) => e4.trim()).filter(
            (e4) => e4.startsWith("https://") || e4.startsWith("http://")
          ).find((e4) => {
            try {
              return new URL(e4), true;
            } catch (e5) {
              return false;
            }
          })))(t3), o3 && (t3 = t3.replace(` ${o3}`, ""))), void 0 === a3) {
            const e3 = t3.match(/\s?timeout=(\d+)/);
            a3 = (e3 ? Number(e3[1]) : 5e3) || 5e3;
          }
          return void 0 === n3 && (n3 = (t3 || "").trim()), { url: o3, query: n3, type: r3, maxTokens: i3, timeout: a3 };
        }, o2 = async (e2) => await e2.page.markdown(), i2 = async (e2, t3) => {
          let [n3, a3, o3] = await Promise.all([
            e2.page.title(),
            e2.page.description(),
            e2.page.url()
          ]), i3 = [n3, a3, o3].filter(Boolean).join(" \u2014 ");
          return i3 = i3 && `<!-- ${i3} -->`, [i3, t3].filter(Boolean).join("\n");
        }, r2 = async (e2) => e2.page.content({ contentType: "pdf" }), s2 = async (e2) => e2.page.content({ contentType: "gdocs" }), l2 = async (e2) => {
          const n3 = await t2.paramYouTubeTranscript(e2);
          return n3 && n3 !== "\u2014" ? `YouTube video transcript:
${n3}` : null;
        };
      })(), (() => {
        const { $chat: t2, $s: n2 } = e;
        t2.paramProPlan = () => n2.billing.plan() || "\u2014";
      })(), (() => {
        const { $chat: t2, $commands: n2, $utils: a2, $bus: o2 } = e, i2 = ["\u278A", "\u278B", "\u278C", "\u278D", "\u278E", "\u278F", "\u2790", "\u2791", "\u2792", "\u2793"];
        t2.paramSerp = async (e2) => {
          let { prompt: a3, crawl: o3 } = r2(e2), s2 = null;
          if (a3) {
            const e3 = await t2.paramSerp.fetch(a3);
            s2 = await t2.paramSerp.toText(e3);
          } else {
            const n3 = await e2.page.url();
            if (n3.startsWith("https://www.google.com/search?q=")) {
              const o4 = await e2.page.content({ contentType: "htmlContent" });
              s2 = await t2.paramSerp.toText(o4), a3 = new URL(n3).searchParams.get("q");
            }
          }
          if (!s2) return "\u2014";
          if (o3 === "none") return s2;
          const l2 = Number(o3) || null, c2 = n2.extractSerpPrefix(s2), u2 = n2.extractSerpLinks(s2, l2);
          return s2 = (await Promise.all(
            u2.map(
              (n3, o4) => t2.paramPage({
                ...e2,
                args: `${a3} ${n3.url} limit=${o4 <= 3 ? 10 : 5}% type=fetch timeout=2500`
              })
            )
          )).map((e3, t3) => {
            const { title: n3, description: a4, url: o4 } = u2[t3], r3 = `### ${n3} [${i2[t3] || t3}](${o4})
${a4}`;
            return e3 !== "Failed fetching URL" ? `${r3}

\`\`\`
${e3}
\`\`\`` : r3;
          }).join("\n\n"), s2 = [c2, s2].filter(Boolean).join("\n\n"), s2;
        }, t2.paramSerp.fetch = async (e2) => {
          try {
            e2 = e2.split(" ").slice(0, 32).join(" "), e2 = a2.string.shorten(e2, 300);
            const t3 = `https://www.google.com/search?q=${encodeURIComponent(e2).replaceAll("%20", "+")}&__hrpserp`, n3 = await fetch(t3).then((e3) => e3.text());
            return n3.trim() ? n3 : "\u2014";
          } catch (e3) {
            return t2.log("fetching serp failed:", e3), "\u2014";
          }
        }, t2.paramSerp.toText = async (e2) => await o2.send("chat.paramSerp.toText", e2), t2.paramSerp.findCommonParent = (e2) => {
          if (e2.length === 0) return null;
          if (e2.length === 1) return e2[0].parentNode;
          let t3 = e2[0];
          for (; t3.parentNode; )
            if (t3 = t3.parentNode, e2.slice(1).every((e3) => t3.contains(e3)))
              return t3;
          return null;
        };
        const r2 = (e2) => {
          let { args: t3, prompt: n3, crawl: a3 } = e2;
          const o3 = (t3 || "").match(/\s?crawl=(all|1|2|3|4|5|6|7|8|9|10|none)/);
          return o3 && (a3 = o3[1], t3 = t3.replace(o3[0], "")), a3 = a3 || "none", n3 = (t3 || "").trim() || (n3 || "").trim(), { args: t3, prompt: n3, crawl: a3 };
        };
      })(), (() => {
        const { $chat: t2 } = e;
        t2.paramPageThread = async (e2) => {
          try {
            const u2 = await e2.page.url(), p2 = e2.page.mediumId, { exists: d2, limit: m2 } = n2(e2), h = { args: [m2] };
            return d2 ? await t2.testUrl.isThreadService(u2) ? "yes" : void 0 : t2.testUrl.regexWhatsappThread.test(u2) ? await chrome.executeScript(p2, a2, h) : t2.testUrl.regexDiscordThread.test(u2) ? await chrome.executeScript(p2, o2, h) : t2.testUrl.regexTelegramThread.test(u2) ? await chrome.executeScript(p2, i2, h) : t2.testUrl.regexRedditThread.test(u2) ? await chrome.executeScript(p2, r2, h) : t2.testUrl.regexFacebookThread.test(u2) ? await chrome.executeScript(p2, s2, h) : t2.testUrl.regexYoutubeThread.test(u2) ? await chrome.executeScript(p2, l2, h) : t2.testUrl.regexTwitterThread.test(u2) ? await chrome.executeScript(p2, c2, h) : void 0;
          } catch (e3) {
            return;
          }
        };
        const n2 = (e2) => {
          const t3 = e2.args || "";
          if (t3.match(/\s?exists/)) return { exists: true };
          let n3 = 100;
          const a3 = t3.match(/\s?limit=(\d+)/);
          return a3 && (n3 = a3[1], t3.replace(a3[0], "")), n3 || (n3 = 100), n3 < 0 && (n3 = 0), { limit: n3 };
        }, a2 = async (e2) => async function(e3) {
          const t3 = 'div[role="application"]', n3 = ".message-in, .message-out", a3 = "span.selectable-text.copyable-text", o3 = ".copyable-text";
          try {
            const i3 = window.location.href;
            return {
              url: i3,
              messages: await async function() {
                const i4 = [], r3 = /* @__PURE__ */ new Set();
                let s3 = 0, l3 = "";
                async function c3() {
                  const e4 = document.querySelector(t3).parentElement;
                  e4 && (e4.scrollTop = 0, await new Promise((e5) => setTimeout(e5, 200)));
                }
                function u2() {
                  const e4 = Array.from(document.querySelectorAll(n3));
                  let t4 = false;
                  for (let n4 = e4.length - 1; n4 >= 0; n4--) {
                    const s4 = e4[n4], c4 = s4.querySelector(a3)?.textContent || "", u3 = s4.textContent.match(/\d{1,2}:\d{2}/), p2 = u3 ? u3[0] : "", d2 = `${p2}-${c4}`;
                    if (r3.has(d2)) continue;
                    const m2 = s4.querySelector(o3)?.getAttribute("data-pre-plain-text");
                    let h = m2 ? m2.match(/] (.*?):/)?.[1] : null;
                    h && h !== "Unknown" ? l3 = h : h = l3, c4 && h && (r3.add(d2), i4.push(`${p2}. ${h}: ${c4}`), t4 = true);
                  }
                  return t4;
                }
                for (; i4.length < e3 && s3 < 5; ) {
                  const t4 = u2();
                  i4.length < e3 && (await c3(), t4 ? s3 = 0 : s3++);
                }
                return i4.length > e3 && i4.splice(e3), i4.reverse(), function() {
                  const e4 = document.querySelector(t3).parentElement;
                  e4 && (e4.scrollTop = e4.scrollHeight);
                }(), i4;
              }()
            };
          } catch (e4) {
            return null;
          }
        }(e2), o2 = async (e2) => async function(e3) {
          const t3 = '[class*="scroller_"]', n3 = '[class^="messageListItem_"]', a3 = '[class^="timestamp_"] time', o3 = '[class^="username_"]', i3 = '[class^="markup_"][class*="messageContent_"]', r3 = '[class^="repliedMessage_"]';
          try {
            const s3 = window.location.href;
            return {
              url: s3,
              messages: await async function() {
                const s4 = [], l3 = /* @__PURE__ */ new Set();
                let c3 = 0;
                async function u2() {
                  const e4 = document.querySelectorAll(t3), n4 = e4[e4.length - 1];
                  n4 && (n4.scrollBy(0, -2e3), await new Promise((e5) => setTimeout(e5, 200)));
                }
                function p2() {
                  const e4 = document.querySelectorAll(n3);
                  let t4 = false;
                  return e4.forEach((e5) => {
                    const n4 = e5.id || e5.getAttribute("data-list-item-id");
                    if (l3.has(n4)) return;
                    const c4 = e5.querySelector(a3)?.textContent || "", u3 = e5.querySelector(o3)?.textContent || "", p3 = e5.querySelector(i3)?.textContent || "", d2 = e5.querySelector(r3), m2 = d2 ? d2.querySelector(o3)?.textContent || "" : null;
                    let h = `${c4}: ${u3}: ${p3}`;
                    m2 && (h += ` (Replied to: ${m2})`), l3.add(n4), s4.push(h), t4 = true;
                  }), t4;
                }
                for (; s4.length < e3 && c3 < 5; ) {
                  const t4 = p2();
                  s4.length < e3 && (await u2(), t4 ? c3 = 0 : c3++);
                }
                return s4.length > e3 && s4.splice(e3), s4;
              }()
            };
          } catch (e4) {
            return null;
          }
        }(e2), i2 = async (e2) => async function(e3) {
          const t3 = "div[data-message-id][id]", n3 = ".ChatInfo .info", a3 = ".group-status", o3 = "h3", i3 = '.sticky-date span[dir="auto"]', r3 = ".MessageOutgoingStatus", s3 = ".message-time", l3 = ".content-inner > .text-content", c3 = ".message-views", u2 = ".content-inner.forwarded-message", p2 = ".message-title span, .forward-title", d2 = 'div[class*="MessageList"][class*="custom-scroll"]', m2 = ".EmbeddedMessage .embedded-text-wrapper span";
          let h = [], g = 0;
          const f = /* @__PURE__ */ new Set();
          function y(e4) {
            const d3 = document.querySelectorAll(t3), h2 = document.querySelector(n3);
            let g2 = "Unknown sender";
            const f2 = h2 && h2.querySelector(a3);
            if (h2 && !f2) {
              const e5 = h2.querySelector(o3);
              e5 && (g2 = e5.textContent.trim());
            }
            const y2 = [];
            let b2 = g2;
            return d3.forEach((t4) => {
              const n4 = t4.getAttribute("data-message-id");
              if (e4.has(n4)) return;
              const a4 = t4.closest(".message-date-group"), o4 = a4 && a4.querySelector(i3)?.textContent.trim() || "Date not found", d4 = t4.querySelector(r3), h3 = t4.querySelector(s3)?.textContent.trim() || "Time not found", w2 = t4.querySelector(l3);
              let v, k = false, T = "";
              if (w2) {
                const e5 = w2.cloneNode(true), t5 = e5.querySelector(s3), n5 = e5.querySelector(c3);
                t5 && t5.remove(), n5 && n5.remove(), v = e5.textContent.trim();
              } else v = "shared file or audio message";
              if (t4.querySelector(u2)) {
                k = true;
                const e5 = t4.querySelector(p2);
                e5 && (T = e5.textContent.trim());
              }
              const A = t4.querySelector(p2);
              let E, I = A ? A.textContent.trim() : null;
              d4 ? I = "I" : I ? b2 = I : I = f2 ? b2 : g2, k && I === T && (I = "Unknown sender"), f2 || I !== "Unknown sender" || (I = g2), E = k ? `${o4} ${h3} - ${I} shared message from "${T}": ${v}` : `${o4} ${h3} - ${I} wrote: ${v}`;
              const S = t4.querySelector(m2), x = S ? S.textContent.trim() : null;
              x && (E += ` (Replying to: ${x})`), y2.push({ id: parseInt(n4, 10), text: E }), e4.add(n4);
            }), y2;
          }
          for (; h.length < e3 && g < 10; ) {
            const t4 = y(f);
            if (h = [...h, ...t4], h.length < e3) {
              const e4 = document.querySelector(d2);
              if (!e4) break;
              e4.scrollBy(0, -3e3), await new Promise((e5) => setTimeout(e5, 200)), g++;
            }
          }
          const b = document.querySelector(
            'div[class*="MessageList"][class*="custom-scroll"]'
          );
          b && b.scrollTo(0, 0), h.sort((e4, t4) => e4.id - t4.id);
          const w = h.map((e4) => e4.text).slice(-e3);
          return { url: window.location.href, messages: w };
        }(e2), r2 = async (e2) => async function(e3) {
          const t3 = "#comment-tree", n3 = "shreddit-comment", a3 = ".font-bold", o3 = "faceplate-timeago", i3 = '[slot="comment"]', r3 = "h1", s3 = ".author-name", l3 = '[slot="text-body"]';
          try {
            return {
              url: window.location.href,
              post: {
                title: document.querySelector(r3)?.innerText || "",
                author: document.querySelector(s3)?.innerText || "",
                content: document.querySelector(l3)?.innerText || ""
              },
              comments: await async function() {
                const r4 = [], s4 = /* @__PURE__ */ new Set();
                let l4 = 0;
                async function c3() {
                  window.scrollTo(0, document.body.scrollHeight), await new Promise((e4) => setTimeout(e4, 200));
                }
                function u2() {
                  const e4 = document.querySelector(t3).querySelectorAll(n3);
                  let l5 = false;
                  return e4.forEach((e5) => {
                    const t4 = e5.querySelector(a3)?.innerText || "Unknown", n4 = e5.querySelector(o3)?.innerText || "", c4 = e5.querySelector(i3)?.innerText || "", u3 = parseInt(e5.getAttribute("depth")) || 0, p2 = `${n4}-${t4}-${c4}`;
                    if (!s4.has(p2) && t4 && n4 && c4) {
                      const e6 = `${" \u2192 ".repeat(u3)}${n4}. ${t4}: ${c4}`;
                      s4.add(p2), r4.push(e6), l5 = true;
                    }
                  }), l5;
                }
                for (; r4.length < e3 && l4 < 5; ) {
                  const t4 = u2();
                  r4.length < e3 && (await c3(), t4 ? l4 = 0 : l4++);
                }
                return r4.length > e3 && r4.splice(e3), window.scrollTo(0, 0), r4;
              }()
            };
          } catch (e4) {
            return null;
          }
        }(e2), s2 = async (e2) => async function(e3) {
          const t3 = '[role="dialog"] [data-ad-comet-preview="message"]', n3 = '[role="dialog"] [data-ad-rendering-role="profile_name"]', a3 = '[role="dialog"] [role="article"]';
          try {
            return {
              post: {
                author: document.querySelector(n3)?.innerText || "",
                content: document.querySelector(t3)?.innerText || ""
              },
              comments: await async function() {
                const t4 = [], n4 = /* @__PURE__ */ new Set();
                let o3 = 0;
                async function i3() {
                  const e4 = [
                    ...document.querySelector("[role=dialog]:not([aria-label])").querySelectorAll("*")
                  ].find(
                    (e5) => getComputedStyle(e5).overflow === "hidden auto"
                  );
                  e4.scrollTop = e4.scrollHeight, await new Promise((e5) => setTimeout(e5, 1500));
                }
                function r3() {
                  const e4 = document.querySelectorAll(a3);
                  let o4 = false;
                  return e4.forEach((e5) => {
                    const a4 = e5.querySelector('a[href*="/user/"] span'), i4 = e5.querySelector('li a[role="link"]'), r4 = e5.querySelectorAll(
                      'div[style="text-align: start;"]'
                    );
                    if (a4 && r4.length > 0) {
                      const e6 = a4.innerText || "Unknown", s3 = i4?.innerText || "", l3 = Array.from(r4).map((e7) => e7.innerText).join(" "), c3 = `${s3}-${e6}-${l3}`;
                      if (!n4.has(c3) && e6 && l3) {
                        const a5 = `${s3}. ${e6}: ${l3}`;
                        n4.add(c3), t4.push(a5), o4 = true;
                      }
                    }
                  }), o4;
                }
                for (; t4.length < e3 && o3 < 5; ) {
                  const n5 = r3();
                  t4.length < e3 && (await i3(), n5 ? o3 = 0 : o3++);
                }
                return t4.length > e3 && t4.splice(e3), [
                  ...document.querySelector("[role=dialog]:not([aria-label])").querySelectorAll("*")
                ].find(
                  (e4) => getComputedStyle(e4).overflow === "hidden auto"
                ).scrollTop = 0, t4;
              }()
            };
          } catch (e4) {
            return null;
          }
        }(e2), l2 = async (e2) => async function(e3) {
          const t3 = "ytd-comment-thread-renderer", n3 = "ytd-comment-view-model#comment", a3 = "#header-author h3 a", o3 = "#content-text", i3 = "#vote-count-middle", r3 = "#published-time-text a", s3 = "ytd-comment-simplebox-renderer", l3 = "title", c3 = ".style-scope.ytd-channel-name.complex-string", u2 = "#count .view-count", p2 = "ytd-video-primary-info-renderer #info-strings yt-formatted-string", d2 = 'ytd-menu-renderer button[aria-label*="like this video"]';
          try {
            return {
              video: function() {
                try {
                  const e4 = document.querySelector(l3)?.textContent.trim() || "", t4 = document.querySelector(c3)?.textContent.trim() || "", n4 = document.querySelector(u2)?.textContent.trim() || "", a4 = document.querySelector(p2)?.textContent.trim() || "", o4 = document.querySelector(d2);
                  return {
                    title: e4,
                    author: t4,
                    views: n4,
                    publishedAt: a4,
                    likes: o4 ? o4.getAttribute("aria-label").match(/[\d,]+/)[0] : "0",
                    url: window.location.href
                  };
                } catch (e4) {
                  return null;
                }
              }(),
              comments: await async function() {
                const l4 = [], c4 = /* @__PURE__ */ new Set();
                let u3 = 0;
                async function p3() {
                  window.scrollTo(0, document.documentElement.scrollHeight), await new Promise((e4) => setTimeout(e4, 1500));
                }
                function d3() {
                  const e4 = document.querySelectorAll(t3);
                  let s4 = false;
                  return e4.forEach((e5) => {
                    const t4 = e5.querySelector(n3);
                    if (!t4) return;
                    const u4 = t4.querySelector(a3)?.textContent.trim() || "Unknown", p4 = t4.querySelector(o3)?.textContent.trim() || "", d4 = t4.querySelector(i3)?.textContent.trim() || "0", m2 = t4.querySelector(r3)?.textContent.trim() || "", h = `${m2}-${u4}-${p4}`;
                    if (!c4.has(h) && u4 && p4) {
                      const e6 = `${m2}. ${u4}: ${p4} (${d4} likes)`;
                      c4.add(h), l4.push(e6), s4 = true;
                    }
                  }), s4;
                }
                for (await async function() {
                  let e4 = document.querySelector(s3);
                  return !!e4 || (document.documentElement.scrollTop += window.innerHeight, await new Promise((e5) => setTimeout(e5, 1500)), e4 = document.querySelector(s3), !!e4);
                }(); l4.length < e3 && u3 < 5; ) {
                  const t4 = d3();
                  l4.length < e3 && (await p3(), t4 ? u3 = 0 : u3++);
                }
                return l4.length > e3 && l4.splice(e3), window.scrollTo(0, 0), l4;
              }()
            };
          } catch (e4) {
            return null;
          }
        }(e2), c2 = async (e2) => async function(e3) {
          const t3 = 'article[data-testid="tweet"]', n3 = 'div[data-testid="User-Name"] span:first-child', a3 = 'div[data-testid="tweetText"]', o3 = "time", i3 = 'div[aria-label*="replies"]';
          try {
            const r3 = {
              url: window.location.href,
              post: {
                author: document.querySelector(n3)?.innerText || "",
                username: "@" + window.location.pathname.split("/")[1],
                content: document.querySelector(a3)?.innerText || "",
                timestamp: document.querySelector(o3)?.innerText || "",
                stats: document.querySelector(i3)?.getAttribute("aria-label") || ""
              },
              comments: await async function() {
                const i4 = [], r4 = /* @__PURE__ */ new Set();
                let s3 = 0;
                async function l3() {
                  window.scrollTo(0, document.body.scrollHeight), await new Promise((e4) => setTimeout(e4, 500));
                }
                function c3() {
                  const e4 = Array.from(document.querySelectorAll(t3)).slice(1);
                  let s4 = false;
                  return e4.forEach((e5) => {
                    const t4 = e5.querySelector(n3)?.innerText || "Unknown", l4 = e5.querySelector(o3)?.innerText || "", c4 = e5.querySelector(a3)?.innerText || "", u2 = (p2 = e5, document.evaluate(
                      './/span[starts-with(text(), "@")]',
                      p2,
                      null,
                      XPathResult.FIRST_ORDERED_NODE_TYPE,
                      null
                    ).singleNodeValue?.textContent || "");
                    var p2;
                    const d2 = `${l4}-${t4}-${c4}`;
                    if (!r4.has(d2) && t4 && l4 && c4) {
                      const e6 = `${l4}. ${t4} (${u2}): ${c4}`;
                      r4.add(d2), i4.push(e6), s4 = true;
                    }
                  }), s4;
                }
                for (; i4.length < e3 && s3 < 5; ) {
                  const t4 = c3();
                  i4.length < e3 && (await l3(), t4 ? s3 = 0 : s3++);
                }
                return i4.length > e3 && i4.splice(e3), i4;
              }()
            };
            return window.scrollTo(0, 0), r3;
          } catch (e4) {
            return window.scrollTo(0, 0), null;
          }
        }(e2);
      })(), (() => {
        const { $chat: t2 } = e;
        t2.paramTime = () => {
          const e2 = /* @__PURE__ */ new Date();
          return e2.toLocaleTimeString("en-US", { hour12: false }) + " GMT+" + e2.getTimezoneOffset() / 60 * -1;
        };
      })(), (() => {
        const { $chat: t2, $utils: n2, $s: a2 } = e;
        t2.paramUserinfo = async () => {
          if (a2.global.userinfo) return a2.global.userinfo;
          return (await Promise.all([o2(), i2()])).filter(Boolean).join(" ");
        };
        const o2 = () => {
          if (!a2.billing.loggedIn) return;
          const e2 = [a2.billing.account.firstName, a2.billing.account.lastName].filter(Boolean).join(" ");
          return e2 ? `User name is ${e2}.` : void 0;
        }, i2 = async () => {
          if (Date.now() - (a2.billing.locationCollectedOn || 0) < n2.time.DAY)
            return a2.billing.location ? `Current location ${a2.billing.location}.` : null;
          try {
            const e2 = await fetch("https://whatismyipaddress.com/"), t3 = await e2.text(), n3 = /<p class="information">(.+?)<\/p>/g, o3 = [];
            let i3;
            for (; (i3 = n3.exec(t3)) !== null; ) o3.push(i3[1]);
            const r2 = o3.at(-1).split("<span>").at(-1).split("</span>")[0];
            return a2.billing.location = r2, a2.billing.locationCollectedOn = Date.now(), `User location is ${a2.billing.location}.`;
          } catch (e2) {
            return t2.warn("failed fetching location", e2), a2.billing.location = null, a2.billing.locationCollectedOn = Date.now(), null;
          }
        };
      })(), (() => {
        const { $chat: t2, $capture: n2, $bus: a2 } = e;
        t2.paramView = async ({ tabId: e2 }) => {
          const o2 = await n2.controller.captureView(e2), [i2, r2] = await Promise.all([
            a2.send(e2, "chat.generateAttachmentLow", o2),
            a2.send(e2, "chat.generateAttachmentHigh", o2)
          ]);
          return t2.attachmentsController.toPlaceholder({
            type: "image",
            image: { low: i2, high: r2 }
          });
        };
      })(), (() => {
        const { $chat: t2, $utils: n2, $bus: a2, $s: o2 } = e;
        t2.paramYouTubeTranscript = async (e2, a3 = {}) => {
          let l2 = typeof e2 == "string" ? e2 : await e2.page.url();
          if (!t2.paramYouTubeTranscript.isYoutubeVideoPage(l2)) return "\u2014";
          const c2 = a3.plain || false, u2 = `${c2}::${l2}`, p2 = o2.youtube.transcripts[u2];
          if (p2) {
            if (p2.expires >= Date.now()) return p2.value;
            delete o2.youtube.transcripts[u2];
          }
          const d2 = await i2(e2.page, l2), m2 = await r2(l2, d2);
          if (!m2 || m2.length === 0) return "\u2014";
          const h = c2 ? m2.map((e3) => e3.t).join(" ") : s2(m2, 30).map((e3) => `[${e3.ts}] ${e3.t}`).join("\n");
          return o2.youtube.transcripts[u2] = {
            value: h,
            expires: Date.now() + n2.time.HOUR
          }, h;
        }, t2.paramYouTubeTranscript.isYoutubeVideoPage = (e2) => /^https?:\/\/((www\.)|(m\.))?youtube\.com\/watch\?(.*)v=[\w-]+/.test(
          e2
        ) || /^https?:\/\/((www\.)|(m\.))?youtube\.com\/live\/[\w-]+/.test(e2);
        const i2 = async (e2, t3) => {
          const a3 = new URLSearchParams(t3.split("?")[1]).get("v"), i3 = o2.youtube.transcriptDetails[a3];
          if (i3) {
            if (i3.expires >= Date.now()) return i3.value;
            delete o2.youtube.transcriptDetails[a3];
          }
          const r3 = await e2.evaluate("getTranscriptDetails", null, {
            timeout: 1e3,
            noThrow: true
          });
          return r3 && typeof r3 == "object" && (o2.youtube.transcriptDetails[a3] = {
            value: r3,
            expires: Date.now() + n2.time.HOUR
          }), r3;
        }, r2 = async (e2, n3) => {
          const { transcript: o3, error: i3 } = await a2.send(
            "chat.paramYouTubeTranscript.getTranscript",
            e2,
            n3
          );
          return i3 ? (t2.warn("failed parsing transcript:", i3), null) : o3;
        }, s2 = (e2, t3 = 30) => {
          if (!e2 || !e2.length) return [];
          let n3 = { s: e2[0].s, d: e2[0].d, t: e2[0].t };
          const a3 = [n3];
          for (let o4 = 1; o4 < e2.length; o4++) {
            const { s: i3, d: r3, t: s3 } = e2[o4];
            n3.d + r3 < t3 ? (n3.d += r3, n3.t += " " + s3) : (n3 = { s: i3, d: r3, t: s3 }, a3.push(n3));
          }
          const o3 = (e3) => e3 < 10 ? "0" + e3 : e3;
          return a3.forEach((e3) => {
            const t4 = Math.floor(e3.s);
            delete e3.s, delete e3.d;
            const n4 = Math.floor(t4 / 3600), a4 = Math.floor(t4 % 3600 / 60), i3 = t4 % 60;
            e3.ts = n4 === 0 ? `${o3(a4)}:${o3(i3)}` : `${o3(n4)}:${o3(a4)}:${o3(i3)}`;
          }), a3;
        };
      })(), (() => {
        const { $chat: t2 } = e;
        t2.searchEngines = [
          {
            name: "google",
            check: (e2) => /^https:\/\/(www\.)?google\.[^/]+\/search/gim.test(e2),
            query: "q"
          },
          {
            name: "bing",
            check: (e2) => e2.startsWith("https://www.bing.com/search") || e2.startsWith("https://cn.bing.com/search"),
            query: "q"
          },
          {
            name: "yahoo",
            check: (e2) => /^https:\/\/search\.yahoo\.[^/]+\/search/gim.test(e2),
            query: "p"
          },
          {
            name: "duckduckgo",
            check: (e2) => e2.startsWith("https://duckduckgo.com/"),
            query: "q"
          },
          {
            name: "baidu",
            check: (e2) => e2.startsWith("https://www.baidu.com/"),
            query: "wd"
          },
          {
            name: "kagi",
            check: (e2) => e2.startsWith("https://kagi.com/search"),
            query: "q"
          },
          {
            name: "yandex",
            check: (e2) => /^https:\/\/yandex\.[^/]+\/search/gim.test(e2),
            query: "text"
          },
          {
            name: "naver",
            check: (e2) => e2.startsWith("https://search.naver.com/search"),
            query: "query"
          },
          {
            name: "brave",
            check: (e2) => e2.startsWith("https://search.brave.com/search"),
            query: "q"
          },
          {
            name: "ecosia",
            check: (e2) => e2.startsWith("https://www.ecosia.org/search"),
            query: "q"
          },
          {
            name: "google-scholar",
            check: (e2) => /^https:\/\/scholar\.google\.[^/]+\/scholar/gim.test(e2),
            query: "q"
          }
        ];
      })(), (() => {
        const { $chat: t2 } = e;
        t2.testUrl = {
          regexGMail: /^https?:\/\/mail\.google\.com\/.*$/,
          regexOutlook: /^https?:\/\/outlook.live.com\/.*$/,
          regexProtonmail: /^https?:\/\/mail\.proton\.me\/.*$/,
          regexFastmail: /^https?:\/\/app\.fastmail\.com\/mail\/.*$/,
          regexWhatsappThread: /^https?:\/\/web\.whatsapp\.com\/.*$/,
          regexDiscordThread: /^https?:\/\/discord\.com\/channels\/.*/,
          regexTelegramThread: /^https?:\/\/web\.telegram\.org\/[a-zA-Z]\/#.*/,
          regexRedditThread: /^https?:\/\/www\.reddit\.com\/r\/[^/]+\/comments\/.*/,
          regexFacebookThread: /^https?:\/\/(?:www\.)?facebook\.com\/.*/,
          regexYoutubeThread: /^https?:\/\/(?:www\.)?youtube\.com\/watch\?v=.*/,
          regexTwitterThread: /^https?:\/\/x\.com\/[^/]+\/status\/[^/]+/,
          isEmailService: (e2) => t2.testUrl.regexGMail.test(e2) || t2.testUrl.regexOutlook.test(e2) || t2.testUrl.regexProtonmail.test(e2) || t2.testUrl.regexFastmail.test(e2),
          isThreadService: (e2) => t2.testUrl.regexWhatsappThread.test(e2) || t2.testUrl.regexDiscordThread.test(e2) || t2.testUrl.regexTelegramThread.test(e2) || t2.testUrl.regexRedditThread.test(e2) || t2.testUrl.regexFacebookThread.test(e2) || t2.testUrl.regexYoutubeThread.test(e2) || t2.testUrl.regexTwitterThread.test(e2)
        };
      })(), (() => {
        const {
          $chat: t2,
          $utils: n2,
          $ai: a2,
          $bus: o2,
          $browser: i2,
          $dialog: r2,
          $s: s2,
          $store: l2
        } = e;
        t2.actionsController = {
          init() {
            o2.on("chat.ensure", this.ensureChat, this), o2.on("chat.create", this.createChat, this), o2.on("chat.clear", this.clearChat, this), o2.on("chat.resend", this.resend, this), o2.on("chat.stop", this.stop, this), o2.on("chat.paste", this.paste, this), o2.on("chat.delete", this.delete, this), o2.on("chat.reset", this.reset, this);
          },
          async ensureChat(e2) {
            if (!e2) return;
            const t3 = s2.tabs[e2];
            t3 && (t3.chat || (s2.settings.singleChat && s2.chats.length > 0 ? t3.chatId = s2.chats.sorted()[0].id : await this.createChat(e2)));
          },
          ensureTaskChat(e2, t3, n3) {
            if (!t3 || !e2) return;
            s2.tabs[t3] || (s2.tabs[t3] = l2.template.tab(t3));
            const a3 = s2.tabs[t3];
            a3.screen = "chat";
            let o3 = s2.chats.find((t4) => t4.taskId === e2);
            return o3 || (o3 = a3.createChat({
              title: "TASK",
              emoji: "\u{1F916}",
              connectionId: n3,
              taskId: e2
            })), a3.chatId !== o3.id && (a3.chatId = o3.id), n3 && n3 !== o3.connectionId && (o3.connectionId = n3), o3;
          },
          async createChat(e2, { open: t3 = false } = {}) {
            const n3 = s2.tabs[e2], a3 = await this._getPageTitle(e2);
            n3.createChat({ title: a3 }), t3 && (n3.screen = "chat");
          },
          async clearChat(e2, { stopCommand: n3 = true } = {}) {
            const o3 = s2.chats.getByTabId(e2);
            o3.messages = [], t2.askController.abort(o3.id), await a2.api.deleteChat(o3), n3 && await r2.commandController.onCommandStop(o3.command), s2.transaction(() => {
              o3.geminiCursor = null, o3.claudeChatId = null, o3.openaiChatId = null, o3.openaiLastAnswerId = null, n3 && (o3.running = false, o3.command = null);
            });
          },
          async askChat(e2, o3, i3, {
            flags: r3 = [],
            attachments: c2 = [],
            commandName: u2 = null,
            pmc: p2 = false,
            dumb: d2 = false,
            silent: m2 = false,
            contextual: h = true,
            isolated: g = false,
            functions: f = null,
            delay: y = 0,
            badge: b = null,
            onCodeClick: w = null
          }) {
            if (!e2) return;
            if (!o3) return;
            const v = r3.length > 0, k = !n2.is.empty(i3) || !n2.is.empty(c2);
            if (!k && !v) return;
            const T = s2.chats.get(e2);
            if (p2 && !this._checkMessageLimit(T, i3, r3, c2))
              return void (T.attachments = c2.map(
                (e3) => l2.template.chatAttachment({
                  type: e3.type,
                  pdf: e3.pdf,
                  image: e3.image,
                  ready: true
                })
              ));
            const A = T.connectionId;
            if (this._applyConnectionFlags(T, r3), this._forceCloudOrApiConnection(T), T.input = "", !k)
              return "";
            const E = n2.id.nano();
            T.running = E, t2.askController.abort(T.id);
            const I = { text: i3, commandName: u2, silent: m2 }, S = await t2.controller.interpolate(e2, o3, i3, c2), x = S.text;
            (c2 = S.attachments).length > 0 && (I.attachments = c2), x !== i3 && (I.itext = x), T.addQuestion(I);
            if (c2.filter((e3) => e3.type === "image").length > 0) {
              await n2.sleep(250);
              if (!T.switchToVisionConnection()) return;
            }
            d2 || T.running !== E || (await n2.sleep(250), T.running === E && T.addAnswer({ text: "", done: false, badge: b, onCodeClick: w }));
            const C = [
              "openai-session",
              "gemini-session",
              "claude-session"
            ].includes(T.connection.type);
            y && T.running === E && C && await n2.sleep(y);
            const O = T.connection.type === "claude-session" && !T.claudeChatId || T.connection.type === "openai-session" && !T.openaiChatId;
            let R = { text: null };
            if (!d2 && T.running === E) {
              const n3 = {
                flags: r3,
                attachments: c2,
                contextual: h,
                isolated: g,
                functions: f
              };
              R = await t2.askController.ask(e2, o3, x, n3);
            }
            return d2 && (R.text = x, T.addAnswer({ text: x, done: true, badge: b, onCodeClick: w })), O && a2.api.setChatTitle(T, T.fullTitle).catch(() => {
            }), T.connectionId !== A && (T.connectionId = A), T.running === E && (T.running = false), R;
          },
          async resend(e2, t3) {
            const n3 = s2.chats.get(e2);
            if (n3.command)
              return void await r2.commandController.runCommand(e2, t3);
            const a3 = n3.lastQuestion;
            a3 && await this.askChat(e2, t3, a3.text, {
              commandName: a3.commandName,
              attachments: a3.attachments,
              silent: true
            });
          },
          async stop(e2) {
            t2.askController.abort(e2);
            const n3 = s2.chats.get(e2);
            await r2.commandController.onCommandStop(n3.command), n3.running = false, n3.command = null, n3.lastAnswer && (n3.lastAnswer.done = true);
          },
          async paste(e2, n3, a3) {
            const o3 = await i2.controller.connectTab(n3);
            try {
              await o3.paste(null, a3), await i2.controller.hideFrame(n3);
            } catch (e3) {
              s2.chats.getByTabId(n3).addAnswer({
                text: "Could not find an element to paste to.",
                error: t2.errors.commandConfigError
              });
            }
          },
          async delete(e2, t3 = null) {
            const o3 = n2.ensureArray(e2).map((e3) => s2.chats.get(e3)).filter(Boolean);
            if (o3.length === 0) return;
            const i3 = t3 ? await this._getPageTitle(t3) : null;
            for (const e3 of o3) await this.stop(e3.id);
            s2.transaction(() => {
              for (const e3 of o3) {
                for (const t4 of e3.tabs) {
                  const n3 = s2.chats.sorted().find((t5) => t5.id !== e3.id);
                  n3 ? t4.chatId = n3.id : t4.createChat({ title: i3 });
                }
                s2.chats.delete(e3.id);
              }
            });
            for (const e3 of o3) await a2.api.deleteChat(e3);
          },
          async reset(e2) {
            await this.stop(e2), s2.transaction(() => {
              const t3 = s2.chats.get(e2);
              t3.geminiCursor = null, t3.claudeChatId = null, t3.openaiChatId = null, t3.openaiLastAnswerId = null, t3.addAnswer({ text: "#reset", system: true, delimiter: true });
            });
          },
          _checkMessageLimit(e2, n3, a3, o3) {
            if (!n3) return true;
            if (e2.connection.type === "openai-license")
              return s2.billing.onPowerMessage(e2);
            if (e2.hasAttachments || o3.length > 0)
              return s2.billing.onPowerMessage(e2);
            if (t2.paramController.hasParams(n3))
              return s2.billing.onPowerMessage(e2);
            if (e2.mode.file.enabled || e2.mode.page.enabled || e2.mode.web.enabled)
              return s2.billing.onPowerMessage(e2);
            {
              const t3 = /* @__PURE__ */ new Set([
                s2.ai.mode.page.flag,
                s2.ai.mode.web.flag,
                s2.ai.mode.file.flag
              ]);
              if (a3.some((e3) => t3.has(e3))) return s2.billing.onPowerMessage(e2);
            }
            return s2.billing.onStandardMessage(e2);
          },
          _applyConnectionFlags(e2, t3) {
            const n3 = t3.findLast(
              (e3) => s2.ai.connections.find((t4) => t4.flag === e3)
            );
            if (!n3) return;
            let a3 = s2.ai.connections.find((e3) => e3.flag === n3);
            a3.id !== e2.connectionId && (e2.connectionId = a3.id);
          },
          _forceCloudOrApiConnection(e2) {
            if (!e2.task) return;
            if (e2.connection.type === "cloudgpt") return;
            if (e2.connection.type === "openai-license") return;
            const n3 = s2.ai.connections.find((e3) => e3.type === "cloudgpt") || s2.ai.connections[0];
            if (n3) {
              const a3 = e2.connection.label, o3 = n3.label;
              e2.addAnswer({
                text: `\u{1F916}  Switching connection from **${a3}** to **${o3}** for scheduled task.`,
                error: t2.errors.commandConfigError
              }), e2.connectionId = n3.id;
            } else e2.connectionId = null;
          },
          async _getPageTitle(e2) {
            const t3 = (await chrome.tabs.get(e2))?.title;
            return t3 ? t3.startsWith("app.harpa.ai") ? "HARPA AI App" : t3 : "Web Page";
          }
        };
      })(), (() => {
        const {
          $dialog: t2,
          $utils: n2,
          $ai: a2,
          $env: o2,
          $chat: i2,
          $bus: r2,
          $yousummary: s2,
          $analytics: l2,
          $mobx: c2,
          $files: u2,
          $s: p2
        } = e;
        i2.askController = {
          init() {
            this._lastAskFinishedAt = -1, this._abortControllers = {}, this.ask = n2.enqueue(this.ask, this), p2.ai.openaiSession.maxTokenFactor = 1;
          },
          async ask(e2, a3, o3, {
            flags: r3 = [],
            attachments: u3 = [],
            contextual: d2 = true,
            isolated: m2 = false,
            functions: h = null
          }) {
            const g = p2.chats.get(e2), f = g.connection;
            if (!g) return null;
            if (m2 = m2 || r3.includes(p2.ai.mode.isolated.flag), !this._checkSupportedVersion(g))
              return null;
            this._abortControllers[g.id] = new AbortController();
            const y = 2e3 - (Date.now() - this._lastAskFinishedAt);
            if (y > 0 && await n2.sleep(y), !this._abortControllers[g.id])
              return null;
            if (h = c2.toJS(h), !this._checkFunctionsSupport(g, f, h))
              return null;
            const b = this._getContextParts(a3, g, r3, d2);
            let w;
            o3 = await t2.context.insert(o3, e2, a3, {
              page: b.page,
              web: b.web,
              pdfs: u3.filter((e3) => e3.type === "pdf").map((e3) => e3.pdf)
            });
            const v = u3.filter((e3) => e3.type === "image"), k = v.length > 0, T = g.modeThinkButtonOn || r3.includes(p2.ai.mode.think.flag);
            if (l2.controller.sendChatAsk(f, { hasImage: k }), f.type === "openai-session") {
              const t3 = { attachments: v };
              w = await this._askOpenaiSession(e2, o3, t3), w === "RETRY" && (w = await this._askOpenaiSession(e2, o3, t3));
            } else if (f.type === "gemini-session")
              w = await this._askGeminiSession(e2, o3);
            else if (f.type === "claude-session")
              w = await this._askClaudeSession(e2, o3);
            else if (f.type === "openai-license") {
              const t3 = { isolated: m2, functions: h, attachments: u3 };
              w = await this._askOpenaiLicense(e2, a3, o3, t3), this._applyFuncAnswer(g, w, 100);
            } else if (f.type === "cloudgpt") {
              const t3 = !!h, n3 = this._getCloudgptBlacklist(f, o3, b, t3);
              if (w = await this._askCloudgpt(e2, a3, o3, {
                isolated: m2,
                functions: h,
                fblacklist: n3,
                think: T,
                attachments: v
              }), this._applyFuncAnswer(g, w, t3 ? 100 : 0), !t3) {
                const t4 = { isolated: m2, parts: b, answer: w };
                w = await this._processCloudgptFunctions(e2, a3, o3, t4);
              }
            }
            if (!p2.chats.exists(e2)) return null;
            if (this._lastAskFinishedAt = Date.now(), w.id) {
              if (w.text) {
                const t4 = (await chrome.tabs.get(a3)).url;
                w.text = i2.linkFoldController.unfold({
                  chatId: e2,
                  answer: w.text
                }), w.text = s2.controller.onAiAnswer({
                  chatId: e2,
                  answer: w.text,
                  tabId: a3,
                  url: t4
                });
              }
              let t3 = f.modelName || "";
              f.type === "cloudgpt" && T && (t3 = `${t3} + Think`);
              let n3 = null;
              f.type === "cloudgpt" && (n3 = w.usage), g.updateAnswer(w.id, {
                text: w.text,
                date: Date.now(),
                model: t3,
                ...n3 && { usage: n3 }
              });
            }
            return w.id && g.updateAnswer(w.id, { done: true }), w;
          },
          abort(e2) {
            const t3 = p2.chats.get(e2);
            if (!t3) return;
            const n3 = this._abortControllers[t3.id];
            n3 && (n3.abort(), delete this._abortControllers[t3.id]);
            const a3 = t3.lastAnswer;
            a3 && !a3.done && a3.text === "" && t3.removeLastAnswer();
          },
          _checkFunctionsSupport(e2, t3, n3) {
            if (!n3) return true;
            const { type: a3, selectedModelId: o3 } = t3;
            return [
              "openai-session",
              "gemini-session",
              "claude-session"
            ].includes(a3) ? (e2.updateLastAnswer({
              error: "functions-not-supported",
              done: true
            }), false) : !(a3 === "cloudgpt" && ![
              "harpa-v1-fast",
              "harpa-v2-fast",
              "harpa-v1-smart",
              "cloudgpt-3.5",
              "cloudgpt-4",
              "cloudgpt-4o"
            ].includes(o3)) || (e2.updateLastAnswer({
              error: "functions-not-supported",
              done: true
            }), false);
          },
          _checkSupportedVersion(e2) {
            const t3 = p2.feature.sv || 0;
            if (o2.versionNumber >= t3) return true;
            const a3 = n2.string.rotate("dVersionol", -2);
            return e2.updateLastAnswer({ error: i2.errors[a3], done: true }), false;
          },
          _applyFuncAnswer(e2, t3, a3 = 0) {
            t3.func && (t3.func.progress = a3, t3.func.argsPlain = t3.func.args, t3.func.args = n2.json.parse(t3.func.args, { fallback: {} }), e2.updateLastAnswer({ func: t3.func }));
          },
          _getContextParts(e2, t3, n3, a3) {
            if (!a3) return {};
            return {
              page: !p2.tabs[e2].isAppTab() && (t3.modePageButtonOn || n3.includes(t3.modePageFlag)),
              web: false
            };
          },
          async _askOpenaiSession(e2, t3, { attachments: o3 = [] } = {}) {
            const r3 = p2.chats.get(e2);
            o3 = await Promise.all(
              o3.map((e3) => u2.get(e3.image.high.fileId, u2.emptyImage))
            );
            const s3 = r3.connection, l3 = {
              connection: s3,
              model: s3.slug,
              signal: this._abortControllers[r3.id].signal,
              chatId: r3.openaiChatId,
              parentMessageId: r3.openaiLastAnswerId,
              attachments: o3
            };
            let c3 = null, d2 = null;
            try {
              const e3 = /(a )?terrorist organization/gi;
              let n3, o4 = 0;
              do {
                n3 = false, await a2.api.openaiSession.ask(t3, l3, (t4, a3) => {
                  a3 && (r3.updateLastQuestion({ role: "user" }), r3.updateLastAnswer({ role: "assistant" })), c3 = t4.id, d2 = t4.text, e3.test(d2) && (d2 = d2.replace(e3, "ERROR"), n3 = true), r3.openaiLastAnswerId = t4.id, r3.openaiChatId = t4.chatId, r3.updateLastAnswer({ answerId: c3, text: d2 });
                }), n3 && (t3 = "Please answer my initial message.");
              } while (n3 && o4++ < 1);
            } catch (e3) {
              let t4 = {
                error: i2.errors.openaiSessionFailedToFetch,
                errorDetails: this._errorToString(e3)
              };
              if (a2.api.openaiSession.isOwnError(e3))
                if (e3.is.login || e3.is.badAccessToken)
                  t4 = { error: i2.errors.openaiLogin };
                else if (e3.is.cloudflare)
                  t4 = { error: i2.errors.openaiCloudflare };
                else if (e3.is.messageTooLong) {
                  if (!(p2.ai.openaiSession.maxTokenFactor < 1))
                    return p2.ai.openaiSession.maxTokenFactor = 0.6, setTimeout(
                      () => p2.ai.openaiSession.maxTokenFactor = 1,
                      6 * n2.time.HOUR
                    ), "RETRY";
                  t4 = { error: i2.errors.openaiMessageTooLong };
                } else
                  e3.is.tooManyRequests ? t4 = { error: i2.errors.tooManyRequests } : e3.is.tooManyRequestsFiles ? t4 = { error: i2.errors.openaiTooManyRequestsFiles } : e3.is.chatNotFound ? (r3.openaiChatId = null, t4 = { error: i2.errors.openaiChatNotFound }) : e3.is.serverError ? t4 = { error: i2.errors.openaiServerError } : e3.is.aborted ? t4 = {} : e3.is.switchToWssRequired && (t4 = { error: i2.errors.openaiSwitchToWssRequired });
              r3.updateLastAnswer({ ...t4, done: true });
            }
            return { id: c3, text: d2 };
          },
          async _askGeminiSession(e2, t3) {
            const o3 = p2.chats.get(e2), r3 = o3.connection, s3 = {
              token: r3.token,
              cursor: o3.geminiCursor,
              signal: this._abortControllers[o3.id].signal
            };
            let l3;
            const c3 = n2.id.nano();
            try {
              l3 = await a2.api.geminiSession.ask(t3, s3), r3.token = l3.token, o3.geminiCursor = l3.cursor, o3.updateLastQuestion({ role: "user" }), o3.updateLastAnswer({
                answerId: c3,
                text: l3.text,
                role: "assistant"
              });
            } catch (e3) {
              let t4 = {
                error: i2.errors.geminiUnexpected,
                errorDetails: this._errorToString(e3)
              };
              a2.api.geminiSession.isOwnError(e3) && (e3.is.login ? t4 = { error: i2.errors.geminiLogin } : e3.is.noGeminiAccess ? t4 = { error: i2.errors.geminiNoAccess } : e3.is.aborted && (t4 = {})), o3.updateLastAnswer({ ...t4, done: true });
            }
            return l3 ? { id: c3, text: l3.text } : { id: null, text: null };
          },
          async _askClaudeSession(e2, t3) {
            const o3 = p2.chats.get(e2), r3 = p2.ai.connections.get("claude-session"), s3 = {
              orgId: r3.orgId,
              chatId: o3.claudeChatId,
              signal: this._abortControllers[o3.id].signal,
              emoji: o3.emoji
            };
            let l3 = null;
            const c3 = n2.id.nano();
            try {
              await a2.api.claudeSession.ask(t3, s3, (e3, t4) => {
                t4 && (o3.claudeChatId = e3.chatId, o3.updateLastQuestion({ role: "user" }), o3.updateLastAnswer({ role: "assistant", answerId: c3 }), r3.orgId = e3.orgId), l3 = e3.text, o3.updateLastAnswer({ text: e3.text });
              });
            } catch (n3) {
              let s4 = {
                error: i2.errors.claudeUnexpected,
                errorDetails: this._errorToString(n3)
              };
              if (a2.api.claudeSession.isOwnError(n3)) {
                if (n3.is.aborted) s4 = {};
                else if (n3.is.login) s4 = { error: i2.errors.claudeLogin };
                else if (n3.is.freeLimitExceeded)
                  s4 = { error: i2.errors.claudeFreeLimitExceeded };
                else if (n3.is.badModel) s4 = { error: i2.errors.claudeBadModel };
                else if (n3.is.tooManyRequests)
                  s4 = { error: i2.errors.tooManyRequests };
                else if (n3.is.badOrgId) {
                  const n4 = await a2.api.claudeSession.fetchOrgId();
                  if (r3.orgId !== n4)
                    return r3.orgId = n4, this._askClaudeSession(e2, t3);
                }
              }
              o3.updateLastAnswer({ ...s4, done: true });
            }
            return { id: c3, text: l3 };
          },
          async _askOpenaiLicense(e2, t3, n3, { isolated: o3, functions: r3, attachments: s3 = [] }) {
            const l3 = p2.chats.get(e2), c3 = l3.connection, u3 = await this._prepareMessageHistory(e2, t3, n3, {
              attachments: s3,
              systemPrompt: c3.systemPrompt,
              maxTokens: c3.maxRequestTokens,
              isolated: o3
            });
            let d2 = null, m2 = null, h = null;
            try {
              await a2.api.openaiLicense.ask({
                messages: u3,
                connection: c3,
                functions: r3,
                signal: this._abortControllers[l3.id].signal,
                onChunk: (e3, t4) => {
                  t4 && (l3.updateLastQuestion({ role: "user" }), l3.updateLastAnswer({ role: "assistant" })), d2 = e3.id, m2 = e3.text, h = e3.func, l3.updateLastAnswer({ answerId: d2, text: m2, func: h });
                }
              });
            } catch (e3) {
              let t4 = {
                error: i2.errors.openaiLicenseFailedToFetch,
                errorDetails: this._errorToString(e3)
              };
              a2.api.openaiLicense.isOwnError(e3) && (e3.is.badModel ? t4 = { error: i2.errors.openaiBadModel } : e3.is.badApiKey ? t4 = { error: i2.errors.openaiBadApiKey } : e3.is.messageTooLong ? t4 = { error: i2.errors.openaiMessageTooLong } : e3.is.tooManyRequests ? t4 = { error: i2.errors.tooManyRequests } : e3.is.reachedRequestsLimit ? t4 = { error: i2.errors.openaiRequestsLimit } : e3.is.visionNotSupported ? t4 = { error: i2.errors.visionNotSupported } : e3.is.aborted && (t4 = {})), l3.updateLastAnswer({ ...t4, done: true });
            }
            return { id: d2, text: m2, func: h };
          },
          async _askCloudgpt(e2, t3, o3, {
            attachments: r3 = [],
            isolated: s3 = false,
            functions: l3 = null,
            answer: c3 = null,
            fblacklist: u3 = null,
            think: d2 = false
          }) {
            const m2 = p2.chats.get(e2), h = m2.connection, g = h.selectedModel, f = await this._prepareMessageHistory(e2, t3, o3, {
              attachments: r3,
              systemPrompt: h.systemPrompt,
              maxTokens: h.maxRequestTokens,
              isolated: s3
            });
            f.at(-1)?.role === "user" && f.at(-2)?.role === "user" && f.splice(f.length - 2, 1);
            const y = (await chrome.tabs.get(t3)).url, b = (await chrome.tabs.get(t3)).title;
            m2.command && (u3 = "*"), c3 = {
              id: n2.id.nano(),
              text: null,
              usage: { input: 0, output: 0, total: 0, weight: null },
              func: { name: null, args: "" },
              ...c3
            };
            try {
              let e3 = true;
              await a2.api.cloudgpt.ask({
                messages: f,
                modelName: g.model,
                temperature: h.temperature,
                presencePenalty: h.presencePenalty,
                frequencyPenalty: h.frequencyPenalty,
                maxResponseTokens: h.maxResponseTokens,
                url: y,
                title: b,
                functions: l3,
                fblacklist: u3,
                think: d2,
                signal: this._abortControllers[m2.id].signal,
                stream: h.stream,
                onResult: ({ content: t4, usage: n3, func: a3 }) => {
                  c3.text || (c3.text = ""), p2.transaction(() => {
                    e3 && (e3 = false, m2.updateLastQuestion({ role: "user" }), m2.updateLastAnswer({
                      answerId: c3.id,
                      role: "assistant"
                    })), c3.text += t4, c3.usage.input += n3.input, c3.usage.output += n3.output, c3.usage.total += n3.total, c3.usage.weight = n3.weight, a3.name && (c3.func.name = (c3.func.name || "") + a3.name), a3.args && (c3.func.args = (c3.func.args || "") + a3.args), p2.billing.space.token.balance -= n3.total, m2.updateLastAnswer({ text: c3.text, func: c3.func });
                  });
                }
              });
            } catch (e3) {
              a2.error("cloudgpt request failed:", e3);
              const t4 = {}, n3 = this._errorToString(e3);
              if (a2.api.cloudgpt.isOwnError(e3)) {
                if (e3.is.noTokens) {
                  if (p2.billing.ownsCurrentSpace)
                    return m2.removeLastAnswer(), p2.billing.showUpsell({ reason: "no-tokens" }), c3;
                  t4.error = i2.errors.cloudgptNoTokens;
                } else
                  e3.is.aborted ? c3.usage = null : e3.is.network ? t4.error = i2.errors.cloudgptNetwork : e3.is.noLogin ? t4.error = i2.errors.cloudgptNoLogin : e3.is.noSpace ? t4.error = i2.errors.cloudgptNoSpace : e3.is.functionsNotSupported ? t4.error = i2.errors.cloudgptFunctionsNotSupported : e3.is.failedToReadResponse ? (t4.error = i2.errors.cloudgptFailedToReadResponse, t4.errorDetails = n3) : (t4.error = i2.errors.cloudgptUnknown, t4.errorDetails = n3);
              } else
                t4.error = i2.errors.cloudgptUnexpected, t4.errorDetails = n3;
              m2.updateLastAnswer({ ...t4, done: true });
            }
            return c3;
          },
          async _processCloudgptFunctions(e2, n3, a3, { isolated: o3, parts: i3, answer: s3 }) {
            const l3 = p2.chats.get(e2);
            if (s3.func?.name === "page") {
              a3 = await t2.context.insert(a3, e2, n3, { ...i3, page: true }), s3.func.progress = 100, l3.updateLastAnswer({ func: s3.func }), s3.text && (s3.text += "\n\n"), this._abortControllers[l3.id] = new AbortController();
              const r3 = { isolated: o3, answer: s3, fblacklist: "*" };
              s3 = await this._askCloudgpt(e2, n3, a3, r3);
            } else if (s3.func?.name === "search") {
              let { query: r3, site: c3 } = s3.func.args;
              r3 = r3 || a3, r3 = c3 ? `${r3} site:${c3}` : r3, a3 = await t2.context.insert(a3, e2, n3, { ...i3, web: r3 }), s3.func.progress = 100, l3.updateLastAnswer({ func: s3.func }), s3.text && (s3.text += "\n\n"), this._abortControllers[l3.id] = new AbortController();
              const u3 = { isolated: o3, answer: s3, fblacklist: "*" };
              s3 = await this._askCloudgpt(e2, n3, a3, u3);
            } else if (s3.func?.name) {
              const e3 = p2.feature.functionToCommand?.[s3.func.name];
              if (e3) {
                s3.func.progress = 100, l3.updateLastAnswer({ func: s3.func });
                const t3 = e3.command, a4 = {};
                a4.inputs = (e3.inputs || []).map(
                  (e4) => s3.func.args?.[e4.arg] || e4.fallback
                ), r2.send("dialog.launchCommand", n3, t3, a4);
              } else
                s3.text && (s3.text += "\n\n"), s3.text += `Unsupported command **/${s3.func.name}**. Please upgrade to the latest HARPA AI version.`, s3.func.progress = 100, l3.updateLastAnswer({ text: s3.text, func: s3.func });
            }
            return s3;
          },
          _getCloudgptBlacklist(e2, t3, n3, a3) {
            if (a3) return "*";
            const o3 = t3.includes("<!-- "), i3 = t3.includes("### "), r3 = e2.superpowers;
            return [
              (!r3.page || n3.page || o3) && "page",
              (!r3.web || n3.web || i3) && "search",
              (!r3.commands || n3.page || o3) && "commands"
            ].filter(Boolean).join(",");
          },
          _errorToString(e2) {
            const t3 = e2?.details || e2?.message || "unknown";
            return n2.is.string(t3) ? t3 : n2.json.stringify(t3, "unknown");
          },
          async _prepareMessageHistory(e2, a3, o3, {
            attachments: r3 = [],
            systemPrompt: s3 = null,
            isolated: l3 = false,
            maxTokens: c3
          }) {
            const d2 = p2.chats.get(e2), m2 = d2.connection, h = (e3) => (e3 || []).filter((e4) => e4.type !== "image" || m2.supportsVision);
            let g = [];
            if (!l3) {
              const e3 = d2.inIsolatedCommand ? d2.lastCommandMessageIndex : 0;
              g = d2.messagesAfterReset.slice(e3).filter((e4) => e4.role).map((e4) => ({
                role: e4.role,
                text: e4.itext || e4.text,
                attachments: h(e4.attachments),
                detail: "low"
              }));
            }
            s3 = !l3 && !d2.inIsolatedCommand && (s3 || "").trim(), (s3 = await i2.paramController.interpolate(e2, a3, s3, {
              noLimit: 2
            })) && g.push({ role: "system", text: s3 }), g.push({
              role: "user",
              text: o3,
              attachments: h(r3),
              detail: m2.detail
            });
            let f = d2.maxAttachments;
            const y = g.filter((e3) => e3.role === "user").toReversed();
            for (let n3 = 0; n3 < y.length; n3++) {
              const o4 = y[n3], i3 = o4.attachments || [];
              if (f -= i3.length, n3 > 5 || f < 0) o4.attachments = null;
              else if (o4.attachments) {
                const n4 = i3.filter((e3) => e3.type === "pdf").map((e3) => e3.pdf);
                o4.text = await t2.context.insert(o4.text, e2, a3, { pdfs: n4 }), o4.attachments = i3.filter((e3) => e3.type !== "pdf");
              }
            }
            if (g = await this._trimMessages(g, m2, c3), s3) {
              const e3 = g.findIndex((e4) => e4.role === "system");
              if (-1 !== e3) {
                const t3 = g[e3];
                g.splice(e3, 1), g.unshift(t3);
              }
            }
            return g = await Promise.all(
              g.map(async (e3) => {
                let t3 = null;
                return n2.is.empty(e3.attachments) || (t3 = await Promise.all(
                  e3.attachments.map(async (t4) => {
                    const a4 = e3.detail === "high" ? t4.image.high : t4.image.low, o4 = await u2.get(a4.fileId, u2.emptyImage);
                    return {
                      dataUrl: await n2.blobToDataUrl(o4),
                      detail: e3.detail
                    };
                  })
                )), { role: e3.role, text: e3.text, ...t3 && { attachments: t3 } };
              })
            ), g;
          },
          async _trimMessages(e2, t3, n3 = 0) {
            if (e2.length === 0) return [];
            const a3 = [], o3 = e2.toReversed();
            n3 -= 3;
            for (const e3 of o3) {
              if ((n3 -= 4) <= 0) break;
              const o4 = await this._trimText(e3.text, t3, n3);
              n3 -= await t3.countTextTokens(o4);
              let i3 = e3.attachments || [];
              const r3 = t3.countAttachmentsTokens(i3, e3.detail);
              r3 <= n3 ? n3 -= r3 : i3 = [], (o4.length > 0 || i3.length > 0) && a3.push({ ...e3, text: o4, attachments: i3 });
            }
            return a3.toReversed();
          },
          async _trimText(e2, t3, n3 = 0) {
            if (!e2) return "";
            const a3 = e2.split(" ");
            let o3 = 0, i3 = a3.length;
            for (; ; ) {
              const e3 = a3.slice(a3.length - o3 - i3).join(" ");
              if (await t3.countTextTokens(e3) <= n3 && (o3 += i3), o3 === a3.length)
                break;
              if (i3 < 1) break;
              i3 /= 2;
            }
            return a3.slice(a3.length - o3).join(" ");
          }
        };
      })(), (() => {
        const { $chat: t2, $files: n2, $utils: a2, $s: o2 } = e;
        t2.attachmentsController = {
          init() {
            this._dropUnprocessedAttachments();
          },
          getPlaceholderRegex: () => /\[\[([\w:-]+,\d+,\d+\|[\w:-]+,\d+,\d+|pdf\|[\w:-]+\|[^\]]*)\]\]/g,
          async interpolate(e2, { pdfStartIndex: n3 = 1, imageStartIndex: o3 = 1 } = {}) {
            const i2 = this.getPlaceholderRegex(), r2 = a2.unique([...e2.matchAll(i2)].map((e3) => e3[0])), s2 = [];
            for (const a3 of r2)
              try {
                if (a3.startsWith("[[pdf|")) {
                  const t3 = await this._parsePdfPlaceholder(a3);
                  if (!t3) continue;
                  const o4 = s2.filter((e3) => e3.type === "pdf").length;
                  e2 = e2.replaceAll(a3, `[FILE ${n3 + o4}]`), s2.push({ type: "pdf", pdf: t3 });
                } else {
                  const t3 = await this._parseImagePlaceholder(a3);
                  if (!t3) continue;
                  const n4 = s2.filter((e3) => e3.type === "image").length;
                  e2 = e2.replaceAll(a3, `[IMAGE ${o3 + n4}]`), s2.push({ type: "image", image: t3 });
                }
              } catch (e3) {
                t2.error(`failed to parse placeholder "${a3}"`, e3);
              }
            return { text: e2, attachments: s2 };
          },
          toPlaceholder(e2) {
            return e2 ? (e2 = a2.ensureArray(e2)).map(
              (e3) => e3.type === "pdf" ? this._toPdfPlaceholder(e3) : e3.type === "image" ? this._toImagePlaceholder(e3) : null
            ).filter(Boolean).join(" ") : "";
          },
          _toPdfPlaceholder(e2) {
            const t3 = e2.pdf;
            return `[[pdf|${t3.fileId}|${t3.name}]]`;
          },
          _toImagePlaceholder(e2) {
            const { low: t3, high: n3 } = e2.image;
            return `[[${[t3.fileId, t3.width, t3.height].join(",")}|${[n3.fileId, n3.width, n3.height].join(",")}]]`;
          },
          async _parsePdfPlaceholder(e2) {
            const t3 = e2.replace("[[pdf|", "").replace("]]", ""), [a3, o3] = t3.split("|");
            return await n2.has(a3) ? { fileId: a3, name: o3 } : null;
          },
          async _parseImagePlaceholder(e2) {
            let t3 = e2.replace("[[", "").replace("]]", "").split("|");
            if (t3.length !== 2) return null;
            const [o3, i2] = t3;
            if (t3 = o3.split(","), t3.length !== 3) return null;
            const r2 = o3.split(",");
            if (!a2.is.string(r2[0])) return null;
            if (!a2.is.numeric(r2[1])) return null;
            if (!a2.is.numeric(r2[2])) return null;
            if (!await n2.has(r2[0])) return null;
            if (t3 = i2.split(","), t3.length !== 3) return null;
            const s2 = i2.split(",");
            return a2.is.string(s2[0]) && a2.is.numeric(s2[1]) && a2.is.numeric(s2[2]) && await n2.has(s2[0]) ? {
              low: {
                fileId: r2[0],
                width: Number(r2[1]),
                height: Number(r2[2])
              },
              high: {
                fileId: s2[0],
                width: Number(s2[1]),
                height: Number(s2[2])
              }
            } : null;
          },
          _dropUnprocessedAttachments() {
            o2.transaction(() => {
              for (const e2 of o2.chats)
                e2.attachments.every((e3) => e3.ready) || (e2.attachments = e2.attachments.filter((e3) => e3.ready));
            });
          }
        };
      })(), (() => {
        const { $chat: t2, $mobx: n2, $s: a2 } = e;
        t2.backupController = {
          init() {
            n2.reaction(
              () => a2.billing.account?.id,
              this._backupChats.bind(this),
              { fireImmediately: false }
            );
          },
          async _backupChats(e2) {
            for (const e3 of a2.chats) await t2.actionsController.stop(e3.id);
          }
        };
      })(), (() => {
        const { $chat: t2, $utils: n2, $s: a2 } = e;
        t2.cleanupController = {
          init() {
            this._maxChats = 50, this._dropEmptyChatsOnTabClose(), this._periodicallyDropOldChats(), this._periodicallyDropEmptyChats();
          },
          _dropEmptyChatsOnTabClose() {
            chrome.tabs.onRemoved.addListener((e2) => {
              const t3 = a2.tabs[e2];
              if (!t3) return;
              const n3 = t3.chat;
              n3 && n3.empty && (n3.tabs.length > 1 || a2.chats.delete(n3.id));
            });
          },
          _periodicallyDropOldChats() {
            n2.chrome.alarms.run(this._dropOldChats.bind(this), {
              name: "chat.dropOldChats",
              immediately: true,
              periodInMinutes: 90
            });
          },
          _periodicallyDropEmptyChats() {
            n2.chrome.alarms.run(this._dropEmptyChats.bind(this), {
              name: "chat.dropEmptyChats",
              immediately: true,
              periodInMinutes: 60
            });
          },
          async _dropOldChats() {
            if (a2.chats.length <= this._maxChats) return;
            const e2 = a2.chats.sorted().slice(this._maxChats).map((e3) => e3.id);
            await t2.actionsController.delete(e2);
          },
          async _dropEmptyChats() {
            a2.transaction(() => {
              const e2 = a2.chats.filter((e3) => e3.empty && e3.tabs.length === 0).map((e3) => e3.id);
              for (const t3 of e2) a2.chats.delete(t3);
            });
          }
        };
      })(), (() => {
        const { $chat: t2, $store: n2, $s: a2 } = e;
        t2.controller = {
          init() {
            t2.askController.init(), t2.serpController.init(), t2.actionsController.init(), t2.linkFoldController.init(), t2.linkCacheController.init(), t2.openaiAuthController.init(), t2.cleanupController.init(), t2.attachmentsController.init(), t2.backupController.init(), t2.synchController.init(), t2.downloadController.init();
          },
          async interpolate(e2, o2, i2, r2 = [], s2 = {}) {
            const l2 = a2.chats.get(e2);
            i2 = await t2.paramController.interpolate(e2, o2, i2, s2);
            const c2 = r2.filter((e3) => e3.type === "pdf"), u2 = r2.filter((e3) => e3.type === "image"), p2 = await t2.attachmentsController.interpolate(i2, {
              pdfStartIndex: c2.length + 1,
              imageStartIndex: u2.length + 1
            });
            return {
              text: i2 = p2.text,
              attachments: r2 = [
                ...r2,
                ...p2.attachments.map(
                  (e3) => n2.template.messageAttachment({ ...e3, hidden: true })
                )
              ].slice(0, l2.maxAttachments)
            };
          }
        };
      })(), (() => {
        const { $chat: t2, $bus: n2, $files: a2, $jszip: o2, $utils: i2, $s: r2 } = e;
        t2.downloadController = {
          init() {
            n2.on("chat.downloadChat", this.downloadChat, this);
          },
          async downloadChat(e2, n3, a3) {
            const o3 = r2.chats.get(a3).visibleMessages.map((e3) => {
              if (!e3.text && i2.is.empty(e3.attachments)) return null;
              const n4 = e3.system ? "SYSTEM" : e3.type === "question" ? "USER" : "ASSISTANT";
              let a4 = "";
              if (!i2.is.empty(e3.attachments)) {
                a4 = `ATTACHMENTS: ${t2.attachmentsController.toPlaceholder(e3.attachments)}`;
              }
              return `>>> ${n4}:
${[a4, e3.text.trim()].filter(Boolean).join("\n")}`;
            }).filter(Boolean).join("\n\n");
            await this.downloadContent(e2, n3, o3);
          },
          async downloadContent(e2, i3, r3) {
            const { text: s2, attachments: l2 } = await t2.attachmentsController.interpolate(r3);
            if (l2.length === 0) {
              const t3 = i3.endsWith(".json") ? "application/json" : "text/plain";
              return void await n2.send(e2, "download.download", i3, s2, t3);
            }
            const c2 = new o2(), u2 = i3.endsWith(".txt") ? i3 : `${i3}.txt`;
            c2.file(u2, new Blob([s2], { type: "text/plain" }));
            const p2 = l2.filter((e3) => e3.type === "image");
            for (let e3 = 0; e3 < p2.length; e3++) {
              const t3 = p2[e3], n3 = t3.image.high?.fileId || t3.image.low?.fileId, o3 = await a2.controller.get(n3);
              if (!o3) continue;
              const i4 = o3.type.split("/")[1];
              c2.file(`image-${e3 + 1}.${i4}`, o3);
            }
            const d2 = l2.filter((e3) => e3.type === "pdf");
            for (let e3 = 0; e3 < d2.length; e3++) {
              const t3 = d2[e3].pdf.fileId, n3 = await a2.controller.get(t3);
              n3 && c2.file(`pdf-${e3 + 1}.pdf`, n3);
            }
            const m2 = await c2.generateAsync({ type: "blob" });
            await n2.send(
              e2,
              "download.download",
              `${i3.replace(/.txt$/, "")}.zip`,
              m2,
              "application/zip"
            );
          }
        };
      })(), (() => {
        const { $chat: t2, $idb: n2, $utils: a2 } = e, o2 = ["linkedin.", "twitter.", "facebook.", "instagram."];
        t2.linkCacheController = {
          init() {
            this.fetchPromises = {}, this._periodicallyDropOldLinks();
          },
          async fetchLink(e2, a3, i2, r2) {
            o2.some((e3) => i2.includes(e3)) && (a3 = "render");
            const s2 = this._key(a3, i2), l2 = await n2.get(s2);
            if (l2 && l2?.expiresAt > Date.now()) return l2.text;
            if (this.fetchPromises[s2])
              return Promise.race([
                this.fetchPromises[s2],
                new Promise((e3) => setTimeout(() => e3("failed"), r2))
              ]);
            const c2 = t2.paramYouTubeTranscript.isYoutubeVideoPage(i2);
            return this.fetchPromises[s2] = (c2 ? t2.paramYouTubeTranscript(i2) : e2.crawl(i2, a3, { timeout: r2 })).then((e3) => (delete this.fetchPromises[s2], e3 || "failed")).catch(() => (delete this.fetchPromises[s2], "failed")).then(
              (e3) => (n2.set(s2, { text: e3, expiresAt: this._expiresAt() }), e3)
            ), this.fetchPromises[s2];
          },
          _periodicallyDropOldLinks() {
            a2.chrome.alarms.run(this._dropOldLinks.bind(this), {
              name: "chat.dropOldLinks",
              immediately: true,
              periodInMinutes: 90
            });
          },
          async _dropOldLinks() {
            const e2 = await n2.keys(), a3 = Date.now();
            await Promise.all(
              e2.filter((e3) => e3.startsWith("link:")).map(async (e3) => {
                const o3 = await n2.get(e3);
                o3 && o3.expiresAt <= a3 && (t2.log("dropping idb link storage", e3), await n2.remove(e3));
              })
            );
          },
          _expiresAt: () => Date.now() + 5 * a2.time.MINUTE,
          _key: (e2, t3) => `link:${e2}:${t3}`
        };
      })(), (() => {
        const { $chat: t2, $s: n2 } = e;
        t2.linkFoldController = {
          UNFOLDED_URL_REGEX: /\(https?:\/\/[^/\s]+(\/[^?\s]*)?(\?[^#\s]*)?(#\S*)?\)/g,
          FOLDED_URL_REGEX: /https?:\/\/[^/\s]+\/sh\/(\d+)\b/g,
          init() {
          },
          fold(e2, t3) {
            const a2 = n2.chats.get(e2);
            if (!a2) return t3;
            const o2 = a2.foldedLinks;
            let i2 = Object.keys(o2).length;
            const r2 = {};
            for (const e3 in o2) r2[o2[e3]] = e3;
            const s2 = {};
            return t3 = t3.replace(this.UNFOLDED_URL_REGEX, (e3) => {
              let t4;
              e3 = e3.slice(1, -1);
              try {
                t4 = new URL(e3).hostname;
              } catch (t5) {
                return e3;
              }
              return r2[e3] || (i2++, r2[e3] = i2, s2[i2] = e3), `(https://${t4}/sh/${r2[e3]})`;
            }), a2.foldedLinks = { ...o2, ...s2 }, t3;
          },
          unfold({ chatId: e2, answer: t3 }) {
            if (!t3) return t3;
            const a2 = n2.chats.get(e2)?.foldedLinks;
            return Object.keys(a2).length === 0 ? t3 : t3.replace(this.FOLDED_URL_REGEX, (e3, t4) => a2[t4] || e3);
          }
        };
      })(), (() => {
        const { $chat: t2, $ai: n2, $mobx: a2, $s: o2 } = e;
        t2.openaiAuthController = {
          init() {
            this._checkAuth(), this._checkAuthOnCookieChange(), this._checkAuthOnSwitchingToSession();
          },
          async _checkAuth() {
            if (!this._checkingAuth) {
              this._checkingAuth = true;
              try {
                await n2.api.checkOpenaiAuth();
              } catch (e2) {
                t2.error(e2);
              }
              setTimeout(() => {
                this._checkingAuth = false;
              }, 500);
            }
          },
          async _checkAuthOnCookieChange() {
            let e2, t3 = (await chrome.cookies.get({
              url: o2.feature.chatgpt.sessionCookie.url,
              name: o2.feature.chatgpt.sessionCookie.name
            }))?.value || null;
            chrome.cookies.onChanged.addListener(
              async ({ cookie: n3, removed: a3 }) => {
                if (this._checkingAuth) return;
                const i2 = o2.feature.chatgpt;
                if (n3.domain !== i2.sessionCookie.v2domain) return;
                if (n3.name !== i2.sessionCookie.name) return;
                const r2 = a3 ? null : n3.value;
                clearTimeout(e2), e2 = setTimeout(() => {
                  t3 !== r2 && (t3 = r2, this._checkAuth());
                }, 1e3);
              }
            );
          },
          _checkAuthOnSwitchingToSession() {
            let e2 = o2.settings.spaceConnectionId;
            a2.reaction(
              () => o2.settings.spaceConnectionId,
              async (t3) => {
                const n3 = o2.ai.connections.get(e2), a3 = o2.ai.connections.get(t3);
                e2 = t3, a3?.type !== "openai-session" || n3 && n3.type === "openai-session" || await this._checkAuth();
              }
            );
          }
        };
      })(), (() => {
        const { $chat: t2, $browser: n2, $utils: a2, $mobx: o2, $s: i2 } = e;
        t2.paramController = {
          async interpolateObject(e2, t3, n3, i3 = {}) {
            return a2.is.object(n3) || a2.is.array(n3) ? (n3 = a2.cloneDeep(o2.toJS(n3)), a2.walkObject(n3, async (n4) => {
              if (typeof n4 == "string") return this.interpolate(e2, t3, n4, i3);
            })) : n3;
          },
          async interpolate(e2, t3, n3, a3 = {}) {
            return n3 ? typeof n3 != "string" ? n3 : (n3 = await this._interpolateCustom(e2, n3, a3), n3 = (n3 = await this._interpolatePredefined(
              e2,
              t3,
              n3,
              a3
            )).replace(/{{\\([^{}]+)}}/g, "{{$1}}")) : n3;
          },
          hasParams(e2) {
            return this.regex.test(e2);
          },
          async _interpolateCustom(e2, n3, o3 = {}) {
            if (!this.regex.test(n3)) return n3;
            const i3 = new Set(o3.ignore || []), r2 = /* @__PURE__ */ new Set();
            for (; ; ) {
              const s2 = [...n3.matchAll(this.regex)].map((e3) => e3[1]).filter((e3) => !i3.has(e3)).filter((e3) => !r2.has(e3)), l2 = new Set(s2);
              if (l2.size === 0) break;
              const c2 = {};
              if (c2.content = Array.from(l2)[0], c2.value = this._getCustomParam(e2, c2.content, o3), r2.add(c2.content), a2.is.undefined(c2.value)) {
                const e3 = c2.content.split(" ")[0].split(".")[0];
                if (t2.params.byKey(e3) && !i3.has(e3)) continue;
                c2.value = "\u2014";
              }
              const u2 = this._getPlaceholder(c2.content);
              let p2 = n3.length;
              for (; ; ) {
                const t3 = n3.indexOf(u2, n3.length - p2);
                if (-1 === t3) break;
                p2 = n3.length - t3 - u2.length;
                n3 = (await this.insertValue(e2, n3, u2, c2.value, o3)).text;
              }
            }
            return n3;
          },
          async _interpolatePredefined(e2, o3, r2, s2 = {}) {
            if (!this.regex.test(r2)) return r2;
            const l2 = new Set(s2.ignore || []), c2 = t2.params.filter((e3) => !l2.has(e3.key));
            if (c2.length === 0) return r2;
            const u2 = i2.chats.get(e2).connection, p2 = {
              tab: await chrome.tabs.get(o3),
              page: await n2.controller.connectTab(o3),
              prompt: this._removeParameters(r2)
            }, d2 = /* @__PURE__ */ new Set(), m2 = [];
            for (const e3 of c2)
              Array.from(r2.matchAll(e3.regex)).filter((e4) => !d2.has(e4[0])).forEach((t3) => {
                m2.push({
                  ...e3,
                  placeholder: t3[0],
                  args: t3.groups.args,
                  name: t3.groups.key + (t3.groups.field || ""),
                  index: t3.index
                });
              });
            const h = a2.unique(m2.map((e3) => e3.key)).map((e3) => t2.params.byKey(e3)).filter(Boolean).filter((e3) => e3.preprocess).sort((e3, t3) => e3.order - t3.order);
            for (const e3 of h)
              await e3.preprocess(
                p2,
                m2.filter((t3) => t3.key === e3.key)
              );
            for (const n3 of m2) {
              const a3 = n3.placeholder;
              let i3, l3 = r2.length;
              for (; ; ) {
                const c3 = r2.indexOf(a3, r2.length - l3);
                if (-1 === c3) break;
                if (l3 = r2.length - c3 - a3.length, void 0 === i3) {
                  const e3 = r2.replace(a3, "");
                  p2.args = n3.args, p2.placeholder = n3.placeholder, p2.modelMaxTokens = u2.modelMaxTokens, p2.maxTokens = s2.noLimit ? void 0 : u2.maxRequestTokens - await u2.countTextTokens(e3), i3 = await t2.params.getValue(n3.name, o3, p2), i3 = this._valueToString(i3, s2);
                }
                let d3 = r2.length;
                const h2 = await this.insertValue(e2, r2, a3, i3, s2, n3.index);
                d3 -= h2.text.length, m2.filter((e3) => e3.index > c3).forEach((e3) => e3.index -= d3), r2 = h2.text;
              }
            }
            return r2;
          },
          async insertValue(e2, t3, n3, o3, r2, s2 = 0) {
            if (!t3.includes(n3)) return { text: t3 };
            const l2 = (e3, t4, n4) => {
              const a3 = e3.indexOf(t4, s2);
              return -1 === a3 ? e3 : e3.substring(0, a3) + n4 + e3.substring(a3 + t4.length);
            }, c2 = i2.chats.get(e2).connection, u2 = Math.min(
              c2.maxRequestTokens,
              Number(r2?.maxTokens) || Number.MAX_SAFE_INTEGER
            ), p2 = r2?.noLimit || false, d2 = l2(t3, n3, o3);
            if (p2) return { text: d2 };
            const m2 = l2(t3, n3, ""), h = u2 - await c2.countTextTokens(m2);
            if (h < 10) return { text: m2 };
            const g = await c2.countTextTokens(d2);
            if (g <= u2) return { text: d2 };
            const f = d2.length / g, y = a2.chunkify(o3, (e3) => e3.length / f < 100);
            let b = "", w = "", v = 0, k = y.length, T = Math.ceil((v + k) * (h / g));
            for (; v < k; ) {
              const e3 = y.slice(0, T).join(""), a3 = l2(t3, n3, e3);
              await c2.countTextTokens(a3) <= h ? (b = a3, w = y.join("").slice(e3.length + 1), v = T) : k = T - 1, T = Math.ceil((v + k) / 2);
            }
            return { text: b !== "" ? b : l2(t3, n3, "\u2014"), remaining: w };
          },
          _getCustomParam(e2, t3, n3) {
            const a3 = i2.chats.get(e2).getParam(t3);
            if (void 0 !== a3) return this._valueToString(a3, n3);
          },
          _valueToString(e2, t3) {
            if (a2.is.nil(e2)) return "";
            if (a2.is.array(e2) || a2.is.object(e2))
              try {
                return t3?.noObjectWrap ? JSON.stringify(e2) : `
\`\`\`
${JSON.stringify(e2, null, 2)}
\`\`\``;
              } catch {
                return a2.is.array(e2) ? "array" : "object";
              }
            return String(e2);
          },
          _removeParameters(e2) {
            let t3 = "", n3 = 0;
            for (let a3 = 0; a3 < e2.length; a3++)
              e2[a3] === "{" && e2[a3 + 1] === "{" ? (n3++, a3++, n3 == 1 && t3.at(-1) === " " && (t3 = t3.substring(0, t3.length - 1))) : e2[a3] === "}" && e2[a3 + 1] === "}" ? (n3 > 0 && n3--, a3++) : n3 === 0 && (t3 += e2[a3]);
            return t3;
          },
          _getPlaceholder: (e2) => `{{${e2}}}`,
          get regex() {
            return /\{\{([\p{L}\p{N}][^{}]*)\}\}/gu;
          }
        };
      })(), (() => {
        const { $chat: t2, $bus: n2, $netRules: a2 } = e;
        t2.serpController = {
          init() {
            this._mimicGoogleHeaders(), this._prefetchSerpLinks(), n2.on("chat.getSerpQuery", this._getSerpQuery, this);
          },
          async _mimicGoogleHeaders() {
            const e2 = await navigator.userAgentData.getHighEntropyValues([
              "architecture",
              "bitness",
              "uaFullVersion",
              "fullVersionList",
              "model",
              "platformVersion",
              "wow64"
            ]), t3 = {
              referer: "https://www.google.com/",
              "sec-fetch-site": "same-origin",
              "sec-fetch-dest": "document",
              "sec-fetch-mode": "navigate",
              "sec-fetch-user": "?1",
              "sec-ch-ua-arch": `"${e2.architecture}"`,
              "sec-ch-ua-bitness": `"${e2.bitness}"`,
              "sec-ch-ua-full-version": `"${e2.uaFullVersion}"`,
              "sec-ch-ua-full-version-list": e2.fullVersionList.map((e3) => `"${e3.brand}";v="${e3.version}"`).join(", "),
              "sec-ch-ua-model": `"${e2.model}"`,
              "sec-ch-ua-platform-version": `"${e2.platformVersion}"`,
              "sec-ch-ua-wow64": e2.wow64 ? "?1" : "?0",
              "upgrade-insecure-requests": "1"
            };
            await a2.register({
              condition: { urlFilter: "https://www.google.com/*__hrpserp" },
              action: {
                type: "modifyHeaders",
                requestHeaders: Object.keys(t3).map((e3) => ({
                  header: e3,
                  operation: "set",
                  value: t3[e3]
                }))
              }
            });
          },
          _prefetchSerpLinks() {
          },
          _getSerpQuery(e2) {
            const n3 = t2.searchEngines.find((t3) => t3.check(e2));
            if (!n3) return null;
            try {
              return new URL(e2).searchParams.get(n3.query).trim();
            } catch {
            }
            return null;
          }
        };
      })(), (() => {
        const { $chat: t2, $bus: n2, $env: a2, $utils: o2, $store: i2, $s: r2 } = e;
        t2.synchController = {
          init() {
            this.TRACKED_CHAT_KEYS = /* @__PURE__ */ new Set(["title", "emoji", "messages"]), this._actions = [], this._ignoreActions = false, this._onAfterStateChange = this._onAfterStateChange.bind(this), i2.stateController.onAfterChange(this._onAfterStateChange), this._updateChatIds(), this._synch = this._synch.bind(this), n2.on("chat.synchChats", this._synch), n2.on("chat.switchScreenMounted", this._synch), this._synch();
          },
          get enabled() {
            return r2.settings.synchChats && r2.billing.loggedIn && r2.billing.hasPro();
          },
          _updateChatIds() {
            this._chatIds = r2.chats.map((e2) => e2.id);
          },
          _sanitizeMessages(e2) {
            e2 = o2.ensureArray(e2);
            const t3 = o2.cloneDeep(e2);
            return t3.forEach((e3) => {
              delete e3.id, delete e3.html, delete e3.itext, e3.func && !e3.func.name && delete e3.func, e3.badge === null && delete e3.badge, e3.onCodeClick === null && delete e3.onCodeClick, e3.commandName === null && delete e3.commandName, false === e3.silent && delete e3.silent, e3.silent && (e3.text = "");
            }), t3;
          },
          _onAfterStateChange(e2) {
            if (!this.enabled) return;
            if (this._ignoreActions) return;
            const t3 = this._actions.length;
            e2.forEach((e3) => {
              if (e3.type === "splice" && e3.path.length === 1 && e3.path[0] === "chats") {
                if (e3.added?.length > 0)
                  for (const t4 of e3.added)
                    this._actions.push({
                      action: "create",
                      chatId: t4.id,
                      title: t4.title,
                      emoji: t4.emoji,
                      messages: this._sanitizeMessages(t4.messages)
                    });
                if (e3.removedCount) {
                  const e4 = r2.chats.map((e5) => e5.id), t4 = o2.without(this._chatIds, e4);
                  for (let e5 = 0; e5 < t4.length; e5++)
                    this._actions.push({ action: "remove", chatId: t4[e5] });
                }
                this._updateChatIds();
              } else if (e3.type === "set" && e3.path.length === 2 && e3.path[0] === "chats" && typeof e3.path[1] == "number") {
                const t4 = e3.key;
                if (!this.TRACKED_CHAT_KEYS.has(t4)) return;
                const n3 = r2.chats[e3.path[1]];
                if (!n3) return;
                const a3 = t4 === "messages" ? this._sanitizeMessages(e3.value) : e3.value;
                this._actions.push({ action: "update", chatId: n3.id, [t4]: a3 });
              } else if (e3.type === "splice" && e3.path.length === 3 && e3.path[0] === "chats" && typeof e3.path[1] == "number" && e3.path[2] === "messages" && e3.added.length !== 0) {
                const t4 = r2.chats[e3.path[1]];
                if (!t4) return;
                for (const n3 of e3.added) {
                  const e4 = n3.type === "question", a3 = !(n3.type !== "answer" || !n3.done);
                  if (!(e4 || a3)) return;
                  this._actions.push({
                    action: "append",
                    chatId: t4.id,
                    append: this._sanitizeMessages(n3)
                  });
                }
              } else if (e3.type === "set" && e3.key === "done" && true === e3.value && e3.path.length === 4 && e3.path[0] === "chats" && typeof e3.path[1] == "number" && e3.path[2] === "messages" && typeof e3.path[3] == "number") {
                const t4 = r2.chats[e3.path[1]];
                if (!t4) return;
                const n3 = t4.messages[e3.path[3]];
                this._actions.push({
                  action: "append",
                  chatId: t4.id,
                  append: this._sanitizeMessages(n3)
                });
              }
            }), t3 !== this._actions.length && this._update();
          },
          async _update() {
            if (!this.enabled) return;
            if (this._actions.length === 0) return;
            const e2 = { ...this._options("PUT"), body: {} }, n3 = {};
            for (const e3 of this._actions) {
              const t3 = e3.chatId;
              n3[t3] ??= {}, e3.action === "create" ? n3[t3] = {
                action: "create",
                title: e3.title,
                emoji: e3.emoji,
                messages: e3.messages
              } : e3.action === "remove" ? n3[t3] = { action: "remove" } : e3.action === "update" ? (n3[t3].action = "update", e3.hasOwnProperty("title") && (n3[t3].title = e3.title), e3.hasOwnProperty("emoji") && (n3[t3].emoji = e3.emoji), e3.hasOwnProperty("messages") && (n3[t3].messages = e3.messages)) : e3.action === "append" && (n3[t3].action = "append", n3[t3].append ??= [], n3[t3].append.push(...e3.append));
            }
            for (const t3 in n3)
              n3[t3].action === "remove" ? n3[t3] = { action: "remove" } : n3[t3].messages && n3[t3].append && (n3[t3].action = "update", n3[t3].messages = [...n3[t3].messages, ...n3[t3].append], delete n3[t3].append), e2.body[t3] = n3[t3];
            this._actions = [], r2.transaction((e3) => {
              for (const t3 in n3) {
                const n4 = e3.chats.find((e4) => e4.id === t3);
                n4 && (n4.updatedAt = Date.now());
              }
            });
            try {
              e2.body = { chats: e2.body }, e2.body = JSON.stringify(e2.body);
              let t3 = await fetch(`${a2.apiUrl}/chats`, e2);
              if (t3.status === 401) return;
              if (t3 = await t3.json(), t3.status !== "ok")
                throw new Error(t3.message);
            } catch (e3) {
              t2.warn("failed updating chats", e3);
            }
          },
          async _synch() {
            if (!this.enabled) return;
            this._actions.length > 0 && await this._update();
            const e2 = {
              ...this._options("POST"),
              body: { createChats: [], refreshChats: [], refreshAfter: 0 }
            };
            r2.chats.filter((e3) => !e3.updatedAt).forEach((t3) => {
              e2.body.createChats.push({
                id: t3.id,
                title: t3.title,
                emoji: t3.emoji,
                messages: this._sanitizeMessages(t3.messages)
              });
            }), r2.chats.filter((e3) => e3.updatedAt).forEach((t3) => {
              e2.body.refreshChats.push(t3.id), e2.body.refreshAfter = Math.max(
                e2.body.refreshAfter,
                t3.updatedAt
              );
            });
            try {
              e2.body = JSON.stringify(e2.body);
              let n3 = await fetch(`${a2.apiUrl}/chats`, e2);
              if (n3.status === 401) return;
              if (n3 = await n3.json(), n3.status !== "ok")
                throw new Error(n3.message);
              this._ignoreActions = true;
              const s2 = [];
              r2.transaction((e3) => {
                for (const t4 in n3.chats || {}) {
                  const a3 = n3.chats[t4];
                  if (!a3) {
                    s2.push(t4);
                    continue;
                  }
                  let l2 = r2.chats.get(t4);
                  if (l2) {
                    l2.title = a3.title, l2.emoji = a3.emoji;
                    const e4 = l2.messages.at(-1);
                    l2.messages = a3.messages.map((e5) => ({
                      id: o2.id.nano(),
                      ...e5
                    })), e4?.options && l2.messages.push(e4);
                  } else
                    l2 = i2.template.chat({
                      id: t4,
                      title: a3.title,
                      emoji: a3.emoji
                    }), l2.messages = a3.messages.map((e4) => ({
                      id: o2.id.nano(),
                      ...e4
                    })), e3.chats.push(l2);
                }
                const t3 = Date.now();
                e3.chats.forEach((e4) => e4.updatedAt = t3);
              }), await t2.actionsController.delete(s2), this._updateChatIds(), this._ignoreActions = false;
            } catch (e3) {
              t2.warn("failed synching chats", e3);
            }
          },
          _options: (e2 = "POST") => ({
            method: e2,
            headers: {
              "content-type": "application/json",
              authorization: `Bearer ${r2.billing.jwt}`
            }
          })
        };
      })(), (() => {
        const { $chat: t2, $browser: n2, $utils: a2 } = e;
        t2.params = [
          { key: "proPlan", value: t2.paramProPlan },
          { key: "connection", value: t2.paramConnection, isObject: true },
          { key: "userinfo", value: t2.paramUserinfo },
          { key: "date", value: t2.paramDate },
          { key: "time", value: t2.paramTime },
          { key: "language", value: t2.paramLanguage },
          { key: "title", value: t2.paramPageTitle },
          { key: "url", value: t2.paramPageUrl },
          { key: "domain", value: t2.paramPageDomain },
          { key: "desc", value: t2.paramPageDesc },
          { key: "input", value: t2.paramPageInput },
          { key: "selection", value: t2.paramPageSelection },
          { key: "email", value: t2.paramPageEmail, isObject: true },
          { key: "thread", value: t2.paramPageThread, isObject: true },
          { key: "transcript", value: t2.paramYouTubeTranscript, plain: false },
          { key: "transcriptPlain", value: t2.paramYouTubeTranscript, plain: true },
          { key: "serp", value: t2.paramSerp },
          { key: "message", value: t2.paramMessage },
          { key: "cost", value: t2.paramCost },
          { key: "gpt", value: t2.paramGpt },
          { key: "grab", value: t2.paramGrab },
          { key: "page", value: t2.paramPage, preprocess: t2.paramPagePreprocess },
          { key: "view", value: t2.paramView },
          { key: "assert", value: t2.paramAssert }
        ], t2.params.forEach((e2, t3) => {
          let n3 = `{{(?<key>${a2.string.escapeRegExp(e2.key)})`;
          e2.isObject && (n3 += "(?<field>\\.[^{} ]+)?"), n3 += "( (?<args>[^{}]+))?}}", e2.regex = new RegExp(n3, "g"), e2.order = t3;
        }), t2.params.byKey = (e2) => t2.params.find(
          (t3) => t3.key === e2 || t3.isObject && e2.startsWith(t3.key + ".")
        ), t2.params.getValue = async (e2, o2, i2 = {}) => {
          if (!o2) return;
          const r2 = t2.params.byKey(e2);
          if (!r2) return;
          void 0 === i2.tabId && (i2.tabId = o2), void 0 === i2.tab && (i2.tab = await chrome.tabs.get(o2)), void 0 === i2.page && (i2.page = await n2.controller.connectTab(o2)), void 0 === i2.args && (i2.args = "");
          let s2 = await r2.value.call(exports, i2, r2);
          if (r2.isObject) {
            const t3 = e2.slice(r2.key.length + 1);
            t3 && (s2 = a2.get(s2, t3));
          }
          return s2;
        };
      })(), (() => {
        const { $backup: t2, $netRules: n2, $idb: a2, $bus: o2, $utils: i2 } = e;
        t2.controller = {
          async init() {
          },
          async _allowBackupIframe() {
            await n2.register({
              condition: { urlFilter: "https://harpa.ai/backup" },
              action: {
                type: "modifyHeaders",
                responseHeaders: [
                  { header: "x-frame-options", operation: "remove" }
                ]
              }
            });
          },
          async _restoreIfNeeded() {
            try {
              if (!navigator.onLine) return;
              if (await a2.get("store.state")) return;
              await this._restore();
            } catch (e2) {
              t2.error("failed to restore data", e2);
            }
          },
          _periodicallySaveIdb() {
            let e2 = true;
            a2.on("change", () => e2 = true), i2.chrome.alarms.run(
              async () => {
                e2 && (e2 = false, await this._save());
              },
              { name: "backup.save", periodInMinutes: 60 }
            );
          },
          _periodicallyDropIframe() {
            i2.chrome.alarms.run(
              () => {
                this._iframe && (this._iframe.remove(), this._iframe = null);
              },
              { name: "backup.dropIframe", periodInMinutes: 1440 }
            );
          },
          async _restore() {
            const e2 = Date.now();
            t2.log("restoring...");
            const n3 = await this._read();
            if (!n3) return void t2.log("no backup found");
            for (const e3 in n3) await a2.set(e3, n3[e3]);
            const o3 = Date.now() - e2;
            t2.log(`restored (${o3}ms)`);
          },
          async _read() {
            return await this._ensureIframe() ? await this._send("read") : null;
          },
          async _save() {
            if (!await this._ensureIframe()) return;
            const e2 = {}, t3 = await a2.keys();
            for (const n3 of t3) e2[n3] = await a2.get(n3);
            await this._send("save", e2);
          },
          async _ensureIframe() {
            if (this._iframe) return true;
            const e2 = i2.createPromise();
            o2.on("backup.ready", () => e2.resolve());
            let t3 = document.querySelector("iframe[backup]");
            t3 && t3.remove(), t3 = document.createElement("iframe"), t3.src = "https://harpa.ai/backup", t3.setAttribute("backup", ""), document.body.appendChild(t3);
            const n3 = await Promise.any([
              e2.then(() => true),
              i2.sleep(5 * i2.time.SECOND).then(() => false)
            ]);
            return o2.off("backup.ready"), n3 && (this._iframe = t3), n3;
          },
          async _send(e2, ...t3) {
            const n3 = this._generateId();
            this._iframe.contentWindow.postMessage(
              { $backup: true, reqId: n3, name: e2, args: t3 },
              "*"
            );
            return await new Promise((e3) => {
              const t4 = (a3) => {
                const o3 = a3.data;
                !(!o3 || !o3.$backup || o3.resId !== n3) && (window.removeEventListener("message", t4), e3(o3.result));
              };
              window.addEventListener("message", t4);
            });
          },
          _generateId: () => `${Date.now()}_${Math.random().toString(36).slice(2)}`
        };
      })(), (() => {
        const { $chrome: t2, $utils: n2 } = e;
        t2.controller = {
          init() {
            this._patchMethods();
          },
          _patchMethods() {
            const e2 = chrome.tabs.get.bind(chrome.tabs);
            chrome.tabs.get = (...t4) => n2.noThrow(() => e2(...t4));
            const t3 = chrome.windows.get.bind(chrome.windows);
            chrome.windows.get = (...e3) => n2.noThrow(() => t3(...e3));
            const a2 = chrome.cookies.get.bind(chrome.cookies);
            chrome.cookies.get = (...e3) => n2.noThrow(() => a2(...e3)), chrome.executeScript = async (e3, t4, n3 = {}) => {
              const a3 = { target: { tabId: e3 }, func: t4 };
              n3.args?.length > 0 && (a3.args = n3.args);
              return (await chrome.scripting.executeScript(a3))?.[0]?.result;
            };
          }
        };
      })(), (() => {
        const { $commands: t2 } = e;
        t2.controller = {
          init() {
            t2.synchController.init(), t2.suggestionsController.init(), t2.recipeController.init();
          }
        };
      })(), (() => {
        const { $commands: t2, $bus: n2, $env: a2, $s: o2 } = e;
        t2.recipeController = {
          init() {
            n2.on("commands.sendRecipesInstall", this._sendRecipesInstall, this);
          },
          async _sendRecipesInstall(e2 = []) {
            e2.length !== 0 && await fetch(`${a2.apiUrl}/recipes/install`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${o2.billing.jwt}`
              },
              body: JSON.stringify({ recipeIds: e2 })
            });
          }
        };
      })(), (() => {
        const { $commands: t2, $jsyaml: n2, $utils: a2, $env: o2, $s: i2 } = e;
        t2.suggestionsController = {
          init() {
            this.readSuggestions();
          },
          async readSuggestions() {
            if (o2.is.production && i2.commands.suggestions.version === o2.version)
              return;
            let e2;
            try {
              const o3 = chrome.runtime.getURL(
                "/commands/command-suggestions.yaml"
              ), i3 = await fetch(o3).then((e3) => e3.text()).then((e3) => n2.load(e3)), r2 = new Set(
                t2.systemCommands.map((e3) => e3.meta.name.toLowerCase())
              );
              e2 = i3.mapping, e2.forEach((e3) => {
                e3.urls && (e3.urls = a2.ensureArray(e3.urls)), e3.hasSelection = e3.hasSelection || false, e3.hasInput = e3.hasInput || false, e3.options.map((e4) => e4.command?.toLowerCase()).filter((e4) => e4 && !r2.has(e4)).forEach((e4) => {
                  t2.warn(`system command ${e4} not found`);
                });
              });
            } catch (e3) {
              return void t2.error("failed loading suggestions", e3);
            }
            i2.transaction(() => {
              i2.commands.suggestions.version = o2.version, i2.commands.suggestions.mapping = e2;
            });
          }
        };
      })(), (() => {
        const { $commands: t2, $utils: n2, $env: a2, $bus: o2, $mobx: i2, $s: r2 } = e;
        t2.synchController = {
          init() {
            o2.on("commands.onCreate", this.onCreate.bind(this)), o2.on("commands.onUpdate", this.onUpdate.bind(this)), o2.on("commands.onRemove", this.onRemove.bind(this)), o2.on("commands.synch", this.synch.bind(this)), i2.reaction(
              () => r2.billing.loggedIn,
              () => this.synch(),
              { fireImmediately: true }
            );
          },
          async onCreate(e2) {
            if (!r2.billing.loggedIn) return;
            if ((e2 = n2.ensureArray(e2).filter((e3) => !e3.createdAt)).length === 0)
              return;
            const o3 = {
              ...this._options("POST"),
              body: JSON.stringify({ spaceId: r2.billing.spaceId, commands: e2 })
            };
            try {
              const t3 = await fetch(`${a2.apiUrl}/commands`, o3).then(
                (e3) => e3.json()
              );
              if (t3.status !== "ok") throw new Error(t3.message);
              const n3 = t3.created;
              if (!n3 || n3.length === 0) return;
              r2.transaction(() => {
                n3.forEach((t4, n4) => {
                  const a3 = r2.commands.list.findIndex(
                    (t5) => t5.meta.name === e2[n4].meta.name
                  );
                  -1 !== a3 && (r2.commands.list[a3] = t4);
                });
              });
            } catch (e3) {
              t2.warn("failed creating commands", e3);
            }
          },
          async onUpdate(e2) {
            if (!r2.billing.loggedIn) return;
            if ((e2 = n2.ensureArray(e2)).length === 0) return;
            const o3 = this._options("PUT");
            try {
              let t3 = null;
              if (e2.length === 1) {
                const n3 = `${a2.apiUrl}/command/${e2[0].meta.name}`;
                o3.body = JSON.stringify({ command: e2[0] });
                const i3 = await fetch(n3, o3).then((e3) => e3.json());
                if (i3.status !== "ok") throw new Error(i3.message);
                t3 = [i3.updated];
              } else {
                const n3 = `${a2.apiUrl}/commands`;
                o3.body = JSON.stringify({ commands: e2 });
                const i3 = await fetch(n3, o3).then((e3) => e3.json());
                if (i3.status !== "ok") throw new Error(i3.message);
                t3 = i3.updated;
              }
              if (!t3 || t3.length === 0) return;
              r2.transaction(() => {
                t3.forEach((e3) => {
                  const t4 = r2.commands.list.findIndex(
                    (t5) => t5.meta.name === e3.meta.name
                  );
                  -1 !== t4 && (r2.commands.list[t4] = e3);
                });
              });
            } catch (e3) {
              t2.warn("failed updating commands");
            }
          },
          async onRemove(e2) {
            if (!r2.billing.loggedIn) return;
            if ((e2 = n2.ensureArray(e2).filter((e3) => e3.createdAt).map((e3) => e3.meta.name)).length === 0)
              return;
            const o3 = this._options("DELETE");
            try {
              if (e2.length === 1) {
                const t3 = `${a2.apiUrl}/command/${e2[0]}`, n3 = await fetch(t3, o3).then((e3) => e3.json());
                if (n3.status !== "ok") throw new Error(n3.message);
              } else {
                const t3 = `${a2.apiUrl}/commands`;
                o3.body = JSON.stringify({ commands: e2 });
                const n3 = await fetch(t3, o3).then((e3) => e3.json());
                if (n3.status !== "ok") throw new Error(n3.message);
              }
            } catch (e3) {
              t2.warn("failed removing commands");
            }
          },
          async synch(e2 = 0) {
            if (e2) {
              if (Date.now() - (this._lastSynch || 0) < e2) return;
              this._lastSynch = Date.now();
            }
            r2.billing.loggedIn && (await this._synchLocalCommands(), await this._synchServerCommands());
          },
          async _synchLocalCommands() {
            const e2 = r2.commands.list.filter((e3) => !e3.createdAt && !e3.fresh).map((e3) => i2.toJS(e3));
            if (e2.length === 0) return;
            const n3 = {
              ...this._options("POST"),
              body: JSON.stringify({ spaceId: r2.billing.spaceId, commands: e2 })
            };
            try {
              const t3 = await fetch(`${a2.apiUrl}/commands`, n3).then(
                (e3) => e3.json()
              );
              if (t3.status !== "ok") throw new Error(t3.message);
              const o3 = t3.created;
              if (!o3 || o3.length === 0) return;
              this._changeCommandNames(e2, o3), this._applyCommandUpdates(o3);
            } catch (e3) {
              t2.warn("failed storing local commands", e3);
            }
          },
          _changeCommandNames(e2, t3) {
            if (t3.length === 0) return;
            const n3 = {};
            e2.forEach((e3, a3) => {
              e3.meta.name && (n3[e3.meta.name] = t3[a3].meta.name);
            }), r2.transaction(() => {
              Object.keys(n3).forEach((e3) => {
                const t4 = r2.commands.list.find((t5) => t5.meta.name === e3);
                t4 && (t4.meta.name = n3[e3]);
              }), r2.commands.favoriteCommandNames = r2.commands.favoriteCommandNames.map((e3) => n3[e3] || e3), r2.commands.archivedCommandNames = r2.commands.archivedCommandNames.map((e3) => n3[e3] || e3), r2.chats.forEach((e3) => {
                e3.messages.filter((e4) => e4.commandName).forEach((e4) => {
                  const t4 = e4.commandName.slice(1);
                  n3[t4] && (e4.commandName = `/${n3[t4]}`);
                });
              });
            });
          },
          _applyCommandUpdates(e2) {
            e2.length !== 0 && r2.transaction(() => {
              e2.forEach((e3) => {
                const t3 = r2.commands.list.findIndex(
                  (t4) => t4.meta.name === e3.meta.name
                );
                -1 !== t3 && (r2.commands.list[t3] = e3);
              });
            });
          },
          async _synchServerCommands() {
            const e2 = r2.commands.list.filter((e3) => e3.createdAt).map((e3) => ({ id: e3.meta.name, updatedAt: e3.updatedAt })), n3 = {
              ...this._options("POST"),
              body: JSON.stringify({ commands: e2 })
            };
            try {
              let e3 = await fetch(`${a2.apiUrl}/commands/synch`, n3);
              if (e3.status === 401) return;
              if (e3 = await e3.json(), e3.status !== "ok")
                throw new Error(e3.message);
              const { created: t3, updated: o3, deleted: i3 } = e3;
              if (t3.length === 0 && o3.length === 0 && i3.length === 0) return;
              r2.transaction(() => {
                t3.sort(
                  (e4, t4) => e4.createdAt < t4.createdAt ? 1 : e4.createdAt > t4.createdAt ? -1 : 0
                ).forEach((e4) => {
                  r2.commands.list.push(e4);
                }), o3.forEach((e4) => {
                  const t4 = r2.commands.list.findIndex(
                    (t5) => t5.meta.name === e4.meta.name
                  );
                  -1 !== t4 && (r2.commands.list[t4] = e4);
                }), i3.forEach((e4) => {
                  const t4 = r2.commands.list.findIndex((t5) => t5.meta.name === e4);
                  -1 !== t4 && r2.commands.list.splice(t4, 1);
                });
              });
            } catch (e3) {
              t2.warn("failed synching commands");
            }
          },
          _options: (e2 = "POST") => ({
            method: e2,
            headers: {
              "content-type": "application/json",
              authorization: `Bearer ${r2.billing.jwt}`
            }
          })
        };
      })(), (() => {
        const { $commands: t2, $capture: n2, $utils: a2, $bus: o2 } = e;
        t2.stepAsk = {
          run: async ({
            tabId: e2,
            step: t3,
            chat: i2,
            interpolate: r2,
            addInput: s2
          }) => {
            const l2 = i2.command.inputs || [], c2 = Boolean(l2.length > 0 && l2[0]);
            let u2 = t3.message;
            false !== t3.interpolate && (u2 = await r2(u2, { noLimit: true })), u2 && i2.addAnswer({ text: u2, silent: t3.silent || c2, done: true });
            const p2 = { type: "ask", param: t3.param, silent: t3.silent || c2 };
            a2.is.array(t3.options) && t3.options.length > 0 ? (p2.paramType = "choice", p2.options = t3.options) : (p2.paramType = "string", p2.value = ""), p2.options && (p2.options = a2.ensureArray(p2.options), p2.options = p2.options.filter(Boolean).map(
              (e3) => e3 === "$custom" ? { value: "$custom", input: "" } : e3
            ).map((e3) => typeof e3 == "string" ? { label: e3, value: e3 } : e3).filter((e3) => a2.is.object(e3)).filter(
              (e3, t4, n3) => e3.value !== "$custom" || n3.findIndex((e4) => e4.value === "$custom") === t4
            ).sort(
              (e3, t4) => e3.value === "$custom" ? 1 : t4.value === "$custom" ? -1 : 0
            ).map((e3, t4) => ({ ...e3, selected: t4 === 0 })));
            let d2 = i2.command.inputs?.shift(), m2 = {};
            if (a2.is.object(d2)) {
              const { value: e3, ...t4 } = d2;
              d2 = e3, m2 = t4;
            }
            e: if (d2) {
              if (p2.value = d2, p2.paramType !== "choice" || (p2.options || []).length === 0)
                break e;
              const e3 = (await r2(d2, { noLimit: true })).toLowerCase(), t4 = p2.options.findIndex(
                (t5) => t5.value !== "$custom" && String(t5.label || t5.value || "").toLowerCase().includes(e3)
              );
              if (-1 !== t4) {
                p2.options.forEach((e4, n4) => e4.selected = n4 === t4);
                break e;
              }
              const n3 = p2.options.find((e4) => e4.value === "$custom");
              n3 && (p2.options.forEach((e4) => e4.selected = false), n3.input = d2, n3.selected = true);
            }
            const h = t3.vision;
            e: if (h?.enabled) {
              if (!a2.is.nil(d2) && i2.hasAttachments) break e;
              let r3;
              if (h.mode === "area") {
                const a3 = h.hint || t3.message;
                r3 = await n2.controller.captureArea(e2, a3);
              } else h.mode === "view" && (r3 = await n2.controller.captureView(e2));
              if (!r3) break e;
              h.send && await o2.send(e2, "chat.hideAttachments");
              try {
                await o2.send(e2, "chat.attach", [r3]);
                if (!await a2.waitFor(() => i2.attachments.every((e3) => e3.ready), {
                  timeout: 5e3
                }))
                  throw i2.attachments = [], new Error("Failed to process the captured image");
                h.send && (d2 = "");
              } catch (t4) {
                throw h.send && await o2.send(e2, "chat.showAttachments"), t4;
              }
            }
            if (i2.addAsk(p2), !a2.is.nil(d2)) {
              const e3 = !h?.send;
              await s2(d2, { delay: 100, silent: e3, ...m2 });
            }
            return h && h.enabled && h.send && await o2.send(e2, "chat.showAttachments"), i2.actualizeAsk(), "abort";
          }
        };
      })(), (() => {
        const {
          $commands: t2,
          $yousummary: n2,
          $utils: a2,
          $feature: o2,
          $billing: i2,
          $s: r2
        } = e, s2 = ["\u278A", "\u278B", "\u278C", "\u278D", "\u278E", "\u278F", "\u2790", "\u2791", "\u2792", "\u2793"];
        t2.stepCalc = {
          run: async ({
            tabId: e2,
            chat: p2,
            step: d2,
            setParam: m2,
            getParam: h,
            interpolate: g,
            interpolateObject: f
          }) => {
            const y = d2.func || "set", b = d2.param || "param", w = d2.from || "gpt", v = d2.format || "auto", k = d2.data || "number", T = d2.to || "param", A = d2.list || "list", E = d2.listA || "a", I = d2.listB || "a", S = d2.by || "", x = d2.item || "param", C = d2.index || "first", O = d2.case || "upper", R = d2.delimiter || ", ", _ = d2.template || "", P = a2.string.toRegex(d2.regex, "g"), N = Number.isNaN(Number(d2.delta)) ? 1 : Number(d2.delta), D = a2.json.parse(d2.prop, { fallback: String(d2.prop) }), L = d2.matched || "retain", M = d2.method || "update-config";
            let $ = d2.match || "first";
            ["first", "last", "all"].includes($) || (Number.isNaN(Number($)) ? ($ = a2.json.parse($, { fallback: String($) }), a2.is.string($) && ($ = await g($, { noLimit: true }))) : $ = Number($) || 0);
            let U = null;
            if (y === "set") {
              const e3 = (e4) => a2.is.nonPrimitive(e4) ? e4 : a2.json.parse(e4, { throw: true }), t3 = (e4) => a2.is.nonPrimitive(e4) ? a2.json.stringify(e4, { fallback: "[STRINGIFY FAILED]" }) : String(e4);
              if (v === "auto")
                try {
                  U = await f(e3(d2.value), { noLimit: true });
                } catch {
                  U = await g(t3(d2.value), { noLimit: true }), U === "true" ? U = true : U === "false" ? U = false : Number.isNaN(Number(U)) || U === "" || (U = Number(U));
                }
              else if (v === "json")
                try {
                  U = e3(d2.value), U = await f(U, { noLimit: true });
                } catch {
                  U = void 0;
                }
              else
                v === "boolean" ? (U = await g(t3(d2.value), { noLimit: true }), U = U !== "false") : v === "number" ? (U = await g(t3(d2.value), { noLimit: true }), U = Number(U)) : v === "text" && (U = await g(t3(d2.value), { noLimit: true }), U = String(U));
              return m2(b, U);
            }
            if (y === "delete") return m2(b, void 0);
            if (y === "clone") return U = await h(w), m2(T, U);
            if (y === "increment")
              return U = await h(b), U = (Number(U) || 0) + N, m2(b, U);
            if (y === "first-line" || y === "last-line")
              return U = await h(b), U = l2(U).split("\n"), U = y === "first-line" ? U.find((e3) => e3.trim().length > 0) || "" : U.findLast((e3) => e3.trim().length > 0) || "", m2(T, U);
            if (y === "change-case") {
              switch (U = await h(b), U = l2(U), O) {
                case "upper":
                  U = U.toUpperCase();
                  break;
                case "lower":
                  U = U.toLowerCase();
                  break;
                case "title":
                  U = a2.string.toTitleCase(U);
                  break;
                case "sentence":
                  U = a2.string.toSentenceCase(U);
                  break;
                case "pascal":
                  U = a2.string.toPascalCase(U);
                  break;
                case "camel":
                  U = a2.string.toCamelCase(U);
                  break;
                case "kebab":
                  U = a2.string.toKebabCase(U);
                  break;
                case "underscore":
                  U = a2.string.toUnderscoreCase(U);
              }
              return m2(T, U);
            }
            if (y === "replace")
              return U = await h(b), U = l2(U), P ? (U = P.flags.includes("g") ? U.replaceAll(P, _) : U.replace(P, _), m2(T, U)) : m2(T, U);
            if (y === "match") {
              if (U = await h(b), U = l2(U), !P) return m2(T, U);
              if (P.flags.includes("g")) {
                const e3 = Array.from(U.matchAll(P) || []);
                if (!e3) return m2(T, []);
                U = e3.map((e4) => void 0 === e4.groups ? e4[0] : e4.groups);
              } else {
                const e3 = U.match(P);
                if (!e3) return m2(T, null);
                U = a2.is.undefined(e3.groups) ? e3[0] : e3.groups;
              }
              return m2(T, U);
            }
            if (y === "split")
              return U = await h(b), U = l2(U), U = R.startsWith("/") ? U.split(a2.string.toRegex(R, "")) : U.split(R), m2(T, U);
            if (y === "extract-code") {
              U = await h(b), U = l2(U);
              const e3 = /^```(?<lang>\S*)\s(?<code>[\s\S]*?)\s^```/gm, t3 = Array.from(U.matchAll(e3) || []);
              if (C === "all")
                return t3 ? (U = t3.map((e4) => e4.groups), m2(T, U)) : m2(T, []);
              {
                if (!t3) return m2(T, void 0);
                const e4 = C === "last" ? t3.length - 1 : C === "first" ? 0 : Number(C) || 0;
                return U = t3.at(e4)?.groups?.code || void 0, m2(T, U);
              }
            }
            if (y === "extract-json") {
              U = await h(b), U = l2(U);
              const e3 = /^```(?<lang>\S*)\s(?<code>[\s\S]*?)\s^```/gm;
              let t3 = Array.from(U.matchAll(e3) || []);
              if (t3 && t3.length !== 0) {
                if (C === "all") {
                  if (!t3) return m2(T, []);
                  U = t3.map((e4) => e4.groups);
                  try {
                    U = U.map((e4) => JSON.parse(e4.code));
                  } catch {
                    U = [];
                  }
                  return m2(T, U);
                }
                {
                  if (!t3) return m2(T, void 0);
                  const e4 = C === "last" ? t3.length - 1 : C === "first" ? 0 : Number(C) || 0;
                  U = t3.at(e4)?.groups?.code || void 0;
                  try {
                    U = JSON.parse(U);
                  } catch {
                    U = void 0;
                  }
                  return m2(T, U);
                }
              }
              const n3 = a2.json.parse(U, { fallback: void 0 });
              if (void 0 !== n3) return m2(T, n3);
              if (t3 = c2(U), C === "all") return m2(T, t3 || []);
              {
                if (!t3) return m2(T, void 0);
                const e4 = C === "last" ? t3.length - 1 : C === "first" ? 0 : Number(C) || 0;
                return U = t3.at(e4) || void 0, m2(T, U);
              }
            }
            if (y === "extract-data") {
              if (U = await h(b), U = l2(U), U = a2.extractor.extract(U).items, k !== "all" && (U = U.filter((e3) => e3.type === k)), C !== "all") {
                const e3 = C === "last" ? U.length - 1 : C === "first" ? 0 : Number(C) || 0;
                U = U.at(e3) || void 0;
              }
              return m2(T, U);
            }
            if (y === "encode-url")
              return U = await h(b), U = l2(U), U = a2.url.smartEncode(U), m2(T, U);
            if (y === "decode-url")
              return U = await h(b), U = l2(U), U = a2.url.smartDecode(U), m2(T, U);
            if (y === "list-add") {
              let e3 = await h(A);
              if (e3 = a2.is.array(e3) ? e3 : [], U = await h(x), C === "last" || C === "all")
                e3.push(U);
              else if (C === "first") e3.unshift(U);
              else {
                const t3 = Number(C) || 0;
                e3.splice(t3, 0, U);
              }
              return m2(A, e3);
            }
            if (y === "list-filter") {
              let e3 = await h(A);
              e3 = a2.is.array(e3) ? e3 : [];
              const t3 = L === "retain";
              if ($ === "first") t3 ? e3 = [e3[0]].filter(Boolean) : e3.shift();
              else if ($ === "last")
                t3 ? e3 = [e3.at(-1)].filter(Boolean) : e3.pop();
              else if ($ === "all") t3 || (e3 = []);
              else if ($ === "empty")
                e3 = t3 ? e3.filter((e4) => a2.is.empty(e4)) : e3.filter((e4) => !a2.is.empty(e4));
              else if (a2.is.number($))
                t3 ? e3 = [e3.splice($, 1)].filter(Boolean) : e3.splice($, 1);
              else if (a2.is.object($)) {
                const n3 = await f($, { noLimit: true });
                e3 = t3 ? e3.filter((e4) => a2.match(e4, n3)) : e3.filter((e4) => !a2.match(e4, n3));
              } else e3 = t3 ? e3.filter((e4) => e4 === $) : e3.filter((e4) => e4 !== $);
              return m2(A, e3);
            }
            if (y === "list-update") {
              let e3, t3 = await h(A);
              if (t3 = a2.is.array(t3) ? t3 : [], $ === "first") e3 = [t3[0]];
              else if ($ === "last") e3 = [t3.at(-1)];
              else if ($ === "all") e3 = t3;
              else if ($ === "empty") e3 = t3.filter((e4) => a2.is.empty(e4));
              else if (a2.is.number($)) e3 = [t3[$]];
              else if (a2.is.object($)) {
                const n3 = await f($, { noLimit: true });
                e3 = t3.filter((e4) => a2.match(e4, n3));
              } else e3 = t3.filter((e4) => e4 === $);
              return e3 = e3.filter((e4) => !!e4), !a2.is.string(D) || D.trim().startsWith("{") || D.trim().startsWith("[") ? a2.is.object(D) && e3.forEach((e4) => {
                Object.entries(D).forEach(([t4, n3]) => {
                  n3 === null ? a2.delete(e4, t4) : a2.set(e4, t4, n3, { create: true });
                });
              }) : e3.forEach((e4) => {
                e4[D] = !e4[D];
              }), m2(A, t3);
            }
            if (y === "list-merge") {
              let e3 = await h(E);
              e3 = a2.ensureArray(e3 || []);
              let t3 = await h(I);
              if (t3 = a2.ensureArray(t3 || []), S) {
                const n3 = /* @__PURE__ */ new Map(), o3 = (e4) => {
                  const t4 = a2.get(e4, S);
                  a2.is.object(e4) ? (e4 = a2.is.object(n3.get(t4)) ? { ...n3.get(t4), ...e4 } : e4, n3.set(t4, e4)) : n3.set(t4, e4);
                };
                return e3.forEach(o3), t3.forEach(o3), m2(T, [...n3.values()]);
              }
              return m2(T, [...e3, ...t3]);
            }
            if (y === "list-join") {
              let e3 = await h(A);
              return e3 = a2.is.array(e3) ? e3 : [], U = e3.join(R), m2(T, U);
            }
            if (y === "youtube.comment-summary") {
              const e3 = await h("gpt");
              if (!e3) return;
              const t3 = /(-\s)?\[((\d{2}:)?\d{2}:\d{2})]\([^)]+\)/g;
              let n3 = (e3 || "").replace(t3, "- $2");
              return n3 = n3.split("\n").filter((e4) => /^\s*-/.test(e4)).map((e4) => e4.substring(2)).map((e4) => e4.replaceAll("**", "")), n3.length === 0 ? m2(T, "") : (n3 = u2(n3), n3.unshift("\u{1F3AF} Key points for quick navigation:\n"), n3.push("\nMade with HARPA AI"), n3 = n3.join("\n"), await i2.powerMessageController.reducePowerMessages(), m2(T, n3));
            }
            if (y === "call-internal-method" && M === "update-config")
              return await o2.controller.update(), m2(T, "ok");
            if (y === "call-internal-method" && M === "set-language")
              return U = await g(l2(d2.value), { noLimit: true }), void (r2.settings.promptLanguage = U || "English");
            if (y !== "call-internal-method" || M !== "set-connection") {
              if (y === "call-internal-method" && M === "yousummary.get-summary") {
                return m2(T, await n2.controller.getSummary(e2));
              }
              if (y !== "call-internal-method" || M !== "add-rate-us") {
                if (y !== "call-internal-method" || M !== "yousummary.submit-summary") {
                  if (y === "serp.extract-links") {
                    const e3 = await h(w), n3 = d2.downgradeSocialLinks || false, a3 = d2.limit || 0;
                    return m2(T, t2.extractSerpLinks(e3, a3, n3));
                  }
                  if (y === "search.extract-sources") {
                    const e3 = await h(w);
                    let t3, n3 = [], o3 = /* @__PURE__ */ new Set();
                    const i3 = (e4, t4 = null) => {
                      const a3 = (e4.match(/\(/g) || []).length, i4 = (e4.match(/\)/g) || []).length;
                      for (let t5 = 0; t5 < a3 - i4; t5++) e4 += ")";
                      if (o3.has(e4)) return;
                      let r4;
                      try {
                        const t5 = new URL(e4);
                        r4 = t5.hostname + t5.pathname;
                      } catch (e5) {
                        return;
                      }
                      r4 = r4.replace(/^www\./, "");
                      const s3 = t4 || n3.length + 1;
                      n3.push({ counter: s3, name: r4, url: e4 }), o3.add(e4);
                    }, r3 = /\[\[?([➊-➓])]?]\((https?:\/\/[^\s)]+)\)/g;
                    for (; (t3 = r3.exec(e3)) !== null; ) i3(t3[2], t3[1]);
                    const l3 = /\[\[?([0-9]+)]?]\((https?:\/\/[^\s)]+)\)/g;
                    for (; (t3 = l3.exec(e3)) !== null; ) i3(t3[2], t3[1]);
                    const c3 = /\[(?![0-9]+])(.*?)]\((https?:\/\/[^\s)]+)\)/g;
                    for (; (t3 = c3.exec(e3)) !== null; ) i3(t3[2]);
                    if (v === "text") {
                      if (n3.length === 0) return m2(T, "");
                      n3 = n3.map(
                        ({ counter: e4, name: t4, url: n4 }) => `[${s2[e4] || e4} ${a2.string.shorten(t4, 44)}](${n4})`
                      );
                      return m2(
                        T,
                        "![icon](/img/commands/maps-globe-06.svg) Sources\n\n" + n3.join("\n")
                      );
                    }
                    return m2(T, n3);
                  }
                  if (y === "remove-emojis") {
                    let e3 = await h(w) || "";
                    const t3 = /( ?)([\u{1F300}-\u{1F5FF}\u{1F900}-\u{1F9FF}\u{1F600}-\u{1F64F}\u{1F680}-\u{1F6FF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}])( ?)/gu;
                    return e3 = e3.replace(
                      t3,
                      (e4, t4, n3, a3) => t4 && a3 ? " " : t4 || a3 || ""
                    ), m2(T, e3);
                  }
                  throw new Error(`Unsupported calc function: ${y}`);
                }
                {
                  const t3 = await h("gpt"), a3 = await h("format"), o3 = r2.settings.promptLanguageValue;
                  n2.controller.submitSummary(e2, { type: a3, lang: o3, content: t3 });
                }
              } else
                r2.news.reviewed || p2.addAnswer({ text: "#rate", system: true });
            } else {
              U = await g(l2(d2.value), { noLimit: true });
              const e3 = r2.ai.connections.findIndex((e4) => e4.type === "cloudgpt");
              -1 !== e3 && r2.transaction(() => {
                r2.ai.connections[e3].selectedModelId = U, r2.settings.spaceConnectionId = r2.ai.connections[e3].id;
              });
            }
          }
        };
        const l2 = (e2) => a2.is.string(e2) ? e2 : a2.is.nil(e2) ? "" : a2.is.object(e2) || a2.is.array(e2) ? a2.json.stringify(e2, { steps: 2 }) : String(e2) || "", c2 = (e2) => {
          let t3 = 0, n3 = false, a3 = false, o3 = 0;
          const i3 = [];
          for (let r3 = 0; r3 < e2.length; r3++) {
            const s3 = e2[r3];
            if (n3) a3 ? a3 = false : s3 === "\\" ? a3 = true : s3 === '"' && (n3 = false);
            else if (s3 !== '"' || r3 !== 0 && e2[r3 - 1] === "\\") {
              if (s3 !== "{" && s3 !== "[" || n3) {
                if ((s3 === "}" || s3 === "]") && !n3 && (t3--, t3 == 0)) {
                  const t4 = e2.substring(o3, r3 + 1);
                  try {
                    i3.push(JSON.parse(t4));
                  } catch {
                  }
                }
              } else t3++, t3 == 1 && (o3 = r3);
            } else n3 = true;
          }
          return i3;
        }, u2 = (e2, t3 = 9e3) => {
          let n3 = [], a3 = [];
          e2.forEach((e3) => {
            e3.startsWith("-") ? a3.push(e3) : (a3.length && (n3.push(a3), a3 = []), a3 = [e3]);
          }), a3.length && n3.push(a3);
          const o3 = () => n3.join("\n").length, i3 = () => {
            const e3 = n3.reduce((e4, t4) => Math.max(e4, t4.length), 0);
            n3.slice().reverse().find((t4) => t4.length === e3).pop();
          }, r3 = () => {
            const e3 = Math.floor(Math.random() * n3.length);
            n3.splice(e3, 1);
          };
          for (; n3.length > 1 && n3.some((e3) => e3.length > 1) && o3() > t3; ) i3();
          n3 = n3.flat();
          const s3 = /(?<prefix>- )?(?<time>\d\d:\d\d(?::\d\d)?) (?<rest>.+)/;
          for (n3 = n3.map((e3) => {
            if (e3.startsWith("- ")) return e3;
            const t4 = s3.exec(e3);
            if (!t4) return e3;
            const { prefix: n4, time: a4, rest: o4 } = t4.groups;
            return `${n4 || ""}${a4} *${(o4 || "").trim()}*`;
          }); n3.length > 1 && o3() > t3; )
            r3();
          return n3;
        };
      })(), (() => {
        const { $commands: t2, $chat: n2 } = e;
        t2.stepClear = {
          run: async ({ tabId: e2 }) => {
            await n2.actionsController.clearChat(e2, { stopCommand: false });
          }
        };
      })(), (() => {
        const { $commands: t2 } = e;
        t2.stepClick = {
          emoji: "\u{1F5B1}\uFE0F",
          title: "CLICK",
          run: async ({ step: e2, page: t3, sh: n2, log: a2, error: o2 }) => {
            const i2 = e2.selector;
            if (i2)
              try {
                const e3 = await t3.click(i2, null, { idle: false });
                a2(n2((e3.innerText || "").replace(/\s+/g, " ")) || "OK");
              } catch (e3) {
                o2(n2(e3.message || "Failed to click element"));
              }
          }
        };
      })(), (() => {
        const { $commands: t2, $utils: n2, $s: a2 } = e;
        t2.stepCommand = {
          run: async ({ step: e2, chat: t3, interpolate: o2, sh: i2 }) => {
            let { name: r2, inputs: s2 } = e2;
            r2 = await o2(r2, { noLimit: true });
            const l2 = a2.commands.getCommandDeclaration(r2);
            if (!l2)
              return {
                type: "interrupt",
                message: `\u274C&nbsp;&nbsp;Command not found: **${i2(r2)}**`
              };
            const c2 = n2.cloneDeep(l2.steps || []);
            if (c2.length === 0) return "next";
            s2 && c2.unshift({ type: "set-inputs", inputs: s2 });
            const u2 = { ...e2, type: "group", command: r2, steps: c2 };
            return n2.set(t3.command, t3.stepCursor, u2), { type: "next", step: `${t3.stepCursor}.steps.0` };
          }
        };
      })(), (() => {
        const { $commands: t2, $s: n2 } = e;
        t2.stepConnection = {
          emoji: "\u2728",
          title: "AI CONNECTION",
          run: async ({
            step: e2,
            command: t3,
            interpolate: a2,
            chat: o2,
            log: i2,
            error: r2
          }) => {
            let s2 = await a2(e2.connection, { noLimit: true });
            if (s2 = s2.trim().toUpperCase(), !s2)
              return r2("No connection specified");
            (s2.startsWith("\u2601\uFE0F ") || s2.startsWith("\u{1F310} ") || s2.startsWith("\u{1F511} ")) && (s2 = s2.slice(3));
            const l2 = n2.ai.connections, c2 = l2.find((e3) => (e3.label || "").toUpperCase() === s2) || l2.find((e3) => (e3.id || "").toUpperCase() === s2) || l2.find((e3) => (e3.type || "").toUpperCase() === s2);
            if (!c2) return r2(`No connection found for label: **${s2}**`);
            e2.switchDuration === "chat" ? o2.initialConnectionId = c2.id : t3.initialConnectionId || (t3.initialConnectionId = o2.connectionId), i2(`Switching to ${c2.label.toUpperCase()}`), c2.id !== o2.connectionId && (o2.connectionId = c2.id);
          }
        };
      })(), (() => {
        const { $commands: t2, $browser: n2, $s: a2 } = e;
        t2.stepControl = {
          run: async ({ tabId: e2, step: t3 }) => {
            t3.action === "show" ? await n2.controller.showFrame(e2) : t3.action === "hide" ? await n2.controller.hideFrame(e2) : t3.action === "toggle-theme" ? a2.toggleTheme() : t3.action === "theme-day" ? a2.theme = "day" : t3.action === "theme-night" ? a2.theme = "night" : t3.action === "frame-wide" ? await n2.controller.setFrameWidth(e2, "fullscreen") : t3.action === "frame-narrow" ? await n2.controller.setFrameWidth(e2, 430) : t3.action === "switch-to-task-tab" ? a2.tabs[e2].screen = "create" : t3.action === "switch-to-ai-tab" && (a2.tabs[e2].screen = "chat");
          }
        };
      })(), (() => {
        const { $commands: t2, $utils: n2, $chat: a2 } = e;
        t2.stepExport = {
          emoji: "\u{1F5C2}\uFE0F",
          title: "EXPORT",
          run: async ({
            step: e2,
            tabId: t3,
            chat: o2,
            interpolate: i2,
            getParam: r2,
            sh: s2,
            log: l2,
            error: c2
          }) => {
            try {
              let c3, u2;
              if (e2.filename?.trim().length > 0 && (c3 = await i2(e2.filename), c3 = n2.string.shorten(c3, 255, "", "")), e2.what === "all-messages")
                c3 ??= "harpa-messages.txt", await a2.downloadController.downloadChat(t3, c3, o2.id);
              else if (e2.what === "last-message")
                c3 ??= "harpa-message.txt", u2 = await i2("{{message}}"), await a2.downloadController.downloadContent(t3, c3, u2);
              else if (e2.what === "param") {
                const o3 = e2.param || "gpt", i3 = await r2(o3);
                n2.is.undefined(i3) ? (c3 ??= `harpa-${o3}.txt`, u2 = "\u2014") : n2.is.object(i3) || n2.is.array(i3) ? (c3 ??= `harpa-${o3}.json`, u2 = n2.json.stringify(i3, { space: 2, throw: true })) : (c3 ??= `harpa-${o3}.txt`, u2 = String(i3)), await a2.downloadController.downloadContent(t3, c3, u2);
              }
              l2(s2(c3));
            } catch (e3) {
              c2(s2(e3.message || "Failed to export"));
            }
          }
        };
      })(), (() => {
        const { $commands: t2, $recipe: n2 } = e;
        t2.stepExtract = {
          emoji: "\u{1F9F2}",
          title: "EXTRACT",
          run: async ({
            step: e2,
            page: t3,
            setParam: a2,
            sh: o2,
            log: i2,
            error: r2
          }) => {
            const s2 = e2.selector || { $css: "body" }, l2 = e2.param || "param";
            try {
              const e3 = await n2.adapters.watcher.queryItem(t3, s2);
              if (!e3) throw new Error("Element not found");
              if (e3.type === "warning") throw new Error(e3.content);
              a2(l2, e3.value);
              i2([o2(String(e3.value).replace(/\s+/g, " ")), l2]);
            } catch (e3) {
              a2(l2, e3.default || "");
              r2([o2(e3.message || "Failed to extract data"), l2]);
            }
          }
        };
      })(), (() => {
        const { $commands: t2, $chat: n2, $utils: a2, $dialog: o2 } = e;
        t2.stepGpt = {
          run: async ({
            tabId: e2,
            step: t3,
            chat: i2,
            command: r2,
            setParam: s2,
            interpolate: l2
          }) => {
            let { text: c2, flags: u2 } = n2.flagsController.parse(t3.prompt || "");
            const { dumb: p2, isolated: d2, functions: m2, onCodeClick: h } = t3, g = t3.param || "gpt";
            if (t3.chunkify) {
              const a3 = t3.chunkify.text || "{{page}}";
              let { text: g2, attachments: f } = await n2.controller.interpolate(
                i2.id,
                e2,
                a3,
                [],
                { noLimit: true }
              );
              if (!g2)
                return void (t3.chunkify.empty && i2.addAnswer({ text: t3.chunkify.empty }));
              const y = f.filter((e3) => e3.type === "pdf").map((e3) => e3.pdf);
              y.length > 0 && (g2 = await o2.context.insert(
                g2,
                i2.id,
                e2,
                { pdfs: y },
                { noLimit: true }
              )), c2 = await l2(c2, {
                ignore: ["chunk", "chunk.index", "chunk.total"]
              });
              let b = [], w = { remaining: g2 };
              do {
                const e3 = { maxTokens: t3.chunkify.maxTokens };
                w = await n2.paramController.insertValue(
                  i2.id,
                  c2,
                  "{{chunk}}",
                  w.remaining,
                  e3
                ), b.push(w.text);
              } while (w.text && w.remaining);
              b = b.map(
                (e3, t4) => e3.replace(/{{chunk.index}}/g, t4 + 1).replace(/{{chunk.total}}/g, b.length)
              );
              const v = [];
              b = b.filter(Boolean);
              for (let t4 = 0; t4 < b.length; t4++) {
                if (i2.command !== r2) return "abort";
                const a4 = {
                  flags: u2,
                  dumb: p2,
                  silent: true,
                  contextual: true,
                  isolated: d2,
                  functions: m2,
                  onCodeClick: h
                };
                a4.badge = b.length > 1 ? `${t4 + 1} / ${b.length}` : void 0;
                const o3 = await n2.actionsController.askChat(i2.id, e2, b[t4], a4);
                if (!o3) return "abort";
                v.push(o3.text);
              }
              s2(t3.param || "gpt", v.join("\n\n"));
            } else {
              const t4 = {
                flags: u2,
                dumb: p2,
                silent: true,
                contextual: true,
                isolated: d2,
                functions: m2,
                onCodeClick: h
              }, o3 = await n2.actionsController.askChat(i2.id, e2, c2, t4);
              if (a2.is.nil(o3)) return "abort";
              if ((o3.text || o3.func?.name) && (s2(g, o3.text), s2(g + "Func", o3.func?.name), s2(g + "Args", o3.func?.args)), !o3.text)
                return "next";
            }
          }
        };
      })(), (() => {
        const { $commands: t2 } = e;
        t2.stepGroup = {
          run: async ({ step: e2, chat: t3 }) => (e2.steps || []).length > 0 ? { type: "next", step: `${t3.stepCursor}.steps.0` } : { type: "next" }
        };
      })(), (() => {
        const { $commands: t2, $chat: n2, $utils: a2, $s: o2 } = e;
        t2.stepJs = {
          emoji: "\u26A1",
          title: "RUN JS",
          run: async ({
            page: e2,
            chat: i2,
            step: r2,
            setParam: s2,
            getParam: l2,
            command: c2,
            interpolate: u2,
            sh: p2,
            log: d2,
            error: m2
          }) => {
            const h = r2.onFailure;
            if (!await Promise.race([
              e2.evaluate(() => {
              }).then(() => true),
              a2.sleep(1500).then(() => false)
            ])) {
              const t3 = await e2.url(), r3 = a2.url.getDomain(t3);
              return o2.transaction(() => {
                i2.messages = i2.messages.filter(
                  (e3) => e3.error !== n2.errors.csp
                ), i2.addAnswer({
                  error: n2.errors.csp,
                  silent: false,
                  data: { domain: r3 }
                });
              }), { type: "abort" };
            }
            const g = r2.param || "param";
            try {
              const t3 = `async (args) => { with (args) {
${r2.code}
}}`, n3 = {};
              await Promise.all(
                (r2.args || "").trim().replaceAll(", ", ",").split(",").filter(Boolean).map(async (e3) => {
                  n3[e3] = await l2(e3);
                })
              );
              const o3 = r2.timeout || 0, i3 = await e2.evaluate(t3, n3, { timeout: o3 });
              s2(g, i3);
              d2([
                `\`${p2((a2.is.object(i3) || a2.is.array(i3) ? JSON.stringify(i3) : String(i3)).replace(/\s+/g, " "))}\``,
                `\`${g}\``
              ]);
            } catch (e3) {
              const n3 = e3.message || "Failed to evaluate function";
              s2(g, n3);
              return m2([`\`${p2(n3)}\``, g]), h ? await t2.stepJump.run({
                step: { to: h },
                chat: i2,
                command: c2,
                interpolate: u2
              }) : { type: "interrupt" };
            }
          }
        };
      })(), (() => {
        const { $commands: t2 } = e;
        t2.stepJump = {
          run: async ({ step: e2, chat: t3, command: n2, interpolate: a2 }) => {
            const o2 = t3.flattenSteps(), i2 = (await a2(e2.to, { noLimit: true })).toUpperCase(), r2 = o2.filter((e3) => (e3.label || "").toUpperCase() === i2);
            if (r2.length === 1) return { type: "next", step: r2[0].cursor };
            if (r2.length > 1) {
              const e3 = o2.findIndex((e4) => e4.cursor === n2.cursor);
              let t4 = null, a3 = 1 / 0;
              for (let n3 = 0; n3 < o2.length; n3++) {
                const r3 = o2[n3];
                if ((r3.label || "").toUpperCase() !== i2) continue;
                const s3 = Math.abs(n3 - e3);
                s3 < a3 && (a3 = s3, t4 = r3);
              }
              return { type: "next", step: t4.cursor };
            }
            const s2 = `steps.${e2.to.split(".").join(".steps.")}`;
            return o2.find((e3) => e3.cursor === s2) ? { type: "next", step: s2 } : { type: "interrupt", message: `No step for label: **${e2.to}**` };
          }
        };
      })(), (() => {
        const { $commands: t2, $utils: n2 } = e;
        t2.stepLoop = {
          loop: true,
          run: async ({ step: e2, chat: t3, setParam: a2, getParam: o2 }) => {
            if ((e2.steps || []).length === 0) return { type: "next" };
            let i2 = await o2(e2.list || "list");
            if (!i2) return { type: "next" };
            i2 = n2.ensureArray(i2);
            let r2 = Number(e2.index);
            if (-1 === r2) return delete e2.index, { type: "next" };
            if (r2 = Number.isNaN(r2) ? 0 : r2 + 1, e2.index = r2, a2("index", r2), r2 >= i2.length)
              return delete e2.index, { type: "next" };
            return a2("item", i2[r2]), { type: "next", step: `${t3.stepCursor}.steps.0` };
          }
        };
      })(), (() => {
        const { $commands: t2, $utils: n2 } = e;
        t2.stepNavigate = {
          emoji: "\u{1F9ED}",
          title: "NAVIGATE",
          run: async ({
            tabId: e2,
            step: n3,
            chat: o2,
            command: i2,
            page: r2,
            interpolate: s2,
            log: l2,
            error: c2,
            sh: u2
          }) => {
            const p2 = await a2(e2, n3, r2, s2);
            try {
              await r2.navigate(p2, { idle: n3.waitForIdle });
            } catch (e3) {
              c2(
                e3.message === "timeout" ? "Navigation timeout" : `Error: ${e3.message}`
              );
              const a3 = n3.onFailure;
              if (a3) {
                const e4 = { to: a3 };
                return await t2.stepJump.run({
                  step: e4,
                  chat: o2,
                  command: i2,
                  interpolate: s2
                });
              }
              return { type: "interrupt" };
            }
            try {
              l2(u2(await r2.url()));
            } catch {
            }
          }
        };
        const a2 = async (e2, t3, a3, o2) => {
          let i2 = await o2(t3.url, { noLimit: true });
          if (!i2) return "reload";
          if (["reload", "back", "forward"].includes(i2)) return i2;
          if (i2.startsWith("/")) {
            const e3 = await a3.url();
            return `https://${n2.url.getDomain(e3)}${i2}`;
          }
          return i2.startsWith("http://") || i2.startsWith("https://") ? i2 : `https://${i2}`;
        };
      })(), (() => {
        const { $commands: t2 } = e;
        t2.stepPaste = {
          emoji: "\u2328\uFE0F",
          title: "PASTE",
          run: async ({
            step: e2,
            page: t3,
            interpolate: n2,
            log: a2,
            error: o2,
            sh: i2
          }) => {
            const r2 = e2.selector, s2 = await n2(e2.text || "{{gpt}}", { noLimit: true }), l2 = e2.mode || "insert", c2 = e2.lastKey;
            try {
              await t3.paste(r2, s2, { mode: l2, lastKey: c2, idle: false }), a2(i2(s2));
            } catch (e3) {
              o2(i2(e3.message || "Failed to paste text"));
            }
          }
        };
      })(), (() => {
        const { $commands: t2, $bus: n2 } = e;
        t2.stepPrefill = {
          run: async ({ step: e2, tabId: t3, interpolate: a2 }) => {
            let o2 = e2.message;
            false !== e2.interpolate && (o2 = await a2(o2, { noLimit: true })), o2 && n2.send("dialog.insertText", t3, o2);
          }
        };
      })(), (() => {
        const { $commands: t2, $utils: n2 } = e;
        t2.stepRequest = {
          emoji: "\u{1F4E1}",
          title: "REQUEST",
          run: async (e2) => {
            const { step: t3, setParam: n3, log: l2, error: c2, sh: u2 } = e2, p2 = await a2(e2);
            if (!p2) return "next";
            const d2 = o2(e2), m2 = await i2(e2);
            await s2(m2, e2);
            const h = await r2(m2, e2);
            let g = null;
            e: try {
              const e3 = await fetch(p2, { method: d2, headers: m2, body: h });
              if (g = {
                headers: Object.fromEntries(e3.headers.entries()),
                ok: e3.ok,
                redirected: e3.redirected,
                status: e3.status,
                type: e3.type,
                url: e3.url
              }, !e3.ok)
                break e;
              const t4 = e3.headers.get("content-type") || "";
              try {
                t4.startsWith("multipart/form-data") ? g.body = await e3.formData() : t4.startsWith("application/json") ? g.body = await e3.json() : g.body = await e3.text();
              } catch (e4) {
                g.body = `Failed parsing response: ${e4.message}`;
              }
            } catch (e3) {
              g = {
                ok: false,
                status: 0,
                type: "error",
                url: p2,
                body: `Request error: ${e3.message}`
              };
            }
            const f = t3.param || "param";
            n3(f, g);
            const y = [u2(p2), g.body && u2(g.body || ""), f];
            g.ok ? l2(y, d2) : c2(y, d2);
          }
        };
        const a2 = async ({ step: e2, page: t3, interpolate: a3 }) => {
          let o3 = await a3(e2.url, { noLimit: true });
          if (!o3) return t3.url();
          if (o3.startsWith("/")) {
            const e3 = await t3.url();
            return `https://${n2.url.getDomain(e3)}${o3}`;
          }
          return o3.startsWith("http://") || o3.startsWith("https://") ? o3 : `https://${o3}`;
        }, o2 = ({ step: e2 }) => e2.method !== "auto" ? e2.method.toUpperCase() : e2.body ? "POST" : "GET", i2 = async ({ step: e2, interpolate: t3 }) => {
          if (!e2.headers) return {};
          let a3 = {};
          try {
            a3 = n2.is.object(e2.headers) || n2.is.array(e2.headers) ? JSON.stringify(e2.headers) : e2.headers;
          } catch {
            return {};
          }
          return a3 = await t3(a3, { noLimit: true }), a3 = n2.json.parse(a3, { fallback: {} }), n2.is.object(a3) || (a3 = {}), n2.is.object(a3) ? a3 : {};
        }, r2 = async (e2, { step: t3, interpolate: a3, interpolateObject: o3 }) => {
          if (!t3.body) return;
          let i3, r3 = t3.body;
          try {
            r3 = n2.is.object(r3) || n2.is.array(r3) ? await o3(r3, { noLimit: true }) : await a3(r3, { noLimit: true, noObjectWrap: true });
          } catch {
            return;
          }
          if (n2.is.string(r3))
            try {
              JSON.parse(r3), i3 = "json";
            } catch {
              i3 = "text";
            }
          else
            try {
              r3 = JSON.stringify(r3), i3 = "json";
            } catch {
              i3 = "text", r3 = "Error: could not stringify body";
            }
          return e2.hasOwnProperty("Content-Type") || (e2["Content-Type"] = i3 === "text" ? "text/plain" : "application/json"), r3;
        }, s2 = async (e2, { step: t3, interpolate: n3 }) => {
          if (!t3.auth?.enabled || e2.hasOwnProperty("Authorization")) return;
          let { username: a3, password: o3 } = t3.auth;
          a3 = await n3(a3, { noLimit: true }), o3 = await n3(o3, { noLimit: true }), e2.Authorization = "Basic " + btoa(`${a3 || ""}:${o3 || ""}`);
        };
      })(), (() => {
        const { $commands: t2, $utils: n2, $chat: a2 } = e;
        t2.stepSay = {
          run: async ({ step: e2, tabId: t3, chat: o2 }) => {
            let i2 = e2.message, r2 = null;
            if (false !== e2.interpolate) {
              const e3 = await a2.controller.interpolate(o2.id, t3, i2, [], {
                noLimit: true
              });
              i2 = e3.text, r2 = e3.attachments.map((e4) => ({ ...e4, hidden: false }));
            }
            if (i2) {
              if (i2.length > 1e5) {
                const e3 = n2.number.toShort(i2.length - 1e4);
                i2 = n2.string.shorten(i2, 1e5) + `

 \`${e3} symbols more\``;
              }
              o2.addAnswer({
                text: i2,
                silent: e2.silent,
                done: true,
                ...r2 && { attachments: r2 }
              });
            }
          }
        };
      })(), (() => {
        const { $commands: t2 } = e;
        t2.stepSetInputs = {
          run: async ({ step: e2, chat: t3 }) => (e2.inputs && (t3.command.inputs = [
            ...t3.command.inputs || [],
            ...e2.inputs || []
          ]), "next")
        };
      })(), (() => {
        const { $commands: t2, $dialog: n2, $utils: a2 } = e;
        t2.stepStop = {
          run: async ({ chat: e2 }) => {
            for (; e2.stepCursor; ) {
              const t3 = a2.get(e2.command, e2.stepCursor);
              if (t3 && t3.type === "group" && t3.command) return "next";
              e2.stepCursorUp();
            }
            if (!e2.stepCursor)
              return await n2.commandController.onCommandStop(e2.command), e2.command = null, "interrupt";
          }
        };
      })(), (() => {
        const { $commands: t2 } = e;
        t2.stepWaitOptions = [
          { id: "idle", label: "Page to stop updating", fields: ["timeout"] },
          { id: "0.5s", label: "0.5 seconds" },
          { id: "1s", label: "1 second" },
          { id: "2s", label: "2 seconds" },
          { id: "5s", label: "5 seconds" },
          { id: "15s", label: "15 seconds" },
          { id: "1m", label: "1 minute" },
          { id: "custom-delay", label: "Custom delay", fields: ["delay"] },
          {
            id: "random-delay",
            label: "Random delay",
            fields: ["minDelay", "maxDelay"]
          },
          {
            id: "text-to-appear",
            label: "Text to appear",
            fields: ["text", "timeout"]
          },
          {
            id: "text-to-disappear",
            label: "Text to disappear",
            fields: ["text", "timeout"]
          },
          {
            id: "element-to-appear",
            label: "Element to appear",
            fields: ["selectorType", "selector", "item", "timeout"]
          },
          {
            id: "element-to-disappear",
            label: "Element to disappear",
            fields: ["selectorType", "selector", "item", "timeout"]
          },
          {
            id: "js-function",
            label: "JS function",
            fields: ["code", "timeout"]
          }
        ].map((e2) => ({ ...e2, fields: new Set(e2.fields || []) }));
      })(), (() => {
        const { $commands: t2, $engine: n2, $utils: a2 } = e;
        t2.stepWait = {
          emoji: "\u231B",
          title: "WAIT",
          run: async ({ step: e2, page: o2, log: i2, interpolate: r2, error: s2 }) => {
            const l2 = (e3, t3 = null) => String(e3).trim() === "" || Number.isNaN(Number(e3)) ? t3 : Number(e3);
            let c2 = await r2(e2.delay, { noLimit: true });
            c2 = l2(c2, 0);
            const u2 = e2.for || "idle", p2 = l2(e2.minDelay, 0), d2 = l2(e2.maxDelay, 0), m2 = e2.text || "", h = e2.selector || null, g = e2.code || "", f = l2(e2.timeout, 100 * a2.time.YEAR), y = async (e3) => {
              const n3 = (e4) => {
                if (!e4) return "0s";
                if (e4 < 1e3) return `${e4}ms`;
                const t3 = e4 / 1e3;
                return `${t3 % 1 == 0 ? t3 : t3.toFixed(1)}s`;
              }, a3 = t2.stepWaitOptions.find((e4) => e4.id === u2).label;
              try {
                const t3 = await e3();
                i2([a3, `Took ${n3(t3.durationMs)}`]);
              } catch (e4) {
                e4.message === "timeout" ? s2([a3, `Timeout ${n3(f)}`]) : s2(e4);
              }
            };
            if (u2 === "idle") return await y(() => o2.idle({ timeout: f }));
            if ([
              "0.5s",
              "1s",
              "2s",
              "5s",
              "15s",
              "1m",
              "custom-delay",
              "random-delay"
            ].includes(u2)) {
              const e3 = u2 === "custom-delay" ? c2 : u2 === "random-delay" ? p2 + Math.round(Math.random() * Math.max(0, d2 - p2)) : Number(u2.replace(/[sm]/g, "")) * (u2.endsWith("s") ? a2.time.SECOND : a2.time.MINUTE);
              return await y(() => o2.wait(e3));
            }
            if (u2 === "text-to-appear")
              return await y(() => o2.wait(m2, { timeout: f }));
            if (u2 === "text-to-disappear")
              return await y(() => o2.wait(m2, { timeout: f, not: true }));
            if (u2 === "element-to-appear") {
              const e3 = new n2.Locator(h, o2);
              return await y(() => o2.wait(e3, { timeout: f }));
            }
            if (u2 === "element-to-disappear") {
              const e3 = new n2.Locator(h, o2);
              return await y(() => o2.wait(e3, { timeout: f, not: true }));
            }
            if (u2 === "js-function") {
              const e3 = { __$ht: "function", body: `() => { ${g} }` };
              return await y(() => o2.wait(e3, { timeout: f }));
            }
            throw new Error(`Unsupported wait condition: ${u2}`);
          }
        };
      })(), (() => {
        const { $commands: t2 } = e;
        t2.steps = {
          say: t2.stepSay,
          ask: t2.stepAsk,
          gpt: t2.stepGpt,
          calc: t2.stepCalc,
          request: t2.stepRequest,
          navigate: t2.stepNavigate,
          click: t2.stepClick,
          paste: t2.stepPaste,
          command: t2.stepCommand,
          extract: t2.stepExtract,
          export: t2.stepExport,
          connection: t2.stepConnection,
          js: t2.stepJs,
          control: t2.stepControl,
          prefill: t2.stepPrefill,
          jump: t2.stepJump,
          group: t2.stepGroup,
          loop: t2.stepLoop,
          wait: t2.stepWait,
          stop: t2.stepStop,
          clear: t2.stepClear,
          "set-inputs": t2.stepSetInputs
        };
      })(), (() => {
        const {
          $contextMenu: t2,
          $browser: n2,
          $bus: a2,
          $capture: o2,
          $shortcut: i2,
          $chat: r2,
          $s: s2,
          $analytics: l2
        } = e;
        t2.controller = {
          async init() {
            await this._createContextMenu(), chrome.contextMenus.onClicked.addListener(async (e2, t3) => {
              if (l2.controller.sendContextMenuClick(e2.menuItemId), e2.menuItemId === "send-to-extension")
                await this._onSendToExtension(t3, e2.selectionText);
              else if (e2.menuItemId === "select-area")
                await o2.controller.attachArea(t3.id);
              else if (e2.menuItemId.startsWith("run-command:")) {
                const a3 = e2.menuItemId.split(":")[1], o3 = e2.menuItemId.split(":").slice(2);
                await n2.controller.showFrame(t3.id), await i2.controller.executeCommand(t3.id, {
                  command: a3,
                  inputs: o3
                });
              }
            });
          },
          async _createContextMenu() {
            await chrome.contextMenus.removeAll();
            const e2 = [
              { id: "root", title: "AI Agent", contexts: ["all"] },
              {
                id: "send-to-extension",
                title: "Send to HARPA",
                contexts: ["selection"]
              },
              {
                id: "run-command:youtube-summary",
                title: "Summarize Video",
                contexts: ["all"],
                documentUrlPatterns: ["https://www.youtube.com/watch*"]
              },
              {
                id: "run-command:summary:REPORT",
                title: "Summarize Page",
                contexts: ["all"]
              },
              {
                id: "run-command:search",
                title: "Search the Web",
                contexts: ["all"]
              },
              {
                id: "run-command:explain",
                title: "Explain Term",
                contexts: ["all"]
              },
              { id: "run-command:ask", title: "Ask Page", contexts: ["all"] },
              {
                id: "run-command:extract",
                title: "Extract Data",
                contexts: ["all"]
              },
              {
                id: "run-command:repurpose-text",
                title: "Repurpose Page",
                contexts: ["all"]
              },
              { id: "run-command:rewrite", title: "Rewrite", contexts: ["all"] },
              {
                id: "run-command:reply",
                title: "Write a Reply",
                contexts: ["all"]
              },
              { id: "select-area", title: "Select Page Area", contexts: ["all"] }
            ];
            for (const t3 of e2)
              t3.id !== "root" && (t3.parentId = "root"), await chrome.contextMenus.create(t3);
          },
          async _onSendToExtension(e2, t3) {
            await n2.controller.showFrame(e2.id), await r2.actionsController.ensureChat(e2.id);
            const o3 = s2.chats.getByTabId(e2.id), i3 = o3.input, l3 = i3.length > 0, c2 = (e3) => /\s$/.test(e3);
            l3 && !c2(t3) && (t3 += " "), l3 && !c2(i3) && (t3 = " " + t3), o3.input = [i3, t3].filter(Boolean).join(""), setTimeout(() => a2.send("dialog.focus", e2.id, { jumpToEnd: l3 }));
          }
        };
      })(), (() => {
        const { $creator: t2, $bus: n2, $utils: a2, $idb: o2 } = e;
        t2.contextController = {
          async init() {
            this._ctx = await o2.get("creator.context") || {}, n2.on("creator.getContext", this.getContext.bind(this)), this._dropContextWithoutTabs();
          },
          async setContext(e2, t3) {
            return this._ctx[e2] = t3, o2.set("creator.context", this._ctx), n2.send("creator.setContext", e2, t3);
          },
          getContext(e2) {
            return this._ctx[e2];
          },
          _dropContextWithoutTabs() {
            a2.chrome.alarms.run(
              async () => {
                const e2 = Object.keys(this._ctx);
                if (e2.length === 0) return;
                const t3 = await chrome.tabs.query({}), n3 = new Set(t3.map((e3) => String(e3.id))), a3 = e2.filter((e3) => !n3.has(e3));
                a3.length !== 0 && (a3.forEach((e3) => delete this._ctx[e3]), o2.set("creator.context", this._ctx));
              },
              {
                name: "creator.dropContextWithoutTabs",
                delayInMinutes: 1,
                periodInMinutes: a2.time.HOUR / a2.time.MINUTE
              }
            );
          }
        };
      })(), (() => {
        const {
          $creator: t2,
          $browser: n2,
          $store: a2,
          $runner: o2,
          $recipe: i2,
          $task: r2,
          $bus: s2,
          $mobx: l2,
          $tabs: c2,
          $utils: u2,
          $welcome: p2,
          $s: d2
        } = e;
        t2.controller = {
          init() {
            this._setupContext(), this._setupBusListeners();
          },
          _setupContext() {
            t2.contextController.init();
          },
          _setupBusListeners() {
            s2.on("creator.watchPage", this.watchPage.bind(this)), s2.on("creator.editTaskInTab", this.editTaskInTab.bind(this)), s2.on("creator.parseTemplates", this.parseTemplates.bind(this)), s2.on("creator.updateTemplate", this.updateTemplate.bind(this)), s2.on(
              "creator.saveTemplateToTask",
              this.saveTemplateToTask.bind(this)
            ), s2.on("creator.querySelector", this._querySelector.bind(this)), s2.on("creator.callPageApi", this._callPageApi.bind(this));
          },
          async watchPage({ url: e2, title: t3 }) {
            try {
              const n3 = "watcher.monitorChanges", a3 = this._taskTemplate("watcher.monitorChanges", e2);
              return a3.name = t3 || "", a3.inputs["watcher.changes"].whatToMonitor = "text", a3.inputs["watcher.trigger"].monitorChangesText = "content-changes", a3.inputs["watcher.trigger"].monitorChangesHtml = "content-changes", a3.inputs.schedule.mediumType = "hidden-tab", a3.inputs.schedule.mediumId = null, a3.inputs.schedule.autoCloseTab = true, a3.inputs.trigger.color = "positive", this._createTask({ task: a3 });
            } catch (e3) {
              console.error("Failed watching page", e3);
            }
          },
          async editTaskInTab(e2, t3) {
            const o3 = l2.toJS(d2.tasks.get(e2));
            if (!o3) return;
            const i3 = o3.inputs.page?.url;
            if (!i3) return;
            o3.records = [o3.records.at(-1)].filter((e3) => !!e3);
            let r3 = null;
            try {
              r3 = t3 ? await n2.controller.connectTab(t3) : await n2.controller.createTab(i3, { idle: false });
            } catch (e3) {
              return void console.warn("failed opening page", e3);
            }
            const s3 = d2.tabs[r3.mediumId].creator;
            try {
              const e3 = r3.mediumId;
              await chrome.tabs.update(e3, { active: true }), d2.transaction(() => {
                const t5 = d2.tabs[e3];
                t5.screen = "create", t5.creator = {
                  ...a2.template.creator(),
                  pageUrl: i3,
                  parseStatus: "parsing",
                  screen: "config",
                  templateIndex: 0,
                  templates: [o3],
                  editingTaskId: o3.id
                };
              }), await n2.controller.showFrame(e3);
              const {
                html: t4,
                data: l3,
                text: c3,
                prefetch: u3
              } = await this._parsePage(i3, r3, true);
              await this._storeContext(r3, {
                html: t4,
                text: c3,
                data: l3,
                prefetch: u3
              }), s3.parseStatus = "parsed";
            } catch (e3) {
              s3.parseError = e3.message || "Unknown Error", s3.parseStatus = "failed";
            }
          },
          async parseTemplates({ tabId: e2, force: t3 }) {
            const a3 = d2.tabs[e2].creator;
            if (a3.parseStatus === "parsing") return;
            if (!t3 && a3.parseStatus) return;
            a3.templates = [], a3.templateIndex = -1, a3.screen = "templates";
            const o3 = Date.now();
            a3.parseStatus = "parsing", a3.parseError = null;
            const i3 = a3.pageUrl, s3 = new URL(i3).host;
            try {
              const l3 = await n2.controller.connectTab(e2), {
                title: c3,
                html: m2,
                data: h,
                text: g,
                prefetch: f
              } = await this._parsePage(i3, l3);
              await this._storeContext(l3, {
                html: m2,
                text: g,
                data: h,
                prefetch: f
              });
              let y = [];
              await Promise.all(
                Object.entries(d2.recipes).filter(([e3, t4]) => t4.templates?.build).map(async ([t4, n3]) => {
                  const a4 = {
                    url: i3,
                    host: s3,
                    page: l3,
                    html: m2,
                    data: h,
                    text: g,
                    prefetch: f,
                    template: () => this._taskTemplate(t4, i3, e2)
                  };
                  try {
                    const e3 = await r2.evaluate(n3.templates.build, a4) || [];
                    y = [...y, ...e3];
                  } catch (e3) {
                    console.warn("Failed building templates", e3);
                  }
                })
              ), y = y.filter((e3) => !!e3).map((e3) => e3.task ? e3 : { priority: 0, task: e3 }).sort((e3, t4) => e3.priority - t4.priority).map(
                (e3) => (e3.task.named = e3.task.name, e3.task.name = c3, e3.task.dropdown = e3.dropdown, e3.task)
              ), y.forEach((e3) => p2.controller.patchTemplate(e3)), t3 && await u2.sleep(o3 + 450 - Date.now()), a3.templates = u2.cloneDeep(y, this._serializeData), a3.templateIndex = a3.listTemplates.length > 0 ? 0 : -1, a3.parseStatus = "parsed";
            } catch (e3) {
              a3.parseError = e3.message || "Unknown Error", a3.parseStatus = "failed";
            }
          },
          _serializeData: (e2) => typeof e2?.serialize == "function" ? e2.serialize() : e2,
          _taskTemplate(e2, t3, n3) {
            const o3 = d2.recipes[e2];
            if (!o3) throw new Error(`recipe not found for id ${e2}`);
            const r3 = a2.template.task();
            return r3.recipeId = e2, r3.state = l2.toJS(o3.state) || {}, r3.widgets = l2.toJS(o3.widgets) || {}, r3.storage = l2.toJS(o3.storage) || {}, r3.records = l2.toJS(o3.records) || [], r3.inputs = {}, o3.inputs.forEach(({ type: e3 }) => {
              r3.inputs[e3] = i2.inputs[e3]?.state;
            }), t3 && r3.inputs.page && (r3.inputs.page.url = t3), n3 && r3.inputs.schedule && (r3.inputs.schedule.mediumId = n3), r3;
          },
          async updateTemplate(e2) {
            const n3 = d2.tabs[e2].creator, a3 = t2.contextController.getContext(e2);
            if (!a3) return;
            const o3 = d2.recipes[n3?.template?.recipeId];
            if (!o3) return;
            const i3 = o3?.templates?.update;
            if (i3)
              try {
                const e3 = u2.cloneDeep(n3.template, this._serializeData);
                await r2.evaluate(i3, e3, a3), n3.template = e3;
              } catch (e3) {
                console.warn("Failed updating template", e3);
              }
          },
          async saveTemplateToTask(e2) {
            const t3 = d2.tabs[e2].creator;
            if (t3?.template) {
              if (t3.editingTaskId) {
                const n3 = t3.editingTaskId;
                return this._updateTask({
                  task: t3.template,
                  tabId: e2,
                  taskId: n3
                });
              }
              return this._createTask({ task: t3.template, tabId: e2 });
            }
          },
          async _updateTask({ task: e2, tabId: t3, taskId: n3 }) {
            const a3 = l2.toJS(d2.tasks.get(n3));
            e2 = { ...e2, id: n3, records: a3?.records || [] }, t3 && e2.inputs.schedule?.mediumId !== t3 && (await c2.openAppTab("dashboard"), chrome.tabs.remove(t3));
            const i3 = d2.tasks.findIndex((e3) => e3.id === n3);
            -1 !== i3 ? (o2.scheduleController.terminateTasks(n3), d2.tasks[i3] = e2) : d2.tasks.unshift(e2);
          },
          async _createTask({ task: e2, tabId: n3, closeTab: o3 }) {
            const i3 = (e2 = r2.Adapter.ofTask(e2)).scheduleMediumType;
            (e2 = e2.taskObject).id = a2.idGenerator.task(), e2.createdMs = Date.now(), e2.name = e2.name || r2.proxy.recipeTitle(e2), e2.records = [], delete e2.named, delete e2.dropdown;
            const s3 = d2.recipes[e2.recipeId];
            if (n3 && s3?.templates?.store)
              try {
                const a3 = t2.contextController.getContext(n3);
                await r2.evaluate(s3.templates.store, e2, a3);
              } catch (e3) {
                console.warn("Failed storing template", e3);
              }
            n3 && i3 === "tab" ? await chrome.tabs.update(n3, { pinned: false }) : n3 && i3 === "pinned-tab" && await chrome.tabs.update(n3, { pinned: true }), o3 && i3 === "hidden-tab" && (await c2.openAppTab("dashboard"), n3 && await chrome.tabs.remove(n3));
            if (e2.inputs.schedule && n3) {
              const t3 = i3 === "hidden-tab" ? null : n3;
              e2.inputs.schedule.mediumId = t3;
            }
            d2.tasks.unshift(e2);
          },
          async _parsePage(e2, t3, n3) {
            n3 && await t3.idle({ noThrow: true });
            const [a3, o3, i3] = await Promise.all([
              t3.title(),
              t3.content({ contentType: "htmlContent" }),
              t3.parse({ extract: true, inspect: true, computeAiLocator: false })
            ]), r3 = i3.filter((e3) => e3.type === "text").map((e3) => e3.value).join("\n");
            return {
              title: a3,
              html: o3,
              data: i3,
              text: r3,
              prefetch: {
                statusCode: 200,
                statusText: "OK",
                responseUrl: e2,
                redirected: false
              }
            };
          },
          async _storeContext(e2, n3) {
            await t2.contextController.setContext(
              e2.mediumId,
              u2.cloneDeep(n3, this._serializeData)
            );
          },
          async _querySelector(e2, t3) {
            const a3 = await n2.controller.connectTab(e2);
            if (a3) return await i2.adapters.watcher.queryItem(a3, t3);
          },
          async _callPageApi(e2, t3, ...a3) {
            const o3 = await n2.controller.connectTab(e2);
            if (o3) return await o3.controller.sendRequest(t3, a3);
          }
        };
      })(), (() => {
        const { $dashboard: t2, $store: n2, $utils: a2, $bus: o2, $s: i2 } = e;
        t2.controller = {
          init() {
            t2.exportController.init(), o2.on("dashboard.importTasks", this.importTasks.bind(this)), o2.on("dashboard.importPredefinedTasks", () => {
              this.importPredefinedTasks({ force: true, shiftToNow: true });
            });
          },
          async importPredefinedTasks(e2) {
            if (e2 = { force: false, shiftToNow: true, ...e2 }, !i2.dashboard.predefinedImportedAt || e2.force) {
              try {
                const t3 = new URL(
                  chrome.runtime.getURL("/tasks/predefined-tasks.json")
                );
                await this.importTasks(t3, e2);
              } catch (e3) {
                t2.error("failed to import predefined tasks", e3);
              }
              i2.dashboard.predefinedImportedAt = Date.now();
            }
          },
          async importTasks(e2, t3) {
            let o3 = null;
            if (a2.is.url(e2)) {
              let t4 = null;
              try {
                t4 = await fetch(e2);
              } catch (e3) {
                throw new Error("failed to fetch url");
              }
              if (!t4.ok) throw new Error("url resource returned http error code");
              try {
                o3 = await t4.json();
              } catch (e3) {
                throw new Error("url resource is not json");
              }
            } else if (a2.is.string(e2))
              try {
                o3 = JSON.parse(e2);
              } catch (e3) {
                throw new Error("failed to parse json string");
              }
            else o3 = e2;
            if (!o3) throw new Error("patch json is empty or null");
            this._modifyPatch(o3, t3), await n2.versioner.upgradeTaskPatch(o3), await n2.patcher.applyPatch(o3);
          },
          _modifyPatch(e2, t3) {
            t3 = { shiftToNow: false, ...t3 };
            let { stateActions: a3, dataActions: o3 } = e2;
            a3 = a3 || [], o3 = o3 || {};
            a3.filter(
              (e3) => e3.getter?.[0] === "tasks" && e3.method === "push"
            ).forEach((e3) => {
              const a4 = e3.args[0], r2 = a4.id;
              do {
                a4.id = n2.idGenerator.task();
              } while (i2.tasks.get(a4.id) || o3[`task:${a4.id}`]);
              o3[`task:${a4.id}`] = o3[`task:${r2}`], delete o3[`task:${r2}`], t3.shiftToNow && a4.records.length > 0 && (a4.createdMs = Date.now(), a4.records.at(-1).ms = Date.now());
            });
          }
        };
      })(), (() => {
        const {
          $dashboard: t2,
          $task: n2,
          $bus: a2,
          $store: o2,
          $utils: i2,
          $mobx: r2,
          $s: s2
        } = e;
        t2.exportController = {
          init() {
            a2.on("dashboard.createTaskPatch", this.createTaskPatch, this);
          },
          async createTaskPatch(e2 = null, t3 = {}) {
            t3 = {
              disable: true,
              withDomains: true,
              withData: true,
              withRecords: true,
              ...t3
            }, e2 = e2 || s2.tasks.map((e3) => e3.id), e2 = i2.ensureArray(e2);
            const a3 = {}, l2 = [], c2 = /* @__PURE__ */ new Map();
            for (const i3 of e2) {
              const e3 = r2.toJS(s2.tasks.get(i3));
              if (l2.push(e3), e3.id = o2.idGenerator.task(), t3.disable && (e3.enabled = false), t3.withDomains) {
                const t4 = n2.proxy.taskDomain(e3);
                c2.has(t4) || c2.set(t4, r2.toJS(s2.library.domains[t4]));
              }
              if (t3.withData) {
                const t4 = await n2.dataController.readTask(e3.id);
                t4 && (a3.dataActions = a3.dataActions || {}, a3.dataActions[`task:${e3.id}`] = t4);
              }
              t3.withRecords || (e3.records = []);
            }
            const u2 = o2.template.state();
            return a3.stateActions = o2.deducer.modify(u2, (e3) => {
              l2.forEach((t4) => e3.tasks.unshift(t4)), Array.from(c2.entries()).forEach(
                ([t4, n3]) => e3.library.domains[t4] = n3
              );
            }), a3;
          }
        };
      })(), (() => {
        const { $dialog: t2, $commands: n2, $store: a2 } = e;
        t2.migrateCommand = (e2) => (e2.version || (e2 = {
          version: 1,
          meta: {
            name: e2.id || a2.idGenerator.command(),
            title: e2.title,
            description: "",
            category: "User"
          },
          steps: [
            ...(e2.params || []).map((e3, t3) => [
              { say: e3 || `Type in p${t3 + 1}` },
              { ask: `p${t3 + 1}` }
            ]).flat(),
            { gpt: e2.prompt || "" }
          ]
        }), n2.normalizeCommand(e2), e2);
      })(), (() => {
        const { $dialog: t2 } = e;
        t2.sanitizer = {
          toCopy: (e2) => e2.replace(/<!--[\s\S]*?-->/g, ""),
          toPaste(e2) {
            e2 = this.toCopy(e2).replace(/<!--[\s\S]*?-->/g, "").trim();
            const t3 = Array.from(
              e2.matchAll(/^```(?<lang>\S*)\s(?<code>[\s\S]*?)\s^```/gm) || []
            );
            return t3.length === 1 && t3[0].groups?.code || e2;
          }
        };
      })(), (() => {
        const {
          $dialog: t2,
          $analytics: n2,
          $commands: a2,
          $utils: o2,
          $browser: i2,
          $bus: r2,
          $mobx: s2,
          $chat: l2,
          $store: c2,
          $s: u2
        } = e, p2 = (e2) => e2?.command?._instanceId;
        t2.commandController = {
          init() {
            r2.on("dialog.commandStart", this.start, this), r2.on("dialog.commandInput", this.input, this);
          },
          start(e2, i3, r3, s3 = {}) {
            const l3 = u2.chats.get(e2);
            if (!s3.silentMode && !u2.billing.onCommandRun(l3, r3)) return false;
            if (s3.silentMode || n2.controller.sendCommandRun(r3), r3 = {
              _instanceId: o2.id.nano(),
              chatId: e2,
              tabId: i3,
              params: { command: { ...r3.meta } },
              inputs: [],
              ...r3
            }, l3.command = r3, l3.setStepCursor(s3.stepCursor || "steps.0"), r3.meta.name !== "clear") {
              const e3 = u2.commands.getCommand(r3.meta.name) || r3.meta, n3 = t2.getCommandEmoji(r3.meta), o3 = e3.title || a2.defaultTitle;
              l3.addAnswer({
                text: `${n3}  **${o3}**
\`${e3.category}\` ${e3.desc}`,
                commandName: `/${e3.name}`,
                delimiter: true,
                system: true,
                silent: s3.silentMode
              });
            }
            return setTimeout(() => this.runCommand(e2, i3)), r3._instanceId;
          },
          async input(e2, n3, a3, i3 = {}) {
            const r3 = u2.chats.get(e2);
            if (i3.dumb) {
              let t3 = a3;
              if (t3 = await l2.paramController.interpolate(e2, n3, t3, {
                noLimit: true
              }), t3.length > 1e5) {
                const e3 = o2.number.toShort(t3.length - 1e4);
                t3 = o2.string.shorten(t3, 1e5) + `

 \`${e3} symbols more\``;
              }
              return void r3.addAnswer({ text: t3, system: true, done: true });
            }
            const s3 = r3.visibleAttachments.map(
              (e3) => c2.template.messageAttachment({
                type: e3.type,
                pdf: e3.pdf,
                image: e3.image
              })
            );
            r3.attachments = u2.settings.keepPdfs && !r3.command ? r3.attachments.filter((e3) => e3.type === "pdf") : [];
            const p3 = String(a3).trim(), d2 = p3.length > 0 || s3.length > 0, { text: m2, flags: h } = l2.flagsController.parse(p3);
            if (!r3.command) {
              if (!d2) return;
              return (await l2.actionsController.askChat(e2, n3, m2, {
                flags: h,
                attachments: s3,
                pmc: true
              }))?.text;
            }
            if (r3.lastAnswer.error) return await l2.actionsController.resend(e2, n3);
            const g = o2.get(r3.command, r3.stepCursor);
            if (!g) {
              await t2.commandController.onCommandStop(r3.command), r3.command = null;
              return (await l2.actionsController.askChat(e2, n3, m2, { flags: h, pmc: true }))?.text;
            }
            const f = g.type === "ask" ? g : null, y = f?.param || "input";
            if (!f) {
              await t2.commandController.onCommandStop(r3.command), r3.command = null;
              return (await l2.actionsController.askChat(e2, n3, m2, { flags: h, pmc: true }))?.text;
            }
            {
              if (r3.input = "", !d2) {
                if (!f.default) return;
                a3 = f.default;
              }
              r3.ask && r3.modifyAsk((e3) => e3.enabled = false);
              let t3 = [a3, l2.attachmentsController.toPlaceholder(s3)].filter(Boolean).join(" ");
              const c3 = r3.ask?.options?.find((e3) => e3.selected);
              if (c3 && c3?.value !== "$custom" && (t3 = c3.value || c3.label), this.setParam(e2, y, t3, c3), !(i3.silent || c3 && c3.value !== "$custom")) {
                const e3 = { text: String(a3) };
                o2.is.empty(s3) || (e3.attachments = s3), r3.addQuestion(e3);
              }
              const u3 = i3.delay ?? 250;
              this._gotoNextCommandStep(e2, n3, { delay: u3 });
            }
          },
          _gotoNextCommandStep(e2, t3, { delay: n3, step: a3 } = {}) {
            const o3 = u2.chats.get(e2), i3 = p2(o3);
            setTimeout(() => {
              i3 === p2(o3) && (a3 ? o3.setStepCursor(a3) : o3.stepCursorNext(), this.runCommand(e2, t3));
            }, n3 || 0);
          },
          async runCommand(e2, n3) {
            const i3 = u2.chats.get(e2), r3 = i3.command;
            if (!r3) return;
            let s3 = o2.get(r3, i3.stepCursor);
            for (; !s3 && i3.stepCursor; )
              i3.stepCursorUp(), s3 = o2.get(r3, i3.stepCursor), a2.steps[s3?.type]?.loop || (i3.stepCursorNext(), s3 = o2.get(r3, i3.stepCursor));
            if (!s3)
              return await t2.commandController.onCommandStop(i3.command), void (i3.command = null);
            try {
              await this._runCommandStep(e2, n3, s3);
            } catch (e3) {
              t2.error(e3), await this._interrupt(i3.id, `Command failed: ${e3.message}`);
            }
          },
          addCommandStopListener(e2, t3) {
            this._commandStopListeners = this._commandStopListeners || {}, this._commandStopListeners[e2] = t3;
          },
          removeCommandStopListener(e2) {
            delete this._commandStopListeners[e2];
          },
          async onCommandStop(e2) {
            const t3 = e2?.initialConnectionId;
            if (t3 && u2.ai.connections.get(t3)) {
              const n4 = u2.chats.get(e2.chatId);
              n4 && n4.connectionId !== t3 && (n4.connectionId = t3);
            }
            if (!this._commandStopListeners) return;
            const n3 = e2?._instanceId, a3 = this._commandStopListeners[n3];
            a3 && (await a3(e2), delete this._commandStopListeners[n3]);
          },
          async _runCommandStep(e2, t3, r3) {
            const s3 = u2.chats.get(e2), c3 = p2(s3);
            e: if (r3.condition) {
              const n3 = o2.ensureArray(r3.condition).filter((e3) => e3 && e3.trim().length > 0);
              for (const a3 of n3) {
                if (await this._checkCondition(e2, t3, a3)) break e;
              }
              if (c3 !== p2(s3)) return;
              return void this._gotoNextCommandStep(e2, t3);
            }
            r3.analytics && n2.controller.sendCommandStepAnalytics(r3);
            const d2 = await i2.controller.connectTab(t3), m2 = u2.tabs[t3].creator.frame.open, h = a2.steps[r3.type];
            if (h) {
              const n3 = { tabId: t3, step: r3, chat: s3, page: d2 };
              n3.sh = o2.string.shorten, n3.command = s3.command, n3.addInput = (...n4) => this.input(e2, t3, ...n4), n3.getParam = (...n4) => this.getParam(e2, t3, ...n4), n3.setParam = async (n4, a4, ...o3) => {
                let i3 = await l2.paramController.interpolate(e2, t3, n4, {
                  noLimit: true
                });
                return (!i3 || i3 === "\u2014" || i3.length > 256) && (i3 = n4), this.setParam(e2, i3, a4, ...o3);
              }, n3.interpolate = (...n4) => l2.paramController.interpolate(e2, t3, ...n4), n3.interpolateObject = (...n4) => l2.paramController.interpolateObject(e2, t3, ...n4), n3.log = (e3, t4) => {
                if (c3 !== p2(s3)) return;
                e3 = o2.ensureArray(e3).filter(Boolean);
                const n4 = [
                  `${h.emoji}&nbsp;&nbsp;**${t4 || h.title}**`,
                  ...e3
                ].join(" \u2192 ");
                s3.addAnswer({ text: n4 });
              }, n3.error = (e3, t4) => {
                if (c3 !== p2(s3)) return;
                e3 = o2.ensureArray(e3).filter(Boolean);
                const n4 = [`\u274C&nbsp;&nbsp;**${t4 || h.title}**`, ...e3].join(
                  " \u2192 "
                );
                s3.addAnswer({ text: n4 });
              };
              let a3 = await h.run(n3) || {};
              if (c3 !== p2(s3)) return;
              if (o2.is.string(a3) && (a3 = { type: a3 }), a3.type === "abort")
                return;
              if (a3.type === "interrupt") return this._interrupt(e2, a3.message);
              if (a3.type === "next") return this._gotoNextCommandStep(e2, t3, a3);
            }
            m2 && ["navigate", "click"].includes(r3.type) && await i2.controller.showFrame(t3), this._gotoNextCommandStep(e2, t3, {
              delay: ["say", "ask"].includes(r3.type) ? 250 : 0
            });
          },
          async getParam(e2, t3, n3) {
            const a3 = await u2.chats.get(e2).getParam(n3);
            return void 0 !== a3 ? s2.toJS(a3) : l2.params.getValue(n3, t3);
          },
          setParam(e2, t3, n3, a3) {
            const o3 = u2.chats.get(e2);
            o3.setParam(t3, n3), a3 && o3.setParam(`${t3}-option`, a3?.value);
          },
          async _checkCondition(e2, t3, n3) {
            const a3 = [
              " = ",
              " == ",
              " != ",
              " !== ",
              " > ",
              " >= ",
              " < ",
              " <= ",
              " =~ ",
              " ? "
            ], o3 = `${n3} `;
            let i3, [r3, s3] = ["", ""];
            for (const e3 of a3)
              if (o3.includes(e3)) {
                [r3, s3] = o3.split(e3), i3 = e3.trim();
                break;
              }
            switch (i3 || (i3 = "?", r3 = n3), r3 = await l2.paramController.interpolate(e2, t3, r3.trim(), {
              noLimit: true
            }), r3 = r3 === "\u2014" ? "" : r3 || "", s3 = await l2.paramController.interpolate(e2, t3, s3.trim(), {
              noLimit: true
            }), s3 = s3 === "\u2014" ? "" : s3 || "", i3) {
              case "=":
              case "==":
                return r3 === s3;
              case "!=":
              case "!==":
                return r3 !== s3;
              case ">":
                return Number(r3) > Number(s3);
              case ">=":
                return Number(r3) >= Number(s3);
              case "<":
                return Number(r3) < Number(s3);
              case "<=":
                return Number(r3) <= Number(s3);
              case "=~":
                return new RegExp(s3).test(r3);
              case "?":
                return r3 === "true" || r3 !== "false" && r3 !== "";
              default:
                return false;
            }
          },
          async _interrupt(e2, n3) {
            const a3 = u2.chats.get(e2);
            n3 && a3.addAnswer({ text: n3, error: l2.errors.commandConfigError }), await t2.commandController.onCommandStop(a3.command), a3.command = null;
          }
        };
      })(), (() => {
        const {
          $dialog: t2,
          $browser: n2,
          $chat: a2,
          $type: o2,
          $files: i2,
          $utils: r2,
          $bus: s2,
          $s: l2
        } = e;
        t2.context = {
          async insert(e2, t3, n3, a3 = {}, i3 = {}) {
            o2.assert.dev(a3, {
              "web?": [String, Boolean],
              "page?": Boolean,
              "pdfs?": Array.of({ fileId: String, name: String })
            }), o2.assert.dev(i3, { "noLimit?": Boolean });
            const s3 = l2.chats.get(t3);
            if (!a3.page && !a3.web && r2.is.empty(a3.pdfs)) return e2;
            a3.web ??= false, a3.page ??= false, a3.pdfs ??= [], i3.noLimit ??= false;
            const c2 = await (async () => {
              if (i3.noLimit) return 1 / 0;
              const t4 = [
                "[USER PROMPT]",
                a3.page || a3.web ? "[CONTEXT]" : "",
                ...a3.pdfs.map((e3, t5) => `[FILE ${t5}: ${e3.name}]`)
              ].filter(Boolean).join("\n\n\n"), n4 = await s3.connection.countTextTokens(t4), o3 = await s3.connection.countTextTokens(e2);
              return s3.connection.maxRequestTokens - o3 - n4;
            })(), u2 = { tabId: n3, chat: s3, parts: a3, prompt: e2, availableTokens: c2 }, p2 = await this._preparePdfs(u2);
            o2.assert.dev(p2, Array.of({ title: String, text: String }));
            const d2 = await this._prepareContext(u2);
            return o2.assert.dev(d2, [null, { title: String, text: String }]), [
              `[USER PROMPT]
${e2}`,
              ...[d2, ...p2].filter(Boolean).map((e3) => `${e3.title}
${e3.text}`)
            ].join("\n\n");
          },
          async _preparePdfs(e2) {
            let {
              tabId: t3,
              chat: n3,
              parts: o3,
              prompt: l3,
              availableTokens: c2
            } = e2;
            const u2 = r2.cloneDeep(o3.pdfs);
            await Promise.all(
              u2.map(async (e3) => {
                const t4 = await i2.get(e3.fileId);
                let n4;
                n4 = t4.type === "application/pdf" ? await s2.send("engine.pdfToText", t4) : t4.type === "application/vnd.ms-excel" ? await s2.send("engine.xlsToText", t4) : t4.type === "application/msword" ? await s2.send("engine.docToText", t4) : t4.type === "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" ? await s2.send("engine.xlsxToText", t4) : t4.type === "application/vnd.openxmlformats-officedocument.wordprocessingml.document" ? await s2.send("engine.docxToText", t4) : await new Promise((e4) => {
                  const n5 = new FileReader();
                  n5.onload = () => e4(n5.result), n5.onerror = () => e4("<FAILED TO READ FILE CONTENT>"), n5.readAsText(t4);
                }), e3.text = n4 || "";
              })
            );
            const p2 = u2.reduce((e3, t4) => e3 + t4.text.length, 0);
            let d2 = c2;
            return await Promise.all(
              u2.map(async (e3, o4) => {
                const i3 = e3.text, r3 = i3.length / p2;
                let s3 = Math.floor(r3 * c2);
                s3 < 100 && (s3 = 100), s3 > d2 && (s3 = d2), e3.title = `[FILE ${o4 + 1}: ${e3.name}]`, e3.text = await a2.contextualize(t3, i3, l3, s3), d2 -= await n3.connection.countTextTokens(e3.text);
              })
            ), e2.availableTokens = d2, u2.map((e3) => ({ title: e3.title, text: e3.text }));
          },
          async _prepareContext(e2) {
            const {
              tabId: o3,
              chat: i3,
              parts: r3,
              prompt: s3,
              availableTokens: l3
            } = e2, c2 = i3.connection, u2 = [], p2 = c2.modelMaxTokens * (i3.messages.some((e3) => ["user", "assistant"].includes(e3.role)) ? 0.3 : 1);
            let d2 = Math.floor(Math.min(l3, p2));
            if (d2 < 100) return null;
            if (!o3) return null;
            try {
              const e3 = await chrome.tabs.get(o3), t3 = await n2.controller.connectTab(o3);
              let l4 = this._getPreferredLanguage();
              if (l4) {
                const e4 = await c2.countTextTokens(l4);
                e4 <= d2 && (d2 -= e4, u2.push(l4));
              }
              e: if (r3.web) {
                const e4 = "- [Web search results]:\n", t4 = await c2.countTextTokens(`${"- [Web search results]:\n"}
`);
                if (d2 - t4 < 100) break e;
                const n3 = typeof r3.web == "string" && r3.web || s3;
                let o4 = await a2.paramSerp({ prompt: n3 });
                if (o4) {
                  o4 = a2.linkFoldController.fold(i3.id, o4), o4 = `${e4}${o4}
`;
                  const t5 = await c2.countTextTokens(o4);
                  t5 <= d2 && (d2 -= t5, u2.push(o4));
                }
              }
              e: if (r3.page) {
                let e4 = await this._getPageMetadata(t3);
                if (!e4) break e;
                const n3 = await c2.countTextTokens(e4);
                n3 <= d2 && (d2 -= n3, u2.push(e4));
              }
              e: if (r3.page) {
                const n3 = "- [Web page content]:\n", o4 = d2 - await c2.countTextTokens(`${"- [Web page content]:\n"}
`);
                if (o4 < 100) break e;
                const i4 = typeof r3.page == "string" && r3.page || s3;
                let l5 = await a2.paramPage({
                  args: i4,
                  tab: e3,
                  page: t3,
                  maxTokens: o4
                });
                if (l5) {
                  l5 = `${n3}${l5}
`;
                  const e4 = await c2.countTextTokens(l5);
                  e4 <= d2 && (d2 -= e4, u2.push(l5));
                }
              }
            } catch (e3) {
              t2.warn(`failed to read page from tab ${o3}`, e3);
            }
            return u2.length === 0 ? null : (e2.availableTokens = d2, { title: "[CONTEXT]", text: u2.join("") });
          },
          _getPreferredLanguage: () => l2.settings.promptLanguage === "english" ? null : `- [User prefers LLM to reply in]: ${l2.settings.promptLanguageValue}
`,
          async _getPageMetadata(e2) {
            let [t3, n3, a3] = await Promise.all([
              e2.url(),
              e2.title(),
              e2.description()
            ]);
            t3 = t3.split("?")[0].split("#")[0];
            return `- [Current web page]: ${[t3, n3, a3].filter(Boolean).join(" | ")}
`;
          }
        };
      })(), (() => {
        const { $dialog: t2, $bus: n2, $browser: a2, $s: o2 } = e;
        t2.controller = {
          init() {
            t2.cspController.init(), t2.commandController.init(), n2.on("dialog.navigateToUrl", this.navigateToUrl, this), n2.on("dialog.jumpVideo", this.jumpVideo, this), chrome.runtime.onMessage.addListener(this.onMessage.bind(this));
          },
          async navigateToUrl(e2, t3) {
            const n3 = await a2.controller.connectTab(e2);
            try {
              await chrome.executeScript(
                e2,
                (e3) => {
                  window.location.href = e3;
                },
                { args: [t3] }
              );
            } catch (e3) {
              await n3.goto(t3);
            }
          },
          async jumpVideo(e2, t3) {
            await chrome.executeScript(
              e2,
              (e3) => {
                const t4 = document.querySelector("video");
                t4 && (t4.currentTime = e3);
              },
              { args: [t3] }
            );
          },
          async onMessage(e2, t3) {
            if (e2?.type !== "harpa.importCommand") return;
            const i2 = t3?.tab?.id;
            if (!i2) return;
            chrome.tabs.sendMessage(i2, { type: "harpa.importCommandOk" }), await a2.controller.showFrame(i2);
            const r2 = o2.chats.getByTabId(i2);
            r2 && (r2.input = "/", r2.explorer.show = true, r2.explorer.screen = "import", setTimeout(() => {
              n2.send(i2, "dialog.importCommand", e2.command, e2.recipeId);
            }, 250));
          }
        };
      })(), (() => {
        const { $dialog: t2, $browser: n2, $bus: a2, $chat: o2, $s: i2 } = e;
        t2.cspController = {
          init() {
            a2.on("dialog.cspAllowAll", (e2) => this._allow(e2, "all")), a2.on("dialog.cspAllowOnce", (e2) => this._allow(e2, "once"));
          },
          async _allow(e2, t3) {
            const r2 = i2.tabs[e2];
            if (!r2) return;
            const s2 = i2.chats.get(r2.chatId);
            if (!s2) return;
            const l2 = await n2.controller.connectTab(e2);
            await l2.unregisterServiceWorker(), t3 === "all" && (i2.settings.csp.allowAll = true);
            const c2 = async (t4) => {
              t4 === e2 && (a2.off("startup.csStarted", c2), i2.transaction(() => {
                s2.messages = s2.messages.filter(
                  (e3) => e3.error !== o2.errors.csp
                ), s2.addAnswer({ text: "\u23F3 Resuming command...", silent: false });
              }), await n2.controller.showFrame(e2), await l2.idle(), s2.removeLastAnswer(), await o2.actionsController.resend(s2.id, e2));
            };
            a2.on("startup.csStarted", c2), await l2.reload();
          }
        };
      })(), (() => {
        const { $engine: t2, $bus: n2, $env: a2 } = e;
        t2.htmlToText = async (e2) => {
          if (a2.is.bg) return await n2.send("engine.htmlToText", e2);
          if (!e2) return e2;
          const t3 = e2.match(/<body[^>]*>([\s\S]*?)<\/body>/i);
          if (!t3 || !t3[1]) return null;
          let o2 = t3[1];
          o2 = o2.replaceAll(/src="[^"]*"/g, "").replaceAll(/href="[^"]*"/g, ""), o2 = o2.replaceAll(/<style[^>]*>[\s\S]*?<\/style>/gi, "").replaceAll(/<script[^>]*>[\s\S]*?<\/script>/gi, "");
          let i2 = document.createElement("div");
          i2.innerHTML = o2;
          Array.from(
            i2.querySelectorAll(
              "head, script, style, img, svg, nav, footer, header, aside, iframe, video, audio, canvas, map, object, embed, applet, frame, frameset, noframes, noembed, noscript, link, meta, base, title"
            )
          ).forEach((e3) => e3.remove()), Array.from(i2.querySelectorAll("*")).filter((e3) => !e3.textContent.trim()).forEach((e3) => e3.remove()), Array.from(i2.querySelectorAll("*")).forEach((e3) => {
            Array.from(e3.attributes).forEach((t4) => e3.removeAttribute(t4.name));
          }), i2.querySelectorAll("h1, h2, h3, h4, h5, h6").forEach((e3) => {
            const t4 = parseInt(e3.tagName[1]);
            e3.textContent = "#".repeat(t4) + ` ${e3.textContent}`;
          }), document.body.appendChild(i2);
          let r2 = i2.innerText || "";
          return document.body.removeChild(i2), r2 = r2.replace(/ +/g, " ").replace(/\n+/g, "\n").trim(), r2 = r2.split("\n").map((e3) => e3.trim()), r2 = r2.filter((e3, t4) => e3 && r2.indexOf(e3) === t4).join("\n"), r2;
        };
      })(), (() => {
        const { $engine: t2 } = e, n2 = /* @__PURE__ */ new Set([
          "goto",
          "navigate",
          "reload",
          "hover",
          "click",
          "dblclick",
          "scroll"
        ]);
        t2.idleDelay = (e2) => n2.has(e2) ? 15e3 : 0;
      })(), (() => {
        const { $engine: t2 } = e;
        t2.isAutomatable = (e2) => {
          if (e2)
            try {
              return e2 = new URL(e2), !!["http:", "https:"].includes(e2.protocol) && !["chrome.google.com"].includes(e2.host) && !["chromewebstore.google.com"].includes(e2.host) && !e2.href.startsWith("https://harpa.ai/automation");
            } catch (e3) {
              return false;
            }
        };
      })(), (() => {
        const { $engine: t2 } = e;
        t2.BrowserContext = class {
          constructor(e2, t3 = "default") {
            if (!e2) throw new Error("browser argument is mandatory");
            this._browser = e2, this._profile = t3, this._pages = [], this._isClosed = false;
          }
          get isClosed() {
            return this._isClosed;
          }
          get browser() {
            return this._browser;
          }
          get profile() {
            return this._profile;
          }
          get pages() {
            return this._pages;
          }
          async newPage(e2, n2 = {}) {
            this._throwIfClosed(), e2 && typeof e2 != "string" && (n2 = e2, e2 = null);
            const a2 = new t2.Page(this, n2);
            return this._pages.push(a2), a2.on("pageClosed", (e3) => {
              this.emit("pageClosed", e3);
            }), this[`p${this._pages.length}`] = a2, this.emit("pageCreated", a2), e2 && await a2.goto(e2, n2), a2;
          }
          async close() {
            if (this._isClosed) return;
            this._isClosed = true;
            const e2 = [...this._pages];
            this._pages = [];
            for (let t3 = 1; t3 <= e2.length; t3++) delete this[`p${t3}`];
            await Promise.all(e2.map((e3) => e3.close())), this.emit("contextClosed", this);
          }
          _throwIfClosed() {
            if (this._isClosed) throw new Error("browser context is closed");
          }
        };
      })(), (() => {
        const { $engine: t2 } = e;
        t2.Browser = class e2 {
          static ENGINE_NAME = "engine-0.1.0";
          constructor() {
            this._contexts = [], this._pages = [], this._isClosed = false, t2.mixinEventEmitter([t2.Browser, t2.BrowserContext, t2.Page]), t2.mixinClassShortcuts([t2.Browser, t2.BrowserContext, t2.Page]);
          }
          get isClosed() {
            return this._isClosed;
          }
          get version() {
            const e3 = t2.Browser.ENGINE_NAME.split("-");
            if (e3.length !== 2)
              throw new Error(
                "wrong browser version format, must be name-version"
              );
            return e3[1];
          }
          get contexts() {
            return this._contexts;
          }
          get pages() {
            return this._pages;
          }
          async spawnContext(n2) {
            let a2;
            if (this._throwIfClosed(), (n2 = n2 || "default") !== "default")
              throw n2 === "incognito" ? new Error(
                "incognito context is not supported by " + e2.ENGINE_NAME
              ) : new Error(
                "persistent context is not supported by " + e2.ENGINE_NAME
              );
            return a2 = new t2.BrowserContext(this, n2), this._contexts.push(a2), a2.on("pageCreated", (e3) => {
              this._pages.push(e3), this[`p${this._pages.length}`] = e3, this.emit("pageCreated", e3);
            }), a2.on("pageClosed", (e3) => {
              this.emit("pageClosed", e3);
            }), a2.on("contextClosed", (e3) => {
              this.emit("contextClosed", e3);
            }), this[`c${this._contexts.length}`] = a2, this.emit("contextCreated", a2), a2;
          }
          async newPage(e3, t3 = {}) {
            this._throwIfClosed(), e3 && typeof e3 != "string" && (t3 = e3, e3 = null);
            const n2 = t3.profile || "default";
            let a2 = this._contexts.find((e4) => e4.profile === n2);
            return a2 || (a2 = await this.spawnContext(n2)), a2.newPage(e3, t3);
          }
          async close() {
            if (this._isClosed) return;
            this._isClosed = true;
            const e3 = [...this._contexts];
            this._contexts = [];
            const t3 = [...this._pages];
            this._pages = [];
            for (let e4 = 1; e4 <= t3.length; e4++) delete this[`p${e4}`];
            for (let t4 = 1; t4 <= e3.length; t4++) delete this[`c${t4}`];
            await Promise.all(e3.map((e4) => e4.close())), this.emit("browserClosed", this);
          }
          _throwIfClosed() {
            if (this._isClosed) throw new Error("browser is closed");
          }
        };
      })(), (() => {
        const { $engine: t2 } = e;
        t2.Element = class {
          constructor(e2, t3, n2) {
            if (e2 == null) throw new Error("element id is required");
            if (this._id = e2, void 0 !== t3 && (this._data = t3), !n2)
              throw new Error("element page is required");
            this._page = n2;
          }
          get id() {
            return this._id;
          }
          get data() {
            return this._data;
          }
          get page() {
            return this._page;
          }
          async wait(e2) {
            return this._page.wait(this, e2);
          }
          async content(e2 = {}) {
            return this._page.content(this, e2);
          }
          async evaluate(e2, t3, n2) {
            return t3 = [this, ...t3], this._page.evaluate(e2, t3, n2);
          }
          async parse(e2) {
            return this._page.parse(this, e2);
          }
          async inspect(e2) {
            return this._page.inspect(this, e2);
          }
          async scroll(e2) {
            return this._page.scroll(this, e2);
          }
          async move(e2) {
            return this._page.move(this, e2);
          }
          async click(e2) {
            return this._page.click(this, e2);
          }
          async hover(e2) {
            return this._page.hover(this, e2);
          }
          async unhover(e2) {
            return this._page.unhover(this, e2);
          }
          async upload(e2) {
            return this._page.upload(this, e2);
          }
          async select(e2) {
            return this._page.select(this, e2);
          }
          async unselect(e2) {
            return this._page.unselect(this, e2);
          }
          async clear(e2) {
            return this._page.clear(this, e2);
          }
          serialize() {
            return { __$ht: "element", id: this._id };
          }
          static deserialize(e2, n2) {
            if (e2?.__$ht === "element")
              return new t2.Element(e2.id, t2.serializer.deserialize(e2.data, n2), n2);
          }
        };
      })(), (() => {
        const { $engine: t2 } = e;
        t2.Frame = class {
          constructor(e2) {
            this._page = e2;
          }
          async injected() {
            return await this._page.controller.sendRequest("frame.injected", []);
          }
          async inject() {
            await this._page.controller.sendRequest("frame.inject", []);
          }
          async eject() {
            await this._page.controller.sendRequest("frame.eject", []);
          }
          async setWidth(e2) {
            await this._page.controller.sendRequest("frame.setWidth", [e2]);
          }
        };
      })(), (() => {
        const { $engine: t2, $utils: n2 } = e;
        t2.DATA_ITEM_TYPES = /* @__PURE__ */ new Set([
          "text",
          "link",
          "image",
          "icon",
          "video",
          "number",
          "price",
          "time",
          "date",
          "copyright"
        ]), t2.SELECTOR_TYPES = [
          "role",
          "placeholder",
          "text",
          "content",
          "displayValue",
          "altText",
          "title",
          "testId",
          "id",
          "tag",
          "class",
          "attribute",
          "src",
          "style",
          "css",
          "xpath"
        ], t2.Locator = class e2 {
          constructor(e3, t3) {
            this._selector = this._declarationToObject(e3 || []), t3 && (this._page = t3);
          }
          _declarationToObject(a2, { inFind: o2 } = {}) {
            if (!a2) throw new Error("selected must not be empty or nullish");
            if (a2 instanceof e2) return a2.selector;
            if (Array.isArray(a2))
              return a2.map((e3) => this._declarationToObject(e3, { inFind: true }));
            const i2 = typeof a2;
            if (["number", "boolean"].includes(i2))
              throw new Error(
                `selected must be array, string or object, got ${i2}`
              );
            if (i2 == "string" && !a2.includes(": ")) return a2;
            if (i2 == "string") {
              let [e3, ...n3] = a2.split(": ");
              return e3 = e3.startsWith("$") ? e3.slice(1) : e3, t2.SELECTOR_TYPES.includes(e3) ? { [`$${e3}`]: n3.join(": ") } : { $text: a2 };
            }
            if (i2 != "object")
              throw new Error(`unsupported selector type ${i2}`);
            const r2 = Object.keys(a2);
            if (r2.length === 0) return a2;
            let s2 = 0;
            if (t2.SELECTOR_TYPES.forEach((e3) => {
              if (e3 = `$${e3}`, a2.hasOwnProperty(e3)) {
                if (!["number", "string", "boolean"].includes(typeof a2[e3]))
                  throw new Error(`${e3} selector value must be a string`);
                s2++;
              }
            }), s2 > 0) {
              const e3 = new Set(r2);
              if (e3.delete("at"), e3.delete("traverse"), e3.delete("filter"), e3.delete("size"), e3.size !== s2)
                throw new Error("extra parameters passed with selector");
              return a2;
            }
            if (a2.hasOwnProperty("$find")) {
              if (r2.length !== 1)
                throw new Error("extra parameters passed with $find command");
              const { $find: e3 } = a2;
              if (!Array.isArray(e3))
                throw new Error("$find command value must be an array");
              return e3.map((e4) => this._declarationToObject(e4, { inFind: true }));
            }
            if (a2.hasOwnProperty("$matches")) {
              let { $matches: e3, type: t3, min: o3, max: i3 } = a2;
              if (t3 = t3 || "most", !Array.isArray(e3))
                throw new Error("$matches value must be an array");
              if (n2.hasExtraKeys(a2, ["$matches", "min", "max", "type"]))
                throw new Error(
                  "extra parameters passed with $matches command"
                );
              if (!["most", "any", "all", "none"].includes(t3))
                throw new Error(`$matches type ${t3} is not supported`);
              if (a2.hasOwnProperty("min")) {
                if (["all", "none"].includes(t3))
                  throw new Error(`$matches type '${t3}' does not support min`);
                if (!n2.is.number(o3))
                  throw new Error("$matches min must be a number");
                if (o3 < 0) throw new Error("$matches min must be positive");
                if (o3 > e3.length)
                  throw new Error("$matches min must be below matches size");
              }
              if (a2.hasOwnProperty("max")) {
                if (["all", "none"].includes(t3))
                  throw new Error(`$matches type '${t3}' does not support max`);
                if (!n2.is.number(i3))
                  throw new Error("$matches min must be a number");
                if (i3 <= 0)
                  throw new Error("$matches max must be greater than zero");
                if (i3 > e3.length)
                  throw new Error("$matches max must be below matches size");
              }
              if (o3 && i3 && o3 > i3)
                throw new Error(
                  "$matches max parameter is less than min parameter"
                );
              return e3 = e3.map(
                (e4) => this._declarationToObject(e4, { inMatch: true })
              ), n2.removeKeys({ $matches: e3, type: t3, min: o3, max: i3 });
            }
            if (a2.hasOwnProperty("$filter")) {
              if (!o2)
                throw new Error(
                  "$filter is only supported inside $find or array"
                );
              if (r2.length !== 1)
                throw new Error("extra parameters passed with $filter command");
              const { $filter: e3 } = a2, t3 = [
                "roots",
                "branches",
                "leaves",
                "connected",
                "visible",
                "clickable",
                "fixed"
              ];
              if (!t3.includes(e3))
                throw new Error(`$filter must be one of: ${t3.join(", ")}`);
              return a2;
            }
            if (a2.hasOwnProperty("$at")) {
              if (!o2)
                throw new Error("$at is only supported inside $find or array");
              if (r2.length !== 1)
                throw new Error("extra parameters passed with $at command");
              const { $at: e3 } = a2;
              if (n2.is.number(e3)) {
                if (e3 < 0) throw new Error("$at must be positive");
              } else {
                if (!["first", "last"].includes(e3))
                  throw new Error("$at must be one of: first, last, [number]");
              }
              return { $at: e3 };
            }
            if (a2.hasOwnProperty("$first")) {
              if (r2.length !== 1)
                throw new Error("extra parameters passed with $first selector");
              const { $first: e3 } = a2;
              return [
                ...n2.ensureArray(e3).map((e4) => this._declarationToObject(e4, { inFind: true })),
                { $at: "first" }
              ];
            }
            if (a2.hasOwnProperty("$last")) {
              if (r2.length !== 1)
                throw new Error("extra parameters passed with $last selector");
              const { $last: e3 } = a2;
              return [
                ...n2.ensureArray(e3).map((e4) => this._declarationToObject(e4, { inFind: true })),
                { $at: "last" }
              ];
            }
            if (a2.hasOwnProperty("$traverse")) {
              if (!o2)
                throw new Error(
                  "$traverse is only supported inside $find or array"
                );
              if (r2.length !== 1)
                throw new Error(
                  "extra parameters passed with $traverse command"
                );
              const { $traverse: e3 } = a2;
              if (!n2.is.string(e3) && !n2.is.array(e3))
                throw new Error("$traverse must be one of: string or array");
              return a2;
            }
            if (a2.hasOwnProperty("$anchor")) {
              const e3 = ["$anchor", "shift", "at"];
              if (n2.hasExtraKeys(a2, e3))
                throw new Error("extra parameters passed with $anchor command");
              const t3 = {
                $anchor: this._declarationToObject(a2.$anchor, { inFind: true })
              };
              let { shift: o3, at: i3 } = a2;
              if (void 0 !== o3) {
                const e4 = n2.is.string(o3) ? o3.split(":") : o3;
                if (!n2.is.array(e4) || e4.length !== 2)
                  throw new Error(
                    '$near.shift must be "dx:dy" or [dx, dy] array'
                  );
                t3.shift = o3;
              }
              return void 0 !== i3 && (t3.at = Number(i3) || 0), n2.removeKeys(t3);
            }
            if (a2.hasOwnProperty("$parse")) {
              if (!o2)
                throw new Error(
                  "$parse is only supported inside $find or array"
                );
              const e3 = ["$parse", "at"];
              if (n2.hasExtraKeys(a2, e3))
                throw new Error("extra parameters passed with $parse command");
              const { $parse: t3, at: i3 } = a2;
              if (!n2.is.string(t3))
                throw new Error("$parse value must be a string");
              if (void 0 !== i3) {
                if (!n2.is.number(i3))
                  throw new Error("$parse at parameter must be a number");
                if (i3 < 0)
                  throw new Error(
                    "$parse at parameter must be greater than zero"
                  );
              }
              return a2;
            }
            if (a2.hasOwnProperty("$and")) {
              if (r2.length !== 1)
                throw new Error("extra parameters passed with $and selector");
              return {
                $matches: n2.ensureArray(a2.$and).map((e3) => this._declarationToObject(e3, { inMatch: true })),
                type: "all"
              };
            }
            if (a2.hasOwnProperty("$or")) {
              if (r2.length !== 1)
                throw new Error("extra parameters passed with $or selector");
              return {
                $matches: n2.ensureArray(a2.$or).map((e3) => this._declarationToObject(e3, { inMatch: true })),
                type: "any"
              };
            }
            if (a2.hasOwnProperty("$not")) {
              if (r2.length !== 1)
                throw new Error("extra parameters passed with $not selector");
              return {
                $matches: n2.ensureArray(a2.$not).map((e3) => this._declarationToObject(e3, { inMatch: true })),
                type: "none"
              };
            }
            if (a2.hasOwnProperty("$most")) {
              if (r2.length !== 1)
                throw new Error("extra parameters passed with $most selector");
              return {
                $matches: n2.ensureArray(a2.$most).map((e3) => this._declarationToObject(e3, { inMatch: true })),
                type: "most"
              };
            }
            if (a2.hasOwnProperty("$children")) {
              if (r2.length !== 1)
                throw new Error(
                  "extra parameters passed with $children command"
                );
              return [
                ...n2.ensureArray(a2.$children).map((e3) => this._declarationToObject(e3, { inFind: true })),
                { $traverse: "children" }
              ];
            }
            if (a2.hasOwnProperty("$parent")) {
              if (r2.length !== 1)
                throw new Error("extra parameters passed with $parent command");
              return [
                ...n2.ensureArray(a2.$parent).map((e3) => this._declarationToObject(e3, { inFind: true })),
                { $traverse: "parent" }
              ];
            }
            if (a2.hasOwnProperty("$descendants")) {
              if (r2.length !== 1)
                throw new Error(
                  "extra parameters passed with $descendants command"
                );
              return [
                ...n2.ensureArray(a2.$descendants).map((e3) => this._declarationToObject(e3, { inFind: true })),
                { $traverse: "descendants" }
              ];
            }
            if (a2.hasOwnProperty("$ancestors")) {
              if (r2.length !== 1)
                throw new Error(
                  "extra parameters passed with $ancestors command"
                );
              return [
                ...n2.ensureArray(a2.$ancestors).map((e3) => this._declarationToObject(e3, { inFind: true })),
                { $traverse: "ancestors" }
              ];
            }
            if (a2.hasOwnProperty("$size")) {
              if (n2.is.array(a2.$size)) {
                if (a2.$size.length === 0)
                  throw new Error("$size array must have at least 1 value");
                if (a2.$size.length > 2)
                  throw new Error("$size array must have at max 2 values");
                if (void 0 !== (a2 = { min: a2.$size[0], max: a2.$size[1] }).min && a2.min !== "_" || delete a2.min, void 0 !== a2.max && a2.max !== "_" || delete a2.max, !a2.hasOwnProperty("min") && !a2.hasOwnProperty("max"))
                  throw new Error(
                    "$size must have at least min or max parameter"
                  );
              } else
                a2 = n2.is.number(a2.$size) ? { min: a2.$size, max: a2.$size } : a2.$size;
              const e3 = ["$size", "min", "max", "throws"];
              if (n2.hasExtraKeys(a2, e3))
                throw new Error("extra parameters passed with $size command");
              if (a2.min && !n2.is.number(a2.min))
                throw new Error("$size min parameter must be a number");
              if (a2.min && a2.min < 0)
                throw new Error(
                  "$size min parameter must be greater than zero"
                );
              if (a2.max && !n2.is.number(a2.max))
                throw new Error("$size max parameter must be a number");
              if (a2.max && a2.max < 0)
                throw new Error(
                  "$size max parameter must be greater than zero"
                );
              if (void 0 !== a2.throws && !n2.is.boolean(a2.throws))
                throw new Error("$size throws parameter must be a boolean");
              return a2.min === a2.max && [true, void 0].includes(a2.throws) && (a2 = a2.min), { $size: a2 };
            }
            throw r2.length === 1 ? new Error(`unsupported selector type / operation: ${r2[0]}`) : new Error(
              `unsupported selector type / operation: ${r2.join(", ")}`
            );
          }
          get selector() {
            return this._selector;
          }
          get isEmpty() {
            return !this._selector || Object.keys(this._selector).length === 0;
          }
          get page() {
            return this._page;
          }
          set page(e3) {
            this._page = e3;
          }
          setPage(e3) {
            return this.page = e3, this;
          }
          async query(e3) {
            return this._throwIfNoPage(), this._page.query(this, e3);
          }
          async queryAll(e3) {
            return this._throwIfNoPage(), this._page.queryAll(this, e3);
          }
          async wait(e3) {
            return this._throwIfNoPage(), this._page.wait(this, e3);
          }
          async content(e3 = {}) {
            return this._throwIfNoPage(), this._page.content(this, e3);
          }
          async evaluate(e3, t3, n3) {
            return this._throwIfNoPage(), t3 = [this, ...t3], this._page.evaluate(e3, t3, n3);
          }
          async parse(e3) {
            return this._throwIfNoPage(), this._page.parse(this, e3);
          }
          async inspect(e3) {
            return this._throwIfNoPage(), this._page.inspect(this, e3);
          }
          async scroll(e3) {
            return this._throwIfNoPage(), this._page.scroll(this, e3);
          }
          async move(e3) {
            return this._throwIfNoPage(), this._page.move(this, e3);
          }
          async click(e3) {
            return this._throwIfNoPage(), this._page.click(this, e3);
          }
          async hover(e3) {
            return this._throwIfNoPage(), this._page.hover(this, e3);
          }
          async unhover(e3) {
            return this._throwIfNoPage(), this._page.unhover(this, e3);
          }
          async upload(e3) {
            return this._throwIfNoPage(), this._page.upload(this, e3);
          }
          async select(e3) {
            return this._throwIfNoPage(), this._page.select(this, e3);
          }
          async unselect(e3) {
            return this._throwIfNoPage(), this._page.unselect(this, e3);
          }
          async clear(e3) {
            return this._throwIfNoPage(), this._page.clear(this, e3);
          }
          serialize() {
            return { __$ht: "locator", selector: this._selector };
          }
          static deserialize(e3, n3) {
            if (e3?.__$ht === "locator") return new t2.Locator(e3.selector, n3);
          }
          _throwIfNoPage() {
            if (!this._page)
              throw new Error(
                "locator instance is not attached to any page, supply page into Locator constructor or using locator.page setter"
              );
          }
          static of(n3, a2) {
            return n3 instanceof t2.Page && (a2 = n3, n3 = null), new e2(n3, a2);
          }
          static ofAnchor(e3, n3, a2) {
            return t2.Locator.of({ ...n3, $anchor: e3 }, a2);
          }
          static ofAll(e3) {
            return t2.Locator.ofCss("*", e3);
          }
          static ofRole(e3, n3) {
            return t2.Locator.of({ $role: e3 }, n3);
          }
          static ofPlaceholder(e3, n3) {
            return t2.Locator.of({ $placeholder: e3 }, n3);
          }
          static ofText(e3, n3) {
            return t2.Locator.of({ $text: e3 }, n3);
          }
          static ofContent(e3, n3) {
            return t2.Locator.of({ $content: e3 }, n3);
          }
          static ofDisplayValue(e3, n3) {
            return t2.Locator.of({ $displayValue: e3 }, n3);
          }
          static ofAltText(e3, n3) {
            return t2.Locator.of({ $altText: e3 }, n3);
          }
          static ofTitle(e3, n3) {
            return t2.Locator.of({ $title: e3 }, n3);
          }
          static ofTestId(e3, n3) {
            return t2.Locator.of({ $testId: e3 }, n3);
          }
          static ofId(e3, n3) {
            return t2.Locator.of({ $id: e3 }, n3);
          }
          static ofTag(e3, n3) {
            return t2.Locator.of({ $tag: e3 }, n3);
          }
          static ofClass(e3, n3) {
            return t2.Locator.of({ $class: e3 }, n3);
          }
          static ofAttribute(e3, n3, a2) {
            const o2 = true === n3 || void 0 === n3 ? e3 : `${e3}=${n3}`;
            return t2.Locator.of({ $attribute: o2 }, a2);
          }
          static ofStyle(e3, n3, a2) {
            const o2 = void 0 === n3 ? e3 : `${e3}=${n3}`;
            return t2.Locator.of({ $style: o2 }, a2);
          }
          static ofSrc(e3, n3) {
            return t2.Locator.of({ $src: e3 }, n3);
          }
          static ofCss(e3, n3) {
            return t2.Locator.of({ $css: e3 }, n3);
          }
          static ofXpath(e3, n3) {
            return t2.Locator.of({ $xpath: e3 }, n3);
          }
          static matchesAll(e3, a2, o2) {
            return t2.Locator.of(
              { ...a2, $matches: n2.ensureArray(e3), type: "all" },
              o2
            );
          }
          static matchesAny(e3, a2, o2) {
            return t2.Locator.of(
              { ...a2, $matches: n2.ensureArray(e3), type: "any" },
              o2
            );
          }
          static matchesMost(e3, a2, o2) {
            return t2.Locator.of(
              { ...a2, $matches: n2.ensureArray(e3), type: "most" },
              o2
            );
          }
          static matchesNone(e3, a2, o2) {
            return t2.Locator.of(
              { ...a2, $matches: n2.ensureArray(e3), type: "none" },
              o2
            );
          }
        };
      })(), (() => {
        const { $engine: t2, $utils: n2 } = e;
        t2.Page = class {
          static instances = [];
          static get instance() {
            return this.instances.at(-1);
          }
          constructor(e2, n3 = {}) {
            if (!e2) throw new Error("context argument is mandatory");
            this._controller = new t2.PageController(this, e2, n3), this._timer = new t2.Timer(this), this._trapper = new t2.Trapper(this), this._screenshotter = new t2.Screenshotter(this), this._frame = new t2.Frame(this), this._context = e2, this._isClosed = false, t2.Page.instances.push(this);
          }
          get controller() {
            return this._controller;
          }
          get frame() {
            return this._frame;
          }
          get isClosed() {
            return this._isClosed;
          }
          get context() {
            return this._context;
          }
          get trapper() {
            return this._trapper;
          }
          get screenshotter() {
            return this._screenshotter;
          }
          get isConnected() {
            return this._controller.isConnected;
          }
          get mediumType() {
            return this._controller._medium.type;
          }
          get mediumId() {
            return this._controller._medium.id;
          }
          async goto(e2 = null, t3 = {}) {
            return this._timer.cleanup(), this._controller.goto(e2, t3);
          }
          async navigate(e2 = null, t3 = {}) {
            if (e2 === "back")
              return this._controller.sendRequest("back", null, t3);
            if (e2 === "forward")
              return this._controller.sendRequest("forward", null, t3);
            if (e2 === "reload") {
              const e3 = await this.url();
              return this.goto(e3, t3);
            }
            return this.goto(e2, t3);
          }
          async url(e2 = {}) {
            return this._controller.sendRequest("url", null, e2);
          }
          async favicons(e2 = {}) {
            return this._controller.sendRequest("favicons", [], e2);
          }
          async content(e2, n3 = {}) {
            typeof e2 == "string" ? e2 = t2.Locator.of(e2) : e2 instanceof t2.Element || e2 instanceof t2.Locator || (n3 = e2 || {}, e2 = null);
            const a2 = await this._controller.sendRequest("content", [e2], n3);
            return n3.textExtractRule ? t2.TextExtractRule.extract(a2, n3.textExtractRule) : a2;
          }
          async idle(e2 = {}) {
            return this._controller.sendRequest("idle", null, e2);
          }
          async fetch(e2, t3, n3 = {}) {
            return this._controller.sendRequest("fetch", [e2, t3], n3);
          }
          async crawl(e2, t3, n3 = {}) {
            if ((t3 = t3 || "render") === "render")
              return this._controller.sendRequest("crawl", [e2], n3);
            if (t3 === "fetch") return this._controller.crawlFetch(e2, "text", n3);
            if (t3 === "html") return this._controller.crawlFetch(e2, "html", n3);
            throw new Error(`Unknown crawl type: ${t3}`);
          }
          async query(e2, n3 = {}) {
            return typeof e2 == "string" ? e2 = t2.Locator.of(e2) : e2 instanceof t2.Locator || e2 instanceof t2.Element || (e2 = t2.Locator.of(e2)), this._controller.sendRequest("query", [e2], n3);
          }
          async queryAll(e2, t3 = {}) {
            return (t3 = { m: true, ...t3 }).multiple && delete t3.multiple, t3.mult && delete t3.mult, this.query(e2, t3);
          }
          async parse(e2, n3 = {}) {
            return typeof e2 == "string" ? e2 = t2.Locator.of(e2) : e2 instanceof t2.Element || e2 instanceof t2.Locator || (n3 = e2 || {}, e2 = null), this._controller.sendRequest("parse", [e2], n3);
          }
          async markdown(e2, n3 = {}) {
            return typeof e2 == "string" ? e2 = t2.Locator.of(e2) : e2 instanceof t2.Element || e2 instanceof t2.Locator || (n3 = e2 || {}, e2 = null), this._controller.sendRequest("markdown", [e2], n3);
          }
          async inspect(e2, n3 = {}) {
            if (typeof e2 == "string") e2 = t2.Locator.of(e2);
            else if (!(e2 instanceof t2.Element || e2 instanceof t2.Locator))
              throw new Error("loe must either be a locator, element or string");
            return this._controller.sendRequest("inspect", [e2], n3);
          }
          async click(e2, t3, n3 = {}) {
            return this._controller.sendRequest("click", [e2, t3], n3);
          }
          async scroll(e2, t3 = {}) {
            return this._controller.sendRequest("scroll", [e2], t3);
          }
          async grab(e2, t3, n3, a2, o2 = {}) {
            return this._controller.sendRequest("grab", [e2, t3, n3, a2], o2);
          }
          async evaluate(e2, t3, a2 = {}) {
            if (!e2) throw new Error("pageFunction must be specified");
            if (n2.is.function(e2) && (e2 = e2.toString()), !n2.is.string(e2))
              throw new Error(
                "pageFunction must be a function or function string"
              );
            return n2.is.nil(t3) ? t3 = [] : Array.isArray(t3) || (t3 = [t3]), this._controller.sendRequest("evaluate", [e2.toString(), t3], a2);
          }
          async paste(e2, t3, n3 = {}) {
            return this._controller.sendRequest("paste", [e2, t3], n3);
          }
          async wait(e2, a2 = {}) {
            if (typeof e2 == "number") {
              const t3 = Date.now();
              return new Promise(
                (n3) => setTimeout(() => n3({ durationMs: Date.now() - t3 }), e2)
              );
            }
            if (n2.is.nil(e2)) throw new Error("wait expects a condition argument");
            if (typeof e2 != "string" && typeof e2 != "function" && !(e2 instanceof t2.Locator) && e2.__$ht !== "function")
              throw new Error("wait condition argument type is unsupported");
            return typeof e2 == "function" && (e2 = { __$ht: "function", body: e2.toString() }), this._controller.sendRequest("wait", [e2], a2);
          }
          async title(e2 = {}) {
            return await this._controller.sendRequest("title", [], e2);
          }
          async selection(e2 = {}) {
            return await this._controller.sendRequest("selection", [], e2);
          }
          async input(e2, t3 = {}) {
            return await this._controller.sendRequest("input", [e2], t3);
          }
          async description(e2 = {}) {
            return await this._controller.sendRequest("description", [], e2);
          }
          async close() {
            this._isClosed || (this._isClosed = true, this._timer.cleanup(), await this._controller.cleanup(), t2.Page.instances = t2.Page.instances.filter((e2) => e2 !== this), this.emit("pageClosed", this));
          }
          async reload(e2 = {}) {
            return await this._controller.sendRequest("reload", null, e2);
          }
          async unregisterServiceWorker(e2 = {}) {
            return await this._controller.sendRequest(
              "unregisterServiceWorker",
              null,
              e2
            );
          }
          _throwIfClosed() {
            if (this._isClosed) throw new Error("page is closed");
          }
        };
      })(), (() => {
        const { $engine: t2, $bus: n2 } = e;
        t2.Screenshotter = class {
          constructor(e2) {
            this._controller = e2._controller, e2.on("screenshotter.fetch", this._onFetch.bind(this)), e2.on("screenshotter.svgToImage", this._svgToImage.bind(this));
          }
          async capture({ fullPage: e2 = true } = {}) {
            const t3 = await this._controller.sendRequest(
              "screenshotter.capture",
              [{ fullPage: e2 }]
            );
            try {
              return await (await fetch(t3)).blob();
            } catch {
              return null;
            }
          }
          async _onFetch({ id: e2, url: t3, method: n3 }) {
            let a2 = null;
            if (t3 !== "about:blank")
              try {
                const e3 = await fetch(t3);
                a2 = await e3[n3](), n3 === "blob" && (a2 = await new Promise((e4, t4) => {
                  const n4 = new FileReader();
                  n4.onerror = t4, n4.onload = () => e4(n4.result), n4.readAsDataURL(a2);
                }));
              } catch {
              }
            await this._controller.sendRequest("screenshotter.onFetchResponse", [
              { id: e2, data: a2 }
            ]);
          }
          async _svgToImage({
            svgCode: e2,
            width: t3,
            height: a2,
            dpr: o2,
            quality: i2
          }) {
            const r2 = await n2.send("offscreen.svgToImage", {
              svgCode: e2,
              width: t3,
              height: a2,
              dpr: o2,
              quality: i2
            });
            await this._controller.sendRequest(
              "screenshotter.onSvgToImageResponse",
              [r2]
            );
          }
        };
      })(), (() => {
        const { $engine: t2 } = e;
        t2.TextExtractRule = class {
          constructor({
            regex: e2,
            group: t3,
            prefix: n2,
            suffix: a2,
            inclusive: o2
          }) {
            if (e2) {
              if (n2 || a2 || o2)
                throw new Error(
                  "can not combine prefix / suffix / inclusive with regex / group"
                );
              this.regex = e2, this.group = t3;
            } else {
              if (!n2 && !a2)
                throw new Error(
                  "either regex or prefix / suffix pair must be supplied"
                );
              if (e2 || t3)
                throw new Error(
                  "can not combine prefix / suffix / inclusive with regex / group"
                );
              this.prefix = n2, this.suffix = a2, this.inclusive = o2;
            }
          }
          extract(e2) {
            return t2.TextExtractRule.extract(e2, this);
          }
          static extract(e2, t3) {
            if (e2 && typeof e2 == "string" && t3) {
              if (!t3.regex) {
                const { prefix: n2, suffix: a2, inclusive: o2 } = t3, i2 = [];
                let r2 = 0;
                do {
                  let t4 = n2 ? e2.indexOf(n2, r2) : 0;
                  if (-1 === t4) break;
                  n2 && !o2 && (t4 += n2 ? n2.length : 0);
                  let s2 = a2 ? e2.indexOf(a2, t4) : e2.length;
                  if (-1 === s2) break;
                  a2 && o2 && (s2 += a2 ? a2.length : 0), i2.push(e2.substring(t4, s2)), r2 = s2;
                } while (-1 !== r2 && r2 !== e2.length);
                return i2;
              }
              {
                const { regex: n2, group: a2 } = t3, o2 = (Array.isArray(n2) ? n2 : [n2]).map(
                  (e3) => e3.global ? e3 : RegExp(e3.source, e3.flags + "g")
                );
                for (let t4 = 0; t4 < o2.length; t4++) {
                  let n3 = e2.matchAll(o2[t4]);
                  if (n3)
                    return n3 = Array.from(n3), void 0 === a2 ? n3 : n3.map((e3) => {
                      if (typeof a2 == "number") return e3[a2 + 1];
                      if (typeof a2 == "string") return e3.groups[a2];
                      throw new Error(
                        "if specified, extractRule.group must either be a number or a string"
                      );
                    });
                }
              }
            }
          }
        };
      })(), (() => {
        const { $engine: t2 } = e;
        t2.Timer = class {
          constructor(e2) {
            this._controller = e2._controller, this._timeouts = {}, this._intervals = {}, e2.on("timer.setTimeout", this._handleMessage.bind(this)), e2.on("timer.clearTimeout", this._handleMessage.bind(this)), e2.on("timer.setInterval", this._handleMessage.bind(this)), e2.on("timer.clearInterval", this._handleMessage.bind(this));
          }
          cleanup() {
            Object.values(this._timeouts).forEach((e2) => clearTimeout(e2)), Object.values(this._intervals).forEach((e2) => clearInterval(e2)), this._timeouts = {}, this._intervals = {};
          }
          async _handleMessage(e2) {
            const { id: t3, time: n2, type: a2 } = e2;
            switch (a2) {
              case "timer.setTimeout":
                this._timeouts[t3] = setTimeout(() => this._onTimeout(t3), n2);
                break;
              case "timer.clearTimeout":
                clearTimeout(this._timeouts[t3]), delete this._timeouts[t3];
                break;
              case "timer.setInterval":
                this._intervals[t3] = setInterval(() => this._onInterval(t3), n2);
                break;
              case "timer.clearInterval":
                clearInterval(this._intervals[t3]), delete this._intervals[t3];
            }
          }
          _onTimeout(e2) {
            this._controller.isConnected && this._sendOnTimer(e2, "timeout");
          }
          _onInterval(e2) {
            this._controller.isConnected ? this._sendOnTimer(e2, "interval") : (clearInterval(this._intervals[e2]), delete this._intervals[e2]);
          }
          _sendOnTimer(e2, t3) {
            this._controller.sendRequest("timer.onTimer", [e2, t3], {
              noIdle: true,
              noTimeout: true,
              noReply: true
            });
          }
        };
      })(), (() => {
        const { $engine: t2, $bus: n2, $s: a2 } = e;
        t2.Trapper = class {
          constructor(e2) {
            this._page = e2, this._page.on(
              "trapper.targetLocked",
              this._onTargetLocked.bind(this)
            );
          }
          async _onTargetLocked({
            text: e2,
            element: t3,
            rect: o2,
            mouseX: i2,
            mouseY: r2
          }) {
            const s2 = this._page.mediumId, l2 = a2.tabs[s2], c2 = l2.creator.trapper.grabbing;
            if (["context", "step-click", "step-paste"].includes(c2)) {
              const a3 = { type: "element", container: t3, value: e2 || "Element" };
              return n2.send("trapper.targetLocked", s2, { text: e2, item: a3 }), l2.creator.trapper.grabbing = false, void (l2.creator.frame.open = true);
            }
            if (["monitor", "step-extract", "step-wait"].includes(c2)) {
              const n3 = await this._page.parse({ extract: true }), a3 = 50, s3 = [
                ...n3.reduce((e3, t4) => {
                  if (a3 && e3.length >= a3) return e3;
                  const n4 = t4.cr.top >= o2.top && t4.cr.left >= o2.left && t4.cr.right <= o2.right && t4.cr.bottom <= o2.bottom, s4 = r2 >= t4.cr.top && i2 >= t4.cr.left && i2 <= t4.cr.right && r2 <= t4.cr.bottom;
                  return (n4 || s4) && (t4.elements = t4.elements.map((e4) => e4.serialize()), t4.container = t4.container.serialize(), e3.push(t4)), e3;
                }, []),
                { type: "element", container: t3, value: e2 || "Element" }
              ];
              return l2.creator.trapper.data = s3, l2.creator.screen = "trapper", void (l2.creator.frame.open = true);
            }
            throw new Error(`Unknown trapper grabbing type: ${c2}`);
          }
        };
      })(), (() => {
        const { $engine: t2, $bus: n2 } = e;
        t2.controller = {
          async init() {
            await t2.hiddenWindowController.init(), await this.injectContentScripts(), n2.on("engine.executeJs", this._executeJs, this);
          },
          async injectContentScripts() {
            let e2 = await chrome.tabs.query({});
            e2 = e2.filter((e3) => t2.isAutomatable(e3.url)).filter((e3) => e3.status !== "unloaded"), await Promise.all(
              e2.map(async (e3) => {
                await this.isInjected(e3) || this.injectTo(e3);
              })
            );
          },
          async isInjected(e2) {
            const t3 = new Promise((e3) => setTimeout(() => e3(true), 500)), n3 = chrome.tabs.sendMessage(e2.id, { type: "request", command: "ping" }).then((e3) => e3 === "pong");
            return Promise.race([t3, n3]).catch(() => false);
          },
          injectTo(e2) {
            try {
              chrome.scripting.executeScript({
                target: { tabId: e2.id },
                files: ["/cs.js"]
              });
            } catch (e3) {
              t2.error(e3);
            }
          },
          async _executeJs(e2, t3) {
            await chrome.scripting.executeScript({
              target: { tabId: e2 },
              world: "MAIN",
              args: [t3],
              injectImmediately: true,
              func: (e3) => {
                try {
                  new Function(e3)();
                } catch (t4) {
                  if (t4.message.includes("Content Security Policy"))
                    try {
                      const t5 = document.createElement("div");
                      t5.setAttribute("onreset", e3), t5.dispatchEvent(new Event("reset"));
                    } catch (e4) {
                      console.error(e4);
                    }
                  else console.error(t4);
                }
              }
            });
          }
        };
      })(), (() => {
        const { $engine: t2, $idb: n2, $s: a2 } = e;
        t2.hiddenWindowController = {
          async init() {
            this._listenersAdded = false, this._autoMinimize = false, this._closeIfEmpty = true, this._windowId = await n2.get("$engine.hiddenWindowId", null);
          },
          get windowId() {
            return this._windowId;
          },
          async ensureWindow() {
            return this._ensureWindowPromise || (this._ensureWindowPromise = new Promise(async (e2) => {
              const t3 = await this._ensureWindow();
              this._ensureWindowPromise = null, e2(t3);
            })), this._ensureWindowPromise;
          },
          async _ensureWindow() {
            if (await this._addWindowListeners(), this._windowId) {
              if (await chrome.windows.get(this._windowId)) return this._windowId;
            }
            const e2 = { url: "https://harpa.ai/automation" }, t3 = (navigator.platform || "Win32").toLowerCase();
            t3.startsWith("mac") ? (e2.focused = false, e2.state = "minimized") : t3.startsWith("win") ? e2.focused = false : t3.startsWith("linux") && (e2.focused = false, e2.state = "minimized");
            const a3 = await chrome.windows.create(e2);
            return this._windowId = a3.id, await n2.set("$engine.hiddenWindowId", a3.id), chrome.windows.update(a3.id, { state: "minimized" }), chrome.tabs.update(a3.tabs[0].id, { pinned: true }), this._windowId;
          },
          async _addWindowListeners() {
            this._listenersAdded || (this._listenersAdded = true, chrome.windows.onFocusChanged.addListener((e2) => {
              this._autoMinimize && e2 === this._windowId && chrome.windows.update(e2, { state: "minimized" });
            }), chrome.tabs.onRemoved.addListener((e2, t3) => {
              t3.isWindowClosing || t3.windowId === this._windowId && a2.settings.autoCloseHiddenWindow && setTimeout(async () => {
                const e3 = await chrome.windows.get(this._windowId);
                if (!e3 || e3.focused) return;
                if (!((await chrome.tabs.query({ windowId: this._windowId })).filter((e4) => !e4.pinned).length > 0) && this._closeIfEmpty)
                  try {
                    await chrome.windows.remove(this._windowId);
                  } catch {
                  }
              }, 500);
            }));
          }
        };
      })(), (() => {
        const { $engine: t2 } = e, n2 = globalThis.__elPreload?.ipcRenderer;
        t2.ipcController = {
          setupListeners() {
            t2.PageController.IPC_MESSAGE_LISTENERS || (t2.PageController.IPC_MESSAGE_LISTENERS = {}, n2.on("engine.mediumMessage", (e2, n3) => {
              const a2 = t2.PageController.IPC_MESSAGE_LISTENERS[n3.frameName];
              a2 && a2(e2, n3);
            }));
          },
          addListener(e2, n3) {
            t2.PageController.IPC_MESSAGE_LISTENERS && (t2.PageController.IPC_MESSAGE_LISTENERS[e2] = (e3, t3) => n3({ data: t3 }));
          },
          dropListener(e2) {
            t2.PageController.IPC_MESSAGE_LISTENERS && delete t2.PageController.IPC_MESSAGE_LISTENERS[e2];
          },
          send: (e2, ...t3) => n2.send(e2, ...t3)
        };
      })(), (() => {
        const { $engine: t2, $utils: n2, $netRules: a2 } = e;
        t2.MediumTab = class {
          constructor(e2, t3, a3, o2) {
            if (t3 && !["tab", "pinned-tab", "hidden-tab"].includes(t3))
              throw new Error(`medium type ${t3} is not supported`);
            this._id = e2, this._type = t3, this._handleMessage = a3, this._pageOptions = o2, this._responseHeaders = [], this._autoCloseTab = n2.is.boolean(o2.autoCloseTab) ? o2.autoCloseTab : !this._id, this._isConnected = false, this._setupPromise = null, this._onTabRemoved = null;
          }
          get id() {
            return this._id;
          }
          get type() {
            return this._type;
          }
          get frameName() {
            return `${t2.Browser.ENGINE_NAME}:${this._id}`;
          }
          get config() {
            const e2 = {
              ...this._pageOptions,
              engineName: t2.Browser.ENGINE_NAME,
              frameName: this.frameName
            };
            return delete e2.autoCloseTab, e2;
          }
          get isConnected() {
            return this._isConnected;
          }
          async findTab() {
            const e2 = t2.hiddenWindowController.windowId;
            return (await chrome.tabs.query({})).filter(
              (t3) => !this.type || (this.type === "hidden-tab" ? t3.windowId === e2 : t3.windowId !== e2)
            ).find((e3) => e3.id === this._id);
          }
          _setup() {
            this._setupPromise = n2.createPromise(), t2.mediumsController.registerMedium(this), this._messageListener || (this._messageListener = (e2) => this._onMessage({ data: e2 }), chrome.runtime.onMessage.addListener(this._messageListener)), this._onTabRemoved || (this._onTabRemoved = (e2) => {
              this._id === e2 && this.cleanup();
            }, chrome.tabs.onRemoved.addListener(this._onTabRemoved));
          }
          async connect() {
            if (this.isConnected) return { status: "connected" };
            if (this._setupPromise) return this._setupPromise;
            this._setup();
            const e2 = await this.findTab();
            if (!e2)
              return this._setupPromise.reject(new Error("tab not found")), this._setupPromise;
            if (!t2.isAutomatable(e2.url))
              return this._isConnected = true, this._setupPromise.resolve({ status: "connected" });
            const n3 = "Could not establish connection. Receiving end does not exist.";
            try {
              if (await chrome.tabs.sendMessage(this._id, {
                type: "request",
                command: "ping"
              }) !== "pong")
                throw new Error(n3);
            } catch (e3) {
              e3.message === n3 && await chrome.tabs.reload(this._id);
            }
            chrome.tabs.sendMessage(this._id, {
              type: "request",
              command: "connect",
              config: this.config
            }), await this._setupPromise;
          }
          async navigate(e2) {
            this._setup();
            const n3 = this._type === "pinned-tab", a3 = this._id ? await chrome.tabs.query({}) : [], o2 = t2.hiddenWindowController.windowId;
            if (a3.filter(
              (e3) => !this.type || (this.type === "hidden-tab" ? e3.windowId === o2 : e3.windowId !== o2)
            ).find((e3) => e3.id === this._id))
              return await chrome.tabs.update(this._id, {
                url: this._wrapIntoHostUrl(e2),
                pinned: n3,
                active: false
              }), await this._patchTabRequests(this._id), await this._clearServiceWorker(e2), this._setupPromise;
            if (["pinned-tab", "tab"].includes(this._type)) {
              const t3 = await chrome.tabs.create({
                url: this._wrapIntoHostUrl(e2),
                pinned: n3,
                active: false
              });
              return this._id = t3.id, await this._patchTabRequests(this._id), await this._clearServiceWorker(e2), this._setupPromise;
            }
            {
              const n4 = await t2.hiddenWindowController.ensureWindow(), a4 = await chrome.tabs.create({
                url: this._wrapIntoHostUrl(e2),
                windowId: n4,
                active: false
              });
              return this._id = a4.id, await this._patchTabRequests(this._id), await this._clearServiceWorker(e2), this._setupPromise;
            }
          }
          _wrapIntoHostUrl(e2) {
            try {
              const t3 = btoa(JSON.stringify({ ...this.config, url: e2 }));
              return chrome.runtime.getURL(`/host.html?c=${t3}`);
            } catch (t3) {
              throw new Error(`unsupported URL format "${e2}"`);
            }
          }
          async _patchTabRequests(e2, t3 = false) {
            (this._responseHeaders.length !== 2 || t3) && this._responseHeaders.length !== 3 && (this._responseHeaders.length === 0 && (this._responseHeaders.push({
              header: "x-frame-options",
              operation: "remove"
            }), this._responseHeaders.push({
              header: "content-security-policy",
              operation: "remove"
            })), t3 && this._responseHeaders.length < 3 && this._responseHeaders.push({
              header: "access-control-allow-origin",
              operation: "remove"
            }), this._responseHeaders.length !== 0 && await a2.register({
              key: `engine-medium-${e2}`,
              condition: { urlFilter: "*://*/*", tabIds: [e2] },
              action: {
                type: "modifyHeaders",
                responseHeaders: this._responseHeaders
              }
            }));
          }
          async _clearServiceWorker(e2) {
            try {
              const t3 = new URL(e2).origin;
              await chrome.browsingData.remove(
                { origins: [t3] },
                { serviceWorkers: true }
              );
            } catch (e3) {
              t2.warn("failed removing serviceWorker", e3);
            }
          }
          _onMessage(e2) {
            const { data: t3 } = e2;
            if (t3?.frameName === this.frameName)
              return t3.type === "connected" ? this._onMessageConnected() : this.isConnected ? this._handleMessage(e2) : void 0;
          }
          _onMessageConnected() {
            if (!this._setupPromise) return;
            this._isConnected = true;
            const e2 = this._setupPromise;
            this._setupPromise = null, e2.resolve({ status: "connected" });
          }
          async sendRequest(e2) {
            const n3 = await this.findTab();
            if (!t2.isAutomatable(n3?.url)) {
              const t3 = { request: e2, type: "response", result: null };
              return this._handleMessage({ data: t3 });
            }
            const a3 = e2.command === "crawl";
            await this._patchTabRequests(this._id, a3);
            try {
              return await chrome.tabs.sendMessage(this._id, e2);
            } catch (t3) {
              const n4 = { request: e2, type: "response", result: null };
              return this._handleMessage({ data: n4 });
            }
          }
          async cleanup() {
            if (this._isConnected = false, this._messageListener && (chrome.runtime.onMessage.removeListener(this._messageListener), this._messageListener = null), this._onTabRemoved && (chrome.tabs.onRemoved.removeListener(this._onTabRemoved), this._onTabRemoved = null), this._id && this._autoCloseTab) {
              const e2 = this._id;
              this._id = null, await n2.chrome.tabs.remove(e2);
            }
            t2.mediumsController.unRegisterMedium(this), this._setupPromise && (this._setupPromise.resolve({ status: "page-closed" }), this._setupPromise = null);
          }
        };
      })(), (() => {
        const { $engine: t2 } = e;
        t2.mediumsController = {
          instances: null,
          init() {
            this._handleShouldConnect = this._handleShouldConnect.bind(this);
          },
          registerMedium(e2) {
            this.instances || (this.instances = /* @__PURE__ */ new Set(), chrome.runtime.onMessage.addListener(this._handleShouldConnect)), this.instances.add(e2);
          },
          unRegisterMedium(e2) {
            this.instances && (this.instances.delete(e2), this.instances.size === 0 && (this.instances = null, chrome.runtime.onMessage.removeListener(
              this._handleShouldConnect
            )));
          },
          _handleShouldConnect(e2, n2, a2) {
            if (e2.type !== "should-connect") return;
            if (e2.engineName !== t2.Browser.ENGINE_NAME) return;
            const o2 = n2.tab?.id;
            if (!o2) return;
            const i2 = Array.from(this.instances).find((e3) => e3.id === o2);
            return i2 ? (a2(i2.config), true) : void 0;
          }
        }, t2.mediumsController.init();
      })(), (() => {
        const { $engine: t2, $utils: n2 } = e, a2 = /* @__PURE__ */ new Set();
        t2.mixinClassShortcuts = (e2) => {
          (e2 = n2.ensureArray(e2)).forEach((e3) => {
            a2.has(e3) || (a2.add(e3), e3.prototype.Locator = t2.Locator, e3.prototype.Element = t2.Element);
          });
        };
      })(), (() => {
        const { $engine: t2, $utils: n2 } = e, a2 = /* @__PURE__ */ new Set();
        t2.mixinEventEmitter = (e2) => {
          (e2 = n2.ensureArray(e2)).forEach((e3) => {
            a2.has(e3) || (a2.add(e3), e3.prototype.on = function(e4, t3) {
              const n3 = this._eventListeners || (this._eventListeners = {});
              return n3[e4] ? n3[e4].push(t3) : n3[e4] = [t3], this;
            }, e3.prototype.off = function(e4, t3) {
              if (!e4) return this._eventListeners = {}, this;
              const n3 = this._eventListeners;
              return n3 && n3[e4] ? (n3[e4] = n3[e4].filter((e5) => e5 !== t3), this) : this;
            }, e3.prototype.emit = function(e4, ...t3) {
              const n3 = this._eventListeners;
              return n3 && n3[e4] ? (n3[e4].forEach((e5) => e5(...t3)), this) : this;
            });
          });
        };
      })(), (() => {
        const { $engine: t2, $utils: n2 } = e;
        t2.PageController = class e2 {
          static TOTAL_REQUESTS = 0;
          static IPC_MESSAGE_LISTENERS = null;
          constructor(e3, t3, n3 = {}) {
            this._page = e3, this._context = e3, this._pageOptions = { ...n3 }, delete this._pageOptions.mediumType, delete this._pageOptions.mediumId, this._medium = this._parseMedium(n3), this._requests = {};
          }
          _parseMedium(e3) {
            const n3 = this._pageOptions, a2 = (e4, t3) => e4 ? typeof e4 == "number" ? `${e4}px` : e4 : t3, o2 = a2(n3.width, "100%"), i2 = a2(n3.height, "100%");
            return new t2.MediumTab(
              e3.mediumId || null,
              e3.mediumType,
              this._handleMessage.bind(this),
              { ...n3, width: o2, height: i2 }
            );
          }
          get isConnected() {
            return this._medium.isConnected;
          }
          async goto(e3, a2 = {}) {
            if (!(e3 = this._normalizeUrl(e3)))
              return await this.cleanup(), { status: "not-navigated" };
            delete (a2 = {
              idle: a2.noIdle ? 0 : t2.idleDelay("goto"),
              timeout: a2.noTimeout ? 0 : 15e3,
              ...a2
            }).noIdle, delete a2.noTimeout;
            let o2 = n2.createPromise(), i2 = false, r2 = a2.timeout > 0 && setTimeout(() => {
              i2 = true;
              const e4 = new Error("timeout");
              a2.noThrow ? o2.resolve(e4) : o2.reject(e4);
            }, a2.timeout), s2 = null;
            return this._medium.navigate(e3).then(
              (e4) => (s2 = e4, i2 ? this._medium.cleanup() : a2.idle ? this.sendRequest("idle", null, {
                idle: a2.idle,
                noTimeout: true
              }) : void 0)
            ).then(() => {
              if (clearTimeout(r2), i2) return this._medium.cleanup();
              o2.resolve(s2);
            }).catch((e4) => {
              if (clearTimeout(r2), i2) return this._medium.cleanup();
              a2.noThrow ? o2.resolve(e4) : o2.reject(e4);
            }), o2;
          }
          async sendRequest(a2, o2 = null, i2 = {}) {
            try {
              await this._medium.connect();
            } catch (e3) {
              if (i2.noThrow) return e3;
              throw e3;
            }
            const r2 = String(e2.TOTAL_REQUESTS++);
            o2 = o2 || [], delete (i2 = {
              idle: i2.noIdle ? 0 : t2.idleDelay(a2),
              timeout: i2.noTimeout ? 0 : 3e4,
              ...i2
            }).noIdle, delete i2.noTimeout;
            const s2 = () => this._medium.sendRequest({
              type: "request",
              frameName: this._medium.frameName,
              params: t2.serializer.serialize(o2),
              options: t2.serializer.serialize(i2),
              requestId: r2,
              command: a2
            });
            if (i2.noReply) return s2();
            const l2 = n2.createPromise();
            let c2 = null;
            return i2.timeout && (c2 = setTimeout(() => {
              const e3 = new Error("timeout");
              i2.noThrow ? l2.resolve(e3) : l2.reject(e3);
            }, i2.timeout)), this._requests[r2] = {
              command: a2,
              params: o2,
              options: i2,
              onResponse: (e3) => {
                if (c2 && clearTimeout(c2), !e3.error)
                  return void l2.resolve(e3.result);
                const t3 = typeof e3.error == "string" ? new Error(e3.error) : e3.error;
                i2.noThrow ? l2.resolve(t3) : l2.reject(t3);
              }
            }, await s2(), l2;
          }
          async crawlFetch(e3, n3, a2) {
            n3 = n3 || "text";
            const { timeout: o2 } = a2;
            try {
              e3 = typeof e3 == "string" ? new URL(e3) : e3;
            } finally {
            }
            return !!["http:", "https:"].includes(e3.protocol) && !["chrome.google.com"].includes(e3.host) && !["chromewebstore.google.com"].includes(e3.host) && new Promise((a3) => {
              let i2 = setTimeout(() => {
                i2 = null, a3(null);
              }, o2);
              try {
                fetch(e3).then((e4) => {
                  if (e4.status < 200 || e4.status >= 400)
                    throw new Error("failed to fetch page");
                  return e4.text();
                }).then(async (e4) => {
                  if (i2)
                    return n3 === "text" && e4.match(/^\s*<!doctype html/i) && (e4 = await t2.htmlToText(e4)), e4;
                }).then((e4) => {
                  clearTimeout(i2), a3(e4);
                }).catch(() => {
                  clearTimeout(i2), a3(null);
                });
              } catch (e4) {
                clearTimeout(i2), a3(null);
              }
            });
          }
          async cleanup() {
            for (const e3 in this._requests)
              this._requests[e3].onResponse({ error: new Error("page-closed") });
            this._requests = {}, await this._medium.cleanup();
          }
          _handleMessage(e3) {
            if (!this.isConnected) return;
            const { data: n3 } = e3;
            if (n3.type !== "connected")
              if (n3.type !== "response") this._page.emit(n3.type, n3);
              else {
                const e4 = this._requests[n3.request?.requestId];
                if (!e4) return;
                delete this._requests[n3.request.requestId];
                const a2 = t2.serializer.deserialize(n3, this._page);
                e4.onResponse(a2);
              }
          }
          _normalizeUrl(e3) {
            return e3 ? e3.startsWith("http://") || e3.startsWith("https://") ? e3 : `https://${e3}` : e3;
          }
        };
      })(), (() => {
        const { $engine: t2 } = e;
        t2.serializer = {
          deserialize(e2, n2) {
            if (!e2) return e2;
            if (typeof e2 == "function") return e2;
            if (e2 instanceof Blob) return e2;
            if (Array.isArray(e2)) return e2.map((e3) => this.deserialize(e3, n2));
            if (typeof e2 == "object") {
              if (e2.__$ht === "error") {
                const t3 = new Error(e2.message);
                return Object.keys(e2).filter((e3) => e3 !== "__$ht").forEach((n3) => {
                  t3[n3] = e2[n3];
                }), t3;
              }
              if (e2.__$ht === "element") return t2.Element.deserialize(e2, n2);
              if (e2.__$ht === "locator") return t2.Locator.deserialize(e2, n2);
              if (e2.__$ht === "date") return new Date(e2.time);
              const a2 = {};
              return Object.keys(e2).forEach((t3) => {
                a2[t3] = this.deserialize(e2[t3], n2);
              }), a2;
            }
            return e2;
          },
          serialize(e2) {
            if (!e2) return e2;
            if (e2 instanceof Error) {
              const t3 = { __$ht: "error", message: e2.message, stack: e2.stack };
              return Object.keys(e2).forEach((n2) => {
                t3[n2] = e2[n2];
              }), t3;
            }
            if (e2 instanceof t2.Element) return e2.serialize();
            if (e2 instanceof t2.Locator) return e2.serialize();
            if (e2 instanceof Date) return { __$ht: "date", time: e2.getTime() };
            if (e2 instanceof Blob) return URL.createObjectURL(e2);
            if (Array.isArray(e2)) return e2.map((e3) => this.serialize(e3));
            if (typeof e2 == "object") {
              const t3 = {};
              return Object.keys(e2).forEach((n2) => {
                t3[n2] = this.serialize(e2[n2]);
              }), t3;
            }
            return e2;
          }
        };
      })(), (() => {
        const { $files: t2, $idb: n2, $utils: a2, $env: o2, $nanoid: i2, $s: r2 } = e;
        t2.controller = {
          async init() {
            t2.get = this.get.bind(this), t2.has = this.has.bind(this), t2.url = this.url.bind(this), t2.save = this.save.bind(this), t2.emptyImage = await this._createEmptyImage(), this._cache = {}, this._generateId = this._createIdGenerator(), this._initCleanup();
          },
          get: async (e2, t3 = null) => (await n2.files.get(e2))?.data || t3,
          has: async (e2) => await n2.files.has(e2),
          async url(e2, t3 = a2.time.MINUTE) {
            if (!this._cache[e2]) {
              this._cache[e2] = a2.createPromise();
              const n4 = await this.get(e2), o3 = n4 ? await a2.objectUrl.create(n4) : null;
              this._cache[e2].resolve({ url: o3, ttl: t3, timeout: null });
            }
            const n3 = await this._cache[e2];
            return clearTimeout(n3.timeout), n3.timeout = setTimeout(async () => {
              delete this._cache[e2], await a2.objectUrl.revoke(n3.url);
            }, t3), n3.url;
          },
          async save(e2, t3 = "") {
            t3 && (t3 += ":");
            const a3 = `${t3}file-${this._generateId()}`;
            return await n2.files.set(a3, { createdAt: /* @__PURE__ */ new Date(), data: e2 }), a3;
          },
          _createIdGenerator: () => i2.customAlphabet(
            "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",
            12
          ),
          _initCleanup() {
            o2.is.bg && a2.chrome.alarms.run(() => this._cleanup(), {
              name: "files.cleanup",
              periodInMinutes: 60,
              immediately: true
            });
          },
          async _cleanup(e2 = false) {
            const o3 = JSON.stringify(r2), i3 = await n2.files.keys(), s2 = Date.now() - a2.time.HOUR, l2 = [];
            for (const e3 of i3) o3.includes(e3) || l2.push(e3);
            for (const a3 of l2) {
              const o4 = await n2.files.get(a3);
              o4 && (!e2 && o4.createdAt.getTime() > s2 || (await n2.files.remove(a3), t2.logDev(`\u{1F5D1}\uFE0F ${a3}`)));
            }
          },
          _createEmptyImage: async () => await fetch(
            "data:image/webp;base64,UklGRgYCAABXRUJQVlA4WAoAAAAgAAAAAAAAAAAASUNDUMgBAAAAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADZWUDggGAAAADABAJ0BKgEAAQABQCYlpAADcAD+/PQAAA=="
          ).then((e2) => e2.blob())
        };
      })(), (() => {
        const {
          $grid: t2,
          $dialog: n2,
          $chat: a2,
          $commands: o2,
          $browser: i2,
          $utils: r2,
          $harpa: s2,
          $bus: l2,
          $env: c2,
          $startup: u2,
          $s: p2,
          $feature: d2,
          $mobx: m2
        } = e;
        t2.controller = {
          init() {
            l2.on("grid.sendTestRequest", this.sendTestRequest.bind(this)), l2.on("grid.loadApiKeys", this.loadApiKeys.bind(this)), l2.on("grid.createApiKey", this.createApiKey.bind(this)), l2.on("grid.renameApiKey", this.renameApiKey.bind(this)), l2.on("grid.deleteApiKey", this.deleteApiKey.bind(this)), l2.on("grid.resetNodeId", this.resetNodeId.bind(this)), l2.on("grid.ws.message", this._onWsMessage.bind(this)), this.maskKeysAfter = 3 * r2.time.HOUR, this._maskApiKeys = this._maskApiKeys.bind(this), this._scheduleMaskApiKeys(), t2.tabController.init(), this._updateWebSocket = this._updateWebSocket.bind(this), u2.controller.onReady.then(this._onReady.bind(this));
          },
          async _onWsMessage(e2) {
            if (!r2.is.object(e2) || !e2.action) return;
            let { action: s3, params: c3, spaceId: u3 } = e2, d3 = p2.billing.spaceById(u3);
            if (!d3 && (await l2.send("billing.updateAccount", true), d3 = p2.billing.spaceById(u3), !d3))
              return;
            p2.journal.logGridAction(s3);
            const m3 = p2.billing.spaceId;
            p2.billing.switchToSpace(d3.id);
            const h = { tabId: null, chat: null };
            try {
              if (s3 === "ping") await this._replyTo(e2, { pong: true });
              else if (s3 === "scrape") {
                const n3 = (c3.url || "").trim();
                if (!n3 || !r2.is.string(n3))
                  return await this._replyTo(e2, {
                    error: 'Please provide a "url" parameter'
                  });
                const a3 = r2.ensureArray(c3.grab || []), o3 = await t2.tabController.ensureJobTab(h);
                await t2.tabController.navigate(n3, { tabId: o3 });
                const s4 = await i2.controller.connectTab(o3), [l3, u4, p3, d4, m4] = await Promise.all([
                  s4.url(),
                  s4.title(),
                  s4.description(),
                  s4.markdown(),
                  Promise.all(
                    a3.map(async (e3, t3) => {
                      const n4 = r2.is.string(e3) ? e3 : e3.selector || null, a4 = e3.take || "innerText", o4 = e3.at || "first", i3 = e3.by || "auto";
                      return {
                        label: e3.label || `grab${t3 + 1}`,
                        value: await s4.grab(n4, a4, o4, i3)
                      };
                    })
                  )
                ]), g = { url: l3, title: u4, description: p3, markdown: d4, grab: {} };
                m4.forEach((e3) => {
                  g.grab[e3.label] = e3.value;
                }), await this._replyTo(e2, g);
              } else if (s3 === "command") {
                const o3 = (c3.url || "https://harpa.ai/blank").trim();
                if (!o3 || !r2.is.string(o3))
                  return await this._replyTo(e2, {
                    error: 'Please provide a starting page "url" parameter'
                  });
                const i3 = (c3.name || "").trim();
                if (!i3 || !r2.is.string(i3))
                  return await this._replyTo(e2, {
                    error: 'Please provide a command "name" parameter'
                  });
                const s4 = r2.ensureArray(c3.inputs || []).map((e3) => String(e3 || "").trim());
                if (s4 && !r2.is.array(s4))
                  return await this._replyTo(e2, {
                    error: 'Command "inputs" parameter must be an array'
                  });
                let l3 = p2.commands.getCommandDeclaration(i3);
                if (!l3)
                  return await this._replyTo(e2, {
                    error: `Command "${i3}" not found`
                  });
                s4 && (l3 = { ...l3, inputs: s4 });
                const d4 = String(c3.resultParam || "message").trim();
                let m4 = Number(e2.timeout) || 300 * r2.time.SECOND;
                const g = this._resolveAiConnection(c3.connection, u3), f = await t2.tabController.ensureJobTab(h);
                await t2.tabController.navigate(o3, { tabId: f });
                const y = `Remote Controlled: ${i3}`;
                h.chat = await t2.tabController.ensureJobChat(f, g, y);
                const b = n2.commandController.start(h.chat.id, f, l3, {
                  silentMode: true
                }), w = r2.createPromise();
                m4 = m4 - (Date.now() - e2.createdMs) - 1e3;
                let v = setTimeout(async () => {
                  v = null, n2.commandController.removeCommandStopListener(b);
                  const e3 = d4 ? await n2.commandController.getParam(h.chat.id, f, d4) : `Command did not finish in <b>${m4}</b> ms`;
                  w.resolve(e3), await a2.actionsController.stop(h.chat.id);
                }, m4);
                n2.commandController.addCommandStopListener(b, async () => {
                  if (!v) return;
                  clearTimeout(v);
                  const e3 = d4 ? await n2.commandController.getParam(h.chat.id, f, d4) : "OK", t3 = Number.isNaN(Number(e3)) ? e3 : Number(e3);
                  w.resolve(t3);
                });
                const k = await w;
                await this._replyTo(e2, k);
              } else if (s3 === "prompt") {
                const n3 = (c3.url || "https://harpa.ai/blank").trim();
                if (!n3 || !r2.is.string(n3))
                  return await this._replyTo(e2, {
                    error: 'Please provide a starting page "url" parameter'
                  });
                const o3 = (c3.prompt || "").trim();
                if (!o3 || !r2.is.string(o3))
                  return await this._replyTo(e2, {
                    error: 'Please provide a "prompt" parameter'
                  });
                const i3 = this._resolveAiConnection(c3.connection, u3), s4 = await t2.tabController.ensureJobTab(h);
                await t2.tabController.navigate(n3, { tabId: s4 });
                const l3 = "GRID: Run AI Prompt";
                h.chat = await t2.tabController.ensureJobChat(
                  s4,
                  i3,
                  "GRID: Run AI Prompt"
                );
                const p3 = this._waitForChatResponse(h.chat, e2.timeout || 3e5);
                await a2.actionsController.askChat(h.chat.id, s4, o3, {
                  silent: true
                });
                const d4 = await p3;
                await this._replyTo(e2, d4.result);
              } else if (s3 === "serp") {
                const t3 = (c3.query || "").trim();
                if (!t3 || !r2.is.string(t3))
                  return await this._replyTo(e2, {
                    error: 'Please provide a SERP "query" parameter'
                  });
                const n3 = await a2.paramSerp({ prompt: t3, crawl: "none" }), i3 = {
                  text: n3,
                  prefix: o2.extractSerpPrefix(n3),
                  links: o2.extractSerpLinks(n3)
                };
                await this._replyTo(e2, i3);
              } else {
                const t3 = `Unsupported action type: ${s3}, one of [ping, scrape, serp, command, prompt] expected`;
                await this._replyTo(e2, { error: t3 });
              }
            } finally {
              t2.tabController.removeJobTab(h), t2.tabController.removeJobChat(h);
            }
            p2.billing.spaceId === u3 && p2.billing.spaceId !== m3 && p2.billing.switchToSpace(d3.id);
          },
          async _replyTo(e2, n3) {
            const a3 = {
              requestId: e2.requestId,
              isTest: e2.isTest,
              createdMs: e2.createdMs,
              resolvedMs: Date.now(),
              spaceId: e2.spaceId,
              nodeId: p2.grid.nodeId,
              action: e2.action,
              params: e2.params,
              result: n3
            };
            if (e2.timeout && await l2.send("grid.ws.send", a3), e2.resultsWebhook)
              try {
                await fetch(e2.resultsWebhook, {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify(a3)
                });
              } catch (n4) {
                t2.warn(`failed to send response to ${e2.resultsWebhook}`, n4);
              }
            {
              const { action: t3, resultsWebhook: o3 } = e2, i3 = (r2.json.stringify(n3) || "")?.length, s3 = (a3.resolvedMs - a3.createdMs) / 1e3;
              p2.journal.logGridActionResult(t3, i3, s3, o3);
            }
          },
          _onReady() {
            d2.config.grid?.enabled && m2.reaction(
              () => [p2.billing.jwt, p2.grid.nodeId, p2.grid.enabledFor],
              this._updateWebSocket,
              { fireImmediately: true }
            );
          },
          _updateWebSocket() {
            const e2 = p2.billing.jwt, t3 = p2.grid.nodeId, n3 = p2.grid.enabledForAvailableSpaces, a3 = p2.grid.uuid;
            let o3 = [];
            e2 && n3.forEach((e3) => {
              o3.push(`hrp:s:${e3}`), t3 && o3.push(`hrp:s:${e3}:${t3}`);
            }), l2.send("grid.ws.connect", {
              jwt: e2,
              nodeId: t3,
              spaceIds: n3,
              uuid: a3,
              channels: o3
            });
          },
          _scheduleMaskApiKeys() {
            r2.chrome.alarms.run(this._maskApiKeys, {
              name: "creator.grid.maskApiKeys",
              periodInMinutes: 15,
              delayInMinutes: 1
            });
          },
          _maskApiKeys() {
            if (!p2.grid.apiKeys.length) return;
            const e2 = Date.now();
            p2.transaction((t3) => {
              t3.grid.apiKeys.filter((e3) => !e3.masked).filter((t4) => t4.createdAt + this.maskKeysAfter < e2).forEach((e3) => {
                e3.masked = true, e3.value = e3.value.slice(0, 8) + "\u2026";
              });
            });
          },
          async sendTestRequest(e2) {
            if (!p2.grid.apiKeys.length)
              return {
                status: "error",
                message: "No API keys. Please click a button below to create your HARPA API KEY."
              };
            const n3 = p2.grid.unmaskedApiKey?.value;
            if (!n3)
              return {
                status: "error",
                message: "All keys are masked. API key values are stored locally for a limited time only. Please create a new key."
              };
            try {
              const a3 = {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  Authorization: `Bearer ${n3}`,
                  "X-Is-Test": "true"
                },
                body: JSON.stringify(e2)
              };
              let o3 = await fetch(`${c2.apiUrl}/grid`, a3);
              return o3 = await o3.json(), o3.status !== "ok" ? { status: "error", message: `Request failed: ${o3.message}` } : (t2.log("Test request result:", o3), {
                status: "success",
                message: "Success. Result is copied to Clipboard.",
                result: o3
              });
            } catch (e3) {
              return { status: "error", message: `Request failed: ${e3.message}` };
            }
          },
          async loadApiKeys() {
            let e2;
            try {
              e2 = await s2.api.listGridKeys();
            } catch (e3) {
              return {
                status: "error",
                message: `Failed to load API keys: ${e3.message}`
              };
            }
            return p2.grid.apiKeys = e2?.keys || [], { status: "success", message: "API keys loaded." };
          },
          async createApiKey() {
            let e2;
            try {
              e2 = await s2.api.createGridKey();
            } catch (e3) {
              return {
                status: "error",
                message: `Failed to create API key: ${e3.message}`
              };
            }
            return e2.status !== "ok" ? {
              status: "error",
              message: `Failed to create API key: ${e2.message}`
            } : e2.created?.value ? (p2.grid.apiKeys.push(e2.created), setTimeout(this._maskApiKeys, this.maskKeysAfter), { status: "success", key: e2.created }) : {
              status: "error",
              message: "Failed to create API key: no key returned"
            };
          },
          async renameApiKey(e2, t3) {
            let n3;
            try {
              n3 = await s2.api.renameApiKey(e2, t3);
            } catch (e3) {
              return {
                status: "error",
                message: `Failed to rename API key: ${e3.message}`
              };
            }
            return n3.status !== "ok" ? {
              status: "error",
              message: `Failed to rename API key: ${n3.message}`
            } : (p2.transaction((n4) => {
              const a3 = n4.grid.apiKeys.find((t4) => t4.id === e2);
              a3 && (a3.name = t3);
            }), { status: "success", message: "API key renamed." });
          },
          async deleteApiKey(e2) {
            let t3;
            p2.transaction((t4) => {
              t4.grid.apiKeys = t4.grid.apiKeys.filter((t5) => t5.id !== e2);
            });
            try {
              t3 = await s2.api.deleteGridKey(e2);
            } catch (e3) {
              return {
                status: "error",
                message: `Failed to delete API key: ${e3.message}`
              };
            }
            return t3.status !== "ok" ? {
              status: "error",
              message: `Failed to delete API key: ${t3.message}`
            } : { status: "success", message: "API key deleted." };
          },
          resetNodeId() {
            p2.grid.nodeId = r2.id.pico();
          },
          async _waitForChatResponse(e2, t3 = 3e5) {
            const n3 = r2.createPromise(), a3 = setTimeout(() => {
              n3.resolve({ error: "AI response timeout", chatId: e2.id });
            }, t3), o3 = e2.messages.filter((e3) => e3.type === "answer").length, i3 = m2.reaction(
              () => {
                const t4 = e2.messages.filter((e3) => e3.type === "answer"), n4 = t4[t4.length - 1];
                return { count: t4.length, done: n4?.done };
              },
              ({ count: t4, done: r3 }) => {
                if (t4 > o3 && r3) {
                  clearTimeout(a3), i3();
                  const t5 = e2.lastAnswer?.text || "";
                  n3.resolve({ result: t5, chatId: e2.id });
                }
              }
            );
            return n3;
          },
          _resolveAiConnection(e2, t3) {
            let n3 = null;
            const a3 = (e2 || "").trim();
            a3 ? (n3 = p2.ai.connections.get(a3), n3 || (n3 = p2.ai.connections.find(
              (e3) => (e3.label || "").toLowerCase() === a3.toLowerCase()
            ))) : n3 = p2.ai.connections.get(p2.settings.connectionIds[t3]);
            let o3 = n3?.id;
            return n3 || (o3 = p2.ai.connections.find((e3) => e3.type === "cloudgpt").id), o3;
          }
        };
      })(), (() => {
        const { $grid: t2, $s: n2, $store: a2, $chat: o2, $chrome: i2, $utils: r2 } = e;
        t2.tabController = {
          init() {
            this._cleanupHiddenWindows();
          },
          async _cleanupHiddenWindows() {
            let e2 = await chrome.windows.getAll({});
            e2 = e2.filter((e3) => e3.state === "minimized" && e3.type === "normal");
            const t3 = await chrome.tabs.query({});
            for (const n3 of e2) {
              t3.filter((e3) => e3.windowId === n3.id).length <= 1 && await chrome.windows.remove(n3.id);
            }
          },
          async ensureJobTab(e2) {
            if (e2.tabId) {
              const t4 = await chrome.tabs.getTab(e2.tabId);
              if (t4) return t4.id;
            }
            const t3 = {}, n3 = (navigator.platform || "Win32").toLowerCase();
            n3.startsWith("mac") ? (t3.focused = false, t3.state = "minimized") : n3.startsWith("win") ? t3.focused = false : n3.startsWith("linux") && (t3.focused = false, t3.state = "minimized");
            const a3 = await chrome.windows.create(t3);
            return e2.tabId = a3.tabs[0].id, chrome.windows.update(a3.id, { state: "minimized" }), chrome.tabs.update(a3.tabs[0].id, { pinned: true }), e2.tabId;
          },
          async ensureJobChat(e2, t3, o3 = "GRID") {
            if (!e2) return;
            n2.tabs[e2] || (n2.tabs[e2] = a2.template.tab(e2));
            const i3 = n2.tabs[e2];
            i3.screen = "chat";
            const r3 = i3.createChat({ emoji: "\u{1F916}", title: o3, connectionId: t3 });
            return i3.chatId !== r3.id && (i3.chatId = r3.id), t3 && t3 !== r3.connectionId && (r3.connectionId = t3), r3;
          },
          removeJobTab(e2) {
            e2.tabId && chrome.tabs.remove(e2.tabId);
          },
          removeJobChat(e2) {
            e2.chat?.id && o2.actionsController.delete(e2.chat?.id);
          },
          async navigate(e2, { tabId: t3, fallback: n3 } = {}) {
            try {
              const n4 = t3 ? await this.getTab(t3) : await this.getActiveTab();
              if (!n4) throw new Error(`${t3 || "active"} tab not found`);
              return t3 = n4.id, e2 && !this._sameUrl(e2, n4.url) && await this._navigateAndWait(t3, e2), n4;
            } catch (e3) {
              if (i2.error(e3), void 0 !== n3) return n3;
              throw e3;
            }
          },
          getTab: async (e2) => await chrome.tabs.get(e2),
          getActiveTab: async () => (await chrome.tabs.query({ active: true, currentWindow: true }))?.[0],
          async _navigateAndWait(e2, t3, { timeout: n3 = 2500, delay: a3 = 2500 } = {}) {
            let o3;
            await chrome.tabs.update(e2, { active: true }), await r2.sleep(100), await chrome.tabs.update(e2, { url: t3 }), t3 === "https://harpa.ai/blank" && a3 === 2500 && (a3 = 0);
            const i3 = new Promise((t4) => {
              o3 = (n4, a4) => {
                n4 === e2 && a4.status === "complete" && (chrome.tabs.onUpdated.removeListener(o3), t4());
              }, chrome.tabs.onUpdated.addListener(o3);
            }), s2 = new Promise(
              (e3) => setTimeout(() => {
                chrome.tabs.onUpdated.removeListener(o3), e3();
              }, n3)
            );
            await Promise.race([i3, s2]), await r2.sleep(a3);
          },
          _sameUrl: (e2, t3) => (e2 = r2.url.parse(e2), t3 = r2.url.parse(t3), e2?.domain === t3?.domain && e2?.port === t3?.port && e2?.path === t3?.path && e2?.search === t3?.search)
        };
      })(), (() => {
        const { $harpa: t2, $env: n2, $s: a2 } = e;
        async function o2(e2, t3) {
          let o3 = e2.split(" ");
          const i2 = o3.includes("auth");
          i2 && (o3 = o3.filter((e3) => e3 !== "auth"));
          const r2 = o3.at(0), s2 = o3.at(-1);
          e2 = `${n2.apiUrl}${s2}`;
          const l2 = { method: r2, headers: {} };
          i2 && (l2.headers.Authorization = `Bearer ${a2.billing.jwt}`), t3 && (l2.headers["Content-Type"] = "application/json", l2.body = JSON.stringify(t3));
          try {
            const t4 = await fetch(e2, l2);
            if (!t4.ok) throw new Error(`Failed fetching ${e2}`);
            return await t4.json();
          } catch (t4) {
            throw new Error(`Failed fetching ${e2}`);
          }
        }
        t2.api = {
          get spaceId() {
            return a2.billing.spaceId;
          },
          action: async (e2) => o2("POST /action", e2),
          feedback: async (e2, t3, n3) => o2("POST /feedback", {
            source: "app:rate-us",
            message: e2,
            email: t3,
            rated: n3
          }),
          async listGridKeys() {
            return o2(`GET auth /grid/spaces/${this.spaceId}/keys/`);
          },
          async createGridKey() {
            return o2(`POST auth /grid/spaces/${this.spaceId}/keys`);
          },
          async renameApiKey(e2, t3) {
            const n3 = { name: t3 };
            return o2(`PATCH auth /grid/spaces/${this.spaceId}/keys/${e2}`, n3);
          },
          async deleteGridKey(e2) {
            return o2(`DELETE auth /grid/spaces/${this.spaceId}/keys/${e2}`);
          }
        };
      })(), (() => {
        const { $harpa: t2, $browser: n2, $env: a2 } = e;
        t2.controller = {
          init() {
            this.matches = [
              { url: "https://harpa.ai/welcome" },
              { url: "https://app.harpa.ai" },
              { url: "https://harpa.ai/app" }
            ], a2.is.development && (this.matches.push({ url: "http://localhost:3000/welcome" }), this.matches.push({ url: "http://localhost:3000/app" })), this._autoOpenApp();
          },
          _autoOpenApp() {
            chrome.tabs.onCreated.addListener(
              (e2) => this._onUrlChange(e2.url, e2.id)
            ), chrome.tabs.onUpdated.addListener((e2, t3, n3) => {
              t3.status === "complete" ? this._onUrlChange(n3.url, e2) : this._onUrlChange(t3.url, e2);
            });
          },
          async _onUrlChange(e2, t3) {
            if (!e2) return;
            this.matches.find((t4) => e2.startsWith(t4.url)) && await n2.controller.showFrame(t3);
          }
        };
      })(), (() => {
        const { $hframe: t2, $tabs: n2, $task: a2, $mobx: o2, $s: i2 } = e;
        t2.controller = {
          init() {
            this._hframeTabs = /* @__PURE__ */ new Set(), this._passTasksToTabs(), this._cleanupHFrameTabs(), this._replyHFrameState();
          },
          _passTasksToTabs() {
            const e2 = (e3) => {
              Array.from(this._hframeTabs).forEach(
                (t3) => chrome.tabs.sendMessage(t3, { type: "hframe.setState", state: e3 })
              );
            };
            o2.reaction(
              () => t2.proxy.tasks,
              (t3) => e2({ tasks: t3 })
            ), o2.reaction(
              () => i2.settings.autoCloseHiddenWindow,
              (t3) => e2({ autoCloseHiddenWindow: t3 })
            );
          },
          _cleanupHFrameTabs() {
            chrome.tabs.onRemoved.addListener((e2) => this._hframeTabs.delete(e2));
          },
          _replyHFrameState() {
            chrome.runtime.onMessage.addListener((e2, t3) => {
              const n3 = t3?.tab?.id;
              if (!n3) return;
              const a3 = e2?.type || "";
              if (!a3.startsWith("hframe.")) return;
              const o3 = this[a3.split(".")[1]];
              o3 && o3.bind(this)(n3, e2);
            });
          },
          fetchState(e2) {
            this._hframeTabs.add(e2), chrome.tabs.sendMessage(e2, {
              type: "hframe.setState",
              state: {
                initialized: true,
                appInstalled: true,
                tasks: t2.proxy.tasks,
                autoCloseHiddenWindow: i2.settings.autoCloseHiddenWindow
              }
            });
          },
          async hide(e2) {
            const t3 = await this._windowForTabId(e2);
            t3 && await chrome.windows.update(t3, { state: "minimized" });
          },
          async close(e2) {
            const t3 = await this._windowForTabId(e2);
            t3 && await chrome.windows.remove(t3);
          },
          async taskClick(e2, t3) {
            const a3 = await n2.openAppTab("dashboard");
            setTimeout(
              () => {
                i2.redactor.show = true, i2.redactor.taskId = t3.taskId;
              },
              a3 ? 0 : 150
            );
          },
          async disconnect(e2, n3) {
            const o3 = n3.taskId, r2 = i2.tasks.get(o3);
            if (r2)
              try {
                await chrome.tabs.remove(r2.inputs.schedule.mediumId);
              } catch {
              }
            a2.proxy.updateTask(o3, (e3) => {
              e3.inputs.schedule.mediumType = "tab";
            }), t2.proxy.tasks.length === 0 && await chrome.tabs.remove(e2);
          },
          async disconnectAll(e2) {
            for (const e3 of i2.tasks)
              if (e3.inputs.schedule.mediumType === "hidden-tab")
                try {
                  await chrome.tabs.remove(e3.inputs.schedule.mediumId);
                } catch {
                }
            i2.transaction(() => {
              i2.tasks.filter((e3) => e3.inputs.schedule.mediumType === "hidden-tab").forEach((e3) => e3.inputs.schedule.mediumType = "tab");
            }), await chrome.tabs.remove(e2);
          },
          async autoCloseClick() {
            i2.settings.autoCloseHiddenWindow = !i2.settings.autoCloseHiddenWindow;
          },
          _windowForTabId: async (e2) => (await chrome.tabs.query({})).find((t3) => t3.id === e2)?.windowId
        };
      })(), (() => {
        const { $hframe: t2, $task: n2, $dashboard: a2, $mobx: o2, $s: i2 } = e;
        t2.proxy = o2.observable({
          get tasks() {
            return i2.tasks.filter((e2) => e2.inputs.schedule?.mediumType === "hidden-tab").map((e2) => ({
              id: e2.id,
              name: e2.name || n2.proxy.recipeTitle(e2),
              favicon: a2.proxy.taskFavicon(e2),
              url: (e2.inputs.page?.url || "").split("://")[1]
            }));
          }
        });
      })(), (() => {
        const { $install: t2, $welcome: n2, $analytics: a2, $env: o2, $s: i2 } = e;
        t2.controller = {
          init() {
            i2.installedMs ? i2.updatedVersion === o2.version || this.onUpdated() : this.onInstalled();
          },
          onInstalled() {
            i2.installedMs = Date.now(), i2.updatedVersion = o2.version, a2.controller.sendInstall(), n2.controller.onInstalled();
          },
          onUpdated() {
            const e2 = i2.updatedVersion, t3 = o2.version;
            i2.updatedVersion = o2.version, n2.controller.onUpdated(e2, t3);
          }
        };
      })(), (() => {
        const { $library: t2, $utils: n2, $bus: a2, $task: o2, $s: i2 } = e;
        t2.cleanupDomainsJob = {
          init() {
            a2.on("library.cleanupDomains", this._perform), n2.chrome.alarms.run(this._perform, {
              name: "library.cleanupDomains",
              delayInMinutes: 1,
              periodInMinutes: n2.time.DAY / n2.time.MINUTE
            });
          },
          _perform() {
            const e2 = i2.library.domains, t3 = /* @__PURE__ */ new Set([...i2.tasks.map((e3) => o2.proxy.taskDomain(e3))]), n3 = {};
            let a3 = false;
            Object.keys(e2).forEach((e3) => {
              t3.has(e3) ? n3[e3] = i2.library.domains[e3] : a3 = true;
            }), a3 && (i2.library.domains = n3);
          }
        };
      })(), (() => {
        const { $library: t2 } = e;
        t2.controller = {
          init() {
            t2.cleanupDomainsJob.init();
          }
        };
      })(), (() => {
        const { $journal: t2, $utils: n2, $s: a2 } = e;
        t2.controller = {
          init() {
            n2.chrome.alarms.run(this._dropOldEvents, {
              name: "journal.dropOldEvents",
              delayInMinutes: 1,
              periodInMinutes: n2.time.HOUR / n2.time.MINUTE
            });
          },
          _dropOldEvents() {
            a2.journal.dropOldEvents(1e4);
          }
        };
      })(), (() => {
        const { $memory: t2 } = e;
        t2.controller = { init() {
        } };
      })(), (() => {
        const { $netRules: t2, $utils: n2, $bus: a2 } = e;
        t2.controller = {
          async init() {
            t2.register = this._register.bind(this), t2.unregister = this._unregister.bind(this), this._lastRuleId = 1, this._rules = [], a2.on("netRules.register", this._register, this), a2.on("netRules.unregister", this._unregister, this), await this._dropAllSessionRules(), this._cleanupTabRulesPeriodically();
          },
          async _register(e2) {
            const t3 = Array.isArray(e2);
            e2 = (e2 = n2.ensureArray(e2).map((e3) => {
              const t4 = this._lastRuleId;
              return this._lastRuleId += 1, {
                id: t4,
                priority: 1,
                ...e3,
                key: e3.key || String(t4),
                condition: {
                  resourceTypes: [
                    "main_frame",
                    "sub_frame",
                    "stylesheet",
                    "script",
                    "image",
                    "font",
                    "object",
                    "xmlhttprequest",
                    "ping",
                    "csp_report",
                    "media",
                    "websocket",
                    "webtransport",
                    "webbundle",
                    "other"
                  ],
                  ...e3.condition
                }
              };
            })).filter((t4, n3) => n3 === e2.findLastIndex((e3) => e3.key === t4.key));
            const a3 = this._rules.length > 0 ? new Set(e2.map((e3) => e3.key)) : null, o2 = this._rules.filter((e3) => a3.has(e3.key)).map((e3) => e3.id);
            this._rules.push(
              ...e2.map((e3) => ({
                id: e3.id,
                key: e3.key,
                tabIds: e3.condition.tabIds || null
              }))
            );
            const i2 = e2.map((e3) => e3.key);
            return e2.forEach((e3) => delete e3.key), await chrome.declarativeNetRequest.updateSessionRules({
              addRules: e2
            }), await this._unregisterByIds(o2), t3 ? i2 : i2[0];
          },
          async _unregister(e2) {
            const t3 = n2.ensureArray(e2);
            if (t3.length === 0) return;
            const a3 = this._rules.filter((e3) => t3.includes(e3.key)).map((e3) => e3.id);
            await this._unregisterByIds(a3);
          },
          async _unregisterByIds(e2) {
            e2.length !== 0 && (this._rules = this._rules.filter((t3) => !e2.includes(t3.id)), await chrome.declarativeNetRequest.updateSessionRules({
              removeRuleIds: e2
            }));
          },
          async _dropAllSessionRules() {
            const e2 = await chrome.declarativeNetRequest.getSessionRules();
            e2.length !== 0 && await chrome.declarativeNetRequest.updateSessionRules({
              removeRuleIds: e2.map((e3) => e3.id)
            });
          },
          _cleanupTabRulesPeriodically() {
            n2.chrome.alarms.run(this._cleanUpTabRules.bind(this), {
              name: "netRules.cleanupTabRules",
              periodInMinutes: 5
            });
          },
          async _cleanUpTabRules() {
            const e2 = [];
            e: for (const t3 of this._rules) {
              if (!t3.tabIds) continue;
              let n3 = false;
              for (const e3 of t3.tabIds) {
                if (!e3) continue;
                if (-1 === e3) continue e;
                await chrome.tabs.get(e3) && (n3 = true);
              }
              n3 || e2.push(t3.id);
            }
            await this._unregisterByIds(e2);
          }
        };
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["1.0.0"] = [
          { version: "1.0", title: "Core Monitor Features" },
          "This product version brings support for lightweight website monitoring. Use HARPA to monitor prices, parse KPIs from web pages, track text and html changes.",
          {
            card: "feature",
            title: "PRICE MONITOR",
            content: "Monitors prices on a web page."
          },
          {
            card: "feature",
            title: "TEXT MONITOR",
            content: "Monitors for text to appear / disappear from a web page."
          },
          {
            card: "feature",
            title: "CONTENT MONITOR",
            content: "Watches HTML and text content of a web page for changes."
          },
          {
            card: "feature",
            title: "WEB HEALTH MONITOR",
            content: "Pings web page and monitors website uptime and downtime metrics."
          },
          {
            card: "engine",
            title: "MONITOR RECIPE",
            content: "Core web monitoring automation recipe."
          },
          {
            card: "feature",
            title: "TASK CREATOR",
            content: "App UI module letting you to create new web page automations."
          },
          {
            card: "feature",
            title: "SOUND ACTION",
            content: "Plays a sound or AI-generated text-to-speech line whenever task triggers."
          },
          {
            card: "feature",
            title: "NOTIFICATION ACTION",
            content: "Shows a browser notification whenever task triggers."
          },
          {
            card: "feature",
            title: "DARK THEME",
            content: "Support for dark and light themes."
          },
          {
            card: "feature",
            title: "TASK TESTING MODE",
            content: "UI Module and Task Running Mode that verifies a newly created task performs as expected."
          },
          {
            card: "feature",
            title: "ITEM TRAPPER",
            content: "Item Trapper allows selecting items for tracking right from the monitored web page."
          },
          {
            card: "feature",
            title: "JOURNAL",
            content: "App module and UI screen that logs and renders all operations taken by HARPA."
          },
          {
            card: "feature",
            title: "LIBRARY",
            content: "App module and screen that manages and renders all 3rd party HARPA-compatible automation recipes."
          },
          {
            card: "engine",
            title: "SCHEDULER",
            content: "Keeps track of tasks, schedules and runs them as required."
          },
          {
            card: "feature",
            title: "DASHBOARD UI",
            content: "App screen that renders and manages tasks, task results and statuses."
          },
          {
            card: "feature",
            title: "VALUE WIDGET",
            content: "Renders last task value and delta on a Task Dashboard."
          },
          {
            card: "feature",
            title: "HISTOGRAM WIDGET",
            content: "Renders task data in a histogram."
          },
          {
            card: "feature",
            title: "TASK D&D",
            content: "Drag & drop support for task reordering on automations dashboard."
          },
          {
            card: "feature",
            title: "BULK TASK OPERATIONS",
            content: "Select multiple tasks on a task dashboard and apply a bulk operation."
          },
          {
            card: "engine",
            title: "UA / LANG MANAGER",
            content: "Changes user agent and website language to simulate running websites from various mobile and desktop devices."
          },
          {
            card: "engine",
            title: "SCROLLER",
            content: "Automates web page scrolling."
          },
          {
            card: "engine",
            title: "INSPECTOR",
            content: "Inspects elements and data on websites for visibility and actionability."
          },
          {
            card: "engine",
            title: "IDLE MONITOR",
            content: "Engine module that monitors web page for changes and understands when it stops updating."
          },
          {
            card: "engine",
            title: "INJECTOR",
            content: "Injects engine modules into controlled web pages to facilitate data parsing and automation."
          },
          {
            card: "engine",
            title: "AI DATA EXTRACTOR",
            content: "Parses numbers, dates, prices and other numeric data from the web pages."
          },
          {
            card: "engine",
            title: "AI PARSER",
            content: "Groups content on web pages into blocks, builds page semantics and intra-block relationship models."
          },
          {
            card: "engine",
            title: "AUTOMATION ENGINE",
            content: "Engine runs websites in a sand-boxed background process, automates actions and provides browser APIs for HARPA recipes."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["1.1.0"] = [
          { version: "1.1", title: "Monitor Usability" },
          "Improved app stability, data watching quality, optimized engine speed.",
          {
            card: "engine",
            title: "MEMOIZER",
            content: "Speeds up AI Parser by memoizing data extraction operations."
          },
          {
            card: "engine",
            title: "MUTER",
            content: "Automatically mutes and prevents video and audio elements from playing to reduce network usage."
          },
          {
            card: "fix",
            title: "IMPROVED TEXT GROUPING",
            content: "AI Parser quality has been improved. AI will now takes more parameters into account to decide whether to group text elements into data blocks or split them up."
          },
          {
            card: "fix",
            title: "IMPROVED NUMBERS RENDERING",
            content: "Numbers are automatically shortened and formatted on the dashboard."
          },
          {
            card: "fix",
            title: "IMPROVED % RENDERING",
            content: "Percentages e.g. 95% are now rendered correctly in task widgets."
          },
          {
            card: "fix",
            title: "IMPROVED CURRENCIES PARSING",
            content: "Added support for alternative currency symbols detection such as CA$."
          },
          {
            card: "fix",
            title: "IMPROVED NUMBERS PARSING",
            content: "HARPA now parses 1m on websites as both 1 minute and 1.000.000."
          },
          {
            card: "fix",
            title: "STORAGE OPTIMIZATION",
            content: "HARPA now keeps less data per task to reduce memory footprint."
          },
          {
            card: "fix",
            title: "IDLE MONITOR SPEED-UP",
            content: "Speed up engine to detect web page idle state faster and more reliably."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["1.2.0"] = [
          { version: "1.2", title: "Monitor Editing" },
          "This release brings support for monitors editing and customization operations.",
          "If you need to create a list of similar monitors, simply clone an existing task and edit the clone's parameters.",
          {
            card: "feature",
            title: "IMPROVED TASK UI",
            content: "Monitor creation and editing interface has been redesigned to streamline the task configuration process."
          },
          {
            card: "feature",
            title: "TASK EDITING",
            content: "Click a gear button on a value widget to edit corresponding task after it has been created."
          },
          {
            card: "feature",
            title: "HISTOGRAM AGGREGATIONS",
            content: "Data records on histogram widgets can be grouped by hour, day, week or month."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["1.3.0"] = [
          { version: "1.3", title: "Screenshots" },
          "To improve monitors transparency, HARPA will now automatically take screenshots and record command steps during task runs.",
          {
            card: "feature",
            title: "AUTOMATION STEPS TRACKING",
            content: "Individual task results and steps can now be inspected by selecting them in a histogram widget."
          },
          {
            card: "feature",
            title: "SCREENSHOTS",
            content: "HARPA will now take a screenshot of the web page during task runs. The screenshots history is stored locally."
          },
          {
            card: "engine",
            title: "SCREENSHOT CAPTURE MODULE",
            content: "Screenshotter module supports taking screenshots of a web page being automated."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["1.4.0"] = [
          { version: "1.4", title: "Architecture Redesign" },
          "This release brings a complete redesign of the product architecture, radical performance improvements, stability enhancements and new features.",
          "Machine Learning model became much smarter, making your automations resilient to HTML code changes.",
          "Alas, due to the sheer volume of changes, version 1.4 monitors are <b>not backward compatible</b>. Starting from the version 1.4 your monitors will not break between the updates because of the state versioner module.",
          {
            card: "feature",
            title: "EMAIL ACTION",
            content: "HARPA can now send emails whenever task condition is triggered."
          },
          {
            card: "feature",
            title: "COOKIE BANNERS DETECTION",
            content: "HARPA can now automatically detect and hide cookie consent banners."
          },
          {
            card: "feature",
            title: "TEXT DETECTION",
            content: "HARPA can now check if the monitored page contains given text, phrase or regular expression before running the monitor."
          },
          {
            card: "engine",
            title: "AI ELEMENT LOCATOR",
            content: "Element locators are now built using a Machine Learning model which ensures task resilience across page updates."
          },
          {
            card: "engine",
            title: "OFFLINE TRACKER",
            content: "Monitors Internet connectivity to automatically silence tasks running in the background."
          },
          {
            card: "engine",
            title: "STATE VERSIONER",
            content: "Migrates internal data storage between app versions to ensure backward task compatibility."
          },
          {
            card: "fix",
            title: "IMPROVED TEXT GROUPING",
            content: "AI Parser now takes more parameters into account whenever it decides to group text elements into data items or split them up."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["2.0.0"] = [
          { version: "2.0", title: "Host Tabs and Auto-refresh Mode" },
          "HARPA now runs automations directly in browser tabs: normal, pinned or hidden. This radically improves task stability and allows watching running monitors live.",
          "App UI was redesigned and will render tasks directly in extension popup. HARPA will automatically suggest automation recipes whenever you click extension icon.",
          "Auto-refresh mode, webhooks and CSV data exports introduced. 50+ bug fixes are shipped with this release.",
          {
            card: "engine",
            title: "HOST TABS",
            content: "HARPA now runs tasks directly in browser tabs. Regular, pinned and hidden tabs supported. Setting can be changed under schedule config."
          },
          {
            card: "feature",
            title: "WEBHOOK ACTION",
            content: "Integrate HARPA with 3rd party services: send data to server webhook."
          },
          {
            card: "feature",
            title: "AUTO-REFRESH MODE",
            content: "Build KPI monitoring dashboards by navigating to any web page, clicking extension icon and setting up auto-refresh task."
          },
          {
            card: "feature",
            title: "AI SUGGESTIONS",
            content: "Whenever you click extension icon, HARPA will parse the opened web page and suggest a few monitoring targets automatically."
          },
          {
            card: "feature",
            title: "WEB PAGE PREVIEW",
            content: "A screenshot preview is rendered alongside every task to streamline task management."
          },
          {
            card: "feature",
            title: "TASK CSV DATA EXPORT",
            content: "Export a single or multiple tasks data to a CSV / XLS file."
          },
          {
            card: "fix",
            title: "BETTER NUMBER PARSER",
            content: "AI engine takes element sizes into account when parsing fractional numbers."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["2.1.0"] = [
          { version: "2.1", title: "Max Parallel Tasks" },
          "Now you can use settings button in the sidebar to limit the number of tasks HARPA runs at once. By default HARPA will conservatively limit the number of tasks to one at a time to save CPU and memory.",
          "The task schedule medium (normal / pinned / hidden tab) can be edited right from the dashboard.",
          "HARPA will export URL, task name and ID to CSV files.",
          {
            card: "feature",
            title: "PARALLEL TASKS SETTING",
            content: "Limit the number of tasks running at once."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["2.2.0"] = [
          { version: "2.2", title: "Integromat / Make.com integration" },
          "Connect HARPA AI with over 1000+ apps via Make.com.",
          "Now you can instruct HARPA to send data events to your scenarios and trigger actions in 1000+ web apps and systems: store data in Google Sheets, Airtable, Google Drive, send messages to Slack, Telegram, Discord, create tasks in Trello, Todoist, Google Tasks, trigger actions in ActiveCampaign, MailChimp, HubSpot, you name it.",
          "You can find Make.com / Integromat integration under Task Settings \u2192 Actions.",
          {
            card: "feature",
            title: "MAKE.COM INTEGRATION",
            content: "Trigger Make.com scenarios whenever website updates and send data to 3rd party systems."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["3.0.0"] = [
          { version: "3.0", title: "ChatGPT integration" },
          "HARPA's hybrid AI now integrates ChatGPT.",
          "This allows running page-aware natural-language queries, display ChatGPT answers on Google Search result pages, summarize web pages into posts and tweets, generate SEO content, articles and email replies, extract data from websites and much more.",
          "For now you need to create a free OpenAI account to run ChatGPT queries with HARPA. We have plans to improve this in the future. Stay tuned.",
          {
            card: "engine",
            title: "CHATGPT AI MODULE",
            content: "Run page-aware ChatGPT queries in HARPA."
          },
          {
            card: "feature",
            title: "CHATGPT REPLIES ALONGSIDE SERP",
            content: "Show answers from ChatGPT alongside search result pages. Supports all popular engines."
          },
          {
            card: "feature",
            title: "SUMMARIZE PAGES",
            content: "Summarize and rephrase any page content into a few paragraphs of text, a Twitter's tweet, a Facebook or Instagram blog post."
          },
          {
            card: "feature",
            title: "GENERATE CONTENT",
            content: "Generate text content from Instagram posts, Facebook comments, hashtag lists to email replies and complete SEO articles."
          },
          {
            card: "feature",
            title: "EXTRACT DATA",
            content: "Extract SEO keywords, key-value pairs, tabular data and prices from any web page in a few clicks."
          },
          {
            card: "feature",
            title: "CUSTOM PROMPTS",
            content: "Write, reuse and share your own context-aware custom ChatGPT prompts."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["3.3.0"] = [
          { version: "3.3", title: "100+ ChatGPT prompts" },
          "Over 100 page-aware ChatGPT prompts have been added to the HARPA platform with this release.",
          "Get to the list of prompts by typing a slash (/) in the HARPA AI tab. There are prompts for Copywriting, SEO, Marketing, Social Media Marketing, Productivity, HR & Job Search, Software Engineering, Learning.",
          "HARPA AI now supports grabbing the context right from the page with the help of a Context Grab button.",
          "You can now switch to your preferred chat response language in the app settings.",
          {
            card: "feature",
            title: "CHATGPT COMMANDS",
            content: "Quickly access one of 100 battle-tested page-aware ChatGPT commands."
          },
          {
            card: "feature",
            title: "LANGUAGE SELECTOR",
            content: "Switch preferred ChatGPT language to one of the 10 options."
          },
          {
            card: "feature",
            title: "CONTEXT SELECTOR",
            content: "Grab text context for your commands right from the web page."
          },
          {
            card: "feature",
            title: "ALT+A QUICK ACCESS",
            content: "Access HARPA AI from any page by pressing [Alt] + [A] on Windows or [\u2303] + [A] on Mac."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["3.4.0"] = [
          { version: "3.4", title: "User-Defined Commands" },
          "Turn any chat message to a reusable, parameterizable page-aware command or create your own commands from scratch right from the command list interface.",
          "Now you can use desc, url, domain parameters in your prompts as well as define your own custom parameters with p1, p2, p3\u2026",
          "Clear and reset AI chats with /clear command.",
          "A ton of improvements and bug fixes under the hood, e.g. HARPA will now re-run Google Search queries if you edit the query.",
          {
            card: "engine",
            title: "USER-DEFINED COMMANDS",
            content: "Create and reuse custom parameterizable AI commands."
          },
          {
            card: "feature",
            title: "PAGE VARIABLES",
            content: "Variables for page title, description, url, domain."
          },
          {
            card: "fix",
            title: "IMPROVED CHAT UX",
            content: "Chat UI has been polished, streamlined and simplified."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["3.5.0"] = [
          { version: "3.5", title: "YouTube Transcripts" },
          "HARPA can now parse transcripts of YouTube videos.",
          "Added ChatGPT prompts for YouTube summary and YouTube target audience analysis.",
          "You can create custom video transcript-aware commands by utilizing {{transcript}} parameter in prompts.",
          {
            card: "engine",
            title: "CHATGPT TOKENIZER",
            content: "Breaks ChatGPT requests into tokens to ensure requests reliably fit the ChatGPT model limit."
          },
          {
            card: "feature",
            title: "YOUTUBE TRANSCRIPTS",
            content: "Use {{transcript}} parameter in your prompts and instruct HARPA to parse a video transcript from the opened video page."
          },
          {
            card: "fix",
            title: "40+ LANGUAGE OPTIONS",
            content: "Added more options for the {{language}} parameter."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["4.0.0"] = [
          { version: "4.0", title: "Text Composer" },
          'Text "Composer" Writer has been released. Type /compose command in chat to write any type of text content including emails, email replies, direct messages, tweets, LinkedIn / Facebook / Instagram posts, press releases, todo lists, poems etc.',
          "Use Text Composer to improve or rewrite any text on the web. HARPA now supports quick text grabbing from any page. Chat UI has been streamlined.",
          {
            card: "feature",
            title: "TEXT COMPOSER",
            content: "Compose command writes, rewrites, improves any type of text."
          },
          {
            card: "feature",
            title: "PASTE TO PAGE",
            content: "Paste any AI reply to web page with a click of a button."
          },
          {
            card: "engine",
            title: "GPT-4",
            content: "HARPA AI supports model GPT-4, which is available on ChatGPT Plus."
          },
          {
            card: "fix",
            title: "GRAB SPEED",
            content: "Improved text grabbing performance."
          },
          {
            card: "fix",
            title: "CHATGPT CLOUDFLARE FIX",
            content: "Improved ChatGPT connectivity and stability."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["4.1.0"] = [
          { version: "4.1", title: "Summarize YouTube Videos" },
          "Call /youtube-summary command in HARPA chat to get key takeaways from the opened YouTube video.",
          "This is made possible by request chunking. HARPA now breaks down long video transcripts to bite-sizeable chunks ands sends them to ChatGPT one by one.",
          "LinkedIn commands were reworked to support parsing Job Descriptions and CVs from the web page.",
          "Added user guides to website: https://harpa.ai/guides",
          {
            card: "engine",
            title: "REQUEST CHUNKING",
            content: "HARPA AI engine can now break down long text parameters, feeding them to ChatGPT piece by piece."
          },
          {
            card: "feature",
            title: "CATEGORIES BAR UX",
            content: "Improved categories navigation in the commands explorer."
          },
          {
            card: "fix",
            title: "IMPROVED YOUTUBE COMMANDS",
            content: "HARPA can now extract key takeaways and summarize hours-long videos."
          },
          {
            card: "fix",
            title: "IMPROVED LINKEDIN COMMANDS",
            content: "Reworked and improved LinkedIn commands."
          },
          {
            card: "fix",
            title: "STABILITY FIXES",
            content: "Stability fixes and under-the-hood improvements."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["4.2.0"] = [
          { version: "4.2", title: "Commands Export & Import" },
          "Version 4.2 brings ability to export, import and mark custom commands as favorites.",
          "This gives control over your automations, allowing you to save, share or sell your custom automation commands and page-aware ChatGPT prompts.",
          {
            card: "feature",
            title: "COMMANDS EXPORT & IMPORT",
            content: "Select custom commands from the commands explorer and export to JSON file. Share, sell or import commands."
          },
          {
            card: "fix",
            title: "GPT-4 INTEGRATION",
            content: "Use HARPA AI with GPT-4, which is available for OpenAI Plus users."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["5.0.0"] = [
          { version: "5.0", title: "API Keys & Selection Commands" },
          "HARPA AI now extracts information from SERP pages (Google, Bing, Yahoo etc.) to enrich GPT results with information on events past 2021.",
          "OpenAI API keys / license support, making AI Agent reliable and solving the disconnection and CloudFlare issues. Enter your API key in settings.",
          "HARPA AI commands can be invoked from web pages by selecting a block of text and pressing <b>Alt + A</b>. This works similar to Notion AI and allows improving, translating, fixing, paraphrasing and extracting information from any block of text on any website.",
          {
            card: "engine",
            title: "OPENAI API KEYS",
            content: "OpenAI API keys / license support, making AI Agent reliable and solving the disconnection and CloudFlare issues."
          },
          {
            card: "engine",
            title: "AUTOMATION STEPS",
            content: "Custom commands now support SAY, ASK, GPT, PASTE and COMMAND automation steps."
          },
          {
            card: "engine",
            title: "COMMANDS CHAINING",
            content: "Custom HARPA AI commands can reference other commands, e.g. Compose, Reply and Rewrite. Useful for creating shortcuts and higher order commands."
          },
          {
            card: "feature",
            title: "PAGE SELECTION COMMANDS",
            content: "HARPA AI commands can be invoked from web pages by selecting a block of text and pressing Alt + A."
          },
          {
            card: "feature",
            title: "SELECTION AND GPT PARAMETERS",
            content: "HARPA AI supports {{selection}} and {{gpt}} parameters for page text selection and commands chaining."
          },
          {
            card: "feature",
            title: "HOTKEYS CUSTOMIZATION",
            content: "Default Alt + A hotkey combination can now be changed e.g. to Ctrl + /. Keyboard shortcuts for copying and pasting the last message to page."
          },
          {
            card: "feature",
            title: "CUSTOM CHAT LANGUAGE",
            content: "Specify custom GPT reply language, e.g. Catalan, Klingon, Quenya in settings."
          },
          {
            card: "feature",
            title: "REPLY & REWRITE COMMANDS",
            content: "Added extra commands: Reply and Rewrite, for crafting email and post replies and rewriting / improving text, similar to Notion AI."
          },
          {
            card: "fix",
            title: "SUMMARY CHUNKING",
            content: "Summary and Grammarly commands now support text content chunking (splitting), similar to YouTube Summary command, and can process large web pages."
          },
          {
            card: "fix",
            title: "COMPOSER REFINEMENT LOOP",
            content: "Composer command can now write comments for Instagram, Facebook and LinkedIn social networks. Composer also features a text refinement loop and pasting text to page."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["5.1.0"] = [
          { version: "5.1", title: "Context Mode & Quick Access Buttons" },
          "HARPA will parse web page content and locate relevant information whenever you send a question in chat. It will also recollect relevant messages from the dialog history.",
          "This implements STM (short-term-memory), makes HARPA dialogues highly-contextual and means you can talk to HARPA about the page content.",
          "You can turn context off and switch back to normal Chat mode at any time by clicking a context button at the bottom of the chat.",
          {
            card: "engine",
            title: "GENERATIVE AGENT CONTEXT",
            content: "HARPA can locate locate relevant information in web pages and inject it into GPT prompt."
          },
          {
            card: "feature",
            title: "QUICK ACCESS COMMANDS",
            content: "Select any text on a web page to quickly rephrase, shorten / expand, fix spelling and grammar, translate, write a reply etc."
          },
          {
            card: "feature",
            title: "QUICK ACCESS CUSTOMIZATION",
            content: "Favorite your commands to add them to the quick access panel."
          },
          {
            card: "feature",
            title: "GPT CHUNKING",
            content: "Custom HARPA commands now support GPT chunking. This way you can slice up large web pages and process them chunk by chunk, similar to YouTube summary command."
          },
          {
            card: "feature",
            title: "DRAWING CHARTS",
            content: "Use new /chart command to draw charts."
          },
          {
            card: "fix",
            title: "AUTO-CLEAR CHATS",
            content: "New option to prevent HARPA from automatically clearing ChatGPT dialogs on tab closing."
          },
          {
            card: "fix",
            title: "USABILITY & FIXES",
            content: "Code in answers can now be copied with a click of a button. Improved prompts consistency, fixed bugs."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["5.2.0"] = [
          { version: "5.2", title: "PDF Support" },
          'HARPA can now read online PDF documents. Navigate to a PDF online, bring HARPA AI and ask it questions about the document: e.g. "what questions this document answers"?',
          "Added {{context}} parameter, which retrieves page content relevant to user prompt. Improved context search algorithm and heuristics for speed and quality.",
          "HARPA now supports OpenAI GPT-4 Browsing model. Fixed a number of bugs and improved user experience.",
          {
            card: "engine",
            title: "PDF PARSER",
            content: "Engine module that extracts text content from online PDF documents."
          },
          {
            card: "feature",
            title: "BROWSING MODEL",
            content: "Support for GPT-4 browsing model."
          },
          {
            card: "feature",
            title: "CONTEXT PARAMETER",
            content: "Use {{context}} in your prompts to inject page content relevant to your prompts."
          },
          {
            card: "fix",
            title: "USABILITY & FIXES",
            content: "Fixed a problem that caused HARPA to stop generating long articles and replies."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["5.3.0"] = [
          { version: "5.3", title: "Google Bard Support" },
          "HARPA now supports Google Bard as AI model provider.",
          {
            card: "engine",
            title: "GOOGLE BARD INTEGRATION",
            content: "Switch to Google Bard model to run your AI queries."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["5.4.0"] = [
          { version: "5.4", title: "Requests Automation" },
          "HARPA now supports HTTP requests in commands. Send requests to any API, get info from web pages and web services, or send data to Zapier, Integromat, IFTTT.",
          "OpenAI API connection now has temperature, frequency penalty, presence penalty, proxy url and system prompt settings.",
          "Prefix any parameter name with global, e.g. {{global.email}} and it will be stored and available in every chat.",
          {
            card: "engine",
            title: "REQUEST STEP",
            content: "Use request step to query data from web services or send data to webhooks."
          },
          {
            card: "feature",
            title: "OPENAI API SETTINGS",
            content: "Temperature, frequency penalty, presence penalty, proxy url and system prompt settings."
          },
          {
            card: "feature",
            title: "GLOBAL PARAMETERS",
            content: 'Parameters prefixed with "g" or "global" are stored across chats and commands.'
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["5.5.0"] = [
          { version: "5.5", title: "Clicks Automation" },
          "HARPA now supports CLICK and PASTE command steps. Use them to click elements on page, hide cookie banners, fill forms, navigate within Single Page Applications etc.",
          "YouTube summaries now include timestamps for quick reference and navigation.",
          "Reworked 20+ predefined commands. Article Creator now generates long articles, starting from outlines down to writing chapters, in 18 writing styles and frameworks.",
          {
            card: "engine",
            title: "CLICK STEP",
            content: "Automate clicks on web pages in your custom commands."
          },
          {
            card: "engine",
            title: "PASTE STEP",
            content: "Automate entering data and filling forms in your custom commands."
          },
          {
            card: "feature",
            title: "YOUTUBE TIMESTAMPS",
            content: "Timestamps are included in YouTube transcripts and summaries."
          },
          {
            card: "feature",
            title: "ARTICLE CREATOR",
            content: "Generate long articles from outlines down to chapters in 18 writing styles."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["5.6.0"] = [
          { version: "5.6", title: "JS Execution" },
          "The JS Code Runner step allows running JS functions in scope of the web pages, as part of your custom automation commands.",
          "If you are familiar with JavaScript, you can use $harpa.* API to scroll, inspect, parse, navigate and extract data from the web pages and build advanced automations. JS Code Runner supports async / await and passing parameters via arguments and results back to HARPA AI.",
          {
            card: "engine",
            title: "RUN JS",
            content: "Execute custom JS code in the page scope."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["5.7.0"] = [
          { version: "5.7", title: "Claude AI" },
          "HARPA brings support for Claude2 Web Session. Claude2 is great for processing large web pages and texts having 100k context window. This integration is Experimental.",
          {
            card: "engine",
            title: "CLAUDE 2",
            content: "Switch chat to Claude 2 Web Session."
          },
          {
            card: "feature",
            title: "TIMESTAMP JUMPS",
            content: "Clicking timestamps in YouTube summaries will no longer cause a webpage refresh."
          },
          {
            card: "fix",
            title: "UI FREEZING FIXED",
            content: "Scrolling UI on Windows should not longer freeze the app."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["5.8.0"] = [
          { version: "5.8", title: "Mimic Writing" },
          "HARPA can now analyze and mimic your writing style in /reply, /rewrite and /compose commands. Best with GPT-4.",
          {
            card: "engine",
            title: "GOOGLE DOCS",
            content: "Google Docs integration module."
          },
          {
            card: "feature",
            title: "WRITER MIMIC",
            content: "Run /mimic command to analyze your writing."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["5.9.0"] = [
          { version: "5.9", title: "Commands Rework" },
          "Almost every command has received a REFINE option: you can improve the received answer to meet your expectations.",
          "Some commands have received redirect options; for example, after /resume-reviewer, you can easily jump to /resume-improver, which may simplify your workflow.",
          {
            card: "feature",
            title: "COMMANDS",
            content: "Added 12 new and reworked 80% of the existing commands, bringing GPT-3.5 closer in quality to GPT-4."
          },
          {
            card: "fix",
            title: "CATEGORIES",
            content: "New categories for easier navigation: Marketing, SEO, SMM & E-commerce."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["6.0.0"] = [
          { version: "6.0", title: "Web Awareness & Flags" },
          "HARPA can make GPT aware of the recent events. Pass -w flag along with your prompt in AI chat to search the web. Switch connections and AI modes via flags.",
          {
            card: "engine",
            title: "PROMPT FLAGS",
            content: "Pass flags in chat along with your prompt to switch connection type and AI mode: -3 for GPT-3.5, -4 for GPT-4, -p for page-aware etc."
          },
          {
            card: "feature",
            title: "CONNECTION SWITCH",
            content: "Toggle between connection types with a click of a button."
          },
          {
            card: "feature",
            title: "WEB AWARENESS",
            content: "Activate web awareness and search the web by passing -w flag in your prompt."
          },
          {
            card: "feature",
            title: "COMMAND SUGGESTIONS",
            content: "HARPA will now suggest commands based on opened website."
          },
          {
            card: "feature",
            title: "NEW COMMANDS",
            content: "Improved /mimic, /article-creator, /reply. Added new formatting option for /youtube-summary. Added /repurpose-video, /repurpose-text."
          },
          {
            card: "fix",
            title: "UBLOCK FIX",
            content: "Workaround for uBlock Origin rules blocking HARPA YouTube summarizer."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["6.1.0"] = [
          { version: "6.1", title: "Web Browsing Model" },
          "Improved web-aware mode and added support for -p and -w flags in custom commands.",
          {
            card: "engine",
            title: "WEB BROWSING MODEL",
            content: "Proper support for WEB BROWSING mode from ChatGPT."
          },
          {
            card: "fix",
            title: "SERP URLS",
            content: "Web-aware mode will be much less likely to hallucinate links, instead using actual URLs from the web search."
          },
          {
            card: "fix",
            title: "COMMAND FLAGS",
            content: "Flags -p and -w now properly work in custom commands."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["6.2.0"] = [
          { version: "6.2", title: "Midjourney Wizard" },
          "Midjourney Wizard command now features over 30 hand-picked, pre-purchased and carefully designed MJ prompts.",
          {
            card: "feature",
            title: "MIDJOURNEY WIZARD",
            content: "Updated /midjourney-wizard command features 30+ hand-picked and carefully designed MJ prompt templates."
          },
          {
            card: "feature",
            title: "MESSAGE PARAMETER",
            content: "Chain commands and reference previous messages in chat with {{message X}}, where X is one of: last, first, -2, -1, 0, 1, 2\u2026"
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["7.0.0"] = [
          {
            version: "7.0",
            title: "Web Automation",
            video: {
              cover: "https://harpa.ai/img/updates/video-guide-7.0.png",
              url: "https://www.youtube.com/watch?v=oqAQOjoWkuQ"
            }
          },
          "HARPA v7.0 brings over 10 new features for creating AI-powered web automation workflows: new steps, conditions, loops, jumps, choice options and more.",
          {
            card: "feature",
            title: "ASK STEP OPTIONS",
            content: "You can now declare choice options in your AI commands and build complex multi-step dialogues."
          },
          {
            card: "feature",
            title: "SERP PARAMETER",
            content: "Use new {{serp query}} parameter in chat to search web."
          },
          {
            card: "engine",
            title: "CALC STEP",
            content: [
              "CALC step brings 15+ functions for setting parameters, extracting prices and code blocks from GPT responses.",
              "Utilize regular expressions and work with lists in your custom AI commands."
            ]
          },
          {
            card: "engine",
            title: "GROUPS & LOOPS",
            content: [
              "Declare step groups and loops to iterate over list variables.",
              "Using loops you can now build mass-automation workflows with HARPA AI."
            ]
          },
          {
            card: "engine",
            title: "WAIT STEP",
            content: "Instruct HARPA to wait for a certain amount of time, text or element to appear or JS function to resolve, before proceeding to the next step."
          },
          {
            card: "engine",
            title: "CONDITIONS, LABELS & JUMPS",
            content: "Control command flow execution with step conditions and jumps."
          },
          {
            card: "engine",
            title: "NAVIGATE FORWARD & BACK",
            content: "More options to navigate through web history: go forward or back."
          },
          {
            card: "engine",
            title: "NAVIGATE IDLE OPTION",
            content: "Instruct HARPA to wait for page to load before proceeding to the next step."
          },
          {
            card: "engine",
            title: "STEP SILENCING",
            content: "Silence output of a step to reduce clutter in the chat."
          },
          {
            card: "feature",
            title: "OPENAI STREAMING MODE",
            content: "Switch between OpenAI API streaming and completion modes."
          },
          {
            card: "feature",
            title: "REQUESTS INTERPOLATION",
            content: [
              "REQUEST step URL, Body and Headers are now properly interpolated with parameters.",
              "Send data to web APIs such as Zapier, Make.com and n8n, or fetch web pages."
            ]
          },
          {
            card: "feature",
            title: "COMMANDS CLONING",
            content: "Clone your custom AI commands with a click of a button."
          },
          {
            card: "fix",
            title: "PARAMETERS UPDATE",
            content: "Parameter names updated for brevity: {{selection}}, {{url}}, {{domain}}, {{title}}, {{desc}}, {{transcript}}."
          },
          {
            card: "fix",
            title: "YOUTUBE SUMMARIZER",
            content: "Improved YouTube video summaries command and format."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["7.1.0"] = [
          {
            version: "7.1",
            title: "DALL\xB7E, ClaudeAI v2.1, Export",
            video: {
              cover: "https://harpa.ai/img/updates/video-guide-7.1.png",
              url: "https://www.youtube.com/watch?v=0GvHvf6Pzlc"
            }
          },
          "HARPA v7.1 brings ChatGPT+ DALL\xB7E, ClaudeAI v2.1, chat EXPORT step, LSI keyword extraction, bug fixes and new commands.",
          {
            card: "engine",
            title: "EXPORT STEP",
            content: [
              "HARPA can now export extracted data to files with the new EXPORT step."
            ]
          },
          {
            card: "feature",
            title: "LSI KEYWORD EXTRACTION",
            content: "Added automatic SERP LSI keyword enrichment to /article-creator, /outrank-seo-article, /blog-post-writer, repurpose-text, and /repurpose-video."
          },
          {
            card: "feature",
            title: "NEW COMMANDS",
            content: "Added /youtube-channel-analysis, /extract-youtube-transcripts and /language-wizard for language study."
          },
          {
            card: "engine",
            title: "DALL\xB7E & CLAUDE AI 2.1",
            content: [
              "Integrated ChatGPT+ DALL\xB7E for image rendering. Added support for Claude AI 2.1 model."
            ]
          },
          {
            card: "fix",
            title: "CLAUDE AI CONNECTION",
            content: "Resolved connectivity issues with Claude AI."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["7.2.0"] = [
          {
            version: "7.2",
            title: "Reply tone, TL;DR, OpenRouter",
            video: {
              cover: "https://harpa.ai/img/updates/video-guide-7.2.png?x=10",
              url: "https://www.youtube.com/watch?v=pB6RpKGyczg"
            }
          },
          "HARPA v7.2 brings support for OpenRouter.AI, new commands and /reply tone customization.",
          {
            card: "feature",
            title: "REPLY TONE",
            content: [
              "Teach AI to reply to emails in your own voice by changing the tone used by /reply command."
            ]
          },
          {
            card: "engine",
            title: "OPENROUTER CONNECTOR",
            content: "Connect HARPA to 20+ LLM models including LLAMA, MistralAI, Claude 2.1 API and even Perplexity via OpenRouter.ai."
          },
          {
            card: "feature",
            title: "NEW COMMANDS",
            content: "Added /tldr, improved /summary, /rewrite and other commands."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["7.3.0"] = [
          {
            version: "7.3",
            title: "Search Agent & GPTs",
            video: {
              cover: "https://harpa.ai/img/updates/video-guide-7.3.png",
              url: "https://www.youtube.com/watch?v=OVNSvvQ5x0U"
            }
          },
          "HARPA v7.3 brings custom GPTs, page crawler, deep search agent and a set of new commands.",
          {
            card: "feature",
            title: "UPDATED COMMANDS",
            content: [
              "Text generation commands now come with embedded search and URL integration options."
            ]
          },
          {
            card: "feature",
            title: "SEARCH AGENT COMMAND",
            content: "/search-agent command forms deeply informed search responses, thanks to integrated crawler."
          },
          {
            card: "feature",
            title: "EXPLAIN COMMAND",
            content: "/explain command breaks down complex topics and acronyms, researches leads, and pulls data from the web."
          },
          {
            card: "feature",
            title: "SENTIMENT ANALYSIS COMMAND",
            content: "/sentiment-analysis command categorizes reviews of a product and provides an overall rating."
          },
          {
            card: "engine",
            title: "GPTs",
            content: [
              "ChatGPT+ users now have an access to GPTs directly in HARPA."
            ]
          },
          {
            card: "engine",
            title: "PAGE CRAWLER",
            content: [
              "{{page}} parameter now supports query, url and limit options, e.g. {{page Connect HARPA to OpenRouter https://harpa.ai limit=10%}}"
            ]
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["8.0.0"] = [
          {
            version: "8.0",
            title: "Premium Features",
            video: {
              cover: "https://harpa.ai/img/updates/video-guide-8.png?x=1",
              url: "https://www.youtube.com/watch?v=zIhGLt7MxlU"
            }
          },
          "HARPA v8.0 brings the first set of premium features, HARPA X and HARPA S plans",
          {
            card: "feature",
            title: "COMMANDS CUSTOMIZATION",
            content: [
              "Predefined commands can now be cloned, edited and customized."
            ]
          },
          {
            card: "feature",
            title: "CHAT HISTORY",
            content: "Chat history is stored locally. HARPA allows switching and reusing old chats across tabs."
          },
          {
            card: "feature",
            title: "CLOUD STORAGE",
            content: "All custom commands are securely stored in the cloud and accessible on any device under your HARPA AI profile."
          },
          {
            card: "feature",
            title: "TEAM SPACES",
            content: "Create spaces for your team, organization or family and share commands with your space members."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["8.1.0"] = [
          {
            version: "8.1",
            title: "CloudGPT",
            video: {
              cover: "https://harpa.ai/img/updates/video-guide-8.1.png?x=1",
              url: "https://www.youtube.com/watch?v=6x2GUlfEbNM"
            }
          },
          "HARPA v8.1 brings CloudGPT, a fast and reliable Large Language Model connection.",
          {
            card: "feature",
            title: "CLOUD GPT",
            content: [
              "Switch to CloudGPT 3.5 or 4 model in the Connections tab. Billed per token usage."
            ]
          },
          {
            card: "feature",
            title: "CLONING API CONNECTIONS",
            content: "Set up multiple API KEY connections to quickly switch between different API keys."
          },
          {
            card: "feature",
            title: "CLAUDE AI 3 MODELS",
            content: "Support for new paid and free Claude 3 models: Opus, Sonnet, Haiku."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["8.10.0"] = [
          { version: "8.10", title: "Dynamic Parameters" },
          "Use {{dynamic}} parameters in your automations. Commands improved. Integrated Claude 3.5 Sonnet.",
          {
            card: "feature",
            title: "DYNAMIC PARAMETERS",
            content: "HARPA supports {{dynamic}} parameter names in automations for complex workflows."
          },
          {
            card: "feature",
            title: "SEEK TIMESTAMPS IN VIDEOS",
            content: "Ask command now reports YouTube timestamps, to references where the question was answered."
          },
          {
            card: "feature",
            title: "SUMMARY FOLLOW-UPS",
            content: "Summary command now lists follow-up questions, saving time on research."
          },
          {
            card: "feature",
            title: "CLAUDE 3.5 SONNET",
            content: "Claude 3.5 Sonnet beats most AI model benchmarks while being faster. The model is available for Web Session, and Cloud GPT."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["8.2.0"] = [
          { version: "8.2", title: "Arrow Controls" },
          "Up and Down keyboard arrow keys can now be used in chat to go through the message history. Left and Right arrow keys can be used to navigate through reply options.",
          {
            card: "feature",
            title: "ARROW CONTROLS",
            content: ["Support for keyboard arrow keys in chat."]
          },
          {
            card: "fix",
            title: "CLAUDE AI FIX",
            content: "Fixed ClaudeAI Web Session connection on enterprise accounts."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["8.3.0"] = [
          {
            version: "8.3",
            title: "Email Assistant",
            video: {
              cover: "https://harpa.ai/img/updates/video-guide-8.3.png?x=1",
              url: "https://www.youtube.com/watch?v=jPFkLep9LlM"
            }
          },
          "Embedded buttons for Gmail, new Finish Writing command, custom commands testing functionality and more.",
          {
            card: "feature",
            title: "FINISH WRITING",
            content: [
              "Streamlines email, reply, and comment generation. Type a reply to any web form, and expand it with a finished reply."
            ]
          },
          {
            card: "feature",
            title: "EMBEDDED GMAIL BUTTONS",
            content: "Embedded buttons in Gmail UI: Summarize and Finish Writing."
          },
          {
            card: "feature",
            title: "ISOLATED GPT MODE",
            content: "Optimized token usage on Cloud GPT connection. Ability to run GPT requests in isolation, bypassing chat history, with -i flag."
          },
          {
            card: "feature",
            title: "DUMB GPT MODE",
            content: "Switch GPT step to Dumb mode to test the prompt echoed to chat without sending it to LLM provider."
          },
          {
            card: "feature",
            title: "EMAIL PARAMETER",
            content: "{{email}} parameter for parsing email content form Gmail, Outlook, Protonmail, and Fastmail."
          },
          {
            card: "engine",
            title: "INPUT PARAMETER",
            content: "{{input}} parameter to extract input box content."
          },
          {
            card: "feature",
            title: "STEP TESTING",
            content: "Test custom command steps one by one with a help of the new Run Step button."
          },
          {
            card: "engine",
            title: "UPDATED PASTE STEP",
            content: "HARPA can now simulate typing or replace the text in the input box."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["8.4.0"] = [
          {
            version: "8.4",
            title: "Search Agent v2",
            video: {
              cover: "https://harpa.ai/img/updates/video-guide-7.3.png",
              url: "https://www.youtube.com/watch?v=fBms-vN38rk"
            }
          },
          "Search Agent became faster and smarter.",
          {
            card: "feature",
            title: "SEARCH AGENT 2.0",
            content: "/search command now crawls links to prepare hallucination free answer to your query."
          },
          {
            card: "feature",
            title: "CLAUDE AI IN CLOUD GPT",
            content: [
              "Switch to Claude AI Haiku, Sonnet or Opus models in your CloudGPT connection."
            ]
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["8.5.0"] = [
          {
            version: "8.5",
            title: "AI Commands Scheduling",
            video: {
              cover: "https://harpa.ai/img/updates/video-guide-8.5.png",
              url: "https://www.youtube.com/watch?v=3Qg1IgWnXFs"
            }
          },
          "AI Commands can now be scheduled and run on timer in background.",
          "HARPA now shows summaries on top of the YouTube video timelines as you hover over them. Summarization quality has been improved on CloudGPT connection.",
          {
            card: "feature",
            title: "YOUTUBE POI",
            content: "/youtube-summary command overlays video timelines with video content summaries."
          },
          {
            card: "engine",
            title: "AI COMMAND SCHEDULING",
            content: "AI commands can now be scheduled in Automation tab. HARPA will run your custom AI command at specific intervals."
          },
          {
            card: "engine",
            title: "PREFILL STEP",
            content: "New prefill step allows you to prefill the input field with a value before sending a prompt."
          },
          {
            card: "feature",
            title: "CHAT BOOKMARKING",
            content: "Click chat emoji to pin it to the top. Bookmarking a chat keeps it visible and prevents accidental deletion."
          },
          {
            card: "feature",
            title: "GMAIL AUTOLABEL",
            content: "Use /autolabel-gmail command to quickly go through your emails, categorise and assign labels."
          },
          {
            card: "engine",
            title: "JS STEP TIMEOUT",
            content: "RUN JS step now has a timeout option. Set a maximum time to execute long running scripts."
          },
          {
            card: "feature",
            title: "EXPLAIN & ASK FOLLOW-UPS",
            content: "Explain and Ask commands now feature auto-generated quick follow-up questions."
          },
          {
            card: "feature",
            title: "API CONNECTION HEADERS",
            content: "Point HARPA to your local AI model by setting custom headers in API connection."
          },
          {
            card: "fix",
            title: "CHATGPT CONNECTION FIX",
            content: [
              "Free ChatGPT Web Session connection has been re-implemented and restored for the new communication protocol."
            ]
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["8.6.0"] = [
          { version: "8.6", title: "Grab, Echo Mode, MV3" },
          "Embedded buttons for Gmail, new Finish Writing command, improved commands testing and more.",
          {
            card: "engine",
            title: "MANIFEST V3",
            content: "HARPA updated to comply with Google's Manifest v3 requirements, ensuring data security standards."
          },
          {
            card: "engine",
            title: "GRAB PARAMETER",
            content: "Allows you to grab value of an HTML element from a web page. For example: {{grab h1 take=textContent}}, {{grab input take=value}}."
          },
          {
            card: "feature",
            title: "ECHO PARAMETERS IN CHAT",
            content: "Press Alt+Enter (or \u2325+Enter) in chat to echo interpolated prompt with parameter values without sending them to GPT."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["8.7.0"] = [
          { version: "8.7", title: "GPT-4o" },
          "HARPA AI now comes with OpenAI GPT-4o connection, available both on the free Web Session and Cloud GPT.",
          {
            card: "feature",
            title: "GPT-4O CONNECTION",
            content: "GPT-4o is half the cost of GPT-4 and twice as fast. GPT-4o is available for both Web Session (rate limited by OpenAI), and Cloud GPT."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["8.8.0"] = [
          {
            version: "8.8",
            title: "AI Agency",
            video: {
              cover: "https://harpa.ai/img/updates/video-guide-8.8.png",
              url: "https://www.youtube.com/watch?v=dzdvyeyxDUA"
            }
          },
          "Added Fast & Smart AI Agents as premium AI connections. Agents are capable of searching the web, analyzing page content, and automatically launching relevant commands.",
          {
            card: "feature",
            title: "GPT 3.5 AGENT",
            content: "Powered by cost-effective GPT-3.5. Great for most text summarization and data extraction tasks, handles requests quickly and affordably."
          },
          {
            card: "feature",
            title: "GPT 4O AGENT",
            content: "Powered by new GPT-4o model. Better handles writing tasks, and tasks requiring reasoning and analysis."
          },
          {
            card: "fix",
            title: "IMPROVED TOKEN ECONOMY",
            content: "HARPA now runs commands in isolation mode by default, which significantly reduces token consumption."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["8.9.0"] = [
          {
            version: "8.9",
            title: "Shortcuts & Functions",
            video: {
              cover: "https://harpa.ai/img/updates/video-guide-8.9.png",
              url: "https://www.youtube.com/watch?v=K4fWgell0Bk"
            }
          },
          "Press // on any web page to bring a list of shortcuts, use Functions in GPT steps, preform quick web page audit.",
          {
            card: "feature",
            title: "SHORTCUTS",
            content: "Call HARPA by pressing slash / twice, followed by a command hotkey: S for Search, E for Explain and F for finish writing etc."
          },
          {
            card: "feature",
            title: "PAGE SHERLOCK",
            content: "/sherlock command performs quick SEO analysis, extracts web page metadata, checks for typical SEO problem such as broken links, missing attributes and headings, measures page loading speed and resource size."
          },
          {
            card: "engine",
            title: "FUNCTION CALLING",
            content: "Declare functions on GPT steps to instruct AI call one of the available tools and control command flow. Available for OpenAI API Keys and Cloud OpenAI connections."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["9.0.1"] = [
          { version: "9.0", title: "Vision" },
          "V9 brings Vision support. HARPA can now see and work with page screenshots and images. Press Alt+V on Windows or ^V on Mac to capture and send screenshots to AI.",
          {
            card: "engine",
            title: "VISION",
            content: "HARPA supports Vision both over ChatGPT web session and Cloud AI connections."
          },
          {
            card: "feature",
            title: "IMAGE UPLOAD",
            content: "Drag & drop any image from your PC to chat."
          },
          {
            card: "feature",
            title: "CAPTURE VIEW COMMAND",
            content: "Capture View command allows fixing mistakes, solving tests, extracting text, translating, explaining and answering questions in images."
          },
          {
            card: "feature",
            title: "VIEW PARAMETER",
            content: "New {{view}} parameter allows attaching page screenshot in AI commands."
          },
          {
            card: "feature",
            title: "TONE PARAMETER",
            content: "Declare how AI should mimic your writing to improve quality of generated emails and messages."
          },
          {
            card: "feature",
            title: "GPT 4O MINI",
            content: "Added support for GPT 4o Mini both in Web Session and Cloud AI connections."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["9.2.0"] = [
          { version: "9.2", title: "Chat Cloud Backup" },
          "Chats can now be backed up to secure HARPA cloud and synched across devices. Chats are stored per Account and never shared. Enable backup from the App Settings.",
          {
            card: "feature",
            title: "CHAT CLOUD BACKUP",
            content: "Backup your chats to the cloud and synch across devices."
          },
          {
            card: "feature",
            title: "VISION FOR API KEYS",
            content: "OpenAI API and OpenRouter connections now support Vision capabilities."
          },
          {
            card: "feature",
            title: "VISION COMMANDS",
            content: "20+ AI commands redesigned to support visual area grabbing."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["9.3.0"] = [
          { version: "9.3", title: "Command Sharing" },
          "Commands can now be shared publicly.",
          {
            card: "feature",
            title: "COMMAND SHARING",
            content: "Share AI commands and prompts with a few clicks from the command editor."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["9.4.0"] = [
          { version: "9.4", title: "Side Panel" },
          "HARPA can now be rendered in a Side Panel. This view does not obstruct page content and persists HARPA window across website navigations.",
          {
            card: "feature",
            title: "SIDE PANEL",
            content: "Optionally switch HARPA to the Side Panel UI."
          }
        ];
      })(), (() => {
        const { $news: t2 } = e;
        t2.updates["9.5.0"] = [
          {
            version: "9.5",
            title: "Automation Library",
            video: {
              cover: "https://harpa.ai/img/updates/video-guide-9.5.png",
              url: "https://www.youtube.com/watch?v=2uJT9AsmI0w"
            }
          },
          "Easily share your AI-powered web automations, via direct links or publicly in the AI Commands Library.",
          {
            card: "feature",
            title: "LIBRARY",
            content: "Grab helpful AI commands and Web automations from the Library."
          },
          {
            card: "feature",
            title: "THREAD PARAMETER",
            content: "Support for a new {{thread}} parameter to facilitate Telegram, Discord, WhatsApp, Reddit, YouTube, Facebook and Twitter automations."
          }
        ];
      })(), (() => {
        const { $note: t2, $analytics: n2, $bus: a2, $s: o2, $mobx: i2 } = e;
        t2.controller = {
          init() {
            a2.on("alert.hide", this._onAlertHide), this._showUpdateNotifications(), chrome.notifications.onClicked.addListener(
              this._onNotificationClicked.bind(this)
            ), chrome.notifications.onClosed.addListener(
              this._onNotificationClosed.bind(this)
            );
          },
          _onAlertHide(e2) {
            if (e2.details?.id !== "tooltip" && e2.details?.type !== "note") return;
            const t3 = e2.details.id;
            o2.note.isAcknowledged(t3) || (o2.note.acknowledge(t3), n2.controller.sendNoteAcknowledged(t3));
          },
          _showUpdateNotifications() {
            i2.reaction(
              () => o2.note.nextNote("notification", false),
              (e2) => {
                if (!(e2 = o2.note.enhanceNote(e2))) return;
                const t3 = `note:${e2.id}`;
                chrome.notifications.create(t3, {
                  type: "basic",
                  priority: 1,
                  requireInteraction: true,
                  title: e2.title || "HARPA AI UPDATED",
                  iconUrl: e2.iconUrl || "/img/notifications/notification-update.png",
                  message: e2.message
                }), o2.note.isShown(e2.id) || (o2.note.show(e2.id), n2.controller.sendNoteShown(e2.id));
              },
              { fireImmediately: true }
            );
          },
          _onNotificationClicked(e2) {
            if (!e2.startsWith("note:")) return;
            chrome.notifications.clear(e2);
            const t3 = e2.split(":")[1];
            o2.note.isAcknowledged(t3) || (o2.note.acknowledge(t3), n2.controller.sendNoteClicked(t3));
            const a3 = o2.note.findById(t3);
            a3 && a3.onClick && a3.onClick.startsWith("http") && chrome.tabs.create({ url: a3.onClick, active: true });
          },
          _onNotificationClosed(e2) {
            if (!e2.startsWith("note:")) return;
            chrome.notifications.clear(e2);
            const t3 = e2.split(":")[1];
            o2.note.isAcknowledged(t3) || (o2.note.acknowledge(t3), n2.controller.sendNoteClosed(t3));
          }
        };
      })(), (() => {
        const { $offscreen: t2, $netRules: n2, $utils: a2 } = e;
        t2.controller = {
          async init() {
            await this._allowOffscreenIframe(), await this._createOffscreenPage();
          },
          async _allowOffscreenIframe() {
            await n2.register({
              condition: { urlFilter: "https://harpa.ai/oi" },
              action: {
                type: "modifyHeaders",
                responseHeaders: [
                  { header: "X-Frame-Options", operation: "remove" }
                ]
              }
            });
          },
          async _createOffscreenPage() {
            await chrome.offscreen.hasDocument() && await chrome.offscreen.closeDocument();
            const e2 = ["BLOBS"];
            this._supportsMultipleReasons() && (e2.push("AUDIO_PLAYBACK"), e2.push("LOCAL_STORAGE")), await chrome.offscreen.createDocument({
              url: a2.url.ext("/offscreen.html"),
              reasons: e2,
              justification: "play notification sounds, generate image preview, create image from svg code, save settings in local storage"
            });
          },
          _supportsMultipleReasons() {
            try {
              const e2 = Number(
                navigator.userAgent.split("Chrome/")[1].split(".")[0]
              );
              return !e2 || e2 > 110;
            } catch {
              return true;
            }
          }
        };
      })(), (() => {
        const { $recipe: t2, $engine: n2, $jsyaml: a2, $utils: o2, $s: i2 } = e;
        t2.adapters.watcher = {
          icon({ task: e2 }) {
            const { recipeId: t3 } = e2;
            if (t3 === "watcher.monitorChanges") {
              const t4 = e2.inputs["watcher.changes"]?.whatToMonitor;
              switch (t4) {
                case "text": {
                  const t5 = this._triggerCondition(e2);
                  return ["contains-text", "missing-text"].includes(t5) ? "recipe-watcher.monitorText" : "recipe-watcher.monitorChanges";
                }
                case "html":
                  return "recipe-watcher.monitorHtml";
                case "data":
                  return "recipe-watcher.monitorData";
                default:
                  return "recipe-watcher.monitorChanges";
              }
            }
            if (t3 === "watcher.monitorElement") {
              const t4 = e2.inputs["watcher.element"]?.selector?.at(-1)?.$parse;
              switch (t4) {
                case "text":
                  return "recipe-watcher.monitorText";
                case "number":
                  return "recipe-watcher.monitorNumber";
                case "price":
                case "currency":
                  return "recipe-watcher.monitorPrice";
                case "time":
                  return "recipe-watcher.monitorTime";
                case "copyright":
                case "date":
                  return "recipe-watcher.monitorDate";
                default:
                  return "recipe-watcher.monitorElement";
              }
            }
            return t3 === "watcher.monitorHealth" ? "recipe-watcher.monitorHealth" : t3 === "watcher.monitorPrice" ? "recipe-watcher.monitorPrice" : t3 === "watcher.runCommand" ? "recipe-watcher.runCommand" : "recipe-watcher.monitorChanges";
          },
          title({ task: e2 }) {
            const { recipeId: t3 } = e2;
            if (t3 === "watcher.monitorChanges") {
              const t4 = this._triggerCondition(e2);
              if (t4 === "contains-text") {
                return `CONTAINS TEXT ${(e2.inputs.trigger.searchText.split("\n").filter((e3) => !!e3)[0] || "").toUpperCase()}`;
              }
              if (t4 === "missing-text") {
                return `TEXT REMOVED ${(e2.inputs.trigger.searchText.split("\n").filter((e3) => !!e3)[0] || "").toUpperCase()}`;
              }
              return `PAGE ${e2.inputs["watcher.changes"].whatToMonitor} CHANGES`.toUpperCase();
            }
            if (t3 === "watcher.monitorElement") {
              let t4 = this._monitoredElementType(e2);
              t4 === "number" && (t4 = "value");
              let n3 = this._triggerCondition(e2);
              return n3 = {
                "value-is-up": "INCREASES",
                "value-is-down": "DROPS",
                "value-contains-text": "CONTAINS TEXT",
                "value-missing-text": "MISSING TEXT",
                "item-is-removed": "REMOVED"
              }[n3] || "changes", `${t4} ${n3}`.toUpperCase();
            }
            if (t3 === "watcher.monitorHealth") {
              return {
                "web-page-is-down": "AUTO-REFRESH PAGE",
                "web-page-is-up": "AUTO-REFRESH PAGE",
                "web-page-returns-http-code": "HTTP STATUS CODE"
              }[this._triggerCondition(e2)] || "PAGE STATUS";
            }
            return t3 === "watcher.monitorPrice" ? "PRICE VALUE" : t3 === "watcher.runCommand" ? "AI COMMAND" : "MONITOR PAGE";
          },
          async buildCommandTemplates(e2) {
            if (!i2.feature.enabled("creator.run-command")) return [];
            const { template: t3 } = e2, n3 = [], a3 = async (n4, a4 = []) => {
              const o3 = t3();
              o3.inputs.command.name = n4, o3.inputs.command.inputs = a4;
              const r2 = i2.ai.connections.filter((e3) => !e3.unsupported && e3.type === "cloudgpt").at(0);
              return o3.inputs.command.connectionId = r2.id, o3.inputs.command.connectionName = r2.label, o3.inputs.command.result = "result", await this.updateCommandTemplate(o3, e2), o3;
            };
            {
              const e3 = await a3("Autolabel GMail");
              e3.inputs.page.url = "https://mail.google.com/mail/u/0/#inbox", e3.inputs.command.result = "result.processed", n3.push({ priority: 100, task: e3 });
            }
            {
              const e3 = await a3("Financial quote", ["BTC-USD"]);
              e3.inputs.command.result = "quote.value", n3.push({
                priority: 100,
                dropdown: {
                  icon: "recipe-watcher.runCommand",
                  name: "AI COMMAND"
                },
                task: e3
              });
            }
            return n3;
          },
          async updateCommandTemplate(e2) {
            e2.records[0] = this._recordValue(
              "Automate your work, schedule AI powered command to run periodically",
              e2.inputs.command.name || "No Command",
              null,
              "ok",
              null,
              false
            );
          },
          async buildChangesTemplates(e2) {
            let { text: t3, template: n3 } = e2;
            const a3 = [];
            t3 = t3.toLowerCase();
            const i3 = [
              "out of stock",
              "not in stock",
              "not available",
              "unavailable"
            ];
            for (const r2 of i3) {
              if (!o2.occurrences.regex(t3, r2)) continue;
              const i4 = n3();
              i4.inputs["watcher.changes"].whatToMonitor = "text", i4.inputs["watcher.trigger"].monitorChangesText = "missing-text", i4.inputs["watcher.trigger"].monitorChangesHtml = "missing-text", i4.inputs.trigger.color = "positive", i4.inputs.trigger.searchText = r2, await this.updateChangesTemplate(i4, e2), a3.push({ priority: 20, task: i4 });
              break;
            }
            {
              const t4 = n3();
              t4.inputs["watcher.changes"].whatToMonitor = "text", t4.inputs["watcher.trigger"].monitorChangesText = "contains-text", t4.inputs["watcher.trigger"].monitorChangesHtml = "contains-text", t4.inputs.trigger.color = "positive", t4.inputs.trigger.searchText = "discount\nrabatt\nrabat\nalennus\ndiskon\nsleva\nsconto\ndescuento", await this.updateChangesTemplate(t4, e2), a3.push({ priority: 30, task: t4 });
            }
            {
              const t4 = n3();
              t4.inputs["watcher.changes"].whatToMonitor = "text", t4.inputs["watcher.trigger"].monitorChangesText = "content-changes", t4.inputs["watcher.trigger"].monitorChangesHtml = "content-changes", t4.inputs.trigger.color = "positive", await this.updateChangesTemplate(t4, e2), a3.push({ priority: 40, task: t4 });
            }
            {
              const t4 = n3();
              t4.inputs["watcher.changes"].whatToMonitor = "text", t4.inputs["watcher.trigger"].monitorChangesText = "content-changes", t4.inputs["watcher.trigger"].monitorChangesHtml = "content-changes", t4.inputs.trigger.color = "positive", t4.records.push(this.compare(t4, null, e2)), a3.push({
                priority: 20,
                dropdown: {
                  icon: "recipe-watcher.monitorChanges",
                  name: "MONITOR PAGE UPDATES"
                },
                task: t4
              });
            }
            return a3;
          },
          async updateChangesTemplate(e2, t3) {
            const n3 = this.compare(e2, null, t3);
            if (!e2.dropdown) {
              const t4 = this._triggerCondition(e2);
              if (t4 === "content-changes" || t4 === "none")
                n3.value = 10, n3.info = "Monitors page content for changes, reports change percentage";
              else if (t4 === "contains-text") {
                const t5 = e2.inputs.trigger.searchText.split("\n").filter((e3) => !!e3)[0] || "";
                n3.info = `Monitors ${t5.toUpperCase()} text, alerts if it is found on page`;
              } else if (t4 === "missing-text") {
                const t5 = e2.inputs.trigger.searchText.split("\n").filter((e3) => !!e3)[0] || "";
                n3.info = `Monitors ${t5.toUpperCase()} text, alerts if it is missing`;
              }
            }
            const a3 = e2.records.length === 0 ? 0 : e2.records.length - 1;
            e2.records[a3] = n3;
          },
          async buildElementTemplates(e2) {
            const { page: t3, data: n3, template: a3 } = e2;
            let o3 = [];
            e: {
              const i3 = n3.filter((e3) => e3.type === "price").filter((e3) => e3.value !== 0).sort(this._sortByVisibility);
              if (i3.length === 0) break e;
              const r2 = [], s2 = /* @__PURE__ */ new Set();
              for (const e3 of i3)
                if (!s2.has(e3.value) && (s2.add(e3.value), r2.push(e3), r2.length >= 3))
                  break;
              for (const n4 of r2) {
                e2.item = n4;
                const i4 = a3();
                i4.inputs["watcher.trigger"].monitorElement = "value-is-down", i4.inputs.trigger.color = "positive", i4.inputs.changeUpIs.value = "bad", i4.state.item = n4;
                const r3 = await t3.inspect(n4.container, { computeAiLocator: true });
                r3.locator.selector.push({ $parse: "price", at: n4.at }), i4.inputs["watcher.element"].selector = r3.locator.selector, await this.updateElementTemplate(i4, e2), o3.push({ priority: 10, task: i4 });
              }
            }
            e: {
              const i3 = /* @__PURE__ */ new Set();
              n3.filter((e3) => e3.type === "time" || e3.type === "date").forEach(
                (e3) => e3.elements.forEach((e4) => i3.add(e4.id))
              );
              const r2 = n3.filter((e3) => e3.type === "number").filter((e3) => e3.value !== 0).filter((e3) => !e3.elements.some((e4) => i3.has(e4.id))).sort(this._sortByVisibility);
              if (r2.length === 0) break e;
              const s2 = /* @__PURE__ */ new Set(), l2 = [];
              for (const e3 of r2)
                if (!s2.has(e3.value) && (s2.add(e3.value), l2.push(e3), l2.length >= 3))
                  break;
              for (const n4 of l2) {
                e2.item = n4;
                const i4 = a3();
                i4.inputs["watcher.trigger"].monitorElement = "value-changes", i4.inputs.trigger.color = "positive", i4.inputs.changeUpIs.value = "good", i4.state.item = n4;
                const r3 = await t3.inspect(n4.container, { computeAiLocator: true });
                r3.locator.selector.push({ $parse: "number", at: n4.at }), i4.inputs["watcher.element"].selector = r3.locator.selector, await this.updateElementTemplate(i4, e2), o3.push({ priority: 50, task: i4 });
              }
            }
            e: {
              const i3 = this.biggestItem(n3);
              if (!i3) break e;
              e2.item = i3;
              const r2 = a3();
              r2.inputs["watcher.trigger"].monitorElement = "value-changes", r2.inputs.trigger.color = "positive", r2.inputs.changeUpIs.value = "good", r2.state.item = i3;
              const s2 = await t3.inspect(i3.container, { computeAiLocator: true });
              s2.locator.selector.push({ $parse: "text", at: 0 }), r2.inputs["watcher.element"].selector = s2.locator.selector, r2.records.push(this.compare(r2, null, e2)), o3.push({
                priority: 50,
                dropdown: {
                  icon: "recipe-watcher.monitorElement",
                  name: "MONITOR ELEMENT"
                },
                task: r2
              });
            }
            return o3;
          },
          _sortByVisibility: (e2, t3) => e2.data.isVisible && !t3.data.isVisible ? -1 : !e2.data.isVisible && t3.data.isVisible ? 1 : e2.data.isInViewport && !t3.data.isInViewport ? -1 : !e2.data.isInViewport && t3.data.isInViewport ? 1 : e2.data.isInViewport ? e2.cr.top - t3.cr.top : t3.data.fontSize !== e2.data.fontSize ? t3.data.fontSize - e2.data.fontSize : e2.cr.top - t3.cr.top,
          async updateElementTemplate(e2, t3) {
            t3 = { ...t3, item: e2.state.item };
            const n3 = this._monitoredElementType(e2);
            let a3 = this._triggerCondition(e2);
            a3 = {
              "value-is-up": "increases",
              "value-is-down": "drops",
              "value-contains-text": "contains text",
              "value-missing-text": "missing text",
              "item-is-removed": "removed"
            }[a3] || "changes";
            const o3 = this.compare(e2, null, t3);
            e2.dropdown || (o3.info = `Monitors ${n3} element and alerts if it ${a3}`), e2.records[0] = o3;
          },
          async storeElementTemplate(e2) {
            e2.state?.item && delete e2.state.item;
          },
          async buildPriceTemplates(e2) {
            const { template: t3 } = e2, n3 = [];
            {
              const a3 = t3();
              a3.inputs["watcher.trigger"].monitorElement = "value-changes", a3.inputs.trigger.color = "positive", a3.inputs.changeUpIs.value = "bad", await this.updatePriceTemplate(a3, e2), n3.push({
                priority: 10,
                dropdown: {
                  icon: "recipe-watcher.monitorPrice",
                  name: "MONITOR PRICE"
                },
                task: a3
              });
            }
            return n3;
          },
          async updatePriceTemplate(e2, t3) {
            e2.records[0] = this.compare(e2, null, t3);
          },
          async buildHealthTemplates(e2) {
            const { template: t3 } = e2, n3 = [];
            {
              const a3 = t3();
              a3.inputs.trigger.icon = "alert", a3.inputs.trigger.color = "positive", a3.inputs.schedule.mediumType = "tab", a3.inputs.schedule.periodical.frequency = "5m", a3.inputs.schedule.autoCloseTab = false, a3.records.push({
                ...this.compare(a3, null, e2),
                info: "Auto-refreshes page and monitors it's status. Useful to auto-refresh data dashboards and manual monitoring."
              }), n3.push({ priority: 60, task: a3 });
            }
            {
              const a3 = t3();
              a3.inputs.trigger.icon = "alert", a3.inputs.trigger.color = "positive", a3.inputs.schedule.mediumType = "hidden-tab", a3.records.push(this.compare(a3, null, e2)), n3.push({
                priority: 30,
                dropdown: {
                  icon: "status-heart-ok",
                  name: "MONITOR PAGE HEALTH"
                },
                task: a3
              });
            }
            {
              const a3 = t3();
              a3.inputs.trigger.icon = "alert", a3.inputs.trigger.color = "positive", a3.inputs.schedule.mediumType = "tab", a3.inputs.schedule.periodical.frequency = "5m", a3.inputs.schedule.autoCloseTab = false, a3.records.push(this.compare(a3, null, e2)), n3.push({
                priority: 60,
                dropdown: {
                  icon: "recipe-watcher.monitorHealth",
                  name: "AUTO-REFRESH PAGE"
                },
                task: a3
              });
            }
            return n3;
          },
          async updateHealthTemplate(e2, t3) {
            const n3 = this.compare(e2, null, t3);
            e2.dropdown || (n3.info = "Auto-refreshes page and monitors it's status. Useful to auto-refresh data dashboards and manual monitoring."), e2.records[0] = n3;
          },
          biggestItem: (e2) => e2.filter((e3) => e3.type === "text" && e3.data).sort(
            (e3, t3) => e3.data.isVisible && !t3.data.isVisible ? -1 : !e3.data.isVisible && t3.data.isVisible ? 1 : e3.data.isInViewport && !t3.data.isInViewport ? -1 : !e3.data.isInViewport && t3.data.isInViewport ? 1 : e3.data.tag === "H1" && t3.data.tag !== "H1" ? -1 : e3.data.tag !== "H1" && t3.data.tag === "H1" ? 1 : t3.data.fontSize - e3.data.fontSize
          )[0],
          async queryItem(e2, t3) {
            if (typeof t3 == "string") {
              if (t3.trim().length === 0)
                return { type: "warning", content: "Selector is empty" };
              try {
                t3 = a2.load(t3);
              } catch (e3) {
                return {
                  type: "warning",
                  content: "Selector is not a CSS / XPath / HARPA query"
                };
              }
            }
            let i3 = null;
            try {
              i3 = n2.Locator.of(t3, e2);
            } catch (e3) {
              return {
                type: "warning",
                content: o2.string.toCapitalFirst(e3.message)
              };
            }
            let r2 = await e2.query(i3, { noThrow: true, mult: true });
            return r2 instanceof Error ? { type: "warning", content: r2.message } : r2.length === 0 ? null : r2.length > 1 ? {
              type: "warning",
              content: `Found ${r2.length} elements matching selector`
            } : (r2 = r2[0], r2 instanceof n2.Element ? { type: "element", value: await e2.content(r2) } : o2.removeKeys({
              type: r2.type,
              value: r2.value,
              metric: r2.metric,
              content: r2.content,
              context: r2.context,
              index: r2.index
            }));
          },
          findPrice(e2, t3, n3 = false) {
            t3 = t3 || [];
            const a3 = (e3) => {
              if (n3) return null;
              throw new Error(e3);
            };
            let i3 = this.filterItemsByType(t3, "price");
            if (i3.length === 0) return a3("No prices found on page");
            let { pickup: r2, anchorText: s2, n: l2 } = e2.inputs["watcher.price"];
            if (r2 === "visually-largest") {
              const e3 = (e4) => e4.context.length / e4.content.length > 4 ? 1.2 * e4.data.fontSize : e4.cr.bottom - e4.cr.top;
              return i3.reduce((t4, n4) => e3(t4) > e3(n4) ? t4 : n4);
            }
            if (r2 === "first") return i3[0];
            if (r2 === "last") return i3.at(-1);
            if (r2 === "nth") {
              if ((!l2 || l2 < 1) && (l2 = 1), l2 > i3.length) {
                const e3 = i3.length === 1 ? "price" : "prices";
                return a3(`Only ${i3.length} ${e3} found on page`);
              }
              return i3[l2 - 1];
            }
            if (r2 === "lowest" || r2 === "highest" || r2 === "average" || r2 === "median") {
              const e3 = o2.frequency(i3, (e4) => e4.metric), t4 = Array.from(e3.entries()).reduce(
                (e4, t5) => t5[1] > e4[1] ? t5 : e4
              )[0];
              if (i3 = i3.filter((e4) => e4.metric === t4), r2 === "lowest")
                return i3.reduce((e4, t5) => e4.value > t5.value ? t5 : e4);
              if (r2 === "highest")
                return i3.reduce((e4, t5) => e4.value < t5.value ? t5 : e4);
              if (r2 === "average")
                return {
                  type: "price",
                  value: i3.reduce((e4, t5) => e4 + t5.value, 0) / i3.length,
                  metric: t4
                };
              if (r2 === "median") {
                const e4 = i3.slice().sort((e5, t5) => e5.value - t5.value), n4 = Math.floor(e4.length / 2);
                return {
                  type: "price",
                  value: e4.length % 2 == 0 ? (e4[n4 - 1].value + e4[n4].value) / 2 : e4[n4].value,
                  metric: t4
                };
              }
            }
            if (r2 === "closest-to") {
              if (!s2) return i3[0];
              const e3 = this.filterItemsByType(t3, "text").filter(
                (e4) => o2.occurrences.regex(e4.value, s2)
              );
              if (e3.length === 0) return a3("No elements found for anchor text");
              const n4 = (e4) => e4.left + (e4.right - e4.left) / 2, r3 = (e4) => e4.top + (e4.bottom - e4.top) / 2, c2 = (e4, t4) => Math.pow(n4(e4) - n4(t4), 2) + Math.pow(r3(e4) - r3(t4), 2);
              let u2 = [];
              if (i3.forEach(
                (t4) => u2.push({
                  p: t4,
                  d: e3.reduce(
                    (e4, n5) => Math.min(e4, c2(n5.cr, t4.cr)),
                    Number.MAX_VALUE
                  )
                })
              ), u2 = u2.sort((e4, t4) => e4.d - t4.d), (!l2 || l2 < 1) && (l2 = 1), l2 > u2.length) {
                const e4 = i3.length === 1 ? "price" : "prices";
                return a3(`Only ${i3.length} ${e4} found on page`);
              }
              return u2[l2 - 1].p;
            }
            return a3(`Pickup parameter ${r2} not supported`);
          },
          filterItemsByType(e2, t3) {
            const n3 = e2 || [];
            return t3 ? n3.filter((e3) => e3.type === t3) : n3;
          },
          reduceTaskStorage(e2, t3) {
            if (!e2 || !t3) return;
            const n3 = t3.first || {}, a3 = t3.last || {}, { recipeId: o3, inputs: i3 } = e2;
            o3 !== "watcher.monitorHealth" && (delete n3.prefetch, delete a3.prefetch), o3 !== "watcher.monitorElement" && (delete n3.item, delete a3.item), o3 === "watcher.monitorChanges" && i3["watcher.changes"].whatToMonitor === "data" || (delete n3.data, delete a3.data), o3 === "watcher.monitorChanges" && i3["watcher.changes"].whatToMonitor === "html" || (delete n3.html, delete a3.html), o3 !== "monitorChanges" && i3["watcher.changes"].whatToMonitor !== "text" && (delete n3.text, delete a3.text), n3?.error || delete n3.error, a3?.error || delete a3.error;
          },
          _monitoredElementType: (e2) => {
            const t3 = e2.inputs["watcher.element"]?.selector;
            if (!Array.isArray(t3)) return "element";
            return t3.filter((e3) => e3.$parse).at(-1)?.$parse || "element";
          },
          compare(e2, t3, n3) {
            try {
              const a3 = {
                task: e2,
                previous: t3,
                current: n3,
                trigger: this._trigger(e2),
                condition: this._triggerCondition(e2)
              };
              switch (e2.recipeId) {
                case "watcher.monitorHealth":
                  return a3.config = e2.inputs["watcher.health"], this._compareHealth(a3);
                case "watcher.monitorPrice":
                  return a3.config = e2.inputs["watcher.price"], this._comparePrice(a3);
                case "watcher.monitorElement":
                  return a3.config = e2.inputs["watcher.element"], this._compareElement(a3);
                case "watcher.monitorChanges":
                  return a3.config = e2.inputs["watcher.changes"], this._compareChanges(a3);
                default:
                  return this._recordError(
                    "This automation task is under development",
                    "Under Dev"
                  );
              }
            } catch (e3) {
              return console.error("comparing watcher data failed:", e3), this._recordError(e3.message, e3.value);
            }
          },
          _compareHealth({ current: e2, trigger: t3, condition: n3 }) {
            if (!e2) return this._recordWarning("Could not fetch page status");
            const { statusCode: a3, statusText: o3 } = e2.prefetch, i3 = a3 >= 200 && a3 <= 299, r2 = `<b>${a3 || 0} / ${o3 || "Unknown"}</b>`;
            let s2 = i3 ? `Page is <b>UP</b> with status ${r2}` : `Page is <b>DOWN</b> with status ${r2}`, l2 = false;
            if (n3 === "web-page-is-down" && (l2 = !i3), n3 === "web-page-is-up" && (l2 = i3), n3 === "web-page-returns-http-code") {
              const e3 = String(a3);
              l2 = t3.httpCodes.some(
                (t4) => e3.length === t4.length && [...e3].every((e4, n4) => t4[n4] === "x" || t4[n4] === e4)
              );
            }
            return this._recordValue(
              s2,
              i3 ? "Up" : "Down",
              null,
              l2 ? t3.icon : i3 ? "heart-ok" : "heart-nok",
              l2 ? t3.color : null,
              l2
            );
          },
          _comparePrice({ task: e2, current: t3, trigger: n3, condition: a3 }) {
            if (!t3)
              return this._recordWarning("Could not parse prices from page");
            let i3 = null;
            {
              const t4 = e2.records.at(-1);
              t4?.metric?.startsWith("CUR:") && (i3 = { value: t4.value, metric: t4.metric });
            }
            let r2 = null;
            try {
              r2 = this.findPrice(e2, t3?.data);
            } catch (e3) {
              return this._recordWarning(e3.message);
            }
            const s2 = e2.inputs.changeUpIs.value, { x: l2, y: c2 } = n3, u2 = `<b>${o2.formatter.format(l2, null, { long: true })}</b>`, p2 = (e3) => {
              if (!e3) return null;
              return `<b>${o2.formatter.format(e3.value, e3.metric, { long: true, currencyFormat: "namePlural" })}</b>`;
            }, d2 = p2(i3), m2 = p2(r2);
            let h = false, g = `Parsed ${m2}`;
            a3 === "price-changes" && (h = Boolean(i3 && i3.value !== r2.value), g = h ? `Changed ${d2} \u2192 ${m2}` : `Parsed ${m2}`), a3 === "price-is-up" && (h = Boolean(i3 && i3.value < r2.value), g = h ? `Price UP ${d2} \u2192 ${m2}` : `Parsed ${m2}`), a3 === "price-is-down" && (h = Boolean(i3 && i3.value > r2.value), g = h ? `Price DOWN ${d2} \u2192 ${m2}` : `Parsed ${m2}`), a3 === "price-is-over-x" && (h = r2.value > l2, g = h ? `Price ${m2} is over ${u2}` : `Parsed ${m2}`), a3 === "price-is-under-x" && (h = r2.value < l2, g = h ? `Price ${m2} is below ${u2}` : `Parsed ${m2}`), a3 === "price-is-within-x-y" && (h = r2.value >= l2 && r2.value <= c2, g = h ? `Price ${m2} is in range` : `Parsed ${m2}`), a3 === "price-is-outside-x-y" && (h = r2.value < l2 || r2.value > c2, g = h ? `Price ${m2} is not in range` : `Parsed ${m2}`);
            return this._recordValue(
              g,
              r2.value,
              r2.metric,
              h ? n3.icon : i3 ? i3.value < r2.value ? "up" : i3.value > r2.value ? "down" : "ok" : "ok",
              h ? n3.color : s2 && s2 !== "neutral" && i3 ? i3.value < r2.value ? s2 === "good" ? "positive" : "negative" : i3.value > r2.value ? s2 === "good" ? "negative" : "positive" : null : null,
              h
            );
          },
          _compareElement({
            task: e2,
            previous: t3,
            current: n3,
            trigger: a3,
            condition: i3
          }) {
            if (!n3)
              return this._recordWarning("Could not parse elements from page");
            if (n3?.item?.type === "warning")
              return this._recordWarning(n3.item.content);
            if (n3?.item?.type === "error")
              return this._recordError(n3.item.content);
            const r2 = e2.inputs.changeUpIs.value, { itemParameter: s2, x: l2, y: c2, searchText: u2 } = a3, p2 = `<b>${o2.formatter.format(l2, null, { long: true })}</b>`, d2 = (e3) => {
              if (!e3?.item) return { content: null, text: "N/A" };
              const t4 = {
                content: e3.item,
                type: e3.item.type,
                metric: e3.item.metric,
                value: e3.item.value,
                text: `<b>${e3.item.content || e3.item.value}</b>`
              };
              return t4.type === "link" && s2 === "content" && (t4.value = t4.content.content), t4.metric = t4.metric || t4.type, t4;
            };
            let m2 = false;
            const h = d2(t3), g = d2(n3);
            if (i3 === "item-is-removed")
              return m2 = !n3?.item, this._recordValue(
                m2 ? `Item ${h.text} is removed from page` : `Item ${g.text} is found on page`,
                g.content ? "Found" : "Missing",
                null,
                m2 ? a3.icon : "ok",
                m2 ? a3.color : null,
                m2
              );
            if (!g.content)
              return this._recordWarning("Could not find element on page");
            let f = `Parsed ${g.text}`, y = g.value, b = g.metric;
            const w = (e3) => typeof e3.value == "string" ? e3.value.length : Number(e3.value) || 0;
            if (i3 === "value-changes" && (m2 = Boolean(h.content && h.value !== g.value), f = m2 ? `Changed ${h.text} \u2192 ${g.text}` : `Parsed ${g.text}`), i3 === "value-is-up" && (m2 = Boolean(h.content && w(h) < w(g)), f = m2 ? `Value UP ${h.text} \u2192 ${g.text}` : `Parsed ${g.text}`), i3 === "value-is-down" && (m2 = Boolean(h.content && w(h) > w(g)), f = m2 ? `Value DOWN ${h.text} \u2192 ${g.text}` : `Parsed ${g.text}`), i3 === "value-is-over-x" && (m2 = w(g) > l2, f = m2 ? `Value ${g.text} is over ${p2}` : `Parsed ${g.text}`), i3 === "value-is-under-x" && (m2 = w(g) < l2, f = m2 ? `Value ${g.text} is below ${p2}` : `Parsed ${g.text}`), i3 === "value-is-within-x-y" && (m2 = w(g) >= l2 && w(g) <= c2, f = m2 ? `Value ${g.text} is in range` : `Parsed ${g.text}`), i3 === "value-is-outside-x-y" && (m2 = w(g) < l2 || w(g) > c2, f = m2 ? `Value ${g.text} is not in range` : `Parsed ${g.text}`), i3 === "value-contains-text" || i3 === "value-missing-text") {
              const e3 = o2.occurrences.regex(String(g.value), u2), t4 = e3 === 1 ? "once" : e3 + " times";
              m2 = i3 === "value-contains-text" ? e3 > 0 : e3 === 0, f = e3 > 0 ? `Search text is found <b>${t4}</b>` : "Search text is not found", y = e3, b = null;
            }
            return this._recordValue(
              f,
              y,
              b,
              (() => {
                if (m2) return a3.icon;
                if (!h.content) return "ok";
                const e3 = typeof h.value == "string" ? h.value.length : h.value, t4 = typeof g.value == "string" ? g.value.length : g.value;
                return e3 < t4 ? "up" : e3 > t4 ? "down" : "ok";
              })(),
              (() => {
                if (m2) return a3.color;
                if (!r2 || r2 === "neutral") return null;
                if (!h.content) return null;
                const e3 = typeof h.value == "string" ? h.value.length : h.value, t4 = typeof g.value == "string" ? g.value.length : g.value;
                return e3 < t4 ? r2 === "good" ? "positive" : "negative" : e3 > t4 ? r2 === "good" ? "negative" : "positive" : null;
              })(),
              m2
            );
          },
          _compareChanges({
            task: e2,
            previous: t3,
            current: n3,
            trigger: a3,
            condition: i3,
            config: r2
          }) {
            if (t3 = t3 || {}, !n3)
              return this._recordWarning("Could not parse page content");
            const { whatToMonitor: s2, itemTypes: l2 } = r2, c2 = e2.inputs.changeUpIs.value, u2 = a3.searchText, p2 = a3.minThreshold || 0, d2 = (e3, t4) => e3 ? a3.color : !t4 || t4 <= 0 ? null : c2 && c2 !== "neutral" ? c2 === "good" ? "positive" : "negative" : null, m2 = (e3, t4) => e3 ? a3.icon : !t4 || t4 <= 0 ? "nok" : "up";
            if (s2 === "data") {
              let e3 = n3.data;
              if (!e3) return this._recordWarning("Page data is not available");
              let a4 = t3.data;
              if (!a4)
                return this._recordValue(
                  "Page data has not changed",
                  0,
                  "%",
                  "ok"
                );
              l2 && (a4 = a4.filter((e4) => l2.includes(e4.type)), e3 = e3.filter((e4) => l2.includes(e4.type)));
              const o3 = {}, r3 = { added: 0, removed: 0 };
              a4.forEach((e4) => {
                const { type: t4, value: n4 } = e4;
                o3[t4] || (o3[t4] = /* @__PURE__ */ new Map());
                const a5 = o3[t4].get(n4) || 0;
                o3[t4].set(n4, a5 - 1);
              }), e3.forEach((e4) => {
                const { type: t4, value: n4 } = e4;
                o3[t4] || (o3[t4] = /* @__PURE__ */ new Map());
                const a5 = o3[t4].get(n4) || 0;
                o3[t4].set(n4, a5 + 1);
              }), Object.values(o3).forEach((e4) => {
                Array.from(e4.values()).forEach((e5) => {
                  e5 < 0 ? r3.removed++ : e5 > 0 && r3.added++;
                });
              }), r3.total = Math.max(a4.length, e3.length), r3.changed = Math.max(r3.added, r3.removed);
              const s3 = 100 * r3.changed == 0 ? 0 : r3.changed / r3.total, c3 = `<b>${s3.toFixed(1)}%</b>`;
              if (s3 == 0)
                return this._recordValue(
                  "Page content has not changed",
                  0,
                  "%",
                  "ok"
                );
              const u3 = i3 !== "none" && s3 >= p2;
              return this._recordValue(
                s3 < 0.01 ? "Page data has changed" : `${c3} of page data has changed`,
                s3,
                "%",
                m2(u3, s3),
                d2(u3, s3),
                u3
              );
            }
            if (s2 === "html" || s2 === "text") {
              if (t3 = s2 === "text" ? t3.text : t3.html, !(n3 = s2 === "text" ? n3.text : n3.html))
                return this._recordWarning("Page content is not available");
              if (s2 === "html" && (t3 = this._replaceInjectedHtml(t3), n3 = this._replaceInjectedHtml(n3)), i3 === "contains-text" || i3 === "missing-text") {
                const e3 = o2.occurrences.regex(n3, u2), t4 = i3 === "contains-text" ? e3 > 0 : e3 === 0;
                return this._recordValue(
                  e3 === 0 ? "Search text is not found on page" : e3 === 1 ? "Search text is found <b>1</b> time" : `Search text is found <b>${e3}</b> times`,
                  e3,
                  "matches",
                  m2(t4, e3),
                  d2(t4, e3),
                  t4
                );
              }
              if (i3 === "none" || i3 === "content-changes") {
                if (!t3)
                  return this._recordValue(
                    "Page content has not changed",
                    0,
                    "%",
                    "ok"
                  );
                const e3 = 100 * o2.diff(t3, n3, s2), a4 = `<b>${e3.toFixed(1)}%</b>`;
                if (e3 == 0)
                  return this._recordValue(
                    "Page content has not changed",
                    0,
                    "%",
                    "ok"
                  );
                const r3 = i3 !== "none" && e3 >= p2;
                return this._recordValue(
                  e3 < 0.01 ? "Page content has changed" : `${a4} of page content has changed`,
                  e3,
                  "%",
                  m2(r3, e3),
                  d2(r3, e3),
                  r3
                );
              }
              return this._recordError(`Condition ${i3} is not supported`);
            }
            return this._recordError(`Monitoring ${s2} is not supported`);
          },
          _replaceInjectedHtml(e2) {
            if (!e2) return;
            return [/__hrp="[^"']+"/g, /<__hrp__[^<]+<\/__hrp__>/g].forEach((t3) => {
              e2 = e2.replaceAll(t3, "");
            }), e2;
          },
          _recordValue(e2, t3, n3, a3, o3, i3) {
            const r2 = { ms: Date.now(), value: t3 };
            return e2 && (r2.info = e2), n3 && (r2.metric = n3), a3 && (r2.status = a3), o3 && (r2.color = o3), i3 && (r2.triggered = i3), r2;
          },
          _recordError: (e2, t3) => ({
            ms: Date.now(),
            info: e2,
            value: t3,
            status: "error",
            color: "sublime"
          }),
          _recordWarning: (e2, t3) => ({
            ms: Date.now(),
            info: e2,
            value: t3,
            status: "warning",
            color: "sublime"
          }),
          _trigger: (e2) => ({
            ...e2.inputs["watcher.trigger"],
            ...e2.inputs.trigger
          }),
          _triggerCondition(e2) {
            const t3 = this._trigger(e2);
            switch (e2.recipeId) {
              case "watcher.monitorHealth":
                return t3.monitorHealth;
              case "watcher.monitorPrice":
                return t3.monitorPrice;
              case "watcher.monitorElement":
                return t3.monitorElement;
              case "watcher.monitorChanges": {
                const n3 = e2.inputs["watcher.changes"].whatToMonitor;
                if (n3 === "html") return t3.monitorChangesHtml;
                if (n3 === "data") return t3.monitorChangesData;
                if (n3 === "text") return t3.monitorChangesText;
                throw new Error(`monitoring ${n3} is not supported`);
              }
              default:
                return null;
            }
          },
          _isCondition(e2, t3, n3) {
            const a3 = this._trigger(e2);
            return n3.includes(a3[t3]);
          }
        };
      })(), (() => {
        const { $recipe: t2 } = e;
        t2.inputs.actions = {
          get state() {
            const e2 = { sendOn: "first-trigger", limitActions: "do-not-limit" }, t3 = { sendOn: "task-success", limitActions: "do-not-limit" };
            return {
              widget: { enabled: true },
              notification: { enabled: true, ...e2 },
              sound: {
                enabled: false,
                value: "sound:sonar",
                utterance: "Task triggered",
                volume: 50,
                ...e2
              },
              email: {
                enabled: false,
                to: "",
                customSmtpEnabled: false,
                customSmtpFrom: '"HARPA AI Web Monitor" <monitor@harpa.ai>',
                customSmtpHost: "smtp.gmail.com:465",
                customSmtpUsername: "",
                customSmtpPassword: "",
                ...e2,
                limitActions: "once-a-day"
              },
              webhook: {
                enabled: false,
                url: "https://webhook.site/...",
                basicAuthEnabled: false,
                basicAuthUsername: "",
                basicAuthPassword: "",
                ...t3
              },
              make: { enabled: false, url: "https://hook.eu1.make.com/...", ...t3 },
              push: { enabled: false, ...e2 },
              sms: { enabled: false, ...e2 },
              slack: { enabled: false, ...e2 },
              telegram: { enabled: false, ...e2 },
              discord: { enabled: false, ...e2 },
              zapier: { enabled: false, ...t3 }
            };
          },
          get persistState() {
            return true;
          }
        };
      })(), (() => {
        const { $recipe: t2 } = e;
        t2.inputs.before = {
          get state() {
            return {
              idleCheck: { enabled: true, timeout: 15, onTimeout: "carry-on" },
              textCheck: {
                enabled: false,
                searchText: "",
                timeout: 15,
                onTimeout: "report-error"
              },
              dropBanners: { enabled: false, text: "cookie" },
              scroll: { enabled: false, maxDuration: 15 }
            };
          },
          get persistState() {
            return true;
          }
        };
      })(), (() => {
        const { $recipe: t2 } = e;
        t2.inputs.changeUpIs = {
          get state() {
            return { value: "neutral" };
          },
          get persistState() {
            return true;
          }
        };
      })(), (() => {
        const { $recipe: t2 } = e;
        t2.inputs.command = {
          get state() {
            return {
              name: null,
              inputs: [],
              result: "message",
              connectionId: null,
              connectionName: null,
              timeout: 300,
              resetChat: true
            };
          },
          get persistState() {
            return true;
          }
        };
      })(), (() => {
        const { $recipe: t2 } = e;
        t2.inputs.page = {
          get state() {
            return { url: null, timeout: 30 };
          },
          get persistState() {
            return true;
          }
        };
      })(), (() => {
        const { $recipe: t2 } = e;
        t2.inputs.schedule = {
          get state() {
            return {
              type: "periodical",
              periodical: { frequency: "3h" },
              interval: {},
              week: {},
              month: {},
              mediumType: "hidden-tab",
              mediumId: null,
              autoCloseTab: true
            };
          },
          get persistState() {
            return true;
          }
        };
      })(), (() => {
        const { $recipe: t2 } = e;
        t2.inputs.tracking = {
          get state() {
            return { value: "between-checks" };
          },
          get persistState() {
            return true;
          }
        };
      })(), (() => {
        const { $recipe: t2 } = e;
        t2.inputs.trigger = {
          get state() {
            return {
              minThreshold: 5,
              searchText: "discount\noff\npromo",
              httpCodes: ["4xx", "5xx"],
              x: 89.99,
              y: 99.99,
              itemParameter: "value",
              icon: "alert",
              color: "negative",
              doubleCheck: "off"
            };
          },
          get persistState() {
            return true;
          }
        };
      })(), (() => {
        const { $recipe: t2 } = e;
        t2.inputs.ua = {
          get state() {
            return {
              vlang: null,
              vua: null,
              customViewport: false,
              viewportWidth: null,
              viewportHeight: null
            };
          },
          get persistState() {
            return true;
          }
        };
      })(), (() => {
        const { $recipe: t2 } = e;
        t2.inputs["watcher.changes"] = {
          get state() {
            return {
              whatToMonitor: "html",
              itemTypes: [
                "text",
                "icon",
                "image",
                "video",
                "link",
                "date",
                "time",
                "copyright",
                "number",
                "currency",
                "price"
              ]
            };
          }
        };
      })(), (() => {
        const { $recipe: t2 } = e;
        t2.inputs["watcher.element"] = {
          get state() {
            return { selector: null, selectorType: "ai" };
          }
        };
      })(), (() => {
        const { $recipe: t2 } = e;
        t2.inputs["watcher.price"] = {
          get state() {
            return { pickup: "visually-largest", n: 1, anchorText: "" };
          }
        };
      })(), (() => {
        const { $recipe: t2 } = e;
        t2.inputs["watcher.trigger"] = {
          get state() {
            return {
              monitorChangesText: "content-changes",
              monitorChangesHtml: "content-changes",
              monitorChangesData: "content-changes",
              monitorElement: "value-changes",
              monitorPrice: "price-changes",
              monitorHealth: "web-page-is-down"
            };
          }
        };
      })(), (() => {
        const { $recipe: t2, $utils: n2 } = e;
        t2.steps["watcher.actions"] = {
          config: { name: "Dispatch actions on trigger" },
          async run({ ctx: e2, step: t3 }) {
            let a2 = Object.entries(e2.inputs.actions).filter(
              ([e3, t4]) => e3 !== "widget" && t4.enabled
            );
            if (a2.length === 0)
              return void (t3.status.content = "All actions disabled");
            const o2 = e2.record?.triggered, i2 = e2.records.at(-1);
            a2 = a2.filter((t4) => {
              const [a3, r3] = t4, { sendOn: s2, limitActions: l2 } = r3;
              if (s2 === "task-success") ;
              else if (s2 === "every-trigger") {
                if (!o2) return false;
              } else if (s2 === "first-trigger") {
                if (!o2) return false;
                if (i2?.triggered) return false;
              }
              if (l2 !== "do-not-limit") {
                const t5 = e2.records.findLast((e3) => e3.dispatched?.includes(a3)), o3 = (e2.record.ms - (t5?.ms || 0)) / n2.time.HOUR, i3 = 5 / 60;
                if (l2 === "once-an-hour" && o3 < 1 - i3 || l2 === "once-3-hours" && o3 < 3 - i3 || l2 === "once-a-day" && o3 < 24 - i3 || l2 === "once-a-week" && o3 < 168 - i3)
                  return false;
              }
              return true;
            }), e2.record.dispatched = a2.length === 0 ? null : a2.map((e3) => e3[0]);
            const r2 = a2.map((e3) => e3[0]).join(", ");
            t3.status.content = a2.length === 0 ? "No actions dispatched" : a2.length === 1 ? `Dispatched 1 action: <b>${r2}</b>` : `Dispatched ${a2.length} actions: <b>${r2}</b>`, a2 = a2.map((e3) => ({ type: e3[0] })).map(
              (t4) => (t4.records = [...e2.records, e2.record], t4.type === "notification" ? (t4.title = e2.taskName, t4.message = e2.record.info, t4.status = e2.record.status, t4.color = e2.record.color, t4.onClick = {
                tabId: e2.inputs.schedule?.mediumId,
                url: e2.inputs.page.url
              }) : t4.type === "sound" && (t4.id = e2.inputs.actions.sound.value, t4.volume = e2.inputs.actions.sound.volume, t4.message = `${e2.inputs.actions.sound.utterance}.

${e2.record.info}`.replaceAll(
                " \u2192 ",
                " to "
              )), t4)
            ), await e2.api.runActions(a2);
          }
        };
      })(), (() => {
        const { $recipe: t2, $utils: n2 } = e;
        t2.steps["watcher.before"] = {
          config: { name: "Wait for page to load" },
          async run({ ctx: e2, step: t3 }) {
            const {
              idleCheck: a2,
              dropBanners: o2,
              scroll: i2,
              textCheck: r2
            } = e2.inputs.before;
            let s2 = false;
            if (a2.enabled) {
              s2 = true;
              const t4 = a2.onTimeout;
              try {
                const t5 = 1e3 * a2.timeout;
                await e2.page.idle({ timeout: t5 });
              } catch (e3) {
                if (e3.message === "timeout" && ["report-error", "report-warning"].includes(t4))
                  throw e3.status = t4 === "report-error" ? "error" : "warning", e3.color = t4 === "report-error" ? "error" : "negative", e3.message = `Page did not load in ${a2.timeout} seconds`, e3;
              }
            }
            if (r2.enabled) {
              s2 = true;
              const t4 = r2.onTimeout;
              try {
                const t5 = 1e3 * r2.timeout;
                await e2.page.wait(r2.searchText, { timeout: t5 });
              } catch (e3) {
                if (e3.message === "timeout" && ["report-error", "report-warning"].includes(t4)) {
                  const a3 = n2.string.shorten(r2.searchText, 15);
                  throw e3.status = t4 === "report-error" ? "error" : "warning", e3.color = t4 === "report-error" ? "error" : "negative", e3.message = `Text "${a3}" not found on page in ${r2.timeout} seconds`, e3;
                }
              }
            }
            e: if (o2.enabled) {
              s2 = true;
              const t4 = o2.text.trim();
              if (t4.length === 0) break e;
              const n3 = function(e3) {
                const t5 = window.$harpa, n4 = (n5) => n5.nodeType === Node.ELEMENT_NODE && t5.inspector.style(n5).position === "fixed" && t5.utils.occurrences.regex(t5.inspector.innerText(n5), e3) > 0, a3 = (e4, t6, n5) => n5.length === 1 || n5.every((t7) => t7 === e4 || !e4.contains(t7)), o3 = (e4) => {
                  e4.style.display = "none", e4.style.visibility = "hidden";
                }, i3 = (e4) => {
                  o3(e4), window.Array.from(e4.parentElement.children).forEach((e5) => {
                    e5.childElementCount === 0 && t5.inspector.style(e5).position === "fixed" && o3(e5);
                  });
                }, r3 = (e4) => {
                  const t6 = e4.filter(n4).filter(a3);
                  t6.length > 0 && (t6.forEach(i3), (() => {
                    const e5 = [document.documentElement, document.body];
                    for (const t7 of e5)
                      getComputedStyle(t7).overflow === "hidden" && (t7.style.overflow = "auto");
                  })());
                };
                r3(t5.query.byAll()), t5.utils.mutation.on(
                  document.body,
                  ["childList", "subtree"],
                  (e4) => {
                    r3(t5.utils.mutation.addedElements(e4));
                  }
                );
              };
              await e2.page.evaluate(n3, [t4]);
            }
            if (i2.enabled) {
              s2 = true;
              const t4 = {
                noIdle: true,
                noThrow: true,
                timeout: 1e3 * i2.maxDuration
              };
              await e2.page.scroll("all", t4), await e2.page.scroll("top", t4);
            }
            s2 || (t3.status.content = "Load steps turned off");
          }
        };
      })(), (() => {
        const { $recipe: t2, $chat: n2, $dialog: a2, $utils: o2, $s: i2 } = e;
        t2.steps["watcher.command"] = {
          config: { name: "Run command" },
          async run({ ctx: e2, step: t3 }) {
            const r2 = Date.now(), s2 = e2.page.mediumId, l2 = e2.taskId, {
              inputs: c2,
              name: u2,
              result: p2,
              timeout: d2,
              resetChat: m2
            } = e2.inputs.command, h = i2.ai.connections.get(e2.inputs.command.connectionId);
            let g = h?.id;
            if (h && ["cloudgpt", "openai-license"].includes(h.type) || (g = i2.ai.connections.find((e3) => e3.type === "cloudgpt").id), (u2 || "").trim() === "")
              throw t3.status.code = "warning", t3.status.color = "attention", t3.status.content = "Command name not specified", this._toError(t3.status.content, "No Command");
            const f = n2.actionsController.ensureTaskChat(l2, s2, g);
            f.title = (i2.tasks.get(l2)?.name || "").toUpperCase(), m2 && await n2.actionsController.clearChat(s2), f.addAnswer({
              text: `\u{1F916}  **Launched** on ${o2.time.formatDate(/* @__PURE__ */ new Date())}`,
              delimiter: true,
              system: true
            });
            let y = i2.commands.getCommandDeclaration(u2);
            if (!y)
              throw t3.status.code = "warning", t3.status.color = "attention", t3.status.content = `Command <b>${u2}</b> not found`, this._toError(t3.status.content, "No Command");
            c2 && (y = { ...y, inputs: c2 }), await n2.actionsController.stop(f.id), f.explorer.show = false, f.explorer.commandName = null;
            const b = a2.commandController.start(f.id, s2, y, { silentMode: true }), w = o2.createPromise();
            let v = null;
            return d2 && (v = setTimeout(() => {
              a2.commandController.removeCommandStopListener(b), n2.actionsController.stop(f.id), f.addAnswer({
                text: `\u{1F916}  **Aborted** in ${d2} seconds due to timeout`,
                system: true
              }), t3.status.code = "warning", t3.status.color = "attention", t3.status.content = `Command did not finish in <b>${d2}</b> seconds`, w.reject(this._toError(t3.status.content, "Timeout"));
            }, d2 * o2.time.SECOND)), a2.commandController.addCommandStopListener(b, async () => {
              clearTimeout(v);
              const t4 = p2 ? await a2.commandController.getParam(f.id, s2, p2) : "OK", n3 = Number.isNaN(Number(t4)) ? t4 : Number(t4);
              e2.record.value = n3;
              const i3 = ((Date.now() - r2) / o2.time.SECOND).toFixed(1);
              f.addAnswer({
                text: `\u{1F916}  **Finished** in ${i3} seconds with result: ${n3}`,
                system: true
              }), w.resolve();
            }), w;
          },
          _toError(e2, t3, n3, a3) {
            const o3 = new Error(e2);
            return o3.info = e2, o3.value = t3, o3.status = n3 || "warning", o3.color = a3 || "attention", o3.valueDimmed = a3 === "sublime", o3;
          }
        };
      })(), (() => {
        const { $recipe: t2 } = e, n2 = {
          "watcher.monitorChanges": "Check page changes",
          "watcher.monitorHealth": "Check page status",
          "watcher.monitorPrice": "Check price on page",
          "watcher.monitorElement": "Check element content",
          "watcher.runCommand": "Run command"
        };
        t2.steps["watcher.compare"] = {
          beforeRecipe({ ctx: e2, step: t3 }) {
            t3.status.content = t3.config.name || n2[e2.recipeId] || "Check page";
          },
          async run({ ctx: e2 }) {
            const t3 = {
              prefetch: e2.step("watcher.health")?.result,
              ...e2.step("watcher.parse")?.result
            }, n3 = e2.inputs.tracking.value === "between-checks" && e2.storage.last || e2.storage.first, a2 = e2.adapters.watcher.compare(e2, n3, t3);
            return Object.assign(e2.record, a2), e2.storage.first ? e2.storage.last = t3 : e2.storage.first = t3, e2.adapters.watcher.reduceTaskStorage(e2, e2.storage), a2;
          }
        };
      })(), (() => {
        const { $recipe: t2 } = e;
        t2.steps["watcher.favicons"] = {
          config: { name: "Update favicons", hideInJournal: true },
          async run({ ctx: e2 }) {
            if (!e2.page.isConnected) return;
            const t3 = await e2.page.favicons();
            return e2.api.updateFavicons(t3), t3;
          }
        };
      })(), (() => {
        const { $recipe: t2, $utils: n2 } = e;
        t2.steps["watcher.health"] = {
          config: { name: "Fetch the web page" },
          async run({ ctx: e2, step: t3 }) {
            const { url: n3, timeout: a2 } = e2.inputs.page, o2 = await this._fetchUrl(n3, 1e3 * a2);
            if (!(o2 instanceof Error)) {
              const { statusCode: e3, statusText: n4 } = o2;
              return t3.status.content = `Page returned code <b>${e3} / ${n4}</b>`, o2;
            }
            if (o2.message === "no-connection")
              return t3.status.content = "No web page connection", this._toResult(0, "No connection", n3);
            if (!navigator.onLine)
              throw t3.status.code = "warning", t3.status.color = "negative", t3.status.content = "No Internet connection", this._toError(
                "No Internet connection",
                "Offline",
                "warning",
                "sublime"
              );
            return t3.status.content = "Fetching page timed out", this._toResult(0, "Timeout", n3);
          },
          async _fetchUrl(e2, t3) {
            const a2 = n2.createPromise();
            setTimeout(() => {
              a2.reject(new Error("timeout"));
            }, t3);
            try {
              const t4 = await fetch(e2);
              a2.resolve({
                statusCode: t4.status,
                statusText: t4.statusText || (t4.status ? "OK" : "FAILED")
              });
            } catch (e3) {
              a2.resolve(new Error("no-connection"));
            }
            return a2;
          },
          _toResult: (e2, t3, n3, a2 = false) => ({
            statusCode: e2,
            statusText: t3,
            responseUrl: n3,
            redirected: a2
          }),
          _toError(e2, t3, n3, a2) {
            const o2 = new Error(e2);
            throw o2.info = e2, o2.value = t3, o2.status = n3, o2.color = a2, o2.valueDimmed = a2 === "sublime", o2;
          }
        };
      })(), (() => {
        const { $recipe: t2, $utils: n2 } = e;
        t2.steps["watcher.navigate"] = {
          config: { name: "Navigate to web page" },
          async run({ ctx: e2, step: t3 }) {
            let { url: a2, timeout: o2 } = e2.inputs.page;
            a2 = a2.trim(), a2 = a2 || "https://harpa.ai/blank";
            const i2 = await e2.page.goto(a2, {
              noThrow: true,
              noIdle: true,
              timeout: 1e3 * o2
            });
            if (!(i2 instanceof Error))
              return e2.api.updateTask((t4) => {
                t4.inputs.schedule.mediumType = e2.page.mediumType, t4.inputs.schedule.mediumId = e2.page.mediumId;
              }), i2;
            if (i2.message === "no-connection")
              return t3.status.content = "No web page connection", this._toResult(0, "No connection", a2);
            if (!navigator.onLine)
              throw t3.status.code = "warning", t3.status.color = "negative", t3.status.content = "No Internet connection", this._toError(
                "No Internet connection",
                "Offline",
                "warning",
                "sublime"
              );
            throw t3.status.code = "warning", t3.status.color = "negative", t3.status.content = "Navigation timed out", this._toError(
              `Could not navigate to ${n2.string.shorten(a2, 25)}`,
              "N/A",
              "warning",
              "sublime"
            );
          },
          _toResult: (e2, t3, n3, a2 = false) => ({
            statusCode: e2,
            statusText: t3,
            responseUrl: n3,
            redirected: a2
          }),
          _toError(e2, t3, n3, a2) {
            const o2 = new Error(e2);
            throw o2.info = e2, o2.value = t3, o2.status = n3, o2.color = a2, o2.valueDimmed = a2 === "sublime", o2;
          }
        };
      })(), (() => {
        const { $recipe: t2 } = e;
        t2.steps["watcher.page"] = {
          config: { name: "Create page", hideInJournal: true },
          async run({ ctx: e2, step: t3 }) {
            if (e2.page) return;
            const n2 = {
              mediumType: e2.inputs.schedule?.mediumType || "pinned-tab",
              mediumId: e2.inputs.schedule?.mediumId || null,
              autoCloseTab: Boolean(e2.inputs.schedule?.autoCloseTab),
              ...e2.inputs.ua,
              ...t3.config
            };
            return delete n2.name, delete n2.hideInJournal, e2.api.browser.newPage(n2);
          }
        };
      })(), (() => {
        const { $recipe: t2, $utils: n2 } = e;
        t2.steps["watcher.parse"] = {
          config: {
            name: "Parse page data with A.I.",
            query: ["html", "data", "text", "item"]
          },
          async run({ ctx: e2, step: t3 }) {
            const n3 = t3.config.query, l2 = {};
            return n3.includes("html") && (l2.html = await a2(e2)), (n3.includes("data") || n3.includes("text") || n3.includes("item")) && (l2.data = await o2(e2)), n3.includes("text") && (l2.text = await r2(e2, l2.data)), n3.includes("item") && (l2.item = await s2(e2, l2.data), e2.state.item = l2.item || null), l2.data && (l2.data = i2(l2.data)), l2;
          },
          afterStep({ step: e2, s: t3 }) {
            const a3 = e2.result, o3 = t3 !== 0 ? `, took <b>${t3}</b> seconds` : "";
            if (a3.html) {
              const t4 = (a3.html.length / 1024).toFixed(1);
              e2.status.content = `Parsed page of <b>${t4} Kb</b>` + o3;
            } else if (a3.text) {
              const t4 = (a3.text.length / 1024).toFixed(1);
              e2.status.content = `Parsed text of <b>${t4} Kb</b>` + o3;
            } else if (a3.item) {
              const { value: t4, metric: i3, type: r3 } = a3.item;
              let s3 = n2.formatter.format(t4, i3 || r3);
              s3 = n2.string.shorten(s3, 60), e2.status.content = `Parsed element <b>${s3}</b>` + o3;
            } else if (a3.data) {
              const t4 = a3.data.length;
              e2.status.content = `Parsed <b>${t4} data items</b>` + o3;
            }
          }
        };
        const a2 = async (e2) => e2.page.content({ contentType: "htmlContent" }), o2 = async (e2) => e2.page.parse({ inspect: true, extract: true }), i2 = (e2) => e2.map(
          (e3) => (e3.elements = e3.elements.map((e4) => e4.serialize()), e3.data = {
            isVisible: e3.data.isVisible,
            isInViewport: e3.data.isInViewport,
            tag: e3.data.tag,
            fontSize: e3.data.fontSize
          }, delete e3.container, delete e3.path, e3)
        ), r2 = async (e2, t3) => t3.filter((e3) => e3.type === "text").map((e3) => e3.value).join("\n"), s2 = async (e2, t3) => {
          let a3 = e2.inputs["watcher.element"].selector;
          if (n2.is.nil(a3)) {
            const n3 = e2.adapters.watcher.biggestItem(t3);
            if (n3 && n3.container) {
              a3 = (await e2.page.inspect(n3.container, { computeAiLocator: true })).locator.selector, n3.type !== "element" && a3.push({ $parse: n3.type, at: n3.at });
            } else a3 = [{ $css: "body" }, { $parse: "text", at: 0 }];
          }
          return e2.inputs["watcher.element"].selector = a3, e2.adapters.watcher.queryItem(e2.page, a3);
        };
      })(), (() => {
        const { $recipe: t2, $bus: n2 } = e;
        t2.steps["watcher.preview"] = {
          config: { name: "Generate page preview", hideInJournal: true },
          async run({ ctx: e2 }) {
            try {
              const t3 = e2.recordStorage.screenshot;
              e2.storage.preview = await this._createPreview(t3);
            } catch (e3) {
              t2.error("failed creating page preview", e3);
            }
          },
          _createPreview: async (e2) => await n2.send("offscreen.createImagePreview", e2)
        };
      })(), (() => {
        const { $recipe: t2 } = e;
        t2.steps["watcher.prune"] = {
          config: {
            name: "Prune obsolete records",
            hideInJournal: true,
            maxRecords: 1e3
          },
          async run({ ctx: e2, step: t3 }) {
            const { records: n2 } = e2, { maxRecords: a2 } = t3.config;
            if (a2 === 0) return e2.records = [], void (e2.record = null);
            a2 !== 1 ? n2.length + 1 > a2 && (e2.records = n2.slice(n2.length - a2 - 1)) : e2.records = [];
          }
        };
      })(), (() => {
        const { $recipe: t2 } = e;
        t2.steps["watcher.screenshot"] = {
          config: { name: "Take a screenshot", idle: false },
          async run({ ctx: e2, step: t3 }) {
            try {
              t3.config.idle && await e2.page.idle(), e2.recordStorage.screenshot = await e2.page.screenshotter.capture();
            } catch (e3) {
              const n2 = e3.message.slice(0, 100);
              t3.error = n2, t3.status.code = "error", t3.status.color = "negative", t3.status.content = `Failed to take a screenshot: ${n2}`;
            }
          }
        };
      })(), (() => {
        const { $recipe: t2, $env: n2 } = e, a2 = (e2, t3, n3, a3 = true) => {
          if (a3 && !n3.hasOwnProperty(t3))
            throw new Error(`no recipe ${e2} ${t3} found`);
          return n3[t3];
        };
        t2.proxy = {
          adapter: (e2, n3 = true) => a2("adapter", e2, t2.adapters, n3),
          input: (e2, n3 = true) => a2("input", e2, t2.inputs, n3),
          step(e2, o2 = true) {
            if (n2.is.pp) throw new Error("not supported");
            return a2("step", e2, t2.steps, o2);
          }
        };
      })(), (() => {
        const { $runner: t2, $mobx: n2, $s: a2 } = e;
        t2.emailProxy = n2.observable({
          get uid() {
            return a2.agentId;
          },
          get testStatus() {
            return a2.runner.actions.email.testStatus;
          },
          set testStatus(e2) {
            a2.runner.actions.email.testStatus = e2;
          },
          get testMessage() {
            return a2.runner.actions.email.testMessage;
          },
          set testMessage(e2) {
            a2.runner.actions.email.testMessage = e2;
          }
        });
      })(), (() => {
        const { $runner: t2, $mobx: n2, $s: a2 } = e;
        t2.makeProxy = n2.observable({
          get uid() {
            return a2.agentId;
          },
          get testStatus() {
            return a2.runner.actions.make.testStatus;
          },
          set testStatus(e2) {
            a2.runner.actions.make.testStatus = e2;
          },
          get testMessage() {
            return a2.runner.actions.make.testMessage;
          },
          set testMessage(e2) {
            a2.runner.actions.make.testMessage = e2;
          }
        });
      })(), (() => {
        const { $runner: t2, $mobx: n2, $s: a2 } = e;
        t2.notificationProxy = n2.observable({
          get testStatus() {
            return a2.runner.actions.notification.testStatus;
          },
          set testStatus(e2) {
            a2.runner.actions.notification.testStatus = e2;
          }
        });
      })(), (() => {
        const { $runner: t2, $store: n2, $mobx: a2, $utils: o2, $s: i2 } = e;
        t2.proxy = a2.observable({
          generateJobId: () => n2.idGenerator.job(),
          jobById: (e2) => i2.runner.queue.find((t3) => t3.id === e2),
          jobByTaskId: (e2) => i2.runner.queue.find((t3) => t3.taskId === e2),
          setJobProgress(e2, t3) {
            this.updateJob(e2, { progress: t3 });
          },
          getJobProgress(e2) {
            return this.jobById(e2)?.progress || 0;
          },
          addJob(e2) {
            e2 = { id: this.generateJobId(), progress: 1, by: "system", ...e2 }, i2.transaction(() => i2.runner.queue.push(e2));
          },
          updateJob(e2, t3) {
            i2.transaction(() => {
              const n3 = i2.runner.queue.find((t4) => t4.id === e2);
              n3 && Object.assign(n3, t3);
            });
          },
          deleteJob(e2) {
            i2.runner.queue = i2.runner.queue.filter((t3) => t3.id !== e2);
          },
          get netStable() {
            return i2.runner.netStable;
          },
          set netStable(e2) {
            i2.runner.netStable = e2;
          },
          get schedules() {
            return i2.tasks.filter((e2) => e2.enabled).map((e2) => {
              const t3 = e2.inputs.schedule.type;
              return { id: e2.id, type: t3, ...e2.inputs.schedule[t3] };
            });
          },
          computeNextRunMs(e2) {
            if (!e2 || !e2.enabled) return -1;
            if (e2.inputs.schedule.type === "periodical") {
              const t3 = e2.inputs.schedule.periodical.frequency, n3 = o2.time.frequencyToMs(t3), a3 = e2.records.at(-1)?.ms || -1, i3 = Math.max(a3 + n3, Date.now());
              return this._adjustNextRunMsToTimeframe(i3);
            }
            return -1;
          },
          _adjustNextRunMsToTimeframe(e2) {
            const t3 = i2.settings.scheduledTimeframeValue;
            if (!t3) return e2;
            let n3 = new Date(e2);
            n3 = 60 * n3.getHours() + n3.getMinutes();
            let a3 = new Date(e2);
            a3.setHours(0, 0, 0, 0), a3 = a3.getTime();
            const r2 = 60 * (Number(t3.from.split(":")[0]) || 0) + (Number(t3.from.split(":")[1]) || 0), s2 = 60 * (Number(t3.till.split(":")[0]) || 0) + (Number(t3.till.split(":")[1]) || 0);
            if (r2 <= s2) {
              if (r2 <= n3 && n3 <= s2) return e2;
              if (n3 < r2) return a3 + r2 * o2.time.MINUTE;
              if (n3 > s2) return a3 + r2 * o2.time.MINUTE + o2.time.DAY;
            }
            if (r2 > s2) return n3 <= s2 || n3 >= r2 ? e2 : a3 + r2 * o2.time.MINUTE;
            throw new Error("unreachable code reached");
          }
        });
      })(), (() => {
        const { $runner: t2, $utils: n2, $mobx: a2, $s: o2 } = e;
        t2.soundProxy = a2.observable({
          get voices() {
            return o2.runner.actions.sound.voices;
          },
          set voices(e2) {
            o2.runner.actions.sound.voices = e2;
          },
          get sounds() {
            return t2.sounds.map(({ id: e2, label: t3 }) => ({
              id: `sound:${e2}`,
              label: `Sound, ${t3}`,
              src: `/sounds/${e2}.mp3`
            }));
          },
          get items() {
            return [...this.sounds, ...this.voices];
          },
          value(e2) {
            return e2.inputs.actions.sound.value || this.items[0].id;
          },
          volume: (e2) => n2.number.minmax(e2.inputs.actions.sound.volume || 50, 0, 100),
          utterance: (e2) => e2.inputs.actions.sound.utterance,
          utterancePlaceholder: () => "Task triggered",
          get testStatus() {
            return o2.runner.actions.sound.testStatus;
          },
          set testStatus(e2) {
            o2.runner.actions.sound.testStatus = e2;
          }
        });
      })(), (() => {
        const { $runner: t2, $mobx: n2, $s: a2 } = e;
        t2.webhookProxy = n2.observable({
          get uid() {
            return a2.agentId;
          },
          get testStatus() {
            return a2.runner.actions.webhook.testStatus;
          },
          set testStatus(e2) {
            a2.runner.actions.webhook.testStatus = e2;
          },
          get testMessage() {
            return a2.runner.actions.webhook.testMessage;
          },
          set testMessage(e2) {
            a2.runner.actions.webhook.testMessage = e2;
          }
        });
      })(), (() => {
        const { $runner: t2 } = e;
        t2.sounds = [
          { id: "pop", label: "Pop" },
          { id: "sonar", label: "Sonar Short" },
          { id: "sonar-2", label: "Sonar Long" },
          { id: "register", label: "Old Register" },
          { id: "banknotes", label: "Banknotes" },
          { id: "triangle", label: "Triangle" },
          { id: "wine", label: "Wine" }
        ];
      })(), (() => {
        const { $runner: t2, $s: n2 } = e;
        t2.actionController = {
          init() {
            t2.actionNotificationController.init(), t2.actionSoundController.init(), t2.actionEmailController.init(), t2.actionWebhookController.init(), t2.actionMakeController.init();
          },
          async runActions(e2, a2) {
            n2.settings.silenceActions.enabled ? n2.journal.logActionsRun(e2, a2, true) : (await Promise.all(
              e2.map((e3) => {
                if (e3.type === "notification")
                  return t2.actionNotificationController.runAction(e3, a2);
                if (e3.type === "sound")
                  return t2.actionSoundController.runAction(e3, a2);
                if (e3.type === "email")
                  return t2.actionEmailController.runAction(e3, a2);
                if (e3.type === "webhook")
                  return t2.actionWebhookController.runAction(e3, a2);
                if (e3.type === "make")
                  return t2.actionMakeController.runAction(e3, a2);
                throw new Error(`unsupported action type: ${e3.type}`);
              }).filter((e3) => Boolean(e3))
            ), n2.journal.logActionsRun(e2, a2));
          }
        };
      })(), (() => {
        const { $runner: t2, $task: n2, $harpa: a2, $bus: o2, $utils: i2 } = e;
        t2.actionEmailController = {
          init() {
            this.uniqueTestId = null, o2.on("runner.email.runActionTest", this.runActionTest.bind(this)), o2.on(
              "runner.email.stopActionTest",
              this.stopActionTest.bind(this)
            );
          },
          async runAction(e2, o3) {
            const r2 = {
              type: "email",
              isTest: e2.isTest || false,
              taskName: o3.name || n2.proxy.recipeTitle(o3)
            }, s2 = o3.inputs?.actions?.email;
            s2 && (r2.to = s2.to, r2.limitActions = s2.limitActions);
            const l2 = o3.inputs?.page?.url;
            l2 && (r2.url = l2, r2.domain = i2.url.hostname(l2)), s2.customSmtpEnabled && (r2.customSmtp = {
              from: s2.customSmtpFrom,
              host: s2.customSmtpHost,
              username: s2.customSmtpUsername,
              password: s2.customSmtpPassword
            });
            let c2 = e2.records || [];
            c2.length > 0 && (r2.lastRecord = this._toRecord(
              new n2.Adapter({ ...o3, records: c2 })
            )), c2.length > 1 && (c2 = c2.slice(0, c2.length - 1), r2.prevRecord = this._toRecord(
              new n2.Adapter({ ...o3, records: c2 })
            ));
            let u2 = null;
            try {
              u2 = await a2.api.action({
                uid: t2.emailProxy.uid,
                tid: o3.id,
                tzo: (/* @__PURE__ */ new Date()).getTimezoneOffset(),
                actions: [r2]
              });
            } catch (e3) {
              return {
                status: "failure",
                message: e3.message === "Failed to fetch" ? "No Internet connection" : `Error: ${e3.message}`
              };
            }
            const p2 = u2?.actions?.[0];
            return p2 ? {
              status: p2.status === "ok" ? "success" : "failure",
              message: i2.string.toCapitalFirst(p2.message) || `Status ${p2.status || u2.status}`
            } : {
              status: "failure",
              message: "Response error: action status not returned"
            };
          },
          async runActionTest(e2) {
            const n3 = this.uniqueTestId = Math.random();
            t2.emailProxy.testStatus = "running";
            const a3 = { isTest: true, records: e2.records }, o3 = await this.runAction(a3, e2);
            n3 === this.uniqueTestId && (t2.emailProxy.testStatus = o3.status, t2.emailProxy.testMessage = o3.message);
          },
          stopActionTest() {
            this.uniqueTestId = null, t2.emailProxy.testStatus = null;
          },
          _toRecord: (e2) => ({
            date: e2.lastRecordDate,
            prefix: e2.lastRecordValuePrefix,
            value: e2.lastRecordValueText,
            suffix: e2.lastRecordValueSuffix,
            info: e2.lastRecordInfoString,
            status: e2.lastRecordDeltaColor,
            delta: e2.lastRecordDeltaSymbol
          })
        };
      })(), (() => {
        const { $runner: t2, $bus: n2 } = e;
        t2.actionMakeController = {
          init() {
            this.uniqueTestId = null, n2.on("runner.make.runActionTest", this.runActionTest.bind(this)), n2.on("runner.make.stopActionTest", this.stopActionTest.bind(this));
          },
          async runAction(e2, n3) {
            const a2 = { config: n3.inputs?.actions?.make };
            return t2.actionWebhookController.runAction(e2, n3, a2);
          },
          async runActionTest(e2) {
            const n3 = this.uniqueTestId = Math.random();
            t2.makeProxy.testStatus = "running";
            const a2 = { isTest: true, records: e2.records }, o2 = await this.runAction(a2, e2);
            n3 === this.uniqueTestId && (t2.makeProxy.testStatus = o2.status, t2.makeProxy.testMessage = o2.message);
          },
          stopActionTest() {
            this.uniqueTestId = null, t2.makeProxy.testStatus = null;
          }
        };
      })(), (() => {
        const { $runner: t2, $bus: n2, $utils: a2 } = e, o2 = "test-notification";
        t2.actionNotificationController = {
          permissionLevel: null,
          actions: {},
          init() {
            chrome.notifications.getPermissionLevel((e2) => {
              this.permissionLevel = e2;
            }), n2.on(
              "runner.notification.runActionTest",
              this.runActionTest.bind(this)
            ), n2.on(
              "runner.notification.stopActionTest",
              this.stopActionTest.bind(this)
            ), chrome.notifications.onClicked.addListener(
              this.onNotificationClicked.bind(this)
            ), chrome.notifications.onClosed.addListener(
              this.onNotificationClosed.bind(this)
            );
          },
          runAction(e2) {
            let {
              id: t3,
              title: n3,
              message: o3,
              status: i2,
              color: r2,
              iconUrl: s2
            } = e2;
            t3 = t3 || a2.id.nano(), n3 = n3 || "HARPA.AI MONITOR TRIGGERED", i2 = i2 || "ok", r2 = r2 || "neutral", o3 = a2.clearFromTags(o3), s2 = s2 || `/img/notifications/notification-${i2}-${r2}.png`, this.actions[t3] = e2, chrome.notifications.clear(t3), chrome.notifications.create(t3, {
              type: "basic",
              priority: 1,
              requireInteraction: true,
              title: n3,
              message: o3,
              iconUrl: s2
            });
          },
          runActionTest() {
            t2.notificationProxy.testStatus = "running", this.runAction({
              id: o2,
              title: "HARPA.AI TEST NOTIFICATION",
              message: "This is a test notification. Please click it to verify it works.",
              status: "alert",
              onClick: () => {
                t2.notificationProxy.testStatus = "success";
              },
              onClose: ({ byUser: e2 }) => {
                const n3 = e2 ? "success" : "failure";
                t2.notificationProxy.testStatus = n3;
              }
            });
          },
          stopActionTest() {
            this.onNotificationClosed(o2, false), t2.notificationProxy.testStatus = null;
          },
          onNotificationClicked(e2) {
            chrome.notifications.clear(e2);
            const t3 = this.actions[e2];
            t3 && (delete this.actions[e2], this._handleActionListener(t3.onClick, { id: e2 }));
          },
          onNotificationClosed(e2, t3) {
            chrome.notifications.clear(e2);
            const n3 = this.actions[e2];
            n3 && (delete this.actions[e2], this._handleActionListener(n3.onClose, { id: e2, byUser: t3 }));
          },
          async _handleActionListener(e2, t3) {
            if (!e2) return;
            if (typeof e2 == "function") return void e2(t3);
            const { url: n3, tabId: a3 } = typeof e2 == "string" ? { url: e2 } : e2;
            if (a3) {
              if ((await chrome.tabs.query({ currentWindow: true })).find(
                (e3) => e3.id === a3
              ))
                return void chrome.tabs.update(a3, { active: true });
            }
            chrome.tabs.create({ url: n3, active: true });
          }
        };
      })(), (() => {
        const { $runner: t2, $bus: n2 } = e;
        t2.actionSoundController = {
          init() {
            n2.on("runner.sound.runActionTest", this._runActionTest, this), n2.on("runner.sound.stopActionTest", this._stopActionTest, this), n2.on(
              "runner.sound.validateActionTest",
              this._validateActionTest,
              this
            );
          },
          runAction(e2) {
            t2.audioController.play({
              id: e2.id,
              volume: e2.volume,
              message: e2.message
            });
          },
          _runActionTest(e2) {
            t2.soundProxy.testStatus = "running", t2.audioController.play({
              id: t2.soundProxy.value(e2),
              volume: t2.soundProxy.volume(e2),
              message: t2.soundProxy.utterance(e2)
            });
          },
          _stopActionTest() {
            t2.soundProxy.testStatus = "failure", t2.audioController.stop();
          },
          _validateActionTest() {
            t2.soundProxy.testStatus = "success", t2.audioController.stop();
          }
        };
      })(), (() => {
        const { $runner: t2, $task: n2, $bus: a2, $utils: o2 } = e;
        t2.actionWebhookController = {
          init() {
            this.uniqueTestId = null, a2.on("runner.webhook.runActionTest", this.runActionTest.bind(this)), a2.on(
              "runner.webhook.stopActionTest",
              this.stopActionTest.bind(this)
            );
          },
          async runAction(e2, a3, i2 = {}) {
            const r2 = i2.config || a3.inputs?.actions?.webhook;
            if (!r2 || !r2.url)
              return { status: "failure", message: "Webhook URL not specified" };
            const s2 = {
              ms: (/* @__PURE__ */ new Date()).getTime(),
              type: "task:task-run",
              sender: { id: t2.webhookProxy.uid, type: "harpa-extension-agent" },
              task: {
                id: a3.id,
                name: a3.name || n2.proxy.recipeTitle(a3),
                createdMs: a3.createdMs
              },
              record: null
            };
            a3.state && Object.keys(a3.state).length > 0 && (s2.task.state = a3.state);
            const l2 = a3.inputs?.page?.url;
            l2 && (s2.task.url = l2, s2.task.domain = o2.url.hostname(l2));
            let c2 = e2.records || [];
            c2.length > 0 && (s2.record = c2.at(-1));
            const u2 = s2.record;
            s2.csv = {
              taskId: s2.task.id,
              taskName: s2.task.name,
              url: s2.task.url,
              domain: s2.task.domain,
              date: u2 ? new Date(u2.ms).toLocaleDateString() : "\u2014",
              time: u2 ? new Date(u2.ms).toLocaleTimeString() : "\u2014",
              value: u2?.value ?? "\u2014",
              metric: u2?.metric ? u2.metric.startsWith("CUR:") ? u2.metric.slice(4) : u2.metric : "\u2014",
              status: u2?.status || "\u2014",
              color: u2?.color || "\u2014",
              triggered: u2?.triggered ? "yes" : "\u2014",
              dispatched: u2?.dispatched ? u2?.dispatched.join(",") : "\u2014",
              info: u2?.info ? u2.info.replaceAll("<b>", "").replaceAll("</b>", "") : "\u2014"
            }, e2.isTest && (s2.isTest = true);
            let p2 = null;
            try {
              const e3 = {
                method: "POST",
                body: JSON.stringify(s2),
                headers: { "Content-Type": "application/json" }
              };
              if (r2.basicAuthEnabled) {
                const { basicAuthUsername: t3, basicAuthPassword: n3 } = r2;
                e3.headers.Authorization = "Basic " + btoa(`${t3 || ""}:${n3 || ""}`);
              }
              p2 = await fetch(r2.url, e3);
            } catch (e3) {
              return {
                status: "failure",
                message: e3.message === "Failed to fetch" ? "No Internet connection" : `Network error: ${e3.message}`
              };
            }
            return p2.ok ? { status: "success", message: `Status ${p2.status}` } : {
              status: "failure",
              message: `Error: ${p2.status} ${p2.statusText || ""}`
            };
          },
          async runActionTest(e2) {
            const n3 = this.uniqueTestId = Math.random();
            t2.webhookProxy.testStatus = "running";
            const a3 = { isTest: true, records: e2.records }, o3 = await this.runAction(a3, e2);
            n3 === this.uniqueTestId && (t2.webhookProxy.testStatus = o3.status, t2.webhookProxy.testMessage = o3.message);
          },
          stopActionTest() {
            this.uniqueTestId = null, t2.webhookProxy.testStatus = null;
          }
        };
      })(), (() => {
        const { $runner: t2, $bus: n2 } = e;
        t2.audioController = {
          async init() {
            this._sounds = {}, await this._setupSounds(), await this._setupVoices();
          },
          async play({ id: e2, volume: t3, message: a2 }) {
            t3 /= 100;
            const o2 = this._sounds[e2];
            o2 ? await n2.send("runner.audio.playSrc", o2, t3) : await n2.send("runner.audio.playVoice", e2, t3, a2);
          },
          async stop() {
            await n2.send("runner.audio.stopVoice");
          },
          async _setupSounds() {
            for (const e2 of t2.soundProxy.sounds)
              this._sounds[e2.id] = e2.src, await n2.send("runner.audio.loadSrc", e2.src);
          },
          async _setupVoices() {
            const e2 = async () => {
              let e3 = await n2.send("runner.audio.getVoices");
              const a2 = /* @__PURE__ */ new Set(["Daniel", "Samantha"]);
              e3.some((e4) => a2.has(e4.name)) && (e3 = e3.filter((e4) => a2.has(e4.name) || !e4.lang.startsWith("en")));
              const o2 = new Intl.DisplayNames("en", { type: "language" }), i2 = (e4) => `${o2.of(e4.lang).split(" (")[0]}, ${e4.name}`;
              e3 = e3.map((e4) => ({ id: e4.name, lang: e4.lang, label: i2(e4) })).sort((e4, t3) => {
                if (e4.id === "Daniel") return -1;
                if (t3.id === "Daniel") return 1;
                if (e4.lang === "en") return -1;
                if (t3.lang === "en") return 1;
                if (e4.lang.startsWith("en")) {
                  if (!t3.lang.startsWith("en")) return -1;
                } else if (t3.lang.startsWith("en")) return 1;
                return e4.label.localeCompare(t3.label);
              }), t2.soundProxy.voices = e3;
            };
            try {
              await e2();
            } catch (e3) {
              t2.error("failed to setup voices", e3);
            }
            n2.on("runner.audio.voicesChanged", e2);
          }
        };
      })(), (() => {
        const { $runner: t2 } = e;
        t2.controller = {
          async init() {
            await t2.audioController.init(), t2.onlineController.init(), t2.actionController.init(), t2.scheduleController.init();
          }
        };
      })(), (() => {
        const { $runner: t2, $utils: n2 } = e;
        t2.onlineController = {
          init() {
            this._markNetStableTimeout = null, this._sleepDetectionMs = Date.now(), this._launchSleepDetection(), this._watchOnlineStatus(), t2.proxy.netStable = navigator.onLine;
          },
          _launchSleepDetection() {
            setInterval(() => {
              const e2 = Date.now();
              e2 - this._sleepDetectionMs > n2.time.MINUTE && this._onOnline(), this._sleepDetectionMs = e2;
            }, 5 * n2.time.SECOND);
          },
          _watchOnlineStatus() {
            if (!navigator.connection) return;
            let e2 = navigator.onLine;
            navigator.connection.addEventListener("change", () => {
              navigator.onLine !== e2 && (e2 = navigator.onLine, e2 ? this._onOnline() : this._onOffline());
            });
          },
          _onOnline() {
            t2.proxy.netStable = false, clearTimeout(this._markNetStableTimeout), this._markNetStableTimeout = setTimeout(() => {
              t2.proxy.netStable = true, this._markNetStableTimeout = null;
            }, n2.time.MINUTE);
          },
          _onOffline() {
            clearTimeout(this._markNetStableTimeout), this._markNetStableTimeout = null, t2.proxy.netStable = false;
          }
        };
      })(), (() => {
        const { $runner: t2, $mobx: n2, $bus: a2, $utils: o2, $task: i2, $s: r2 } = e;
        t2.scheduleController = {
          init() {
            this._sleepTimer = null, this._performers = {}, r2.runner.queue = [], this.enqueueTasks = this.enqueueTasks.bind(this), this.terminateTasks = this.terminateTasks.bind(this), this._runJobs = this._runJobs.bind(this), a2.on("runner.enqueueTasks", this.enqueueTasks), a2.on("runner.terminateTasks", this.terminateTasks), n2.reaction(
              () => t2.proxy.schedules,
              (e2 = {}, t3 = {}) => {
                o2.deepEqual(e2, t3) || this._runJobs(e2);
              },
              { fireImmediately: false }
            ), n2.reaction(
              () => r2.settings.scheduledTimeframeValue,
              (e2 = {}, t3 = {}) => {
                o2.deepEqual(e2, t3) || this._runJobs();
              },
              { fireImmediately: false }
            ), n2.reaction(
              () => r2.settings.maxParallelTasks,
              (e2, t3) => {
                e2 !== t3 && this._runJobs();
              },
              { fireImmediately: false }
            ), n2.reaction(
              () => t2.proxy.netStable,
              (e2, t3) => {
                e2 !== t3 && this._runJobs();
              }
            ), o2.chrome.alarms.run(this._runJobs.bind(this), {
              name: "runner.runJobs",
              delayInMinutes: 1,
              periodInMinutes: 1,
              immediately: true
            });
          },
          enqueueTasks(e2) {
            e2 = new Set(e2), r2.runner.queue = [
              ...r2.runner.queue.map(
                (t3) => e2.has(t3.taskId) ? (e2.delete(t3.taskId), { ...t3, by: "user" }) : t3
              ),
              ...Array.from(e2).map((e3) => ({
                id: t2.proxy.generateJobId(),
                taskId: e3,
                progress: 1,
                by: "user"
              }))
            ], this._runJobs();
          },
          terminateTasks(e2) {
            e2 = new Set(o2.ensureArray(e2)), r2.runner.queue = r2.runner.queue.filter((t3) => !e2.has(t3.taskId)), e2.forEach((e3) => {
              const t3 = this._performers[e3];
              t3 && t3.terminate();
            });
          },
          _runJobs(e2) {
            this._updateJobsQueue(e2);
            let n3 = null;
            for (; n3 = this._pickNextJob(); ) {
              if (typeof n3 == "number") {
                if (this._sleepTimer) {
                  if (this._sleepTimer.till === n3) return;
                  this._sleepTimer.clear();
                }
                return void (this._sleepTimer = new t2.SleepTimer(
                  this._runJobs,
                  n3
                ));
              }
              this._performJob(n3);
            }
          },
          _updateJobsQueue(e2) {
            e2 = e2 || t2.proxy.schedules, r2.runner.queue = r2.runner.queue.filter(
              (e3) => e3.running || e3.by === "user"
            );
            const n3 = Date.now();
            e2.forEach((e3) => {
              if (t2.proxy.jobByTaskId(e3.id)) return;
              const a3 = r2.tasks.get(e3.id), o3 = t2.proxy.computeNextRunMs(a3);
              -1 === o3 || o3 > n3 || t2.proxy.addJob({ taskId: e3.id });
            });
          },
          _pickNextJob() {
            let e2 = r2.runner.queue.filter((e3) => !e3.running);
            if (t2.proxy.netStable || (e2 = e2.filter((e3) => e3.by === "user")), e2.length === 0) {
              if (!t2.proxy.netStable) return null;
              const e3 = r2.tasks.filter((e4) => e4.enabled).filter((e4) => !t2.proxy.jobByTaskId(e4.id)).map((e4) => t2.proxy.computeNextRunMs(e4)).filter((e4) => -1 !== e4);
              return e3.length === 0 ? null : e3.reduce((e4, t3) => e4 < t3 ? e4 : t3);
            }
            return r2.runner.queue.filter((e3) => e3.running).length >= r2.settings.maxParallelTasks ? null : e2.reduce((e3, t3) => {
              if (e3.by === "user" && t3.by !== "user") return e3;
              if (e3.by !== "user" && t3.by === "user") return t3;
              return (r2.tasks.get(e3.taskId).records.at(-1)?.ms || -1) < (r2.tasks.get(t3.taskId).records.at(-1)?.ms || -1) ? e3 : t3;
            });
          },
          async _performJob(e2) {
            const { id: n3, taskId: a3 } = e2;
            t2.proxy.updateJob(n3, { running: true });
            try {
              const o3 = this._performers[a3] = new i2.JobPerformer(e2);
              await o3.perform();
            } catch (n4) {
              t2.error("failed to run a job", e2, n4);
            } finally {
              delete this._performers[a3], t2.proxy.deleteJob(n3);
            }
            setTimeout(this._runJobs);
          }
        };
      })(), (() => {
        const { $runner: t2 } = e;
        t2.SleepTimer = class {
          constructor(e2, n2) {
            this.cb = e2, this.till = n2, this.timeoutId = null;
            const a2 = Date.now();
            this.till <= a2 ? this.cb() : (this.run = this.run.bind(this), t2.sleepTimerController.addTimer(this), this.timeoutId = setTimeout(this.run, this.till - a2 + 1));
          }
          run() {
            Date.now() < this.till || (this.clear(), this.cb());
          }
          clear() {
            t2.sleepTimerController.removeTimer(this), clearTimeout(this.timeoutId);
          }
        }, t2.sleepTimerController = {
          addTimer(e2) {
            if (!this.timers) {
              this.timers = /* @__PURE__ */ new Set(), chrome.alarms.onAlarm.addListener(this._onAlarm), chrome.runtime.onMessage.addListener(this._onAlarm);
              const e3 = { delayInMinutes: 1, periodInMinutes: 1 };
              chrome.alarms.create("runner.sleepTimer.alarm", e3);
            }
            this.timers.add(e2);
          },
          removeTimer(e2) {
            this.timers && this.timers.size !== 0 && (this.timers.delete(e2), this.timers.size === 0 && (this.timers = null, chrome.alarms.onAlarm.removeListener(this._onAlarm), chrome.runtime.onMessage.removeListener(this._onAlarm), chrome.alarms.clear("runner.sleepTimer.alarm")));
          },
          _onAlarm({ name: e2 } = {}) {
            e2 === "runner.sleepTimer.alarm" && this.timers && this.timers.forEach((e3) => e3.run());
          }
        };
      })(), (() => {
        const { $settings: t2 } = e;
        t2.controller = {
          init() {
            t2.cspController.init();
          }
        };
      })(), (() => {
        const { $settings: t2, $mobx: n2, $netRules: a2, $utils: o2, $s: i2 } = e;
        t2.cspController = {
          init() {
            this._ruleIds = [], this._updateNetRules(), this._updateNetRulesWhenCspSettingsChange();
          },
          _updateNetRulesWhenCspSettingsChange() {
            n2.reaction(
              () => {
                const e2 = i2.settings.csp;
                return `${e2.allowAll}-${e2.domains.join("-")}`;
              },
              () => this._updateNetRules()
            );
          },
          async _updateNetRules() {
            await a2.unregister(this._ruleIds), this._ruleIds = [];
            const e2 = {
              type: "modifyHeaders",
              responseHeaders: [
                { header: "content-security-policy", operation: "remove" }
              ]
            }, t3 = i2.settings.csp.allowAll ? { condition: { urlFilter: null }, action: e2 } : i2.settings.csp.domains.map((t4) => ({
              condition: { urlFilter: t4 },
              action: e2
            })), n3 = await a2.register(t3);
            this._ruleIds.push(...o2.ensureArray(n3));
          }
        };
      })(), (() => {
        const { $sidePanel: t2, $env: n2, $bus: a2, $browser: o2, $s: i2 } = e;
        t2.controller = {
          async init() {
            if (n2.is.bg)
              a2.on("sidePanel.switchToFrame", this._switchToFrame, this);
            else if (n2.is.pp) {
              if (!n2.is.sidePanel) return;
              a2.on("sidePanel.isOpen", () => true), await a2.send("browser.ejectFrame", i2.tab.id);
            }
          },
          async open(e2 = null) {
            n2.is.pp && (e2 ??= i2.tab.id), e2 && (chrome.sidePanel.setOptions({
              tabId: e2,
              path: `harpa.html?popup&tabId=${e2}`,
              enabled: true
            }), await chrome.sidePanel.open({ tabId: e2 }));
          },
          async close(e2 = null) {
            n2.is.pp && (e2 ??= i2.tab.id), e2 && await chrome.sidePanel.setOptions({ tabId: e2, enabled: false });
          },
          async _switchToFrame(e2) {
            await chrome.sidePanel.setOptions({ tabId: e2, enabled: false }), await o2.controller.showFrame(e2);
          }
        };
      })(), (() => {
        const { $tabs: t2, $s: n2 } = e;
        t2.openAppTab = async (e2) => {
          const t3 = `https://app.harpa.ai/?t=${n2.theme}`;
          let a2 = (await chrome.tabs.query({})).find((e3) => e3.url === t3);
          const o2 = !!a2;
          o2 ? await chrome.tabs.update(a2.id, { active: true }) : a2 = await chrome.tabs.create({ url: t3, active: true });
          const i2 = await chrome.windows.get(a2.windowId);
          if (i2) {
            const e3 = {
              focused: true,
              state: i2.state === "minimized" ? "maximized" : i2.state
            };
            await chrome.windows.update(a2.windowId, e3);
          }
          return e2 && setTimeout(() => {
            const t4 = n2.tabs[a2.id];
            t4 && (t4.screen = e2);
          }, 75), o2;
        };
      })(), (() => {
        const { $shortcut: t2, $commands: n2, $bus: a2, $mobx: o2, $s: i2 } = e;
        t2.controller = {
          init() {
            t2.hotkeyController.init(), a2.on("shortcut.getConfig", this.getConfig, this), a2.on("shortcut.updateQap", this.updateQap, this), a2.on("shortcut.executeCommand", this.executeCommand, this), a2.on("shortcut.whitelistQap", this.whitelistQap, this), a2.on("shortcut.blacklistQap", this.blacklistQap, this), this._broadcastConfigUpdates();
          },
          _broadcastConfigUpdates() {
            const e2 = [
              () => i2.shortcut.enabled,
              () => i2.shortcut.qab.enabled,
              () => i2.shortcut.qab.actions,
              () => i2.shortcut.qap.enabledMain,
              () => i2.shortcut.qap.enabledSelection,
              () => i2.shortcut.qap.enabledInput,
              () => i2.shortcut.qap.enabledHotkeys,
              () => i2.shortcut.qap.blacklist,
              () => i2.commands.favoriteCommandNames,
              () => i2.commands.suggestions.mapping
            ];
            for (const t3 of e2)
              o2.reaction(
                t3,
                () => a2.send("shortcut.configUpdate", this.getConfig()),
                { fireImmediately: false }
              );
          },
          executeCommand(e2, t3) {
            i2.tabs[e2].shortcutCommand = t3;
          },
          whitelistQap(e2) {
            i2.shortcut.qap.blacklist = i2.shortcut.qap.blacklist.split(/[\s,]+/).filter((t3) => t3 !== e2).filter(Boolean).join(", ");
          },
          blacklistQap(e2) {
            e2 === "main" ? i2.shortcut.qap.enabledMain = false : e2 === "selection" ? i2.shortcut.qap.enabledSelection = false : e2 === "input" ? i2.shortcut.qap.enabledInput = false : i2.shortcut.qap.blacklist = i2.shortcut.qap.blacklist.split(/[\s,]+/).concat(e2).filter(Boolean).join(", ");
          },
          getConfig: () => ({
            ...o2.toJS(i2.shortcut),
            mapping: o2.toJS(i2.commands.suggestions.mapping),
            favorites: i2.commands.favoriteCommandNames.map((e2) => i2.commands.getCommand(e2)).filter(Boolean).map((e2) => ({
              label: (e2.title || n2.defaultTitle).toUpperCase(),
              command: e2.name
            }))
          }),
          updateQap(e2) {
            i2.shortcut.qap = { ...i2.shortcut.qap, ...e2 };
          }
        };
      })(), (() => {
        const {
          $shortcut: t2,
          $browser: n2,
          $bus: a2,
          $utils: o2,
          $capture: i2,
          $sidePanel: r2,
          $s: s2,
          $startup: l2
        } = e;
        t2.hotkeyController = {
          init() {
            a2.on("shortcut.hotkeyPress", this._onHotkeyPress, this), l2.controller.onReady.then(this._onReady.bind(this));
          },
          async _onHotkeyPress(e2, t3) {
            const l3 = o2.hotkey.fromEvent(t3), c2 = Object.entries(s2.shortcut.actions).find(([e3, t4]) => t4.global && o2.hotkey.equal(l3, t4.hotkey))?.at(0);
            if (!c2) return;
            const u2 = (await chrome.tabs.get(e2)).url.startsWith(
              "https://app.harpa.ai/"
            );
            if (c2 === "reloadFrame" && (await o2.ls.set("__hrp.onReady", { openTab: e2 }), chrome.runtime.reload()), c2 === "toggleFrame") {
              if (u2) return;
              await a2.send(e2, "sidePanel.isOpen") ? await r2.controller.close(e2) : await n2.controller.toggleFrame(e2);
            } else if (c2 === "captureArea") {
              if (u2) return;
              await i2.controller.attachArea(e2);
            } else if (c2 === "captureView") {
              if (u2) return;
              await i2.controller.attachView(e2);
            }
          },
          async _onReady() {
            const e2 = await o2.ls.get("__hrp.onReady");
            e2?.openTab && (await o2.ls.remove("__hrp.onReady"), await n2.controller.toggleFrame(e2.openTab, true));
          }
        };
      })(), (() => {
        const { $task: t2 } = e;
        t2.languages = {
          auto: "Do not force language",
          en_US: "English (United States)",
          en_GB: "English (United Kingdom)",
          af: "Afrikaans",
          af_NA: "Afrikaans (Namibia)",
          af_ZA: "Afrikaans (South Africa)",
          ak: "Akan",
          ak_GH: "Akan (Ghana)",
          sq: "Albanian",
          sq_AL: "Albanian (Albania)",
          am: "Amharic",
          ar: "Arabic",
          am_ET: "Amharic (Ethiopia)",
          ar_DZ: "Arabic (Algeria)",
          ar_BH: "Arabic (Bahrain)",
          ar_EG: "Arabic (Egypt)",
          ar_IQ: "Arabic (Iraq)",
          ar_JO: "Arabic (Jordan)",
          ar_KW: "Arabic (Kuwait)",
          ar_LB: "Arabic (Lebanon)",
          ar_LY: "Arabic (Libya)",
          ar_MA: "Arabic (Morocco)",
          ar_OM: "Arabic (Oman)",
          ar_QA: "Arabic (Qatar)",
          ar_SA: "Arabic (Saudi Arabia)",
          ar_SD: "Arabic (Sudan)",
          ar_SY: "Arabic (Syria)",
          ar_TN: "Arabic (Tunisia)",
          ar_AE: "Arabic (United Arab Emirates)",
          ar_YE: "Arabic (Yemen)",
          hy: "Armenian",
          hy_AM: "Armenian (Armenia)",
          as: "Assamese",
          as_IN: "Assamese (India)",
          asa: "Asu",
          asa_TZ: "Asu (Tanzania)",
          az: "Azerbaijani",
          az_Cyrl: "Azerbaijani (Cyrillic)",
          az_Cyrl_AZ: "Azerbaijani (Cyrillic, Azerbaijan)",
          az_Latn: "Azerbaijani (Latin)",
          az_Latn_AZ: "Azerbaijani (Latin, Azerbaijan)",
          bm: "Bambara",
          bm_ML: "Bambara (Mali)",
          eu: "Basque",
          eu_ES: "Basque (Spain)",
          be: "Belarusian",
          be_BY: "Belarusian (Belarus)",
          bem: "Bemba",
          bem_ZM: "Bemba (Zambia)",
          bez: "Bena",
          bez_TZ: "Bena (Tanzania)",
          bn: "Bengali",
          bn_BD: "Bengali (Bangladesh)",
          bn_IN: "Bengali (India)",
          bs: "Bosnian",
          bs_BA: "Bosnian (Bosnia and Herzegovina)",
          bg: "Bulgarian",
          bg_BG: "Bulgarian (Bulgaria)",
          my: "Burmese",
          my_MM: "Burmese (Myanmar [Burma])",
          yue_Hant_HK: "Cantonese (Traditional, Hong Kong SAR China)",
          ca: "Catalan",
          ca_ES: "Catalan (Spain)",
          tzm: "Central Morocco Tamazight",
          tzm_Latn: "Central Morocco Tamazight (Latin)",
          tzm_Latn_MA: "Central Morocco Tamazight (Latin, Morocco)",
          chr: "Cherokee",
          chr_US: "Cherokee (United States)",
          cgg: "Chiga",
          cgg_UG: "Chiga (Uganda)",
          zh: "Chinese",
          zh_Hans: "Chinese (Simplified Han)",
          zh_Hans_CN: "Chinese (Simplified Han, China)",
          zh_Hans_HK: "Chinese (Simplified Han, Hong Kong SAR China)",
          zh_Hans_MO: "Chinese (Simplified Han, Macau SAR China)",
          zh_Hans_SG: "Chinese (Simplified Han, Singapore)",
          zh_Hant: "Chinese (Traditional Han)",
          zh_Hant_HK: "Chinese (Traditional Han, Hong Kong SAR China)",
          zh_Hant_MO: "Chinese (Traditional Han, Macau SAR China)",
          zh_Hant_TW: "Chinese (Traditional Han, Taiwan)",
          kw: "Cornish",
          kw_GB: "Cornish (United Kingdom)",
          hr: "Croatian",
          hr_HR: "Croatian (Croatia)",
          cs: "Czech",
          cs_CZ: "Czech (Czech Republic)",
          da: "Danish",
          da_DK: "Danish (Denmark)",
          nl: "Dutch",
          nl_BE: "Dutch (Belgium)",
          nl_NL: "Dutch (Netherlands)",
          ebu: "Embu",
          ebu_KE: "Embu (Kenya)",
          en: "English",
          en_AS: "English (American Samoa)",
          en_AU: "English (Australia)",
          en_BE: "English (Belgium)",
          en_BZ: "English (Belize)",
          en_BW: "English (Botswana)",
          en_CA: "English (Canada)",
          en_GU: "English (Guam)",
          en_HK: "English (Hong Kong SAR China)",
          en_IN: "English (India)",
          en_IE: "English (Ireland)",
          en_IL: "English (Israel)",
          en_JM: "English (Jamaica)",
          en_MT: "English (Malta)",
          en_MH: "English (Marshall Islands)",
          en_MU: "English (Mauritius)",
          en_NA: "English (Namibia)",
          en_NZ: "English (New Zealand)",
          en_MP: "English (Northern Mariana Islands)",
          en_PK: "English (Pakistan)",
          en_PH: "English (Philippines)",
          en_SG: "English (Singapore)",
          en_ZA: "English (South Africa)",
          en_TT: "English (Trinidad and Tobago)",
          en_UM: "English (U.S. Minor Outlying Islands)",
          en_VI: "English (U.S. Virgin Islands)",
          en_ZW: "English (Zimbabwe)",
          eo: "Esperanto",
          et: "Estonian",
          et_EE: "Estonian (Estonia)",
          ee: "Ewe",
          ee_GH: "Ewe (Ghana)",
          ee_TG: "Ewe (Togo)",
          fo: "Faroese",
          fo_FO: "Faroese (Faroe Islands)",
          fil: "Filipino",
          fil_PH: "Filipino (Philippines)",
          fi: "Finnish",
          fi_FI: "Finnish (Finland)",
          fr: "French",
          fr_BE: "French (Belgium)",
          fr_BJ: "French (Benin)",
          fr_BF: "French (Burkina Faso)",
          fr_BI: "French (Burundi)",
          fr_CM: "French (Cameroon)",
          fr_CA: "French (Canada)",
          fr_CF: "French (Central African Republic)",
          fr_TD: "French (Chad)",
          fr_KM: "French (Comoros)",
          fr_CG: "French (Congo - Brazzaville)",
          fr_CD: "French (Congo - Kinshasa)",
          fr_CI: "French (C\xF4te d\u2019Ivoire)",
          fr_DJ: "French (Djibouti)",
          fr_GQ: "French (Equatorial Guinea)",
          fr_FR: "French (France)",
          fr_GA: "French (Gabon)",
          fr_GP: "French (Guadeloupe)",
          fr_GN: "French (Guinea)",
          fr_LU: "French (Luxembourg)",
          fr_MG: "French (Madagascar)",
          fr_ML: "French (Mali)",
          fr_MQ: "French (Martinique)",
          fr_MC: "French (Monaco)",
          fr_NE: "French (Niger)",
          fr_RW: "French (Rwanda)",
          fr_RE: "French (R\xE9union)",
          fr_BL: "French (Saint Barth\xE9lemy)",
          fr_MF: "French (Saint Martin)",
          fr_SN: "French (Senegal)",
          fr_CH: "French (Switzerland)",
          fr_TG: "French (Togo)",
          ff_SN: "Fulah (Senegal)",
          ff: "Fulah",
          gl: "Galician",
          gl_ES: "Galician (Spain)",
          lg: "Ganda",
          lg_UG: "Ganda (Uganda)",
          ka: "Georgian",
          ka_GE: "Georgian (Georgia)",
          de: "German",
          de_AT: "German (Austria)",
          de_BE: "German (Belgium)",
          de_DE: "German (Germany)",
          de_LI: "German (Liechtenstein)",
          de_LU: "German (Luxembourg)",
          de_CH: "German (Switzerland)",
          el: "Greek",
          el_CY: "Greek (Cyprus)",
          el_GR: "Greek (Greece)",
          gu: "Gujarati",
          gu_IN: "Gujarati (India)",
          guz: "Gusii",
          guz_KE: "Gusii (Kenya)",
          ha: "Hausa",
          ha_Latn: "Hausa (Latin)",
          ha_Latn_GH: "Hausa (Latin, Ghana)",
          ha_Latn_NE: "Hausa (Latin, Niger)",
          ha_Latn_NG: "Hausa (Latin, Nigeria)",
          haw: "Hawaiian",
          haw_US: "Hawaiian (United States)",
          he: "Hebrew",
          he_IL: "Hebrew (Israel)",
          hi: "Hindi",
          hi_IN: "Hindi (India)",
          hu: "Hungarian",
          hu_HU: "Hungarian (Hungary)",
          is: "Icelandic",
          is_IS: "Icelandic (Iceland)",
          ig: "Igbo",
          ig_NG: "Igbo (Nigeria)",
          id: "Indonesian",
          id_ID: "Indonesian (Indonesia)",
          ga: "Irish",
          ga_IE: "Irish (Ireland)",
          it: "Italian",
          it_IT: "Italian (Italy)",
          it_CH: "Italian (Switzerland)",
          ja: "Japanese",
          ja_JP: "Japanese (Japan)",
          kea: "Kabuverdianu",
          kea_CV: "Kabuverdianu (Cape Verde)",
          kab: "Kabyle",
          kab_DZ: "Kabyle (Algeria)",
          kl: "Kalaallisut",
          kl_GL: "Kalaallisut (Greenland)",
          kln: "Kalenjin",
          kln_KE: "Kalenjin (Kenya)",
          kam: "Kamba",
          kam_KE: "Kamba (Kenya)",
          kn: "Kannada",
          kn_IN: "Kannada (India)",
          kk: "Kazakh",
          kk_Cyrl: "Kazakh (Cyrillic)",
          kk_Cyrl_KZ: "Kazakh (Cyrillic, Kazakhstan)",
          km: "Khmer",
          km_KH: "Khmer (Cambodia)",
          ki: "Kikuyu",
          ki_KE: "Kikuyu (Kenya)",
          rw: "Kinyarwanda",
          rw_RW: "Kinyarwanda (Rwanda)",
          kok: "Konkani",
          kok_IN: "Konkani (India)",
          ko: "Korean",
          ko_KR: "Korean (South Korea)",
          khq: "Koyra Chiini",
          khq_ML: "Koyra Chiini (Mali)",
          ses: "Koyraboro Senni",
          ses_ML: "Koyraboro Senni (Mali)",
          lag: "Langi",
          lag_TZ: "Langi (Tanzania)",
          lv: "Latvian",
          lv_LV: "Latvian (Latvia)",
          lt: "Lithuanian",
          lt_LT: "Lithuanian (Lithuania)",
          luo: "Luo",
          luo_KE: "Luo (Kenya)",
          luy: "Luyia",
          luy_KE: "Luyia (Kenya)",
          mk: "Macedonian",
          mk_MK: "Macedonian (Macedonia)",
          jmc: "Machame",
          jmc_TZ: "Machame (Tanzania)",
          kde: "Makonde",
          kde_TZ: "Makonde (Tanzania)",
          mg: "Malagasy",
          mg_MG: "Malagasy (Madagascar)",
          ms: "Malay",
          ms_BN: "Malay (Brunei)",
          ms_MY: "Malay (Malaysia)",
          ml: "Malayalam",
          ml_IN: "Malayalam (India)",
          mt: "Maltese",
          mt_MT: "Maltese (Malta)",
          gv: "Manx",
          gv_GB: "Manx (United Kingdom)",
          mr: "Marathi",
          mr_IN: "Marathi (India)",
          mas: "Masai",
          mas_KE: "Masai (Kenya)",
          mas_TZ: "Masai (Tanzania)",
          mer: "Meru",
          mer_KE: "Meru (Kenya)",
          mfe: "Morisyen",
          mfe_MU: "Morisyen (Mauritius)",
          naq: "Nama",
          naq_NA: "Nama (Namibia)",
          ne: "Nepali",
          ne_IN: "Nepali (India)",
          ne_NP: "Nepali (Nepal)",
          nd: "North Ndebele",
          nd_ZW: "North Ndebele (Zimbabwe)",
          nb: "Norwegian Bokm\xE5l",
          nb_NO: "Norwegian Bokm\xE5l (Norway)",
          nn: "Norwegian Nynorsk",
          nn_NO: "Norwegian Nynorsk (Norway)",
          nyn: "Nyankole",
          nyn_UG: "Nyankole (Uganda)",
          or: "Oriya",
          or_IN: "Oriya (India)",
          om: "Oromo",
          om_ET: "Oromo (Ethiopia)",
          om_KE: "Oromo (Kenya)",
          ps: "Pashto",
          ps_AF: "Pashto (Afghanistan)",
          fa: "Persian",
          fa_AF: "Persian (Afghanistan)",
          fa_IR: "Persian (Iran)",
          pl: "Polish",
          pl_PL: "Polish (Poland)",
          pt: "Portuguese",
          pt_BR: "Portuguese (Brazil)",
          pt_GW: "Portuguese (Guinea-Bissau)",
          pt_MZ: "Portuguese (Mozambique)",
          pt_PT: "Portuguese (Portugal)",
          pa: "Punjabi",
          pa_Arab: "Punjabi (Arabic)",
          pa_Arab_PK: "Punjabi (Arabic, Pakistan)",
          pa_Guru: "Punjabi (Gurmukhi)",
          pa_Guru_IN: "Punjabi (Gurmukhi, India)",
          ro: "Romanian",
          ro_MD: "Romanian (Moldova)",
          ro_RO: "Romanian (Romania)",
          rm: "Romansh",
          rm_CH: "Romansh (Switzerland)",
          rof: "Rombo",
          rof_TZ: "Rombo (Tanzania)",
          ru: "Russian",
          ru_MD: "Russian (Moldova)",
          ru_RU: "Russian (Russia)",
          ru_UA: "Russian (Ukraine)",
          rwk: "Rwa",
          rwk_TZ: "Rwa (Tanzania)",
          saq: "Samburu",
          saq_KE: "Samburu (Kenya)",
          sg: "Sango",
          sg_CF: "Sango (Central African Republic)",
          seh: "Sena",
          seh_MZ: "Sena (Mozambique)",
          sr: "Serbian",
          sr_Cyrl: "Serbian (Cyrillic)",
          sr_Cyrl_BA: "Serbian (Cyrillic, Bosnia and Herzegovina)",
          sr_Cyrl_ME: "Serbian (Cyrillic, Montenegro)",
          sr_Cyrl_RS: "Serbian (Cyrillic, Serbia)",
          sr_Latn: "Serbian (Latin)",
          sr_Latn_BA: "Serbian (Latin, Bosnia and Herzegovina)",
          sr_Latn_ME: "Serbian (Latin, Montenegro)",
          sr_Latn_RS: "Serbian (Latin, Serbia)",
          sn: "Shona",
          sn_ZW: "Shona (Zimbabwe)",
          ii: "Sichuan Yi",
          ii_CN: "Sichuan Yi (China)",
          si: "Sinhala",
          si_LK: "Sinhala (Sri Lanka)",
          sk: "Slovak",
          sk_SK: "Slovak (Slovakia)",
          sl: "Slovenian",
          sl_SI: "Slovenian (Slovenia)",
          xog: "Soga",
          xog_UG: "Soga (Uganda)",
          so: "Somali",
          so_DJ: "Somali (Djibouti)",
          so_ET: "Somali (Ethiopia)",
          so_KE: "Somali (Kenya)",
          so_SO: "Somali (Somalia)",
          es: "Spanish",
          es_AR: "Spanish (Argentina)",
          es_BO: "Spanish (Bolivia)",
          es_CL: "Spanish (Chile)",
          es_CO: "Spanish (Colombia)",
          es_CR: "Spanish (Costa Rica)",
          es_DO: "Spanish (Dominican Republic)",
          es_EC: "Spanish (Ecuador)",
          es_SV: "Spanish (El Salvador)",
          es_GQ: "Spanish (Equatorial Guinea)",
          es_GT: "Spanish (Guatemala)",
          es_HN: "Spanish (Honduras)",
          es_419: "Spanish (Latin America)",
          es_MX: "Spanish (Mexico)",
          es_NI: "Spanish (Nicaragua)",
          es_PA: "Spanish (Panama)",
          es_PY: "Spanish (Paraguay)",
          es_PE: "Spanish (Peru)",
          es_PR: "Spanish (Puerto Rico)",
          es_ES: "Spanish (Spain)",
          es_US: "Spanish (United States)",
          es_UY: "Spanish (Uruguay)",
          es_VE: "Spanish (Venezuela)",
          sw: "Swahili",
          sw_KE: "Swahili (Kenya)",
          sw_TZ: "Swahili (Tanzania)",
          sv: "Swedish",
          sv_FI: "Swedish (Finland)",
          sv_SE: "Swedish (Sweden)",
          gsw: "Swiss German",
          gsw_CH: "Swiss German (Switzerland)",
          shi: "Tachelhit",
          shi_Latn: "Tachelhit (Latin)",
          shi_Latn_MA: "Tachelhit (Latin, Morocco)",
          shi_Tfng: "Tachelhit (Tifinagh)",
          shi_Tfng_MA: "Tachelhit (Tifinagh, Morocco)",
          dav: "Taita",
          dav_KE: "Taita (Kenya)",
          ta: "Tamil",
          ta_IN: "Tamil (India)",
          ta_LK: "Tamil (Sri Lanka)",
          te: "Telugu",
          te_IN: "Telugu (India)",
          teo: "Teso",
          teo_KE: "Teso (Kenya)",
          teo_UG: "Teso (Uganda)",
          th: "Thai",
          th_TH: "Thai (Thailand)",
          bo: "Tibetan",
          bo_CN: "Tibetan (China)",
          bo_IN: "Tibetan (India)",
          ti: "Tigrinya",
          ti_ER: "Tigrinya (Eritrea)",
          ti_ET: "Tigrinya (Ethiopia)",
          to: "Tonga",
          to_TO: "Tonga (Tonga)",
          tr: "Turkish",
          tr_TR: "Turkish (Turkey)",
          uk: "Ukrainian",
          uk_UA: "Ukrainian (Ukraine)",
          ur: "Urdu",
          ur_IN: "Urdu (India)",
          ur_PK: "Urdu (Pakistan)",
          uz_Arab: "Uzbek (Arabic)",
          uz_Arab_AF: "Uzbek (Arabic, Afghanistan)",
          uz: "Uzbek",
          uz_Cyrl: "Uzbek (Cyrillic)",
          uz_Cyrl_UZ: "Uzbek (Cyrillic, Uzbekistan)",
          uz_Latn: "Uzbek (Latin)",
          uz_Latn_UZ: "Uzbek (Latin, Uzbekistan)",
          vi: "Vietnamese",
          vi_VN: "Vietnamese (Vietnam)",
          vun: "Vunjo",
          vun_TZ: "Vunjo (Tanzania)",
          cy: "Welsh",
          cy_GB: "Welsh (United Kingdom)",
          yo: "Yoruba",
          yo_NG: "Yoruba (Nigeria)",
          zu: "Zulu",
          zu_ZA: "Zulu (South Africa)"
        };
      })(), (() => {
        const { $task: t2 } = e;
        t2.mediumTypes = [
          { id: "tab", name: "tab", label: "Tab" },
          { id: "pinned-tab", name: "pinned tab", label: "Pinned Tab" },
          { id: "hidden-tab", name: "hidden frame", label: "Hidden Frame" }
        ], t2.mediumTypesWithAutoClosing = t2.mediumTypes.map((e2) => [
          {
            id: `t:${e2.id}`,
            name: `${e2.name} (auto-close)`,
            label: `${e2.label} (auto-close)`
          },
          {
            id: `p:${e2.id}`,
            name: `${e2.name} (persistent)`,
            label: `${e2.label} (persistent)`
          }
        ]).flat();
      })(), (() => {
        const { $task: t2, $mobx: n2, $utils: a2, $ui: o2, $s: i2 } = e;
        t2.proxy = n2.observable({
          recipeName(e2) {
            return this._computeMetaValue("name", e2);
          },
          recipeIcon(e2) {
            const t3 = this._computeMetaValue("icon", e2);
            return o2.Icon.icons[t3];
          },
          recipeTitle(e2) {
            return this._computeMetaValue("title", e2);
          },
          recipeUnderDevelopment(e2) {
            return this._computeMetaValue("underDevelopment", e2);
          },
          recipeShowGrabber(e2) {
            return this._computeMetaValue("showGrabber", e2);
          },
          _computeMetaValue(e2, n3) {
            const a3 = typeof n3 == "string" ? i2.recipes[n3] : i2.recipes[n3.recipeId], o3 = typeof n3 != "string" && n3;
            return t2.evaluate(a3.meta[e2], { recipe: a3, task: o3 });
          },
          get taskIds() {
            return i2.tasks.map((e2) => e2.id);
          },
          taskDomain(e2) {
            const t3 = e2.inputs?.page?.url;
            return t3 ? a2.url.getDomain(t3, { canonical: true, noTld: true }) : null;
          },
          get taskMediumIds() {
            return i2.tasks.map((e2) => e2.inputs.schedule?.mediumId).filter((e2) => !!e2);
          },
          taskLastRecord: (e2) => e2.records.at(-1),
          updateFavicons(e2, n3) {
            e2 = a2.ensureArray(e2);
            const o3 = n3 && t2.proxy.taskDomain(n3);
            e2.length !== 0 && (e2.map((e3) => typeof e3 == "string" ? { favicon: e3, hq: true } : e3).map((e3) => (e3.domain || (e3.domain = o3), e3)).filter((e3) => Boolean(e3.domain)), i2.library.setDomainFavicons(e2));
          },
          updateTask(e2, t3 = {}, n3 = null) {
            const a3 = i2.tasks.getIndex(e2);
            if (-1 === a3) throw new Error(`no task found for id ${e2}`);
            i2.transaction(() => {
              let e3 = i2.tasks[a3];
              n3 && (e3 = e3[n3]), typeof t3 == "function" ? t3(e3) : Object.assign(e3, t3);
            });
          },
          removeRecords(e2) {
            i2.transaction(() => {
              for (const t3 in e2) {
                const n3 = i2.tasks.get(t3);
                n3 && (n3.records = n3.records.filter((n4) => !e2[t3].has(n4.ms)));
              }
            });
          }
        });
      })(), (() => {
        const { $task: t2 } = e;
        t2.scheduleFrequencies = [
          { id: "15s", label: "Every 15 seconds", selectedLabel: "15 seconds" },
          { id: "1m", label: "Every minute", selectedLabel: "1 minute" },
          { id: "5m", label: "Every 5 minutes", selectedLabel: "5 mins" },
          { id: "15m", label: "Every 15 minutes", selectedLabel: "15 mins" },
          { id: "1h", label: "Every hour", selectedLabel: "1 hour" },
          { id: "3h", label: "Every 3 hours", selectedLabel: "3 hours" },
          { id: "12h", label: "Every 12 hours", selectedLabel: "12 hours" },
          { id: "1d", label: "Every day", selectedLabel: "1 day" },
          { id: "1w", label: "Every week", selectedLabel: "1 week" },
          { id: "1mo", label: "Every month", selectedLabel: "1 month" }
        ];
      })(), (() => {
        const { $task: t2 } = e;
        t2.trackingItems = [
          { id: "between-checks", label: "between checks" },
          { id: "to-first-check", label: "to the first check made" }
        ];
      })(), (() => {
        const { $task: t2 } = e;
        t2.userAgents = {
          "macbook-13.4": {
            name: "MacBook 13.4'",
            icon: "mac",
            viewportWidth: 1366,
            viewportHeight: 768,
            userAgent: "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36"
          },
          "windows-pc": {
            name: "Windows PC",
            icon: "win",
            viewportWidth: 1600,
            viewportHeight: 900,
            userAgent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36"
          },
          "galaxy-s5": {
            name: "Galaxy S5",
            icon: "android",
            viewportWidth: 360,
            viewportHeight: 480,
            userAgent: "Mozilla/5.0 (Linux; Android 5.0; SM-G900P Build/LRX21T) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Mobile Safari/537.36"
          },
          "iphone-x": {
            name: "iPhone X",
            icon: "iphone",
            viewportWidth: 375,
            viewportHeight: 812,
            userAgent: "Mozilla/5.0 (iPhone; CPU iPhone OS 13_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.5 Mobile/15E148 Safari/604.1"
          }
        };
      })(), (() => {
        const {
          $task: t2,
          $recipe: n2,
          $store: a2,
          $mobx: o2,
          $utils: i2,
          $env: r2,
          $s: s2
        } = e;
        t2.Adapter = class {
          static ofTask(e2) {
            return e2 ? new t2.Adapter(e2) : null;
          }
          constructor(e2) {
            if (!e2)
              throw new Error("$task.Adapter task argument must be defined");
            this._task = e2;
          }
          get taskProxy() {
            return this._task;
          }
          get taskObject() {
            return o2.toJS(this._task);
          }
          transaction(e2) {
            const t3 = this._task.id;
            s2.transaction(() => {
              const n3 = (r2.is.pp ? s2.tab?.creator : null)?.templates.find(
                (e3) => e3.id === t3
              ) || s2.tasks.get(t3);
              n3 && e2(n3, s2);
            });
          }
          resetTaskState(e2 = true) {
            const t3 = a2.template.task({ id: this.id });
            e2 && Object.entries(n2.inputs).forEach(([e3, n3]) => {
              const a3 = this._task.inputs[e3];
              t3.inputs[e3] = a3 && n3.persistState ? a3 : n3.state;
            }), this.transaction((e3) => {
              Object.keys(t3).forEach((n3) => {
                e3[n3] = t3[n3];
              }), Object.keys(e3).filter((e4) => !t3.hasOwnProperty(e4)).forEach((t4) => delete e3[t4]);
            });
          }
          get id() {
            return this._task.id;
          }
          set id(e2) {
            this.transaction((t3) => t3.id = e2);
          }
          get name() {
            return this._task.name;
          }
          set name(e2) {
            this.transaction((t3) => t3.name = e2);
          }
          get enabled() {
            return this._task.enabled;
          }
          set enabled(e2) {
            this.transaction((t3) => t3.enabled = e2);
          }
          toggleEnabled() {
            this.transaction((e2) => e2.enabled = !e2.enabled);
          }
          get createdMs() {
            return this._task.createdMs;
          }
          get recipeId() {
            return this._task.recipeId;
          }
          set recipeId(e2) {
            this.transaction((t3) => t3.recipeId = e2);
          }
          get recipe() {
            return s2.recipes[this.recipeId];
          }
          get state() {
            return this._task.state;
          }
          updateState(e2 = {}) {
            this.transaction((t3) => Object.assign(t3.state, e2));
          }
          get inputScreen() {
            return this._task.inputScreen;
          }
          set inputScreen(e2) {
            this.transaction((t3) => t3.inputScreen = e2);
          }
          get records() {
            return this._task.records;
          }
          resetRecords() {
            const e2 = a2.template.task();
            this.transaction((t3) => t3.records = e2.records);
          }
          get firstRecord() {
            return this.records[0];
          }
          set firstRecord(e2) {
            this.transaction((t3) => t3.records[0] = e2);
          }
          get lastRecord() {
            return this.records.at(-1) || {};
          }
          set lastRecord(e2) {
            const t3 = this.records.length;
            this.transaction((n3) => {
              t3 === 0 ? n3.records.push(e2) : n3.records[t3 - 1] = e2;
            });
          }
          get previousRecord() {
            const e2 = this.trackingValue, t3 = this.records.filter(
              (e3) => e3.status !== "warning" && e3.status !== "error"
            );
            return e2 && e2 !== "between-checks" ? e2 === "to-first-check" ? t3.length > 1 ? t3[0] : {} : null : t3.length > 1 ? t3.at(-2) : {};
          }
          dropToFirstRecord() {
            const e2 = this.firstRecord;
            e2 && this.transaction((t3) => t3.records = [e2]);
          }
          get inputs() {
            return this._task.inputs;
          }
          input(e2) {
            return this.ensureInput(e2), this._task.inputs[e2];
          }
          ensureInput(e2) {
            this._task.inputs[e2] || this.transaction((t3) => t3.inputs[e2] = n2.proxy.input(e2).state);
          }
          updateInput(e2, t3) {
            this.ensureInput(e2), this.transaction((n3) => Object.assign(n3.inputs[e2], t3));
          }
          get page() {
            return this.input("page");
          }
          updatePage(e2) {
            this.transaction((t3) => Object.assign(t3.inputs.page, e2));
          }
          get pageUrl() {
            return this.page.url;
          }
          set pageUrl(e2) {
            this.updatePage({ url: e2 });
          }
          get ua() {
            return this.input("ua");
          }
          updateUa(e2) {
            this.transaction((t3) => Object.assign(t3.inputs.ua, e2));
          }
          get uaVlang() {
            return this.input("ua").vlang;
          }
          set uaVlang(e2) {
            this.updateUa({ vlang: e2 });
          }
          get uaVua() {
            return this.input("ua").vua;
          }
          set uaVua(e2) {
            this.updateUa({ vua: e2 });
          }
          get uaCustomViewport() {
            return this.input("ua").customViewport;
          }
          set uaCustomViewport(e2) {
            this.updateUa({ customViewport: e2 });
          }
          get uaViewportWidth() {
            return this.input("ua").viewportWidth;
          }
          set uaViewportWidth(e2) {
            this.updateUa({ viewportWidth: e2 });
          }
          get uaViewportHeight() {
            return this.input("ua").viewportHeight;
          }
          set uaViewportHeight(e2) {
            this.updateUa({ viewportHeight: e2 });
          }
          get pageMediumSize() {
            const e2 = this.input("ua");
            return {
              width: e2.customViewport ? e2.viewportWidth || "100%" : t2.userAgents[e2.vua]?.viewportWidth || "100%",
              height: e2.customViewport ? e2.viewportHeight || "100%" : t2.userAgents[e2.vua]?.viewportHeight || "100%"
            };
          }
          get before() {
            return this.input("before");
          }
          updateBefore(e2, t3) {
            typeof e2 != "string" ? (t3 = e2, this.transaction((e3) => Object.assign(e3.inputs.before, t3))) : this.transaction((n3) => Object.assign(n3.inputs.before[e2], t3));
          }
          get beforeIdleCheckEnabled() {
            return this.before.idleCheck.enabled;
          }
          set beforeIdleCheckEnabled(e2) {
            this.updateBefore("idleCheck", { enabled: e2 });
          }
          get beforeIdleCheckTimeout() {
            return this.before.idleCheck.timeout;
          }
          set beforeIdleCheckTimeout(e2) {
            this.updateBefore("idleCheck", { timeout: e2 });
          }
          get beforeIdleCheckOnTimeout() {
            return this.before.idleCheck.onTimeout;
          }
          set beforeIdleCheckOnTimeout(e2) {
            this.updateBefore("idleCheck", { onTimeout: e2 });
          }
          get beforeTextCheckEnabled() {
            return this.before.textCheck.enabled;
          }
          set beforeTextCheckEnabled(e2) {
            this.updateBefore("textCheck", { enabled: e2 });
          }
          get beforeTextCheckSearchText() {
            return this.before.textCheck.searchText;
          }
          set beforeTextCheckSearchText(e2) {
            this.updateBefore("textCheck", { searchText: e2 });
          }
          get beforeTextCheckTimeout() {
            return this.before.textCheck.timeout;
          }
          set beforeTextCheckTimeout(e2) {
            this.updateBefore("textCheck", { timeout: e2 });
          }
          get beforeTextCheckOnTimeout() {
            return this.before.textCheck.onTimeout;
          }
          set beforeTextCheckOnTimeout(e2) {
            this.updateBefore("textCheck", { onTimeout: e2 });
          }
          get beforeDropBannersEnabled() {
            return this.before.dropBanners.enabled;
          }
          set beforeDropBannersEnabled(e2) {
            this.updateBefore("dropBanners", { enabled: e2 });
          }
          get beforeDropBannersText() {
            return this.before.dropBanners.text;
          }
          set beforeDropBannersText(e2) {
            this.updateBefore("dropBanners", { text: e2 });
          }
          get beforeScrollEnabled() {
            return this.before.scroll.enabled;
          }
          set beforeScrollEnabled(e2) {
            this.updateBefore("scroll", { enabled: e2 });
          }
          get beforeScrollMaxDuration() {
            return this.before.scroll.maxDuration;
          }
          set beforeScrollMaxDuration(e2) {
            this.updateBefore("scroll", { maxDuration: e2 });
          }
          get command() {
            return this.input("command");
          }
          updateCommand(e2) {
            this.transaction((t3) => Object.assign(t3.inputs.command, e2));
          }
          get commandName() {
            return this.command.name;
          }
          set commandName(e2) {
            this.updateCommand({ name: e2 });
          }
          get commandInputs() {
            return this.command.inputs;
          }
          set commandInputs(e2) {
            this.updateCommand({ inputs: e2 });
          }
          get commandConnectionId() {
            return this.command.connectionId;
          }
          set commandConnectionId(e2) {
            this.updateCommand({ connectionId: e2 });
          }
          get commandConnectionName() {
            return this.command.connectionName;
          }
          set commandConnectionName(e2) {
            this.updateCommand({ connectionName: e2 });
          }
          get commandResult() {
            return this.command.result;
          }
          set commandResult(e2) {
            this.updateCommand({ result: e2 });
          }
          get commandTimeout() {
            return this.command.timeout;
          }
          set commandTimeout(e2) {
            this.updateCommand({ timeout: e2 });
          }
          get commandResetChat() {
            return this.command.resetChat;
          }
          set commandResetChat(e2) {
            this.updateCommand({ resetChat: e2 });
          }
          get schedule() {
            return this.input("schedule");
          }
          updateSchedule(e2, t3) {
            typeof e2 != "string" ? (t3 = e2, this.transaction((e3) => Object.assign(e3.inputs.schedule, t3))) : this.transaction((n3) => Object.assign(n3.inputs.schedule[e2], t3));
          }
          get scheduleMediumType() {
            return this.schedule.mediumType;
          }
          set scheduleMediumType(e2) {
            this.updateSchedule({ mediumType: e2 });
          }
          get scheduleMediumId() {
            return this.schedule.mediumType;
          }
          set scheduleMediumId(e2) {
            this.updateSchedule({ mediumId: e2 });
          }
          get scheduleType() {
            return this.schedule.type;
          }
          set scheduleType(e2) {
            this.updateSchedule({ type: e2 });
          }
          get schedulePeriodicalFrequency() {
            return this.schedule.periodical.frequency;
          }
          set schedulePeriodicalFrequency(e2) {
            this.updateSchedule("periodical", { frequency: e2 });
          }
          get scheduleAutoCloseTab() {
            return this.schedule.autoCloseTab;
          }
          set scheduleAutoCloseTab(e2) {
            this.updateSchedule({ autoCloseTab: e2 });
          }
          get tracking() {
            return this.input("tracking");
          }
          updateTracking(e2) {
            this.transaction((t3) => Object.assign(t3.inputs.tracking, e2));
          }
          get trackingValue() {
            return this.tracking.value;
          }
          set trackingValue(e2) {
            this.updateTracking({ value: e2 });
          }
          get actions() {
            return this.input("actions");
          }
          updateAction(e2, t3) {
            this.transaction((n3) => Object.assign(n3.inputs.actions[e2], t3));
          }
          actionEnabled(e2) {
            return this.input("actions")[e2].enabled;
          }
          toggleActionEnabled(e2) {
            this.transaction(
              (t3) => t3.inputs.actions[e2].enabled = !t3.inputs.actions[e2].enabled
            );
          }
          actionTestStatus(e2) {
            return s2.runner.actions[e2].testStatus;
          }
          actionTestMessage(e2) {
            return s2.runner.actions[e2].testMessage;
          }
          get actionSoundValue() {
            return this.input("actions").sound.value;
          }
          set actionSoundValue(e2) {
            this.updateAction("sound", { value: e2 });
          }
          get actionSoundVolume() {
            return this.input("actions").sound.volume;
          }
          set actionSoundVolume(e2) {
            this.updateAction("sound", { volume: e2 });
          }
          get actionSoundUtterance() {
            return this.input("actions").sound.utterance;
          }
          set actionSoundUtterance(e2) {
            this.updateAction("sound", { utterance: e2 });
          }
          actionSendOn(e2) {
            return this.input("actions")[e2].sendOn;
          }
          setActionSendOn(e2, t3) {
            this.transaction((n3) => n3.inputs.actions[e2].sendOn = t3);
          }
          actionLimitActions(e2) {
            return this.input("actions")[e2].limitActions;
          }
          setActionLimitActions(e2, t3) {
            this.transaction((n3) => n3.inputs.actions[e2].limitActions = t3);
          }
          get changeUpIs() {
            return this.input("changeUpIs");
          }
          updateChangeUpIs(e2) {
            this.transaction((t3) => Object.assign(t3.inputs.changeUpIs, e2));
          }
          get changeUpIsValue() {
            return this.changeUpIs.value;
          }
          set changeUpIsValue(e2) {
            this.updateChangeUpIs({ value: e2 });
          }
          get trigger() {
            return this.input("trigger");
          }
          updateTrigger(e2) {
            this.transaction((t3) => Object.assign(t3.inputs.trigger, e2));
          }
          get triggerMinThreshold() {
            return this.trigger.minThreshold;
          }
          set triggerMinThreshold(e2) {
            this.updateTrigger({ minThreshold: e2 });
          }
          get triggerX() {
            return this.trigger.x;
          }
          set triggerX(e2) {
            this.updateTrigger({ x: e2 });
          }
          get triggerY() {
            return this.trigger.y;
          }
          set triggerY(e2) {
            this.updateTrigger({ y: e2 });
          }
          get triggerSearchText() {
            return this.trigger.searchText;
          }
          set triggerSearchText(e2) {
            this.updateTrigger({ searchText: e2 });
          }
          get triggerHttpCodes() {
            return this.trigger.httpCodes;
          }
          set triggerHttpCodes(e2) {
            this.updateTrigger({ httpCodes: e2 });
          }
          get triggerIcon() {
            return this.trigger.icon;
          }
          set triggerIcon(e2) {
            this.updateTrigger({ icon: e2 });
          }
          get triggerColor() {
            return this.trigger.color;
          }
          set triggerColor(e2) {
            this.updateTrigger({ color: e2 });
          }
          get lastRecordValue() {
            if (!this.lastRecord) return { value: "N/A" };
            let {
              value: e2,
              metric: t3,
              type: n3,
              error: a3,
              status: o3
            } = this.lastRecord;
            return o3 === "error" ? { value: e2 } : a3 ? { value: a3?.text || a3 } : e2 == null ? { value: "N/A" } : i2.formatter.format(e2, t3 || n3, {
              format: "object",
              maxInt: 1e7
            });
          }
          get lastRecordValueText() {
            const e2 = this.lastRecordValue;
            let t3 = e2.value;
            return i2.is.object(t3) && (t3 = o2.toJS(t3), t3 = i2.json.stringify(t3, { fallback: t3 })), `${e2.sign || ""}${t3}`;
          }
          get lastRecordValuePrefix() {
            return this.lastRecordValue.prefix || "";
          }
          get lastRecordValueSuffix() {
            const e2 = this.lastRecordValue;
            return `${e2.suffix || ""} ${e2.metric || ""}`.trim();
          }
          get lastRecordValueDimmed() {
            return true === this.lastRecord.valueDimmed || this.lastRecord.value == null;
          }
          get lastRecordMetric() {
            return this.lastRecord.metric;
          }
          get lastRecordStatus() {
            return this.lastRecord.status;
          }
          get lastRecordColor() {
            return this.lastRecord.color;
          }
          get lastRecordTriggered() {
            return this.lastRecord.triggered;
          }
          get lastRecordDispatched() {
            return this.lastRecord.dispatched;
          }
          get lastRecordDelta() {
            return this.lastRecord && this.lastRecord.hasOwnProperty("value") ? typeof this.lastRecord.value != "number" ? null : this.previousRecord && this.previousRecord.hasOwnProperty("value") ? typeof this.previousRecord.value != "number" ? null : this.lastRecord.value - this.previousRecord.value : null : null;
          }
          get lastRecordDeltaText() {
            const e2 = this.lastRecordDelta;
            return e2 ? typeof e2 == "number" ? i2.formatter.format(e2, this.lastRecord.metric) : e2 : null;
          }
          get lastRecordDeltaColor() {
            const e2 = this.lastRecordDelta;
            if (!e2) return null;
            const t3 = this.changeUpIsValue;
            return t3 ? t3 === "neutral" ? "neutral" : e2 > 0 ? t3 === "good" ? "positive" : "negative" : e2 < 0 ? t3 === "bad" ? "positive" : "negative" : "neutral" : null;
          }
          get lastRecordDeltaDirection() {
            const e2 = this.lastRecordDelta;
            return e2 ? typeof e2 != "number" ? null : e2 < 0 ? "down" : "up" : null;
          }
          get lastRecordDeltaSymbol() {
            const e2 = this.lastRecordDeltaDirection;
            return e2 === null ? "" : e2 < 0 ? "\u25BC" : "\u25B2";
          }
          get lastRecordDate() {
            const { ms: e2 } = this.lastRecord;
            return i2.time.formatDate(e2 || Date.now(), {
              hour: "2-digit",
              minute: "2-digit"
            });
          }
          get lastRecordDescription() {
            const { ms: e2 } = this.lastRecord;
            return i2.time.formatRelativeDate(e2 || Date.now());
          }
          get lastRecordInfo() {
            const { info: e2 } = this.lastRecord;
            return i2.toElement(e2);
          }
          get lastRecordInfoString() {
            const { info: e2 } = this.lastRecord;
            return i2.clearFromTags(e2);
          }
          get lastRecordStatusIcon() {
            const { status: e2 } = this.lastRecord;
            return e2 || "ok";
          }
          get lastRecordStatusIconColor() {
            const { color: e2 } = this.lastRecord;
            return e2 || "sublime";
          }
          set previewUrl(e2) {
            this.transaction((t3) => t3.previewUrl = e2);
          }
        };
      })(), (() => {
        const {
          $task: t2,
          $engine: n2,
          $mobx: a2,
          $env: o2,
          $recipe: i2,
          $runner: r2,
          $s: s2
        } = e;
        t2.Context = class {
          async setup({ task: e2 }) {
            if (!e2) throw new Error("task object must be supplied to context");
            const l2 = s2.recipes[e2.recipeId];
            if (!l2) throw new Error(`recipe not found for id ${e2.recipeId}`);
            this.taskId = e2.id, this.taskName = e2.name, this.recipeId = l2.id, this.adapters = i2.adapters, this.api = {
              Locator: n2.Locator,
              Element: n2.Element,
              TextExtractRule: n2.TextExtractRule,
              browser: new n2.Browser(),
              runActions: async (t3) => r2.actionController.runActions(t3, e2),
              updateFavicons: (n3) => t2.proxy.updateFavicons(n3, e2),
              updateTask: (e3) => t2.proxy.updateTask(this.taskId, e3)
            };
            const c2 = (e3) => i2.proxy.step(e3.type), u2 = (e3) => {
              const t3 = { ...c2(e3).config, ...e3 };
              return delete t3.type, t3;
            }, p2 = (e3) => ({
              code: "run",
              content: c2(e3).config?.name || `run ${e3.type}`
            });
            this.steps = l2.steps.map((e3) => ({
              type: e3.type,
              config: u2(e3),
              status: p2(e3),
              result: void 0,
              error: void 0
            }));
            const d2 = e2.records.length === 0, m2 = d2 ? l2 : e2;
            return this.state = a2.toJS(m2.state) || {}, this.widgets = a2.toJS(m2.widgets) || {}, this.inputs = a2.toJS(e2.inputs) || {}, Object.entries(i2.inputs).forEach(([e3, t3]) => {
              this.inputs[e3] || (this.inputs[e3] = a2.toJS(t3.state));
            }), this.storage = {}, d2 ? this.storage = a2.toJS(l2.storage) || {} : o2.is.bg && (this.storage = await t2.dataController.readTask(e2.id) || {}), this.records = a2.toJS(m2.records) || [], this.record = {}, this.recordStorage = {}, delete this.storage.records, this;
          }
          get page() {
            return this.api?.browser?.p1;
          }
          step(e2) {
            return this.steps ? typeof e2 == "number" ? this.steps[e2] || null : this.steps.find((t3) => t3.type === e2) || null : null;
          }
          input(e2) {
            return this.inputs ? this.inputs[e2] : null;
          }
          widget(e2) {
            return this.widgets ? this.widgets[e2] : null;
          }
          copyStepResults(e2, t3, n3) {
            if (n3 = n3 || this, !(e2 = this.step(e2)))
              throw new Error(`step ${e2} not found on context`);
            if (!(t3 = n3.step(t3)))
              throw new Error(`step ${e2} not found on context`);
            e2.result = t3.result, e2.error = t3.error;
          }
          async cleanup() {
            await this.api?.browser?.close();
          }
        };
      })(), (() => {
        const { $task: t2, $recipe: n2 } = e;
        t2.evaluate = (e2, ...t3) => {
          if (!e2) return e2;
          if (typeof e2 != "string") return e2;
          if (e2.startsWith("==")) return e2.slice(1);
          if (!e2.startsWith("=")) return e2;
          let a2 = e2.slice(1);
          if (a2.startsWith("func(") && a2.endsWith(")")) {
            a2 = a2.slice(5, -1);
            const [e3, o2] = a2.split("."), i2 = n2.proxy.adapter(e3);
            return i2[o2].call(i2, ...t3);
          }
          return a2;
        };
      })(), (() => {
        const { $task: t2 } = e;
        t2.PREDEFINED_RECIPE_IDS = [
          "watcher.runCommand",
          "watcher.monitorChanges",
          "watcher.monitorElement",
          "watcher.monitorPrice",
          "watcher.monitorHealth"
        ];
      })(), (() => {
        const {
          $task: t2,
          $analytics: n2,
          $recipe: a2,
          $utils: o2,
          $env: i2,
          $mobx: r2,
          $s: s2
        } = e;
        t2.Runner = class {
          constructor(e2, t3) {
            if (this.options = { autoCleanup: true, ...t3 }, this.task = e2, !e2)
              throw new Error("$task.Runner expects a non-empty task");
            this.ctx = null, this.status = "ready";
          }
          async run(e2 = {}) {
            if (this.status === "running")
              throw new Error("$task.Runner is already running");
            this.status = "running";
            const { autoCleanup: i3 } = { ...this.options, ...e2 }, r3 = () => {
              if (this.status === "terminated") throw new Error("terminated");
            }, { task: s3 } = this;
            try {
              {
                const e4 = t2.proxy.recipeTitle(s3), a3 = (s3?.inputs?.page?.url || "").split("?")[0];
                n2.controller.sendAutomate(e4, a3);
              }
              this.ctx || (this.ctx = await new t2.Context().setup({ task: s3 }), r3());
              const e3 = this.ctx;
              this._runListeners("beforeRecipe"), this._runStepsHooks("beforeRecipe");
              for (let t3 = 0; t3 < e3.steps.length; t3++) {
                const n3 = e3.steps[t3], { code: i4, color: s4, content: l2 } = n3.status;
                i4 === "run" && (n3.status.code = "running"), this._runListeners("beforeStep", { step: n3, stepIndex: t3 }), this._runStepHook("beforeStep", { step: n3, stepIndex: t3 });
                const {
                  s: c2,
                  result: u2,
                  error: p2
                } = await o2.durationOf(
                  () => a2.proxy.step(n3.type).run({ ctx: e3, step: n3, stepIndex: t3 })
                );
                r3();
                const d2 = n3.status.code !== "running", m2 = n3.status.color !== s4, h = n3.status.content !== l2;
                if (void 0 === n3.result && (n3.result = u2), void 0 === n3.error && (n3.error = p2), p2)
                  throw d2 || (n3.status.code = "error"), m2 || (n3.status.color = "error"), p2;
                this._runStepHook("afterStep", { step: n3, stepIndex: t3, s: c2 }), this._runListeners("afterStep", {
                  step: n3,
                  stepIndex: t3,
                  s: c2
                }), d2 || (n3.status.code = "ok"), m2 || (n3.status.color = "positive"), h || c2 === 0 || (n3.status.content = `${l2}, took <b>${c2}</b> seconds`);
              }
              this._runStepsHooks("afterRecipe"), this._runListeners("afterRecipe"), this.ctx.record.ms = Date.now(), await this._updateStorage(), await this._saveTask(), this._logJobRecord(), this.status = "success", this._runListeners("onSuccess");
            } catch (e3) {
              throw this.ctx.record.ms = Date.now(), this._handleError(e3), await this._updateStorage(), await this._saveTask(), this._logJobRecord(), this.status = "failed", this._runListeners("onFailure", { error: e3 }), e3;
            } finally {
              i3 && await this.cleanup();
            }
          }
          async terminate() {
            this.status = "terminated", await this.ctx.cleanup();
          }
          async cleanup() {
            this.ctx && (await this.ctx.cleanup(), this.ctx = null);
          }
          _handleError(e2) {
            e2.message === "terminated" ? this.ctx.record = null : (this.ctx.record.info = e2.hasOwnProperty("info") ? e2.info : `Task Failed: ${e2.message || e2.code}`, this.ctx.record.value = e2.hasOwnProperty("value") ? e2.value : "Failed", this.ctx.record.valueDimmed = !e2.hasOwnProperty("valueDimmed") || e2.valueDimmed, this.ctx.record.status = e2.hasOwnProperty("status") ? e2.status : "error", this.ctx.record.color = e2.hasOwnProperty("color") ? e2.color : "error");
          }
          _logJobRecord() {
            this.ctx.record && s2.journal.logJobFinished(this.task, this.ctx.record);
          }
          async _saveTask() {
            const e2 = r2.toJS({
              ...this._getTaskState(),
              records: [...this.ctx.records, this.ctx.record].filter(Boolean),
              state: this.ctx.state
            }), t3 = o2.byteSizeOf(e2);
            if (t3 > 5e6)
              throw new Error(`${t3} bytes task storage exceeds 5 MB limit`);
            this._updateTaskState(e2);
          }
          async _updateStorage() {
            i2.is.bg && (await t2.dataController.writeTask(
              this.task.id,
              r2.toJS(this.ctx.storage)
            ), this.ctx.recordStorage.steps = this.ctx.steps.filter((e2) => !e2.config.hideInJournal).map((e2) => e2.status), this.ctx.record && await t2.dataController.writeRecord(
              this.task.id,
              this.ctx.record.ms,
              this.ctx.recordStorage
            ));
          }
          _runListeners(e2, t3) {
            this.options[e2] && this.options[e2]({ name: e2, ctx: this.ctx, ...t3 });
          }
          _runStepsHooks(e2) {
            this.ctx.steps.forEach((t3, n3) => {
              this._runStepHook(e2, { step: t3, stepIndex: n3 });
            });
          }
          _runStepHook(e2, t3) {
            const n3 = a2.proxy.step(t3.step.type)[e2];
            typeof n3 == "function" && n3({ name: e2, ctx: this.ctx, ...t3 });
          }
          _getTaskState() {
            return s2.tasks.get(this.task.id);
          }
          _updateTaskState(e2 = {}) {
            t2.proxy.updateTask(this.task.id, e2);
          }
        };
      })(), (() => {
        const { $task: t2 } = e;
        t2.controller = {
          async init() {
            await t2.recipeLoader.init(), await t2.netRulesController.init(), t2.dataController.init(), t2.tabsController.init();
          }
        };
      })(), (() => {
        const { $task: t2, $utils: n2, $idb: a2, $bus: o2, $s: i2 } = e;
        t2.dataController = {
          init() {
            o2.on("task.getTaskIdbKey", this._taskIdbKey, this), o2.on("task.getRecordIdbKey", this._recordIdbKey, this), o2.on("task.cloneTaskStorage", this._cloneTaskStorage, this), this._scheduleCleanupJob(), this._scheduleReduceStorageJob();
          },
          async readTask(e2) {
            const t3 = this._taskIdbKey(e2);
            return await a2.get(t3);
          },
          async writeTask(e2, t3) {
            const n3 = this._taskIdbKey(e2);
            await a2.set(n3, t3);
          },
          async writeRecord(e2, t3, n3) {
            const o3 = this._recordIdbKey(e2, t3);
            await a2.set(o3, n3);
          },
          async _cloneTaskStorage(e2) {
            const [n3, a3] = e2, o3 = await t2.dataController.readTask(n3.id);
            await t2.dataController.writeTask(a3.id, o3);
          },
          _taskIdbKey: (e2) => `task:${e2}`,
          _recordIdbKey: (e2, t3) => `record:${e2}:${t3}`,
          _scheduleCleanupJob() {
            n2.chrome.alarms.run(this._cleanUp.bind(this), {
              name: "task.cleanupStorageJob",
              delayInMinutes: 1,
              periodInMinutes: n2.time.HOUR / n2.time.MINUTE
            });
          },
          _scheduleReduceStorageJob() {
            let e2 = null, t3 = false;
            a2.on("change", () => {
              t3 || (clearTimeout(e2), e2 = setTimeout(() => {
                n2.chrome.alarms.run(() => t3 = false, {
                  once: true,
                  delayInMinutes: 10
                }), t3 = true, this._reduceStorageUsage();
              }, 10));
            }), a2.on("storageExceeded", this._reduceStorageUsage.bind(this));
          },
          async _cleanUp() {
            await this._syncStorageWithState(), await this._reduceStorageUsage();
          },
          async _syncStorageWithState() {
            const e2 = await a2.keys(), n3 = new Set(t2.proxy.taskIds.map(this._taskIdbKey));
            await Promise.all(
              e2.filter((e3) => e3.startsWith("task:")).filter((e3) => !n3.has(e3)).map(async (e3) => {
                t2.log("dropping idb task storage", e3), await a2.remove(e3);
              })
            );
            const o3 = new Set(
              i2.tasks.map((e3) => e3.records.map((t3) => this._recordIdbKey(e3.id, t3.ms))).flat()
            );
            await Promise.all(
              e2.filter((e3) => e3.startsWith("record:")).filter((e3) => !o3.has(e3)).map(async (e3) => {
                t2.log("dropping idb record storage", e3), await a2.remove(e3);
              })
            );
          },
          async _reduceStorageUsage() {
            const e2 = this._reduceStorageUsage;
            if (e2.running) return;
            e2.running = true;
            const o3 = 1e3 * i2.settings.storageLimit * 1e3;
            let { usage: r2 } = await navigator.storage.estimate();
            if (r2 <= o3) return void (e2.running = false);
            const s2 = 0.8 * o3, l2 = [];
            for (const e3 of i2.tasks)
              for (const t3 of e3.records) l2.push({ taskId: e3.id, ms: t3.ms });
            l2.sort((e3, t3) => e3.ms - t3.ms);
            const c2 = {};
            for (const e3 of l2) {
              c2[e3.taskId] || (c2[e3.taskId] = /* @__PURE__ */ new Set()), c2[e3.taskId].add(e3.ms);
              const o4 = this._recordIdbKey(e3.taskId, e3.ms), i3 = await a2.get(o4);
              if (i3 && (t2.log("dropping record to reduce storage usage", o4), await a2.remove(o4), r2 -= n2.byteSizeOf(o4), r2 -= n2.byteSizeOf(i3), r2 <= s2))
                break;
            }
            t2.proxy.removeRecords(c2), e2.running = false;
          }
        };
      })(), (() => {
        const { $task: t2, $mobx: n2, $runner: a2, $s: o2 } = e;
        t2.JobPerformer = class {
          constructor(e2) {
            if (this.job = e2, this.runner = null, this.isRunning = false, this.task = o2.tasks.get(e2.taskId), !this.task)
              throw new Error(`no task found for job with ${e2.taskId} task id`);
            this.task = n2.toJS(this.task), this.updateProgress = this.updateProgress.bind(this);
          }
          async perform() {
            try {
              this.isRunning = true, await this.runRecipe();
            } catch (e2) {
              e2.message !== "terminated" && e2.message !== "No Internet connection" && console.warn("task job failed:", e2);
            } finally {
              this.terminate(), this.isRunning = false;
            }
          }
          async runRecipe() {
            this.isRunning && (o2.stats.taskRuns = (o2.stats.taskRuns || 0) + 1, this.runner = new t2.Runner(this.task, {
              beforeRecipe: this.updateProgress,
              beforeStep: this.updateProgress,
              afterRecipe: this.updateProgress
            }), await this.runner.run());
          }
          updateProgress() {
            const e2 = this.runner.ctx.steps, t3 = e2.filter((e3) => e3.status.code === "ok"), n3 = 10 + Math.floor(80 * t3.length / (e2.length || 1));
            a2.proxy.setJobProgress(this.job.id, n3);
          }
          terminate() {
            ["ready", "running"].includes(this.runner?.status) && this.runner?.terminate();
          }
        };
      })(), (() => {
        const { $task: t2, $netRules: n2 } = e;
        t2.netRulesController = {
          async init() {
            const e2 = this._createUaRules(), t3 = this._createLangRules();
            await n2.register([...e2, ...t3]);
          },
          _createUaRules() {
            const e2 = (e3) => `*://*/*_vua=${e3}*`, n3 = (e3) => t2.userAgents[e3].userAgent;
            return Object.keys(t2.userAgents).filter((e3) => e3 !== "auto").map((t3) => ({
              condition: {
                urlFilter: e2(t3),
                resourceTypes: ["main_frame", "sub_frame"]
              },
              action: {
                type: "modifyHeaders",
                requestHeaders: [
                  { header: "user-agent", operation: "set", value: n3(t3) }
                ]
              }
            }));
          },
          _createLangRules() {
            const e2 = (e3) => `*://*/*_vlang=${e3}*`, n3 = (e3) => e3.includes("_") ? `${e3.replace("_", "-")},${e3.slice(0, e3.indexOf("_"))};q=0.9` : `${e3};q=0.9`;
            return Object.keys(t2.languages).filter((e3) => e3 !== "auto").map((t3) => ({
              condition: {
                urlFilter: e2(t3),
                resourceTypes: ["main_frame", "sub_frame"]
              },
              action: {
                type: "modifyHeaders",
                requestHeaders: [
                  { header: "accept-language", operation: "set", value: n3(t3) }
                ]
              }
            }));
          }
        };
      })(), (() => {
        const { $task: t2, $jsyaml: n2, $utils: a2, $s: o2 } = e;
        t2.recipeLoader = {
          async init() {
            this.readRecipe = this.readRecipe.bind(this), this.recipeIds = t2.PREDEFINED_RECIPE_IDS, await this.readAllRecipes();
          },
          async readAllRecipes() {
            if (!this.recipeIds) return;
            const e2 = await Promise.all(this.recipeIds.map(this.readRecipe));
            o2.recipes = a2.mapBy(e2, "id");
          },
          async readRecipe(e2) {
            const t3 = a2.string.toKebabCase(e2), o3 = chrome.runtime.getURL(`/recipes/${t3}.recipe`);
            try {
              const e3 = await fetch(o3).then((e4) => e4.text()).then((e4) => n2.load(e4));
              return this.normalizeRecipe(e3);
            } catch (t4) {
              console.error(`failed loading recipe ${e2}`, t4);
            }
          },
          normalizeRecipe(e2) {
            e2 = { inputs: [], steps: [], widgets: {}, ...e2 };
            const t3 = (e3) => typeof e3 == "string" ? { type: e3 } : e3;
            return e2.inputs = e2.inputs.map(t3), e2.steps = e2.steps.map(t3), Object.keys(e2.widgets).forEach((n3) => {
              e2.widgets[n3] = t3(e2.widgets[n3]);
            }), e2;
          }
        };
      })(), (() => {
        const { $task: t2, $mobx: n2 } = e;
        t2.tabsController = {
          init() {
            this.autoCleanupUnusedMediumTabs();
          },
          autoCleanupUnusedMediumTabs() {
            n2.reaction(
              () => t2.proxy.taskMediumIds,
              (e2 = [], t3 = []) => {
                const n3 = new Set(e2);
                t3.forEach((e3) => {
                  n3.has(e3) || chrome.tabs.remove(e3).catch(() => {
                  });
                });
              },
              { fireImmediately: true }
            );
          }
        };
      })(), (() => {
        const { $timer: t2, $utils: n2, $bus: a2 } = e;
        t2.aliveController = {
          init() {
            this.startedAt = Date.now(), this.alarmsReceived = 0, this.eventsReceived = 0, this.setupAlarmAlive(), this.setupBusAlive(), this.setupAutoreload();
          },
          setupAlarmAlive() {
            n2.chrome.alarms.run(() => this.alarmsReceived++, {
              name: "timer.alive",
              delayInMinutes: 1,
              periodInMinutes: 1
            });
          },
          setupAutoreload() {
            const e2 = chrome.storage.local, t3 = () => {
              new Promise((t4) => {
                let n3 = false;
                const a3 = () => {
                  e2.onChanged.removeListener(a3), n3 = true;
                };
                e2.onChanged.addListener(a3), e2.set({ testEventDispatching: Math.random() }), setTimeout(() => t4(!n3), 100);
              }).then((e3) => {
                e3 ? chrome.runtime.reload() : setTimeout(t3, 1e4);
              });
            };
            t3();
          },
          setupBusAlive() {
            a2.on("timer.keepBgAlive", () => this.eventsReceived++);
          },
          logStats() {
            const e2 = Date.now(), a3 = Math.floor((e2 - this.startedAt) / n2.time.MINUTE), o2 = `${Math.floor(a3 / 60)}h ${a3 % 60}m`, i2 = `${this.alarmsReceived} alarms`, r2 = `${this.eventsReceived} events`;
            t2.log(`alive for: ${o2}, ${i2}, ${r2}`);
          }
        };
      })(), (() => {
        const { $timer: t2 } = e;
        t2.controller = {
          init() {
            chrome.alarms.clearAll(), t2.timingController.init(), t2.aliveController.init();
          }
        };
      })(), (() => {
        const { $timer: t2, $bus: n2 } = e;
        t2.timingController = {
          init() {
            this._MAX_ID = 2147483647, this._lastId = 0, this._timerIds = /* @__PURE__ */ new Set(), this._setup();
          },
          _setup() {
            globalThis.setTimeout = (e2, t3, ...a2) => {
              const o2 = this._generateId();
              return this._timerIds.add(o2), n2.send("timer.setTimeout", o2, t3).then(() => {
                this._timerIds.has(o2) && e2(...a2);
              }), o2;
            }, globalThis.clearTimeout = (e2) => {
              this._timerIds.delete(e2), n2.send("timer.clearTimeout", e2);
            }, globalThis.setInterval = (e2, t3, ...a2) => {
              const o2 = this._generateId();
              return this._timerIds.add(o2), n2.send("timer.setInterval", o2, t3), n2.on(`timer.setIntervalCall:${o2}`, () => e2(...a2)), o2;
            }, globalThis.clearInterval = (e2) => {
              this._timerIds.delete(e2), n2.off(`offscreen.setIntervalCall:${e2}`), n2.send("timer.clearInterval", e2);
            };
          },
          _generateId() {
            return this._lastId += 1, this._lastId === this._MAX_ID && (this._lastId = 1), this._lastId;
          }
        };
      })(), (() => {
        const { $welcome: t2, $news: n2, $env: a2, $utils: o2, $s: i2 } = e;
        t2.controller = {
          init() {
            this._listenToWelcomeEvents();
          },
          patchTemplate(e2) {
            this.isWelcomeTask(e2) && e2.inputs?.schedule && (e2.inputs.schedule.mediumType = "tab", e2.inputs.schedule.autoCloseTab = false, e2.inputs.schedule.type = "periodical", e2.inputs.schedule.periodical.frequency = "15m");
          },
          isWelcomeTask: (e2) => e2.inputs.page?.url === a2.welcomeUrl,
          onInstalled() {
            chrome.tabs.create({ url: a2.welcomeUrl, active: true });
          },
          onUpdated(e2, t3) {
            if (!a2.showWelcomeOnUpdate) return;
            if (e2 === t3 || !n2.updates) return;
            const r2 = o2.versionNumber(e2), s2 = o2.versionNumber(t3);
            let l2, c2 = [];
            Object.keys(n2.updates).map((e3) => ({ u: e3, value: o2.versionNumber(e3) })).filter((e3) => e3.value > r2 && e3.value <= s2).sort((e3, t4) => t4.value - e3.value).forEach((e3) => {
              const t4 = n2.updates[e3.u].filter((e4) => e4.card || e4.video);
              l2 = l2 || n2.updates[e3.u].find((e4) => typeof e4 == "string"), c2.push(...t4);
            }), c2.length !== 0 && (c2 = c2.map(
              (e3) => e3.video ? { card: "video", ...e3.video } : e3
            ), i2.transaction(() => {
              const e3 = t3.split(".")[1] === "0" ? t3.split(".")[0] : t3.split(".")[0] + "." + t3.split(".")[1];
              i2.welcome.title = `UPDATED TO V${e3}`, i2.welcome.status = [
                l2 || "Your AI agent has been updated, here is what's new."
              ], i2.welcome.featuresTitle = "WHAT'S NEW", i2.welcome.features = c2;
            }), chrome.tabs.create({ url: a2.welcomeUrl, active: true }));
          },
          _listenToWelcomeEvents() {
            chrome.runtime.onMessage.addListener((e2, t3) => {
              const n3 = e2?.type;
              if (!n3) return;
              const a3 = t3?.tab?.id;
              a3 && n3 === "welcome.fetchState" && chrome.tabs.sendMessage(a3, {
                type: "welcome.setState",
                state: i2.welcome
              });
            });
          }
        };
      })(), (() => {
        const { $uninstall: t2, $env: n2, $s: a2, $mobx: o2 } = e;
        t2.controller = {
          init() {
            o2.reaction(
              () => a2.billing.account?.email,
              () => this.updateUninstallUrl(),
              { fireImmediately: true }
            ), o2.reaction(
              () => a2.billing.hasPro(),
              () => this.updateUninstallUrl(),
              { fireImmediately: false }
            );
          },
          updateUninstallUrl() {
            const e2 = a2.agentId || "", t3 = a2.billing.account?.email || "", o3 = a2.billing.hasPro() || false;
            let i2 = `${n2.apiUrl}/uninstall?uid=${e2}&hasPro=${o3}`;
            t3 && (i2 += `&email=${encodeURIComponent(t3)}`), chrome.runtime.setUninstallURL(i2);
          }
        };
      })(), (() => {
        const {
          $yousummary: t2,
          $env: n2,
          $bus: a2,
          $utils: o2,
          $browser: i2,
          $s: r2
        } = e;
        t2.controller = {
          init() {
            a2.on("yousummary.get-summary", this._loadSummary.bind(this));
          },
          onAiAnswer({ chatId: e2, answer: t3, tabId: n3, url: o3 }) {
            if (!t3) return t3;
            return r2.chats.get(e2)?.command?.meta?.name !== "youtube-summary" || (t3 = this._fixYoutubeTimestamps(t3, o3), t3 = this._dropEmptyHours(t3), t3 = this._dropSummaryArtefacts(t3), a2.send(n3, "yousummary.append-summary", t3)), t3;
          },
          async submitSummary(e2, { type: a3, lang: r3, content: s2 }) {
            if (!s2) return;
            const l2 = await chrome.tabs.get(e2);
            if (!l2) return;
            const c2 = l2.url || "";
            if (!c2.startsWith("https://www.youtube.com/watch?")) return;
            const u2 = new URL(c2).searchParams.get("v");
            if (!u2) return;
            const p2 = {
              ytid: u2,
              type: a3,
              lang: r3,
              content: s2 = this._cleanupTimestamps(s2),
              title: null,
              thumbnailUrl: null,
              channelId: null,
              channelName: null
            };
            try {
              const t3 = await i2.controller.connectTab(e2), n3 = await t3.evaluate(() => {
                const e3 = document.querySelector("title")?.textContent, t4 = document.querySelector('link[itemprop="thumbnailUrl"]')?.getAttribute("href");
                return {
                  title: e3,
                  thumbnailUrl: t4,
                  channelId: document.querySelector(
                    'span[itemprop="author"] link[itemprop="url"]'
                  )?.getAttribute("href") || document.querySelector('a#header[href^="/@"]')?.getAttribute("href"),
                  channelName: document.querySelector('link[itemprop="name"]')?.getAttribute("content") || document.querySelector('a#header[href^="/@"] #title')?.innerText
                };
              });
              Object.assign(p2, n3);
            } catch (e3) {
              t2.error(e3);
            }
            p2.title || (p2.title = l2.title || ""), p2.title?.endsWith(" - YouTube") && (p2.title = p2.title.slice(0, -10)), p2.thumbnailUrl || (p2.thumbnailUrl = `https://img.youtube.com/vi/${u2}/0.jpg`), p2.channelId && (p2.channelId = p2.channelId.split("/@").at(-1));
            try {
              await fetch(`${n2.apiUrl}/yousummary/videos/submit`, {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  "x-hash": o2.hashCode(`yousummary:${u2}`)
                },
                body: JSON.stringify(p2)
              });
            } catch (e3) {
              t2.error(e3);
            }
          },
          async getSummary(e2) {
            const t3 = await chrome.tabs.get(e2);
            if (!t3) return null;
            const n3 = t3.url || "";
            if (!n3.startsWith("https://www.youtube.com/watch?")) return null;
            const a3 = new URL(n3).searchParams.get("v");
            return a3 ? await this._loadSummary(a3) : null;
          },
          async _loadSummary(e2) {
            const a3 = `/yousummary/videos/${e2}?auto&lang=${r2.settings.promptLanguageValue}`;
            try {
              let t3 = await fetch(`${n2.apiUrl}${a3}`, {
                headers: { "x-hash": o2.hashCode(`yousummary:${e2}`) }
              });
              if (t3 = await t3.json(), !t3) return null;
              let i3 = t3.video?.summaries?.[0]?.content;
              if (!i3) return null;
              const r3 = /\[(\d?\d:)?(\d\d):(\d\d)]([^(])/gm;
              return i3.replace(r3, (t4, n3, a4, o3, i4) => {
                const r4 = 3600 * parseInt(n3 || 0) + 60 * parseInt(a4 || 0) + parseInt(o3 || 0);
                return `[${n3 || ""}${a4}:${o3}](${`https://www.youtube.com/watch?v=${e2}&t=${r4}s`})${i4}`;
              });
            } catch (e3) {
              return t2.error(e3), null;
            }
          },
          _fixYoutubeTimestamps(e2, t3) {
            const n3 = [
              ...e2.matchAll(
                /\[(?<hour>\d\d?:)?(?<minute>\d\d?):(?<second>\d\d?)]/gm
              )
            ];
            let a3 = 0;
            return n3.forEach((n4) => {
              const { hour: o3, minute: i3, second: r3 } = n4.groups, s2 = 3600 * parseInt(o3 || 0) + 60 * parseInt(i3 || 0) + parseInt(r3 || 0), l2 = `https://youtube.com/${new URL(t3).searchParams.get("v")}?t=${s2}s`;
              e2 = e2.slice(0, n4.index + a3) + e2.slice(n4.index + a3).replace(n4[0], n4[0] + `(${l2})`), a3 += l2.length + 2;
            }), console.log(e2), e2;
          },
          _dropEmptyHours(e2) {
            const t3 = [
              ...e2.matchAll(/\[(?<hour>\d\d?:)?(\d\d?):(\d\d?)]\((https:\/\/)/gm)
            ];
            let n3 = 0;
            return t3.filter((e3) => e3.groups.hour === "00:").forEach((t4) => {
              e2 = e2.slice(0, t4.index + n3 + 1) + e2.slice(t4.index + n3 + 4), n3 -= 3;
            }), e2;
          },
          _dropSummaryArtefacts(e2) {
            const t3 = /(-\s)?(\[(\d{2}:)?\d{2}:\d{2}])[^)]+/g;
            if ((e2.match(t3) || []).length < 3) return e2;
            const n3 = /^\s*-/;
            return e2.split("\n").filter(
              (e3) => e3.trim() === "" || n3.test(e3) || e3.match(t3)?.length > 0
            ).join("\n");
          },
          _cleanupTimestamps(e2) {
            const t3 = /(-\s)?(\[(\d{2}:)?\d{2}:\d{2}])\([^)]+\)/g, n3 = /^\s*-/;
            return e2 = (e2 = (e2 || "").replace(t3, "- $2")).split("\n").filter(
              (e3) => e3.trim() === "" || n3.test(e3) || e3.match(t3)?.length > 0
            ).map((e3) => e3.replaceAll("**", "")).join("\n");
          }
        };
      })(), (() => {
        const { $store: t2, $s: n2 } = e;
        t2.getChatEmoji = () => {
          const e2 = [
            "\u{1F9EC}",
            "\u{1F980}",
            "\u{1F3D6}\uFE0F",
            "\u{1F5FC}",
            "\u{1F52C}\uFE0F\uFE0F\uFE0F\uFE0F\uFE0F\uFE0F",
            "\u{1F680}",
            "\u{1F36A}",
            "\u{1F33C}",
            "\u{1F980}",
            "\u{1F355}",
            "\u{1F388}\uFE0F\uFE0F",
            "\u{1F991}",
            "\u{1F990}",
            "\u{1F342}",
            "\u{1F989}",
            "\u{1F332}",
            "\u{1F316}",
            "\u{1F697}",
            "\u{1F344}",
            "\u{1F994}",
            "\u{1F32A}",
            "\u{1F354}",
            "\u{1F433}",
            "\u{1F340}",
            "\u{1F33B}",
            "\u{1F338}",
            "\u{1F35F}",
            "\u{1F341}",
            "\u{1F419}",
            "\u{1F34C}",
            "\u{1F319}",
            "\u{1F421}",
            "\u{1F34E}",
            "\u{1F420}",
            "\u{1F33A}",
            "\u{1F6E1}",
            "\u{1F308}",
            "\u{1F3BE}",
            "\u{1F682}",
            "\u{1F31E}",
            "\u{1F988}",
            "\u26FA",
            "\u{1F352}",
            "\u{1F98B}",
            "\u{1F40A}",
            "\u{1F3C6}\uFE0F\uFE0F\uFE0F\uFE0F\uFE0F\uFE0F",
            "\u26BD",
            "\u{1F41D}",
            "\u{1F4A1}\uFE0F\uFE0F\uFE0F\uFE0F\uFE0F\uFE0F",
            "\u{1F50B}\uFE0F\uFE0F\uFE0F\uFE0F\uFE0F\uFE0F",
            "\u{1F5FF}",
            "\u{1F3F0}",
            "\u{1FA84}",
            "\u{1F384}",
            "\u{1F381}",
            "\u{1F383}",
            "\u{1F981}",
            "\u{1F42F}",
            "\u{1F43B}",
            "\u{1F428}"
          ], t3 = e2.indexOf(n2.chats.at(-1)?.emoji);
          return e2[t3 + 1] || e2[0];
        };
      })(), (() => {
        const { $store: t2, $env: n2 } = e;
        t2.controller = {
          async init() {
            await t2.stateController.init(), (n2.is.bg || n2.is.fg) && await t2.versioner.init(), n2.is.pp && await t2.resetController.init();
          }
        };
      })(), (() => {
        const { $store: t2, $utils: n2, $mobx: a2 } = e;
        t2.deducer = {
          _replicaKey: Symbol("replica"),
          _currentProxy: null,
          _arrayMethods: /* @__PURE__ */ new Set([
            "pop",
            "push",
            "shift",
            "unshift",
            "splice",
            "reverse"
          ]),
          modify(e2, t3) {
            const n3 = [], a3 = this._proxify(e2, n3);
            return this._currentProxy = a3, t3(a3), this._currentProxy = null, n3;
          },
          applyActions(e2, t3 = []) {
            for (const n3 of t3) {
              const t4 = this._get(e2, n3.getter);
              void 0 !== t4 && (n3.type === "call" ? t4[n3.method](...n3.args) : n3.type === "set" ? t4[n3.key] = n3.value : n3.type === "delete" && delete t4[n3.key]);
            }
          },
          getCurrentProxy() {
            return this._currentProxy;
          },
          _proxify(e2, t3 = [], o2 = []) {
            if (this._isProxy(e2)) return e2;
            const i2 = n2.is.array(e2), r2 = n2.is.object(e2);
            if (!i2 && !r2) return e2;
            const s2 = i2 ? [...e2] : { ...e2 };
            return new Proxy(s2, {
              get: (n3, a3) => a3 === this._replicaKey ? s2 : a3 in s2 ? i2 && this._isArrayMethod(a3) ? (...n4) => (t3.push({ type: "call", method: a3, getter: o2, args: n4 }), e2[a3](...n4), s2[a3](...n4)) : (s2[a3] = this._proxify(s2[a3], t3, [...o2, a3]), s2[a3]) : void 0,
              set: (i3, r3, l2) => (e2[r3] = this._deproxify(l2), s2[r3] = this._proxify(e2[r3], t3, [...o2, r3]), n2.is.symbol(r3) || t3.push({ type: "set", key: r3, getter: o2, value: a2.toJS(e2[r3]) }), true),
              deleteProperty: (a3, i3) => (delete e2[i3], delete s2[i3], n2.is.symbol(i3) || t3.push({ type: "delete", key: i3, getter: o2 }), true)
            });
          },
          _deproxify(e2) {
            if (!this._isProxy(e2)) return e2;
            const t3 = e2[this._replicaKey];
            for (const e3 in t3) t3[e3] = this._deproxify(t3[e3]);
            return t3;
          },
          _isProxy(e2) {
            return !(!e2 || !e2[this._replicaKey]);
          },
          _get(e2, t3 = []) {
            let n3 = e2;
            for (const e3 of t3) {
              if (!n3.hasOwnProperty(e3)) return;
              n3 = n3[e3];
            }
            return n3;
          },
          _isArrayMethod(e2) {
            return this._arrayMethods.has(e2);
          }
        };
      })(), (() => {
        const { $store: t2, $idb: n2, $s: a2 } = e;
        t2.patcher = {
          async applyPatch(e2) {
            const { stateActions: o2, dataActions: i2 } = e2;
            i2 && await Promise.all(
              Object.keys(i2).map((e3) => {
                const t3 = i2[e3];
                return t3 === "command:delete" ? n2.remove(e3) : n2.set(e3, t3);
              })
            ), o2 && a2.transaction(() => {
              t2.deducer.applyActions(a2, o2);
            });
          }
        };
      })(), (() => {
        const {
          $store: t2,
          $utils: n2,
          $mobx: a2,
          $idb: o2,
          $bus: i2,
          $env: r2,
          $s: s2
        } = e;
        t2.stateController = {
          async init() {
            this._debug = false, this._idbKey = "store.state", this._parent_ = Symbol("parent"), this._access_ = Symbol("access"), this._txActions = [], this._txRunning = false, this._applyingActions = false, this._persistSaving = false, this._persistPending = false, this._persistTimeout = null, this._afterChangeListeners = [], this._state = await this._initState(), a2.configure({ enforceActions: "never" }), i2.on("store.actions", this._applyActions, this), r2.is.bg && i2.on("store.getBgState", () => this._state), t2.state = this._state, t2.transaction = this._transaction.bind(this), s2.init(this._state), this._persistWithDebounce();
          },
          onAfterChange(e2) {
            this._afterChangeListeners.push(e2);
          },
          async _initState() {
            let e2;
            return r2.is.pp ? e2 = await i2.send("store.getBgState") : (r2.is.bg || r2.is.fg) && (e2 = await o2.get(this._idbKey) || t2.template.state()), this._proxify(e2);
          },
          _transaction(e2) {
            if (this._txRunning) return void e2(this._state);
            if (this._txActions = [], a2.runInAction(() => {
              this._txRunning = true;
              try {
                e2(this._state);
              } catch (e3) {
                t2.error("transaction failed", e3);
              }
              this._txRunning = false;
            }), this._txActions.length === 0)
              return;
            const n3 = this._txActions;
            this._txActions = [], this._broadcastActions(n3), this._callAfterChangeListeners(n3), this._persistWithDebounce();
          },
          _proxify(e2, t3 = null, o3 = null) {
            if (!n2.is.nonPrimitive(e2)) return e2;
            const i3 = a2.observable(e2);
            return this._intercept(i3, t3, o3), i3;
          },
          _intercept(e2, o3 = null, i3 = null) {
            if (e2 && a2.isObservable(e2)) {
              if (e2[this._parent_])
                return e2[this._parent_] !== o3 && (e2[this._parent_] = o3), void (e2[this._access_] !== i3 && (e2[this._access_] = i3));
              if (Object.defineProperty(e2, this._parent_, {
                get: () => o3,
                set: (e3) => o3 = e3
              }), Object.defineProperty(e2, this._access_, {
                get: () => i3,
                set: (e3) => i3 = e3
              }), Object.defineProperty(e2, "$", { get: () => a2.toJS(e2) }), this._applyAdapters(e2, t2.adapter || {}), a2.intercept(e2, (e3) => this._onChange(e3)), n2.is.nonPrimitive(e2))
                for (const t3 in e2) this._intercept(e2[t3], e2, t3);
            }
          },
          _onChange(e2) {
            if (this._applyingActions) return e2;
            if (n2.is.symbol(e2.name)) return e2;
            if (e2.type === "add" && void 0 === e2.newValue) return e2;
            let t3;
            return e2.type === "add" || e2.type === "update" ? t3 = this._processChangeSet(e2) : e2.type === "remove" ? t3 = this._processChangeRemove(e2) : e2.type === "splice" && (t3 = this._processChangeSplice(e2)), t3 ? (this._txRunning ? this._txActions.push(t3) : (this._broadcastActions([t3]), this._persistWithDebounce(), setTimeout(() => this._callAfterChangeListeners([t3]))), e2) : void 0;
          },
          _processChangeSet(e2) {
            const t3 = e2.name ?? e2.index;
            if (e2.object[t3] === e2.newValue) return;
            const n3 = this._deproxify(e2.newValue);
            return e2.newValue = this._proxify(n3, e2.object, t3), { type: "set", path: this._locate(e2.object), key: t3, value: n3 };
          },
          _processChangeRemove(e2) {
            return { type: "remove", key: e2.name, path: this._locate(e2.object) };
          },
          _processChangeSplice(e2) {
            const t3 = this._deproxify(e2.added);
            return e2.added = t3.map(
              (t4, n3) => this._proxify(t4, e2.object, e2.index + n3)
            ), {
              type: "splice",
              path: this._locate(e2.object),
              index: e2.index,
              added: t3,
              removedCount: e2.removedCount
            };
          },
          _applyActions(e2 = []) {
            e2.length !== 0 && (a2.runInAction(() => {
              this._applyingActions = true, e2.forEach((e3) => this._applyAction(e3)), this._applyingActions = false;
            }), this._logActions(e2), this._persistWithDebounce(), this._callAfterChangeListeners(e2));
          },
          _applyAction(e2) {
            const n3 = this._get(this._state, e2.path);
            if (n3) {
              if (e2.type === "set") n3[e2.key] = this._proxify(e2.value, n3, e2.key);
              else if (e2.type === "remove") delete n3[e2.key];
              else if (e2.type === "splice") {
                const t3 = e2.added.map((t4, a3) => this._proxify(t4, n3, e2.index + a3));
                n3.splice(e2.index, e2.removedCount, ...t3);
              }
            } else t2.error("action target not found", e2);
          },
          _applyAdapters(e2, t3) {
            const n3 = this._locate(e2);
            for (const a3 in t3)
              this._pathMatchesMask(n3, a3) && this._applyAdapter(e2, t3[a3]);
          },
          _pathMatchesMask(e2, t3, n3 = true) {
            if (t3 === "**") return true;
            const a3 = t3 === "" ? [] : t3.split(".");
            if (n3 && e2.length !== a3.length) return false;
            if (a3.length > e2.length) return false;
            for (let t4 = 0; t4 < e2.length && a3[t4]; t4++)
              if (a3[t4] !== "*" && a3[t4] !== e2[t4]) return false;
            return true;
          },
          _applyAdapter(e2, o3) {
            const i3 = Object.getOwnPropertyDescriptors(o3);
            for (const o4 in i3) {
              if (e2.hasOwnProperty(o4)) {
                o4 !== "update" && t2.warn("adapter key already exists on target", {
                  key: o4,
                  target: a2.toJS(e2),
                  path: this._locate(e2).join(".")
                });
                continue;
              }
              let r3;
              const { get: s3, set: l2, value: c2 } = i3[o4];
              Object.defineProperty(e2, o4, {
                get: () => s3 ? s3.call(e2) : r3 || (n2.is.function(c2) && (r3 = c2.bind(e2)), r3 || void 0),
                set: (t3) => (l2 && l2.call(e2, t3), true)
              });
            }
          },
          _broadcastActions(e2) {
            e2.length !== 0 && i2.send("store.actions", e2);
          },
          _locate(e2) {
            const t3 = [];
            let a3 = e2;
            for (; ; ) {
              const e3 = a3[this._parent_];
              if (!e3) break;
              let o3;
              n2.is.array(e3) ? (o3 = e3.indexOf(a3), -1 === o3 && (o3 = a3[this._access_])) : o3 = a3[this._access_], t3.unshift(o3), a3 = e3;
            }
            return t3;
          },
          _get(e2, t3 = []) {
            let n3 = e2;
            for (const e3 of t3) {
              if (!n3.hasOwnProperty(e3)) return;
              n3 = n3[e3];
            }
            return n3;
          },
          _persistWithDebounce() {
            if (!r2.is.bg && !r2.is.fg) return;
            if (this._persistSaving) return void (this._persistPending = true);
            const e2 = r2.is.development ? 100 : 2e3;
            clearTimeout(this._persistTimeout), this._persistTimeout = setTimeout(async () => {
              this._persistSaving = true;
              try {
                await o2.set(this._idbKey, a2.toJS(this._state));
              } catch (e3) {
                t2.error("persist failed", e3);
              }
              this._persistSaving = false, this._persistPending && (this._persistPending = false, this._persistWithDebounce());
            }, e2);
          },
          _deproxify(e2) {
            if (a2.isObservable(e2)) return a2.toJS(e2);
            if (n2.is.array(e2)) return e2.map((e3) => this._deproxify(e3));
            if (n2.is.object(e2)) {
              const t3 = {};
              return Object.keys(e2).forEach((n3) => t3[n3] = this._deproxify(e2[n3])), t3;
            }
            return e2;
          },
          _callAfterChangeListeners(e2) {
            this._afterChangeListeners.forEach((t3) => t3(e2));
          },
          _logActions(e2) {
            this._debug && (e2 = e2.map((e3) => ((e3 = { ...e3 }).path = e3.path.join("."), e3)), t2.log("apply", e2.length === 1 ? e2[0] : e2));
          }
        };
      })(), (() => {
        const { $store: t2, $env: n2, $utils: a2, $s: o2 } = e;
        t2.versioner = {
          async init() {
            await this._upgradeState();
          },
          async _upgradeState() {
            const e2 = t2.version;
            for (let n3 = 0; n3 <= e2; n3++) {
              if (!(n3 in t2.versions)) continue;
              const e3 = t2.versions[n3];
              a2.is.function(e3.before) && await this._patchFunction(n3, e3.before), a2.is.function(e3) && await this._patchFunction(n3, e3), a2.is.function(e3.patchState) && this._patchState(n3, (t3) => e3.patchState(t3)), a2.is.function(e3.patchTask) && this._patchTasks(n3, (t3, n4) => e3.patchTask(t3, n4)), a2.is.function(e3.patchChat) && this._patchChats(n3, (t3, n4) => e3.patchChat(t3, n4)), a2.is.function(e3.patchTab) && this._patchTabs(n3, (t3, n4) => e3.patchTab(t3, n4)), a2.is.function(e3.after) && await this._patchFunction(n3, e3.after);
            }
            o2.transaction(() => {
              o2.version = e2, o2.tasks.forEach((t3) => t3.version = e2);
            });
          },
          async upgradeTaskPatch(e2) {
            const o3 = e2.stateActions.filter(
              (e3) => e3.type === "call" && e3.method === "push" && e3.getter.length === 1 && e3.getter[0] === "tasks"
            ).map((e3) => e3.args[0]);
            if (o3.length === 0) return;
            const i2 = o3.find((e3) => e3.version > t2.version);
            if (i2)
              throw new Error(
                `Task ${(i2.name || i2.id).toUpperCase()} is not compatible with HARPA version ${n2.version}. Please update HARPA client.`
              );
            const r2 = t2.version;
            for (let e3 = 0; e3 <= r2; e3++) {
              if (!(e3 in t2.versions)) continue;
              const n3 = t2.versions[e3];
              a2.is.function(n3.patchTask) && o3.forEach((e4) => n3.patchTask(e4));
            }
            o3.forEach((e3) => e3.version = r2);
          },
          async _patchFunction(e2, t3) {
            o2.version >= e2 || await t3();
          },
          _patchState(e2, t3) {
            o2.version >= e2 || o2.transaction(() => t3(o2));
          },
          _patchTasks(e2, t3) {
            o2.transaction(() => {
              o2.tasks.filter((t4) => t4.version < e2).forEach((e3) => t3(e3, o2));
            });
          },
          _patchChats(e2, t3) {
            o2.version >= e2 || o2.transaction(() => {
              o2.chats.forEach((e3) => t3(e3, o2));
            });
          },
          _patchTabs(e2, t3) {
            o2.version >= e2 || o2.transaction(() => {
              Object.values(o2.tabs).forEach((e3) => t3(e3, o2));
            });
          }
        };
      })(), (() => {
        const { $store: t2, $utils: n2 } = e, a2 = () => n2.id.pico();
        t2.idGenerator = {
          agent: () => `agent-${a2()}-${a2()}-${a2()}-${a2()}`,
          task: () => `task-${a2()}-${a2()}`,
          job: () => `job-${a2()}-${a2()}`,
          command: () => `command-${a2()}-${a2()}`,
          chat: () => `chat-${a2()}-${a2()}`
        };
      })(), (() => {
        const { $store: t2, $env: n2, $s: a2 } = e;
        Object.defineProperty(t2, "version", {
          get: () => n2.is.pp ? a2.version : Math.max(...Object.keys(t2.versions).map(Number))
        });
      })(), (() => {
        const { $store: t2, $utils: n2, $billing: a2, $s: o2 } = e;
        t2.versions = {
          288: {
            patchState: (e2) => {
              e2.grid.allowedActions.push({ name: "prompt", enabled: true });
            }
          },
          287: {
            patchState: (e2) => {
              for (const t4 of e2.ai.connections)
                t4.superpowers || (t4.superpowers = { web: true, page: true, commands: true });
              const t3 = e2.billing.account?.spaces || [];
              for (const e3 of t3)
                for (const t4 of e3.connections)
                  t4.superpowers || (e3.hasUnsavedChanges = true, t4.superpowers = { web: true, page: true, commands: true });
            }
          },
          286: {
            patchState: (e2) => {
              delete e2.ai.connectionsSaved;
              const t3 = e2.billing.account;
              e2.ai.connectionsSavedAccountIds = t3 ? [t3.id] : [];
            }
          },
          285: {
            patchState: (e2) => {
              e2.youtube = t2.template.youtube();
            }
          },
          284: {
            patchState: (e2) => {
              delete e2.contextMenu;
            }
          },
          283: {
            patchState: (e2) => {
              i2(e2, "harpa-v2-fast", "harpa-v1"), i2(e2, "harpa-v1-smart", "harpa-v1");
            }
          },
          282: {
            patchState: (e2) => {
              e2.shortcut.qab.actions.push("post-summary");
            }
          },
          281: {
            patchState: (e2) => {
              i2(e2, "harpa-v2-smart", "harpa-v1");
            }
          },
          280: {
            patchState: (e2) => {
              e2.ai.mode.think = { default: false, flag: "t" };
            },
            patchChat: (e2) => {
              e2.mode.think = { enabled: false };
            }
          },
          279: {
            patchState: (e2) => {
              i2(e2, "harpa-v1-smart", "harpa-v2-smart");
            }
          },
          278: {
            patchState: (e2) => {
              i2(e2, "harpa-v2-fast", "harpa-v1-smart");
            }
          },
          277: {
            patchState: (e2) => {
              e2.settings.keepPdfs = true;
            }
          },
          276: {
            patchState: (e2) => {
              e2.settings.showUpdateNotes = true;
            }
          },
          275: {
            patchState: (e2) => {
              e2.note = t2.template.note();
            }
          },
          274: {
            patchState: (e2) => {
              e2.ai.connections.filter((e3) => e3.type === "openai-license").forEach((e3) => {
                e3.provider = "custom", e3.proxyPath = "/v1/chat/completions", e3.proxyUrl || (e3.proxyUrl = "https://api.openai.com");
              });
              (e2.billing.account?.spaces || []).forEach((e3) => {
                e3.hasUnsavedChanges = true, e3.connections.filter((e4) => e4.type === "openai-license").forEach((e4) => {
                  e4.provider = "custom", e4.proxyPath = "/v1/chat/completions";
                });
              });
            }
          },
          273: {
            patchState: (e2) => {
              e2.ai.openaiSession.maxTokenFactor = 1;
            }
          },
          272: {
            patchChat: (e2) => {
              for (const t3 of e2.messages)
                t3.attachments && (t3.attachments = t3.attachments.map((e3) => ({
                  id: e3.id,
                  type: "image",
                  image: { low: e3.low, high: e3.high },
                  ...e3.hidden && { hidden: e3.hidden }
                })));
            }
          },
          271: {
            patchChat: (e2) => {
              e2.attachments = e2.attachments.map((e3) => ({
                id: e3.id,
                type: "image",
                image: { low: e3.low, high: e3.high },
                ready: e3.ready
              }));
            }
          },
          270: {
            patchState: (e2) => {
              const t3 = e2.settings.connectionId, n3 = e2.billing.account?.spaces || [];
              e2.settings.connectionIds = { default: t3 };
              for (const a3 of n3) e2.settings.connectionIds[a3.id] = t3;
              delete e2.settings.connectionId;
            }
          },
          269: {
            patchState: (e2) => {
              e2.acknowledged.spaceConnections = false;
            }
          },
          268: {
            patchState: (e2) => {
              e2.ai.connectionsSaved = false;
            }
          },
          267: {
            patchState: (e2) => {
              for (const t3 of e2.ai.connections)
                t3.type === "cloudgpt" && delete t3.description;
            }
          },
          266: {
            patchState: (e2) => {
              const t3 = {};
              for (const a3 of e2.ai.connections) {
                const e3 = a3.type === "cloudgpt", o3 = a3.type === "openai-license";
                if (!e3 && !o3) continue;
                const i3 = `${e3 ? "cloud" : "api"}-${n2.id.nano()}`;
                t3[a3.id] = i3, a3.id = i3;
              }
              for (const n3 of e2.chats)
                t3[n3.connectionId] && (n3.connectionId = t3[n3.connectionId]);
              t3[e2.settings.connectionId] && (e2.settings.connectionId = t3[e2.settings.connectionId]);
            }
          },
          265: {
            patchState: (e2) => {
              delete e2.ai.presetConnectionDone, e2.grid = t2.template.grid();
            }
          },
          264: {
            patchState: (e2) => {
              e2.shortcut.actions.reloadFrame = {
                hotkey: "auto KeyR",
                global: true
              }, e2.shortcut.actions.startNewChat = { hotkey: "auto KeyN" }, e2.shortcut.actions.resetChatHistory = { hotkey: "auto KeyB" };
            }
          },
          263: {
            patchState: (e2) => {
              e2.acknowledged = {
                affiliate: e2.billing.affiliate.acknowledged,
                blackfriday: false
              }, delete e2.billing.affiliate;
            }
          },
          262: { patchState: () => {
          } },
          261: {
            patchState: (e2) => {
              e2.billing.affiliate = { acknowledged: false };
            }
          },
          260: {
            patchState: (e2) => {
              e2.global.userinfo && e2.global.userinfo.trim().length !== 0 || (e2.global.userinfo = void 0);
            }
          },
          259: {
            patchState: (e2) => {
              e2.settings.autohideHeader = true;
            }
          },
          258: {
            patchTab: (e2) => {
              delete e2.creator.frame.collapsed;
            }
          },
          257: {
            patchState: (e2) => {
              e2.settings.preferSidePanel = false;
            }
          },
          256: {
            patchTab: (e2) => {
              delete e2.creator.frame.wide;
            }
          },
          255: {
            patchState: (e2) => {
              e2.settings.frameWidth = e2.settings.preferredWidth, delete e2.settings.preferredWidth;
            }
          },
          254: {
            patchState: (e2) => {
              for (const t3 of e2.chats)
                if (t3.messages) for (const e3 of t3.messages) delete e3.html;
            }
          },
          253: {
            patchState: (e2) => {
              e2.billing.upsell.disabledTill = null;
            }
          },
          252: {
            patchState: (e2) => {
              e2.settings.stickyFeaturesPanel = false;
            }
          },
          251: {
            patchState: (e2) => {
              e2.settings.csp.allowAll = true;
            }
          },
          250: { patchState: () => {
          } },
          249: {
            patchState: (e2) => {
              const t3 = e2.billing.account?.id || null;
              e2.chats.forEach((e3) => {
                e3.accountId = t3;
              });
            }
          },
          248: {
            patchState: (e2) => {
              e2.settings.synchChats = false;
              for (const t3 of e2.ai.connections)
                t3.type === "openai-license" && (t3.detail = "high");
            },
            patchChat: (e2) => {
              e2.updatedAt = null;
            }
          },
          247: {
            patchState: (e2) => {
              e2.shortcut.actions.copyLastAnswer = { hotkey: "cmd shift KeyC" }, e2.shortcut.actions.pasteLastAnswer = {
                hotkey: "cmd shift KeyV"
              };
            }
          },
          246: {
            patchState: (e2) => {
              e2.billing.upsell.tokenUnits = 20;
            }
          },
          245: {
            patchState: (e2) => {
              e2.billing.upsell.type = "upgrade";
            }
          },
          244: {
            patchState: (e2) => {
              e2.billing.pricingLastUpdatedAt = -1;
            }
          },
          243: {
            patchState: (e2) => {
              e2.billing.upsell = {
                show: false,
                annual: false,
                planId: "s1",
                reason: null
              };
            }
          },
          242: {
            patchState: (e2) => {
              e2.billing.standardMessages = 0, e2.billing.standardMessageRecoveryAt = Date.now();
            }
          },
          241: {
            patchState: (e2) => {
              e2.billing.account && (e2.billing.account.stats = { pm: e2.billing.powerMessages }), delete e2.billing.powerMessages;
            }
          },
          240: {
            patchState: (e2) => {
              const t3 = Object.values(e2.shortcut.actions).map((e3) => e3.hotkey).some((e3) => n2.hotkey.equal(e3, "auto KeyS"));
              e2.shortcut.actions.captureView = {
                hotkey: t3 ? null : "auto KeyS",
                global: true
              };
            }
          },
          239: {
            patchState: (e2) => {
              e2.billing.powerMessages = Math.min(e2.billing.powerMessages, 40);
            },
            after: async () => {
              a2.powerMessageController?._saveToCookies && await a2.powerMessageController._saveToCookies(
                o2.billing.powerMessages
              );
            }
          },
          238: {
            patchState: (e2) => {
              for (const t3 of e2.ai.connections)
                t3.type === "cloudgpt" && (t3.selectedModelId === "harpa-v1-fast" ? t3.selectedModelId = "harpa-v2-fast" : t3.selectedModelId === "cloudgpt-3.5" && (t3.selectedModelId = "cloudgpt-4o-mini"));
            }
          },
          237: {
            patchState: (e2) => {
              e2.global.tone && (e2.global.tone = "I write in a short and concise way. My speech is clear, professional, and to the point.");
            }
          },
          236: {
            patchState: (e2) => {
              const t3 = n2.hotkey.fromEvent({
                code: `Key${e2.shortcut.key}`,
                altKey: e2.shortcut.altKey,
                ctrlKey: e2.shortcut.ctrlKey,
                metaKey: e2.shortcut.metaKey
              });
              Object.values(e2.shortcut.actions).some(
                (e3) => n2.hotkey.equal(e3.hotkey, t3)
              ) || (e2.shortcut.actions.toggleFrame.hotkey = t3), delete e2.shortcut.key, delete e2.shortcut.code, delete e2.shortcut.label, delete e2.shortcut.ctrlKey, delete e2.shortcut.altKey, delete e2.shortcut.metaKey;
            }
          },
          235: {
            patchState: (e2) => {
              e2.shortcut.actions = {
                toggleFrame: { hotkey: "auto KeyA", global: true },
                captureArea: { hotkey: "auto KeyV", global: true },
                clearChat: { hotkey: "auto KeyL" },
                grabText: { hotkey: "auto KeyG" },
                toggleExplorer: { hotkey: "auto KeyX" },
                toggleConnections: { hotkey: "auto KeyC" }
              };
            }
          },
          234: {
            patchState: (e2) => {
              e2.commands.suggestions.show = "always";
            }
          },
          233: {
            patchState: (e2) => {
              Object.keys(e2.tabs).forEach((t3) => {
                const n3 = e2.tabs[t3];
                n3.screen === "billing" && (n3.screen = "chat"), n3.subscreen === "billing" && (n3.subscreen = null);
              });
            }
          },
          232: {
            patchChat: (e2) => {
              ["#intro", "#clear"].includes(e2.messages[0]?.text) && e2.messages.shift();
            }
          },
          231: {
            patchState: (e2) => {
              e2.ai.connections.filter((e3) => e3.type === "cloudgpt").forEach((e3) => e3.detail = "high");
            }
          },
          230: {
            patchState: (e2) => {
              e2.shortcut.qab.actions.push("yt-seek");
            }
          },
          229: {
            patchChat: (e2) => {
              e2.attachments = [];
            }
          },
          228: {
            patchState: (e2) => {
              e2.shortcut.qap.enabledInput = true;
            }
          },
          227: {
            patchState: (e2) => {
              e2.shortcut.qab.actions = [
                "yt-summary",
                "yt-seek",
                "gmail-summary",
                "gmail-write",
                "gmail-autolabel",
                "google-search"
              ];
            }
          },
          226: {
            patchState: (e2) => {
              e2.settings.csp.domains.push("mail.google.com");
            }
          },
          225: {
            patchState: (e2) => {
              e2.shortcut.qap.enabledHotkeys = true;
            }
          }
        };
        const i2 = (e2, t3, n3) => {
          for (const a4 of e2.ai.connections)
            a4.selectedModelId === t3 && (a4.selectedModelId = n3);
          const a3 = e2.billing.account?.spaces || [];
          for (const e3 of a3) {
            const a4 = e3.connections || [];
            for (const o3 of a4)
              o3.selectedModelId === t3 && (o3.selectedModelId = n3, e3.hasUnsavedChanges = true);
          }
        };
      })(), (() => {
        const { $store: t2, $ai: n2, $feature: a2, $utils: o2, $s: i2 } = e;
        t2.adapter["ai.connections.*"] = {
          get label() {
            return this.customTitle ? this.customTitle : this.title ? this.title : this.type === "cloudgpt" ? this.selectedModel.name : this.type === "gemini-session" ? "GEMINI" : this.type === "claude-session" ? "CLAUDE AI" : this.type === "openai-license" ? `API KEY ${(this.apiKey || "").slice(-4)}` : this.type;
          },
          get icon() {
            return this.type === "cloudgpt" ? i2.ai.cloudgptModels.find((e2) => e2.id === this.selectedModelId)?.icon || "cloudgpt-harpa" : this.type;
          },
          get status() {
            return (a2.config.connectionStatus || {})[this.id];
          },
          get labelUpper() {
            return this.label.toUpperCase();
          },
          get canBeCloned() {
            return this.type === "openai-license" || this.type === "cloudgpt";
          },
          get canBeDeleted() {
            return !!this.isApi() || !!this.isCloud() && i2.ai.getCloudConnections().length > 1;
          },
          get canEditTitle() {
            return this.type === "openai-license" || this.type === "cloudgpt";
          },
          get modelMaxTokens() {
            if (this.type === "openai-session")
              return this.maxTokens * i2.ai.openaiSession.maxTokenFactor;
            if (this.type === "openai-license") {
              if (this.maxTokens) return this.maxTokens;
              return (i2.ai.openaiLicenseModels[this.slug] || i2.ai.openaiLicenseDefaultModel).maxTokens;
            }
            return this.type === "claude-session" ? this.maxTokens ? this.maxTokens - 1 : 99998 : this.type === "gemini-session" ? 9999 : this.type === "cloudgpt" ? this.maxTokens ? Math.min(
              this.maxTokens,
              this.selectedModel.limits.maxTokens
            ) : this.selectedModel.limits.maxTokens : void 0;
          },
          get maxRequestTokens() {
            if (this.type === "gemini-session") return this.modelMaxTokens;
            return Math.round(0.7 * this.modelMaxTokens);
          },
          async countTextTokens(e2) {
            return this.type === "gemini-session" ? e2.length : await n2.controller.countTextTokens(e2, this.encoding);
          },
          countAttachmentsTokens(e2 = [], t3 = "high") {
            if (!this.supportsVision) return 0;
            const n3 = e2.filter((e3) => e3.type === "image").map((e3) => ({
              width: e3.image[t3].width,
              height: e3.image[t3].height,
              detail: t3
            }));
            if (this.type === "cloudgpt") {
              const e3 = this.selectedModel.provider;
              if (e3 === "openai" || e3 === "harpaai")
                return o2.countVisionTokens("openai", n3);
              if (e3 === "anthropic") return o2.countVisionTokens("anthropic", n3);
              if (e3 === "google") return o2.countVisionTokens("google", n3);
              throw new Error(`unsupported provider: "${e3}"`);
            }
            if (this.type === "openai-license")
              return o2.countVisionTokens("openai", n3);
            throw new Error(`unsupported connection type: "${this.type}"`);
          },
          get encoding() {
            return (a2.config.encodings || {})[this.id];
          },
          get selectedModel() {
            if (this.type !== "cloudgpt") return;
            const e2 = i2.ai.cloudgptModels;
            return e2.find((e3) => e3.id === this.selectedModelId) || e2[0];
          },
          get modelName() {
            if (this.type === "cloudgpt") return this.selectedModel.name;
            if (this.type === "openai-session") {
              const e2 = this.selectedOption;
              return e2 ? `${this.labelUpper} (${e2.name})` : this.labelUpper || "";
            }
            if (this.type === "claude-session") {
              const e2 = this.selectedOption;
              return e2.id === "auto" ? "CLAUDE AUTO" : (e2.name || "").toUpperCase();
            }
            return this.type === "gemini-session" ? "GEMINI" : this.type === "openai-license" ? `${this.labelUpper} (${this.slug})` : void 0;
          },
          get supportsVision() {
            return this.type === "cloudgpt" ? !!this.selectedModel?.features?.includes("vision") : this.type === "openai-session" ? this.slug === "gpt-4o" : this.type === "openai-license";
          },
          isCloud() {
            return this.type === "cloudgpt";
          },
          isWeb() {
            return this.type !== "cloudgpt" && this.type !== "openai-license";
          },
          isApi() {
            return this.type === "openai-license";
          },
          hasThinkOption() {
            return this.selectedModelId === "harpa-v1" || this.selectedModelId === "cloudgpt-claude-sonnet-3-7" || this.selectedModelId === "cloudgpt-sonar" || this.selectedModelId === "cloudgpt-sonar-pro";
          },
          isReasoning() {
            return this.selectedModel?.features?.includes("reason");
          }
        };
      })(), (() => {
        const { $store: t2 } = e;
        t2.adapter["ai.connections"] = {
          get(e2) {
            return e2 || (e2 = this[0].id), this.find((t3) => t3.id === e2);
          },
          get hasCustomApi() {
            return this.some((e2) => e2.type === "openai-license" && e2.apiKey);
          }
        };
      })(), (() => {
        const { $store: t2, $s: n2, $feature: a2, $env: o2, $utils: i2 } = e;
        t2.adapter.ai = {
          applyOpenaiSessionModels(e2 = []) {
            e2.length !== 0 && n2.transaction(() => {
              let t3 = this.connections.filter(
                (e3) => e3.type === "openai-session"
              );
              for (const n3 of e2) {
                const e3 = t3.find((e4) => e4.slug === n3.slug);
                e3 ? (e3.title = n3.title, e3.maxTokens = n3.maxTokens, e3.description = n3.description, e3.unsupported = n3.unsupported, e3.options = n3.options, e3.selectedOption = n3.selectedOption) : t3.push({
                  id: `openai-session:${n3.slug}`,
                  type: "openai-session",
                  slug: n3.slug,
                  title: n3.title,
                  maxTokens: n3.maxTokens,
                  description: n3.description,
                  unsupported: n3.unsupported,
                  options: n3.options,
                  selectedOption: n3.selectedOption,
                  flag: null
                });
              }
              t3 = t3.filter((t4) => e2.some((e3) => e3.slug === t4.slug)), this.setConnections([
                ...t3,
                ...this.connections.filter(
                  (e3) => e3.type !== "openai-session"
                )
              ]);
            });
          },
          get openaiLicenseModels() {
            return a2.config.openai.models;
          },
          get openaiLicenseDefaultModel() {
            return {
              slug: "gpt-4o",
              description: "Capable GPT-4o model and optimized for chat.",
              maxTokens: 4096
            };
          },
          get cloudgptModels() {
            const e2 = n2.feature.cloudgpt.v3models || [], t3 = i2.versionNumber(o2.version);
            return e2.filter(
              (e3) => (!e3.minVersion || i2.versionNumber(e3.minVersion) <= t3) && (!e3.maxVersion || i2.versionNumber(e3.maxVersion) >= t3)
            );
          },
          setConnections(e2) {
            n2.transaction(() => {
              this.connections = e2;
              const t3 = new Set(this.connections.map((e3) => e3.id)), a3 = n2.settings.spaceConnectionId;
              for (const e3 of n2.chats)
                t3.has(e3.connectionId) || (e3.connectionId = a3);
            });
          },
          applySpaceConnections(e2) {
            if (!e2) return;
            const t3 = e2.connections || [];
            this.setConnections([
              ...t3.map((e3) => ({ ...e3, showAdvanced: false })),
              ...this.connections.filter((e3) => e3.isWeb())
            ]);
          },
          getCloudConnections() {
            return this.connections.filter((e2) => e2.isCloud());
          }
        };
      })(), (() => {
        const { $store: t2, $env: n2, $utils: a2, $s: o2 } = e;
        t2.adapter.billing = {
          get enabled() {
            return o2.feature.enabled("billing");
          },
          get hasMultiUserSpaces() {
            return this.spaces.some((e2) => e2.members.length > 1);
          },
          get loggedIn() {
            return !!this.account;
          },
          get avatar() {
            const e2 = this.account;
            if (!e2) return null;
            const { avatarId: t3, id: a3 } = e2;
            if (-1 === t3) return `${n2.apiUrl}/auth/avatar/${a3}.webp`;
            {
              const e3 = t3.toString().padStart(2, "0");
              return `${n2.webUrl}/img/avatars/${e3}.webp`;
            }
          },
          get fullName() {
            const e2 = this.account;
            if (!e2) return "Not logged in";
            const { firstName: t3, lastName: n3 } = e2;
            return t3.trim().length === 0 && n3.trim().length === 0 ? e2.displayEmail || e2.email || "Anonymous HARPER" : `${t3} ${n3}`;
          },
          get space() {
            const e2 = this.account;
            if (!e2) return null;
            const t3 = this.spaceId, n3 = e2.spaces;
            return t3 ? n3.find((e3) => e3.id === t3) || n3.at(0) || null : n3.at(0) || null;
          },
          get spaces() {
            const e2 = this.account;
            return e2 ? e2.spaces : [];
          },
          spaceById(e2) {
            return this.spaces.find((t3) => t3.id === e2) || null;
          },
          spaceNameOf(e2, { noPlan: t3 = false } = {}) {
            if (!(e2 = e2 || this.space)) return null;
            let n3 = e2.name;
            if (n3 || (n3 = e2.members.length <= 1 ? "personal" : "shared"), n3 = n3.toUpperCase(), t3)
              return n3;
            if (this.hasSPlan(e2)) {
              return `${n3} ${e2.products.s.plan.toUpperCase()}`;
            }
            return this.hasXPlan(e2) ? `${n3} X` : `${n3} DEMO`;
          },
          membersOf(e2) {
            return (e2 = e2 || this.space) ? e2.members : [];
          },
          get spaceNamesMap() {
            return this.account ? new Map(
              (this.account.spaces || []).map((e2) => [
                e2.id,
                o2.billing.spaceNameOf(e2)
              ])
            ) : /* @__PURE__ */ new Map();
          },
          isPersonalSpace(e2 = this.space) {
            return !!e2 && e2.members.length === 1;
          },
          get upgradePlanName() {
            return "HARPA S";
          },
          get powerMessages() {
            return o2.billing.account?.stats?.pm || 0;
          },
          set powerMessages(e2) {
            this.loggedIn && (o2.billing.account.stats.pm = e2);
          },
          hasXPlan(e2) {
            return !!(e2 = e2 || this.space) && this.isPersonalSpace(e2) && true === this.account?.products?.x?.status;
          },
          hasSPlan(e2) {
            return !!(e2 = e2 || this.space) && true === e2.products?.s?.status;
          },
          sPlan(e2) {
            return this.hasSPlan(e2) ? (e2 = e2 || this.space).products.s.plan : null;
          },
          hasPro(e2 = null) {
            return !!(e2 = e2 || this.space) && (this.hasXPlan(e2) || this.hasSPlan(e2));
          },
          plan(e2) {
            return this.sPlan(e2) || (o2.billing.hasXPlan(e2) ? "x" : null);
          },
          hasCloudGptPlan(e2) {
            return !!(e2 = e2 || this.space) && true === e2.products?.cloudgpt?.status;
          },
          purchasedPlans(e2) {
            const t3 = [];
            return (e2 = e2 || this.space) ? (this.isPersonalSpace(e2) && this.hasXPlan(e2) && t3.push("x"), this.hasSPlan(e2) && t3.push(e2.products.s.plan), this.hasCloudGptPlan(e2) && t3.push(e2.products.cloudgpt.plan), t3) : t3;
          },
          get powerMessagePercentage() {
            if (!o2.feature.enabled("billing.pm")) return 100;
            if (this.hasXPlan() || this.hasSPlan()) return 100;
            if (!this.loggedIn) return 0;
            const e2 = o2.feature["billing.pm"].max;
            return e2 ? a2.number.minmax(
              Math.round(100 * (e2 - this.powerMessages) / e2),
              0,
              100
            ) : 100;
          },
          onPowerMessage(e2) {
            if (!o2.feature.enabled("billing.pm")) return true;
            if (this.hasXPlan() || this.hasSPlan()) return true;
            if (!this.loggedIn) return false;
            const t3 = o2.feature["billing.pm"].max;
            if (!t3) return true;
            return e2.connection?.type === "cloudgpt" ? (this.powerMessages = Math.min(this.powerMessages + 1, t3), true) : this.powerMessages >= t3 ? (this.showUpsell({ reason: "pm-limit" }), false) : (this.powerMessages = this.powerMessages + 1, true);
          },
          onStandardMessage(e2) {
            if (!o2.feature.enabled("billing.sm")) return true;
            if (this.hasXPlan() || this.hasSPlan()) return true;
            const t3 = o2.feature["billing.sm"].max;
            if (!t3) return true;
            return e2.connection?.type === "cloudgpt" || (this.standardMessages >= t3 ? (this.showUpsell({ reason: "sm-limit" }), false) : (this.standardMessages = this.standardMessages + 1, true));
          },
          onCommandRun: (e2, t3) => t3.meta.name === "clear" || t3.meta.name === "youtube-summary" || o2.billing.onPowerMessage(e2),
          createCommandsDisclaimer(e2 = {}) {
            if (!o2.feature.enabled("billing.commands")) return null;
            if (this.hasPro()) return null;
            if (e2.proto) return "commands:predefined-editing";
            const t3 = e2.extra || 0;
            return o2.commands.list.filter((e3) => !e3.fresh).length + t3 > o2.feature["billing.commands"].max ? "commands:max-reached" : this.loggedIn ? null : "commands:need-login";
          },
          get canEditPredefinedCommand() {
            return !o2.feature.enabled("billing.commands") || this.hasPro();
          },
          pricingUrl: (e2 = null) => a2.url.create(`${n2.webUrl}/pricing`, { spaceId: e2 }),
          hasUpToDatePricing() {
            if (!this.plans) return false;
            return !(a2.time.since(this.pricingLastUpdatedAt) > 12 * a2.time.HOUR) && Object.values(this.plans).some((e2) => e2.pricing);
          },
          showUpsell({ type: e2 = null, reason: t3 = null } = {}) {
            e2 ??= this.hasPro() ? "topup" : "upgrade", this.upsell.show = true, this.upsell.type = e2, this.upsell.reason = t3, this.upsell.planId = "s1";
          },
          get ownsCurrentSpace() {
            return !!this.space && !!this.account && this.space.ownerId === this.account.id;
          },
          getSpace(e2) {
            return this.account?.spaces?.find((t3) => t3.id === e2) ?? null;
          },
          switchToSpace(e2) {
            e2 && this.spaceId !== e2 && o2.transaction(() => {
              this.spaceId = e2, o2.ai.applySpaceConnections(this.space);
            });
          }
        };
      })(), (() => {
        const { $store: t2, $utils: n2, $s: a2 } = e;
        t2.adapter["chats.*.explorer"] = {
          get categories() {
            let e2 = /* @__PURE__ */ new Set();
            return a2.commands.commands.filter((e3) => !e3.fresh).forEach((t3) => {
              t3.archived ? e2.add("Archived") : (e2.add(t3.category), t3.favorite && e2.add("Favorite"));
            }), e2 = Array.from(e2).sort(
              (e3, t3) => e3 === "Favorite" ? -1 : t3 === "Favorite" ? 1 : e3 === "User" ? -1 : t3 === "User" || e3 === "Archived" ? 1 : t3 === "Archived" ? -1 : 0
            ), ["All", ...e2];
          },
          get categoryCommands() {
            return this._getCommands(this.category);
          },
          get filteredCategoryCommands() {
            return this._getFilteredCommands(this.category);
          },
          get filteredOtherCommands() {
            if (this._query.length === 0) return [];
            if (this.filteredCategoryCommands.length > 3) return [];
            const e2 = new Set(this.filteredCategoryCommands.map((e3) => e3.name));
            return this._getFilteredCommands("All").filter((t3) => !e2.has(t3.name));
          },
          get filteredAllCommands() {
            return [
              ...this.filteredCategoryCommands,
              ...this.filteredOtherCommands
            ];
          },
          get _query() {
            return (a2.chat.input || "").toLowerCase().replace(/\//g, "").replace(/-/g, " ").replace(/_/g, " ");
          },
          _getCommands: (e2) => a2.commands.commands.filter(
            (t3) => !t3.fresh && (e2 === "All" || (e2 === "Favorite" ? t3.favorite : e2 === "Archived" ? t3.archived : !t3.archived && t3.category === e2))
          ),
          _getFilteredCommands(e2) {
            const t3 = this._query;
            let a3 = this._getCommands(e2);
            if (e2 !== "Archived" && (a3 = a3.filter((e3) => !e3.archived)), n2.string.empty(t3))
              return a3;
            a3 = a3.filter((e3) => n2.string.abbreviationCheck(t3, e3.search));
            const o2 = [], i2 = [];
            return a3.forEach(
              (e3) => e3.title.toLowerCase().replace(/\//g, "").replace(/-/g, " ").replace(/_/g, " ").startsWith(t3) ? o2.push(e3) : i2.push(e3)
            ), a3 = [...o2, ...i2], a3;
          }
        };
      })(), (() => {
        const {
          createVNode: t2,
          createFragment: n2,
          createTextVNode: a2
        } = e.$inferno, {
          $store: o2,
          $utils: i2,
          $chat: r2,
          $tabs: s2,
          $env: l2,
          $dialog: c2,
          $bus: u2,
          $s: p2
        } = e;
        o2.adapter["chats.*"] = {
          get displayEmoji() {
            return this.pinned ? "\u{1F4CC}" : this.emoji || "\u{1F9EC}";
          },
          get fullTitle() {
            return i2.string.shorten(`${this.displayEmoji}\xA0\xA0${this.title}`);
          },
          get tabs() {
            return Object.values(p2.tabs).filter((e2) => e2.chatId === this.id);
          },
          get screen() {
            return this.explorer.show ? "explorer" : this.connectionShow ? "connections" : p2.redactor.show && p2.redactor.taskId === this.taskId ? "redactor" : "chat";
          },
          get task() {
            return p2.tasks.get(this.taskId);
          },
          get inputFlags() {
            return r2.flagsController.parse(this.input).flags;
          },
          get modePageButtonOn() {
            return !this.hasCommand && (!!this.mode.page.enabled || this.inputFlags.includes(this.modePageFlag));
          },
          get modePageFlag() {
            return p2.ai.mode.page.flag;
          },
          get modeThinkButtonOn() {
            return !!this.connection.hasThinkOption() && (!!this.mode.think.enabled || this.inputFlags.includes(this.modeThinkFlag));
          },
          get modeThinkFlag() {
            return p2.ai.mode.think.flag;
          },
          get modeWebButtonOn() {
            const e2 = this.mode.web.enabled;
            return this.modeWebFlag && this.inputFlags.includes(this.modeWebFlag) ? !e2 : e2;
          },
          get modeWebFlag() {
            return p2.ai.mode.web.flag;
          },
          get modeFileOn() {
            const e2 = this.mode.file.enabled;
            return this.modeFileFlag && this.inputFlags.includes(this.modeFileFlag) ? !e2 : e2;
          },
          get modeFileFlag() {
            return p2.ai.mode.file.flag;
          },
          get commandEdit() {
            const e2 = this.explorer.editCommandName;
            return e2 ? p2.commands.commandEdits[e2] : null;
          },
          get inIsolatedCommand() {
            return !!this.command && false !== this.command.isolated && (true === this.command.isolated || p2.settings.isolateCommands);
          },
          updateCommandEdit(e2) {
            p2.transaction(() => {
              const t3 = this.commandEdit;
              e2(t3);
            });
          },
          get copyableAnswer() {
            return this.messages.findLast((e2) => e2.type === "answer" && e2.done);
          },
          get visibleMessages() {
            return this.messages.filter(
              (e2) => !e2.silent && (e2.type === "question" || e2.type === "answer" || e2.type === "ask" && e2.paramType === "choice")
            );
          },
          get silent() {
            const e2 = this.command;
            if (!e2) return false;
            let t3 = this.stepCursor;
            for (; t3; ) {
              const n3 = i2.get(e2, t3);
              if (!n3) return false;
              if (n3.silent) return true;
              const a3 = t3.split(".");
              if (a3.length < 3) return false;
              a3.pop(), a3.pop(), t3 = a3.join(".");
            }
            return false;
          },
          get lastQuestion() {
            return this.messages.findLast((e2) => e2.type === "question");
          },
          addQuestion(e2) {
            this.ts = Date.now(), this.messages.push({
              id: i2.id.nano(),
              type: "question",
              silent: this.silent,
              ...e2
            });
          },
          updateLastQuestion(e2 = {}) {
            p2.transaction(() => {
              const t3 = this.messages.findLast((e3) => e3.type === "question");
              t3 && Object.assign(t3, e2);
            });
          },
          get lastCommandMessageIndex() {
            return this.messages.findLastIndex((e2) => e2.commandName);
          },
          get lastAnswer() {
            return this.messages.findLast((e2) => e2.type === "answer");
          },
          addAnswer(e2) {
            this.ts = Date.now(), this.messages.push({
              id: i2.id.nano(),
              type: "answer",
              silent: this.silent,
              ...e2
            });
          },
          updateAnswer(e2, t3 = {}) {
            p2.transaction(() => {
              const n3 = this.messages.findLast((t4) => t4.answerId === e2);
              n3 && Object.assign(n3, t3);
            });
          },
          updateLastAnswer(e2) {
            p2.transaction(() => {
              const t3 = this.messages.findLast((e3) => e3.type === "answer");
              t3 && Object.assign(t3, e2);
            });
          },
          removeLastAnswer() {
            const e2 = this.messages.findLast((e3) => e3.type === "answer");
            e2 && i2.array.remove(this.messages, e2);
          },
          updateMessage(e2, t3 = {}) {
            p2.transaction(() => {
              const n3 = this.messages.find((t4) => t4.id === e2);
              n3 && Object.assign(n3, t3);
            });
          },
          removeMessages(e2) {
            p2.transaction(() => {
              this.messages = this.messages.filter((t3) => !e2(t3));
            });
          },
          get ask() {
            const e2 = this.messages.at(-1);
            return e2?.type === "ask" ? e2 : null;
          },
          addAsk(e2) {
            this.messages.push({
              id: i2.id.nano(),
              type: "ask",
              silent: this.silent,
              ...e2
            });
          },
          modifyAsk(e2) {
            p2.transaction(() => {
              const t3 = this.messages.at(-1);
              t3 && t3.type === "ask" && e2(t3);
            });
          },
          actualizeAsk() {
            this.modifyAsk((e2) => {
              if (e2.value = this.input, e2.paramType !== "choice" || (e2.options || []).length === 0)
                return;
              const t3 = e2.options.find((e3) => e3.value === "$custom");
              if (t3 && this.hasAttachments)
                return e2.options.forEach((e3) => e3.selected = false), t3.input = this.input, void (t3.selected = true);
              const n3 = this.input.trim().toLowerCase();
              n3.length !== 0 ? (e2.options.forEach((e3) => {
                e3.selected = e3.value !== "$custom" && String(e3.label || e3.value || "").toLowerCase().includes(n3);
              }), t3 && (t3.input = this.input, t3.selected = !e2.options.some((e3) => e3.selected)), t3 || e2.options.some((e3) => e3.selected) || (e2.options[0].selected = true)) : e2.options.forEach((e3, t4) => e3.selected = t4 === 0);
            });
          },
          getParam(e2) {
            if (!e2) return;
            if (e2 === "global" || e2 === "g") return p2.global;
            if (e2.startsWith("global.") || e2.startsWith("g."))
              return e2 = e2 === "global." ? e2.substring(7) : e2.substring(2), i2.get(p2.global, e2);
            if (e2 === "chat" || e2 === "c") return this.params;
            if (e2.startsWith("chat.") || e2.startsWith("c."))
              return e2 = e2 === "chat." ? e2.substring(5) : e2.substring(2), i2.get(this.params, e2);
            let t3 = i2.get(this.command, `params.${e2}`);
            return void 0 !== t3 ? t3 : (t3 = i2.get(this.params, e2), void 0 !== t3 ? t3 : i2.get(p2.global, e2));
          },
          setParam(e2, t3) {
            if (e2)
              return e2 === "global" || e2 === "g" ? (i2.is.object(t3) || (t3 = {}), void (p2.global = t3)) : e2.startsWith("global.") || e2.startsWith("g.") ? (e2 = e2 === "global." ? e2.substring(7) : e2.substring(2), void (void 0 === t3 ? i2.delete(p2.global, e2) : i2.set(p2.global, e2, t3, { create: true }))) : e2 === "chat" || e2 === "c" ? (i2.is.object(t3) || (t3 = {}), void (this.params = t3)) : e2.startsWith("chat.") || e2.startsWith("c.") ? (e2 = e2 === "chat." ? e2.substring(5) : e2.substring(2), void (void 0 === t3 ? i2.delete(this.params, e2) : i2.set(this.params, e2, t3, { create: true }))) : void (this.command?.params && (void 0 === t3 ? i2.delete(this.command.params, e2) : i2.set(this.command.params, e2, t3, { create: true })));
          },
          get stepCursor() {
            return this.command ? this.command.cursor : null;
          },
          setStepCursor(e2) {
            this.command && (this.command.cursor = e2);
          },
          stepCursorNext() {
            const e2 = this.stepCursor;
            if (!e2) return;
            const t3 = e2.split(".");
            t3[t3.length - 1] = (Number(t3.at(-1)) || 0) + 1, this.setStepCursor(t3.join("."));
          },
          stepCursorUp() {
            const e2 = this.stepCursor;
            if (!e2) return;
            const t3 = e2.split(".");
            t3.pop(), t3.pop(), t3.length === 0 ? this.setStepCursor("") : this.setStepCursor(t3.join("."));
          },
          flattenSteps() {
            const e2 = [], t3 = (n3, a3) => {
              e2.push({ cursor: a3, label: n3.label }), i2.is.array(n3.steps) && n3.steps.forEach(
                (e3, n4) => t3(e3, a3 ? a3 + ".steps." + n4 : "steps." + n4)
              );
            };
            return t3(this.command, ""), e2;
          },
          get empty() {
            return this.messages.length === 0 || this.messages.length === 1 && this.messages[0].system;
          },
          get messagesAfterReset() {
            const e2 = this.messages.findLastIndex(
              (e3) => e3.system && e3.text === "#reset"
            );
            return -1 === e2 ? this.messages : this.messages.slice(e2 + 1);
          },
          get connection() {
            const e2 = this.inputFlags, t3 = e2.length > 0 && p2.ai.connections.find((t4) => e2.includes(t4.flag));
            return t3 || p2.ai.connections.get(this.connectionId);
          },
          get hasCommand() {
            const e2 = this.command;
            return !(!e2 || e2.meta?.name === "clear");
          },
          get maxAttachments() {
            return p2.feature.attachments.max;
          },
          get visibleAttachments() {
            return this.attachments.filter(
              (e2) => e2.type === "pdf" || e2.type === "image" && this.connection.supportsVision
            );
          },
          get hasAttachments() {
            return this.visibleAttachments.length > 0;
          },
          get imageAttachments() {
            return this.visibleAttachments.filter((e2) => e2.type === "image");
          },
          get pdfAttachments() {
            return this.visibleAttachments.filter((e2) => e2.type === "pdf");
          },
          get canAddAttachments() {
            return this.visibleAttachments.length < this.maxAttachments;
          },
          allAttachmentsReady() {
            return this.visibleAttachments.every((e2) => e2.ready);
          },
          get url() {
            return s2.proxy.currentTab.url;
          },
          get urlData() {
            return i2.url.parse(this.url);
          },
          get emailParameterEnabled() {
            return !l2.is.fg && r2.testUrl.isEmailService(this.url);
          },
          get threadParameterEnabled() {
            return !l2.is.fg && r2.testUrl.isThreadService(this.url);
          },
          get transcriptParameterEnabled() {
            const e2 = this.urlData;
            return e2?.domain?.endsWith("youtube.com") && e2.path.startsWith("/watch");
          },
          get pdfItems() {
            return [
              {
                label: "Quick Summary",
                emoji: "\u26A1",
                command: "pdf-summary",
                inputs: [{ silent: true, value: "" }, "QUICK SUMMARY"]
              },
              {
                label: "Full Summary",
                emoji: "\u{1F50D}",
                command: "pdf-summary",
                inputs: [{ silent: true, value: "" }, "FULL SUMMARY"]
              },
              {
                label: "Repurpose Text",
                emoji: "\u267B\uFE0F",
                command: "pdf-summary",
                inputs: [{ silent: true, value: "" }, "REPURPOSE TEXT"]
              }
            ];
          },
          get visionItems() {
            return [
              {
                label: "Find and fix mistakes",
                emoji: "\u{1F575}\uFE0F\u200D\u2642\uFE0F",
                command: "vision",
                inputs: ["", "FIND AND FIX MISTAKES"]
              },
              {
                label: "Solve test",
                emoji: "\u{1F9E9}",
                command: "vision",
                inputs: ["", "SOLVE TEST"]
              },
              {
                label: "Reply",
                emoji: "\u{1F4E9}",
                command: "vision",
                inputs: ["", "REPLY"]
              },
              {
                label: "Explain and simplify",
                emoji: "\u269B\uFE0F",
                command: "vision",
                inputs: ["", "EXPLAIN AND SIMPLIFY"]
              },
              {
                label: "Rewrite and fix tone",
                emoji: "\u{1F4DD}",
                command: "vision",
                inputs: ["", "REWRITE AND FIX TONE"]
              },
              {
                label: "Autocomplete writing",
                emoji: "\u{1F3C1}",
                command: "vision",
                inputs: ["", "AUTOCOMPLETE WRITING"]
              },
              {
                label: "Translate",
                emoji: "\u{1F30E}",
                command: "vision",
                inputs: ["", "TRANSLATE"]
              },
              {
                label: "Extract text",
                emoji: "\u{1F50D}",
                command: "vision",
                inputs: ["", "EXTRACT TEXT"]
              },
              {
                label: "Repurpose",
                emoji: "\u267B\uFE0F",
                command: "vision",
                inputs: ["", "TO BLOG, ARTICLE, MJ PROMPT"]
              }
            ];
          },
          get parameterItems() {
            let e2 = [
              {
                parameter: "page",
                label: "Page content",
                tooltip: [
                  "Send content of the opened web page to AI. Truncated if above the GPT model limit. Supports options:",
                  t2(
                    1,
                    "ul",
                    null,
                    [
                      t2(
                        1,
                        "li",
                        null,
                        [
                          t2(1, "b", null, "{{page url type=render|fetch}}", 0),
                          a2(
                            " will retrieve URL content. Default type is render, which is slower but more accurate."
                          )
                        ],
                        4
                      ),
                      t2(
                        1,
                        "li",
                        null,
                        [
                          t2(1, "b", null, "{{page query}}", 0),
                          a2(
                            " will perform semantic search on the page content and return text relevant to the query."
                          )
                        ],
                        4
                      ),
                      t2(
                        1,
                        "li",
                        null,
                        [
                          t2(1, "b", null, "{{page limit=500}}", 0),
                          a2(" will set a custom limit in tokens and "),
                          t2(1, "b", null, "{{page limit=10%}}", 0),
                          a2(" a limit in percentage of the model size.")
                        ],
                        4
                      )
                    ],
                    4
                  )
                ]
              },
              {
                parameter: "url",
                label: "Page URL",
                tooltip: "Include page URL in your question."
              },
              {
                parameter: "selection",
                label: "Page selection",
                tooltip: "The text currently selected on page, if any.",
                noPrefix: true
              },
              {
                parameter: "language",
                label: "Language",
                tooltip: n2(
                  [
                    a2("Prompt language taken from the app settings, currently:"),
                    a2(" "),
                    t2(1, "b", null, p2.settings.promptLanguageValue, 0)
                  ],
                  0
                )
              },
              {
                parameter: "message",
                label: "Last message",
                tooltip: [
                  "The last chat message.",
                  n2(
                    [
                      a2("Use "),
                      t2(1, "b", null, "{{message 0}}", 0),
                      a2(", "),
                      t2(1, "b", null, "{{message 1}}", 0),
                      a2(","),
                      a2(" "),
                      t2(1, "b", null, "{{message -2}}", 0),
                      a2(
                        " etc. to reference first, second and second to last messages."
                      )
                    ],
                    0
                  )
                ]
              },
              {
                parameter: "gpt",
                label: "Last GPT answer",
                tooltip: "The last reply, generated by GPT model. Useful for prompt chaining."
              },
              {
                parameter: "serp HARPA",
                label: "Web search results",
                search: "serp web search results",
                tooltip: [
                  "Result of a web search for a given query.",
                  n2(
                    [
                      a2("Pass query as an argument, for example"),
                      a2(" "),
                      t2(
                        1,
                        "b",
                        null,
                        "{{serp Zurich to Milan next train today}}",
                        0
                      ),
                      a2(".")
                    ],
                    0
                  )
                ]
              },
              {
                parameter: "grab title",
                insertion: "Element",
                label: "Grab element",
                tooltip: [
                  "Grab element by selector on page and take its' content. Supports CSS, XPath and Text Content selectors:",
                  t2(
                    1,
                    "ul",
                    null,
                    [
                      t2(
                        1,
                        "li",
                        null,
                        [
                          t2(1, "b", null, "{{grab span.label}}", 0),
                          a2(" grabs by CSS selector.")
                        ],
                        4
                      ),
                      t2(
                        1,
                        "li",
                        null,
                        [
                          t2(1, "b", null, "{{grab //h1}}", 0),
                          a2(" grabs by XPath selector.")
                        ],
                        4
                      ),
                      t2(
                        1,
                        "li",
                        null,
                        [
                          t2(1, "b", null, "{{grab Login}}", 0),
                          a2(" grabs by text content.")
                        ],
                        4
                      )
                    ],
                    4
                  ),
                  n2(
                    [
                      a2("Pass "),
                      t2(1, "b", null, "take=innerText", 16),
                      a2(
                        " argument to specify what to grab. Supports id, class, nodeName, attributes, styles, textContent, innerHTML, outerHTML, value, href, [attribute] (style)."
                      )
                    ],
                    4
                  ),
                  n2(
                    [
                      a2("Pass "),
                      t2(1, "b", null, "at=first", 16),
                      a2(
                        " argument to specify which element to grab. Supports first, last, all, 0, 1... and -1, -2... from the end."
                      )
                    ],
                    4
                  ),
                  n2(
                    [
                      a2("Pass "),
                      t2(1, "b", null, "by=auto", 16),
                      a2(
                        " argument to specify how to find elements. Supports auto, css, xpath, text."
                      )
                    ],
                    4
                  )
                ]
              },
              {
                parameter: "thread",
                label: "Thread",
                tooltip: [
                  n2(
                    [
                      a2(
                        "Parses messages and comments from an opened post, topic or thread. Supports WhatsApp, Telegram, Discord, Reddit, Facebook, YouTube, X and options:"
                      )
                    ],
                    4
                  ),
                  t2(
                    1,
                    "ul",
                    null,
                    t2(
                      1,
                      "li",
                      null,
                      [
                        t2(1, "b", null, "{{grab limit=100}}", 0),
                        a2(" will limit the number of recent scanned messages.")
                      ],
                      4
                    ),
                    2
                  )
                ],
                disabled: !this.threadParameterEnabled
              },
              {
                parameter: "email",
                label: "Email",
                tooltip: "Opened email subject, author, content, time and history. Available for GMail, ProtonMail, Outlook, FastMail.",
                disabled: !this.emailParameterEnabled
              },
              {
                parameter: "transcript",
                label: "YouTube transcript",
                tooltip: "Transcript of the opened YouTube video.' +\n            ' Available for YouTube video pages.",
                disabled: !this.transcriptParameterEnabled
              },
              {
                parameter: "input",
                label: "Input text",
                tooltip: "Text from the focused or largest input field on page, if any. Useful for handling inputs like search fields, forms, chat boxes.",
                noPrefix: true
              },
              {
                parameter: "connection",
                label: "AI connection",
                tooltip: "Currently selected AI connection."
              },
              {
                parameter: "view",
                label: "Viewport screenshot",
                tooltip: "Include screenshot of the opened page."
              },
              {
                parameter: "desc",
                label: "Page description",
                tooltip: "Include page description in your question."
              },
              {
                parameter: "title",
                label: "Page title",
                tooltip: "Include page title in your question."
              },
              {
                parameter: "domain",
                label: "Page domain",
                tooltip: "Include page domain name in your question."
              },
              {
                parameter: "cost",
                label: "AI token cost",
                tooltip: [
                  "Cost of all the CloudGPT AI requests in tokens for this chat.",
                  n2(
                    [
                      a2("Use "),
                      t2(1, "b", null, "{{cost 0}}", 0),
                      a2(", "),
                      t2(1, "b", null, "{{cost 1}}", 0),
                      a2(","),
                      a2(" "),
                      t2(1, "b", null, "{{cost -2}}", 0),
                      a2(
                        " etc. to get cost of the first, second and second to last CloudGPT message."
                      )
                    ],
                    0
                  )
                ]
              }
            ];
            return this.connection.type === "gemini-session" && (e2 = [
              ...e2,
              {
                parameter: "gemini.gmail",
                type: "gemini-session",
                label: "Gmail"
              },
              {
                parameter: "gemini.gdocs",
                type: "gemini-session",
                label: "Google Docs"
              },
              {
                parameter: "gemini.gdrive",
                type: "gemini-session",
                label: "Google Drive"
              },
              {
                parameter: "gemini.gflights",
                type: "gemini-session",
                label: "Google Flights"
              },
              {
                parameter: "gemini.ghotels",
                type: "gemini-session",
                label: "Google Hotels"
              },
              {
                parameter: "gemini.gmaps",
                type: "gemini-session",
                label: "Google Maps"
              },
              {
                parameter: "gemini.youtube",
                type: "gemini-session",
                label: "YouTube"
              }
            ]), e2;
          },
          insertParameterItem(e2) {
            if (e2)
              if (e2.type !== "gemini-session") {
                e: {
                  let t3 = this.input;
                  const n3 = t3.lastIndexOf("{{");
                  if (-1 === n3) break e;
                  const a3 = t3.slice(n3 + 2);
                  if (/^[^}]*$/.test(a3))
                    return t3 = t3.substring(0, n3) + `{{${e2.parameter}}}`, void c2.Input.setText(t3);
                }
                {
                  const t3 = `${e2.insertion || e2.label} is: {{${e2.parameter}}}

`;
                  c2.Input.setText(t3);
                }
              } else c2.Input.setText(`@${e2.label}`);
          },
          toggleParameterItem(e2) {
            if (e2)
              if (e2.type === "gemini-session") this.toggleText(`@${e2.label}`);
              else {
                const t3 = this.input, n3 = `${e2.insertion || e2.label} is: {{${e2.parameter}}}`, a3 = `{{${e2.parameter}}}`, o3 = [` ${n3}

`, `${n3}

`, ` ${n3}`, n3, ` ${a3}`, a3];
                for (const e3 of o3)
                  if (t3.includes(e3)) return void this.toggleText(e3);
                this.toggleText(e2.noPrefix || t3.length !== 0 ? a3 : `${n3}

`);
              }
          },
          toggleText(e2) {
            const t3 = this.input;
            t3.includes(e2) ? (e2 = t3.replaceAll(`${e2} `, "").replaceAll(e2, ""), c2.Input.setText(e2)) : c2.Input.insertText(e2);
          },
          switchToVisionConnection() {
            if (this.connection.supportsVision) return true;
            let e2 = p2.ai.connections.find(
              (e3) => e3.type === "cloudgpt" && e3.supportsVision
            ) || p2.ai.connections.find((e3) => e3.supportsVision);
            if (!e2 && !p2.billing.ownsCurrentSpace)
              return this.addAnswer({
                text: "\u{1F494} Could not find a connection with Vision support. Ask the space owner to enable Vision."
              }), false;
            e2 || p2.transaction(() => {
              const t4 = o2.template.ai().connections;
              e2 = t4.find((e3) => e3.type === "cloudgpt");
              const n3 = p2.feature.cloudgpt.v3models.find(
                (e3) => e3.features.includes("vision")
              );
              e2.selectedModelId = n3.model, p2.ai.connections.push(e2), p2.billing.space.applyAiConnections(), u2.send("billing.saveSpaceConnections", p2.billing.spaceId);
            });
            const t3 = this.connection.label || "";
            return this.connectionId = e2.id, this.addAnswer({
              text: [
                "\u{1F916}  Switching connection",
                t3 ? `from **${t3}**` : "",
                `to **${this.connection.label.trim()}** for Vision support.`
              ].filter(Boolean).join(" ")
            }), true;
          }
        };
      })(), (() => {
        const { $store: t2, $s: n2 } = e;
        t2.adapter.chats = {
          sorted() {
            return this.toSorted((e2, t3) => t3.ts - e2.ts);
          },
          get(e2) {
            return this.find((t3) => t3.id === e2);
          },
          getByTabId(e2) {
            if (!e2) throw new Error("tabId is required");
            const t3 = n2.tabs[e2];
            return t3 ? t3.chat : null;
          },
          delete(e2) {
            const t3 = this.findIndex((t4) => t4.id === e2);
            -1 !== t3 && this.splice(t3, 1);
          },
          exists(e2) {
            return this.some((t3) => t3.id === e2);
          }
        };
      })(), (() => {
        const {
          $store: t2,
          $utils: n2,
          $commands: a2,
          $mobx: o2,
          $analytics: i2,
          $bus: r2,
          $s: s2
        } = e;
        t2.adapter.commands = {
          get userCommands() {
            return this.list;
          },
          set userCommands(e2) {
            this.list = e2;
          },
          get systemCommands() {
            return a2.systemCommands;
          },
          get commands() {
            const e2 = new Set(this.selectedCommandNames), t3 = new Set(this.favoriteCommandNames), a3 = new Set(this.archivedCommandNames), o3 = s2.billing.spaceNamesMap, i3 = (i4, r3) => {
              const s3 = e2.has(i4.meta.name), l2 = t3.has(i4.meta.name), c2 = a3.has(i4.meta.name), u2 = o3.get(i4.spaceId), p2 = [
                i4.meta.title,
                i4.meta.category,
                i4.meta.subcategory,
                i4.meta.description,
                i4.meta.apps,
                u2,
                s3 && "selected",
                l2 && "favorite"
              ].filter(Boolean).join(" ").toLowerCase().replace(/\//g, "").replace(/-/g, " ").replace(/_/g, " ");
              let d2 = i4.meta.description;
              if (!d2)
                if (i4.steps.length === 0) d2 = "Empty command";
                else if (i4.steps.length === 1 && i4.steps[0].type === "command") {
                  const e3 = i4.steps.findLast((e4) => e4.type === "command");
                  d2 = e3 && [
                    e3.name ? `${e3.name}` : null,
                    ...(e3.inputs || []).map((e4) => e4 || "Ask me")
                  ].join(" \u2022 ");
                } else
                  d2 = i4.steps.filter((e3) => e3.type).map(
                    (e3) => e3.type === "gpt" ? e3.prompt || "GPT" : e3.type.toUpperCase()
                  ).join(" \u2022 ");
              return d2 = n2.string.shorten(
                (d2 || "").replaceAll("\n", " ").replace(/\s+/g, " "),
                160
              ), {
                type: r3,
                name: i4.meta.name,
                title: i4.meta.title,
                apps: i4.meta.apps,
                category: i4.meta.category,
                emoji: l2 && !c2 ? "\u2B50" : i4.meta.emoji,
                desc: d2,
                search: p2,
                selected: s3,
                favorite: l2,
                archived: c2,
                spaceName: u2,
                isPublic: i4.share?.isPublic,
                fresh: !!i4.fresh
              };
            };
            return [
              ...this.userCommands.map((e3) => i3(e3, "user")),
              ...this.systemCommands.map((e3) => i3(e3, "system"))
            ];
          },
          getCommand(e2) {
            return this.commands.find((t3) => t3.name === e2);
          },
          getCommandDeclaration(e2) {
            const t3 = e2.toLowerCase();
            return this.userCommands.find((e3) => e3.meta.title.toLowerCase() === t3) || this.userCommands.find((e3) => e3.meta.name.toLowerCase() === t3) || this.systemCommands.find((e3) => e3.meta.title.toLowerCase() === t3) || this.systemCommands.find((e3) => e3.meta.name.toLowerCase() === t3);
          },
          getStep(e2, t3) {
            if (!e2 || !e2.steps) return null;
            for (const n3 of e2.steps) {
              if (n3.id === t3) return n3;
              const e3 = this.getStep(n3, t3);
              if (e3) return e3;
            }
            return null;
          },
          getStepCursor(e2, t3, n3 = "") {
            if (!e2 || !e2.steps) return null;
            for (let a3 = 0; a3 < e2.steps.length; a3++) {
              const o3 = e2.steps[a3], i3 = n3 ? `${n3}.steps.${a3}` : `steps.${a3}`;
              if (o3.id === t3) return i3;
              const r3 = this.getStepCursor(o3, t3, i3);
              if (r3) return r3;
            }
            return null;
          },
          getStepsLevel(e2, t3) {
            if (!(t3 = t3 || e2.path) || t3.length === 0) return e2.steps;
            let n3 = e2.steps;
            for (const e3 of t3)
              if (n3 = n3.find((t4) => t4.id === e3)?.steps, !n3) return [];
            return n3;
          },
          getStepIds(e2) {
            if (!e2 || !e2.steps) return [];
            const t3 = [];
            for (const n3 of e2.steps)
              t3.push(n3.id), t3.push(...this.getStepIds(n3));
            return t3;
          },
          getStepAskParams(e2) {
            if (!e2 || !e2.steps) return [];
            const t3 = [];
            for (const n3 of e2.steps)
              n3.type === "ask" && n3.param && t3.push(n3.param), n3.steps && t3.push(...this.getStepAskParams(n3));
            return t3;
          },
          modifySteps(e2, t3) {
            if (e2 && e2.steps)
              for (const n3 of e2.steps) t3(n3), this.modifySteps(n3, t3);
          },
          addUserCommand({ prompt: e2 = "", clear: n3 = true } = {}) {
            const a3 = t2.idGenerator.command(), o3 = {
              version: 1,
              meta: { name: a3, title: "", description: "", category: "User" },
              steps: [{ type: "gpt", prompt: e2 }],
              fresh: true
            };
            return n3 && o3.steps.unshift({ type: "clear" }), this.list.unshift(o3), a3;
          },
          cloneCommand(e2) {
            if (!e2) return;
            let a3 = this.getCommandDeclaration(e2);
            if (!a3) return;
            a3 = o2.toJS(a3);
            const i3 = {
              version: n2.cloneDeep(a3.version),
              meta: n2.cloneDeep(a3.meta),
              steps: n2.cloneDeep(a3.steps),
              fresh: true
            };
            i3.meta.name = t2.idGenerator.command(), i3.meta.category = "User", a3.meta.category !== "User" && (i3.meta.proto = e2), a3.meta.category === "User" && (i3.meta.title = n2.string.incrementNumberSuffix(
              a3.meta.title || "Custom automation"
            )), s2.transaction(() => this.list.unshift(i3)), s2.commands.editUserCommand(i3.meta.name);
          },
          editUserCommand(e2) {
            if (!e2) return;
            const t3 = () => {
              let t4 = this.getCommandDeclaration(e2);
              t4 = o2.toJS(t4);
              const i3 = [];
              return this.modifySteps(t4, (e3) => {
                const t5 = a2.steps[e3.type];
                t5?.onEdit && t5.onEdit(e3), e3.id = n2.id.pico(i3), i3.push(e3.id);
              }), t4;
            };
            this.commandEdits[e2] || (this.commandEdits[e2] = t3()), s2.transaction(() => {
              s2.chat.explorer.show = true, s2.chat.explorer.screen = "editor", s2.chat.explorer.commandName = null, s2.chat.explorer.editCommandName = e2;
            });
          },
          saveUserCommand(e2) {
            let t3 = o2.toJS(this.commandEdits[e2]);
            if (!t3) return;
            const n3 = this.list.findIndex((t4) => t4.meta.name === e2);
            if (-1 === n3) return;
            const l2 = t3.fresh;
            i2.controller.sendCommandUpdated(t3), s2.transaction(() => {
              delete t3.fresh, delete t3.selected, delete t3.path, this.commandEdits[e2] = t3, t3 = o2.toJS(t3), this.modifySteps(t3, (e3) => {
                delete e3.id, delete e3.selected;
              }), this.modifySteps(t3, (e3) => {
                const t4 = a2.steps[e3.type];
                t4?.onSave && t4.onSave(e3);
              }), this.list[n3] = t3;
              const i3 = this.systemCommands.find(
                (e3) => e3.meta.title === t3.meta.title
              )?.meta.name;
              this.archivedCommandNames.includes(i3) || this.toggleCommandArchived(i3);
            }), r2.send(l2 ? "commands.onCreate" : "commands.onUpdate", t3);
          },
          cancelUserCommand(e2) {
            const t3 = o2.toJS(this.commandEdits[e2]);
            t3?.fresh ? this.removeUserCommands(t3) : delete this.commandEdits[e2];
          },
          cleanup() {
            s2.transaction(() => {
              const e2 = new Set(
                s2.chats.map((e3) => e3.explorer.editCommandName).filter(Boolean)
              ), t3 = Object.keys(this.commandEdits);
              for (const n3 of t3) {
                const t4 = this.commandEdits[n3];
                e2.has(t4.meta.name) || delete this.commandEdits[n3];
              }
              e2.size > 0 && this.removeUserCommands(
                this.list.filter((t4) => t4.fresh && !e2.has(t4.meta.name))
              );
            });
          },
          removeUserCommands(e2) {
            if ((e2 = n2.ensureArray(e2)).length === 0) return;
            const t3 = new Set(e2.map((e3) => e3.meta.name));
            s2.transaction(() => {
              s2.chats.filter((e3) => t3.has(e3.explorer.editCommandName)).forEach((e3) => {
                e3.explorer.commandName = null, e3.explorer.editCommandName = null;
              }), this.list = this.list.filter((e3) => !t3.has(e3.meta.name)), t3.forEach((e3) => delete this.commandEdits[e3]), e2.map((e3) => e3.meta.title).forEach((e3) => {
                const t4 = this.systemCommands.find((t5) => t5.meta.title === e3)?.meta.name;
                this.archivedCommandNames.includes(t4) && this.toggleCommandArchived(t4);
              });
            }), e2 = e2.filter((e3) => !e3.fresh), r2.send("commands.onRemove", e2);
          },
          toggleCommandFavorite(e2) {
            const t3 = this.favoriteCommandNames;
            this.favoriteCommandNames = n2.array.toggle(t3, e2);
          },
          toggleCommandArchived(e2) {
            const t3 = this.archivedCommandNames;
            this.archivedCommandNames = n2.array.toggle(t3, e2);
          },
          toggleCommandSelected(e2) {
            n2.array.toggle(this.selectedCommandNames, e2, false);
          },
          selectAllCommands() {
            this.selectedCommandNames = this.list.map((e2) => e2.meta.name);
          },
          unselectAllCommands() {
            this.selectedCommandNames = [];
          },
          deleteSelectedCommands() {
            s2.transaction(() => {
              const e2 = this.selectedCommandNames;
              this.selectedCommandNames = [], this.removeUserCommands(
                this.list.filter((t3) => e2.includes(t3.meta.name))
              );
            });
          }
        };
      })(), (() => {
        const { $store: t2, $task: n2, $s: a2 } = e;
        t2.adapter.dashboard = {
          selectedTasksEnabled() {
            return (this.selectedTasks || []).every(
              (e2) => a2.tasks.get(e2)?.enabled
            );
          },
          taskSelected(e2) {
            return this.selectedTasks.includes(e2);
          },
          get resumableTaskCount() {
            const e2 = new Set(this.stoppedTasks);
            let t3 = 0;
            for (const n3 of a2.tasks) e2.has(n3.id) && t3++;
            return t3;
          },
          get screenTasks() {
            return this.getScreenTasks(a2.tab.screen);
          },
          hasEnabledScreenTasks() {
            return this.screenTasks.some((e2) => e2.enabled);
          },
          getScreenTasks: (e2) => e2.startsWith("domain:") ? a2.tasks.filter((t3) => e2 === `domain:${n2.proxy.taskDomain(t3)}`) : a2.tasks
        };
      })(), (() => {
        const { $store: t2, $env: n2, $utils: a2, $mobx: o2, $s: i2 } = e;
        let r2 = null;
        t2.adapter.feature = {
          enabled(e2) {
            let t3 = this[e2]?.enabled || false;
            return t3 === 100 || true === t3 || false !== t3 && (t3 === "dev" ? n2.is.development : t3 === "prod" ? n2.is.production : (t3 = Number(t3), !Number.isNaN(t3) && (r2 === null && (r2 = a2.hashCode(i2.agentId) % 100), Math.abs(r2) <= t3)));
          },
          interpolate(e2, t3) {
            const n3 = o2.toJS(a2.get(this, e2));
            if (!n3) return n3;
            if (!t3) return n3;
            const i3 = /\{\{(\w+)}}/g;
            return a2.cloneDeep(
              n3,
              (e3) => typeof e3 != "string" ? e3 : e3.startsWith("{{") && e3.endsWith("}}") ? t3[e3.slice(2, -2)] : e3 = e3.replace(i3, (e4, n4) => void 0 !== t3[n4] ? t3[n4] : "")
            );
          },
          get shouldUpdate() {
            if (n2.is.development) return true;
            const e2 = this.updatedAt || -1;
            return Date.now() - e2 > 3 * a2.time.HOUR;
          },
          hasPromo(e2 = null) {
            return this.promo && (!e2 || this.promo.type === e2) && this.promo.start <= Date.now() && this.promo.end >= Date.now();
          }
        };
      })(), (() => {
        const { $store: t2, $env: n2, $s: a2 } = e;
        t2.adapter.grid = {
          get apiUrl() {
            return `${n2.apiUrl}/grid`;
          },
          get enabled() {
            return this.enabledFor.includes(a2.billing.spaceId);
          },
          get enabledForAvailableSpaces() {
            return a2.billing.spaces.filter((e2) => this.enabledFor.includes(e2.id)).map((e2) => e2.id);
          },
          toggleEnabled() {
            this.enabled ? this.enabledFor = this.enabledFor.filter(
              (e2) => e2 !== a2.billing.spaceId
            ) : this.enabledFor = [...this.enabledFor, a2.billing.spaceId];
          },
          get unmaskedApiKey() {
            return this.apiKeys.find((e2) => !e2.masked);
          },
          get hasUnmaskedApiKeys() {
            return !!this.unmaskedApiKey;
          }
        };
      })(), (() => {
        const { $store: t2, $task: n2, $utils: a2 } = e;
        t2.adapter.journal = {
          get filterString() {
            return this.filters.filterString;
          },
          set filterString(e2) {
            this.filters.filterString = e2;
          },
          get filterPeriod() {
            return this.filters.period;
          },
          set filterPeriod(e2) {
            this.filters.period = e2;
          },
          get filterTypes() {
            return this.filters.types;
          },
          set filterTypes(e2) {
            this.filters.types = e2;
          },
          dropOldEvents(e2) {
            this.events.length <= e2 || (this.events = this.events.slice(0, e2));
          },
          clearEvents() {
            this.events = [];
          },
          logTaskCreated(e2) {
            this.addEvent({
              type: "task-management",
              code: "created",
              content: "Task created",
              task: e2
            });
          },
          logTaskDeleted(e2) {
            this.addEvent({
              type: "task-management",
              code: "deleted",
              content: "Task deleted",
              task: e2
            });
          },
          logTaskEnabled(e2) {
            this.addEvent({
              type: "task-management",
              code: e2.enabled ? "run" : "stopped",
              content: e2.enabled ? "Task started" : "Task stopped",
              task: e2
            });
          },
          logJobFinished(e2, t3) {
            this.addEvent({
              type: "task-results",
              code: t3.status,
              color: t3.color,
              content: t3.info,
              task: e2
            });
          },
          logActionsRun(e2, t3, n3 = false) {
            if (!t3 || e2.length === 0) return;
            const o2 = a2.unique(e2.map((e3) => e3.type)).join(", ");
            this.addEvent({
              type: "action",
              code: "alert",
              content: n3 ? `Silenced actions: ${o2}` : `Dispatched actions: ${o2}`,
              task: t3
            });
          },
          logCommandLaunched(e2) {
            this.addEvent({
              type: "command",
              code: "run",
              content: `Run command <b>${e2}</b>`
            });
          },
          logGridAction(e2) {
            this.addEvent({
              type: "grid",
              code: "run",
              content: `Processing GRID <b>${e2}</b> request`
            });
          },
          logGridActionResult(e2, t3, n3) {
            let a3 = `Processed GRID <b>${e2}</b> request`;
            t3 && (a3 += `, ${Math.round(t3 / 1024)} Kb`), n3 && (a3 += `, took ${n3.toFixed(1)} seconds`), this.addEvent({ type: "grid", code: "run", content: a3 });
          },
          addEvent(e2) {
            e2.ms || (e2.ms = Date.now()), e2.task && (e2.taskId = e2.task.id, e2.taskName = e2.task.name || n2.proxy.recipeTitle(e2.task), delete e2.task), this.events.unshift(e2);
          }
        };
      })(), (() => {
        const { $store: t2, $env: n2, $tabs: a2, $s: o2 } = e;
        t2.adapter.library = {
          get domainRecipes() {
            let e2 = this.recipes;
            if (n2.is.popup) {
              const t3 = a2.proxy.currentTabDomain;
              if (!t3) return e2;
              e2 = e2.filter(
                (e3) => !e3.domains || e3.domains.some((e4) => t3.includes(e4))
              );
            }
            return e2;
          },
          domainFavicon(e2) {
            if (!e2) return null;
            for (e2 = e2.split("."); e2.length > 0; ) {
              const t3 = e2.join("."), n3 = this.domains[t3], a3 = n3?.faviconHq || n3?.favicon;
              if (a3) return a3.startsWith("/") ? chrome.runtime.getURL(a3) : a3;
              e2.shift();
            }
            return null;
          },
          setDomainFavicon(e2, t3, n3 = false) {
            this.setDomainFavicons([{ domain: e2, favicon: t3, hq: n3 }]);
          },
          setDomainFavicons(e2) {
            o2.transaction(() => {
              e2.filter((e3) => e3.domain && e3.favicon).forEach((e3) => {
                const { domain: t3, favicon: n3, hq: a3 } = e3;
                this.domains[t3] = this.domains[t3] || {}, a3 ? this.domains[t3].faviconHq = n3 : this.domains[t3].favicon = n3;
              });
            });
          }
        };
      })(), (() => {
        const { $store: t2, $ai: n2, $s: a2, $utils: o2 } = e;
        t2.adapter.memory = {
          async add(e2, t3 = {}) {
            const i2 = { ...t3 };
            i2.id ||= o2.id.nano(), i2.createdAt ||= Date.now(), i2.accountId ||= a2.billing.account?.id || null, i2.spaceId ||= a2.billing.spaceId || null, i2.shared ||= null, i2.tokens ||= await n2.controller.countTextTokens(e2), i2.tags ||= [], i2.sr ||= null, i2.content = e2, a2.transaction(() => {
              a2.memory.list.push(i2);
            });
          }
        };
      })(), (() => {
        const { $store: t2, $news: n2, $utils: a2, $env: o2, $s: i2 } = e;
        t2.adapter.news = {
          toggleShow(e2) {
            const t3 = i2.tab.subscreen;
            e2 = true === e2 || false === e2 ? e2 : i2.tab.subscreen !== "news", i2.tab.subscreen = e2 ? "news" : null, i2.peeker.fixed = false, t3 && !e2 && (i2.news.lastSeenVersion = o2.version);
          },
          get anno() {
            let e2 = this.lastSeenAnno;
            if (!e2) return null;
            e2 = a2.versionNumber(e2);
            const t3 = Object.keys(n2.annos).filter((t4) => a2.versionNumber(t4) > e2);
            return t3.length === 0 ? null : n2.annos[t3.sort((e3, t4) => t4.value - e3.value)[0]];
          },
          resetLastSeenAnno() {
            const e2 = Object.keys(n2.annos).map((e3) => ({ value: a2.versionNumber(e3), k: e3 })).sort((e3, t3) => t3.value - e3.value)[0]?.k;
            e2 && (this.lastSeenAnno = e2);
          }
        };
      })(), (() => {
        const { $store: t2, $env: n2, $s: a2 } = e;
        t2.adapter.note = {
          get enabled() {
            return a2.settings.showUpdateNotes;
          },
          get notes() {
            return a2.feature.notes || [];
          },
          isShown(e2) {
            return this.shown.includes(e2);
          },
          show(e2) {
            this.isShown(e2) || this.shown.push(e2);
          },
          isAcknowledged(e2) {
            return this.acknowledged.includes(e2);
          },
          acknowledge(e2) {
            this.isAcknowledged(e2) || this.acknowledged.push(e2);
          },
          findById(e2) {
            return this.notes.find((t3) => t3.id === e2);
          },
          nextNote(e2 = "*", t3 = true) {
            return !!this.enabled && this.notes.find((o2) => {
              if (o2.type !== "*" && o2.type !== e2) return false;
              if (this.isAcknowledged(o2.id)) return false;
              if (!t3 && this.isShown(o2.id)) return false;
              if (o2.type === "notification" && a2.billing.hasPro()) return false;
              if (o2.filter) {
                if (o2.filter.env && o2.filter.env !== n2.env) return false;
                if (o2.filter.hasMultiUserSpaces && !a2.billing.hasMultiUserSpaces)
                  return false;
                if (o2.filter.hasCustomCommands && a2.commands.list.length < 2)
                  return false;
                if (o2.filter.hasCustomApiConnection && !a2.ai.connections.hasCustomApi)
                  return false;
              }
              if (o2.from) {
                const e3 = this._toUnixTimestamp(o2.from);
                if (Date.now() < e3) return false;
                if (a2.installedMs > e3) return false;
              }
              if (o2.until) {
                const e3 = this._toUnixTimestamp(o2.until);
                if (Date.now() > e3) return false;
              }
              return true;
            });
          },
          enhanceNote: (e2) => e2 ? (e2.message.includes("<BROWSER>") && (e2.message = e2.message.replace("<BROWSER>", n2.browser)), e2) : e2,
          _toUnixTimestamp: (e2, t3 = true) => (/* @__PURE__ */ new Date(e2 + (t3 ? "T00:00:00.000Z" : "T23:59:59.999Z"))).getTime()
        };
      })(), (() => {
        const { $store: t2, $s: n2 } = e;
        t2.adapter.peeker = {
          toggleShow(e2) {
            e2 = true === e2 || false === e2 ? e2 : n2.tab.subscreen !== "peeker", n2.tab.subscreen = e2 ? "peeker" : null;
          },
          get task() {
            return n2.tasks.get(this.taskId);
          },
          get record() {
            return this.task ? this.task.records.find((e2) => e2.ms === this.recordMs) : null;
          },
          reset() {
            n2.transaction(() => {
              Object.assign(this, t2.template.state().peeker);
            });
          },
          dropRecord(e2, t3) {
            if (e2 = e2 || this.taskId, t3 = t3 || this.recordMs, !e2 || !t3)
              return;
            const a2 = n2.tasks.get(e2);
            if (!a2) return;
            const o2 = a2.records.findIndex((e3) => e3.ms === t3);
            -1 !== o2 && a2.records.splice(o2, 1);
          }
        };
      })(), (() => {
        const { $store: t2, $s: n2 } = e;
        t2.adapter.redactor = {
          get task() {
            return n2.tasks.get(this.taskId);
          }
        };
      })(), (() => {
        const { $store: t2, $settings: n2, $s: a2 } = e;
        t2.adapter.settings = {
          get spaceConnectionId() {
            const e2 = a2.billing.spaceId, t3 = a2.ai.connections.map((e3) => e3.id), n3 = this.connectionIds[e2] || this.connectionIds.default;
            return n3 && t3.includes(n3) ? n3 : a2.ai.connections.find((e3) => e3.type === "cloudgpt")?.id || a2.ai.connections.find((e3) => e3.type === "openai-license")?.id || t3[0];
          },
          set spaceConnectionId(e2) {
            const t3 = a2.billing.spaceId || "default";
            this.connectionIds[t3] = e2;
          },
          toggleShow(e2) {
            e2 = true === e2 || false === e2 ? e2 : a2.tab.subscreen !== "settings", a2.tab.subscreen = e2 ? "settings" : null, a2.peeker.fixed = false;
          },
          get promptLanguageValue() {
            const e2 = this.promptLanguage;
            return n2.languageMap[e2]?.label || e2;
          },
          get storageLimitDefault() {
            return t2.template.state().settings.storageLimit;
          },
          get scheduledTimeframeValue() {
            return this.scheduledTimeframe.enabled ? {
              from: this.scheduledTimeframe.from,
              till: this.scheduledTimeframe.till
            } : null;
          }
        };
      })(), (() => {
        const { $store: t2, $s: n2 } = e;
        t2.adapter["shell.tabs.*"] = {
          get active() {
            return this.id === n2.shell.activeTabId;
          }
        };
      })(), (() => {
        const { $store: t2, $s: n2 } = e;
        t2.adapter["shell.tabs"] = {
          get(e2 = null) {
            return e2 || (e2 = n2.shell.activeTabId), this.find((t3) => t3.id === e2);
          }
        };
      })(), (() => {
        const { $store: t2, $env: n2, $s: a2 } = e;
        t2.adapter.shortcut = {
          update(e2 = {}) {
            a2.transaction(() => {
              Object.assign(a2.shortcut, e2), a2.shortcut.label || (a2.shortcut.label = this.computeLabel(a2.shortcut));
            });
          },
          computeLabel(e2) {
            const { key: t3, ctrlKey: a3, metaKey: o2, altKey: i2 } = e2, r2 = n2.platform;
            let s2;
            return s2 = r2 === "mac" ? o2 ? ["\u2318", t3] : a3 ? ["\u2303", t3] : i2 ? ["\u2325", t3] : [t3] : r2 === "linux" ? o2 ? ["\u2756", t3] : a3 ? ["Ctrl", t3] : i2 ? ["Alt", t3] : [t3] : o2 ? ["Win", t3] : a3 ? ["Ctrl", t3] : i2 ? ["Alt", t3] : [t3], s2 = s2.filter(Boolean), s2 = r2 === "win" ? s2.join(" + ") : s2.join(" "), s2;
          }
        };
      })(), (() => {
        const { $store: t2, $s: n2 } = e;
        t2.adapter["billing.account.spaces.*"] = {
          applyAiConnections() {
            n2.transaction(() => {
              this.connections = n2.ai.connections.filter((e3) => !e3.isWeb());
              const e2 = new Set(this.connections.map((e3) => e3.id)), t3 = this.initialConnectionId;
              this.initialConnectionId = t3 && e2.has(t3) ? t3 : null;
            });
          }
        };
      })(), (() => {
        const { $store: t2, $env: n2, $tabs: a2 } = e;
        t2.adapter[""] = {
          toggleTheme() {
            this.theme = this.theme === "day" ? "night" : "day";
          },
          get tab() {
            return n2.is.bg ? null : this.tabs[a2.proxy.currentTabId];
          },
          get chat() {
            return n2.is.bg ? null : this.tab.chat;
          }
        };
      })(), (() => {
        const { $store: t2, $s: n2 } = e;
        t2.adapter["tabs.*.creator"] = {
          get listTemplates() {
            return (this.templates || []).filter((e2) => !e2.dropdown);
          },
          get dropdownTemplates() {
            return (this.templates || []).filter((e2) => !!e2.dropdown);
          },
          prevListTemplateIndex() {
            if (this.listTemplates.length === 0) return;
            let e2 = this.templateIndex;
            const t3 = this.templates.length;
            do {
              e2 > 0 ? e2 -= 1 : e2 = t3 > 0 ? t3 - 1 : 0;
            } while (this.templates[e2].dropdown);
            this.templateIndex = e2;
          },
          nextListTemplateIndex() {
            if (this.listTemplates.length === 0) return;
            let e2 = this.templateIndex;
            const t3 = this.templates.length;
            do {
              e2 < t3 - 1 ? e2 += 1 : e2 = 0;
            } while (this.templates[e2].dropdown);
            this.templateIndex = e2;
          },
          get template() {
            const e2 = this.templates;
            return this.templateIndex < e2.length ? e2[this.templateIndex] : null;
          },
          set template(e2) {
            const { templateIndex: t3 } = this;
            this.templates[t3] = e2;
          },
          updateTemplate(e2 = {}) {
            n2.transaction(() => {
              Object.assign(this.templates[this.templateIndex], e2);
            });
          }
        };
      })(), (() => {
        const { $store: t2, $s: n2 } = e;
        t2.adapter["tabs.*"] = {
          get chat() {
            return n2.chats.get(this.chatId);
          },
          createChat({
            id: e2,
            title: a2,
            emoji: o2,
            connectionId: i2,
            explorerCategory: r2,
            taskId: s2
          }) {
            const l2 = t2.template.chat({
              id: e2,
              title: a2,
              emoji: o2,
              connectionId: i2 || n2.settings.spaceConnectionId,
              explorerCategory: r2 || n2.explorer.defaultCategory,
              taskId: s2
            });
            return n2.transaction(() => {
              n2.chats.push(l2), this.chatId = l2.id;
            }), this.chat;
          },
          isAppTab() {
            const e2 = this.creator?.pageUrl;
            return !!e2 && e2.split("?")[0] === "https://app.harpa.ai/";
          }
        };
      })(), (() => {
        const { $store: t2, $s: n2 } = e;
        t2.adapter["tasks.*"] = {
          disable() {
            n2.transaction(() => {
              this.enabled = false, n2.journal.logTaskEnabled(this);
            });
          }
        };
      })(), (() => {
        const { $store: t2 } = e;
        t2.adapter.tasks = {
          get(e2) {
            return e2 ? this.find((t3) => t3.id === e2) : null;
          },
          getByTabId(e2) {
            return e2 ? this.find((t3) => t3.inputs.schedule?.mediumId === e2) : null;
          },
          getIndex(e2) {
            return e2 ? this.findIndex((t3) => t3.id === e2) : null;
          },
          isAutomationMediumTab(e2) {
            return this.some((t3) => t3.inputs.schedule?.mediumId === e2);
          }
        };
      })(), (() => {
        const { $store: t2, $feature: n2, $utils: a2 } = e;
        t2.template.ai = () => ({
          mode: {
            page: { default: false, flag: "p" },
            web: { default: false, flag: "w" },
            file: { default: false, flag: "f" },
            isolated: { default: false, flag: "i" },
            think: { default: false, flag: "t" }
          },
          connectionsSavedAccountIds: [],
          connections: [
            {
              id: "openai-session:auto",
              type: "openai-session",
              flag: null,
              ...n2.config.chatgpt.defaultModel
            },
            {
              id: `api-${a2.id.nano()}`,
              type: "openai-license",
              customTitle: "",
              proxyUrl: "https://api.openai.com",
              proxyPath: "/v1/chat/completions",
              provider: "custom",
              headers: null,
              slug: "gpt-4o",
              apiKey: "",
              showAdvanced: false,
              maxTokens: null,
              maxResponseTokens: null,
              temperature: null,
              presencePenalty: null,
              frequencyPenalty: null,
              systemPrompt: null,
              stream: true,
              flag: "k",
              detail: "high"
            },
            {
              id: `api-${a2.id.nano()}`,
              type: "openai-license",
              customTitle: "",
              proxyUrl: "https://openrouter.ai/api",
              proxyPath: "/v1/chat/completions",
              provider: "custom",
              headers: null,
              slug: "mistralai/mistral-7b-instruct:free",
              apiKey: "",
              showAdvanced: false,
              maxTokens: 32768,
              maxResponseTokens: 32768,
              temperature: null,
              presencePenalty: null,
              frequencyPenalty: null,
              systemPrompt: null,
              stream: true,
              flag: null,
              detail: "high"
            },
            {
              id: "gemini-session",
              type: "gemini-session",
              token: null,
              flag: "g"
            },
            {
              id: "claude-session",
              type: "claude-session",
              orgId: null,
              flag: "c"
            }
          ].map((e2) => ({
            ...e2,
            superpowers: { page: true, web: true, commands: true }
          })),
          openaiSession: { accessToken: null, maxTokenFactor: 1 }
        });
      })(), (() => {
        const { $store: t2 } = e;
        t2.template.billing = () => ({
          hrpCookie: null,
          jwt: null,
          account: null,
          spaceId: null,
          plans: null,
          plansHash: null,
          pricingLastUpdatedAt: -1,
          location: null,
          locationCollectedOn: null,
          noHostPermission: false,
          standardMessages: 0,
          standardMessageRecoveryAt: Date.now(),
          upsell: {
            show: false,
            type: "upgrade",
            annual: false,
            planId: "s1",
            tokenUnits: 20,
            reason: null,
            disabledTill: null
          }
        });
      })(), (() => {
        const { $store: t2, $nanoid: n2 } = e;
        t2.template.chatAttachment = ({
          type: e2,
          pdf: t3 = null,
          image: a2 = null,
          ready: o2 = false
        }) => (e2 === "image" && (a2 ??= {}, a2.low ??= { fileId: null, width: null, height: null }, a2.high ??= { fileId: null, width: null, height: null }), e2 === "pdf" && (t3 = t3 || { fileId: null, name: "" }), {
          id: `attachment-${n2(8)}`,
          type: e2,
          ready: o2,
          ...t3 && { pdf: t3 },
          ...a2 && { image: a2 }
        });
      })(), (() => {
        const { $store: t2, $s: n2 } = e;
        t2.template.chat = ({
          id: e2 = null,
          title: a2 = null,
          emoji: o2 = null,
          connectionId: i2 = n2.settings.spaceConnectionId,
          explorerCategory: r2 = n2.explorer.defaultCategory,
          taskId: s2 = null
        } = {}) => ({
          updatedAt: null,
          id: e2 || t2.idGenerator.chat(),
          title: a2,
          emoji: o2 || t2.getChatEmoji(),
          ts: Date.now(),
          taskId: s2 || null,
          hidden: false,
          connectionId: i2,
          connectionShow: false,
          geminiCursor: null,
          claudeChatId: null,
          openaiChatId: null,
          openaiLastAnswerId: null,
          running: false,
          input: "",
          selectedSuggestionIndex: null,
          attachments: [],
          command: null,
          params: {},
          mode: {
            show: false,
            page: { enabled: n2?.ai?.mode.page.default ?? false },
            web: { enabled: n2?.ai?.mode.web.default ?? false },
            file: { enabled: n2?.ai?.mode.file.default ?? false, ids: null },
            think: { enabled: n2?.ai?.mode.think.default ?? false }
          },
          explorer: {
            show: false,
            screen: null,
            category: r2,
            commandName: null,
            editCommandName: null
          },
          foldedLinks: {},
          messages: []
        });
      })(), (() => {
        const { $store: t2 } = e;
        t2.template.commands = () => ({
          favoriteCommandNames: [],
          archivedCommandNames: [],
          selectedCommandNames: [],
          commandEdits: {},
          list: [],
          suggestions: { show: "always", version: null, mapping: null }
        });
      })(), (() => {
        const { $store: t2 } = e;
        t2.template.creator = () => ({
          pageUrl: null,
          parseStatus: null,
          parseError: null,
          screen: "templates",
          editingTaskId: null,
          templateIndex: -1,
          templates: [],
          frame: { open: false },
          trapper: { data: [], grabbing: false, text: "" }
        });
      })(), (() => {
        const { $store: t2 } = e;
        t2.template.dashboard = () => ({
          aggregation: "none",
          stoppedTasks: [],
          selectedTasks: [],
          predefinedImportedAt: null
        });
      })(), (() => {
        const { $store: t2, $utils: n2 } = e;
        t2.template.grid = () => ({
          enabledFor: [],
          nodeType: "current",
          nodeId: n2.id.pico(),
          uuid: n2.id.uuid(),
          selectedHelpTab: "terminal",
          apiKeys: [],
          timeout: 3e5,
          expiry: 30 * n2.time.DAY,
          resultsWebhook: "",
          action: "scrape",
          allowedActions: [
            { name: "scrape", enabled: true },
            { name: "serp", enabled: true },
            { name: "command", enabled: true },
            { name: "prompt", enabled: true }
          ],
          showAdvanced: false
        });
      })(), (() => {
        const { $store: t2 } = e;
        t2.template.journal = () => ({
          filters: {
            period: "all-time",
            filterString: "",
            types: [
              "task-management",
              "task-results",
              "action",
              "command",
              "system"
            ]
          },
          events: [
            {
              ms: Date.now(),
              type: "system",
              code: "ok",
              content: "HARPA agent is installed and ready to run automations",
              taskName: "SYSTEM"
            }
          ]
        });
      })(), (() => {
        const { $store: t2 } = e;
        t2.template.library = () => ({ domains: {} });
      })(), (() => {
        const { $store: t2 } = e;
        t2.template.memory = () => ({ list: [], search: "", editingId: null });
      })(), (() => {
        const { $store: t2, $nanoid: n2 } = e;
        t2.template.messageAttachment = ({
          type: e2,
          pdf: t3 = null,
          image: a2 = null,
          hidden: o2 = false
        }) => ({
          id: `attachment-${n2(8)}`,
          type: e2,
          ...t3 && { pdf: t3 },
          ...a2 && { image: a2 },
          ...o2 && { hidden: o2 }
        });
      })(), (() => {
        const { $store: t2 } = e;
        t2.template.news = () => ({
          rated: null,
          reviewed: false,
          feedbackMessage: "",
          feedbackEmail: "",
          feedbackStatus: null,
          feedbackLaterOn: null,
          lastSeenVersion: null,
          lastSeenAnno: null,
          closedMonitorIntro: false
        });
      })(), (() => {
        const { $store: t2 } = e;
        t2.template.note = () => ({ shown: [], acknowledged: [] });
      })(), (() => {
        const { $store: t2 } = e;
        t2.template.peeker = () => ({
          fixed: false,
          taskId: null,
          recordMs: null,
          steps: null,
          screenshot: null,
          stepsCollapsed: false,
          widgetCollapsed: false,
          screenshotCollapsed: false
        });
      })(), (() => {
        const { $store: t2 } = e;
        t2.template.record = () => ({
          ms: null,
          value: null,
          metric: null,
          status: null,
          color: null,
          triggered: false,
          dispatched: null,
          info: null
        });
      })(), (() => {
        const { $store: t2 } = e;
        t2.template.runner = () => ({
          netStable: navigator.onLine,
          queue: [],
          actions: {
            notification: { testStatus: null },
            sound: { testStatus: null, voices: [] },
            email: { testStatus: null, testMessage: null },
            webhook: { testStatus: null, testMessage: null },
            make: { testStatus: null, testMessage: null }
          }
        });
      })(), (() => {
        const { $store: t2 } = e;
        t2.template.settings = () => ({
          showContext: true,
          promptLanguage: "english",
          connectionIds: {},
          storageLimit: 5e3,
          scheduledTimeframe: { enabled: false, from: "18:00", till: "8:00" },
          silenceActions: { enabled: false },
          maxParallelTasks: 1,
          autoCloseHiddenWindow: false,
          synchChats: true,
          showScrollbars: false,
          showChatSwitch: true,
          showUpdateNotes: true,
          sendOnEnter: true,
          singleChat: false,
          chatGptHistory: true,
          frameWidth: 430,
          preferSidePanel: false,
          isolateCommands: true,
          stickyFeaturesPanel: false,
          autohideHeader: false,
          keepPdfs: true,
          csp: {
            allowAll: true,
            domains: [
              "youtube.com",
              "twitter.com",
              "x.com",
              "linkedin.com",
              "instagram.com",
              "google.com",
              "mail.google.com",
              "outlook.live.com",
              "mail.proton.me",
              "app.fastmail.com",
              "yahoo.com"
            ]
          }
        });
      })(), (() => {
        const { $store: t2 } = e;
        t2.template.shell = () => ({
          activeTabId: null,
          tabs: [],
          topSites: [],
          quitDialog: { show: false },
          suggestions: []
        });
      })(), (() => {
        const { $store: t2 } = e;
        t2.template.shortcut = () => ({
          enabled: true,
          qab: {
            enabled: true,
            actions: [
              "yt-summary",
              "yt-seek",
              "post-summary",
              "gmail-summary",
              "gmail-write",
              "gmail-autolabel",
              "google-search"
            ]
          },
          qap: {
            enabledMain: true,
            enabledSelection: true,
            enabledInput: true,
            enabledHotkeys: true,
            blacklist: "www.youtube.com, www.netflix.com, www.max.com, vimeo.com",
            snap: "right:bottom",
            delta: 130
          },
          actions: {
            toggleFrame: { hotkey: "auto KeyA", global: true },
            reloadFrame: { hotkey: "auto KeyR", global: true },
            captureArea: { hotkey: "auto KeyV", global: true },
            captureView: { hotkey: "auto KeyS", global: true },
            clearChat: { hotkey: "auto KeyL" },
            startNewChat: { hotkey: "auto KeyN" },
            resetChatHistory: { hotkey: "auto KeyB" },
            grabText: { hotkey: "auto KeyG" },
            toggleExplorer: { hotkey: "auto KeyX" },
            toggleConnections: { hotkey: "auto KeyC" },
            copyLastAnswer: { hotkey: "cmd shift KeyC" },
            pasteLastAnswer: { hotkey: "cmd shift KeyV" }
          }
        });
      })(), (() => {
        const { $store: t2, $feature: n2 } = e;
        t2.template.state = () => ({
          version: t2.version,
          agentId: t2.idGenerator.agent(),
          installedMs: null,
          setupLaunchedMs: null,
          updatedVersion: null,
          theme: "day",
          ai: t2.template.ai(),
          memory: t2.template.memory(),
          news: t2.template.news(),
          settings: t2.template.settings(),
          shortcut: t2.template.shortcut(),
          commands: t2.template.commands(),
          dashboard: t2.template.dashboard(),
          peeker: t2.template.peeker(),
          runner: t2.template.runner(),
          library: t2.template.library(),
          journal: t2.template.journal(),
          billing: t2.template.billing(),
          grid: t2.template.grid(),
          note: t2.template.note(),
          youtube: t2.template.youtube(),
          tabs: {},
          tasks: [],
          chats: [],
          global: {
            tone: "I write in a short and concise way. My speech is clear, professional, and to the point.",
            userinfo: void 0
          },
          explorer: {
            expanded: false,
            expandedAcknowledged: false,
            defaultCategory: "All"
          },
          feature: { updatedAt: -1, hash: null, ...n2.config },
          recipes: {},
          redactor: { show: false, taskId: null },
          sandbox: { isRunning: false, tests: [] },
          welcome: {
            shown: false,
            title: "AI AGENT IS INSTALLED",
            status: null,
            featuresTitle: "QUICK GUIDES",
            features: null,
            stepsSubtitle: "Your HARPA comes with a built-in web automation engine and can monitor pages, prices and data for you. Follow these steps to set up a monitor:",
            dashboardLink: "https://app.harpa.ai",
            step: 1
          },
          stats: { taskRuns: 0, clickedJoinDiscord: false },
          acknowledged: { affiliate: false, blackfriday: false, spaceConnections: false }
        });
      })(), (() => {
        const { $store: t2 } = e;
        t2.template.tab = (e2) => ({
          id: e2,
          chatId: null,
          screen: "chat",
          subscreen: null,
          creator: t2.template.creator(),
          shortcutCommand: null
        });
      })(), (() => {
        const { $store: t2 } = e;
        t2.template.task = ({ id: e2 } = {}) => ({
          id: e2 || t2.idGenerator.task(),
          version: t2.version,
          createdMs: Date.now(),
          recipeId: "watcher.monitorChanges",
          name: "",
          enabled: true,
          inputScreen: "overview",
          inputs: {},
          widgets: {},
          records: [],
          state: {}
        });
      })(), (() => {
        const { $store: t2 } = e;
        t2.template.youtube = () => ({ transcripts: {}, transcriptDetails: {} });
      })(), (() => {
        const { $bus: t2, $env: n2, $utils: a2 } = e;
        t2.controller = {
          async init() {
            t2.on = this.on.bind(this), t2.off = this.off.bind(this), t2.once = this.once.bind(this), t2.send = this._wrapThrowIfError(this.send), t2.call = this._wrapThrowIfError(this.call), t2.poll = this.poll.bind(this), t2.getTabId = this.getTabId.bind(this), this._locus = n2.getLocus(), this._serialize = this._serialize.bind(this), this._handlers = {}, this._is("pp") ? (this._setupPp(), this._tabId = await t2.getTabId()) : this._is("bg") ? (this._blobs = {}, this._channel = new BroadcastChannel("bus.channel"), this._setupBg()) : this._is("cs") ? await this._setupCs() : this._is("nj") ? this._setupNj() : this._is("os") ? (t2.setIframe = (e2) => this._iframe = e2, this._iframe = null, this._channel = new BroadcastChannel("bus.channel"), this._setupOs()) : this._is("oi") && this._setupOi();
          },
          on(e2, t3, n3 = null) {
            this._on(e2, null, t3, n3);
          },
          off(e2, t3 = null) {
            this._off(e2, null, t3);
          },
          once(e2, t3) {
            const n3 = async (...a3) => (this.off(e2, n3), await t3(...a3));
            this.on(e2, n3);
          },
          async send(e2, ...n3) {
            if (a2.is.numeric(e2)) {
              const t3 = Number(e2);
              return e2 = n3[0], n3 = n3.slice(1), await this._pick([
                this._sendToCs(t3, e2, ...n3),
                this._sendToExt(t3, e2, ...n3)
              ]);
            }
            if (this._is("pp")) return await this._sendToExt(e2, ...n3);
            if (this._is("nj")) return await this._sendToPage(e2, ...n3);
            if (this._is("oi")) return await this._sendToParent(e2, ...n3);
            if (this._is("bg", "cs", "os"))
              return await this._pick([
                this._sendToExt(e2, ...n3),
                this._callHandlers({ name: e2, args: n3 }, (e3) => e3.proxy)
              ]);
            if (this._is("fg")) {
              if (e2 === "store.actions") return;
              if (e2 === "idb.change") return;
              t2.log(e2, ...n3);
            }
          },
          async call(e2, ...t3) {
            return this._callHandlers({ name: e2, args: t3 }, (e3) => !e3.proxy);
          },
          async poll(e2, ...t3) {
            return await a2.waitFor(() => this.send(e2, ...t3));
          },
          async getTabId() {
            if (this._is("bg")) return null;
            if (this._is("pp")) {
              const e3 = new URL(location.href).searchParams.get("tabId");
              if (e3) return Number(e3);
            }
            const { tabId: e2 } = await this.send("bus.getTabData");
            return e2;
          },
          _on(e2, t3, n3, a3 = null) {
            this._handlers[e2] || (this._handlers[e2] = []), this._is("cs", "nj", "oi") && this._handlers[e2].length === 0 && this._sendToProxier("bus.proxy", e2, true);
            const o2 = { fn: n3, name: e2 };
            t3 && (o2.proxy = t3), a3 && (o2.this = a3), this._handlers[e2].push(o2);
          },
          _off(e2, t3 = null, n3 = null) {
            this._handlers[e2] && (this._handlers[e2] = this._handlers[e2].filter((e3) => {
              const a3 = !n3 || n3 === e3.fn, o2 = t3 === (e3.proxy || null);
              return !a3 || !o2;
            }), this._handlers[e2].length === 0 && (delete this._handlers[e2], this._is("cs", "nj", "oi") && this._sendToProxier("bus.proxy", e2, false)));
          },
          _setupPp() {
          },
          _setupBg() {
            chrome.runtime.onMessage.addListener((e2, t3, n3) => {
              if (!this._isBusMsg(e2)) return;
              const a3 = t3.tab?.id || null;
              if (e2.name === "bus.proxy")
                return void (async () => {
                  const [t4, n4] = await this._deserialize(e2.argsStr);
                  if (!a3) return;
                  const o3 = `cs-${a3}`;
                  n4 ? this._on(t4, o3, (...e3) => this._sendToCs(a3, t4, ...e3)) : this._off(t4, o3);
                })();
              if (e2.name === "bus.removeCsProxies")
                return void this._removeProxyHandlers(`cs-${a3}`);
              if (e2.name === "bus.getTabData") {
                const e3 = t3.tab?.windowId || null;
                return n3(this._serialize({ tabId: a3, windowId: e3 })), true;
              }
              if (e2.name === "bus.sendToCs")
                return (async () => {
                  const t4 = await this._deserialize(e2.argsStr), a4 = await this._sendToCs(...t4);
                  n3(this._serialize(a4));
                })(), true;
              if (e2.name === "bus.blobIdToObjectUrl")
                return (async () => {
                  const [t4] = await this._deserialize(e2.argsStr), a4 = await this._blobIdToObjectUrl(t4);
                  n3(this._serialize(a4));
                })(), true;
              const o2 = this._callHandlers(e2, (e3) => e3.proxy !== `cs-${a3}`);
              return o2 ? (o2.then(this._serialize).then(n3), true) : void 0;
            }), chrome.tabs.onRemoved.addListener((e2) => {
              this._removeProxyHandlers(`cs-${e2}`);
            });
          },
          async _setupCs() {
          },
          _setupNj() {
          },
          _setupOs() {
          },
          _setupOi() {
          },
          async _sendToExt(e2, ...n3) {
            let o2 = null;
            a2.is.numeric(e2) && (o2 = Number(e2), e2 = n3[0], n3 = n3.slice(1));
            const i2 = this._serialize(n3), r2 = this._createBusMsg({ name: e2, argsStr: i2, target: o2 }), s2 = await new Promise((e3) => {
              try {
                chrome.runtime.sendMessage(r2, (t3) => {
                  chrome.runtime.lastError ? e3(null) : e3(t3);
                });
              } catch (n4) {
                if (n4.message === "Extension context invalidated.") return;
                t2.error(n4), e3(null);
              }
            });
            return await this._deserialize(s2);
          },
          async _sendToCs(e2, t3, ...n3) {
            if (!chrome.tabs?.sendMessage)
              return await this.send("bus.sendToCs", e2, t3, ...n3);
            const a3 = this._serialize(n3), o2 = this._createBusMsg({ name: t3, argsStr: a3, target: "cs" }), i2 = await new Promise((t4) => {
              chrome.tabs.sendMessage(e2, o2, (e3) => {
                chrome.runtime.lastError ? t4(null) : t4(e3);
              });
            });
            return await this._deserialize(i2);
          },
          async _sendToPage(e2, ...t3) {
            const n3 = this._generateId(), a3 = this._createBusMsg({
              name: e2,
              args: t3,
              reqId: n3,
              locus: this._locus
            });
            return window.postMessage(a3, "*"), await this._waitForResponseMessage(n3);
          },
          async _sendToIframe(e2, ...t3) {
            if (!this._iframe) return null;
            const n3 = this._generateId(), a3 = this._createBusMsg({ name: e2, args: t3, reqId: n3 });
            return this._iframe.contentWindow.postMessage(a3, "*"), await this._waitForResponseMessage(n3);
          },
          async _sendToParent(e2, ...t3) {
            const n3 = this._generateId(), a3 = this._createBusMsg({ name: e2, args: t3, reqId: n3 });
            return parent.postMessage(a3, "*"), await this._waitForResponseMessage(n3);
          },
          async _sendToProxier(e2, ...t3) {
            return this._is("cs") ? await this._sendToExt(e2, ...t3) : this._is("nj") ? await this._sendToPage(e2, ...t3) : this._is("oi") ? await this._sendToParent(e2, ...t3) : void 0;
          },
          _waitForResponseMessage: async (e2) => await new Promise((t3) => {
            const n3 = ({ data: a3 }) => {
              !(!a3 || a3.resId !== e2) && (window.removeEventListener("message", n3), t3(a3.result));
            };
            window.addEventListener("message", n3);
          }),
          _callHandlers({ name: e2, args: n3, argsStr: a3 }, o2 = null) {
            let i2 = this._handlers[e2];
            return i2 ? (o2 && (i2 = i2.filter(o2)), i2.length === 0 ? null : new Promise(async (e3) => {
              a3 && (n3 = await this._deserialize(a3));
              e3(
                await this._pick(
                  i2.map(async (e4) => {
                    try {
                      return await e4.fn.call(e4.this, ...n3);
                    } catch (n4) {
                      return t2.error(`failed to handle "${e4.name}".`, n4), n4;
                    }
                  })
                )
              );
            })) : null;
          },
          _removeProxyHandlers(e2) {
            Object.keys(this._handlers).forEach((t3) => {
              this._handlers[t3] = this._handlers[t3].filter(
                (t4) => t4.proxy !== e2
              ), this._handlers[t3].length === 0 && delete this._handlers[t3];
            });
          },
          _serialize(e2) {
            return a2.is.nil(e2) ? null : JSON.stringify(e2, (e3, t3) => {
              if (a2.is.blob(t3)) {
                if (this._is("bg")) {
                  const e4 = this._generateId();
                  return this._blobs[e4] = t3, `bus.blob.${e4}`;
                }
                return `bus.blob.${a2.objectUrl.create(t3, true)}`;
              }
              return a2.is.error(t3) ? `bus.error.${t3.message}` : t3;
            });
          },
          async _deserialize(e2) {
            if (!a2.is.string(e2)) return null;
            const t3 = /* @__PURE__ */ new Map(), n3 = JSON.parse(e2, (e3, n4) => {
              const o2 = a2.is.string(n4);
              return o2 && n4.startsWith("bus.blob.") ? (t3.set(n4, n4.slice(9)), n4) : o2 && n4.startsWith("bus.error.") ? new Error(n4.slice(10)) : n4;
            });
            return await Promise.all(
              [...t3.keys()].map(async (e3) => {
                let n4;
                const a3 = t3.get(e3);
                n4 = a3.startsWith("blob:") ? a3 : await this._sendToExt("bus.blobIdToObjectUrl", a3);
                const o2 = await fetch(n4).then((e4) => e4.blob());
                t3.set(e3, o2);
              })
            ), this._applyBlobs(n3, t3);
          },
          _applyBlobs(e2, t3) {
            if (t3.has(e2)) return t3.get(e2);
            if (a2.is.array(e2) || a2.is.object(e2))
              for (const n3 in e2) e2[n3] = this._applyBlobs(e2[n3], t3);
            return e2;
          },
          async _blobIdToObjectUrl(e2) {
            const t3 = this._blobs[e2];
            let n3;
            return a2.is.string(t3) ? n3 = t3 : (n3 = await this._blobToObjectUrl(t3), this._blobs[e2] = n3), setTimeout(() => delete this._blobs[e2], 6e4), n3;
          },
          async _blobToObjectUrl(e2) {
            const t3 = this._generateId();
            return this._channel.postMessage({ reqId: t3, blob: e2 }), await new Promise((e3) => {
              const n3 = ({ data: a3 }) => {
                !(!a3 || a3.resId !== t3) && (this._channel.removeEventListener("message", n3), e3(a3.objectUrl));
              };
              this._channel.addEventListener("message", n3);
            });
          },
          _is(...e2) {
            return e2.includes(this._locus);
          },
          _isBusMsg: (t3) => t3 && t3.$bus && t3.appName === e.name,
          _createBusMsg: (t3) => ({ $bus: true, appName: e.name, ...t3 }),
          _generateId: () => `bus-${Date.now()}-${Math.random().toString(36).slice(2)}`,
          _wrapThrowIfError(e2) {
            return async (...t3) => {
              const n3 = await e2.call(this, ...t3);
              if (a2.is.error(n3)) throw n3;
              return n3;
            };
          },
          _pick: async (e2 = []) => e2.length === 0 ? null : await new Promise((t3) => {
            let n3 = 0;
            e2.forEach(async (o2) => {
              const i2 = await o2;
              return a2.is.nil(i2) ? n3 == e2.length - 1 ? t3(null) : void n3++ : t3(i2);
            });
          })
        };
      })(), (() => {
        const { $chat: t2, $s: n2, $utils: a2 } = e;
        t2.flagsController = {
          parse(e2) {
            const t3 = /* @__PURE__ */ new Set(), o2 = this._parseAllFlags(e2), i2 = n2.ai.connections.map((e3) => e3.flag), r2 = Object.values(n2.ai.mode).map((e3) => e3.flag), s2 = a2.unique([...i2, ...r2]).filter(Boolean).sort((e3, t4) => t4.length - e3.length);
            for (let e3 of o2.flags)
              for (const n3 of s2)
                e3.includes(n3) && (t3.add(n3), e3 = e3.replace(n3, ""));
            return { text: o2.text, flags: [...t3] };
          },
          _parseAllFlags(e2) {
            const t3 = /* @__PURE__ */ new Set(), n3 = /^-+[\w-]+(\s|$)/, a3 = /\s-+[\w-]+$/;
            for (e2 = e2.trim(); ; ) {
              const a4 = e2.match(n3)?.[0];
              if (!a4) break;
              t3.add(a4.trim().replace(/^-+/, "")), e2 = e2.slice(a4.length).trim();
            }
            for (; ; ) {
              const n4 = e2.match(a3)?.[0];
              if (!n4) break;
              t3.add(n4.trim().replace(/^-+/, "")), e2 = e2.slice(0, -n4.length).trim();
            }
            return { text: e2, flags: [...t3] };
          }
        };
      })(), (() => {
        const { $commands: t2 } = e;
        t2.defaultTitle = "Custom automation";
      })(), (() => {
        const { $commands: t2 } = e;
        t2.extractSerpLinks = (e2, t3, n2) => {
          const a2 = /### (.*?) \[(.*?)]\((.*?)\)/g, o2 = [];
          let i2, r2 = 0;
          for (; (i2 = a2.exec(e2)) !== null && !(t3 && ++r2 > t3); ) {
            const t4 = i2[1].trim();
            let n3 = i2[3].trim();
            const s2 = a2.lastIndex, l2 = e2.indexOf("###", s2), c2 = l2 > -1 ? l2 : e2.length;
            let u2 = r2 === 1 ? e2.substring(0, i2.index).trim() : e2.substring(s2, c2).substring(0, 182).trim();
            u2 = u2.replace(/\n/g, " "), u2.startsWith(") ") && (u2 = u2.substring(2), n3 += ")"), o2.push({ title: t4, url: n3, description: u2 });
          }
          if (n2) {
            const e3 = /(youtube\.|facebook\.|twitter\.|linkedin\.|instagram\.)/i;
            o2.sort((t4, n3) => {
              const a3 = e3.test(t4.url), o3 = e3.test(n3.url);
              return a3 && !o3 ? 1 : !a3 && o3 ? -1 : 0;
            });
          }
          return o2;
        }, t2.extractSerpPrefix = (e2) => {
          const t3 = /### (.*?) \[(.*?)]\((.*?)\)/g.exec(e2);
          return t3 ? e2.substring(0, t3.index).trim() : e2;
        };
      })(), (() => {
        const { $commands: t2, $store: n2 } = e;
        t2.normalizeCommand = (e2) => {
          if (!e2) return e2;
          e2.version = e2.version || 1, e2.meta = {
            ...e2.meta,
            name: e2.meta.name || n2.idGenerator.command(),
            title: e2.meta.title || "",
            description: e2.meta.description || "",
            category: e2.meta.category || "User",
            apps: e2.meta.apps || "",
            emoji: e2.meta.emoji || ""
          };
          const o3 = new Set(Object.keys(t2.steps));
          return e2.steps = (e2.steps || []).map(a2).filter(Boolean).filter((e3) => o3.has(e3.type)), e2;
        };
        const a2 = (e2) => e2 ? ((e2 = o2({ ...e2 })).type === "say" ? e2.message = (e2.message || "").trim() : e2.type === "ask" ? e2.param = e2.param || "param" : e2.type === "set" ? (e2.type = "calc", e2.func = "set") : e2.type === "gpt" ? e2.param = e2.param || "gpt" : e2.type === "paste" ? (e2.text = e2.text || "{{gpt}}", e2.close = e2.close || false) : e2.type === "command" ? (e2.name = e2.name || "", e2.inputs = e2.inputs || []) : e2.type === "group" && (e2.steps = e2.steps.map(a2)), e2) : null, o2 = (e2) => (e2.type || (typeof e2.say == "string" ? delete (e2 = { ...e2, type: "say", message: e2.say }).say : typeof e2.ask == "string" ? delete (e2 = {
          ...e2,
          type: "ask",
          param: e2.ask,
          message: e2.message || "",
          default: e2.default || ""
        }).ask : typeof e2.gpt == "string" ? delete (e2 = { ...e2, type: "gpt", prompt: e2.gpt }).gpt : typeof e2.jump == "string" ? delete (e2 = { ...e2, type: "jump", to: e2.jump }).jump : typeof e2.paste == "string" ? delete (e2 = { ...e2, type: "paste", text: e2.paste }).paste : typeof e2.calc == "string" ? delete (e2 = {
          ...e2,
          type: "calc",
          param: e2.calc,
          value: e2.value || `{{${e2.calc}}}`
        }).calc : typeof e2.increment == "string" ? delete (e2 = {
          ...e2,
          type: "calc",
          func: "increment",
          param: e2.increment
        }).increment : typeof e2.decrement == "string" ? delete (e2 = {
          ...e2,
          type: "calc",
          func: "decrement",
          param: e2.decrement
        }).decrement : e2.type = "say"), e2);
      })(), (() => {
        const { $commands: t2 } = e;
        t2.systemCommands = [
          {
            meta: {
              name: "vision",
              title: "Capture view",
              description: "Captures page area to find and fix mistakes, explain, pass test or answer questions.",
              category: "Productivity",
              emoji: "\u{1F4F8}"
            },
            steps: [
              {
                label: "ASK FOR IMAGE",
                type: "ask",
                param: "image",
                message: "",
                vision: { enabled: true, mode: "area", hint: "", send: true }
              },
              {
                type: "ask",
                param: "menu",
                message: "",
                options: [
                  { label: "\u{1F575}\uFE0F\u200D\u2642\uFE0F FIND AND FIX MISTAKES", value: "fix" },
                  { label: "\u{1F9E9} SOLVE TEST", value: "solve" },
                  { label: "\u{1F4E9} REPLY", value: "reply" },
                  { label: "\u269B\uFE0F EXPLAIN AND SIMPLIFY", value: "explain" },
                  { label: "\u{1F4DD} REWRITE AND FIX TONE", value: "rewrite" },
                  { label: "\u{1F3C1} AUTOCOMPLETE WRITING", value: "autocomplete" },
                  { label: "\u{1F30E} TRANSLATE", value: "translate" },
                  { label: "\u{1F50D} EXTRACT TEXT", value: "extract" },
                  { label: "\u267B\uFE0F TO BLOG, ARTICLE, MJ PROMPT", value: "repurpose" },
                  "$custom"
                ],
                optionsInvalid: false
              },
              {
                condition: "{{menu}} = fix",
                label: "FIX",
                type: "group",
                steps: [
                  {
                    type: "gpt",
                    prompt: 'You are a universal assistant who analyzes images and corrects errors in text, code, or logic.\n\nI want you to look at a screenshot and find errors in it. If there are errors, your answer should contain 2 parts:\n\n1. Corrected code or text itself in a code block (or in a markdown code block for texts). Rewrite the entire text, not just the sentences where you found errors.\n2. Bullet points listing only fragments with fixed errors, highlighted using bold markdown formatting. Show the corrections only, don\'t show the mistakes. For long sentences, show only the part with the fixed error in the bullet point. For example: "- ...it was raining **heavily**..."\n\n\n[Instructions]:\n\n- Response in {{language}}. If I sent you text in a language other than {{language}}, correct it without translating.\n- Be brief, precise, and clear to me.\n- Don\'t echo my prompt and do not add any notes.\n- Do not hallucinate or make up errors where none exist. If the text is error-free, write "There are no errors." in {{language}}.\n- If there is an error in the code, describe what the error was and how you fixed it. If necessary, wrap code fragments into code blocks.\n- For complex problems, such as logic tests, think through step by step.\n\n\n[Response format]:\n\nYour thinking and reasoning (omit for simple assignments).\n\n```\n... corrected text or code ...\n```\n\n**Fixes:**\n- Text with **highlighted** fixed errors or code error explanation and fixes.\n- ...\n\nIf the text is error-free, disregard this response format and tell me there are no errors.\n\n\n[Screenshot for analysis]: {{image}}\n\n\nYOUR RESPONSE:',
                    isolated: true,
                    param: "gpt"
                  },
                  {
                    label: "MENU - FIX",
                    type: "ask",
                    param: "next",
                    message: "",
                    options: [
                      { label: "\u23ED\uFE0F NEXT QUESTION", value: "next" },
                      { label: "\u267B\uFE0F EXPAND RESPONSE", value: "expand" },
                      "$custom"
                    ],
                    optionsInvalid: false
                  },
                  {
                    condition: "{{next}} = next",
                    type: "jump",
                    to: "ASK FOR IMAGE"
                  },
                  {
                    condition: "{{next}} = expand",
                    label: "EXPAND",
                    type: "group",
                    steps: [
                      {
                        type: "gpt",
                        prompt: "Please expand on your answer in {{language}} and describe in detail why you arrived at that particular solution. Think step by step.\n\nIf you think you've made a mistake in your initial assessment, feel free to self-correct.\n\nInstructions:\n- Do not fabricate any facts or information.\n- Avoid vague or general phrases.\n- Write in detail, but remain understandable for any reader.\n\nYour response in {{language}}:",
                        param: "gpt"
                      },
                      { type: "jump", to: "MENU - FIX" }
                    ]
                  },
                  {
                    condition: "{{next-option}} = $custom",
                    label: "CUSTOM",
                    type: "group",
                    steps: [
                      { type: "gpt", prompt: "{{next}}", param: "gpt" },
                      { type: "jump", to: "MENU - FIX" }
                    ]
                  }
                ]
              },
              {
                condition: "{{menu}} = explain",
                label: "EXPLAIN",
                type: "group",
                steps: [
                  {
                    type: "gpt",
                    prompt: "Your goal is to aid learning by explaining concepts, formulas, task assignments, sender intents etc. in an easily understandable way. Only respond in {{language}}.\n\nComplete two tasks for me and provide a comprehensive response:\n\n1) Analyze what's on the image, simplify and explain it in a brief summary format.\n- Use simple language to make it easy for me to grasp any concepts or complicated topics.\n- If the image contains code, explain what it does.\n- Provide a brief overview followed by a bulleted list of key observations.\n- Do not hallucinate facts or information.\n- Do not make assumptions beyond what is clearly visible in the image.\n- Avoid general phrases and focus on specific details.\n\n2) Generate 3 short and concise queries related to the content of the image.\n- You should be able to answer each and every of the related query without additional information from me.\n- Related queries should be brief and focus on aspects not fully explained in your analysis.\n- Generate queries that encourage further exploration.\n- Wrap every relevant query into a markdown code block.\n\nDo not add any titles or other sections to your answer, strictly follow the required format.\n\n\n[Required format]:\n\n...Brief explanation summary...\n\n- A bullet point with extra details...\n- A bullet point with extra details...\n- ... do not use 2 level bullet points\n\n```markdown\nShort related query...\n```\n\n```markdown\nShort related query...\n```\n\n```markdown\nShort related query...\n```\n\n\n[Screenshot for analysis]:\n\n{{image}}\n\n\n[Your response in the required format]:",
                    isolated: true,
                    onCodeClick: "send-text",
                    param: "gpt"
                  },
                  {
                    label: "MENU - EXPLAIN",
                    type: "ask",
                    param: "next",
                    message: "",
                    options: [
                      { label: "\u23ED\uFE0F NEXT QUESTION", value: "next" },
                      { label: "\u2753 ASK FOLLOW UP", value: "ask" },
                      "$custom"
                    ],
                    default: "",
                    optionsInvalid: false
                  },
                  {
                    condition: "{{next}} = next",
                    type: "jump",
                    to: "ASK FOR IMAGE"
                  },
                  {
                    condition: ["{{next-option}} = $custom", "{{next}} = ask"],
                    label: "CUSTOM",
                    type: "group",
                    steps: [
                      {
                        condition: "{{next}} = ask",
                        type: "ask",
                        param: "next",
                        message: "\u{1F4AC} Type a follow-up question.",
                        options: null,
                        default: ""
                      },
                      { type: "gpt", prompt: "{{next}}", param: "gpt" },
                      { type: "jump", to: "MENU - EXPLAIN" }
                    ]
                  }
                ]
              },
              {
                condition: "{{menu}} = solve",
                label: "SOLVE TEST",
                type: "group",
                steps: [
                  {
                    type: "gpt",
                    prompt: 'I want you to act as a very proficient teacher, lecturer and university professor and respond only in {{language}}.\n\nYour task is to analyze the screenshot I\'ve provided and answer the question(s) found within it. Respond in an understandable way by first offering a brief explanation of your reasoning, followed by a concise answer to the specific question given in the image.\n\nFollow the instructions:\n- In the answer reasoning, first describe how you arrived at the answer to the question step by stap, what logic you applied in your reasoning.\n- Break down complex concepts so that they are easier to understand.\n- At the end of your response, give me a concise answer.\n- Wrap your answer text into a markdown code block.\n- If my question contains answer options, your task in the answer is to show me one of the suggested points, without coming up with other answer options.\n- Do not hallucinate facts or information.\n- Avoid general phrases.\n\n\nExpected response format:\n\n**Reasoning:**\n...text briefly explaining the answer...\n\n**Answer:**\n\n```markdown\n...brief text answering the question, without explaining the answer...\n```\n\nIf there are multiple questions, answer them in order, separating the questions using numbering and headings like "### Question 1:".\n\n\n[Screenshot for analysis]: {{image}}\n\n\nYOUR RESPONSE:',
                    isolated: true,
                    param: "gpt"
                  },
                  {
                    label: "MENU - ANSWER",
                    type: "ask",
                    param: "next",
                    message: "",
                    options: [
                      { label: "\u23ED\uFE0F NEXT QUESTION", value: "next" },
                      { label: "\u267B\uFE0F EXPAND RESPONSE", value: "expand" },
                      "$custom"
                    ],
                    default: "",
                    optionsInvalid: false
                  },
                  {
                    condition: "{{next}} = next",
                    type: "jump",
                    to: "ASK FOR IMAGE"
                  },
                  {
                    condition: "{{next}} = expand",
                    label: "EXPAND",
                    type: "group",
                    steps: [
                      {
                        type: "gpt",
                        prompt: "Please expand on your answer in {{language}} and describe in detail why you arrived at that particular solution.\n\nInstructions:\n- Do not fabricate any facts or information.\n- Avoid vague or general phrases.\n- Write in detail, but remain understandable for any reader.\n- At the end of your response, restate the final answer to my question. If you made any mistakes, correct them.\n\nFollow this response format:\n\n**Detailed reasoning:**\n...detailed reasoning behind the chosen answer...\n\n**Answer:**\n\n```markdown\n...brief text answering the question, without explaining the answer...\n```\n\nYour response in {{language}}:",
                        param: "gpt"
                      },
                      { type: "jump", to: "MENU - ANSWER" }
                    ]
                  },
                  {
                    condition: "{{next-option}} = $custom",
                    label: "CUSTOM",
                    type: "group",
                    steps: [
                      { type: "gpt", prompt: "{{next}}", param: "gpt" },
                      { type: "jump", to: "MENU - ANSWER" }
                    ]
                  }
                ]
              },
              {
                condition: "{{menu}} = translate",
                label: "TRANSLATE",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    param: "language",
                    message: "What language to translate to? Press enter for {{language}}.",
                    options: null,
                    default: "{{language}}"
                  },
                  {
                    type: "gpt",
                    prompt: "Act as a professional Translator. Reply in {{language}}\n\nYour task is to analyze the screenshot I've provided, find the main text portion in it, and translate it to English:\n\nInstructions:\n- If you see any text in the image that doesn't belong to the main content (like website buttons or other elements), ignore that text and only translate the main text.\n- Do not echo my command.\n- If the text contains a question or a call to action, do not respond to it; just complete the translation.\n- Show the translation in the markdown code block.\n\nFollow the response format:\n\n```markdown\n..text translation without quotes...\n```\n\n[Find the text in a screenshot]: {{image}}\n\n[TRANSLATION to {{language}}]:",
                    isolated: true,
                    param: "text"
                  },
                  {
                    type: "calc",
                    func: "extract-code",
                    to: "translation",
                    param: "text",
                    index: "0"
                  },
                  {
                    condition: "{{translation}} =",
                    type: "calc",
                    func: "set",
                    param: "translation",
                    format: "text",
                    value: "{{text}}"
                  },
                  {
                    label: "TRANSLATE MENU",
                    type: "ask",
                    param: "menu",
                    message: "",
                    options: [
                      { label: "\u2705 DONE", value: "done" },
                      { label: "\u2B07\uFE0F PASTE TO PAGE", value: "paste" },
                      { label: "\u23F8 SIDE BY SIDE", value: "parallel" },
                      { label: "\u{1F4DA} EXPLAIN", value: "explain" },
                      { label: "\u{1F9D9}\u200D\u2642\uFE0F LANGUAGE WIZARD", value: "wizard" },
                      "$custom"
                    ],
                    default: "",
                    optionsInvalid: false
                  },
                  { condition: "{{menu}} = done", type: "stop" },
                  {
                    condition: "{{menu}} = paste",
                    label: "PASTE TO PAGE",
                    type: "group",
                    steps: [
                      {
                        type: "paste",
                        text: "{{text}}",
                        mode: null,
                        selectorType: "ai",
                        selector: null,
                        item: null,
                        silent: true,
                        close: false
                      },
                      { type: "control", action: "hide" },
                      { type: "stop" }
                    ]
                  },
                  {
                    condition: "{{menu}} = parallel",
                    label: "SIDE BY SIDE",
                    type: "gpt",
                    prompt: 'I want you to modify your translation by reformatting it into a markdown table:\n- The table should have 2 columns. In the first row, put the original language in the left column (e.g.: Korean), and the translation language in in the right column (e.g: {{language}}).\n- Split the source text into sentences. Starting from the second row of the table, put the first sentence in the first column, and its translation in the second column. Continue this format until the text ends.\n- Do not write any additional general phrases, notes, or any other explanations of the translation.\n- Do not wrap table into code block.\n\nYour translation to {{language}}: "{{translation}}"\n\nMARKDOWN TABLE:',
                    param: "gpt"
                  },
                  {
                    condition: "{{menu}} = explain",
                    label: "EXPLAIN TRANSLATION",
                    type: "gpt",
                    prompt: "Please ignore all previous instructions. Act as a professional {{language}} teacher and grammar expert.\n\nI want you to briefly explain the main grammar rules applied in {{language}} in bullet points, so that I understand how you performed the translation.\n- For example, if you used a word in the plural, indicate how the word formation occurs. If you used a verb in the past tense, say what it is in the infinitive form and so on.\n- Do not echo my prompt\n\nStrictly follow the output format:\n\n**Translation to {{language}}:**\n\n```markdown\n{{translation}}\n```\n\n**Explanation:**\n- ...\n\n\n[Explanation of the translation]:\n",
                    param: "gpt"
                  },
                  {
                    condition: "{{menu-option}} = $custom",
                    type: "gpt",
                    prompt: "{{menu}}",
                    param: "gpt"
                  },
                  {
                    condition: "{{menu}} = wizard",
                    label: "LANGUAGE WIZARD",
                    type: "group",
                    steps: [
                      { type: "command", name: "Language Wizard", inputs: [] },
                      { type: "stop" }
                    ]
                  },
                  { type: "jump", to: "TRANSLATE MENU" }
                ]
              },
              {
                condition: "{{menu}} = extract",
                label: "EXTRACT",
                type: "group",
                steps: [
                  {
                    type: "gpt",
                    prompt: "You are a universal OCR assistant capable of analyzing images.\n\nYour task is to analyze the screenshot I've provided, find the main text portion in it, and extract the text:\n- If you see any text in the image that doesn't belong to the main content (like website buttons), ignore that text and only transcribe the main text.\n- Try to imitate all markdown features of the text. If you see a heading, indicate it in the text; if bold or italic styles are present, reproduce them with markdown.\n- If you see a table in the screenshot, your task is to write a response with a markdown table.\n- Do not echo my command.\n- Do not show the rewritten text within quotation marks.\n\n[Find the text in a screenshot]: {{image}}\n\nEXTRACTED TEXT FROM THE IMAGE:",
                    isolated: true,
                    param: "text"
                  },
                  {
                    type: "ask",
                    param: "menu",
                    message: "",
                    options: [
                      { label: "\u2705 DONE", value: "done" },
                      { label: "\u2B07\uFE0F PASTE TO PAGE", value: "paste" },
                      "$custom"
                    ],
                    default: "",
                    optionsInvalid: false
                  },
                  { condition: "{{menu}} = done", type: "stop" },
                  {
                    condition: "{{menu}} = paste",
                    label: "PASTE TO PAGE",
                    type: "group",
                    steps: [
                      {
                        type: "paste",
                        text: "{{text}}",
                        mode: null,
                        selectorType: "ai",
                        selector: null,
                        item: null,
                        silent: true,
                        close: false
                      },
                      { type: "control", action: "hide" },
                      { type: "stop" }
                    ]
                  },
                  { type: "gpt", prompt: "{{menu}}", param: "gpt" }
                ]
              },
              {
                condition: [
                  "{{menu}} = reply",
                  "{{menu}} = rewrite",
                  "{{menu}} = autocomplete"
                ],
                label: "COMPUTE TONE",
                type: "group",
                steps: [
                  {
                    condition: "{{tone}} !=",
                    type: "calc",
                    func: "set",
                    param: "tone-instruction",
                    value: "- Please pretend to be me, mimicking my style of communication: {{tone}}"
                  },
                  {
                    condition: "{{tone}} =",
                    type: "calc",
                    func: "set",
                    param: "tone-instruction",
                    value: ""
                  },
                  {
                    condition: "{{userinfo}} !=",
                    type: "calc",
                    func: "set",
                    param: "userinfo-instruction",
                    value: "- Here are also some facts for context: {{userinfo}}"
                  },
                  {
                    condition: "{{userinfo}} =",
                    type: "calc",
                    func: "set",
                    param: "userinfo-instruction",
                    value: ""
                  }
                ]
              },
              {
                condition: "{{menu}} = reply",
                label: "REPLY",
                type: "group",
                steps: [
                  {
                    label: "HOW TO REPLY",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "how",
                        message: "How to reply? Pick an option or type instructions.",
                        options: [
                          { label: "AUTO", value: "None" },
                          {
                            label: "\u{1F44D} AGREE",
                            value: "Reply with an agreement."
                          },
                          {
                            label: "\u{1F44E} DISAGREE",
                            value: "Reply with a disagreement."
                          },
                          {
                            label: "\u{1F64C} ACKNOWLEDGE",
                            value: "Acknowledge the message info."
                          },
                          {
                            label: "\u{1F914} ASK TO CLARIFY",
                            value: "Request to clarify the message."
                          },
                          {
                            label: "\u{1F937}\u200D\uFE0F ASK FOR INFO",
                            value: "Request to provide more information."
                          },
                          { label: "\u2753 QUESTION", value: "Ask a question." },
                          { label: "\u{1F9D0} SUGGEST", value: "Provide a suggestion." },
                          {
                            label: "\u{1F4AF} PRAISE",
                            value: "Praise the message author."
                          },
                          {
                            label: "\u{1F917} EMPATHY",
                            value: "Emphasize with the message author."
                          },
                          {
                            label: "\u{1F91E} SUPPORT",
                            value: "Support the message author."
                          },
                          {
                            label: "\u{1F4AA} ENCOURAGE",
                            value: "Encourage the message author."
                          },
                          {
                            label: "\u{1F928} CRITICIZE",
                            value: "Criticise the message."
                          },
                          {
                            label: "\u{1F64F} APOLOGIZE",
                            value: "Apologise to the message author."
                          },
                          {
                            label: "\u{1F4A1} IDEA",
                            value: "Come up with a relevant idea."
                          },
                          { label: "\u{1F602} JOKE", value: "Write a relevant joke." },
                          { value: "$custom" }
                        ],
                        default: "",
                        optionsInvalid: false
                      }
                    ]
                  },
                  {
                    type: "gpt",
                    prompt: "You are a universal writing assistant capable of analyzing images.\n\nYour task is to analyze the screenshot I've provided and write a REPLY for me to the source message.\nInstructions:\n- Your REPLY must be in a single ```markdown code block```.\n- Your REPLY must be appropriate for the style of communication on {{domain}} website.\n- Your REPLY must be in the language of the source message.\n- Do not echo my command or parameters. Only provide a REPLY.\n{{tone-instruction}}\n{{userinfo-instruction}}\n\n[Output framework]:\n\n```markdown\ntext\n```\n\n[Additional instructions / reply should contain if any]: {{how}}\n\n[Find the source message in a screenshot]: {{image}}\n\nYOUR RESPONSE:",
                    isolated: true,
                    param: "reply"
                  },
                  {
                    label: "REPLY - ASK FOR CHANGE",
                    type: "ask",
                    param: "change",
                    message: "",
                    options: [
                      { label: "\u2705 DONE", value: "no" },
                      { label: "\u2328\uFE0F PASTE TO PAGE", value: "paste" },
                      {
                        label: "\u2B07\uFE0F SHORTEN",
                        value: "Shorten your reply, make it concise and to the point. Remove stock and boilerplate phrases if any.\n"
                      },
                      {
                        label: "\u{1F92A} SIMPLIFY",
                        value: "Simplify reply language, add clarity and conciseness, remove jargon.\n"
                      },
                      {
                        label: "\u{1F974} HUMANIZE",
                        value: 'Perform text "Humanization". Please rewrite each sentence, increasing its perplexity and burstiness. Perplexity measures the complexity of text. Separately, burstiness compares the variations of sentences. Humans tend to write with greater burstiness, for example, with some longer or complex sentences alongside shorter ones. AI sentences tend to be more uniform. I need it to have a good amount of perplexity and burstiness. Rewrite changing 50% in nouns and verbs for similar ones and rewrite verb usages to add natural sounding variations in complexity but retain the same tense and overall meaning. Randomly use simple and complicated verbs, combine long and short sentences and rewrite the above text so that it is not detected as AI content by AI content detectors.'
                      },
                      { label: "\u{1F379} CASUAL", value: "Change tone to casual." },
                      {
                        label: "\u{1F4BC} PROFESSIONAL",
                        value: "Change tone to professional and straightforward."
                      },
                      { label: "\u{1F30D} TRANSLATE", value: "translate" },
                      {
                        label: "\u270D\uFE0F SIGNATURE",
                        value: "If reply contains a signature, remove it. If it does not contain a signature, add it."
                      },
                      {
                        label: "\u{1F4CC}\u200D\uFE0F BULLET POINTS",
                        value: "Add bullet points and/or other formatting elements for readability such as headings and subheadings, where applicable."
                      },
                      { value: "$custom" }
                    ],
                    default: "",
                    optionsInvalid: false
                  },
                  { condition: "{{change}} = no", type: "stop" },
                  {
                    condition: "{{change}} = paste",
                    label: "PASTE TO PAGE",
                    type: "group",
                    steps: [
                      {
                        type: "calc",
                        func: "extract-code",
                        to: "extracted",
                        param: "reply",
                        index: "0"
                      },
                      {
                        condition: "{{extracted}} =",
                        type: "calc",
                        func: "set",
                        param: "extracted",
                        format: "text",
                        value: "{{gpt}}"
                      },
                      {
                        type: "paste",
                        text: "{{extracted}}",
                        mode: null,
                        selectorType: "ai",
                        selector: null,
                        item: null,
                        silent: true,
                        close: false
                      },
                      { type: "control", action: "hide" },
                      { type: "stop" }
                    ]
                  },
                  {
                    condition: "{{change}} = translate",
                    label: "TRANSLATE",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "lang",
                        message: "\u{1F30D} Which language to translate to?",
                        options: null,
                        default: ""
                      },
                      {
                        type: "calc",
                        func: "set",
                        param: "change",
                        format: "",
                        value: "Translate to {{lang}}."
                      }
                    ]
                  },
                  {
                    label: "APPLY CHANGES",
                    type: "group",
                    steps: [
                      {
                        type: "gpt",
                        prompt: "I would like you to make changes to the reply you have just written. Please do not output anything but the new, revised reply in a ```markdown code block```. Do not echo my command. Do not put quotes around the rewritten reply.\n\n[CHANGES TO MAKE]:\n{{change}}\n\n[PREVIOUS REPLY]:\n{{reply}}\n\nYOUR REWRITTEN REPLY:",
                        param: "gpt"
                      },
                      { type: "jump", to: "REPLY - ASK FOR CHANGE" }
                    ]
                  }
                ]
              },
              {
                condition: "{{menu}} = rewrite",
                label: "REWRITE",
                type: "group",
                steps: [
                  {
                    label: "HOW TO REWRITE",
                    type: "ask",
                    param: "instructions",
                    message: "How would you like me to rewrite the text? Pick an option or type instructions.",
                    options: [
                      { label: "\u2B06\uFE0F EXPAND", value: "Make text longer." },
                      {
                        label: "\u2B07\uFE0F SHORTEN",
                        value: "Make text shorter. I want you to halve the length of the text, keeping only the most essential information and nothing more."
                      },
                      {
                        label: "\u{1F520} FIX GRAMMAR",
                        value: "Output the text as is, but fix spelling errors if the text contains them."
                      },
                      {
                        label: "\u{1F6E0}\uFE0F\u200D\uFE0F REFINE",
                        value: "Improve sentences structure and flow, as well as coherence and relevance by adding or removing information, but try to keep to the text length. Add headings, subheadings, bullet points, and other formatting elements for readability."
                      },
                      {
                        label: "\u{1F3AD} MIMIC MY TONE",
                        value: "Please pretend to be me, mimicking my style of communication: {{tone}}"
                      },
                      {
                        label: "\u{1F92A} SIMPLIFY",
                        value: "Simplify text language. Avoid using scientific or any specialized terminology unless necessary."
                      },
                      {
                        label: "\u{1F4BC} PROFESSIONAL",
                        value: "Change tone to professional. Use professional vocabulary and write like an expert in the relevant field. The text should sound confident and demonstrate your competence."
                      },
                      {
                        label: "\u{1F50D} CLARITY",
                        value: "Change tone to straightforward. Text should be direct, clear, and not ambiguous."
                      },
                      {
                        label: "\u{1F917} WELCOMING",
                        value: "Change the text style to be more approachable and relaxed, capturing a casual and friendly tone."
                      },
                      {
                        label: "\u{1F4CC}\u200D\uFE0F ADD HEADINGS",
                        value: "Add headings, subheadings, bullet points, and other formatting elements for readability."
                      },
                      {
                        label: "\u{1F4DA} STORY",
                        value: "Change style to storytelling."
                      },
                      {
                        label: "\u{1F464} 1ST PERSON",
                        value: "Change style to 1st person."
                      },
                      {
                        label: "\u{1F575}\uFE0F\u200D\uFE0F 3RD PERSON",
                        value: "Change style to 3rd person."
                      },
                      {
                        label: "\u{1F3A8}\u200D\uFE0F ILLUSTRATE",
                        value: "Add examples, anecdotes, and other storytelling elements to illustrate points."
                      },
                      {
                        label: "\u{1F393}\u200D\uFE0F ENRICH",
                        value: "Enhance vocabulary and tone."
                      },
                      {
                        label: "\u{1F974} HUMANIZE",
                        value: 'I want you to perform text "Humanization". Please rewrite each sentence, increasing its perplexity and burstiness. Perplexity measures the complexity of text. Separately, burstiness compares the variations of sentences. Humans tend to write with greater burstiness, for example, with some longer or complex sentences alongside shorter ones. AI sentences tend to be more uniform. I need it to have a good amount of perplexity and burstiness. Rewrite changing 50% in nouns and verbs for similar ones and rewrite verb usages to add natural sounding variations in complexity but retain the same tense and overall meaning. Randomly use simple and complicated verbs, combine long and short sentences and rewrite the above text so that it is not detected as AI content by AI content detectors.'
                      },
                      { value: "$custom" }
                    ],
                    default: "",
                    optionsInvalid: false
                  },
                  {
                    type: "gpt",
                    prompt: "You are a universal writing assistant capable of analyzing images.\n\nYour task is to analyze the screenshot I've provided, find the main text portion in it, and rewrite or improve the text for me.\n\nInstructions:\n- If you see any text in the image that doesn't belong to the main content (like website buttons or other elements), ignore that text and only transcribe the main text.\n- Please only answer in {{language}}.\n- Do not echo my command.\n- Do not show the rewritten text within quotation marks.\n\n[HOW TO REWRITE THE TEXT]:\n{{instructions}}\n\n[Find the text in a screenshot]: {{image}}\n\nYOUR RESPONSE:",
                    isolated: true,
                    param: "text"
                  },
                  {
                    label: "REWRITE - ASK FOR CHANGE",
                    type: "ask",
                    param: "change",
                    message: "",
                    options: [
                      { label: "\u2705 DONE", value: "no" },
                      { label: "\u2328\uFE0F PASTE TO PAGE", value: "paste" },
                      { label: "\u2B06\uFE0F EXPAND", value: "Make text longer." },
                      {
                        label: "\u2B07\uFE0F SHORTEN",
                        value: "Make text shorter. I want you to halve the length of the text, keeping only the most essential information and nothing more."
                      },
                      {
                        label: "\u{1F520} FIX GRAMMAR",
                        value: "Output the text as is, but fix spelling errors if the text contains them."
                      },
                      {
                        label: "\u{1F6E0}\uFE0F\u200D\uFE0F REFINE",
                        value: "Improve sentences structure and flow, as well as coherence and relevance by adding or removing information, but try to keep to the text length. Add headings, subheadings, bullet points, and other formatting elements for readability."
                      },
                      {
                        label: "\u{1F3AD} MIMIC MY TONE",
                        value: "Please pretend to be me, mimicking my style of communication: {{tone}}"
                      },
                      {
                        label: "\u{1F92A} SIMPLIFY",
                        value: "Simplify text language. Avoid using scientific or any specialized terminology unless necessary."
                      },
                      {
                        label: "\u{1F4BC} PROFESSIONAL",
                        value: "Change tone to professional. Use professional vocabulary and write like an expert in the relevant field. The text should sound confident and demonstrate your competence."
                      },
                      {
                        label: "\u{1F50D} CLARITY",
                        value: "Change tone to straightforward. Text should be direct, clear, and not ambiguous."
                      },
                      {
                        label: "\u{1F917} WELCOMING",
                        value: "Change the text style to be more approachable and relaxed, capturing a casual and friendly tone."
                      },
                      {
                        label: "\u{1F4CC}\u200D\uFE0F ADD HEADINGS",
                        value: "Add headings, subheadings, bullet points, and other formatting elements for readability."
                      },
                      {
                        label: "\u{1F4DA} STORY",
                        value: "Change style to storytelling."
                      },
                      {
                        label: "\u{1F464} 1ST PERSON",
                        value: "Change style to 1st person."
                      },
                      {
                        label: "\u{1F575}\uFE0F\u200D\uFE0F 3RD PERSON",
                        value: "Change style to 3rd person."
                      },
                      {
                        label: "\u{1F3A8}\u200D\uFE0F ILLUSTRATE",
                        value: "Add examples, anecdotes, and other storytelling elements to illustrate points."
                      },
                      {
                        label: "\u{1F393}\u200D\uFE0F ENRICH",
                        value: "Enhance vocabulary and tone."
                      },
                      {
                        label: "\u{1F974} HUMANIZE",
                        value: 'I want you to perform text "Humanization". Please rewrite each sentence, increasing its perplexity and burstiness. Perplexity measures the complexity of text. Separately, burstiness compares the variations of sentences. Humans tend to write with greater burstiness, for example, with some longer or complex sentences alongside shorter ones. AI sentences tend to be more uniform. I need it to have a good amount of perplexity and burstiness. Rewrite changing 50% in nouns and verbs for similar ones and rewrite verb usages to add natural sounding variations in complexity but retain the same tense and overall meaning. Randomly use simple and complicated verbs, combine long and short sentences and rewrite the above text so that it is not detected as AI content by AI content detectors.'
                      },
                      { value: "$custom" }
                    ],
                    default: "",
                    optionsInvalid: false
                  },
                  { condition: "{{change}} = no", type: "stop" },
                  {
                    condition: "{{change}} = paste",
                    label: "PASTE TO PAGE",
                    type: "group",
                    steps: [
                      {
                        type: "paste",
                        text: "{{text}}",
                        mode: null,
                        selectorType: "ai",
                        selector: null,
                        item: null,
                        silent: true,
                        close: false
                      },
                      { type: "control", action: "hide" },
                      { type: "stop" }
                    ]
                  },
                  {
                    type: "gpt",
                    prompt: "I would like you to make changes in {{language}} to the new text you have just written.\n- Please do not output anything but the revised text. Do not echo my command.\n- Do not put quotes around the revised text.\n\n[CHANGES TO MAKE]:\n{{change}}\n\n[NEW TEXT]:",
                    param: "gpt"
                  },
                  { type: "jump", to: "REWRITE - ASK FOR CHANGE" }
                ]
              },
              {
                condition: "{{menu}} = autocomplete",
                label: "AUTOCOMPLETE",
                type: "group",
                steps: [
                  {
                    type: "calc",
                    func: "set",
                    param: "context",
                    format: "",
                    value: "{{email}}"
                  },
                  {
                    condition: "{{context}} =",
                    type: "calc",
                    func: "set",
                    param: "context",
                    format: "",
                    value: "{{page}}"
                  },
                  {
                    type: "gpt",
                    prompt: 'Act as a professional virtual assistant capable of analyzing images, who speaks {{language}} fluently.\n\nYour task is to analyze the screenshot I\'ve provided, locate the email or reply draft and its context, then rewrite it into a finished reply for me. Expand, improve, and refine my draft or idea.\n\nWrite a reply that aligns with "{{domain}}" website purpose, for instance:\n- For GMail or similar: expand my draft into an email. Include greetings and a signature if you have information about me. Do not write a subject.\n- For Twitter: expand draft into a tweet. Omit signatures and greetings.\n\nFollow the instructions:\n- Your reply text should be concise and clear.\n- Reply should be in a single ```markdown code block```.\n- Avoid hallucinating facts, adding new information or giving promises.\n- Provide only the expanded draft without extra comments or my original prompt.\n{{tone-instruction}}\n{{userinfo-instruction}}\n\n[Find the reply or draft idea in a screenshot]: {{image}}\n\n[CONTEXT FROM "{{domain}}"]:\n{{context}}\n\n[REPLY FORMAT]:\n```markdown\n...\n```\n\n-----\n\n[REPLY IN A SINGLE CODE BLOCK]:',
                    isolated: true,
                    param: "reply"
                  },
                  {
                    label: "FINISH - ASK FOR CHANGE",
                    type: "ask",
                    param: "change",
                    message: "\u{1F4AC} Change the text further? Press Enter to paste back to page, or Escape to abort.",
                    options: [
                      { label: "\u2328\uFE0F PASTE TO PAGE", value: "paste" },
                      { label: "\u2705 DONE", value: "no" },
                      { label: "\u{1F53C} EXPAND", value: "Make the reply longer." },
                      { label: "\u{1F53D} SHORTEN", value: "Make the reply shorter." },
                      "$custom"
                    ],
                    default: "",
                    optionsInvalid: false
                  },
                  {
                    condition: "{{change}} = paste",
                    label: "PASTE TO PAGE",
                    type: "group",
                    steps: [
                      {
                        type: "calc",
                        func: "extract-code",
                        to: "extracted",
                        param: "reply",
                        index: "0"
                      },
                      {
                        condition: "{{extracted}} =",
                        type: "calc",
                        func: "set",
                        param: "extracted",
                        format: "text",
                        value: "{{gpt}}"
                      },
                      {
                        type: "paste",
                        text: "{{extracted}}",
                        mode: null,
                        selectorType: "ai",
                        selector: null,
                        item: null,
                        silent: true,
                        close: false
                      },
                      { type: "control", action: "hide" },
                      { type: "stop" }
                    ]
                  },
                  { condition: "{{change}} = no", type: "stop" },
                  {
                    type: "gpt",
                    prompt: "I would like you to make changes in {{language}} to the new text you have just written.\n- Please do not output anything but the revised text. Do not echo my command.\n- Do not put quotes around the revised text.\n\n[CHANGES TO MAKE]:\n{{change}}\n\n[NEW TEXT]:",
                    param: "gpt"
                  },
                  { type: "jump", to: "FINISH - ASK FOR CHANGE" }
                ]
              },
              {
                condition: "{{menu}} = repurpose",
                label: "REPURPOSE",
                type: "group",
                steps: [
                  {
                    label: "HOW TO REPURPOSE",
                    type: "ask",
                    param: "action",
                    message: "How would you like me to repurpose the image? Pick an option or type instructions.",
                    options: [
                      { label: "\u{1F58A} BLOG POST", value: "blogpost" },
                      { label: "\u{1F4DD} ARTICLE", value: "article" },
                      { label: "\u{1F426} TWEET", value: "tweet" },
                      { label: "\u{1F3A8} MJ PROMPT", value: "midjourney" },
                      { value: "$custom" }
                    ],
                    default: "",
                    optionsInvalid: false
                  },
                  {
                    condition: "{{action}} = blogpost",
                    label: "BLOG POST",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "instructions",
                        message: "",
                        options: [
                          {
                            label: "\u2B06\uFE0F LONG",
                            value: "I need a long blog post, do not limit yourself by the word number.\n"
                          },
                          {
                            label: "\u2B07\uFE0F SHORT",
                            value: "The blog post must be short and concise, not exceeding 150 words. The short length ensures that the content remains engaging and easily digestible, aligning with the need for brief, yet informative content.\n"
                          }
                        ],
                        default: "",
                        optionsInvalid: false
                      },
                      {
                        type: "gpt",
                        prompt: "Act as a professional blogger capable of analyzing images.\n\nYour task is to analyze the screenshot I've provided, find the main idea, key points or any kind of a useful content, and and write a blog post in {{language}} based on the screenshot.\n\n[INSTRUCTIONS]: {{instructions}}\n\n- If you see any text in the image that doesn't belong to the main content (like website buttons or other elements), ignore that text and only use the main part.\n- Do not echo my command.\n\nCome up with a title for this blog post at the beginning, a meta description, and hashtags at the end. The content must be well-researched and provide valuable insights, opinions, or advice related to the subject.\n\n--- Output format:\n## Blog post title\nBlog post text\n\n### Meta description:\nMeta description\n\n### HASHTAGS:\n10 relevant hashtags with #, comma separated\n\nFormat the text using headings (H2, H3, H4), numbered and bullet points, and other markdown formatting features.\n\n[Find the context/idea/info in a screenshot]: {{image}}\n\n[BLOG POST IN {{language}}]:",
                        isolated: true,
                        param: "gpt"
                      },
                      { type: "jump", to: "REPURPOSE OPTIONS" }
                    ]
                  },
                  {
                    condition: "{{action}} = tweet",
                    label: "TWEET",
                    type: "group",
                    steps: [
                      {
                        type: "gpt",
                        prompt: "Act as a social media content creator capable of analyzing images.\nYour task is to analyze the screenshot I've provided, find the main idea, key points or any kind of a usefull content, and compose 3 different tweets in {{language}} related to the data.\n\nINSTRUCTIONS:\n- If you see any text in the image that doesn't belong to the main content (like website buttons or other elements), ignore that text and only use the main part.\n- Tweets should convey insights, opinions, or details pertaining to the subject. Ensure the content is engaging and tailored to its potential target audience.\n- Do not echo my command.\n\nKeep in mind that the tweets should be different according to my instructions:\n- The first one should have 1 emoji and no hashtags.\n- The second should have hashtags and no emoji.\n- The third should have both an emoji and hashtags.\n\nEvery TWEET should have a title and a markdown code block with the tweet itself, enclosed into code-block quotes.\n\n\n[EXAMPLE OF A SINGLE TWEET]:\n\n**Tweet #1**\n```markdown\ntweet\n```\n\n[Find the content/idea/info in a screenshot]: {{image}}\n\n\n3 TWEETS in {{language}}:",
                        isolated: true,
                        param: "gpt"
                      },
                      { type: "jump", to: "REPURPOSE OPTIONS" }
                    ]
                  },
                  {
                    condition: "{{action}} = article",
                    label: "ARTICLE",
                    type: "group",
                    steps: [
                      {
                        type: "gpt",
                        prompt: "Act as a professional SEO and Copywriter capable of analyzing images.\n\nYour task is to analyze the provided image and transform it into a textual description based on the following instructions:\n- Identify the main idea, key points, or any useful content, and generate valuable textual content as a foundation for writing an article.\n- If you see any text in the image that doesn't belong to the main content (such as website buttons or other elements), ignore that text and focus only on the primary content.\n- If the image doesn't contain text but shows an object, scene, or concept, provide a detailed description and highlight all important details that would help in writing an article.\n- Do not repeat these instructions in your response.\n\n[Analyze this screenshot]: {{image}}\n\n[CONTENT FOR ARTICLE]:",
                        isolated: true,
                        param: "context"
                      },
                      {
                        type: "command",
                        name: "Article creator",
                        inputs: [
                          "Entire Article",
                          "Generate Outline",
                          "{{context}}"
                        ]
                      },
                      { type: "stop" }
                    ]
                  },
                  {
                    condition: "{{action}} = midjourney",
                    label: "MJ PROMPT",
                    type: "group",
                    steps: [
                      {
                        type: "gpt",
                        prompt: "Act as a professional AI assistant capable of analyzing images.\n\nYour task is to analyze the provided image and create a concise textual description based on the following instructions:\n\n- Identify the main elements, key visual features, and overall style of the image.\n- Generate a brief but comprehensive description suitable for a Midjourney image generation prompt.\n- Focus only on the primary content, ignoring any irrelevant text or interface elements.\n- Highlight important details including subject matter, composition, lighting, colors, and artistic style.\n- Ensure the description captures both the content and aesthetic qualities of the image.\n- Provide a concise response that covers all essential aspects without repeating these instructions.\n\n[Analyze this screenshot]: {{image}}\n\n[BRIEF IMAGE DESCRIPTION FOR A MIDJOURNEY PROMPT]:",
                        isolated: true,
                        param: "description"
                      },
                      {
                        type: "command",
                        name: "Midjourney prompt wizard",
                        inputs: ["QUICK", "{{description}}"]
                      },
                      { type: "stop" }
                    ]
                  },
                  {
                    label: "REPURPOSE OPTIONS",
                    type: "ask",
                    param: "change",
                    message: "",
                    options: [
                      { label: "\u2705 DONE", value: "no" },
                      { label: "\u2734\uFE0F REFINE", value: "refine" },
                      { value: "$custom" }
                    ],
                    default: "",
                    optionsInvalid: false
                  },
                  { condition: "{{change}} = no", type: "stop" },
                  {
                    condition: "{{change}} = refine",
                    label: "REFINE",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "change",
                        message: "What changes would you like me to make?",
                        options: null,
                        default: ""
                      }
                    ]
                  },
                  {
                    type: "gpt",
                    prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS]. Provide a rewritten response.\n\nIf I've given any other task in ADDITIONAL INSTRUCTIONS, perform it to the best of your ability.\n\n[ADDITIONAL INSTRUCTIONS]: {{change}}\n\n[YOUR RESPONSE]:",
                    isolated: true,
                    param: "gpt"
                  },
                  {
                    condition: "{{change}} = refine",
                    type: "jump",
                    to: "REPURPOSE OPTIONS"
                  }
                ]
              },
              {
                condition: "{{menu-option}} = $custom",
                label: "CUSTOM",
                type: "group",
                steps: [
                  {
                    type: "gpt",
                    prompt: "You are a universal assistant capable of analyzing images, correcting errors in text, code, or logic, and performing various other tasks.\n\nYour responses should be concise, clear, and in {{language}}.\n\nPlease analyze the provided image and complete the following task: {{menu}}\n\n[Screenshot for analysis]: {{image}}\n\nYOUR RESPONSE:",
                    param: "gpt"
                  },
                  {
                    label: "MENU - CUSTOM",
                    type: "ask",
                    param: "next",
                    message: "",
                    options: [
                      { label: "\u23ED\uFE0F NEXT QUESTION", value: "next" },
                      { label: "\u2753 ASK FOLLOW UP", value: "ask" },
                      "$custom"
                    ],
                    default: "",
                    optionsInvalid: false
                  },
                  {
                    condition: "{{next}} = next",
                    type: "jump",
                    to: "ASK FOR IMAGE"
                  },
                  {
                    condition: "{{next}} != next",
                    label: "CUSTOM OR ASK",
                    type: "group",
                    steps: [
                      {
                        condition: "{{next}} = ask",
                        type: "ask",
                        param: "next",
                        message: "\u{1F4AC} Type your follow-up question.",
                        options: null,
                        default: ""
                      },
                      { type: "gpt", prompt: "{{next}}", param: "gpt" },
                      { type: "jump", to: "MENU - CUSTOM" }
                    ]
                  }
                ]
              }
            ]
          },
          {
            meta: {
              name: "reply",
              title: "Reply",
              category: "Productivity",
              description: "Draft a reply in your tone of voice.",
              emoji: "\u{1F4E9}",
              apps: "GMail"
            },
            steps: [
              {
                label: "INSTRUCTIONS",
                type: "group",
                steps: [
                  {
                    condition: "{{selection}} != \u2014",
                    type: "ask",
                    message: "Sure! What to reply to?",
                    param: "source",
                    options: [
                      { label: "SELECTED TEXT", value: "{{selection}}" },
                      { label: "FIND ON PAGE", value: "find-on-page" },
                      { value: "$custom" }
                    ]
                  },
                  {
                    condition: "{{selection}} = \u2014",
                    type: "ask",
                    message: "Sure! What to reply to?",
                    param: "source",
                    options: [
                      { label: "FIND ON PAGE", value: "find-on-page" },
                      { value: "$custom" }
                    ]
                  },
                  {
                    type: "ask",
                    message: "How to reply? Type instructions or pick an option. I will try to mimic your reply tone if set in the App Settings.\n",
                    param: "how",
                    options: [
                      { label: "AUTO", value: "None" },
                      { label: "\u{1F44D} AGREE", value: "Reply with an agreement." },
                      {
                        label: "\u{1F44E} DISAGREE",
                        value: "Reply with a disagreement."
                      },
                      {
                        label: "\u{1F64C} ACKNOWLEDGE",
                        value: "Acknowledge the message info."
                      },
                      { label: "\u2753 QUESTION", value: "Ask a question." },
                      {
                        label: "\u{1F914} CLARIFY",
                        value: "Request to clarify the message."
                      },
                      {
                        label: "\u{1F937}\u200D\uFE0F ASK FOR INFO",
                        value: "Request to provide more information."
                      },
                      { label: "\u{1F9D0} SUGGEST", value: "Provide a suggestion." },
                      { label: "\u{1F4AF} PRAISE", value: "Praise the message author." },
                      {
                        label: "\u{1F917} EMPATHY",
                        value: "Emphasize with the message author."
                      },
                      {
                        label: "\u{1F91E} SUPPORT",
                        value: "Support the message author."
                      },
                      {
                        label: "\u{1F4AA} ENCOURAGE",
                        value: "Encourage the message author."
                      },
                      { label: "\u{1F928} CRITICIZE", value: "Criticise the message." },
                      {
                        label: "\u{1F64F} APOLOGY",
                        value: "Apologise to the message author."
                      },
                      {
                        label: "\u{1F4A1} IDEA",
                        value: "Come up with a relevant idea."
                      },
                      { label: "\u{1F602} JOKE", value: "Write a relevant joke." },
                      { value: "$custom" }
                    ],
                    label: "ASK FOR STYLE"
                  }
                ]
              },
              {
                label: "COMPUTE TONE",
                type: "group",
                steps: [
                  {
                    condition: "{{tone}} !=",
                    type: "calc",
                    func: "set",
                    param: "tone-instruction",
                    value: "- Please pretend to be me, mimicking my style of communication: {{tone}}"
                  },
                  {
                    condition: "{{tone}} =",
                    type: "calc",
                    func: "set",
                    param: "tone-instruction",
                    value: ""
                  },
                  {
                    condition: "{{userinfo}} !=",
                    type: "calc",
                    func: "set",
                    param: "userinfo-instruction",
                    value: "- Here are also some facts for context: {{userinfo}}"
                  },
                  {
                    condition: "{{userinfo}} =",
                    type: "calc",
                    func: "set",
                    param: "userinfo-instruction",
                    value: ""
                  }
                ]
              },
              {
                condition: [
                  "{{url}} =~ ^(https?:\\/\\/)?(mail\\.google\\.com\\/.*|outlook\\.live\\.com\\/mail\\/.*|mail\\.proton\\.me|mail\\.aol\\.com|mail\\.com|mail\\.yahoo\\.com|hushmail\\.com|mailfence\\.com|app\\.fastmail\\.com|mailjet\\.com|icloud\\.com\\/mail)(\\/[^\\s]*)?",
                  "{{email}} !="
                ],
                label: "EMAIL REPLY",
                type: "group",
                steps: [
                  {
                    type: "calc",
                    func: "set",
                    param: "source",
                    value: "{{email}}"
                  },
                  {
                    condition: "{{source}} =",
                    type: "calc",
                    func: "set",
                    param: "source",
                    value: "{{page}}"
                  },
                  {
                    condition: "{{source}} !=",
                    type: "gpt",
                    prompt: "Please ignore previous instructions.\nPretend to be me and write an email reply from me to [ORIGINAL EMAIL].\n\nFollow the instructions:\n- Your email reply must be in a single ```markdown code block```.\n- Do not echo the [ORIGINAL EMAIL] in your comment.\n- Your email reply must be in the {{language}}.\n- Your email should be short and to the point.\n{{tone-instruction}}\n{{userinfo-instruction}}\n- [Additional instructions / reply should contain if any]: {{how}}\n\n-------\n[ORIGINAL EMAIL] and [EMAILS HISTORY]:\n{{source}}\n\n-------\nNEW EMAIL REPLY:",
                    param: "reply"
                  },
                  { type: "jump", to: "ASK FOR CHANGE" }
                ]
              },
              {
                label: "YT VIDEO PAGE",
                condition: "{{url}} =~ ^https:\\/\\/www\\.youtube\\.com\\/watch.*",
                type: "group",
                steps: [
                  {
                    condition: "{{source}} != find-on-page",
                    type: "gpt",
                    prompt: 'Please ignore previous instructions.\n\nWrite a comment on a YouTube video page to [ORIGINAL MESSAGE]: "{{source}}".\n\nFollow the instructions:\n- Do not echo the [ORIGINAL MESSAGE] in your comment.\n- Your comment must be in a single ```markdown code block```.\n- Your COMMENT must be in the {{language}}.\n- [Additional instructions / reply should contain if any]: {{how}}\n- Your comment should be short.\n{{tone-instruction}}\n{{userinfo-instruction}}\n\n[Output framework]:\n\n```markdown\nComment\n```\n\n-------\nFor context and to understand the subject matter, use the [YOUTUBE VIDEO TRANSCRIPT]:\n\n{{transcript}}\n\n\nNEW COMMENT :',
                    param: "reply"
                  },
                  {
                    condition: "{{source}} = find-on-page",
                    type: "gpt",
                    prompt: "Please ignore previous instructions.\n\nWrite a comment on a YouTube video page about the video.\n\nFollow the instructions:\n- Your comment should be short.\n- Your comment must be in a single ```markdown code block```.\n- Your comment must be in {{language}}.\n- [Additional instructions / reply should contain if any]: {{how}}\n{{tone-instruction}}\n{{userinfo-instruction}}\n\n[Output framework]:\n\n```markdown\nComment\n```\n\n-------\nFor context and to understand the subject matter, use the [YOUTUBE VIDEO TRANSCRIPT]:\n\n{{transcript}}\n\n\nNEW COMMENT:",
                    param: "reply"
                  },
                  { type: "jump", to: "ASK FOR CHANGE" }
                ]
              },
              {
                label: "GENERIC",
                type: "group",
                steps: [
                  {
                    type: "gpt",
                    prompt: "Please ignore previous instructions. Your new instructions:\n- I would like you to write a REPLY for me to the source message.\n- Your REPLY must be in a single ```markdown code block```.\n{{tone-instruction}}\n{{userinfo-instruction}}\n- Your REPLY must be appropriate for the style of communication on {{domain}} website.\n- Your REPLY must be in the {{language}}.\n- Do not echo my command or parameters. Only provide a REPLY.\n\n[Output framework]:\n\n```markdown\ntext\n```\n\n[Write a reply to this source message]: {{source}}\n\n[Additional instructions / reply should contain if any]: {{how}}\n\nYOUR REPLY:",
                    param: "reply",
                    condition: "{{source}} != find-on-page"
                  },
                  {
                    type: "gpt",
                    prompt: "Please ignore previous instructions. Your new instructions:\n- Write a REPLY to a message on a web page.\n- Your REPLY must be in a single ```markdown code block```.\n{{tone-instruction}}\n{{userinfo-instruction}}\n- Your REPLY must be appropriate for the style of communication on {{domain}} website.\n- Your REPLY must be in the {{language}}.\n- Do not echo my command or parameters. Only provide a REPLY.\n\n[Output framework]:\n\n```markdown\ntext\n```\n\n\n[Your reply should contain / Additional instructions if any]:\n{{how}}\n\n\n[Parse the source message to reply to from the web page content]:\n{{page}}\n\n\nYOUR REPLY :",
                    param: "reply",
                    condition: "{{source}} = find-on-page"
                  }
                ]
              },
              {
                label: "ASK FOR CHANGE",
                type: "ask",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2328\uFE0F PASTE TO PAGE", value: "paste" },
                  {
                    label: "\u2B06\uFE0F EXPAND",
                    value: "Expand your reply, adding more details and depth to it.\n"
                  },
                  {
                    label: "\u2B07\uFE0F SHORTEN",
                    value: "Shorten your reply, make it concise and to the point. Remove stock and boilerplate phrases if any.\n"
                  },
                  {
                    label: "\u{1F92A} SIMPLIFY",
                    value: "Simplify reply language, add clarity and conciseness, remove jargon.\n"
                  },
                  {
                    label: "\u{1F974} HUMANIZE",
                    value: 'Perform text "Humanization". Please rewrite each sentence, increasing its perplexity and burstiness. Perplexity measures the complexity of text. Separately, burstiness compares the variations of sentences. Humans tend to write with greater burstiness, for example, with some longer or complex sentences alongside shorter ones. AI sentences tend to be more uniform. I need it to have a good amount of perplexity and burstiness. Rewrite changing 50% in nouns and verbs for similar ones and rewrite verb usages to add natural sounding variations in complexity but retain the same tense and overall meaning. Randomly use simple and complicated verbs, combine long and short sentences and rewrite the above text so that it is not detected as AI content by AI content detectors.'
                  },
                  { label: "\u{1F379} CASUAL", value: "Change tone to casual." },
                  {
                    label: "\u{1F4BC} PROFESSIONAL",
                    value: "Change tone to professional and straightforward."
                  },
                  { label: "\u{1F30D} TRANSLATE", value: "translate" },
                  {
                    label: "\u270D\uFE0F SIGNATURE",
                    value: "If reply contains a signature, remove it. If it does not contain a signature, add it."
                  },
                  {
                    label: "\u{1F4CC}\u200D\uFE0F BULLET POINTS",
                    value: "Add bullet points and/or other formatting elements for readability such as headings and subheadings, where applicable."
                  },
                  { value: "$custom" }
                ]
              },
              { label: "NO CHANGES", condition: "{{change}} = no", type: "stop" },
              {
                label: "PASTE TO PAGE",
                condition: "{{change}} = paste",
                type: "group",
                steps: [
                  {
                    type: "calc",
                    func: "extract-code",
                    to: "extracted",
                    param: "reply",
                    index: "0"
                  },
                  {
                    condition: "{{extracted}} =",
                    type: "calc",
                    func: "set",
                    param: "extracted",
                    format: "",
                    value: "{{gpt}}"
                  },
                  { type: "paste", text: "{{extracted}}", close: false, silent: true },
                  { type: "control", action: "hide" },
                  { type: "stop" }
                ]
              },
              {
                label: "TRANSLATE",
                condition: "{{change}} = translate",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    param: "lang",
                    message: "\u{1F30D} Which language to translate to?\n"
                  },
                  {
                    type: "calc",
                    func: "set",
                    param: "change",
                    value: "Translate to {{lang}}."
                  }
                ]
              },
              {
                label: "APPLY CHANGES",
                type: "group",
                steps: [
                  {
                    type: "gpt",
                    param: "reply",
                    prompt: "I would like you to make changes to the reply you have just written. Please do not output anything but the new, revised reply in a ```markdown code block```. Do not echo my command. Do not put quotes around the rewritten reply.\n\n[CHANGES TO MAKE]:\n{{change}}\n\n[PREVIOUS REPLY]:\n{{reply}}\n\nYOUR REWRITTEN REPLY:"
                  },
                  { type: "jump", to: "ASK FOR CHANGE" }
                ]
              }
            ]
          },
          {
            meta: {
              name: "rewrite",
              title: "Rewrite",
              category: "Productivity",
              description: "Change or rewrite text in your tone of voice.",
              emoji: "\u{1F58D}\uFE0F",
              apps: "GMail"
            },
            steps: [
              {
                type: "ask",
                message: "Sure! What would you like me to rewrite?\n",
                param: "text",
                options: [
                  { label: "SELECTED TEXT", value: "{{selection}}" },
                  { label: "INPUT FORM", value: "{{input}}" },
                  { label: "PAGE CONTENT", value: "{{page}}" },
                  { label: "\u{1F4F8} CAPTURE AREA", value: "capture" },
                  { value: "$custom" }
                ],
                optionsInvalid: false
              },
              {
                condition: "{{text}} = capture",
                label: "CAPTURE AREA",
                type: "ask",
                message: "",
                param: "text",
                options: null,
                optionsInvalid: false,
                vision: {
                  enabled: true,
                  mode: "area",
                  hint: "Pick what to rewrite.",
                  send: true
                }
              },
              {
                condition: "{{text}} =",
                type: "group",
                steps: [
                  {
                    type: "say",
                    message: "Oops... I could not find text to rewrite or it is empty.\n"
                  },
                  { type: "stop" }
                ]
              },
              {
                type: "ask",
                message: "How would you like me to rewrite the text? Pick an option or type instructions.\n",
                param: "instructions",
                options: [
                  {
                    label: "\u2B06\uFE0F EXPAND",
                    value: "Make text longer, adding more details and depth to it."
                  },
                  {
                    label: "\u2B07\uFE0F SHORTEN",
                    value: "Make text shorter. I want you to halve the length of the text, keeping only the most essential information and nothing more."
                  },
                  {
                    label: "\u{1F520} FIX GRAMMAR",
                    value: "Output the text as is, but fix spelling errors if the text contains them."
                  },
                  {
                    label: "\u{1F6E0}\uFE0F\u200D\uFE0F REFINE",
                    value: "Improve sentences structure and flow, as well as coherence and relevance by adding or removing information, but try to keep to the text length."
                  },
                  {
                    label: "\u{1F3AD} MIMIC MY TONE",
                    value: "Please pretend to be me, mimicking my style of communication: {{tone}}"
                  },
                  { label: "\u267B\uFE0F REPURPOSE TEXT", value: "repurpose" },
                  { label: "\u{1F3AF} ADD KEYWORDS", value: "add-keywords" },
                  { label: "\u{1F9E9} WRITING FRAMEWORKS", value: "frameworks" },
                  {
                    label: "\u{1F30D} TRANSLATE",
                    value: "Translate to {{language}}, or echo text as is if already in {{language}}."
                  },
                  {
                    label: "\u{1F92A} SIMPLIFY",
                    value: "Simplify text language. Avoid using scientific or any specialized terminology unless necessary."
                  },
                  {
                    label: "\u{1F4BC} PROFESSIONAL",
                    value: "Change tone to professional. Use professional vocabulary and write like an expert in the relevant field. The text should sound confident and demonstrate your competence."
                  },
                  {
                    label: "\u{1F50D} CLARIFY",
                    value: "Change tone to straightforward. Text should be direct, clear, and not ambiguous."
                  },
                  {
                    label: "\u{1F917} WELCOMING",
                    value: "Change the text style to be more approachable and relaxed, capturing a casual and friendly tone."
                  },
                  {
                    label: "\u{1F4CC}\u200D\uFE0F ADD HEADINGS",
                    value: "Add headings, subheadings, bullet points, and other formatting elements for readability."
                  },
                  { label: "\u{1F4DA} STORY", value: "Change style to storytelling." },
                  {
                    label: "\u{1F3A8}\u200D\uFE0F ILLUSTRATE",
                    value: "Add examples, anecdotes, and other storytelling elements to illustrate points."
                  },
                  { label: "\u{1F393}\u200D\uFE0F ENRICH", value: "Enrich vocabulary and tone." },
                  {
                    label: "\u{1F974} HUMANIZE",
                    value: 'I want you to perform text "Humanization". Please rewrite each sentence, increasing its perplexity and burstiness. Perplexity measures the complexity of text. Separately, burstiness compares the variations of sentences. Humans tend to write with greater burstiness, for example, with some longer or complex sentences alongside shorter ones. AI sentences tend to be more uniform. I need it to have a good amount of perplexity and burstiness. Rewrite changing 50% in nouns and verbs for similar ones and rewrite verb usages to add natural sounding variations in complexity but retain the same tense and overall meaning. Randomly use simple and complicated verbs, combine long and short sentences and rewrite the above text so that it is not detected as AI content by AI content detectors.'
                  },
                  { value: "$custom" }
                ]
              },
              {
                condition: "{{instructions}} = add-keywords",
                type: "group",
                label: "ADD-KEYWORDS",
                steps: [
                  {
                    type: "ask",
                    message: "I can extract keywords from the SERP to improve your article's Google E-A-T score, or you can manually paste your keywords.\n",
                    param: "kw-option",
                    options: [
                      { label: "\u{1F50D} LSI KW FROM SERP", value: "serp" },
                      { label: "\u{1F4CC} PASTE MY KEYWORDS", value: "paste" }
                    ],
                    label: "KEYWORDS"
                  },
                  {
                    condition: "{{kw-option}} = serp",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        message: "Enter a relevant Google Search query to extract keywords from the Search Engine Results Page (SERP).",
                        param: "query",
                        default: ""
                      },
                      {
                        type: "say",
                        message: "Extracting keywords. Please wait a bit..."
                      },
                      {
                        type: "gpt",
                        prompt: "I want you to respond only in {{language}} and output a single table.\nPretend to be a SEO keyword research expert.\nRead the [SERP] that I will provide you and find top 20 LSI keywords in SERP, each containing at least 2 words:\n- Output these keywords comma separated.\n- Do not include keywords in the list that are not thematically relevant to my query.\n- Do not add any notes, write only comma separated keywords.\n- Do not echo my prompt.\n\n[SERP]:\n{{serp {{query}}}}\n\n[KEYWORDS]:",
                        param: "keywords-list"
                      },
                      {
                        type: "gpt",
                        prompt: "Please ignore previous instructions. Your new instructions:\n- Please only answer in {{language}}.\n- I would like you to act as a copywriter and rewrite or improve a given text for me.\n- Do not change the text structure, but rewrite the content using Additional keywords.\n- If I provide a specific request as Additional keywords, please analyze the request and include relevant keywords in the text. Add as many keywords from my list as possible. Do not write the added keywords in square brackets.\n- I will give you the reply parameters in brackets [].\n- Do not echo my command or parameters.\n\n[TEXT]: {{text}}\n\n[ADDITIONAL KEYWORDS]: {{keywords-list}}\n\n[REWRITTEN TEXT]:",
                        param: "gpt"
                      },
                      { type: "jump", to: "ASK FOR CHANGE" }
                    ]
                  }
                ]
              },
              {
                condition: "{{instructions}} = frameworks",
                type: "group",
                label: "WRITING FRAMEWORKS",
                steps: [
                  {
                    type: "ask",
                    message: "Pick a style or type custom instructions. Read about [writing styles in this guide](https://harpa.ai/guides/writing-styles).\n",
                    param: "style",
                    options: [
                      {
                        label: "\u{1F197} STANDARD",
                        value: "Standard Article: Using Headings and Subheadings (H1, H2, H3, H4)."
                      },
                      {
                        label: "\u{1F4E3} AIDA",
                        value: "AIDA (Attention Interest Desire Action) writing framework"
                      },
                      {
                        label: "\u{1F4A1} PAS",
                        value: "PAS (Problem Agitate Solve) writing framework"
                      },
                      { label: "\u{1F3AF} 5W1H", value: "5W1H writing framework" },
                      {
                        label: "\u{1F4A1} SWOT",
                        value: "SWAT Analysis (Strengths, Weaknesses, Opportunities, Threats) writing framework"
                      },
                      {
                        label: "\u{1F309} BAB",
                        value: "Before-After-Bridge writing framework"
                      },
                      {
                        label: "\u{1F4DA} PASTOR",
                        value: "Problem-Amplify-Solution-Testimonials-Offer-Response writing framework"
                      },
                      {
                        label: "\u{1F393}\u200D\uFE0F FAB",
                        value: "Features-Advantages-Benefits writing framework"
                      },
                      {
                        label: "\u{1F53A} PYRAMID",
                        value: "Pyramid Principle writing framework, start by presenting the most critical information (the main point) at the beginning, followed by supporting details and explanations arranged in a hierarchical structure"
                      },
                      {
                        label: "\u{1F61A} KISS",
                        value: "KISS (Keep It Simple, Stupid) writing framework. Avoid unnecessary jargon, complexity, and verbosity."
                      },
                      {
                        label: "\u{1F4DD} PEEL",
                        value: "PEEL (Point, Explanation, Evidence, Link) writing framework that begins by making a point, followed by an explanation of the point, the provision of evidence to support the claim, and finally, linking the point to the broader context or theme."
                      },
                      {
                        label: "\u2B50 STAR",
                        value: "STAR (Situation, Task, Action, Result) writing framework"
                      },
                      {
                        label: "\u{1F985} SOAR",
                        value: "SOAR (Situation, Obstacles, Actions, Results) writing framework"
                      },
                      {
                        label: "\u{1F3DB}\uFE0F TOULMIN",
                        value: "Toulmin Model writing framework: firstly establish a claim, then support it with evidence (grounds), and finally build a logical and persuasive case through warrants, which connect the evidence to the claim."
                      },
                      {
                        label: "\u{1F4C8} SCIPAB",
                        value: "SCIPAB (Situation, Complication, Implication, Position, Action, Benefit) writing framework"
                      },
                      {
                        label: "\u{1F393}\u200D\uFE0F HARVARD",
                        value: "Harvard writing framework, use headings and sub headings (H1, H2, H3, H4)"
                      },
                      {
                        label: "\u{1F575}\uFE0F\u200D\uFE0F OPINION",
                        value: '"Opinion Writing" framework: express different opinions on a given topic'
                      },
                      { label: "\u{1F92A} GONZO", value: "GONZO writing framework" },
                      {
                        label: "\u{1F5E3}\uFE0F PREP",
                        value: "PREP (Point, Reason, Example, Point) writing framework"
                      },
                      { value: "$custom" }
                    ],
                    label: "FRAMEWORKS"
                  },
                  {
                    type: "gpt",
                    prompt: "Please ignore all previous instructions.\nI want you to act as a very proficient SEO and high end copy writer that speaks and writes fluent {{language}}.\nYour task is to rewrite or improve a given text for me. Write a high-quality text with very detailed paragraphs, utilizing the writing [FRAMEWORK] I have chosen. Get to the point precisely and accurately.\nAll output must be 100% human writing style and free of grammar errors. Do not use generic filler phrases. Do use useful subheadings with keyword-rich titles. Do not repeat the same content over again.\nEach chapter should have numbering; do not leave chapters without numbers, even if it's an introduction, conclusion, or any other introductory or concluding chapter.\nFormat the text using headings (H2, H3, H4) and other markdown formatting features. Do not use H1 headings. Display the text in rendered format.\n\n[FRAMEWORK]: {{style}}\n\n[TEXT TO REWRITE]:\n{{text}}\n\n[REWRITTEN TEXT]:",
                    param: "gpt"
                  },
                  { type: "jump", to: "ASK FOR CHANGE" }
                ]
              },
              {
                type: "group",
                steps: [
                  {
                    type: "calc",
                    func: "clone",
                    from: "text",
                    to: "repurpose-input",
                    label: "REPURPOSE TEXT"
                  },
                  { type: "command", inputs: [], name: "Repurpose text" },
                  { type: "stop" }
                ],
                label: "REPURPOSE",
                condition: "{{instructions}} = repurpose"
              },
              {
                type: "gpt",
                prompt: "Please ignore previous instructions. Your new instructions:\n- Please only answer in {{language}}.\n- I would like you to act as a copywriter and rewrite or improve a given text for me.\n- I will give you the reply parameters in brackets [].\n- Do not echo my command or parameters.\n- Do not show the rewritten text within quotation marks.\n\n[HOW TO REWRITE THE TEXT]:\n{{instructions}}\n\n[TEXT TO REWRITE]:\n{{text}}\n\n[NEW TEXT]:",
                param: "gpt"
              },
              {
                type: "ask",
                label: "ASK FOR CHANGE",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2328\uFE0F PASTE TO PAGE", value: "paste" },
                  { label: "\u2B06\uFE0F EXPAND", value: "Make text longer." },
                  {
                    label: "\u2B07\uFE0F SHORTEN",
                    value: "Make text shorter. I want you to halve the length of the text, keeping only the most essential information and nothing more."
                  },
                  {
                    label: "\u{1F520} FIX GRAMMAR",
                    value: "Output the text as is, but fix spelling errors if the text contains them."
                  },
                  {
                    label: "\u{1F6E0}\uFE0F\u200D\uFE0F REFINE",
                    value: "Improve sentences structure and flow, as well as coherence and relevance by adding or removing information, but try to keep to the text length."
                  },
                  {
                    label: "\u{1F3AD} MIMIC MY TONE",
                    value: "Please pretend to be me, mimicking my style of communication: {{tone}}"
                  },
                  { label: "\u267B\uFE0F REPURPOSE TEXT", value: "repurpose" },
                  { label: "\u{1F3AF} ADD KEYWORDS", value: "add-keywords" },
                  { label: "\u{1F9E9} WRITING FRAMEWORKS", value: "frameworks" },
                  {
                    label: "\u{1F30D} TRANSLATE",
                    value: "Translate to {{language}}, or echo text as is if already in {{language}}."
                  },
                  {
                    label: "\u{1F92A} SIMPLIFY",
                    value: "Simplify text language. Avoid using scientific or any specialized terminology unless necessary."
                  },
                  {
                    label: "\u{1F4BC} PROFESSIONAL",
                    value: "Change tone to professional. Use professional vocabulary and write like an expert in the relevant field. The text should sound confident and demonstrate your competence."
                  },
                  {
                    label: "\u{1F50D} CLARIFY",
                    value: "Change tone to straightforward. Text should be direct, clear, and not ambiguous."
                  },
                  {
                    label: "\u{1F917} WELCOMING",
                    value: "Change the text style to be more approachable and relaxed, capturing a casual and friendly tone."
                  },
                  {
                    label: "\u{1F4CC}\u200D\uFE0F ADD HEADINGS",
                    value: "Add headings, subheadings, bullet points, and other formatting elements for readability."
                  },
                  { label: "\u{1F4DA} STORY", value: "Change style to storytelling." },
                  {
                    label: "\u{1F3A8}\u200D\uFE0F ILLUSTRATE",
                    value: "Add examples, anecdotes, and other storytelling elements to illustrate points."
                  },
                  { label: "\u{1F393}\u200D\uFE0F ENRICH", value: "Enrich vocabulary and tone." },
                  {
                    label: "\u{1F974} HUMANIZE",
                    value: 'I want you to perform text "Humanization". Please rewrite each sentence, increasing its perplexity and burstiness. Perplexity measures the complexity of text. Separately, burstiness compares the variations of sentences. Humans tend to write with greater burstiness, for example, with some longer or complex sentences alongside shorter ones. AI sentences tend to be more uniform. I need it to have a good amount of perplexity and burstiness. Rewrite changing 50% in nouns and verbs for similar ones and rewrite verb usages to add natural sounding variations in complexity but retain the same tense and overall meaning. Randomly use simple and complicated verbs, combine long and short sentences and rewrite the above text so that it is not detected as AI content by AI content detectors.'
                  },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = paste",
                type: "paste",
                mode: "replace",
                text: "{{gpt}}",
                close: false
              },
              {
                condition: "{{change}} = paste",
                type: "control",
                action: "hide"
              },
              { condition: "{{change}} = paste", type: "stop" },
              {
                type: "group",
                steps: [
                  {
                    type: "calc",
                    func: "set",
                    param: "text",
                    format: "",
                    value: "{{gpt}}"
                  },
                  { type: "jump", to: "KEYWORDS" }
                ],
                condition: "{{change}} = add-keywords",
                label: "JUMP TO KW"
              },
              {
                type: "group",
                steps: [
                  {
                    type: "calc",
                    func: "set",
                    param: "text",
                    format: "",
                    value: "{{gpt}}"
                  },
                  { type: "jump", to: "FRAMEWORKS" }
                ],
                condition: "{{change}} = frameworks",
                label: "JUMP TO FRAMEWORKS"
              },
              {
                type: "group",
                steps: [
                  {
                    type: "calc",
                    func: "set",
                    param: "text",
                    format: "",
                    value: "{{gpt}}"
                  },
                  { type: "jump", to: "REPURPOSE TEXT" }
                ],
                condition: "{{change}} = repurpose",
                label: "JUMP TO REPURPOSE"
              },
              {
                type: "gpt",
                prompt: "I would like you to make changes in {{language}} to the new text you have just written.\n- Please do not output anything but the revised text. Do not echo my command.\n- Do not put quotes around the revised text.\n\n[CHANGES TO MAKE]:\n{{change}}\n\n[NEW TEXT]:",
                param: "gpt"
              },
              { type: "jump", to: "ASK FOR CHANGE" }
            ]
          },
          {
            meta: {
              name: "compose",
              title: "Compose",
              description: "Write emails, tweets, direct messages, blog posts, job descriptions, in your tone of voice.",
              category: "Productivity",
              emoji: "\u270D\uFE0F",
              apps: "GMail"
            },
            steps: [
              {
                label: "COMPUTE TONE",
                type: "group",
                steps: [
                  {
                    condition: "{{tone}} !=",
                    type: "calc",
                    func: "set",
                    param: "tone-instruction",
                    value: "- Please pretend to be me, mimicking my style of communication: {{tone}}"
                  },
                  {
                    condition: "{{tone}} =",
                    type: "calc",
                    func: "set",
                    param: "tone-instruction",
                    value: ""
                  },
                  {
                    condition: "{{userinfo}} !=",
                    type: "calc",
                    func: "set",
                    param: "userinfo-instruction",
                    value: "- Here are also some facts for context: {{userinfo}}"
                  },
                  {
                    condition: "{{userinfo}} =",
                    type: "calc",
                    func: "set",
                    param: "userinfo-instruction",
                    value: ""
                  }
                ]
              },
              {
                label: "MAIN MENU",
                type: "ask",
                message: "Sure! What do you want me to write?",
                options: [
                  { label: "EMAIL", value: "email", icon: "write-email" },
                  { label: "DM", value: "direct message" },
                  { label: "TWEET", value: "twitter tweet" },
                  { label: "ARTICLE", value: "article" },
                  { value: "linkedin post", label: "LINKEDIN" },
                  { value: "facebook post", label: "FACEBOOK" },
                  { value: "instagram post", label: "INSTAGRAM" },
                  { label: "PRESS RELEASE", value: "press release" },
                  { label: "STORY", value: "story" },
                  { label: "TODO LIST", value: "todo list" },
                  { label: "MEETING AGENDA", value: "meeting agenda" },
                  { value: "$custom" }
                ],
                param: "what",
                default: ""
              },
              {
                condition: "{{what}} = email",
                label: "EMAIL",
                type: "group",
                steps: [
                  {
                    condition: "{{what}} = email",
                    type: "ask",
                    message: "Is this a new email?",
                    options: [
                      { label: "\u{1F195} NEW EMAIL", value: "new email" },
                      { label: "\u{1F4AC} REPLY", value: "email reply" }
                    ],
                    param: "type",
                    default: ""
                  },
                  {
                    condition: "{{type}} = new email",
                    label: "NEW EMAIL",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        message: "\u{1F4AC} What do you want your email to say or be about? Leave blank for me to figure it from the opened page.\n",
                        default: "{{page}}",
                        param: "about"
                      },
                      {
                        label: "EMAIL HOW",
                        type: "ask",
                        param: "how",
                        message: "\u{1F4AC} What the text should say? Pick an option or type instructions.",
                        options: [
                          {
                            label: "\u{1F44D} AGREE",
                            value: "Express agreement on the given topic."
                          },
                          {
                            label: "\u{1F44E} DISAGREE",
                            value: "Express disagreement on the given topic."
                          },
                          {
                            label: "\u{1F64C} ACKNOWLEDGE",
                            value: "Acknowledge the message info."
                          },
                          {
                            label: "\u{1F914} ASK TO CLARIFY",
                            value: "Request to clarify the message."
                          },
                          {
                            label: "\u{1F937}\u200D\uFE0F ASK FOR INFO",
                            value: "Request to provide more information."
                          },
                          { label: "\u2753 QUESTION", value: "Ask a question." },
                          { label: "\u{1F9D0} SUGGEST", value: "Provide a suggestion." },
                          {
                            label: "\u{1F4AF} PRAISE",
                            value: "Praise the message author."
                          },
                          {
                            label: "\u{1F917} EMPATHY",
                            value: "Emphasize with the message author."
                          },
                          {
                            label: "\u{1F91E} SUPPORT",
                            value: "Support the message author."
                          },
                          {
                            label: "\u{1F4AA} ENCOURAGE",
                            value: "Encourage the message author."
                          },
                          {
                            label: "\u{1F928} CRITICIZE",
                            value: "Criticise the message."
                          },
                          {
                            label: "\u{1F64F} APOLOGIZE",
                            value: "Apologise to the message author."
                          },
                          {
                            label: "\u{1F4A1} IDEA",
                            value: "Come up with a relevant idea."
                          },
                          { label: "\u{1F602} JOKE", value: "Write a relevant joke." },
                          { value: "$custom" }
                        ],
                        default: "",
                        optionsInvalid: false
                      },
                      {
                        condition: "{{type}} = new email",
                        type: "gpt",
                        prompt: "Please ignore all previous instructions.\nI want you to act as a professional copywriter who speaks and writes fluent {{language}}.\nI want you to write a new email for me.\n\nFollow the instructions:\n- Your email must be in a single ```markdown code block```.\n- Do not echo my instructions.\n- Do not write your response in quotes.\n- Your email must be in {{language}}.\n- Your email should be short and to the point.\n{{tone-instruction}}\n{{userinfo-instruction}}\n\n- [Additional instructions / email should contain if any]: {{how}}\n\n[PARSE WHAT THE EMAIL SHOULD BE ABOUT FROM THE FOLLOWING]: {{about}}\n\nEMAIL:",
                        param: "gpt"
                      }
                    ]
                  },
                  {
                    condition: "{{type}} = email reply",
                    label: "EMAIL REPLY",
                    type: "group",
                    steps: [
                      { type: "command", name: "Reply", inputs: [] },
                      { type: "stop" }
                    ]
                  }
                ]
              },
              {
                condition: "{{what}} = linkedin post",
                label: "LINKEDIN POST",
                type: "group",
                steps: [
                  {
                    label: "LINKEDIN MENU",
                    type: "ask",
                    message: "Is this a new LinkedIn post?",
                    options: [
                      { label: "\u{1F195} NEW POST", value: "new linkedin post" },
                      { label: "\u{1F4AC} COMMENT", value: "linkedin comment" }
                    ],
                    param: "type",
                    default: ""
                  },
                  {
                    condition: "{{type}} = new linkedin post",
                    label: "NEW POST",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        message: "\u{1F4AC} What do you want the LinkedIn post to say or be about? Leave blank for me to figure it from the opened page.\n",
                        default: "{{page}}",
                        param: "about"
                      },
                      {
                        label: "LINKEDIN HOW",
                        type: "ask",
                        message: "\u{1F4AC} What the text should say? Pick an option or type instructions.",
                        default: "None",
                        param: "how",
                        optionsInvalid: false,
                        options: [
                          {
                            label: "\u{1F44D} AGREE",
                            value: "Express agreement on the given topic."
                          },
                          {
                            label: "\u{1F44E} DISAGREE",
                            value: "Express disagreement on the given topic."
                          },
                          {
                            label: "\u{1F64C} ACKNOWLEDGE",
                            value: "Acknowledge the message info."
                          },
                          {
                            label: "\u{1F914} ASK TO CLARIFY",
                            value: "Request to clarify the message."
                          },
                          {
                            label: "\u{1F937}\u200D\uFE0F ASK FOR INFO",
                            value: "Request to provide more information."
                          },
                          { label: "\u2753 QUESTION", value: "Ask a question." },
                          { label: "\u{1F9D0} SUGGEST", value: "Provide a suggestion." },
                          {
                            label: "\u{1F4AF} PRAISE",
                            value: "Praise the message author."
                          },
                          {
                            label: "\u{1F917} EMPATHY",
                            value: "Emphasize with the message author."
                          },
                          {
                            label: "\u{1F91E} SUPPORT",
                            value: "Support the message author."
                          },
                          {
                            label: "\u{1F4AA} ENCOURAGE",
                            value: "Encourage the message author."
                          },
                          {
                            label: "\u{1F928} CRITICIZE",
                            value: "Criticise the message."
                          },
                          {
                            label: "\u{1F64F} APOLOGIZE",
                            value: "Apologise to the message author."
                          },
                          {
                            label: "\u{1F4A1} IDEA",
                            value: "Come up with a relevant idea."
                          },
                          { label: "\u{1F602} JOKE", value: "Write a relevant joke." },
                          { value: "$custom" }
                        ]
                      },
                      {
                        type: "gpt",
                        prompt: "Please ignore all previous instructions.\nI want you to act as a professional copywriter who speaks and writes fluent {{language}}.\nI would like you to write a LinkedIn Post for me.\n\nFollow the instructions:\n- Your post must be in a single ```markdown code block```.\n- Do not echo my instructions.\n- Do not write your response in quotes.\n- Your post must be in {{language}}.\n- Your post should be short and to the point.\n{{tone-instruction}}\n\n- [Additional instructions / post should contain if any]: {{how}}\n\n[PARSE WHAT THE LINKEDIN POST SHOULD BE ABOUT FROM THE FOLLOWING]: {{about}}\n\nLinkedIn post:",
                        param: "gpt"
                      }
                    ]
                  },
                  {
                    condition: "{{type}} = linkedin comment",
                    label: "LINKEDIN REPLY",
                    type: "group",
                    steps: [
                      { type: "command", name: "Reply", inputs: [] },
                      { type: "stop" }
                    ]
                  }
                ]
              },
              {
                condition: "{{what}} = facebook post",
                label: "FACEBOOK",
                type: "group",
                steps: [
                  {
                    label: "FACEBOOK MENU",
                    type: "ask",
                    message: "Is this a new Facebook post?",
                    options: [
                      { label: "\u{1F195} NEW POST", value: "new facebook post" },
                      { label: "\u{1F4AC} COMMENT", value: "facebook comment" }
                    ],
                    param: "type",
                    default: ""
                  },
                  {
                    condition: "{{type}} = new facebook post",
                    label: "NEW FACEBOOK POST",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        message: "\u{1F4AC} What do you want the Facebook post to say or be about? Leave blank for me to figure it from the opened page.\n",
                        default: "{{page}}",
                        param: "about"
                      },
                      {
                        label: "FACEBOOK HOW",
                        type: "ask",
                        message: "\u{1F4AC} What the text should say? Pick an option or type instructions.",
                        default: "None",
                        param: "how",
                        optionsInvalid: false,
                        options: [
                          {
                            label: "\u{1F44D} AGREE",
                            value: "Express agreement on the given topic."
                          },
                          {
                            label: "\u{1F44E} DISAGREE",
                            value: "Express disagreement on the given topic."
                          },
                          {
                            label: "\u{1F64C} ACKNOWLEDGE",
                            value: "Acknowledge the message info."
                          },
                          {
                            label: "\u{1F914} ASK TO CLARIFY",
                            value: "Request to clarify the message."
                          },
                          {
                            label: "\u{1F937}\u200D\uFE0F ASK FOR INFO",
                            value: "Request to provide more information."
                          },
                          { label: "\u2753 QUESTION", value: "Ask a question." },
                          { label: "\u{1F9D0} SUGGEST", value: "Provide a suggestion." },
                          {
                            label: "\u{1F4AF} PRAISE",
                            value: "Praise the message author."
                          },
                          {
                            label: "\u{1F917} EMPATHY",
                            value: "Emphasize with the message author."
                          },
                          {
                            label: "\u{1F91E} SUPPORT",
                            value: "Support the message author."
                          },
                          {
                            label: "\u{1F4AA} ENCOURAGE",
                            value: "Encourage the message author."
                          },
                          {
                            label: "\u{1F928} CRITICIZE",
                            value: "Criticise the message."
                          },
                          {
                            label: "\u{1F64F} APOLOGIZE",
                            value: "Apologise to the message author."
                          },
                          {
                            label: "\u{1F4A1} IDEA",
                            value: "Come up with a relevant idea."
                          },
                          { label: "\u{1F602} JOKE", value: "Write a relevant joke." },
                          { value: "$custom" }
                        ]
                      },
                      {
                        type: "gpt",
                        prompt: "Please ignore all previous instructions.\nI want you to act as a professional copywriter who speaks and writes fluent {{language}}.\nI would like you to write a Facebook Post for me.\n\nFollow the instructions:\n\n- Your post must be in a single ```markdown code block```.\n- Do not echo my instructions.\n- Do not write your response in quotes.\n- Your post must be in {{language}}.\n- Your post should be short and to the point.\n{{tone-instruction}}\n\n- [Additional instructions / post should contain if any]: {{how}}\n\n[PARSE WHAT THE POST SHOULD BE ABOUT FROM THE FOLLOWING]: {{about}}\n\nFACEBOOK POST:",
                        param: "gpt"
                      }
                    ]
                  },
                  {
                    condition: "{{type}} = facebook comment",
                    label: "FACEBOOK COMMENT",
                    type: "group",
                    steps: [
                      { type: "command", name: "Reply", inputs: [] },
                      { type: "stop" }
                    ]
                  }
                ]
              },
              {
                condition: "{{what}} = instagram post",
                label: "INSTAGRAM",
                type: "group",
                steps: [
                  {
                    label: "INSTAGRAM MENU",
                    type: "ask",
                    message: "Is this a new Instagram post?",
                    options: [
                      { label: "\u{1F195} NEW POST", value: "new instagram post" },
                      { label: "\u{1F4AC} COMMENT", value: "instagram comment" }
                    ],
                    param: "type",
                    default: ""
                  },
                  {
                    condition: "{{type}} = new instagram post",
                    label: "NEW INST POST",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        message: "\u{1F4AC} What do you want the Instagram post to say or be about? Leave blank for me to figure it from the opened page.\n",
                        default: "{{page}}",
                        param: "about"
                      },
                      {
                        label: "INSTAGRAM HOW",
                        type: "ask",
                        message: "\u{1F4AC} What the text should say? Pick an option or type instructions.",
                        default: "None",
                        param: "instructions",
                        optionsInvalid: false,
                        options: [
                          {
                            label: "\u{1F44D} AGREE",
                            value: "Express agreement on the given topic."
                          },
                          {
                            label: "\u{1F44E} DISAGREE",
                            value: "Express disagreement on the given topic."
                          },
                          {
                            label: "\u{1F64C} ACKNOWLEDGE",
                            value: "Acknowledge the message info."
                          },
                          {
                            label: "\u{1F914} ASK TO CLARIFY",
                            value: "Request to clarify the message."
                          },
                          {
                            label: "\u{1F937}\u200D\uFE0F ASK FOR INFO",
                            value: "Request to provide more information."
                          },
                          { label: "\u2753 QUESTION", value: "Ask a question." },
                          { label: "\u{1F9D0} SUGGEST", value: "Provide a suggestion." },
                          {
                            label: "\u{1F4AF} PRAISE",
                            value: "Praise the message author."
                          },
                          {
                            label: "\u{1F917} EMPATHY",
                            value: "Emphasize with the message author."
                          },
                          {
                            label: "\u{1F91E} SUPPORT",
                            value: "Support the message author."
                          },
                          {
                            label: "\u{1F4AA} ENCOURAGE",
                            value: "Encourage the message author."
                          },
                          {
                            label: "\u{1F928} CRITICIZE",
                            value: "Criticise the message."
                          },
                          {
                            label: "\u{1F64F} APOLOGIZE",
                            value: "Apologise to the message author."
                          },
                          {
                            label: "\u{1F4A1} IDEA",
                            value: "Come up with a relevant idea."
                          },
                          { label: "\u{1F602} JOKE", value: "Write a relevant joke." },
                          { value: "$custom" }
                        ]
                      },
                      {
                        type: "gpt",
                        prompt: "Please ignore all previous instructions.\nI want you to act as a professional copywriter who speaks and writes fluent {{language}}.\n\nFollow the instructions:\n- Your post must be in a single ```markdown code block```.\n- Do not echo my instructions.\n- Do not write your response in quotes.\n- Your post must be in {{language}}.\n- Your post should be short and to the point.\n{{tone-instruction}}\n\n- [Additional instructions / post should contain if any]: {{how}}\n\n[PARSE WHAT THE POST SHOULD BE ABOUT FROM THE FOLLOWING]: {{about}}\n\nINSTAGRAM POST:",
                        param: "gpt"
                      }
                    ]
                  },
                  {
                    condition: "{{type}} = instagram comment",
                    label: "INST REPLY",
                    type: "group",
                    steps: [
                      { type: "command", name: "Reply", inputs: [] },
                      { type: "stop" }
                    ]
                  }
                ]
              },
              {
                condition: "{{what}} = press release",
                label: "PRESS RELEASE",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    message: "\u{1F4AC} What do you want the press release to say or be about? Leave blank for me to figure it from the opened page.\n",
                    default: "{{page}}",
                    param: "about"
                  },
                  {
                    type: "ask",
                    message: "\u{1F4AC} Any additional instructions (e.g. style) for me to keep in mind?",
                    default: "None",
                    param: "instructions"
                  },
                  {
                    type: "gpt",
                    prompt: "Please ignore all previous instructions. I want you to act as a professional copywriter who speaks and writes fluent {{language}}. I would like you to write a text for me. I will give you the text parameter in [] brackets below. Your task is to write and respond with the text for the given parameters. Do not echo my command or parameters. Use markdown if appropriate.\n\n[TEXT TYPE]: {{what}}\n\n[PARSE WHAT THE PRESS RELEASE SHOULD BE ABOUT FROM THE FOLLOWING]: {{about}}\n\n[ADDITIONAL INSTRUCTIONS IF ANY]: {{instructions}}\n\nTEXT:",
                    param: "gpt"
                  }
                ]
              },
              {
                condition: "{{what}} = article",
                label: "ARTICLE",
                type: "group",
                steps: [
                  {
                    label: "ARTICLE MENU",
                    type: "ask",
                    message: "What should be the article length?",
                    options: [
                      { label: "250 WORDS", value: "250 words" },
                      { label: "750 WORDS", value: "750 words" },
                      { label: "1400 WORDS", value: "1400 or more words" },
                      { label: "UNLIMITED", value: "unlimited" }
                    ],
                    param: "type",
                    default: ""
                  },
                  {
                    condition: "{{type}} = unlimited",
                    type: "command",
                    name: "Article creator",
                    inputs: []
                  },
                  { condition: "{{type}} = unlimited", type: "stop" },
                  {
                    type: "ask",
                    message: "\u{1F4AC} What do you want the article to say or be about? Leave blank for me to figure it from the opened page.\n",
                    default: "{{page}}",
                    param: "about"
                  },
                  {
                    type: "ask",
                    message: "What should be my writing style?\n\nRead about writing styles in this guide: https://harpa.ai/guide/writing-styles",
                    options: [
                      { label: "\u{1F197} STANDARD", value: "None" },
                      {
                        label: "\u{1F4E3} AIDA",
                        value: "change writing framework to Attention-Interest-Desire-Action"
                      },
                      {
                        label: "\u{1F4A1} PAS",
                        value: "change writing framework to Problem-Agitate-Solve"
                      },
                      { label: "\u{1F3AF} 5W1H", value: "change text style to 5W1H" },
                      {
                        label: "\u{1F4A1} SWOT",
                        value: "change text style to SWAT Analysis"
                      },
                      {
                        label: "\u{1F309} BAB",
                        value: "change text style to Before-After-Bridge framework"
                      },
                      {
                        label: "\u{1F4DA} PASTOR",
                        value: "change text style to PASTOR framework"
                      },
                      {
                        label: "\u{1F393}\u200D\uFE0F FAB",
                        value: "change text style to Features-Advantages-Benefits framework"
                      },
                      {
                        label: "\u{1F53A} PYRAMID",
                        value: "change text style to Pyramid Principle framework"
                      },
                      {
                        label: "\u{1F61A} KISS",
                        value: "change text style to KISS framework"
                      },
                      {
                        label: "\u{1F4DD} PEEL",
                        value: "change text style to PEEL framework"
                      },
                      {
                        label: "\u2B50 STAR",
                        value: "change text style to STAR framework"
                      },
                      {
                        label: "\u{1F985} SOAR",
                        value: "change text style to SOAR framework"
                      },
                      {
                        label: "\u{1F3DB}\uFE0F TOULMIN",
                        value: "change text style to Toulmin Model framework"
                      },
                      {
                        label: "\u{1F4C8} SCIPAB",
                        value: "change text style to SCIPAB framework"
                      },
                      {
                        label: "\u{1F393}\u200D\uFE0F HARVARD",
                        value: "change text style to Harvard framework, use headings and sub headings (H1, H2, H3, H4)"
                      },
                      {
                        label: "\u{1F575}\uFE0F\u200D\uFE0F OPINION",
                        value: "change text style to Opinion Writing"
                      },
                      { label: "\u{1F92A} GONZO", value: "change text style to GONZO" },
                      {
                        label: "\u{1F5E3}\uFE0F PREP",
                        value: "change text style to PREP framework"
                      },
                      { value: "$custom" }
                    ],
                    param: "instructions",
                    default: ""
                  },
                  {
                    type: "gpt",
                    prompt: "Please ignore all previous instructions. The output should be in {{language}}.\n\nI want you to act as a very proficient SEO and high end copy writer that speaks and writes fluent {{language}}.\nYour task is to write a high-quality article with very detailed paragraphs.\n\nInstructions:\n- Get to the point precisely and accurately.\n- Format the article using headings and subheadings (H2, H3, H4) and other visual formatting methods.\n- Do not use H1 headings. Display the text in rendered format.\n- Do not echo my prompt. Follow the instructions and write an article.\n\n[Parse what the article should be about from the following]: {{about}}\n\n[Article length]: {{type}}\n\n[Additional instructions or style]: {{instructions}}\n\nArticle:",
                    param: "gpt"
                  }
                ]
              },
              {
                condition: "{{what}} = story",
                label: "STORY",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    message: "\u{1F4AC} What do you want the story to say or be about? Leave blank for me to figure it from the opened page.\n",
                    default: "{{page}}",
                    param: "about"
                  },
                  {
                    type: "ask",
                    message: "Any additional instructions (e.g. style) for me to keep in mind?",
                    default: "None",
                    param: "instructions"
                  },
                  {
                    type: "gpt",
                    prompt: "Please ignore all previous instructions. I want you to act as a professional copywriter who speaks and writes fluent {{language}}. I would like you to write a text for me. I will give you the text parameter in [] brackets below. Your task is to write and respond with the text for the given parameters. Do not echo my command or parameters. Use markdown if appropriate.\n\n[TEXT TYPE]: {{what}}\n\n[PARSE WHAT THE STORY SHOULD BE ABOUT FROM THE FOLLOWING]: {{about}}\n\n[ADDITIONAL INSTRUCTIONS IF ANY]: {{instructions}}\n\nTEXT:",
                    param: "gpt"
                  }
                ]
              },
              {
                condition: "{{what}} = todo list",
                label: "TODO LIST",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    message: "\u{1F4AC} What do you want the todo list be about or include? Leave blank for me to figure it from the opened page.\n",
                    default: "{{page}}",
                    param: "about"
                  },
                  {
                    type: "ask",
                    message: "Any additional instructions (e.g. style) for me to keep in mind?",
                    default: "None",
                    param: "instructions"
                  },
                  {
                    type: "gpt",
                    prompt: "Please ignore all previous instructions. I want you to act as a professional copywriter who speaks and writes fluent {{language}}. I would like you to write a text for me. I will give you the text parameter in [] brackets below. Your task is to write and respond with the text for the given parameters. Do not echo my command or parameters. Use markdown if appropriate.\n\n[TEXT TYPE]: {{what}}\n\n[PARSE WHAT THE TODO LIST SHOULD BE ABOUT OR INCLUDE FROM THE FOLLOWING]: {{about}}\n\n[ADDITIONAL INSTRUCTIONS IF ANY]: {{instructions}}\n\nTEXT:",
                    param: "gpt"
                  }
                ]
              },
              {
                condition: "{{what}} = meeting agenda",
                label: "AGENDA",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    message: "\u{1F4AC} What do you want the meeting agenda be about or include? Leave blank for me to figure it from the opened page.\n",
                    default: "{{page}}",
                    param: "about"
                  },
                  {
                    type: "ask",
                    message: "Any additional instructions (e.g. style) for me to keep in mind?",
                    default: "None",
                    param: "instructions"
                  },
                  {
                    type: "gpt",
                    prompt: "Please ignore all previous instructions. I want you to act as a professional copywriter who speaks and writes fluent {{language}}. I would like you to write a text for me. I will give you the text parameter in [] brackets below. Your task is to write and respond with the text for the given parameters. Do not echo my command or parameters. Use markdown if appropriate.\n\n[TEXT TYPE]: {{what}}\n\n[PARSE WHAT THE MEETING AGENDA SHOULD BE ABOUT OR INCLUDE FROM THE FOLLOWING]: {{about}}\n\n[ADDITIONAL INSTRUCTIONS IF ANY]: {{instructions}}\n\nTEXT:",
                    param: "gpt"
                  }
                ]
              },
              {
                condition: "{{what}} = direct message",
                label: "DM",
                type: "group",
                steps: [
                  {
                    label: "DM MENU",
                    type: "ask",
                    message: "\u{1F4AC} Is this a new DM?",
                    options: [
                      { label: "\u{1F195} NEW DM", value: "new dm" },
                      { label: "\u{1F4AC} REPLY", value: "dm reply" }
                    ],
                    param: "type",
                    default: ""
                  },
                  {
                    condition: "{{type}} = new dm",
                    label: "NEW DM",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        message: "\u{1F4AC} What do you want DM to say or be about? Leave blank for me to figure it from the opened page.\n",
                        default: "{{page}}",
                        param: "about"
                      },
                      {
                        label: "DM HOW",
                        type: "ask",
                        param: "how",
                        message: "\u{1F4AC} What the text should say? Pick an option or type instructions.",
                        options: [
                          {
                            label: "\u{1F44D} AGREE",
                            value: "Express agreement on the given topic."
                          },
                          {
                            label: "\u{1F44E} DISAGREE",
                            value: "Express disagreement on the given topic."
                          },
                          {
                            label: "\u{1F64C} ACKNOWLEDGE",
                            value: "Acknowledge the message info."
                          },
                          {
                            label: "\u{1F914} ASK TO CLARIFY",
                            value: "Request to clarify the message."
                          },
                          {
                            label: "\u{1F937}\u200D\uFE0F ASK FOR INFO",
                            value: "Request to provide more information."
                          },
                          { label: "\u2753 QUESTION", value: "Ask a question." },
                          { label: "\u{1F9D0} SUGGEST", value: "Provide a suggestion." },
                          {
                            label: "\u{1F4AF} PRAISE",
                            value: "Praise the message author."
                          },
                          {
                            label: "\u{1F917} EMPATHY",
                            value: "Emphasize with the message author."
                          },
                          {
                            label: "\u{1F91E} SUPPORT",
                            value: "Support the message author."
                          },
                          {
                            label: "\u{1F4AA} ENCOURAGE",
                            value: "Encourage the message author."
                          },
                          {
                            label: "\u{1F928} CRITICIZE",
                            value: "Criticise the message."
                          },
                          {
                            label: "\u{1F64F} APOLOGIZE",
                            value: "Apologise to the message author."
                          },
                          {
                            label: "\u{1F4A1} IDEA",
                            value: "Come up with a relevant idea."
                          },
                          { label: "\u{1F602} JOKE", value: "Write a relevant joke." },
                          { value: "$custom" }
                        ],
                        default: "",
                        optionsInvalid: false
                      },
                      {
                        type: "gpt",
                        prompt: "Please ignore all previous instructions.\nI want you to act as a professional copywriter who speaks and writes fluent {{language}}.\nI would like you to write a Direct Message (DM).\n\nFollow the instructions:\n- Your DM must be in a single ```markdown code block```.\n- Do not echo my instructions.\n- Do not write your response in quotes.\n- Your DM must be in {{language}}.\n- Your DM should be short and to the point.\n{{tone-instruction}}\n\n- [Additional instructions / DM should contain if any]: {{how}}\n\n[PARSE WHAT THE DIRECT MESSAGE SHOULD BE ABOUT FROM THE FOLLOWING]: {{about}}\n\nDirect Message:",
                        param: "gpt"
                      }
                    ]
                  },
                  {
                    condition: "{{type}} = dm reply",
                    label: "DM REPLY",
                    type: "group",
                    steps: [
                      { type: "command", name: "Reply", inputs: [] },
                      { type: "stop" }
                    ]
                  }
                ]
              },
              {
                condition: "{{what}} = twitter tweet",
                label: "TWEET",
                type: "group",
                steps: [
                  {
                    label: "TWEET MENU",
                    type: "ask",
                    message: "Is this a new tweet?",
                    options: [
                      { label: "\u{1F195} NEW TWEET", value: "new tweet" },
                      { label: "\u{1F4AC} REPLY", value: "tweet reply" }
                    ],
                    param: "type",
                    default: ""
                  },
                  {
                    condition: "{{type}} = new tweet",
                    label: "NEW TWEET",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        message: "\u{1F4AC} What do you want your tweet to say or be about? Leave blank for me to figure it from the opened page.\n",
                        default: "{{page}}",
                        param: "about"
                      },
                      {
                        label: "TWEET HOW",
                        type: "ask",
                        param: "how",
                        message: "\u{1F4AC} What the text should say? Pick an option or type instructions.",
                        options: [
                          {
                            label: "\u{1F44D} AGREE",
                            value: "Express agreement on the given topic."
                          },
                          {
                            label: "\u{1F44E} DISAGREE",
                            value: "Express disagreement on the given topic."
                          },
                          {
                            label: "\u{1F64C} ACKNOWLEDGE",
                            value: "Acknowledge the message info."
                          },
                          {
                            label: "\u{1F914} ASK TO CLARIFY",
                            value: "Request to clarify the message."
                          },
                          {
                            label: "\u{1F937}\u200D\uFE0F ASK FOR INFO",
                            value: "Request to provide more information."
                          },
                          { label: "\u2753 QUESTION", value: "Ask a question." },
                          { label: "\u{1F9D0} SUGGEST", value: "Provide a suggestion." },
                          {
                            label: "\u{1F4AF} PRAISE",
                            value: "Praise the message author."
                          },
                          {
                            label: "\u{1F917} EMPATHY",
                            value: "Emphasize with the message author."
                          },
                          {
                            label: "\u{1F91E} SUPPORT",
                            value: "Support the message author."
                          },
                          {
                            label: "\u{1F4AA} ENCOURAGE",
                            value: "Encourage the message author."
                          },
                          {
                            label: "\u{1F928} CRITICIZE",
                            value: "Criticise the message."
                          },
                          {
                            label: "\u{1F64F} APOLOGIZE",
                            value: "Apologise to the message author."
                          },
                          {
                            label: "\u{1F4A1} IDEA",
                            value: "Come up with a relevant idea."
                          },
                          { label: "\u{1F602} JOKE", value: "Write a relevant joke." },
                          { value: "$custom" }
                        ],
                        default: "",
                        optionsInvalid: false
                      },
                      {
                        type: "gpt",
                        prompt: "Please ignore all previous instructions.\nI want you to act as a professional copywriter who speaks and writes fluent {{language}}.\nI would like you to write a Tweet for me.\n\nFollow the instructions:\n- [Max length]: 280 characters, or 30 words\n- Your tweet must be in a single ```markdown code block```.\n- Do not echo my instructions.\n- Do not write your response in quotes.\n- Your tweet must be in {{language}}.\n- Your tweet should be short and to the point.\n{{tone-instruction}}\n\n- [Additional instructions / tweet should contain if any]: {{how}}\n\n[PARSE WHAT THE TWEET SHOULD BE ABOUT FROM THE FOLLOWING]:\n{{about}}\n\nTWEET:",
                        param: "gpt"
                      }
                    ]
                  },
                  {
                    condition: "{{type}} = tweet reply",
                    label: "TWEET REPLY",
                    type: "group",
                    steps: [
                      { type: "command", name: "Reply", inputs: [] },
                      { type: "stop" }
                    ]
                  }
                ]
              },
              {
                condition: "{{what-option}} = $custom",
                label: "CUSTOM",
                type: "group",
                steps: [
                  {
                    condition: "{{what-option}} = $custom",
                    type: "ask",
                    message: "\u{1F4AC} What do you want me to write about? Leave blank for me to figure it from the opened page.\n",
                    default: "{{page}}",
                    param: "about"
                  },
                  {
                    type: "gpt",
                    prompt: "Please ignore all previous instructions. I want you to act as a professional copywriter who speaks and writes fluent {{language}}. I would like you to write a text for me. I will give you the text parameter in [] brackets below.\nYour task is to write and respond with the text for the given parameters. Do not echo my command or parameters.\n{{tone-instruction}}\n\n[TEXT TYPE OR FORMAT]: {{what}}\n\n[PARSE WHAT THE TEXT SHOULD BE ABOUT FROM THE FOLLOWING]: {{about}}\n\nTEXT:",
                    param: "gpt"
                  }
                ]
              },
              {
                label: "ask-for-change",
                type: "ask",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u{1F4CB} PASTE TO PAGE", value: "paste" },
                  { label: "\u2B06\uFE0F EXPAND", value: "Make it longer" },
                  { label: "\u2B07\uFE0F SHORTEN", value: "Make it shorter" },
                  {
                    label: "\u{1F4BC} PROFESSIONAL",
                    value: "Change tone to professional"
                  },
                  { label: "\u{1F379} CASUAL", value: "Change tone to casual" },
                  {
                    label: "\u{1F3AF} STRAIGHTFORWARD",
                    value: "Change tone to straightforward"
                  },
                  { label: "\u{1F981} CONFIDENT", value: "Change tone to confident" },
                  {
                    label: "\u{1F431} FRIENDLY",
                    value: "Change tone to friendly and empathic"
                  },
                  { label: "\u{1F4DA} STORY", value: "Change style to storytelling" },
                  { label: "\u{1F92A} SIMPLIFY", value: "Simplify language" },
                  { label: "\u{1F393}\u200D\uFE0F ENRICH", value: "Enrich vocabulary and tone" },
                  {
                    label: "\u{1F3A8}\u200D\uFE0F ILLUSTRATE",
                    value: "Add examples, anecdotes, and other storytelling elements to illustrate points"
                  },
                  {
                    label: "\u{1F4CC}\u200D\uFE0F ADD HEADINGS",
                    value: "Add headings, subheadings, bullet points, and other formatting elements for readability"
                  },
                  {
                    label: "\u{1F974} HUMANIZE",
                    value: 'I want you to perform text "Humanization". Please rewrite each sentence, increasing its perplexity and burstiness. Perplexity measures the complexity of text. Separately, burstiness compares the variations of sentences. Humans tend to write with greater burstiness, for example, with some longer or complex sentences alongside shorter ones. AI sentences tend to be more uniform. I need it to have a good amount of perplexity and burstiness. Rewrite changing 50% in nouns and verbs for similar ones and rewrite verb usages to add natural sounding variations in complexity but retain the same tense and overall meaning. Randomly use simple and complicated verbs, combine long and short sentences and rewrite the above text so that it is not detected as AI content by AI content detectors.'
                  },
                  { label: "\u{1F50D} CLARIFY", value: "Add clarity and conciseness" },
                  {
                    label: "\u{1F6E0}\uFE0F\u200D\uFE0F REFINE",
                    value: "Improve sentences structure and flow, as well as coherence and relevance by adding or removing information, but try to keep to the text length"
                  },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = paste",
                type: "group",
                steps: [
                  { type: "paste", close: true, text: "{{gpt}}" },
                  { type: "stop" }
                ]
              },
              {
                type: "gpt",
                prompt: "I would like you to make changes to the text you have written. Do not output anything but the revised text. Do not echo my command. Do not put quotes around the revised text.\n\n[CHANGES TO MAKE]:\n\n{{change}}\n\n\n[NEW TEXT]:",
                param: "gpt"
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "finish-writing",
              title: "Finish writing",
              description: "Expands drafts to fully formatted emails, comments, tweets, forum posts in your tone of voice.",
              category: "Productivity",
              apps: "GMail",
              emoji: "\u{1F3C1}"
            },
            steps: [
              {
                condition: "{{selection}}",
                label: "SELECTION",
                type: "group",
                steps: [
                  { type: "say", message: "\u{1F4AC} Expanding selected text..." },
                  { type: "calc", func: "clone", from: "selection", to: "draft" },
                  { type: "jump", to: "EXPAND REPLY" }
                ]
              },
              {
                condition: "{{input}}",
                label: "INPUT",
                type: "group",
                steps: [
                  {
                    type: "say",
                    message: "\u{1F4AC} Expanding text from the web form..."
                  },
                  { type: "calc", from: "input", func: "clone", to: "draft" },
                  { type: "jump", to: "EXPAND REPLY" }
                ]
              },
              {
                label: "CONTENT",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    message: '\u{1F4AC} What to expand upon or finish writing for you?\nTip: try **/finish** in GMail, after typing "suggest meeting for tomorrow at 9am" reply. I will try to mimic your tone, which can be changed in the App Settings.\n```text\n{{tone}}\n```',
                    default: "",
                    param: "content"
                  },
                  { type: "calc", func: "clone", from: "content", to: "draft" },
                  { type: "jump", to: "EXPAND REPLY" }
                ]
              },
              {
                label: "EXPAND REPLY",
                type: "group",
                steps: [
                  {
                    label: "COMPUTE TONE",
                    type: "group",
                    steps: [
                      {
                        condition: "{{tone}} !=",
                        type: "calc",
                        func: "set",
                        param: "tone-instruction",
                        value: "- Please pretend to be me, mimicking my style of communication: {{tone}}"
                      },
                      {
                        condition: "{{tone}} =",
                        type: "calc",
                        func: "set",
                        param: "tone-instruction",
                        value: ""
                      },
                      {
                        condition: "{{userinfo}} !=",
                        type: "calc",
                        func: "set",
                        param: "userinfo-instruction",
                        value: "- Here are also some facts for context: {{userinfo}}"
                      },
                      {
                        condition: "{{userinfo}} =",
                        type: "calc",
                        func: "set",
                        param: "userinfo-instruction",
                        value: ""
                      }
                    ]
                  },
                  {
                    type: "calc",
                    func: "set",
                    value: "{{email}}",
                    param: "context"
                  },
                  {
                    condition: "{{context}} =",
                    type: "calc",
                    func: "set",
                    value: "{{page}}",
                    param: "context"
                  },
                  {
                    type: "gpt",
                    prompt: 'Please ignore previous instructions.\nAct as a professional virtual assistant who speaks {{language}} fluently.\n\nYour goal is to write a finished reply in for me, expanding, improving and refining my draft or idea.\nWrite a reply that aligns with "{{domain}}" website purpose, for instance:\n- For GMail or similar: expand my draft into an email. Include greetings and a signature if you have information about me. Do not write a subject.\n- For Twitter: expand draft into a tweet. Omit signatures and greetings.\n\nFollow the instructions:\n- Your reply text should be concise and clear.\n- Reply should be in a single ```markdown code block```.\n- Avoid hallucinating facts, adding new information or giving promises.\n- Provide only the expanded draft without extra comments or my original prompt.\n{{tone-instruction}}\n{{userinfo-instruction}}\n\n[REPLY DRAFT OR IDEA]:\n{{draft}}\n\n[CONTEXT FROM "{{domain}}"]:\n{{context}}\n\n[REPLY FORMAT]:\n```markdown\n...\n```\n\n-----\n\n[REPLY IN A SINGLE CODE BLOCK]:',
                    silent: false,
                    dumb: false,
                    param: "gpt"
                  }
                ]
              },
              {
                label: "ASK-FOR-CHANGE",
                type: "ask",
                param: "change",
                message: "\u{1F4AC} Change the text further? Press Enter to paste back to page, or Escape to abort.",
                options: [
                  { label: "\u2328\uFE0F PASTE TO PAGE", value: "paste" },
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u{1F53C} EXPAND", value: "Make the reply longer." },
                  { label: "\u{1F53D} SHORTEN", value: "Make the reply shorter." },
                  "$custom"
                ],
                default: ""
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = paste",
                label: "PASTE",
                type: "group",
                steps: [
                  {
                    type: "calc",
                    func: "extract-code",
                    to: "extracted",
                    index: "0",
                    param: "gpt"
                  },
                  {
                    condition: "{{extracted}} =",
                    type: "calc",
                    value: "{{gpt}}",
                    func: "set",
                    param: "extracted",
                    format: ""
                  },
                  {
                    condition: "{{selection}} =",
                    type: "paste",
                    mode: "replace",
                    text: "{{extracted}}",
                    selectorType: "ai",
                    silent: true,
                    selector: null,
                    item: null,
                    close: false
                  },
                  {
                    condition: "{{selection}}",
                    type: "paste",
                    mode: "insert",
                    text: "{{extracted}}",
                    selectorType: "ai",
                    selector: null,
                    item: null,
                    silent: true,
                    close: false
                  },
                  { type: "control", action: "hide", silent: true },
                  { type: "stop" }
                ]
              },
              {
                type: "gpt",
                prompt: "I would like you to make changes to the reply you have just written.\nFollow the instructions:\n- Please do not output anything but the revised text in a single ```markdown code block```.\n- Do not echo my command.\n- Do not put quotes around the revised text.\n- Please answer in {{language}}.\n\n[RESPONSE FORMAT]:\n```\nrewritten reply\n```\n\n\n[CHANGES TO MAKE]:\n\n{{change}}\n\n\n[REWRITTEN REPLY]:",
                dumb: false,
                param: "gpt"
              },
              { type: "jump", to: "ASK-FOR-CHANGE" }
            ]
          },
          {
            meta: {
              name: "tldr",
              title: "TL;DR",
              description: "Condense selected text, article, email into a TLDR for quick understanding and time-saving.",
              category: "Productivity",
              emoji: "\u26A1\uFE0F\uFE0F\uFE0F\uFE0F\uFE0F\uFE0F\uFE0F"
            },
            steps: [
              {
                type: "group",
                steps: [
                  {
                    type: "gpt",
                    prompt: "Please ignore all previous instructions.\n-  I want you to summarize the TEXT into a list of key takeaways in {{language}}, focusing only on the most important information.\n- I don't want to spend time reading, so your response must be concise, easy to read & understand.\n- If the text contains repeated information, avoid including these repetitions.\n- Your summary should be significantly shorter than the original text.\n\n[TEXT]: {{selection}}\n\n[KEY TAKEAWAYS LIST]:",
                    param: "text"
                  }
                ],
                label: "SELECTED TEXT",
                condition: "{{selection}} != \u2014"
              },
              {
                type: "group",
                steps: [
                  {
                    type: "ask",
                    param: "text",
                    message: "Please paste text to TL;DR, or hit Enter to summarize the web page:",
                    options: null,
                    default: "{{page}}"
                  },
                  {
                    type: "gpt",
                    prompt: "Please ignore all previous instructions.\n\nSummarize the next chunk of the web page into a list of key takeaways in {{language}}, focusing only on the most important information.\n- I don't want to spend time reading, so your response must be concise, easy to read & understand.\n- If the text contains repeated information, avoid including these repetitions.\n- Your summary should be significantly shorter than the original text.\n\nUse the specified format:\n\n- Key takeaway\n   - Additional information for the key takeaway in a sub-bullet point (if needed).\n   - ...\n\n[WEB PAGE CHUNK]:\n\n{{chunk}}\n\n[KEY TAKEAWAYS LIST]:",
                    condition: "{{text}} = {{page}}",
                    isolated: true,
                    chunkify: { text: "{{page}}", empty: "" },
                    param: "gpt",
                    label: "PAGE"
                  },
                  {
                    type: "gpt",
                    prompt: "Please ignore all previous instructions.\n-  I want you to summarize the TEXT into a list of key takeaways in {{language}}, focusing only on the most important information.\n- I don't want to spend time reading, so your response must be concise, easy to read & understand.\n- If the text contains repeated information, avoid including these repetitions.\n- Your summary should be significantly shorter than the original text.\n\n[TEXT]: {{text}}\n\n[KEY TAKEAWAYS LIST]:",
                    condition: "{{text}} != {{page}}",
                    param: "gpt",
                    label: "NOT PAGE"
                  }
                ],
                condition: "{{selection}} = \u2014",
                label: "NO SELECTED TEXT"
              },
              {
                type: "ask",
                param: "option",
                message: "",
                options: [
                  { label: "\u2705 DONE", value: "stop" },
                  { label: "\u2B07\uFE0F SHORTEN", value: "shorten" },
                  { label: "\u{1F92A} SIMPLIFY", value: "simplify" },
                  { label: "\u{1F4AC} REPLY TO TEXT", value: "reply" },
                  { label: "\u267B\uFE0F REPURPOSE TEXT", value: "repurpose" },
                  "$custom"
                ],
                default: ""
              },
              { type: "stop", condition: "{{option}} = stop", label: "DONE" },
              {
                type: "group",
                steps: [
                  {
                    type: "gpt",
                    prompt: "I want you to halve the length of your summary, keeping only the most essential key takeaways, removing any repetitions.\n- Keep important facts in the shortened text.\n- Please do not output anything but the revised summary.\n- Do not echo my command.\n- Do not put quotes around the revised summary.\n\n[A summary that needs to be revised]: {{gpt}}\n\nRewritten summary:",
                    param: "gpt"
                  },
                  { type: "stop" }
                ],
                label: "SHORTEN",
                condition: "{{option}} = shorten"
              },
              {
                type: "group",
                steps: [
                  {
                    type: "gpt",
                    prompt: "I want you to simplify your summary and rewrite it in more understandable language, replacing complex words and phrases with simple, clear ones.\n- Avoid using scientific or any specialized terminology unless necessary.\n- Explain complex concepts, objects, or events using language that would be taught in school.\n- Please do not output anything but the revised summary.\n- Do not echo my command.\n\n[A summary that needs to be revised]: {{gpt}}\n\nRewritten summary:",
                    param: "gpt"
                  },
                  { type: "stop" }
                ],
                label: "SIMPLIFY",
                condition: "{{option}} = simplify"
              },
              {
                type: "group",
                steps: [
                  { type: "command", inputs: ["{{gpt}}"], name: "Reply" },
                  { type: "stop" }
                ],
                condition: "{{option}} = reply",
                label: "REPLY"
              },
              {
                type: "group",
                steps: [
                  {
                    type: "calc",
                    func: "clone",
                    from: "gpt",
                    to: "repurpose-input"
                  },
                  { type: "command", inputs: [], name: "Repurpose text" }
                ],
                label: "REPURPOSE",
                condition: "{{option}} = repurpose"
              }
            ]
          },
          {
            meta: {
              name: "ask",
              title: "Ask",
              category: "Productivity",
              emoji: "\u{1F4AC}",
              description: "Get an answer or talk to the opened web page, YouTube video, PDF."
            },
            steps: [
              {
                condition: "{{url}} =~ ^https:\\/\\/www\\.youtube\\.com\\/watch.*",
                type: "group",
                label: "YOUTUBE",
                steps: [
                  {
                    type: "say",
                    message: "![icon](/img/commands/general-search-refraction.svg) Parsing video content..."
                  },
                  {
                    condition: "{{transcript}} =",
                    type: "group",
                    steps: [
                      {
                        say: "\u{1F6AB} It looks as if the video has no text transcript, or I could not fetch it from the page.\n"
                      },
                      { type: "stop" }
                    ]
                  },
                  {
                    type: "calc",
                    func: "match",
                    to: "id",
                    param: "url",
                    regex: "/(?<=\\?v=|&v=)[^&#\\/]+/"
                  },
                  {
                    type: "ask",
                    message: "What would you like me to find in or answer from the [video content]({{url}})? I will cite timestamps if found.",
                    default: "What are the 3 key video takeaways?",
                    param: "question"
                  },
                  {
                    label: "YOUTUBE GPT STEP",
                    type: "gpt",
                    onCodeClick: "send-text",
                    prompt: 'I want you to only answer in {{language}}. I want you to answer my question about YouTube video [CONTEXT] titled {{title}}.\n\n\n[QUESTION]: {{question}}\n\n\n(!) Follow the format:\n\nYour brief answer here based on video content, or apology if the answer or topic does not appear in the video content.\n- [MM:SS](URL) Relevant key takeaway in {{language}}\n- ...\n\n**Related questions:**\n```text\n4-5 words related query text\n```\n```text\n4-5 words related query text\n```\n```text\n4-5 words related query text\n```\n\n(!) If the question was not covered in the video, do not attempt to answer it, or hallucinate an answer. Instead, state so clearly and suggest relevant questions that are answered in the video [CONTEXT], wrapped in codeblocks.\n\n\n(!) If the question is covered in the video, provide a brief answer, based on the transcript, and describe key ideas, answering my question in 1-2 sentences. Do not add information from outside of the transcript.\n- If my [QUESTION] is general like "what\'s the key idea of the video", do your best to answer it, no matter what is in [CONTEXT].\n- Don\'t start with a general phrase, that there is an answer or repeating the question. Do not write general phrases like "The video mention the ...", "The topic was mentioned ...".\n- After the answer, list key points from the video about my question, with timestamps showing where it was discussed, relevant answers given, or opinions expressed.\n- After the timestamps, list relevant questions or topics in codeblocks.\n\n\n(!) The timestamps should be presented in markdown URL format. Timestamps should be related to my question / topic. The URL text indicates a timestamp in the video, for example:\n- [00:45](https://youtube.com/watch?v={{id}}&t=45s) ...\n- [02:18](https://youtube.com/watch?v={{id}}&t=138s) ...\n- [05:37](https://youtube.com/watch?v={{id}}&t=337s) ...\nUse the video\'s actual URL: https://youtube.com/watch?v={{id}}. The URL text indicates, and the address links to a specific time in the video, for example:\n\n\n(!) The 3 relevant questions should be brief and related questions about [CONTEXT].\n- Generate queries that can be answered by this video.\n- Wrap every relevant query into a markdown code block:\n```text\n4-5 words related query text\n```\n\n\n[CONTEXT]: {{page {{question}} limit=50%}}\n\n\n[YOUR RESPONSE IN THE REQUIRED FORMAT IN {{language}}]:',
                    silent: false,
                    isolated: true,
                    param: "gpt"
                  },
                  {
                    type: "ask",
                    options: null,
                    param: "question",
                    message: "",
                    default: ""
                  },
                  { type: "jump", to: "YOUTUBE GPT STEP" }
                ]
              },
              {
                label: "NOT YOUTUBE",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    default: "What are the key takeaways?",
                    param: "question",
                    message: 'Type a question. Leave blank for: "What are the key takeaways?"'
                  },
                  {
                    label: "GPT STEP",
                    type: "gpt",
                    prompt: "I want you to only answer in {{language}}. Complete two tasks for me and provide a comprehensive response:\n\n1) Please answer the following [QUESTION] about the opened page content to the best of your ability and provided context. Be precise and helpful. Do not hallucinate and do not come up with facts you are not sure about. Avoid mentioning context as incomplete.\n\n2) Generate 3 short and concise related queries to [QUESTION] and [CONTEXT].\n- Related queries should be brief and avoid repeating my [QUESTION] entirely or partially.\n- Generate queries for which you don't have answers in your response yet.\n- Wrap every relevant query into a markdown code block\n\nDo not add any titles or other sections to your answer, strictly follow the [REQUIRED FORMAT]:\n\n... Your helpful answer text ...\n\n**Related queries:**\n\n```markdown\nShort related query\n```\n```markdown\nShort related query\n```\n...\n\n---\n\n[QUESTION]: {{question}}\n\n[CONTEXT]: {{page {{question}} limit=50%}}\n\n[YOUR RESPONSE IN THE REQUIRED FORMAT]:",
                    onCodeClick: "send-text",
                    isolated: true,
                    param: "gpt"
                  },
                  {
                    type: "ask",
                    options: null,
                    param: "question",
                    message: "",
                    default: ""
                  },
                  { type: "jump", to: "GPT STEP" }
                ]
              }
            ]
          },
          {
            meta: {
              name: "search",
              title: "Search Agent",
              description: "Scans the web or domain for an answer.",
              category: "Productivity",
              emoji: "\u{1F50E}"
            },
            steps: [
              {
                label: "SEARCH MENU",
                type: "group",
                steps: [
                  {
                    label: "MAIN SEARCH MENU",
                    type: "ask",
                    param: "search-menu",
                    message: "![icon](/img/commands/general-search-refraction.svg) Type your search query or pick an option:\n",
                    options: [
                      { label: "\u26A1\uFE0F QUICK", value: "quick" },
                      { label: "\u{1F4DA}\uFE0F DETAILED", value: "detailed" },
                      { label: "\u{1F310} IN WEBSITE", value: "domain" },
                      "$custom"
                    ]
                  },
                  {
                    condition: [
                      "{{search-menu}} = quick",
                      "{{search-menu}} = domain",
                      "{{search-menu-option}} = $custom"
                    ],
                    label: "INSTRUCTIONS QUICK",
                    type: "group",
                    steps: [
                      {
                        type: "calc",
                        func: "set",
                        param: "instructions",
                        value: "Keep research short and concise. Maximum number of bullet points is 5.\n"
                      }
                    ]
                  },
                  {
                    condition: "{{search-menu}} = detailed",
                    label: "INSTRUCTIONS DETAILED",
                    type: "group",
                    steps: [
                      {
                        type: "calc",
                        func: "set",
                        param: "instructions",
                        value: "Make a detailed research.\n"
                      }
                    ]
                  },
                  {
                    condition: [
                      "{{search-menu}} = quick",
                      "{{search-menu}} = detailed"
                    ],
                    label: "MENU SEARCH",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "query",
                        message: "![icon](/img/commands/general-search-refraction.svg) Type a search query, e.g. **HARPA AI use cases**:\n",
                        default: "HARPA AI use cases"
                      },
                      {
                        type: "say",
                        message: "![icon](/img/commands/general-download-cloud-01.svg) Scanning web pages\u2026\n"
                      },
                      {
                        type: "calc",
                        func: "set",
                        param: "information",
                        value: "{{serp {{query}} crawl=all}}"
                      }
                    ]
                  },
                  {
                    condition: "{{search-menu}} = domain",
                    label: "MENU WITHIN WEBSITE",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "query",
                        message: "![icon](/img/commands/general-search-refraction.svg) Type a search query, e.g. **Pricing options**:\n",
                        default: "Pricing options"
                      },
                      {
                        type: "say",
                        message: "![icon](/img/commands/general-download-cloud-01.svg) Scanning web pages\u2026\n"
                      },
                      {
                        type: "calc",
                        func: "set",
                        param: "information",
                        value: "{{serp {{query}} site:{{domain}} crawl=all}}"
                      }
                    ]
                  },
                  {
                    condition: "{{search-menu}} = opened-serp-page",
                    label: "MENU OPENED SERP PAGE",
                    type: "group",
                    steps: [
                      {
                        type: "js",
                        code: "const href = location.href\ntry {\n  return new window.URL(href).searchParams.get('q') || ''\n} catch {\n  return href?.match(/q=([^&]+)/)?.[1]?.replaceAll('+', ' ')\n}",
                        param: "query",
                        silent: true
                      },
                      {
                        type: "say",
                        message: "![icon](/img/commands/general-download-cloud-01.svg) Scanning web pages\u2026\n"
                      },
                      {
                        type: "calc",
                        func: "set",
                        param: "information",
                        value: "{{serp crawl=all}}"
                      },
                      { type: "jump", to: "SEARCH" }
                    ]
                  },
                  {
                    condition: "{{search-menu-option}} = $custom",
                    label: "MENU CUSTOM",
                    type: "group",
                    steps: [
                      {
                        type: "calc",
                        func: "set",
                        param: "query",
                        value: "{{search-menu}}"
                      },
                      {
                        type: "say",
                        message: "![icon](/img/commands/general-download-cloud-01.svg) Scanning web pages\u2026\n"
                      },
                      {
                        type: "calc",
                        func: "set",
                        param: "information",
                        value: "{{serp {{query}} crawl=all}}"
                      }
                    ]
                  }
                ]
              },
              {
                label: "SEARCH",
                type: "group",
                steps: [
                  {
                    type: "gpt",
                    onCodeClick: "send-text",
                    prompt: "Please ignore all previous instructions. I want you to only respond in {{language}}.\n\nYou are a Research Agent. I would like you to complete two tasks for me and provide a comprehensive response:\n\n1) Create a short and concise answer to [MY QUESTION], adhering to a specific format I provide:\n- Prefer breaking response into 1-level bullet point list for readability. Do not use titles. {{instructions}}\n- Utilize information from the Web, provided below.\n- Integrate insights from multiple web search sources, and ensure inclusion of relevant links in a markdown fully rendered format: [\u278A](URL), [\u278B](URL) etc, to each bullet point.\n- Every URL should correspond to only one symbol like \u278D.\n- Do not hallucinate facts or information.\n- Do not use any other tools.\n- Avoid general phrases, unrelated words in your response, be to the point.\n\n2) Generate 4 short and concise related queries to [MY QUESTION]\n- Related queries should be brief and avoid repeating [MY QUESTION] entirely or partially.\n- Avoid repeating names; use pronouns. Be short.\n- Wrap every relevant query into a markdown code block\n\n[FOLLOW THE RESPONSE FORMAT]:\n\n- **Item name** and description with source links, e.g. [\u278A](URL)\n- **Item name** and description with source links, e.g. [\u278D](URL)\n- ...\n\n**Related queries:**\n\n```markdown\nShort related query\n```\n```markdown\nShort related query\n```\n\n---\n\n[MY QUESTION]: {{query}}\n\n\n[WEB RESEARCH RESULTS]:\n{{information}}\n\n\n[YOUR RESPONSE IN A BULLET POINT LIST WITH SOURCE LINKS ([\u278A](URL)), AND RELATED QUERIES]:",
                    param: "response"
                  },
                  {
                    type: "calc",
                    func: "search.extract-sources",
                    from: "response",
                    to: "say-sources",
                    format: "text"
                  },
                  { type: "say", message: "{{say-sources}}" }
                ]
              },
              {
                label: "FOLLOW UP MENU",
                type: "group",
                steps: [
                  {
                    label: "FOLLOW UP ASK",
                    type: "ask",
                    param: "final-menu",
                    options: [
                      { label: "\u{1F50D} NEW SEARCH", value: "new" },
                      { label: "\u2753 ASK", value: "follow-up" },
                      { label: "\u2795 MORE", value: "more" },
                      { label: "\u2796 LESS", value: "less" },
                      "$custom"
                    ],
                    optionsInvalid: false
                  },
                  {
                    condition: "{{final-menu}} = new",
                    label: "NEW SEARCH",
                    type: "group",
                    steps: [{ type: "jump", to: "MAIN SEARCH MENU" }]
                  },
                  {
                    condition: "{{final-menu-option}} = $custom",
                    label: "CUSTOM",
                    type: "group",
                    steps: [
                      {
                        type: "calc",
                        value: "{{final-menu}}",
                        func: "set",
                        param: "query",
                        format: ""
                      },
                      { type: "jump", to: "FOLLOW UP GPT" }
                    ]
                  },
                  {
                    condition: "{{final-menu}} = more",
                    label: "MORE",
                    type: "group",
                    steps: [
                      {
                        type: "gpt",
                        prompt: 'Please expand expand your research and give me more info on the topic.\n\nFollow the instructions:\n- Do not generate the related queries. Drop this part of your response.\n- If needed, format your response with markdown, headings (H2, H3, H4), bullet points, bold and italic markdown styles where appropriate.\n- Do not hallucinate facts or information.\n- Do not use any other tools.\n- Avoid general phrases, unrelated words in your response, be to the point.\n\n[MORE INFO ON THE TOPIC "{{query}}"]:\n',
                        param: "response"
                      },
                      { type: "jump", to: "FOLLOW UP ASK" }
                    ]
                  },
                  {
                    condition: "{{final-menu}} = less",
                    label: "LESS",
                    type: "group",
                    steps: [
                      {
                        type: "gpt",
                        prompt: "Please shorten your research. Focus on the most important points. Make research shorter.\n\nInstructions:\n- Do not generate the related queries. Drop this part of your response.\n- Prefer breaking response into 1-level bullet point list for readability.\n- Avoid general phrases, unrelated words in your response, be to the point.\n- If needed, format your response with markdown, bullet points, bold and italic markdown styles where appropriate.\n\n[SHORTEN RESPONSE]:",
                        param: "response"
                      },
                      { type: "jump", to: "FOLLOW UP ASK" }
                    ]
                  },
                  {
                    condition: "{{final-menu}} = follow-up",
                    label: "FOLLOW UP",
                    type: "group",
                    steps: [
                      {
                        label: "ASK FOLLOW UP",
                        type: "ask",
                        message: "Type a follow-up question.",
                        param: "query"
                      },
                      {
                        label: "FOLLOW UP GPT",
                        type: "gpt",
                        prompt: 'Please ignore all previous instructions.\nI want you to answer my follow-up question or do my task, which you will find in the text: "{{query}}".\n\nInstructions:\n- If needed, format your response with markdown, bullet points, bold and italic markdown styles where appropriate.\n- Do not hallucinate facts or information.\n- Do not use any other tools or internet.\n\n[YOUR RESPONSE]:\n',
                        param: "response"
                      },
                      { type: "jump", to: "FOLLOW UP ASK" }
                    ]
                  }
                ]
              }
            ]
          },
          {
            meta: {
              name: "summary",
              title: "Summary",
              category: "Productivity",
              description: "Summarize the entire page content into a list of key takeaways, tweet, etc.",
              emoji: "\u2728"
            },
            steps: [
              {
                condition: [
                  "{{url}} =~ ^(https?:\\/\\/)?(mail\\.google\\.com\\/.*|outlook\\.live\\.com\\/mail\\/.*|mail\\.proton\\.me|mail\\.aol\\.com|mail\\.com|mail\\.yahoo\\.com|hushmail\\.com|mailfence\\.com|app\\.fastmail\\.com|mailjet\\.com|icloud\\.com\\/mail)(\\/[^\\s]*)?",
                  "{{email}} !="
                ],
                label: "EMAILS",
                type: "group",
                steps: [
                  {
                    type: "calc",
                    func: "set",
                    param: "text",
                    value: "{{email}}",
                    format: ""
                  },
                  {
                    condition: "{{text}} =",
                    type: "calc",
                    value: "{{page}}",
                    func: "set",
                    param: "text",
                    format: ""
                  },
                  {
                    type: "gpt",
                    onCodeClick: "send-text",
                    prompt: 'Please ignore all previous instructions.\nI will provide you with a segment of a website which contains email communication. You goal is to summarize the communication (the last email specifically) into: "Sender\'s Intent", "Key takeaways" and "Reply ideas" sections.\nYour reply must be in {{language}}. Concentrate on the most important information during summary.\n\n\n[INSTRUCTIONS]:\n- I want to grasp the idea quickly, so your response must be concise, short, easy to read & understand.\n- Ignore any irrelevant information in the website segment, such as the website interface, and focus only on the email correspondence.\n- Provide no more than 3 most useful key takeaways from the email. Each takeaway should be very short and concise bullet point.\n- Provide up to 3 reply ideas that could be used to respond to the email. Each reply idea should be within a fenced code block and have a different Emoji, followed by Title: Description. Typical idea emojis with titles: \u{1F197} Confirm, \u{1F645} Decline, \u{1F50D} Clarify, \u{1F64F} Appreciate, \u{1F6CE}\uFE0F Request, \u{1F4A1} Suggest, \u{1F504} Update, \u{1F389} Invite, \u{1F4E3} Feedback, \u{1F91D} Assist, \u{1F647} Apologize, \u{1F4C5} Schedule, \u{1F642} Thank etc.\n- If there is no email communication or it is empty, do not provide intent, key takeaways, or reply ideas, instead reply \'Nothing to summarize.\'.\n- Please do not render brackets.\n\n\n[FORMAT]:\n\n### Sender\'s Intent\nA brief description of the sender\'s intent in the email, e.g. actions requested, questions asked, what they are trying to achieve, etc.\n\n### Key takeaways\n- Takeaway 1 in a short / concise format.\n- ...\n\n### Reply ideas\n```markdown\nEmoji Title: Description.\n```\n```markdown\nEmoji Title: Description.\n```\n```markdown\nEmoji Title: Description.\n```\n\n\n[WEB PAGE TITLE]:\n{{desc}}\n\n\n[WEBSITE SEGMENT WITH EMAIL]:\n{{text}}\n\n\n[KEY TAKEAWAYS LIST]:\n',
                    param: "gpt"
                  },
                  {
                    label: "ASK FOR EMAIL SUMMARY ACTION",
                    type: "ask",
                    param: "email-action",
                    options: [
                      { label: "\u2705 DONE", value: "stop" },
                      { label: "\u2B06\uFE0F EXPAND", value: "expand" },
                      { label: "\u{1F4AC} REPLY", value: "reply" },
                      "$custom"
                    ],
                    default: ""
                  },
                  {
                    condition: "{{email-action}} = expand",
                    label: "EXPAND EMAIL SUMMARY",
                    type: "group",
                    steps: [
                      {
                        type: "gpt",
                        prompt: "Please expand the key point list, provide more details in a bullet-point format. Only output the expanded key takeaways, do not echo my command, sender's intent or reply ideas:\n",
                        param: "gpt"
                      },
                      { type: "jump", to: "ASK FOR EMAIL SUMMARY ACTION" }
                    ]
                  },
                  {
                    condition: "{{email-action}} = stop",
                    label: "DONE WITH EMAILS",
                    type: "stop"
                  },
                  {
                    condition: "{{email-action}} = reply",
                    label: "REPLY TO EMAIL BASIC",
                    type: "group",
                    steps: [
                      {
                        type: "calc",
                        param: "selection",
                        func: "set",
                        value: "",
                        format: ""
                      },
                      { type: "command", name: "Reply", inputs: ["{{gpt}}"] },
                      { type: "stop" }
                    ]
                  },
                  {
                    label: "REPLY TO EMAIL CUSTOM",
                    type: "group",
                    steps: [
                      {
                        type: "calc",
                        func: "set",
                        param: "selection",
                        value: "",
                        format: ""
                      },
                      {
                        type: "command",
                        name: "Reply",
                        inputs: ["{{gpt}}", "{{email-action}}"]
                      },
                      { type: "stop" }
                    ]
                  },
                  { type: "stop" }
                ]
              },
              {
                condition: "{{selection}}",
                label: "TEXT SELECTED",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    param: "option1",
                    options: [
                      { label: "SELECTED TEXT", value: "selected" },
                      { label: "WEB PAGE", value: "webpage" },
                      "$custom"
                    ],
                    message: "",
                    default: ""
                  },
                  {
                    condition: "{{option1}} = selected",
                    label: "USE SELECTED",
                    type: "calc",
                    value: "{{selection}}",
                    func: "set",
                    param: "text",
                    format: ""
                  },
                  {
                    condition: "{{option1}} = webpage",
                    label: "USE PAGE",
                    type: "calc",
                    func: "set",
                    param: "text",
                    format: "",
                    value: "{{page}}"
                  }
                ]
              },
              {
                condition: "{{thread exists}}",
                label: "WA-TG-DISCORD-REDDIT-TWITTER",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    param: "messagesCount",
                    message: "How many messages to scan and summarize, please type in a number?",
                    options: [
                      { label: "\u2705 SUMMARIZE 100 MESSAGES", value: 100 },
                      { label: "\u2734\uFE0F SUMMARIZE PAGE", value: "skip" },
                      "$custom"
                    ],
                    default: "",
                    vision: { enabled: false, mode: "area", hint: "", send: true },
                    optionsInvalid: false
                  },
                  {
                    condition: "{{messagesCount}} = skip",
                    label: "DEFAULT {{PAGE}}",
                    type: "group",
                    steps: [
                      {
                        condition: "{{messagesCount}} = skip",
                        type: "calc",
                        func: "clone",
                        from: "page",
                        to: "text"
                      },
                      { type: "jump", to: "ASK FOR SUMMARY ACTION" }
                    ]
                  },
                  {
                    type: "calc",
                    func: "set",
                    param: "text",
                    format: "",
                    value: "Cite the authorship of statements or viewpoints when you use them in a summary. If you are analyzing a dialogue, identify the main discussion points and reference the most active participants in your summary:\n\n{{thread limit={{messagesCount}}}}"
                  },
                  { type: "jump", to: "ASK FOR SUMMARY ACTION" }
                ]
              },
              {
                condition: "{{selection}} = ",
                label: "NOT SELECTED",
                type: "group",
                steps: [
                  {
                    type: "calc",
                    func: "set",
                    param: "text",
                    format: "",
                    value: "{{page}}"
                  },
                  { type: "jump", to: "ASK FOR SUMMARY ACTION" }
                ]
              },
              {
                label: "ASK FOR SUMMARY ACTION",
                type: "ask",
                message: "Pick a summary format, or type custom instructions.\n",
                param: "format",
                options: [
                  { label: "\u{1F4C4} REPORT", value: "report" },
                  { label: "\u26A1\uFE0F TL;DR", value: "tldr" },
                  { label: "\u{1F4AC} TEXT", value: "text" },
                  { label: "\u{1F50D} EXECUTIVE", value: "executive" },
                  { label: "\u{1F917} EMOJI LIST", value: "emoji" },
                  { label: "\u{1F426} TWEET", value: "tweet" },
                  { label: "\u{1F575} FACT CHECK", value: "factCheck" },
                  { value: "$custom" }
                ]
              },
              {
                condition: "{{format}} = report",
                label: "REPORT",
                type: "gpt",
                prompt: "Please ignore all previous instructions. I want you to only answer in {{language}}.\n\nAnalyze the web page content and prepare a web page summary report which has a key takeaway and a summary in bullet points.\n\nThen, generate 3 short and concise queries related to the [WEB PAGE CONTENT].\n- Related queries should be brief and to the point.\n- Wrap each relevant query in a markdown code block\n\n[REPORT FORMAT]:\n### Key Takeaway\nA single most important takeaway from the text in {{language}}\n\n### Summary\nSummarize the web page here in bullet-points. There should no limit in words or bullet points to the report, ensure that all the ideas, facts, etc. are concisely reported out. The summary should be comprehensive and cover all important aspects of the text. Do not use any emoji. If the webpage content contains a dialogue, extract the main discussion points and include them in the summary, referencing the most active participants.\n\n\n**Related queries:**\n\n```markdown\nShort related query\n```\n```markdown\nShort related query\n```\n\n\n\n[WEB PAGE TITLE]:\n{{desc}}\n\n[WEB PAGE CONTENT]:\n{{text}}\n\n[REPORT FOLLOWED BY RELATED QUERIES]:",
                onCodeClick: "send-text",
                param: "gpt"
              },
              {
                condition: "{{format}} = emoji",
                label: "EMOJI",
                type: "gpt",
                isolated: true,
                chunkify: {
                  text: "{{text}}",
                  empty: "It looks as if the page has no text content. Or I could not fetch it.\n"
                },
                prompt: 'Please ignore all previous instructions. I want you to only answer in {{language}}. Summarize the next chunk of the web page into a list of key takeaways:\n- Each key takeaway should be a bullet list item with an emoji.\n- If the webpage content contains a dialogue, extract the main discussion points and include them in the summary, referencing the most active participants.\n- Please try to use relevant but different emojis for each takeaway.\nThen, generate 3 short and concise queries related to the [WEB PAGE CONTENT].\n- Related queries should be brief and to the point.\n- Wrap each relevant query in a markdown code block\n\nFollow the [RESPONSE FORMAT] and do not render brackets:\n"- [emoji 1] [takeaway 1]"\n"- [emoji 2] [takeaway 2]"\n...\n\n**Related queries:**\n\n```markdown\nShort related query\n```\n```markdown\nShort related query\n```\n\n[WEB PAGE TITLE]:\n{{desc}}\n\n[WEB PAGE CHUNK]:\n{{chunk}}\n\n[KEY TAKEAWAYS LIST FOLLOWED BY RELATED QUERIES]:\n',
                onCodeClick: "send-text",
                param: "gpt"
              },
              {
                condition: "{{format}} = text",
                label: "TEXT",
                type: "gpt",
                chunkify: {
                  text: "{{text}}",
                  empty: "It looks as if the page has no text content. Or I could not fetch it.\n"
                },
                prompt: "Please ignore all previous instructions. I want you to only answer in {{language}}. Summarize the next chunk of the web page into a list of key takeaways. Each key takeaway should be a bullet list item. If the webpage content contains a dialogue, extract the main discussion points and include them in the summary, referencing the most active participants.\nThen, generate 3 short and concise queries related to the [WEB PAGE CONTENT].\n- Related queries should be brief and to the point.\n- Wrap each relevant query in a markdown code block\n\nFollow the [RESPONSE FORMAT]:\n\n- [takeaway 1]\n- [takeaway 2]\n...\n\n**Related queries:**\n\n```markdown\nShort related query\n```\n```markdown\nShort related query\n```\n...\n\n[WEB PAGE TITLE]:\n{{desc}}\n\n[WEB PAGE CHUNK]:\n{{chunk}}\n\n[KEY TAKEAWAYS LIST FOLLOWED BY RELATED QUERIES]:\n",
                onCodeClick: "send-text",
                isolated: true,
                param: "gpt"
              },
              {
                condition: "{{format}} = executive",
                label: "EXECUTIVE",
                type: "gpt",
                prompt: "Please ignore all previous instructions. I want you to only answer in {{language}}.\nAct as a skilled summarizer. Your task is to create an executive summary of a given [WEB PAGE]:\n- The summary should provide a brief overview of the text, clearly state the problem or need the text addresses, detail the recommended solution to the problem, explain the benefits and value of the solution or summarize the importance of the work and its impact.\n- Ensure that the summary is comprehensible on its own, providing necessary context without needing the full text.\n- Focus on presenting information objectively with facts and evidence.\n- If the webpage content contains a dialogue, extract the main discussion points and include them in the summary, referencing the most active participants.\n- Highlight the most important findings and insights from the document, including any critical data or statistics discovered.\n- Use clear and simple language for accessibility to all readers, covering all key points while avoiding excessive detail.\n- Utilize Markdown for h2, h3, h4 headers and other features to enhance the text.\nThen, generate 3 short and concise queries related to the [WEB PAGE CONTENT].\n- Related queries should be brief and to the point.\n- Wrap each relevant query in a markdown code block\n\nFollow the [RESPONSE FORMAT]:\n\n## Executive Summary\n### Problem/Need Addressed: brief description\n### Recommended Solution: brief description followed by the detailed key takeaways\n#### Key Takeaways - Key takeaway\n   - Additional information for the key takeaway in a sub-bullet point (if needed).\n   - ...\n\n### Benefits and Value or ### Importance and Impact (choose one option) text\n\n**Related queries:**\n\n```markdown\nShort related query\n```\n```markdown\nShort related query\n```\n...\n\n\n\n[WEB PAGE TITLE]:\n{{desc}}\n\n[WEB PAGE]:\n{{page}}\n\n[EXECUTIVE SUMMARY FOLLOWED BY RELATED QUERIES]:\n",
                onCodeClick: "send-text",
                param: "gpt"
              },
              {
                condition: "{{format}} = tldr",
                label: "TLDR",
                type: "gpt",
                chunkify: {
                  text: "{{text}}",
                  empty: "It looks as if the page has no text content. Or I could not fetch it.\n"
                },
                prompt: "Please ignore all previous instructions.\nSummarize the next chunk of the web page into a list of key takeaways in {{language}}, focusing only on the most important information.\n- I don't want to spend time reading, so your response must be concise, easy to read & understand.\n- If the text contains repeated information, avoid including these repetitions.\n- If the webpage content contains a dialogue, extract the main discussion points and include them in the summary, referencing the most active participants.\n- Your summary should be significantly shorter than the original text.\n- Please do not render brackets.\n\nThen, generate 3 short and concise queries related to the [WEB PAGE CONTENT].\n- Related queries should be brief and to the point.\n- Wrap each relevant query in a markdown code block\n\nFollow the [RESPONSE FORMAT]:\n\n- Key takeaway\n   - Additional information for the key takeaway in a sub-bullet point (if needed).\n   - ...\n\n**Related queries:**\n\n```markdown\nShort related query\n```\n```markdown\nShort related query\n```\n...\n\n[WEB PAGE TITLE]:\n{{desc}}\n\n[WEB PAGE CHUNK]:\n{{chunk}}\n\n[KEY TAKEAWAYS LIST FOLLOWED BY RELATED QUERIES]:\n",
                onCodeClick: "send-text",
                isolated: true,
                param: "gpt"
              },
              {
                condition: "{{format}} = tweet",
                label: "TWEET",
                type: "gpt",
                prompt: "Please ignore all previous instructions. I want you to only answer in {{language}}. Summarize the web page text content into a single tweet. The resulting tweet must be not longer than 280 characters. Do not wrap into quotes.\n\n[WEB PAGE TITLE]:\n{{desc}}\n\n[WEB PAGE CONTENT]:\n{{text}}\n\n[TWEET]:",
                param: "gpt"
              },
              {
                condition: "{{format}} = factCheck",
                label: "FACT CHECK",
                type: "group",
                steps: [
                  {
                    type: "calc",
                    func: "clone",
                    to: "g.factCheck",
                    from: "text"
                  },
                  {
                    type: "command",
                    name: "Fact check",
                    inputs: ["{{g.factCheck}}"]
                  },
                  { type: "stop" }
                ]
              },
              {
                condition: "{{format-option}} = $custom",
                label: "CUSTOM",
                type: "gpt",
                prompt: "Please ignore all previous instructions. I want you to only answer in {{language}}. I would like you to summarize the web page content.\n\n[WEB PAGE TITLE]:\n{{desc}}\n\n[WEB PAGE CONTENT]:\n{{text}}\n\n[ADDITIONAL INSTRUCTIONS / FORMAT]:\n{{format}}\n\n[SUMMARY]:\n",
                param: "gpt"
              },
              {
                label: "CHANGE-SUMMARY",
                type: "ask",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2B07\uFE0F SHORTEN", value: "shorten" },
                  { label: "\u{1F92A} SIMPLIFY", value: "simplify" },
                  { label: "\u{1F50D} CLARIFY", value: "clarify" },
                  { label: "\u267B\uFE0F REPURPOSE TEXT", value: "repurpose" },
                  { label: "\u{1F575}\u{1F3FB}\u200D\u2642\uFE0F FACT CHECK", value: "factCheck" },
                  { value: "$custom" }
                ],
                optionsInvalid: false
              },
              {
                condition: [
                  "{{change}} = clarify",
                  "{{change}} = shorten",
                  "{{change}} = simplify"
                ],
                label: "CHANGES",
                type: "group",
                steps: [
                  {
                    condition: "{{change}} = clarify",
                    label: "CLARIFY",
                    type: "calc",
                    value: "Add clarity and conciseness. Text should be direct, clear, and not ambiguous.",
                    func: "set",
                    param: "change",
                    format: ""
                  },
                  {
                    condition: "{{change}} = simplify",
                    label: "SIMPLIFY",
                    type: "calc",
                    value: "I want you to simplify your summary and rewrite it in more understandable language, replacing complex words and phrases with simple, clear ones.",
                    func: "set",
                    param: "change",
                    format: ""
                  },
                  {
                    condition: "{{change}} = shorten",
                    label: "SHORTEN",
                    type: "calc",
                    value: "Make summary shorter, keeping only the most essential information and nothing more.",
                    func: "set",
                    param: "change",
                    format: ""
                  },
                  {
                    label: "CHANGES",
                    type: "gpt",
                    prompt: "I would like you to make changes to the summary you wrote. Please do not output anything but the revised reply. Do not echo my command. Do not put quotes around the revised reply.\n\n[CHANGES TO MAKE]:\n{{change}}\n\n[SUMMARY TO CHANGE]:\n{{gpt}}\n\n[REVISED SUMMARY]:\n",
                    param: "gpt"
                  },
                  { type: "jump", to: "CHANGE-SUMMARY" }
                ]
              },
              { condition: "{{change}} = no", label: "DONE", type: "stop" },
              {
                condition: "{{change}} = repurpose",
                label: "REPURPOSE",
                type: "group",
                steps: [
                  {
                    type: "calc",
                    to: "repurpose-input",
                    func: "clone",
                    from: "gpt"
                  },
                  { type: "command", name: "Repurpose text", inputs: [] },
                  { type: "stop" }
                ]
              },
              {
                condition: "{{change-option}} = $custom",
                label: "QUESTION",
                type: "group",
                steps: [
                  { type: "command", name: "Ask", inputs: ["{{change}}"] },
                  { type: "stop" }
                ]
              },
              {
                condition: "{{change}} = factCheck",
                label: "CHANGE-FACT CHECK",
                type: "group",
                steps: [
                  { type: "calc", func: "clone", from: "gpt", to: "g.factCheck" },
                  {
                    type: "command",
                    name: "Fact check",
                    inputs: ["{{g.factCheck}}"]
                  },
                  { type: "stop" }
                ]
              }
            ]
          },
          {
            meta: {
              name: "youtube-summary",
              category: "Productivity",
              title: "YouTube video summary",
              description: "Save time on watching YouTube videos. Break down YouTube videos into parts and get key takeaways.",
              apps: "YouTube",
              emoji: "\u{1F3AC}"
            },
            steps: [
              {
                type: "calc",
                func: "call-internal-method",
                method: "yousummary.get-summary",
                to: "cache"
              },
              { condition: "{{cache}} !=", say: "{{cache}}" },
              {
                condition: "{{cache}} =",
                type: "say",
                message: "Pick a summary format, or type custom instructions.\n"
              },
              {
                type: "ask",
                param: "format",
                options: [
                  { label: "\u{1F5DD}\uFE0F TAKEAWAYS", value: "long" },
                  { label: "\u{1F33F} NESTED", value: "detailed" },
                  { label: "\u{1F4E2} CAPTIONS", value: "captions" },
                  { label: "\u{1F4AC} TEXT", value: "text" },
                  { label: "\u{1F4A1} IDEAS", value: "ideas" },
                  { label: "\u{1F575}\u{1F3FB}\u200D\u2642\uFE0F FACT CHECK", value: "factCheck" },
                  { value: "$custom" }
                ]
              },
              {
                say: "Parsing video from the page\u2026 Long videos may take a few seconds to parse.\n"
              },
              { type: "calc", param: "tr", value: "{{transcript}}" },
              {
                condition: "{{tr}} =",
                type: "group",
                steps: [
                  {
                    say: "\u{1F6AB} It looks as if the video has no text transcript, or I could not fetch it from the page.\n"
                  },
                  { type: "stop" }
                ]
              },
              {
                condition: "{{format}} = long",
                type: "gpt",
                isolated: true,
                chunkify: {
                  maxTokens: 5760,
                  text: "{{tr}}",
                  empty: "It looks as if the video has no text transcript, or I could not fetch it from the page.\n"
                },
                prompt: 'I want you to only answer in {{language}}. You goal is to extract key takeaways of the next chunk of the transcript. Takeaways must be concise, informative and easy to read & understand.\nEach key takeaway should be a list item, of the following format:\n\n- [Timestamp] [Takeaway emoji] [Key takeaway in {{language}}]\n\nThe timestamp should be presented in a [HH:MM:SS] format in brackets, for example:\n- [00:00:05] \u{1F916} ...\n- [00:02:18] \u{1F6E1}\uFE0F ...\n- [00:05:37] \u{1F4BC} ...\n\nKeep emoji relevant and unique to each key takeaway item. Do not use the same emoji for every takeaway. Do not render brackets around emoji and takeaway. Do not prepend takeaway with "Key takeaway".\n\n[VIDEO TITLE]:\n{{desc}}\n\n[TIMESTAMPED VIDEO TRANSCRIPT CHUNK]:\n{{chunk}}\n\n[KEY TAKEAWAYS LIST IN {{language}}]:\n'
              },
              {
                condition: "{{format}} = ideas",
                type: "group",
                steps: [
                  {
                    type: "gpt",
                    isolated: true,
                    chunkify: {
                      maxTokens: 5760,
                      text: "{{tr}}",
                      empty: "\u{1F6AB} It looks as if the video has no text transcript, or I could not fetch it from the page.\n"
                    },
                    prompt: "I want you to only answer in {{language}}. Your goal is to summarize the next section of a video transcript into up to 8 key points (or ideas). The key points should help me understand the main ideas and takeaways from the video section without watching the video.\n\nFollow these instructions:\n- The key ideas must be concise, informative, and easy to read & understand.\n- Each key idea should be a list item, and start with a dash.\n- Use relevant and unique emojis for each idea.\n- Avoid using the same emoji for multiple ideas.\n- Do not add any extra notes; I need only up to 8 key ideas from the [SUMMARY].\n- Be concise and to the point.\n- Each key idea must have a unique emoji.\n- Do not repeat my prompt or instructions.\n- Do not include timecodes.\n- Do not render brackets.\n\nFollow the response format:\n- \u{1F306} Key idea 1\n- \u{1F570}\uFE0F\uFE0F Key idea 2\n- \u26A1\uFE0F\uFE0F Key idea 3\n- ...\n\n[VIDEO TITLE]:\n{{desc}}\n\n[TIMESTAMPED VIDEO TRANSCRIPT CHUNK]:\n{{chunk}}\n\n[UP TO 8 KEY POINTS IN {{language}}]:\n"
                  },
                  {
                    type: "js",
                    silent: true,
                    code: `return args.gpt
  .split('\\n')
  .reduce((count, line) =>
    line.trim().startsWith("- ") && ++count > 8 ? 2 : count, 0) > 0 ? 1 : 0;`,
                    args: "gpt",
                    param: "short"
                  }
                ]
              },
              {
                condition: "{{format}} = detailed",
                type: "gpt",
                isolated: true,
                chunkify: {
                  maxTokens: 5760,
                  text: "{{tr}}",
                  empty: "It looks as if the video has no text transcript, or I could not fetch it from the page.\n"
                },
                prompt: `I want you to only answer in {{language}}. You goal is to divide the chunk of the transcript into sections of information with a common theme and note the beginning timestamp of each section.
Each information block should not be less than 2 minutes, contain the timestamp of the beginning of the section, a textual description of the main content of the entire section, and 1 to 3 bullet points that elaborate on the main ideas of the entire section.
Your response must be concise, informative and easy to read & understand.
Use the specified format:

- [Section beginning Timestamp] [Section emoji] [Section key takeaway in {{language}}]

  - Section key takeaway,

  - [Use as many bullet points for section key takeaways as you need].


Follow the required format, don't write anything extra, avoid generic phrases, and don't repeat my task.

The timestamp should be presented in a [HH:MM:SS] format in brackets, for example:
- [00:00:05] \u{1F916} ...
- [00:02:18] \u{1F6E1}\uFE0F ...
- [00:05:37] \u{1F4BC} ...

Keep emoji relevant and unique to each section. Do not use the same emoji for every section. Do not render brackets around emoji and takeaway. Do not prepend takeaway with "Key takeaway".

[VIDEO TITLE]:
{{desc}}

[TIMESTAMPED VIDEO TRANSCRIPT CHUNK]:
{{chunk}}

[TRANSCRIPT INFORMATION SECTIONS IN {{language}}]:
`
              },
              {
                condition: "{{format}} = text",
                type: "gpt",
                isolated: true,
                chunkify: {
                  maxTokens: 5760,
                  text: "{{tr}}",
                  empty: "It looks as if the video has no text transcript, or I could not fetch it from the page.\n"
                },
                prompt: 'I want you to only answer in {{language}}. You goal is to extract key takeaways of the next chunk of the transcript. Takeaways must be concise, informative and easy to read & understand:\n\n- [Timestamp] Key takeaway in {{language}}\n\nDo not prepend takeaway with "Key takeaway". The timestamp should be presented in a [HH:MM:SS] format in brackets, for example:\n[00:15:49]\n\n[VIDEO TITLE]:\n{{desc}}\n\n[TIMESTAMPED VIDEO TRANSCRIPT CHUNK]:\n{{chunk}}\n\n[KEY TAKEAWAYS LIST IN {{language}}]:\n'
              },
              {
                condition: "{{format}} = captions",
                type: "gpt",
                isolated: true,
                chunkify: {
                  maxTokens: 5760,
                  text: "{{tr}}",
                  empty: "It looks as if the video has no text transcript, or I could not fetch it from the page.\n"
                },
                prompt: 'I want you to only answer in {{language}}. You goal is to extract short 3 words key takeaways of the next chunk of the transcript. Takeaways must be concise, informative and easy to read & understand:\n- [Timestamp] [Short 3 words key takeaway in {{language}}]\nEach key point should capture the main idea of the video segment. Your list of key takeaways should be short and to the point.\nDo not prepend takeaway with "Key takeaway". The timestamp should be presented in a [HH:MM:SS] format in brackets, for example:\n[00:15:49]\n\n[VIDEO TITLE]:\n{{desc}}\n\n[TIMESTAMPED VIDEO TRANSCRIPT CHUNK]:\n{{chunk}}\n\n[KEY TAKEAWAYS LIST IN {{language}}]:\n'
              },
              {
                condition: "{{format}} = factCheck",
                label: "FACT CHECK",
                type: "group",
                steps: [
                  { type: "command", name: "Fact check", inputs: [] },
                  { type: "stop" }
                ]
              },
              {
                condition: "{{format-option}} = $custom",
                type: "gpt",
                isolated: true,
                chunkify: {
                  maxTokens: 5760,
                  text: "{{tr}}",
                  empty: "It looks as if the video has no text transcript, or I could not fetch it from the page.\n"
                },
                prompt: "I want you to only answer in {{language}}. Please read the part of a video transcript and perform the instructions I give you below. If instructions are not specified or unclear, simply summarize the transcript for me in a single paragraph.\n\n[VIDEO TITLE]:\n{{desc}}\n\n[TIMESTAMPED VIDEO TRANSCRIPT CHUNK]:\n{{chunk}}\n\n[INSTRUCTIONS]:\n{{format}}\n\n[RESULT IN {{language}}]:\n"
              },
              { condition: "{{tr}} =", type: "stop" },
              { condition: "{{format-option}} = $custom", type: "stop" },
              {
                type: "calc",
                func: "call-internal-method",
                method: "yousummary.submit-summary"
              },
              {
                condition: "{{format}} != ideas",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    label: "complete",
                    message: "\u2705 Summary complete. Share summary to YT comments? Sharing recovers power message.\n",
                    param: "share",
                    options: [
                      { label: "\u{1F3AF}\uFE0F\uFE0F\uFE0F\uFE0F YES, ADD COMMENT", value: "yes" },
                      { label: "\u{1F47B} REMOVE EMOJI", value: "no-emoji" },
                      { label: "\u2B07\uFE0F SHORTEN", value: "shorten" },
                      { label: "\u{1F4A1} MAIN IDEAS", value: "ideas" },
                      { label: "\u26D4 NO", value: "no" }
                    ]
                  }
                ]
              },
              {
                condition: "{{short}} = 2",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    label: "complete",
                    message: "\u2705 Summary complete. Share summary to YT comments? Sharing recovers power message.\n",
                    param: "share",
                    options: [
                      { label: "\u{1F3AF}\uFE0F\uFE0F\uFE0F\uFE0F YES, ADD COMMENT", value: "yes" },
                      { label: "\u{1F47B} REMOVE EMOJI", value: "no-emoji" },
                      { label: "\u2B07\uFE0F SHORTEN", value: "shorten" },
                      { label: "\u{1F4A1} MAIN IDEAS", value: "ideas" },
                      { label: "\u26D4 NO", value: "no" }
                    ]
                  }
                ]
              },
              {
                condition: "{{short}} = 1",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    label: "complete",
                    message: "\u2705 Summary complete. Share summary to YT comments? Sharing recovers power message.\n",
                    param: "share",
                    options: [
                      { label: "\u{1F3AF}\uFE0F\uFE0F\uFE0F\uFE0F YES, ADD COMMENT", value: "yes" },
                      { label: "\u{1F47B} REMOVE EMOJI", value: "no-emoji" },
                      { label: "\u2B07\uFE0F SHORTEN", value: "shorten" },
                      { label: "\u26D4 NO", value: "no" }
                    ]
                  }
                ]
              },
              {
                condition: "{{share}} = no",
                type: "stop",
                analytics: { event: "youtube-comment-summary", value: false }
              },
              {
                condition: "{{share}} = no-emoji",
                type: "group",
                steps: [
                  { type: "calc", func: "remove-emojis", from: "gpt", to: "gpt" },
                  { type: "say", message: "{{gpt}}" },
                  { type: "jump", to: "complete" }
                ]
              },
              {
                condition: "{{share}} = shorten",
                type: "group",
                steps: [
                  {
                    type: "gpt",
                    prompt: "I want you to only answer in {{language}}. You goal is to shorten the takeaways summary of the complete youtube video transcript by ~50%. You can do so by dropping least important key takeaways, by combining key takeaways into one, by shortening the text of each takeaway, in any combination.\n\nPlease keep the format: shortened summary should be a list of key takeaways, just as the input summary, and include timestamps and emojis:\n\n- [Timestamp] [Takeaway emoji] [Key takeaway in {{language}}]\n\n[SUMMARY]:\n{{gpt}}\n\n[SHORTENED SUMMARY IN {{language}}]:\n"
                  },
                  { type: "jump", to: "complete" }
                ]
              },
              {
                condition: "{{share}} = ideas",
                type: "group",
                steps: [
                  {
                    type: "gpt",
                    isolated: true,
                    chunkify: { maxTokens: 5760, text: "{{gpt}}" },
                    prompt: "I want you to only answer in {{language}}. Your goal is to extract up to 8 key ideas from the video summary. The key ideas should help me get the most important information from the video section, without watching it.\n\nFollow these instructions:\n- The key ideas must be concise, informative, and easy to read & understand.\n- Each key idea should be a list item, and start with a dash.\n- Use relevant and unique emojis for each idea.\n- Avoid using the same emoji for multiple ideas.\n- Do not add any extra notes; I need only up to 8 key ideas from the [SUMMARY].\n- Be concise and to the point.\n- Each key idea must have a unique emoji.\n- Do not repeat my prompt or instructions.\n- Do not include timecodes.\n- Do not render brackets.\n\n\nFollow the response format:\n- \u{1F306} Key idea 1\n- \u{1F570}\uFE0F\uFE0F Key idea 2\n- \u26A1\uFE0F\uFE0F Key idea 3\n- ...\n\n[SUMMARY]:\n{{chunk}}\n\n[8 MAIN IDEAS IN {{language}}]:\n"
                  },
                  { type: "stop" }
                ]
              },
              {
                condition: "{{share}} = yes",
                type: "group",
                steps: [
                  {
                    type: "calc",
                    func: "youtube.comment-summary",
                    to: "summary"
                  },
                  {
                    condition: "{{summary}} =",
                    type: "group",
                    steps: [
                      { say: "\u26D4 Summary is empty, nothing to paste." },
                      { type: "stop" }
                    ]
                  },
                  {
                    type: "js",
                    silent: true,
                    code: "// check if comment box is found\nlet cb = document.querySelector('ytd-comment-simplebox-renderer')\nif (cb) return true\n\n// wait for comment box to appear\ndocument.documentElement.scrollTop += window.innerHeight\ncb = await $harpa.waiter.wait(\n  () => document.querySelector('ytd-comment-simplebox-renderer'),\n  { timeout: 1500 })\nreturn !!cb",
                    param: "commentBoxFound",
                    analytics: { event: "youtube-comment-summary", value: true }
                  },
                  {
                    condition: "{{commentBoxFound}} = false",
                    type: "group",
                    steps: [
                      {
                        say: "\u26D4 Could not find **Add a comment** button. Here is the entire summary:\n```markdown\n{{summary}}\n```"
                      },
                      { type: "stop" }
                    ]
                  },
                  {
                    type: "click",
                    selectorType: "ai",
                    selector: [
                      {
                        $matches: [
                          { $tag: "YT-FORMATTED-STRING" },
                          { $role: "textbox" },
                          { $id: "simplebox-placeholder" },
                          { $class: "style-scope" },
                          { $class: "ytd-comment-simplebox-renderer" },
                          { $attribute: "role=textbox" },
                          { $attribute: "tabindex=0" },
                          { $style: "Roboto:14px:400:normal" },
                          { $content: "Add a comment\u2026" },
                          { $id: "placeholder-area", traverse: "0" },
                          { $id: "simple-box", traverse: "0:1:0" },
                          { $id: "header", traverse: "0:4:0:1:0" },
                          { $id: "sections", traverse: "0:0:4:0:1:0" },
                          { $id: "comments", traverse: "1:0:0:4:0:1:0" },
                          { $anchor: "Sort by", shift: "-136:51" },
                          { $text: "Sort by", traverse: "-8:4:0:1:0" }
                        ],
                        min: 6
                      },
                      { $size: 1 }
                    ],
                    item: null,
                    showMore: false,
                    onFailure: "skip",
                    waitForIdle: false,
                    silent: true
                  },
                  {
                    type: "paste",
                    text: "{{summary}}",
                    selectorType: "ai",
                    silent: true
                  },
                  {
                    type: "click",
                    selectorType: "ai",
                    selector: [
                      {
                        $matches: [
                          { $tag: "SPAN" },
                          { $role: "text" },
                          { $class: "yt-core-attributed-string" },
                          {
                            $class: "yt-core-attributed-string--white-space-no-wrap"
                          },
                          { $attribute: "role=text" },
                          { $style: "Roboto:14px:500:normal" },
                          { $content: "Comment" },
                          { $id: "submit-button", traverse: "0:0:0:0" },
                          { $id: "buttons", traverse: "1:0:0:0:0" },
                          { $id: "footer", traverse: "6:1:0:0:0:0" },
                          { $id: "main", traverse: "7:6:1:0:0:0:0" },
                          {
                            $id: "thumbnail-input-row",
                            traverse: "1:7:6:1:0:0:0:0"
                          },
                          { $anchor: "Cancel", shift: "92:0" },
                          { $text: "Cancel", traverse: "-5:1:0:0:0:0" }
                        ],
                        min: 7
                      },
                      { $size: 1 }
                    ],
                    item: null,
                    showMore: false,
                    onFailure: "skip",
                    waitForIdle: false,
                    silent: true
                  },
                  {
                    type: "calc",
                    func: "call-internal-method",
                    method: "add-rate-us"
                  }
                ]
              }
            ]
          },
          {
            meta: {
              name: "explain",
              title: "Explain",
              description: "Simplifies and explains complex concepts, facts, abbreviations.",
              category: "Productivity",
              emoji: "\u269B\uFE0F"
            },
            steps: [
              {
                condition: "{{selection}}",
                label: "TEXT IS SELECTED",
                type: "group",
                steps: [
                  {
                    type: "calc",
                    func: "set",
                    param: "query",
                    format: "",
                    value: "{{selection}}"
                  },
                  { type: "jump", to: "EXPLAIN" }
                ]
              },
              {
                condition: "{{selection}} = ",
                label: "MENU",
                type: "group",
                steps: [
                  {
                    label: "EXPLAIN MENU",
                    type: "ask",
                    message: "![icon](/img/commands/education-atom-02.svg) What would you like me to explain? Press Enter to parse from the opened web page.\n",
                    options: null,
                    default: "{{page}}",
                    optionsInvalid: false,
                    param: "query"
                  },
                  {
                    condition: "{{query}} != {{page}}",
                    type: "jump",
                    to: "EXPLAIN"
                  },
                  {
                    condition: "{{query}} = {{page}}",
                    type: "jump",
                    to: "EXPLAIN PAGE"
                  }
                ]
              },
              {
                label: "EXPLAIN",
                type: "group",
                steps: [
                  {
                    type: "calc",
                    param: "information",
                    value: "{{serp {{query}} crawl=all}}",
                    func: "set",
                    format: ""
                  },
                  {
                    type: "gpt",
                    onCodeClick: "send-text",
                    prompt: "Please ignore all previous instructions. Only respond in {{language}}.\n\nYour goal is to aid learning of new topics in an easily understandable way. Complete two tasks for me and provide a comprehensive response:\n\n1) Simplify and clarify the topics or query I inquire about.\n- Use simple language to make it easy for me to grasp any concepts or complicated topics.\n- Explanation should contain a brief text followed by a bulleted list.\n- Base your answers on your inherent knowledge and [Additional information from the web].\n- Ensure the inclusion of relevant links in a fully rendered markdown format - [\u278A](URL).\n- Every URL should correspond to only one symbol like \u278D\n- Do not hallucinate facts or information.\n- Do not use any other tools.\n- Avoid general phrases.\n\n2) Generate 3 short and concise related queries to [Topic or query for you to explain].\n- Related queries should be brief and avoid repeating my topic or query entirely or partially.\n- Generate queries for which you don't have answers in your response yet.\n- Wrap every relevant query into a markdown code block\n\nDo not add any titles or other sections to your answer, strictly follow the [REQUIRED FORMAT]:\n\n... Brief explanation text ...\n\n- Brief bullet point, ending with a markdown link, e.g. [\u278A](URL)\n- Brief bullet point, ending with a markdown link, e.g. [\u278A](URL)\n- ..do not use 2 level bullet points..\n\n**Related queries:**\n\n```markdown\nShort related query\n```\n```markdown\nShort related query\n```\n....\n-----\n\n[Topic or query for you to explain]: {{query}}\n\n\n[Additional information from the web]:\n{{information}}\n\n\n[Your response in the required format]:",
                    param: "response"
                  },
                  {
                    type: "ask",
                    param: "after-explain",
                    message: "\u{1F4AC} Type a follow-up question or pick an option:",
                    options: [
                      { label: "\u2705 DONE", value: "done" },
                      { label: "\u2753 ASK", value: "follow" },
                      { label: "\u{1F50D} RESEARCH", value: "research" },
                      { label: "\u{1F4AC} NEW QUESTION", value: "new-task" },
                      "$custom"
                    ],
                    default: "",
                    optionsInvalid: false
                  },
                  {
                    condition: "{{after-explain-option}} = $custom",
                    type: "group",
                    steps: [
                      {
                        type: "calc",
                        param: "question",
                        value: "{{after-explain}}",
                        func: "set",
                        format: ""
                      },
                      { type: "jump", to: "GENERATE QUERY" }
                    ]
                  },
                  {
                    condition: "{{after-explain}} = research",
                    label: "IF RESEARCH",
                    type: "group",
                    steps: [
                      {
                        condition: "{{selection}}",
                        type: "calc",
                        func: "set",
                        param: "query",
                        format: "",
                        value: "{{selection}}"
                      },
                      {
                        type: "calc",
                        param: "selection",
                        func: "set",
                        format: "",
                        value: ""
                      },
                      { type: "command", name: "Search", inputs: ["{{query}}"] },
                      { type: "stop" }
                    ]
                  },
                  {
                    condition: "{{after-explain}} = follow",
                    type: "jump",
                    to: "FOLLOW UP"
                  },
                  {
                    condition: "{{after-explain}} = new-task",
                    type: "jump",
                    to: "EXPLAIN MENU"
                  },
                  { condition: "{{after-explain}} = done", type: "stop" }
                ]
              },
              {
                label: "EXPLAIN PAGE",
                type: "group",
                steps: [
                  {
                    type: "gpt",
                    prompt: "Please ignore all previous instructions. Only respond in {{language}}.\n\nAs an expert educator, I request you to simplify and clarify the provided [webpage content].\n\n- Do not hallucinate facts or information.\n\nFollow the instructions:\n- Review the given webpage content, focusing on its key points, and explain them to me.\n- Use simple language to make it easy for me to grasp any concepts or complicated topics.\n- Rely on your inherent knowledge and the information from the webpage.\n- Do not use any other tools.\n- Do not hallucinate facts or information.\n- Avoid generic statements and irrelevant information.\n- Ensure the accuracy and factual nature of all provided information.\n- Format your response using markdown features, use bold text and 1-level bullet point list for readability. Do not use titles and 2-level bullet points.\n\n[Webpage content for you to explain]: {{page}}\n\n[Brief explanation in {{language}}]:",
                    param: "response"
                  },
                  {
                    label: "ASK EXPLAIN PAGE",
                    type: "ask",
                    param: "after-explain-page",
                    options: [
                      { label: "\u2705 DONE", value: "done" },
                      { label: "\u2753 ASK", value: "follow" },
                      { label: "\u{1F4AC} NEW QUESTION", value: "new-task" },
                      "$custom"
                    ],
                    message: "\u{1F4AC} Type a follow-up question or pick an option:",
                    default: "",
                    optionsInvalid: false
                  },
                  { condition: "{{after-explain-page}} = done", type: "stop" },
                  {
                    condition: "{{after-explain-page}} = new-task",
                    type: "jump",
                    to: "EXPLAIN MENU"
                  },
                  {
                    condition: "{{after-explain-page}} = follow",
                    type: "jump",
                    to: "PAGE FOLLOW UP"
                  },
                  {
                    condition: "{{after-explain-page-option}} = $custom",
                    label: "CUSTOM F-U",
                    type: "group",
                    steps: [
                      {
                        type: "calc",
                        value: "{{after-explain-page}}",
                        func: "set",
                        param: "question",
                        format: ""
                      },
                      { type: "jump", to: "FOLLOW UP GPT" }
                    ]
                  },
                  {
                    label: "PAGE FOLLOW UP",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        message: "\u{1F4AC} Type a follow-up question",
                        param: "question",
                        options: null,
                        default: ""
                      },
                      {
                        label: "FOLLOW UP GPT",
                        type: "gpt",
                        prompt: "Please ignore all previous instructions. Only respond in {{language}}.\n\nAs a Research Agent, answer [my follow-up question] regarding [Your Previous Response].\n\n- Use simple language to make it easy for me to grasp any concepts or complicated topics.\n- Rely on your inherent knowledge and the information from the webpage.\n- Do not use any other tools.\n- Do not hallucinate facts or information.\n- Avoid generic statements and irrelevant information.\n- Ensure the accuracy and factual nature of all provided information.\n- Format your response using markdown features, use bold text and 1-level bullet point list for readability. Do not use titles and 2-level bullet points.\n\n\n[My Follow-Up Question]:\n{{question}}\n\n\n[Your Previous Response]:\n{{response}}\n\n\n[Webpage content]:\n{{page}}\n\n\n[Brief response]:",
                        param: "response"
                      },
                      { type: "jump", to: "ASK EXPLAIN PAGE" }
                    ]
                  }
                ]
              },
              {
                label: "FOLLOW UP",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    message: "\u{1F4AC} Type your follow-up question.",
                    param: "question",
                    options: null,
                    default: ""
                  },
                  {
                    condition: "{{p1}} = NOT USED",
                    label: "GENERATE QUERY",
                    type: "group",
                    steps: [
                      {
                        label: "GENERATE FOLLOW UP SERP",
                        type: "gpt",
                        prompt: "Please ignore all previous instructions.\nI want you to only respond in {{language}}.\n\nAct as an AI language model expert. Your task involves handling two queries: an initial query and a follow-up query.\n- Merge these into a concise final query that incorporates the follow-up query in the context of the initial query.\n- The final query should refer to the main keyword or topic of the initial query, but not repeat the initial query.\n- Make sure the final query is short, related to the follow-up, and mentions the first query in two words.\n- Your response should include only the final query and nothing else\n\n[INITIAL QUERY]: {{query}}\n\n[FOLLOW-UP QUERY]: {{question}}\n\n[FINAL QUERY]:",
                        param: "finalquery",
                        silent: true
                      },
                      {
                        label: "FORM SERP",
                        type: "calc",
                        value: "{{serp {{finalquery}}}}",
                        func: "set",
                        param: "information",
                        format: ""
                      },
                      {
                        label: "FOLLOW UP = MAIN",
                        type: "calc",
                        value: "{{finalquery}}",
                        func: "set",
                        param: "query",
                        format: ""
                      }
                    ]
                  },
                  {
                    type: "gpt",
                    prompt: "Please ignore all previous instructions. Only respond in {{language}}.\n\nThe goal is to aid learning about new topics in an easily understandable way.\n\nI would like you to complete two tasks for me and provide a short and clear response:\n\n1) Provide a response to my follow-up question.\n- Do not echo my question.\n- Use simple language to make it easy for me to grasp any concepts or complicated topics.\n- Format your answer with markdown, such as using 1 level bullet points for clarity, especially if the text has multiple items. Avoid using headings.\n- Base your answers on your inherent knowledge.\n- Do not hallucinate facts or information.\n- Do not use any other tools.\n- Avoid general phrases.\n\n2) Generate 3 short and concise related queries to [My Follow-Up Question]\n- Related queries should be brief and avoid repeating [My Follow-Up Question] entirely or partially.\n- Generate queries for which you don't have answers in your response yet.\n- Wrap every relevant query into a markdown code block\n\n[FOLLOW THE RESPONSE FORMAT]:\n\n...Clear and brief response to my follow-up question...\n\n**Related queries:**\n\n```markdown\nShort related query\n```\n\n ```markdown\nShort related query\n```\n....\n-----\n\n[My Follow-Up Question]: {{question}}\n\n\nUse [Additional information from the web] if relevant:\n\n{{information}}\n\n\n[YOUR BRIEF RESPONSE TO MY FOLLOW-UP QUESTION WITH RELATED QUERIES]:",
                    onCodeClick: "send-text",
                    param: "response"
                  },
                  {
                    type: "ask",
                    param: "followup-next",
                    options: [
                      { label: "\u2705 DONE", value: "done" },
                      { label: "\u2753 ASK", value: "followup" },
                      { label: "\u{1F4AC} NEW QUESTION", value: "new-task" },
                      "$custom"
                    ],
                    message: "\u{1F4AC} Type a follow-up question or pick an option:",
                    default: "",
                    optionsInvalid: false
                  },
                  {
                    condition: "{{followup-next-option}} = $custom",
                    label: "OPTION = CUSTOM",
                    type: "group",
                    steps: [
                      {
                        type: "calc",
                        value: "{{followup-next}}",
                        func: "set",
                        param: "question",
                        format: ""
                      },
                      { type: "jump", to: "GENERATE QUERY" }
                    ]
                  },
                  {
                    condition: "{{followup-next}} = new-task",
                    type: "jump",
                    to: "EXPLAIN MENU"
                  },
                  {
                    condition: "{{followup-next}} = followup",
                    type: "jump",
                    to: "FOLLOW UP"
                  },
                  {
                    condition: "{{followup-next}} = done",
                    label: "OPTION = DONE",
                    type: "stop"
                  }
                ]
              }
            ]
          },
          {
            meta: {
              name: "alternatives",
              title: "Alternatives",
              category: "Productivity",
              description: "Generate a list of alternative products or topics.",
              emoji: "\u{1F500}"
            },
            steps: [
              {
                say: "Sure! What product or service you want me to list alternatives for? Leave empty to parse from the opened page:\n"
              },
              { ask: "question", default: "{{page}}" },
              {
                gpt: "Please ignore all previous instructions. I want you to only answer in {{language}}. Generate a numbered list of up to 8 alternatives to the product, service or topic described in the web page or text. For every alternative, very shortly list pros and cons you know of (if any), and website link (if applicable and you know it).\n\n[WEB PAGE OR TEXT]:\n{{page}}\n\n[EXPECTED FORMAT]:\n1. **[Alternative Name]**: [Short description] [Link]\n  - Pros: [pros, if any]\n  - Cons: [cons, if any]\n\n\n[ALTERNATIVES]:"
              }
            ]
          },
          {
            meta: {
              name: "extract",
              title: "Extract data",
              category: "Productivity",
              description: "Extract data and contacts from the web page.",
              emoji: "\u{1F4F6}"
            },
            steps: [
              {
                type: "ask",
                message: "What would you like me to extract from page?\n\nPick or type a custom option: financial data, job listing, event details, reviews and comments, schedules and prices, product information, sports statistics, etc.\n",
                options: [
                  { label: "\u{1F9FE} TABULAR", value: "tabular" },
                  { label: "\u{1F4DA} FACTS", value: "facts" },
                  { label: "\u{1F4DE} CONTACTS", value: "contacts" },
                  { label: "\u{1F4CC} TODO LIST", value: "todo" },
                  { label: "\u{1F50D} SEO KEYWORDS", value: "keywords" },
                  { value: "$custom" }
                ],
                param: "what"
              },
              {
                condition: "{{what}} = keywords",
                type: "command",
                name: "extract-seo-keywords",
                inputs: ["{{page}}"]
              },
              {
                condition: "{{what}} = tabular",
                type: "gpt",
                prompt: "Please ignore all previous instructions. Extract data from the web page text. Format in a table with two columns Key and Value. Answer in {{language}}.\n\n[FORMAT EXAMPLE]:\n| Key | Value | | --- | ----------- | | Product Name | XYZ | | Price | 10.5 USD | | Description | ... | | Features | ... |\n\n[TEXT]:\n{{page}}\n\n[DATA]:"
              },
              {
                condition: "{{what}} = contacts",
                type: "gpt",
                prompt: "Please ignore all previous instructions. Extract contact details (personal and business) from the web page text. For every contact extract their address, email, phone and any extra information describing the person or business. Format result in a Table. Answer in {{language}}.\n\n[FORMAT EXAMPLE]:\n| Name | Is Business | Email | Address | Phone | Extra | | --- | --- | --- | --- | --- | --- | | John Doe | No | john.doe@ibm.com | Armonk, New York, United States | N/A | ... | | XYZ LTD | Yes | contact@xyz.com | Helsinki, Finland | +358 41 123 4567 | ... |\n\n[TEXT]:\n{{page}}\n\n[CONTACTS]:"
              },
              {
                condition: "{{what}} = facts",
                type: "gpt",
                prompt: "Please ignore all previous instructions. I want you to only answer in {{language}}. Extract a list of facts from the given web page content, if any. Keep facts short and easy to understand. Write the most important facts first. Format result in a bullet point list.\n\n[WEB PAGE TITLE]:\n{{desc}}\n\n[WEB PAGE CONTENT]:\n{{page}}\n\n[FACTS LIST]:"
              },
              {
                condition: "{{what}} = todo",
                type: "gpt",
                prompt: "Please ignore all previous instructions. I want you to only answer in {{language}}. Extract a TODO list from this web page (e.g. a list of tasks, action items, etc.). If no TODO items found, try to convert the web page text to a todo list. Keep todo items short but understandable.\n\n[WEB PAGE TITLE]:\n{{desc}}\n\n[WEB PAGE CONTENT]:\n{{page}}\n\n[TODO LIST]:"
              },
              {
                condition: "{{what-option}} = $custom",
                type: "gpt",
                prompt: "Please ignore all previous instructions. Extract data from the following web page text and format in appropriate manner, e.g. Markdown table. Answer in {{language}}.\n\n[WHAT TO EXTRACT]:\n{{what}}\n\n[TEXT]:\n{{page}}\n\n[DATA]:"
              }
            ]
          },
          {
            meta: {
              name: "rss",
              title: "Extract RSS",
              description: "Extracts RSS feed from the website into a text file, parameter or a summary.",
              category: "Productivity",
              emoji: "\u{1F4F0}"
            },
            steps: [
              {
                label: "EXTRACT RSS LINK",
                type: "group",
                steps: [
                  {
                    type: "js",
                    code: `const selector
  = 'link[type="application/rss+xml"], link[type="application/atom+xml"]'
const linkElements = document.querySelectorAll(selector)

return Array.from(linkElements)
  .find(e => e.getAttribute('href'))?.getAttribute('href')`,
                    args: "",
                    param: "rss",
                    silent: true
                  },
                  {
                    condition: "{{rss}} =",
                    type: "ask",
                    message: "\u{1F517} Opened web page has no RSS feed link. Copy-paste an RSS link for me:",
                    options: null,
                    param: "rss",
                    default: ""
                  },
                  { condition: "{{rss}} =", type: "stop" }
                ]
              },
              {
                type: "calc",
                func: "set",
                param: "startUrl",
                format: "",
                value: "{{url}}"
              },
              {
                label: "FETCH RSS",
                type: "group",
                steps: [
                  {
                    type: "request",
                    url: "{{rss}}",
                    method: "get",
                    auth: { enabled: false, username: "", password: "" },
                    param: "rssContent",
                    headers: null,
                    body: "",
                    bodyInvalid: true,
                    silent: true
                  },
                  {
                    type: "js",
                    code: `if (typeof args.rssContent?.body !== 'string') return []

try {
  const data = new window.DOMParser()
    .parseFromString(args.rssContent.body, "text/xml")
  const items = Array.from(data.querySelectorAll('item, entry'));
  return items.map(i => {
    const titleElement = i.querySelector('title')
    const title =
      titleElement?.textContent ||
      titleElement?.innerHTML

    const linkElement = i.querySelector('link')
    const link =
      linkElement?.textContent ||
      linkElement?.innerHTML ||
      linkElement?.getAttribute('href')

    const descriptionElement =
      i.querySelector('media\\\\:description, description')
    const description =
      descriptionElement?.textContent ||
      descriptionElement?.innerHTML

    return { title, link, description }
  });
} catch (e) {
  console.log(e)
  return []
}`,
                    param: "feed",
                    args: "rssContent",
                    silent: true
                  },
                  {
                    condition: "{{feed.length}} = 0",
                    type: "say",
                    message: "\u{1F6AB} RSS feed in {{rss}} is empty."
                  },
                  { condition: "{{feed.length}} = 0", type: "stop" }
                ]
              },
              {
                label: "OUTPUT FEED",
                type: "group",
                steps: [
                  {
                    type: "js",
                    code: "const items = args.feed;\nif (items.length === 0)\n  return 'Found no RSS items on this page.'\n\nlet markdownText = `Found ${items.length} RSS items on this page:\\n`;\nitems.forEach((item, index) => {\n  const title = item.title.replace(/\"/g, '\\\\\"');\n  markdownText += `${index + 1}. [${title}](${item.link})\\n`;\n});\n\nreturn markdownText;\n\n",
                    param: "markdownText",
                    args: "feed",
                    silent: true
                  },
                  { type: "say", message: "{{markdownText}}" }
                ]
              },
              {
                label: "HOW MANY",
                type: "group",
                steps: [
                  {
                    label: "HOW MANY",
                    type: "ask",
                    param: "number",
                    message: "How many links to extract? Pick an option, or type numbers, for example, 1-5, 9, 10, 18:",
                    options: [
                      { label: "\u267B\uFE0F ALL", value: "all" },
                      { label: "THE FIRST ONLY", value: 1 },
                      { label: "TOP 5", value: 5 },
                      { label: "TOP 10", value: 10 },
                      { label: "TOP 25", value: 25 },
                      "$custom"
                    ],
                    default: ""
                  },
                  {
                    condition: "{{number}} = all",
                    type: "jump",
                    to: "LINK EXTRACTION"
                  },
                  {
                    type: "js",
                    code: "const { number, feed } = args\n\nif (typeof number === 'number') {\n  return feed.slice(0, number);\n}\n\nconst parts = (number || '').split(/[\\s,]+/).map(part => part.trim());\nconst numbers = [];\n\nparts.forEach(part => {\n    if (part.includes('-')) {\n        const [start, end] = part.split('-').map(Number);\n        for (let i = start; i <= end; i++) {\n            numbers.push(i);\n        }\n    } else {\n        numbers.push(Number(part));\n    }\n});\n\nreturn feed.filter((_, index) => numbers.includes(index + 1));",
                    args: "feed, number",
                    param: "feed",
                    silent: true
                  }
                ]
              },
              {
                label: "LINKS FETCHING",
                type: "loop",
                steps: [
                  {
                    label: "FETCH PAGE",
                    type: "group",
                    steps: [
                      {
                        type: "calc",
                        func: "set",
                        param: "webpage",
                        format: "",
                        value: "{{page {{item.link}}}}"
                      },
                      { type: "wait", for: "0.5s", silent: true },
                      {
                        condition: "{{webpage}} = Failed fetching URL",
                        type: "say",
                        message: "\u{1F916} The [page]({{item.link}}) cannot be fetched, navigating."
                      },
                      {
                        condition: "{{webpage}} = Failed fetching URL",
                        type: "jump",
                        to: "NAVIGATE STEP"
                      },
                      {
                        condition: "{{webpage}} ~= /(?s)^.{200,}$/gm",
                        type: "jump",
                        to: "COMBINE DATA"
                      }
                    ]
                  },
                  {
                    label: "NAVIGATE STEP",
                    type: "navigate",
                    url: "{{item.link}}",
                    waitForIdle: false,
                    silent: true
                  },
                  { type: "control", action: "show" },
                  {
                    type: "wait",
                    for: "text-to-appear",
                    silent: true,
                    text: " ",
                    timeout: 1e3
                  },
                  { type: "calc", func: "clone", from: "page", to: "webpage" },
                  {
                    label: "COMBINE DATA",
                    type: "calc",
                    func: "set",
                    param: "content",
                    format: "json",
                    value: {
                      title: "{{item.title}}",
                      description: "{{item.description}}",
                      content: "{{webpage}}",
                      url: "{{item.link}}"
                    }
                  },
                  {
                    type: "calc",
                    func: "list-add",
                    list: "contents",
                    index: "last",
                    item: "content"
                  },
                  { type: "calc", func: "clone", from: "index", to: "index1" },
                  { type: "calc", func: "increment", param: "index1", delta: 1 },
                  {
                    type: "say",
                    message: "\u2705  The page content {{index1}} / {{feed.length}} has been extracted."
                  }
                ],
                list: "feed"
              },
              { type: "control", action: "show" },
              {
                label: "ASK FOR ACTION",
                type: "ask",
                param: "action",
                message: "What do you like me to do with the page contents?",
                options: [
                  { label: "\u{1F5C2} EXPORT", value: "export" },
                  { label: "\u{1FA73} SUMMARIZE", value: "summary" },
                  { label: "\u{1F6E0} SAVE TO PARAMETER", value: "save" }
                ],
                default: ""
              },
              {
                condition: "{{action}} = export",
                label: "EXPORT",
                type: "group",
                steps: [{ type: "export", what: "param", param: "contents" }]
              },
              {
                condition: "{{action}} = save",
                label: "SAVE TRANSCRIPTS",
                type: "group",
                steps: [
                  {
                    type: "calc",
                    param: "g.rss",
                    value: "{{contents}}",
                    func: "set",
                    format: ""
                  },
                  {
                    type: "say",
                    message: "RSS feed content is saved to {{g.rss}}. You can reference it in your custom commands or chat.",
                    interpolate: false
                  }
                ]
              },
              {
                condition: "{{action}} = summary",
                label: "SUMMARY",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    param: "format",
                    message: "Pick a summary format or type custom.",
                    options: [
                      {
                        label: "\u2B07\uFE0F SHORT",
                        value: "Please summarize web page content into a short summary of 1 paragraph maximum."
                      },
                      {
                        label: "\u{1F511} KEY TAKEAWAYS",
                        value: "Please summarize web page content into a bullet point list of key takeaways."
                      },
                      {
                        label: "\u{1F4F0} BLOG POST",
                        value: "Please convert web page content into a short blog post."
                      },
                      {
                        label: "\u{1F3AC} YOUTUBE SCRIPT",
                        value: "Please convert web page content into a video script for youtube video."
                      },
                      {
                        label: "\u{1F426} TWEET",
                        value: "Please convert web page content into a concise informative tweet."
                      },
                      "$custom"
                    ],
                    default: ""
                  },
                  {
                    type: "loop",
                    steps: [
                      {
                        type: "calc",
                        value: "{{item.content}}",
                        func: "set",
                        param: "content",
                        format: ""
                      },
                      {
                        type: "calc",
                        func: "clone",
                        from: "index",
                        to: "number"
                      },
                      {
                        type: "calc",
                        func: "increment",
                        param: "number",
                        delta: 1
                      },
                      {
                        type: "gpt",
                        prompt: "Please ignore all previous instructions. I want you to only answer in {{language}}. Your goal is to perform the following INSTRUCTIONS on a WEB PAGE CONTENT. Only return a resulting text without explanations.\n\n\n[INSTRUCTIONS]:\n- Please start with the number {{number}}, followed by a markdown link. \n- {{format}}\n\n[FOLLOW THE RESPONSE FORMAT]:\n{{number}}. [{{item.title}}]({{item.url}}).\n\n... your response according to my instructions ...\n\n\n[WEB PAGE CONTENT]:\n\n[{{item.title}}]({{item.url}})\n\n{{item.content}}\n\n\n[RESULT]:"
                      },
                      {
                        type: "calc",
                        param: "summaryObject",
                        value: {
                          title: "{{item.title}}",
                          description: "{{item.description}}",
                          url: "{{item.url}}",
                          summary: "{{gpt}}",
                          content: "{{item.content}}"
                        },
                        func: "set",
                        format: "json"
                      },
                      {
                        type: "calc",
                        list: "summaries",
                        func: "list-add",
                        index: "last",
                        item: "summaryObject"
                      },
                      {
                        condition: "{{allSummaries}}",
                        type: "calc",
                        func: "set",
                        param: "allSummaries",
                        format: "",
                        value: "{{allSummaries}} \n\n{{gpt}}"
                      },
                      {
                        condition: "{{allSummaries}} =",
                        type: "calc",
                        func: "set",
                        param: "allSummaries",
                        format: "",
                        value: "{{gpt}}"
                      },
                      { type: "wait", for: "0.5s", silent: true }
                    ],
                    list: "contents"
                  },
                  {
                    condition: "{{startUrl}} != {{url}}",
                    label: "NAVIGATE BACK",
                    type: "group",
                    steps: [
                      {
                        type: "navigate",
                        url: "{{startUrl}}",
                        waitForIdle: true,
                        silent: false
                      },
                      { type: "control", action: "show" }
                    ]
                  },
                  {
                    label: "FINAL ASK",
                    type: "ask",
                    message: "What would you like me to do with the summaries?",
                    options: [
                      { label: "\u{1F50D} SHOW ALL", value: "show" },
                      { label: "\u{1F4DD} EXPORT TEXT", value: "text" },
                      { label: "\u{1F5C2} EXPORT JSON", value: "export" },
                      { label: "\u{1F6E0} SAVE TO PARAMETER", value: "save" }
                    ],
                    param: "action",
                    default: "",
                    optionsInvalid: false
                  },
                  {
                    condition: "{{action}} = show",
                    label: "SHOW",
                    type: "group",
                    steps: [{ type: "say", message: "{{allSummaries}}" }]
                  },
                  {
                    condition: "{{action}} = text",
                    label: "EXPORT TEXT",
                    type: "group",
                    steps: [
                      { type: "export", what: "param", param: "allSummaries" }
                    ]
                  },
                  {
                    condition: "{{action}} = export",
                    label: "EXPORT JSON",
                    type: "group",
                    steps: [
                      { type: "export", what: "param", param: "summaries" }
                    ]
                  },
                  {
                    condition: "{{action}} = save",
                    label: "SAVE TRANSCRIPTS",
                    type: "group",
                    steps: [
                      {
                        type: "calc",
                        param: "g.summaries",
                        value: "{{summaries}}",
                        func: "set",
                        format: ""
                      },
                      {
                        type: "say",
                        message: "RSS summaries are saved to {{g.summaries}}. You can reference them in your custom commands or chat.",
                        interpolate: false
                      }
                    ]
                  }
                ]
              },
              { type: "stop" }
            ]
          },
          {
            meta: {
              name: "rss-summary",
              title: "Today's RSS Summary",
              description: "Summarizes today's RSS feed into a concise, easy-to-read digest.",
              category: "Productivity",
              emoji: "\u{1F4F0}"
            },
            steps: [
              {
                type: "ask",
                message: "\u{1F517} Please copy-paste an RSS link:",
                options: null,
                param: "rss",
                default: ""
              },
              {
                type: "calc",
                func: "set",
                param: "startUrl",
                format: "",
                value: "{{url}}"
              },
              {
                label: "FETCH RSS",
                type: "group",
                steps: [
                  {
                    type: "request",
                    url: "{{rss}}",
                    method: "get",
                    auth: { enabled: false, username: "", password: "" },
                    param: "rssContent",
                    headers: null,
                    body: "",
                    bodyInvalid: true,
                    silent: true
                  },
                  {
                    label: "CREATE FEED",
                    type: "js",
                    code: `if (typeof args.rssContent?.body !== 'string') return []

try {
  const data = new window.DOMParser()
    .parseFromString(args.rssContent.body, "text/xml")
  const items = Array.from(data.querySelectorAll('item, entry'));

  return items.map(i => {
    const titleElement = i.querySelector('title')
    const title =
      titleElement?.textContent ||
      titleElement?.innerHTML

    const linkElement = i.querySelector('link')
    const link =
      linkElement?.textContent ||
      linkElement?.innerHTML ||
      linkElement?.getAttribute('href')

    const descriptionElement =
      i.querySelector('media\\\\:description, description')
    const description =
      descriptionElement?.textContent ||
      descriptionElement?.innerHTML

    const pubDateElement = i.querySelector('pubDate, updated')
    const date = pubDateElement?.textContent || pubDateElement?.innerHTML

    return { title, link, description, date }
  });
} catch (e) {
  console.log(e)
  return []
}`,
                    param: "feed",
                    args: "rssContent",
                    silent: true
                  },
                  {
                    condition: "{{feed.length}} = 0",
                    type: "say",
                    message: "\u{1F6AB} RSS feed in {{rss}} is empty."
                  },
                  { condition: "{{feed.length}} = 0", type: "stop" },
                  {
                    label: "TODAY",
                    type: "js",
                    code: "let dateMatch = (date.match(/\\b\\d{1,2}\\b/) || [0])[0];\nreturn dateMatch;",
                    param: "today",
                    args: "date",
                    silent: true
                  },
                  {
                    label: "FILTERED FEED",
                    type: "js",
                    code: "let filteredFeed = feed.filter(item => {\n  let dateParts = item.date.split(' ');\n\n  // Ensure we get the correct part of the date\n  let itemDay = dateParts[1];\n\n  // Convert today to a number for comparison\n  let todayNum = parseInt(today, 10);\n\n  // Convert itemDay to a number and compare\n  return parseInt(itemDay, 10) === todayNum;\n});\n\nreturn filteredFeed;",
                    param: "filteredFeed",
                    args: "feed, today",
                    silent: true
                  },
                  {
                    condition: "{{filteredFeed.length}} = 0",
                    type: "say",
                    message: "\u{1F6AB} No posts dated {{date}} found in the [RSS feed]({{rss}})."
                  },
                  { condition: "{{filteredFeed.length}} = 0", type: "stop" }
                ]
              },
              {
                label: "OUTPUT FEED",
                type: "group",
                steps: [
                  {
                    type: "js",
                    code: "const items = args.filteredFeed;\nif (items.length === 0)\n  return 'Found no RSS items on this page.'\n\nlet markdownText = `**Found ${items.length} RSS items dated ${date}:**\\n`;\nitems.forEach((item, index) => {\n  const title = item.title.replace(/\"/g, '\\\\\"');\n  markdownText += `${index + 1}. [${title}](${item.link})\\n`;\n});\n\nreturn markdownText;\n\n",
                    param: "markdownText",
                    args: "filteredFeed, date",
                    silent: true
                  },
                  { type: "say", message: "{{markdownText}}" }
                ]
              },
              {
                label: "HOW MANY",
                type: "group",
                steps: [
                  {
                    label: "HOW MANY",
                    type: "ask",
                    param: "number",
                    message: "How many pages to summarize? Pick an option, or type numbers, for example, 1-5, 9, 10, 18:",
                    options: [
                      { label: "\u267B\uFE0F ALL", value: "all" },
                      { label: "THE FIRST ONLY", value: 1 },
                      { label: "TOP 5", value: 5 },
                      { label: "TOP 10", value: 10 },
                      { label: "TOP 25", value: 25 },
                      "$custom"
                    ],
                    default: ""
                  },
                  {
                    condition: "{{number}} = all",
                    type: "jump",
                    to: "LINKS FETCHING"
                  },
                  {
                    type: "js",
                    code: "const { number, filteredFeed } = args\n\nif (typeof number === 'number') {\n  return filteredFeed.slice(0, number);\n}\n\nconst parts = (number || '').split(/[\\s,]+/).map(part => part.trim());\nconst numbers = [];\n\nparts.forEach(part => {\n    if (part.includes('-')) {\n        const [start, end] = part.split('-').map(Number);\n        for (let i = start; i <= end; i++) {\n            numbers.push(i);\n        }\n    } else {\n        numbers.push(Number(part));\n    }\n});\n\nreturn filteredFeed.filter((_, index) => numbers.includes(index + 1));",
                    args: "filteredFeed, number",
                    param: "filteredFeed",
                    silent: true
                  }
                ]
              },
              {
                label: "LINKS FETCHING",
                type: "loop",
                steps: [
                  {
                    label: "FETCH PAGE",
                    type: "group",
                    steps: [
                      {
                        type: "calc",
                        func: "set",
                        param: "webpage",
                        format: "",
                        value: "{{page {{item.link}}}}"
                      },
                      { type: "wait", for: "0.5s", silent: true },
                      {
                        condition: "{{webpage}} = Failed fetching URL",
                        type: "say",
                        message: "\u{1F916} The [page]({{item.link}}) cannot be fetched, navigating."
                      },
                      {
                        condition: "{{webpage}} = Failed fetching URL",
                        type: "jump",
                        to: "NAVIGATE STEP"
                      },
                      {
                        condition: ["{{webpage}} ~= /(?s)^.{200,}$/gm"],
                        type: "jump",
                        to: "COMBINE DATA"
                      }
                    ]
                  },
                  {
                    label: "NAVIGATE STEP",
                    type: "navigate",
                    url: "{{item.link}}",
                    waitForIdle: false,
                    silent: true
                  },
                  { type: "control", action: "show" },
                  {
                    type: "wait",
                    for: "text-to-appear",
                    text: " ",
                    timeout: 1e3,
                    silent: true
                  },
                  { type: "calc", func: "clone", from: "page", to: "webpage" },
                  {
                    label: "COMBINE DATA",
                    type: "calc",
                    func: "set",
                    param: "content",
                    format: "json",
                    value: {
                      title: "{{item.title}}",
                      description: "{{item.description}}",
                      content: "{{webpage}}",
                      url: "{{item.link}}"
                    }
                  },
                  {
                    type: "calc",
                    func: "list-add",
                    list: "contents",
                    index: "last",
                    item: "content"
                  },
                  { type: "calc", func: "clone", from: "index", to: "index1" },
                  { type: "calc", func: "increment", param: "index1", delta: 1 },
                  {
                    type: "say",
                    message: "\u2705  The page content {{index1}} / {{filteredFeed.length}} has been extracted."
                  }
                ],
                list: "filteredFeed"
              },
              { type: "control", action: "show" },
              {
                label: "ASK FOR ACTION",
                type: "ask",
                param: "action",
                message: "What do you like me to do with the page contents?",
                options: [
                  { label: "\u{1F5C2} EXPORT", value: "export" },
                  { label: "\u{1FA73} SUMMARIZE", value: "summary" },
                  { label: "\u{1F6E0} SAVE TO PARAMETER", value: "save" }
                ],
                default: "",
                optionsInvalid: false
              },
              {
                condition: "{{action}} = export",
                label: "EXPORT",
                type: "group",
                steps: [{ type: "export", what: "param", param: "contents" }]
              },
              {
                condition: "{{action}} = save",
                label: "SAVE TRANSCRIPTS",
                type: "group",
                steps: [
                  {
                    type: "calc",
                    param: "g.rss",
                    value: "{{contents}}",
                    func: "set",
                    format: ""
                  },
                  {
                    type: "say",
                    message: "RSS feed content is saved to {{g.rss}}. You can reference it in your custom commands or chat.",
                    interpolate: false
                  }
                ]
              },
              {
                condition: "{{action}} = summary",
                label: "SUMMARY",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    param: "format",
                    message: "Pick a summary format or type custom.",
                    options: [
                      {
                        label: "\u2B07\uFE0F SHORT",
                        value: "Please summarize web page content into a short summary of 1 paragraph maximum."
                      },
                      {
                        label: "\u{1F511} KEY TAKEAWAYS",
                        value: "Please summarize web page content into a bullet point list of key takeaways."
                      },
                      {
                        label: "\u{1F4F0} BLOG POST",
                        value: "Please convert web page content into a short blog post."
                      },
                      {
                        label: "\u{1F3AC} YOUTUBE SCRIPT",
                        value: "Please convert web page content into a video script for youtube video."
                      },
                      {
                        label: "\u{1F426} TWEET",
                        value: "Please convert web page content into a concise informative tweet."
                      },
                      "$custom"
                    ],
                    default: ""
                  },
                  {
                    type: "loop",
                    steps: [
                      {
                        type: "calc",
                        value: "{{item.content}}",
                        func: "set",
                        param: "content",
                        format: ""
                      },
                      {
                        type: "calc",
                        func: "clone",
                        from: "index",
                        to: "number"
                      },
                      {
                        type: "calc",
                        func: "increment",
                        param: "number",
                        delta: 1
                      },
                      {
                        type: "gpt",
                        prompt: "Please ignore all previous instructions. I want you to only answer in {{language}}. Your goal is to perform the following INSTRUCTIONS on a WEB PAGE CONTENT. Only return a resulting text without explanations.\n\n\n[INSTRUCTIONS]:\n- Please start with the number {{number}}, followed by a markdown link.\n- {{format}}\n\n[FOLLOW THE RESPONSE FORMAT]:\n{{number}}. [{{item.title}}]({{item.url}}).\n\n... your response according to my instructions ...\n\n\n[WEB PAGE CONTENT]:\n\n[{{item.title}}]({{item.url}})\n\n{{item.content}}\n\n\n[RESULT]:"
                      },
                      {
                        type: "calc",
                        param: "summaryObject",
                        value: {
                          title: "{{item.title}}",
                          description: "{{item.description}}",
                          url: "{{item.url}}",
                          summary: "{{gpt}}",
                          content: "{{item.content}}"
                        },
                        func: "set",
                        format: "json"
                      },
                      {
                        type: "calc",
                        list: "summaries",
                        func: "list-add",
                        index: "last",
                        item: "summaryObject"
                      },
                      {
                        condition: "{{allSummaries}}",
                        type: "calc",
                        func: "set",
                        param: "allSummaries",
                        format: "",
                        value: "{{allSummaries}}\n\n{{gpt}}"
                      },
                      {
                        condition: "{{allSummaries}} =",
                        type: "calc",
                        func: "set",
                        param: "allSummaries",
                        format: "",
                        value: "{{gpt}}"
                      },
                      { type: "wait", for: "0.5s", silent: true }
                    ],
                    list: "contents"
                  },
                  {
                    condition: "{{startUrl}} != {{url}}",
                    label: "NAVIGATE BACK",
                    type: "group",
                    steps: [
                      {
                        type: "navigate",
                        url: "{{startUrl}}",
                        waitForIdle: false,
                        silent: true
                      },
                      { type: "control", action: "show" }
                    ]
                  },
                  {
                    label: "FINAL ASK",
                    type: "ask",
                    message: "What would you like me to do with the summaries?",
                    options: [
                      { label: "\u{1F50D} SHOW ALL", value: "show" },
                      { label: "\u{1F4DD} EXPORT TEXT", value: "text" },
                      { label: "\u{1F5C2} EXPORT JSON", value: "export" },
                      { label: "\u{1F6E0} SAVE TO PARAMETER", value: "save" }
                    ],
                    param: "action",
                    default: "",
                    optionsInvalid: false
                  },
                  {
                    condition: "{{action}} = show",
                    label: "SHOW",
                    type: "group",
                    steps: [{ type: "say", message: "{{allSummaries}}" }]
                  },
                  {
                    condition: "{{action}} = text",
                    label: "EXPORT TEXT",
                    type: "group",
                    steps: [
                      { type: "export", what: "param", param: "allSummaries" }
                    ]
                  },
                  {
                    condition: "{{action}} = export",
                    label: "EXPORT JSON",
                    type: "group",
                    steps: [
                      { type: "export", what: "param", param: "summaries" }
                    ]
                  },
                  {
                    condition: "{{action}} = save",
                    label: "SAVE TRANSCRIPTS",
                    type: "group",
                    steps: [
                      {
                        type: "calc",
                        param: "g.summaries",
                        value: "{{summaries}}",
                        func: "set",
                        format: ""
                      },
                      {
                        type: "say",
                        message: "RSS summaries are saved to {{g.summaries}}. You can reference them in your custom commands or chat.",
                        interpolate: false
                      }
                    ]
                  }
                ]
              },
              { type: "stop" }
            ]
          },
          {
            meta: {
              name: "chart",
              title: "Chart",
              category: "Productivity",
              description: "Create charts from your data.",
              emoji: "\u{1F4C8}"
            },
            steps: [
              {
                type: "ask",
                param: "data",
                message: "Data to draw in a chart? E.g.:\n\n- World population for the past century.\n- Series: kg consumed. Labels: Banana, Pineapple, Orange. Data: 5, 10, 20\n\nLeave empty and I will try to parse data from the page.",
                default: "Please try to parse data from the web page: {{page}}"
              },
              {
                type: "ask",
                param: "type",
                message: "Chart type?\n\nSupported types: bar, line, pie, doughnut, polarArea, radar, bubble, scatter etc.\n\nOr press enter to let me guess the best option.",
                default: "Use the best / the most suitable type"
              },
              {
                type: "gpt",
                prompt: `Please ignore all previous instructions.

I would like you to generate a chart preview link, using http://quickchart.io. The chart should have the specified type and data. Please do not echo my prompts, only provide the output URL.

[CHART TYPE]: {{type}}

[CHART DATA]: {{data}}

[REQUIRED OUTPUT FORMAT]: A single markdown link URL (not encoded):

![Chart title](link to the image)

[OUTPUT EXAMPLES, notice URL is not encoded]:

![Bar](https://quickchart.io/chart?c={type:'bar',data:{labels:['Banana','Pineapple','Orange'],datasets:[{label:'Kg consumed',data:[5,10,50]}]}})

![Bar](https://quickchart.io/chart?bkg=white&c={type:'bar',data:{labels:['Q1','Q2','Q3','Q4'],datasets:[{label:'Users',data:[50,60,70,180]},{label:'Revenue',data:[100,200,300,400]}]}})

![Combo Bar Line](https://quickchart.io/chart?c={type:'bar',data:{labels:['January','February','March','April','May','June','July'],datasets:[{type:'line',label:'Dataset 1',borderColor:'rgb(54, 162, 235)',borderWidth:2,fill:false,data:[-33,26,29,89,-41,70,-84]},{type:'bar',label:'Dataset 2',backgroundColor:'rgb(255, 99, 132)',data:[-42,73,-69,-94,-81,18,87],borderColor:'white',borderWidth:2},{type:'bar',label:'Dataset 3',backgroundColor:'rgb(75, 192, 192)',data:[93,60,-15,77,-59,82,-44]}]},options:{responsive:true,title:{display:true,text:'Chart.js Combo Bar Line Chart'},tooltips:{mode:'index',intersect:true}}})

![Scatterplot](https://quickchart.io/chart?c={type:"scatter",data:{datasets:[{label:"Mercury",borderColor:"rgb(255, 99, 132)",backgroundColor:"rgba(255, 99, 132, 0.2)",data:[{x:0.330,y:2439.7}]},{label:"Venus",borderColor:"rgb(54, 162, 235)",backgroundColor:"rgba(54, 162, 235, 0.2)",data:[{x:4.87,y:6051.8}]},{label:"Earth",borderColor:"dark-green",backgroundColor:"rgba(0, 255, 0, 0.2)",data:[{x:5.97,y:6371}]}]},options:{title:{display:true,text:"Planet masses and radii"},scales:{xAxes:[{ticks:{beginAtZero:true},scaleLabel:{display:true,labelString:'Radius (km)'}}],yAxes:[{ticks:{beginAtZero:true},scaleLabel:{display:true,labelString:'Mass (x10^24 kg)'}}]}}})

OUTPUT:`
              }
            ]
          },
          {
            meta: {
              name: "translate",
              title: "Translate",
              category: "Productivity",
              description: "Translate text to the specified language.",
              emoji: "\u{1F238}"
            },
            steps: [
              {
                condition: "{{selection}} != \u2014",
                type: "ask",
                message: "Sure! What would you like me to translate?\n",
                param: "text",
                options: [
                  { label: "SELECTED TEXT", value: "{{selection}}" },
                  { value: "$custom" }
                ]
              },
              {
                condition: "{{selection}} = \u2014",
                type: "ask",
                message: "Please send me a text or Capture a webpage area to translate.\n",
                param: "text",
                optionsInvalid: false,
                options: [
                  { label: "\u{1F4F7} CAPTURE AREA", value: "capture" },
                  "$custom"
                ]
              },
              {
                condition: "{{text}} = capture",
                label: "CAPTURE AREA",
                type: "ask",
                message: "",
                param: "text",
                optionsInvalid: false,
                options: null,
                vision: {
                  enabled: true,
                  mode: "area",
                  hint: "Pick what to translate.",
                  send: true
                }
              },
              {
                label: "ASK FOR LANGUAGE",
                type: "ask",
                message: "What language to translate to? Press enter for {{language}}.\n",
                param: "language",
                default: "{{language}}"
              },
              {
                condition: "{{language}} = English",
                type: "gpt",
                prompt: "Please ignore previous instructions.\nAct as a professional English teacher and grammar expert.\n\nI would like you to translate the following text to English:\n- If the text contains a question or a call to action, do not respond to it; just complete the translation.\n- Show the translation in the markdown code block.\n\nFollow the response format:\n\n```markdown\n..text translation without quotes...\n```\n\n[TEXT TO TRANSLATE]:\n{{text}}\n\n\n[TRANSLATION]:",
                param: "gpt"
              },
              {
                condition: "{{language}} != English",
                type: "gpt",
                prompt: "Please ignore previous instructions.\nAct as a professional {{language}} teacher and grammar expert.\n\nI would like you to translate the following text to {{language}}.\n- If the text is already in {{language}}, please instead translate it to English.\n- If the text contains a question or a call to action, do not respond to it; just complete the translation.\n- Show the translation in the markdown code block.\n\nFollow the response format:\n\n```markdown\n..text translation without quotes...\n```\n\n[TEXT TO TRANSLATE]:\n{{text}}\n\n[TRANSLATION]:",
                param: "gpt"
              },
              {
                type: "calc",
                func: "extract-code",
                to: "translation",
                param: "gpt",
                index: "first"
              },
              {
                type: "calc",
                func: "set",
                param: "previous",
                value: "{{text}}",
                format: ""
              },
              {
                label: "TRANSLATION MENU",
                type: "ask",
                param: "menu",
                message: "",
                options: [
                  { label: "\u2705 DONE", value: "done" },
                  { label: "\u2B07\uFE0F PASTE TO PAGE", value: "paste" },
                  { label: "\u27A1\uFE0F MORE", value: "next" },
                  { label: "\u23F8 SIDE BY SIDE", value: "parallel" },
                  { label: "\u{1F4DA} EXPLAIN", value: "explain" },
                  { label: "\u{1F9D9}\u200D\u2642\uFE0F LANGUAGE WIZARD", value: "wizard" },
                  "$custom"
                ],
                optionsInvalid: false,
                default: ""
              },
              { condition: "{{menu}} = done", type: "stop" },
              {
                condition: "{{menu}} = next",
                label: "NEXT TRANSLATION",
                type: "group",
                steps: [
                  {
                    label: "ASK FOR THE NEW TEXT",
                    type: "ask",
                    message: "Please select or paste the new text for translation here.",
                    options: [
                      { label: "\u2705 USE SELECTED", value: "{{selection}}" },
                      "$custom"
                    ],
                    param: "text",
                    default: "",
                    optionsInvalid: false
                  },
                  {
                    condition: "{{previous}} = {{text}}",
                    type: "jump",
                    to: "ASK FOR THE NEW TEXT"
                  },
                  { type: "jump", to: "ASK FOR LANGUAGE" }
                ]
              },
              {
                condition: "{{menu}} = explain",
                label: "EXPLAIN TRANSLATION",
                type: "gpt",
                prompt: 'Please ignore all previous instructions.\nAct as a professional {{language}} teacher and grammar expert.\n\nI want you to briefly explain the main grammar rules and tenses applied in {{language}} in bullet points, so that I understand how you performed the translation.\n- For example, if you used a word in the plural, indicate how the word formation occurs. If you used a verb in the past tense, say what it is in the infinitive and so on.\n- Do not echo my prompt\n\nStrictly follow the output format:\n\n**Translation to {{language}}:**\n```markdown\n{{translation}}\n```\n\n**Explanation:**\n- ...\n\n\nText you previously translated: "{{text}}"\n\nYour translation to {{language}}: "{{translation}}"\n\n\n[Explanation of the translation]:\n'
              },
              {
                condition: "{{menu}} = paste",
                label: "PASTE: HIDE HARPA",
                type: "control",
                action: "hide"
              },
              {
                condition: "{{menu}} = paste",
                type: "paste",
                text: "{{translation}}",
                mode: null,
                selectorType: "ai",
                selector: null,
                item: null
              },
              {
                condition: "{{menu}} = wizard",
                type: "command",
                name: "Language Wizard",
                inputs: []
              },
              {
                condition: "{{menu}} = parallel",
                label: "PARALLEL",
                type: "group",
                steps: [
                  {
                    type: "gpt",
                    prompt: 'I want you to modify your translation by reformatting it into a markdown table:\n- The table should have 2 columns. In the first row, put the original language in **bold** in the left column (e.g.: **German**), and the translation language in **bold** in the right column (e.g: **English**).\n- Split the source text into sentences. Starting from the second row of the table, put the first sentence in the first column, and its translation in the second column. Continue this format until the text ends.\n- Do not write any additional general phrases, notes, or any other explanations of the translation.\n\nOriginal text: "{{text}}"\n\nYour translation to {{language}}: "{{translation}}"\n\nTRANSLATED TEXT IN THE MARKDOWN TABLE:'
                  }
                ]
              },
              {
                condition: "{{menu-option}} = $custom",
                label: "CUSTOM",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{menu}}" }]
              },
              { type: "jump", to: "TRANSLATION MENU" }
            ]
          },
          {
            meta: {
              name: "grammarly",
              title: "Grammarly",
              category: "Productivity",
              description: "Correct spelling and text grammar.",
              emoji: "\u2705"
            },
            steps: [
              {
                condition: "{{selection}} != \u2014",
                type: "ask",
                message: "Sure! What would you like me to correct?\n",
                param: "text",
                options: [
                  { label: "SELECTED TEXT", value: "{{selection}}" },
                  { value: "$custom" }
                ]
              },
              {
                condition: "{{selection}} = \u2014",
                label: "NO SELECTION",
                type: "ask",
                message: "Sure! What would you like me to correct? Paste text or pick an option.",
                default: "{{page}}",
                param: "text",
                optionsInvalid: false,
                options: [
                  { label: "\u2733\uFE0F WEBPAGE", value: "{{page}}" },
                  { label: "\u{1F4F8} CAPTURE AREA", value: "capture" },
                  "$custom"
                ]
              },
              {
                condition: "{{text}} = capture",
                label: "CAPTURE AREA",
                type: "ask",
                message: "",
                default: "",
                param: "text",
                optionsInvalid: false,
                options: null,
                vision: {
                  enabled: true,
                  mode: "area",
                  hint: "Pick a text on the page to check.",
                  send: true
                }
              },
              {
                label: "TEXT CHECK",
                type: "gpt",
                isolated: true,
                chunkify: {
                  text: "{{text}}",
                  empty: "It looks as if the page has no text content. Or I could not fetch it.\n"
                },
                prompt: 'Ignore all previous instructions.\n\nI want you to correct grammar, spelling and punctuation errors in the following web page content (if any).\n\nIf there are no errors, write "There are no grammar, spelling and punctuation errors" in {{language}}.\n\nIf there are errors, your answer should contain 2 parts:\n1. Corrected text itself in a markdown code block. Rewrite the entire text, not just the sentences where you found errors.\n2. Bullet points listing only sentences with fixed errors, highlighted using  bold markdown formatting.  Show the corrections only, don\'t show the mistakes. For long sentences, show only the part with the fixed error in the bullet point. For example: "- ...it was raining **heavily**..."\n\n\nFor example, for text of two sentences: "Hello, my name is John. How is you doing?", the output should be:\n\n**Correct text:**\n```markdown\nHello, my name is John. How are you doing?\n```\n**Fixes:**\n- How **are** you doing?\n\nDo not hallucinate or make up errors where none exist. If the text is error-free, disregard this response template and simply inform me that there are no errors.\n\nTEXT TO CORRECT:\n{{chunk}}\n\n\nYOUR RESPONSE:',
                param: "gpt"
              },
              {
                label: "MENU",
                type: "ask",
                param: "menu",
                message: "",
                options: [
                  { label: "\u2705 DONE", value: "done" },
                  { label: "\u{1F504} NEXT", value: "next" },
                  { label: "\u2328\uFE0F PASTE TO PAGE", value: "paste" },
                  { label: "\u267B\uFE0F REPHRASE", value: "rephrase" },
                  "$custom"
                ],
                default: "",
                optionsInvalid: false
              },
              { condition: "{{menu}} = done", label: "DONE", type: "stop" },
              {
                condition: "{{menu}} = next",
                label: "NEXT TEXT",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    param: "text",
                    message: "What would you like me to correct?",
                    options: [
                      { label: "SELECTED TEXT", value: "{{selection}}" },
                      "$custom"
                    ],
                    default: "{{page}}",
                    optionsInvalid: false
                  },
                  { type: "jump", to: "TEXT CHECK" }
                ]
              },
              {
                condition: "{{menu}} = paste",
                label: "PASTE TO PAGE",
                type: "group",
                steps: [
                  {
                    type: "calc",
                    func: "extract-code",
                    to: "result",
                    param: "gpt",
                    index: "first"
                  },
                  {
                    condition: "{{result}} = ",
                    type: "say",
                    message: "Nothing to paste. The text seems correct."
                  },
                  {
                    condition: "{{result}}",
                    type: "paste",
                    text: "{{result}}",
                    mode: null,
                    selectorType: "ai",
                    selector: null,
                    item: null
                  },
                  { type: "jump", to: "MENU" }
                ]
              },
              {
                condition: "{{menu}} = rephrase",
                label: "REPHRASE",
                type: "group",
                steps: [
                  {
                    type: "calc",
                    func: "extract-code",
                    to: "result",
                    param: "gpt",
                    index: "first"
                  },
                  {
                    condition: "{{result}} = ",
                    type: "calc",
                    func: "set",
                    param: "result",
                    format: "",
                    value: "text"
                  },
                  { type: "command", name: "Rewrite", inputs: ["{{result}}"] },
                  { type: "stop" }
                ]
              },
              {
                condition: "{{menu-option}} = $custom",
                label: "CUSTOM",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{menu}}" }]
              }
            ]
          },
          {
            meta: {
              name: "financial-quote",
              title: "Financial quote",
              description: "Get latest trading price for a stock, company, or currency pair from Yahoo Finance.",
              category: "Productivity",
              emoji: "\u{1F4B9}"
            },
            steps: [
              {
                type: "ask",
                param: "search",
                message: "Enter a ticker symbol, e.g. **BTC-USD** or **APPL**:",
                options: null,
                default: "BTC-USD"
              },
              { type: "calc", func: "encode-url", to: "search", param: "search" },
              {
                type: "calc",
                func: "set",
                param: "html",
                format: "text",
                value: "{{page https://finance.yahoo.com/lookup?s={{search}} type=html}}"
              },
              {
                type: "calc",
                func: "match",
                regex: '/<tr class="data-row[^>]+><td[^>]+><a[^>]+>(?<ticket>[^<]+)<\\/a><\\/td><td[^>]+>(?<name>[^<]+)<\\/td><td[^>]+>(?<value>[^<]+)/mi',
                to: "quote",
                param: "html"
              },
              {
                condition: "{{quote}} = ",
                type: "calc",
                format: "json",
                value: { ticket: "Not found" },
                func: "set",
                param: "quote"
              },
              {
                type: "js",
                code: "if (!quote?.value) return quote\nquote.value =\n  $utils.extractor.extract(quote.value).items[0]?.value || quote.value\nreturn quote",
                args: "quote",
                param: "quote",
                silent: true
              },
              {
                type: "say",
                message: "{{quote.ticket}} | {{quote.name}} | **{{quote.value}}**"
              }
            ]
          },
          {
            meta: {
              name: "autolabel-gmail",
              title: "Autolabel GMail",
              description: "Sort through GMail inbox, categorize emails and assign labels.",
              category: "Productivity",
              emoji: "\u{1F4E5}"
            },
            steps: [
              { type: "clear" },
              {
                type: "calc",
                func: "set",
                param: "result",
                format: "json",
                value: { processed: 0 }
              },
              {
                condition: "{{url}} =~ ^https:\\/\\/mail\\.google\\.com\\/.+",
                type: "jump",
                to: "EXTRACT EMAILS"
              },
              {
                type: "navigate",
                url: "https://mail.google.com/",
                waitForIdle: false,
                silent: true
              },
              {
                type: "wait",
                for: "js-function",
                code: `return document.querySelector('table[role="grid"] tbody')`,
                timeout: 5e3,
                silent: true
              },
              {
                label: "EXTRACT EMAILS",
                type: "js",
                code: `// extract emails from page
window.emailTable = Array
  .from(document.querySelectorAll('table[role="grid"] tbody'))
  .filter(t => t.getBoundingClientRect().height > 0)
  .at(0)
if (!window.emailTable) return []

// check if there are selected emails
window.hasSelected = window.emailTable
  .querySelectorAll('tr div[role=checkbox][aria-checked=true]')
  .length > 0

// compute emails to be skipped
window.skip = Array
  .from(window.emailTable?.childNodes || [])
  .map(c => !!c.querySelector('img[data-emoji="\u267B\uFE0F"]'))

// extract emails from the table
window.emails = Array
  .from(window.emailTable?.childNodes || [])
  .filter(c =>
    !c.querySelector('img[data-emoji="\u267B\uFE0F"]') &&
    (!window.hasSelected || c.querySelector('div[role=checkbox][aria-checked=true]')))

// extract content from emails
return window.emails
  .map((c, i) => {
    const content = c.innerText
      .replaceAll('\\n', ' | ')
      .replaceAll('\xA0', ' ')
      .replaceAll(/\\s+/g, ' ')
    return \`\${i + 1}. \${content}\`
  })
  .filter(Boolean)`,
                param: "emails",
                args: "",
                silent: true
              },
              {
                condition: "{{emails.length}} = 0",
                type: "say",
                message: "\u2705 No unlabelled emails to sort through on page. Please navigate to [GMail Inbox](https://mail.google.com/mail/u/0/#inbox) to sort."
              },
              { condition: "{{emails.length}} = 0", type: "stop" },
              {
                type: "say",
                message: "\u{1F4AC}\uFE0F\uFE0F\uFE0F\uFE0F\uFE0F\uFE0F Sorting through {{emails.length}} emails..."
              },
              {
                type: "calc",
                func: "list-join",
                delimiter: "\n\n",
                to: "emails",
                list: "emails"
              },
              {
                label: "SORTING RULES",
                type: "gpt",
                prompt: `Please ignore all previous instructions. Act as a virtual email assistant.

Your task is to scan the provided email list, and respond with short sender's intent, and label for each email.

[Instructions]:
- Do not include any notes, general phrases, or echo the original prompt.
- Be short and to the point.
- Follow the response format: "N. Sender's intent - Label.". Sender intent must be one sentence max.
- Associate each email with the relevant label based on its content.
- Make sure that in your response you use only the Labels I have suggested.

[Labels list and their explanations for sorting]:
- Changes in account, login or password change, customers support message,  e.g., successful login - Account.
- Automated emails not from banks, usually related to account notifications or activity or a commercial transaction, e.g. new invoice or completed purchase - Transaction.
- Distribution of news & project updates - Newsletter.
- Any promotional mailings, discount announcements, or new product information - Promotional.
- Any non-work-related surveys, e.g., "how do you like our product" - Survey.
- Notifications from banks or payment systems - Banking.
- Travel emails, notifications about events and concerts - Leisure.
- Any work-related emails, emails with attached files (usually PDFs), e.g., business proposals or product assistance requests - Work.
- Social network notifications (Instagram, YouTube, Twitter, Facebook, LinkedIn, forums, etc.), e.g. "You have received a new message on Reddit." - Social.
- Emails of personal nature - Personal.

- Other Labels cannot be used.


[Example]:

1. Brian is asking for a project advice - Work.
2. Amazon confirms an order - Transaction.
3. Citibank account balance update - Banking.
4. Farfetch promotes April Sales - Promotional.
...


[Email list]:

{{emails}}


[Intent and label per email]:`,
                param: "text",
                isolated: true
              },
              {
                type: "js",
                code: "return text\n  .trim()\n  .split('\\n')\n  .filter(line => /^\\d+\\. /.test(line.trim()))\n  .map(line => {\n    const dashIndex = line.indexOf(' - ')\n    let label = line.slice(dashIndex + 3)\n    if (label.endsWith('.'))\n      label = label.substring(0, label.length - 1)\n    const intent = line.slice(line.indexOf('.') + 2, dashIndex)\n    return { label, intent }\n  })",
                param: "list",
                args: "text",
                silent: true
              },
              {
                condition: "{{list.length}} = 0",
                type: "say",
                message: "\u2705 No new emails to label, abort."
              },
              { condition: "{{list.length}} = 0", type: "stop" },
              {
                type: "js",
                args: "list, result",
                code: `// convert emails to groups
const dict = {}
list.forEach((email, index) => {
  const label = email.label
  dict[label]
    ? dict[label].push(index)
    : dict[label] = [index]
})

list = Object
  .keys(dict)
  .map(label => ({ label, emails: dict[label] }))

if (list.length === 0) return

// actualize indexes, find Nth false index in skip array
const getActualIndex = (n) => {
  let count = 0
  let index = 0
  while (count <= n) {
    if (!window.skip[index]) count++
    index++
  }
  return index - 1
}
list.forEach(group => {
  group.emails = group.emails
    .map(emailIndex => getActualIndex(emailIndex))
})

// uncheck all checked emails
if (window.hasSelected) {
  const unselectButton = Array
    .from(document.querySelectorAll('[role=button] [role=checkbox]'))
    .filter(c => c.getBoundingClientRect().y > 0)
    .at(0)
  if (!unselectButton) throw new Error('Unselect button not found')
  await $harpa.simulator.click(unselectButton)
}

// go through every group in the list and assign labels
for (const group of list) {
  // select emails
  for (const i of group.emails) {
    await $harpa.simulator.click(
      window.emailTable.querySelector(\`tr:nth-child(\${i + 1}) div[role=checkbox]\`))
  }
  await $harpa.waiter.wait(50)

  // locate labels button
  const getLabelsButton = () => {
    let button = Array.from(document.querySelectorAll('div[role="button"]'))
      .map(n => ({ n, rect: n.getBoundingClientRect() }))
      .filter(a => a.rect.y !== 0 && a.rect.width === 20 && a.rect.height === 20)
      .filter(a => Array
        .from(a.n.querySelectorAll('div'))
        .some(child => getComputedStyle(child)?.backgroundImage?.includes('label')))
      .at(0)?.n
    if (!button) {
      button = document
        .querySelector('div[role="button"]:has(path[d^="M17.63 5.84C17.27 5.33 16.67"]')
    }
    return button
  }
  const getMoreButton = () =>
    Array.from(document.querySelectorAll('div[role="button"]'))
      .map(n => ({ n, rect: n.getBoundingClientRect() }))
      .filter(a => a.rect.y !== 0 && a.rect.width === 20 && a.rect.height === 20)
      .filter(a => Array
        .from(a.n.querySelectorAll('div'))
        .some(child => getComputedStyle(child)?.backgroundImage?.includes('more')))
      .at(0)?.n
  const getSwitchToAdvancedToolbar = () =>
    Array.from(document.querySelectorAll('div[role="menuitem"]'))
      .map(n => ({ n, rect: n.getBoundingClientRect() }))
      .filter(a => a.rect.y !== 0 && a.rect.width > 0 && a.rect.height > 20)
      .filter(a => Array
        .from(a.n.querySelectorAll('div'))
        .some(child => getComputedStyle(child)?.backgroundImage?.includes('swap')))
      .at(0)?.n
  let labelsButton = getLabelsButton()

  // switch to advanced toolbar
  if (!labelsButton) {
    const moreButton = getMoreButton()
    if (!moreButton)
      throw new Error('More button not found')
    await $harpa.simulator.click(moreButton)
    await $harpa.waiter.wait(50)

    const switchButton = getSwitchToAdvancedToolbar()
    if (!switchButton)
      throw new Error('Switch button not found')
    await $harpa.simulator.click(switchButton)
    await $harpa.waiter.wait(50)

    labelsButton = getLabelsButton()
    if (!labelsButton)
      throw new Error('Labels button not found')
  }

  // click labels button
  await $harpa.simulator.click(labelsButton)
  await $harpa.waiter.wait(50)

  // expand labels list
  await $harpa.simulator.click(labelsButton)
  await $harpa.waiter.wait(50)

  // check if label already exists
  const label = \`\u267B\uFE0F \${group.label}\`
  const hasLabel = Array
    .from(document.querySelectorAll(
      'div[aria-haspopup="true"] [role="menuitemcheckbox"]'))
    .map((folder) => folder.textContent.trim())
    .includes(label)

  // create label if it doesn't exist
  if (!hasLabel) {
    // click new label button
    const newLabelButton = Array
      .from(document.querySelectorAll('div[role=menuitem]'))
      .find(e => e.previousSibling?.previousSibling?.getAttribute('role') === 'separator')
    if (!newLabelButton) throw new Error('New label button not found')
    await $harpa.simulator.click(newLabelButton)
    await $harpa.waiter.wait(500)

    // enter label name
    const labelInput = document
      .querySelector('[role=alertdialog] input[value]')
    if (!labelInput) throw new Error('Label input not found')
    labelInput.value = label
    labelInput.dispatchEvent(new Event('input', { bubbles: true }));

    // click ok button
    const okButton = document
      .querySelector('[role="alertdialog"] [data-mdc-dialog-action="ok"]');
    if (!okButton) throw new Error('Ok button not found')
    await $harpa.simulator.click(okButton)
    await $harpa.waiter.wait(50)
  }

  // click label
  else {
    const labelElement = Array
      .from(document.querySelectorAll(
        'div[aria-haspopup="true"] [role="menuitemcheckbox"]'))
      .find((folder) => folder.textContent.trim() === label)
    if (!labelElement) throw new Error('Label element not found')
    $harpa.simulator.click(labelElement)
    await $harpa.waiter.wait(50)
  }

  // log processed count
  result.processed += group.emails.length

  // unselect emails
  const unselectButton = Array
    .from(document.querySelectorAll('[role=button] [role=checkbox]'))
    .filter(c => c.getBoundingClientRect().y > 0)
    .at(0)
  if (!unselectButton) throw new Error('Unselect button not found')
  await $harpa.simulator.click(unselectButton)
  await $harpa.waiter.wait(50)
}

return result`,
                param: "result",
                silent: true
              },
              {
                type: "say",
                message: "\u{1F516} Labels assigned. Edit **Autolabel GMail** command to set up custom sorting rules."
              }
            ]
          },
          {
            meta: {
              name: "monitor",
              title: "Automate or monitor page",
              category: "Productivity",
              description: "Set up a page, price or element monitor. Schedules AI commands. Connects to HARPA GRID to remote control this browser.",
              emoji: "\u{1F440}"
            },
            steps: [
              { type: "control", action: "switch-to-task-tab", silent: true }
            ]
          },
          {
            meta: {
              name: "pdf-summary",
              title: "PDF Summary",
              description: "Summarize the PDF content in detail or briefly. You can ask follow-up questions about the content or repurpose it.",
              category: "Productivity",
              emoji: "\u{1F4D5}"
            },
            steps: [
              {
                message: "\u2196\uFE0F Drag & Drop a PDF to work with.",
                param: "text",
                options: null,
                label: "ASK FOR PDF",
                type: "ask",
                optionsInvalid: false
              },
              {
                message: "Pick a summary format, or type custom instructions.",
                param: "format",
                options: [
                  { label: "\u26A1\uFE0F QUICK SUMMARY", value: "quick" },
                  { label: "\u{1F50D} FULL SUMMARY", value: "full" },
                  { label: "\u267B\uFE0F REPURPOSE TEXT", value: "repurpose" },
                  { value: "$custom" }
                ],
                label: "ASK FOR SUMMARY ACTION",
                type: "ask",
                optionsInvalid: false
              },
              {
                condition: "{{format}} = quick",
                label: "QUICK NO CHUNKING",
                prompt: "Please ignore all previous instructions. \nI want you to only answer in {{language}}.\n\nAnalyze the web page content and prepare a web page summary report which has a key takeaway and a summary in bullet points.\n\nThen, generate 3 short and concise queries related to the [PDF CONTENT].\n- Related queries should be brief and to the point.\n- Wrap each relevant query in a markdown code block\n\n[REPORT FORMAT]:\n\n### Key Takeaway\nA single most important takeaway from the text in {{language}}\n\n### Summary\nSummarize the web page here in bullet-points. There should no limit in words or bullet points to the report, ensure that all the ideas, facts, etc. are concisely reported out. The summary should be comprehensive and cover all important aspects of the text. Do not use any emoji. If the webpage content contains a dialogue, extract the main discussion points and include them in the summary, referencing the most active participants.\n\n\n**Related queries:**\n\n```markdown\nShort related query\n```\n```markdown\nShort related query\n```\n\n[PDF CONTENT]:\n{{text}}\n\n[REPORT FOLLOWED BY RELATED QUERIES]:",
                type: "gpt",
                onCodeClick: "send-text",
                param: "gpt",
                isolated: true
              },
              {
                condition: "{{format}} = full",
                label: "FULL WITH CHUNKING",
                chunkify: {
                  text: "{{text}}",
                  empty: "It seems this PDF file has no copyable text. To work with such documents, try taking screenshots for AI Vision using Alt+V."
                },
                prompt: "Please ignore all previous instructions. I want you to only answer in {{language}}. Summarize the next chunk of the web page into a list of key takeaways. Each key takeaway should be a bullet list item. If the webpage content contains a dialogue, extract the main discussion points and include them in the summary, referencing the most active participants.\n\nFollow the [RESPONSE FORMAT]:\n\n- [takeaway 1]\n- [takeaway 2]\n...\n\n[PDF CONTENT CHUNK]:\n{{chunk}}\n\n[KEY TAKEAWAYS LIST]:",
                type: "gpt",
                onCodeClick: "send-text",
                isolated: true,
                param: "gpt"
              },
              {
                condition: "{{format}} = full",
                label: "FULL WITH CHUNKING > QUERIES",
                prompt: "Please ignore all previous instructions. I want you to only answer in {{language}}. \n\nGenerate 3 short and concise queries related to the [PDF SUMMARY TEXT].\n- Related queries should be brief and to the point.\n- Wrap each relevant query in a markdown code block\n- Do not add any extra notes or comments, I want only related queries and nothing more. \n\n**Related queries:**\n\n```markdown\nShort related query\n```\n```markdown\nShort related query\n```\n\n[PDF SUMMARY TEXT]:\n{{gpt}}\n\n[3 RELATED QUERIES]:",
                type: "gpt",
                onCodeClick: "send-text",
                isolated: true,
                param: "related"
              },
              {
                condition: "{{format}} = repurpose",
                label: "REPURPOSE",
                steps: [
                  {
                    type: "calc",
                    func: "clone",
                    from: "text",
                    to: "repurpose-input"
                  },
                  { type: "command", name: "Repurpose text", inputs: [] },
                  { type: "stop" }
                ],
                type: "group"
              },
              {
                condition: "{{format-option}} = $custom",
                label: "CUSTOM",
                prompt: "Please ignore all previous instructions. I want you to only answer in {{language}}. I would like you to summarize the web page content.\n\n[ADDITIONAL INSTRUCTIONS / FORMAT]:\n{{format}}\n\n[PDF CONTENT]:\n{{chunk}}\n\n[SUMMARY]:",
                type: "gpt",
                param: "gpt",
                isolated: true,
                chunkify: {
                  text: "{{text}}",
                  empty: "It seems this PDF file has no copyable text. To work with such documents, try taking screenshots for AI Vision using Alt+V."
                }
              },
              {
                label: "CHANGE-SUMMARY",
                param: "change",
                options: [
                  { value: "no", label: "\u2705 DONE" },
                  { label: "\u2B07\uFE0F SHORTEN", value: "shorten" },
                  { label: "\u{1F92A} SIMPLIFY", value: "simplify" },
                  { label: "\u{1F50D} CLARIFY", value: "clarify" },
                  { label: "\u267B\uFE0F REPURPOSE TEXT", value: "repurpose" },
                  { label: "\u{1F575}\u{1F3FB}\u200D\u2642\uFE0F FACT CHECK", value: "factCheck" },
                  { value: "$custom" }
                ],
                type: "ask",
                optionsInvalid: false
              },
              {
                condition: [
                  "{{change}} = clarify",
                  "{{change}} = shorten",
                  "{{change}} = simplify"
                ],
                label: "CHANGES",
                steps: [
                  {
                    label: "CLARIFY",
                    value: "Add clarity and conciseness. Text should be direct, clear, and not ambiguous.",
                    condition: "{{change}} = clarify",
                    type: "calc",
                    func: "set",
                    param: "change",
                    format: ""
                  },
                  {
                    label: "SIMPLIFY",
                    value: "I want you to simplify your summary and rewrite it in more understandable language, replacing complex words and phrases with simple, clear ones.",
                    condition: "{{change}} = simplify",
                    type: "calc",
                    func: "set",
                    param: "change",
                    format: ""
                  },
                  {
                    label: "SHORTEN",
                    value: "Make summary shorter, keeping only the most essential information and nothing more.",
                    condition: "{{change}} = shorten",
                    type: "calc",
                    func: "set",
                    param: "change",
                    format: ""
                  },
                  {
                    prompt: "I would like you to make changes to the summary you wrote. Please do not output anything but the revised reply. Do not echo my command. Do not put quotes around the revised reply.\n\n[CHANGES TO MAKE]:\n{{change}}\n\n[SUMMARY TO CHANGE]:\n{{gpt}}\n\n[REVISED SUMMARY]:\n",
                    label: "CHANGES",
                    type: "gpt",
                    param: "gpt"
                  },
                  { type: "jump", to: "CHANGE-SUMMARY" }
                ],
                type: "group"
              },
              { condition: "{{change}} = no", label: "DONE", type: "stop" },
              {
                condition: "{{change}} = repurpose",
                label: "REPURPOSE",
                steps: [
                  {
                    to: "repurpose-input",
                    type: "calc",
                    func: "clone",
                    from: "gpt"
                  },
                  { name: "Repurpose text", inputs: [], type: "command" },
                  { type: "stop" }
                ],
                type: "group"
              },
              {
                condition: "{{change-option}} = $custom",
                label: "QUESTION",
                steps: [
                  { name: "Ask", inputs: ["{{change}}"], type: "command" },
                  { type: "stop" }
                ],
                type: "group"
              },
              {
                condition: "{{change}} = factCheck",
                label: "CHANGE-FACT CHECK",
                steps: [
                  { type: "calc", func: "clone", from: "gpt", to: "g.factCheck" },
                  {
                    inputs: ["{{g.factCheck}}"],
                    type: "command",
                    name: "Fact check"
                  },
                  { type: "stop" }
                ],
                type: "group"
              }
            ]
          },
          {
            meta: {
              name: "setup",
              title: "Setup",
              description: "Configure HARPA to meet your needs.",
              category: "Control"
            },
            steps: [
              { type: "clear" },
              {
                type: "say",
                message: "**Thank you for choosing HARPA!**\n\nThe app gives you an edge by bringing practical time-saving AI tools right to your browser. Let's customize it for you, this will only take a minute."
              },
              {
                type: "ask",
                param: "next",
                message: "Please click `NEXT` or press `Enter` to proceed. You can abort setup any time by pressing `ESC`.",
                options: [{ label: "\u23ED\uFE0F NEXT", value: "next" }],
                default: "",
                vision: { enabled: false, mode: "area", hint: "", send: true },
                optionsInvalid: false
              },
              {
                label: "SET LANGUAGE",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    param: "lang",
                    message: "**1 of 3. Pick a default language AI should reply in.**\n\nYou can type a custom language if it is not on the list. Press `Enter` to apply `\u{1F1FA}\u{1F1F8} English` by default.",
                    options: [
                      { label: "\u{1F1FA}\u{1F1F8} English", value: "English" },
                      { label: "\u{1F1E8}\u{1F1F3} Mandarin Chinese", value: "Mandarin Chinese" },
                      { label: "\u{1F1EE}\u{1F1F3} Hindi", value: "Hindi" },
                      { label: "\u{1F1EA}\u{1F1F8} Spanish", value: "Spanish" },
                      { label: "\u{1F1EB}\u{1F1F7} French", value: "French" },
                      { label: "\u{1F1F8}\u{1F1E6} Arabic", value: "Arabic" },
                      { label: "\u{1F1E7}\u{1F1E9} Bengali", value: "Bengali" },
                      { label: "\u{1F1F7}\u{1F1FA} Russian", value: "Russian" },
                      { label: "\u{1F1E7}\u{1F1F7} Portuguese", value: "Portuguese" },
                      { label: "\u{1F1F5}\u{1F1F0} Urdu", value: "Urdu" },
                      { label: "\u{1F1EE}\u{1F1E9} Indonesian", value: "Indonesian" },
                      { label: "\u{1F1E9}\u{1F1EA} German", value: "German" },
                      { label: "\u{1F1EF}\u{1F1F5} Japanese", value: "Japanese" },
                      { label: "\u{1F1F0}\u{1F1F7} Korean", value: "Korean" },
                      { label: "\u{1F1EE}\u{1F1F3} Telugu", value: "Telugu" },
                      { label: "\u{1F1EE}\u{1F1F9} Italian", value: "Italian" },
                      "$custom"
                    ],
                    default: "",
                    vision: { enabled: false, mode: "area", hint: "", send: true },
                    optionsInvalid: false
                  },
                  {
                    type: "calc",
                    func: "call-internal-method",
                    method: "set-language",
                    value: "{{lang}}",
                    to: ""
                  },
                  {
                    type: "say",
                    message: "Great! Default language is set to `{{language}}`. It can be changed from the App Settings any time."
                  }
                ]
              },
              {
                label: "SET USERINFO",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    param: "userinfoNew",
                    message: "**2 of 3. Tell HARPA a bit about yourself.**\n\nAI provides better assistance when you share a few things and set expectations. For example:\n\n```text\nMy name is Anne, I am a journalist at xyz.com from Toronto. Please be short, to the point and factual.\n```\n\n```text\nMy name is John. I'm a marine biology student. Please think step by step in your replies before giving a final answer.\n```\n\n```text\nMy name is Claire. I'd like you to be witty about your replies.\n```\n\nFeel free to copy one of the templates above, edit and send it; or type custom instructions. You can skip this step by selecting `AUTO`.",
                    options: [{ label: "\u23ED\uFE0F AUTO", value: "auto" }, "$custom"],
                    default: "",
                    vision: { enabled: false, mode: "area", hint: "", send: true },
                    optionsInvalid: false
                  },
                  {
                    condition: "{{userinfoNew}} = auto",
                    type: "calc",
                    func: "delete",
                    param: "g.userinfo"
                  },
                  {
                    condition: "{{userinfoNew}} != auto",
                    type: "calc",
                    func: "set",
                    param: "g.userinfo",
                    format: "text",
                    value: "{{userinfoNew}}"
                  },
                  {
                    type: "say",
                    message: "Awesome! Meta instructions are stored. They can be changed any time from the App Settings."
                  }
                ]
              },
              {
                label: "SET TONE",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    param: "toneNew",
                    message: "**3 of 3. Teach AI to mimic your writing.**\n\nMany HARPA features such as `/reply`, `/rewrite` and `/compose` are designed to mimic your style of writing and tone of voice, e.g. for drafting emails.\n\nHere is the current setting, feel free to type a custom one or press `AUTO` to move on.\n\n```text\n{{tone}}\n```",
                    options: [{ label: "\u23ED\uFE0F AUTO", value: "auto" }, "$custom"],
                    default: "",
                    vision: { enabled: false, mode: "area", hint: "", send: true },
                    optionsInvalid: false
                  },
                  {
                    condition: "{{toneNew}} = auto",
                    type: "calc",
                    func: "set",
                    param: "g.tone",
                    format: "",
                    value: "I write in a short and concise way. My speech is clear, professional, and to the point."
                  },
                  {
                    condition: "{{toneNew}} != auto",
                    type: "calc",
                    func: "set",
                    param: "g.tone",
                    format: "",
                    value: "{{toneNew}}"
                  },
                  {
                    type: "say",
                    message: "\u2705 **All set!**\n\nCall HARPA in any tab with `Alt+A` on PC and `^A` on Mac. Alternatively, capture area with `Alt+V` and `^V`\n\nWould you like some basic tips to get started? Pick an option or press DONE to complete and exit setup."
                  }
                ]
              },
              {
                label: "QUESTION",
                type: "ask",
                param: "question",
                message: "",
                options: [
                  { label: "\u2705 DONE", value: "done" },
                  { label: "\u{1F916}\uFE0F\uFE0F\uFE0F\uFE0F\uFE0F\uFE0F USING COMMANDS", value: "commands" },
                  { label: "\u{1F440} USING VISION", value: "vision" },
                  { label: "\u{1F4AC} CHAT WITH PAGES", value: "chat" },
                  { label: "\u{1F50E} WEB SEARCH", value: "search" },
                  { label: "\u{1F4F9} YOUTUBE SUMMARIES", value: "youtube" },
                  { label: "\u{1F4E7} DRAFTING EMAILS", value: "emails" },
                  {
                    label: "\u{1F527} SPELLCHECK & FIXING MISTAKES",
                    value: "spellcheck"
                  },
                  { label: "\u{1F511} SHORTCUTS", value: "shortcuts" }
                ],
                default: "",
                vision: { enabled: false, mode: "area", hint: "", send: true },
                optionsInvalid: false
              },
              {
                label: "INTRO",
                type: "group",
                steps: [
                  {
                    condition: "{{question}} = done",
                    label: "DONE",
                    type: "group",
                    steps: [{ type: "clear" }, { type: "stop" }]
                  },
                  {
                    condition: "{{question}} = commands",
                    type: "say",
                    message: "#### \u{1F916}\uFE0F\uFE0F\uFE0F\uFE0F\uFE0F\uFE0F USING COMMANDS\n\nHARPA comes with over 100 carefully crafted AI automations, called commands.\n\nTo access commands, launch HARPA with `Alt+A` or `^A` and press forward slash `/`.\n\nType a command name and press Enter to launch one. Some of the most useful commands are:\n* `/reply` - writes replies to selected text in your tone of voice.\n* `/search` - searches the web or within website using AI, similar to Perplexity.\n* `/summary` - extracts key takeaways from the opened web page to aid in research.\n* `/youtube-summary` - summarizes youtube videos into key points.\n* `/finish-writing` - expands your short drafts into complete messages, blog posts, emails etc.\n\nCommands are designed to save time. There are commands for content summarization, drafting emails, checking grammar, translating texts, fixing mistakes, passing tests, crafting Midjourney prompts, writing autocompletion and much more.\n\nYou can call commands on any page without opening HARPA by double pressing forward slash and a command hotkey, such as `//u` for summarization.\n\nIf you like a command, add it to \u2B50 Favourites. You can even create your own commands. Check out these online guides for more info:\n* [Getting Started](https://harpa.ai/guides/getting-started)\n* [AI Commands](https://harpa.ai/guides/page-aware-chatgpt-prompts)\n* [Custom AI Commands](https://harpa.ai/guides/custom-page-aware-chatgpt-commands)"
                  },
                  {
                    condition: "{{question}} = vision",
                    type: "say",
                    message: "#### \u{1F440} USING VISION\n\nPress `Alt+V` on Windows or `^V` on Mac in any tab to initiate area capturing.\n\nOnce the area is captured, HARPA will suggest the following options:\n- `find and fix mistakes`, useful to double check if you filled in a test, or typed email correctly.\n- `solve test`, aids in learning if you are feeling lazy or don't know the answer.\n- `reply`, will draft a reply to selected message, e.g. fully-formatted professionally looking email in your tone of voice.\n- `explain and simplify`, boils down and explains complex concepts, formulas, abbreviations and terminology. Can be used for researching leads info.\n- `rewrite and fix tone`, used to alter tone of selected message, e.g. making it sound more professional.\n- `autocomplete writing`, saves time by expanding drafts (e.g. \"suggest a metting tomorrow 10am) into finished messages and emails.\n- `translate`, does what it says, can also provide translation side by side or aid in language learning.\n- `extract text`, scans and parses text from the captured area.\n- `repurpose`, converts selected area into a blog post, tweet, email, note, todo list, recipe etc.\n\nYou can grab an area or screenshot, and ask AI a custom question. Vision is supported by GPT-4, GPT-4o and Claude 3.5 models."
                  },
                  {
                    condition: "{{question}} = chat",
                    type: "say",
                    message: '#### \u{1F4AC} CHAT WITH PAGES\n\nHARPA is page-aware, meaning it will automatically retrieve content of the opened page, relevant to your question.\n\nTo enable **page-aware mode**, click three vertical dots button and select "Page-aware".\n\nAlternatively, type `-p` at the beginning or the end of your question in chat.'
                  },
                  {
                    condition: "{{question}} = search",
                    type: "say",
                    message: "#### \u{1F50E} WEB SEARCH\n\nHARPA has a built-in answer engine and can browse the web for you on a given topic. To activate web search, type the following in chat, starting from the forward slash:\n\n`/search`\n\nOr press `//S` in any tab.\n\nHARPA can search and aggregate information within opened website, or globally. It will automatically dive deep into the individual web pages to create the most complete report.\n\nFind more info in our [Search Agent](https://harpa.ai/guides/ai-answers-alongside-google-search)."
                  },
                  {
                    condition: "{{question}} = youtube",
                    type: "say",
                    message: "#### \u{1F4F9} YOUTUBE SUMMARIES\n\nHARPA can break down hours long YouTube videos into parts and summarize every part into a list of key takeaways to save you time wathing.\n\nNavigate to a YouTube video and press `SUMMARIZE WITH HARPA` option available directly on the page.\n\nKey takeaways are shown directly over the YouTube video progress bar while you hover it.\n\nHARPA caches summaries, so if a summary for a given video is already available, it will fetch it for you instantly. Only videos with transcripts can be summarized.\n\nFind more info in our [Guide on Video Summaries](https://harpa.ai/guides/summarize-pages-and-youtube-videos-to-text)."
                  },
                  {
                    condition: "{{question}} = emails",
                    type: "say",
                    message: "#### \u{1F4E7} DRAFTING EMAILS\n\nType `/compose` in chat to draft an email. Type `/reply` to draft an email reply. You can also type in a basic idea of your email and then use `/finish-writing` command to expand it to a complete email in your tone of voice.\n\nFind more info in our [Guide on Writing Emails](https://harpa.ai/guides/finish-writing-from-your-draft-with-ai)."
                  },
                  {
                    condition: "{{question}} = spellcheck",
                    type: "say",
                    message: "#### \u{1F527} SPELLCHECK & FIXING MISTAKES\n\nYou can use HARPA to find and fix mistakes in your emails, messages, web pages, test assignments.\n\nPress `Alt+V` or `^V` on Mac to grab an area and then select `find and fix mistakes` option.\n\nAlternatively, select any text on a page and press `//G` to fix Grammar."
                  },
                  {
                    condition: "{{question}} = shortcuts",
                    type: "say",
                    message: "#### \u{1F511} SHORTCUTS\n\nYou can explore and configure shortcuts from the App Settings (a gear icon at the top). The most useful shortcuts are:\n* `Alt+A` to open / close HARPA.\n* `Alt+V` to send a visual area of the page to chat.\n\nThere are also quick command shortcuts which can be initiated with double slash, followed by command hotkey, such as:\n* `//U` to summarize opened page.\n* `//D` to extract data from page.\n* `//A` to ask page or seek within a YouTube video.\n\nShortcuts can be turned off from the App Settings."
                  }
                ]
              },
              { type: "jump", to: "QUESTION" }
            ]
          },
          {
            meta: {
              name: "set-tone",
              title: "Set reply tone",
              category: "Control",
              description: "Teach me how to mimic your writing style in /reply, /rewrite, /compose commands and personalize your messages.",
              emoji: "\u{1F3AD}"
            },
            steps: [
              {
                type: "ask",
                param: "menu",
                message: "\u{1F3AD} Please type your writing tone to mimic, or leave the tone as is by pressing Enter.\n\nCurrently:\n\n```markdown\n{{g.tone}}\n```\n\nTemplate for effective copywriting tone:\n\n```markdown\nI write without complex language structures. My speech is correct and clear. I state facts clearly because I am a journalist, and my readers need accurate information.\n```",
                options: [{ label: "\u2705 LEAVE AS IS", value: "leave" }, "$custom"],
                default: "",
                optionsInvalid: false
              },
              { condition: "{{menu}} = leave", type: "stop" },
              {
                condition: "{{menu}} != leave",
                type: "group",
                steps: [
                  {
                    type: "calc",
                    func: "set",
                    param: "g.tone",
                    value: "{{menu}}",
                    format: "text"
                  }
                ]
              },
              {
                type: "say",
                message: "\u2705 Reply tone saved. Tone is applied automatically in `/reply`, `/rewrite`, `/compose` commands. You can also pass it to AI with `{{\\tone}}` parameter in chat.\n"
              }
            ]
          },
          {
            meta: {
              name: "set-language",
              title: "Set reply language",
              category: "Control",
              description: "Tell me the default reply AI language to use in commands.",
              emoji: "\u{1F310}"
            },
            steps: [
              {
                type: "ask",
                param: "menu",
                message: "\u{1F1FA}\u{1F1F3} Please type the default AI response language to be used in AI commands, such as `German Informal` or pick from the list.\n\nCurrently: {{language}}",
                options: [
                  { label: "\u2705 LEAVE AS IS", value: "leave" },
                  { label: "\u{1F1FA}\u{1F1F8} AMERICAN ENGLISH", value: "english-american" },
                  { label: "\u{1F1EC}\u{1F1E7} BRITISH", value: "english-british" },
                  { label: "\u{1F1E8}\u{1F1F3} CHINESE", value: "chinese" },
                  { label: "\u{1F1EE}\u{1F1F3} HINDI", value: "hindi-urdu" },
                  { label: "\u{1F1EA}\u{1F1F8} SPANISH", value: "spanish" },
                  { label: "\u{1F1F5}\u{1F1F9} PORTUGUESE", value: "portuguese" },
                  { label: "\u{1F1F7}\u{1F1FA} RUSSIAN", value: "russian" },
                  { label: "\u{1F1F9}\u{1F1F7} TURKISH", value: "turkish" },
                  { label: "\u{1F1EF}\u{1F1F5} JAPANESE", value: "japanese" },
                  { label: "\u{1F1E9}\u{1F1EA} GERMAN", value: "german" },
                  { label: "\u{1F1EB}\u{1F1F7} FRENCH", value: "french" },
                  { label: "\u{1F1EE}\u{1F1F9} ITALIAN", value: "italian" },
                  { label: "\u{1F1F8}\u{1F1E6} ARABIC", value: "arabic" },
                  { label: "\u{1F1F0}\u{1F1F7} KOREAN", value: "korean" },
                  "$custom"
                ],
                default: "",
                optionsInvalid: false
              },
              { condition: "{{menu}} = leave", type: "stop" },
              {
                condition: "{{menu}} != leave",
                type: "group",
                steps: [
                  {
                    type: "calc",
                    func: "call-internal-method",
                    method: "set-language",
                    value: "{{menu}}"
                  }
                ]
              },
              {
                type: "say",
                message: "\u2705 Language applied. It is used automatically by most commands. You can reference it with `{{\\language}}`\n"
              }
            ]
          },
          {
            meta: {
              name: "parameters",
              title: "Echo parameters",
              category: "Control",
              description: "Echo available prompt parameters."
            },
            steps: [
              {
                say: "HARPA AI supports prompt parameters. Include parameters into your prompts in double brackets like this: `{{\\url}}`\n- **url**: {{url}}\n- **domain**: {{domain}}\n- **title**: {{title}}\n- **desc**: {{desc}}\n- **language**: {{language}}\n\nFollowing parameters are calculated dynamically once prompt is sent:\n- **page**: page content\n- **selection**: text selected on the page\n- **context**: page content relevant to prompt\n- **transcript**: transcript of the opened youtube video\n- **transcriptPlain**: transcript of the opened youtube video, excluding timestamps\n- **gpt**: the last answer generated by GPT\n\nFollowing parameters are persisted in a chat & global app storages. Use `ask` step in a custom command to modify them, e.g. `{{\\g.style}}`\n- **c** or **chat**:\n{{c}}\n- **g** or **global**:\n{{g}}\nFeel free to suggest more parameters, by emailing support@harpa.ai"
              }
            ]
          },
          {
            meta: {
              name: "continue",
              title: "Continue",
              category: "Control",
              description: "GPT models are limited to 8k tokens across prompt and output. Ask GPT to continue writing if possible."
            },
            steps: [
              { type: "calc", func: "last-line", param: "gpt", to: "lastLine" },
              {
                type: "gpt",
                prompt: "Please continue writing, you did not finish. Your last line was: {{lastLine}}"
              }
            ]
          },
          {
            meta: {
              name: "help",
              title: "Help",
              description: "Get help on using HARPA AI.",
              category: "Control"
            },
            steps: [
              {
                type: "ask",
                param: "question",
                message: "Type a question about the App. Feel free to check out [product guides](https://harpa.ai/guides) on our website.",
                options: [
                  { label: "\u{1F9EC} INTRO TO HARPA", value: "intro" },
                  "$custom"
                ],
                optionsInvalid: false,
                default: ""
              },
              {
                condition: "{{question}} = intro",
                label: "INTRO TO HARPA",
                type: "group",
                steps: [
                  {
                    type: "say",
                    message: "### How to connect to AI\n- Please log into [HARPA AI account](https://harpa.ai/account/).\n- Click model switch in the bottom left corner:\n  - S plan users get [CloudGPT tokens](https://harpa.ai/guides/cloud-gpt-connection). CloudGPT tokens power fast, reliable and country unrestricted premium access to GPT and Claude3 models.\n  - Connect [OpenAI API](https://harpa.ai/guides/how-to-get-an-openai-api-key) or [OpenRouter](https://openrouter.ai/) using your API Key. Alternatively, get [CloudGPT tokens](https://harpa.ai/pricing) from HARPA AI website.\n  - Everyone can utilize their [web session connections](https://harpa.ai/guides/chatgpt-web-session). Web session connection requires login into appropriate website. These connections are rate-limited by OpenAI / Claude / Google and may be downtime from time to time.\n- Click the DEFAULT button to ensure every chat you create opens with the preset connection.\n\n### What's inside\n- **AI tab.** This is the main tab to access AI:\n  - Type slash symbol **/** in chat to bring a list of [commands](https://harpa.ai/guides/page-aware-chatgpt-prompts).\n  - Type a word, like **/rewrite**, to get a list of related commands to [summarize](https://harpa.ai/guides/summarize-pages-and-youtube-videos-to-text), [make AI search for you](https://harpa.ai/guides/ai-answers-alongside-google-search), [write SEO content](https://harpa.ai/guides/write-text-on-websites-with-ai) and more.\n  - X and S users can [edit predefined commands](https://harpa.ai/guides/editing-pre-defined-commands).\n  - Create a [custom command](https://harpa.ai/guides/custom-page-aware-chatgpt-commands) tailored to your needs and automate your work.\n\n- **Chats History.** Switch, pin, delete, or export chats.\n- **Automate tab.** Set up [page monitors](https://harpa.ai/guides/monitor-price-drops) or configure [scheduled automations](https://harpa.ai/guides/schedule-ai-commands).\n- **Account tab.** Switch between [spaces](https://harpa.ai/guides/team-spaces), check or top up your CloudGPT balance.\n- **Settings.** Set AI response language, configure the [quick access bar](https://harpa.ai/guides/quick-access-bar), and more.\n\n### Something does not work?\nMost likely you'll find a solution in the [troubleshooting guide](https://harpa.ai/guides/harpa-is-not-working) or in a separate [guide on billing issues](https://harpa.ai/guides/billing-issues).\n\n**Here are few basic things to try:**\n1. Check [LLM status](https://harpa.ai/guides/harpa-is-not-working#check-your-ai-connection) and your connection.\n2. Check [HARPA version](https://harpa.ai/guides/harpa-is-not-working#check-your-harpa-version) / reset HARPA.\n3. Check [if HARPA has permissions](https://harpa.ai/guides/harpa-is-not-working#check-harpa-permissions) to access web pages.\n4. Check [if you are logged in](https://harpa.ai/guides/harpa-is-not-working#check-if-you-are-logged-in-to-harpa-ai) to HARPA AI.\n5. Restart your browser.\n\nIf your issue remains unresolved, please send us a [helpful bug report](https://harpa.ai/guides/helpful-bug-reports) to [support@harpa.ai](mailto:support@harpa.ai) or through our [Discord channel](https://discord.com/invite/BsbjAXpqgC)."
                  },
                  {
                    type: "ask",
                    message: "What would you like to know about HARPA? Press Escape to exit command. ",
                    options: null,
                    param: "question",
                    default: ""
                  },
                  { type: "jump", to: "QUESTION" }
                ]
              },
              {
                label: "QUESTION",
                type: "group",
                steps: [
                  {
                    label: "SAY COLLECTING",
                    type: "say",
                    message: "\u23F3 Collecting information..."
                  },
                  {
                    type: "calc",
                    func: "set",
                    param: "information",
                    value: "{{serp {{question}} site:harpa.ai}}",
                    format: ""
                  },
                  {
                    type: "calc",
                    func: "serp.extract-links",
                    to: "links",
                    limit: 8,
                    from: "information"
                  },
                  {
                    type: "gpt",
                    onCodeClick: "send-text",
                    prompt: "[SYSTEM]: Please ignore all previous instructions.\n\nYour name is HARPA. You are user's helpful assistant. Your goal is to answer questions related to HARPA AI Chrome Extension. Impersonate HARPA AI, as if you were the app itself.\nHARPA AI integrates ChatGPT, Gemini, ClaudeAI and automation into Chrome, Edge, Opera, Brave. The CONTEXT below contains information on app capabilities.\n\nI would like you to complete two tasks for me and provide a clear response:\n1) Please answer the following question to the best of your ability. Be precise, concise and helpful. Provide markdown URL references if relevant and present in the context.\nDo not include info on how to install HARPA AI, user already has it.\n\n[USER QUESTION]: {{question}}\n\n2) Generate 3 short and concise related queries to [USER QUESTION] about HARPA AI:\n- Related queries should be brief and avoid repeating [USER QUESTION] entirely or partially.\n- Generate queries for which you don't have answers in your response yet.\n- Wrap every relevant query into a markdown code block\n\n[FOLLOW THE RESPONSE FORMAT]:\n\n...Your helpful answer to [USER QUESTION]...\n\n**Related queries:**\n\n```markdown\nShort related query\n```\n\n ```markdown\nShort related query\n```\n....\n-----\n\n[CONTEXT]:\n\n- {{links.0.title}} {{links.0.url}} {{links.0.description}}\n{{page {{question}} {{links.0.url}} limit=20%}}\n\n- {{links.1.title}} {{links.1.url}} {{links.1.description}}\n{{page {{question}} {{links.1.url}} limit=15%}}\n\n- {{links.2.title}} {{links.2.url}} {{links.2.description}}\n{{page {{question}} {{links.2.url}} limit=15%}}\n\n----\n\nDo not hallucinate: if you can not answer user question, simply refer user to check out the guides on https://harpa.ai/guides website if you haven't done so. Do not mention the context may be incomplete.\n\n[ANSWER]:",
                    param: "gpt"
                  },
                  {
                    type: "ask",
                    message: "Type a follow-up question or press Escape to stop. ",
                    param: "question",
                    options: null,
                    default: ""
                  },
                  { type: "jump", to: "SAY COLLECTING" }
                ]
              }
            ]
          },
          {
            meta: {
              name: "clear",
              title: "Clear",
              category: "Control",
              description: "Clean up and restart the AI dialog.",
              emoji: "\u{1F9FD}"
            },
            steps: [{ type: "clear" }]
          },
          {
            meta: {
              name: "page-sherlock",
              title: "Page Sherlock",
              description: "Analyses website Meta & OG data, SEO metrics, images and broken links.",
              category: "SEO",
              emoji: "\u{1F575}"
            },
            steps: [
              {
                type: "say",
                message: "![icon](/img/commands/files-file-search-02.svg) Analyzing page\u2026"
              },
              {
                label: "MAIN JS",
                type: "js",
                code: "// get page load time\nconst getPageLoadTime = () =>\n  performance.timing.domContentLoadedEventEnd -\n  performance.timing.navigationStart\n\n\n// get page size\nconst fetchResponseSize = async () => {\n  return fetch(window.location.href)\n    .then(response => response.arrayBuffer())\n    .then(buffer => buffer.byteLength)\n    .catch(() => 'Fetching error')\n}\n\n\n// scrape resources referenced by page\nconst getResources = () => {\n  const resources = performance.getEntriesByType('resource')\n  const resourceSizes = resources\n    .map(resource => ({\n      url: resource.name,\n      sizeInBytes: resource.encodedBodySize || 0\n    }))\n\n  // calculate the total size of resources in Bytes & Megabytes\n  const totalSizeBytes = resourceSizes\n    .reduce((total, resource) => total + resource.sizeInBytes, 0)\n  const totalSizeMegabytes =\n    (totalSizeBytes / (1024 * 1024)).toFixed(2) + ' MB'\n\n  resourceSizes.sort((a, b) => b.sizeInBytes - a.sizeInBytes)\n\n  return {\n    totalSizeBytes: totalSizeBytes,\n    totalSizeMegabytes: totalSizeMegabytes,\n    list: resourceSizes,\n  }\n}\n\n\n// get resources loading time\nconst getResourcesLoadTime = () => {\n  const startTime = performance.timing.requestStart\n  const endTime = performance.timing.loadEventEnd\n  return endTime === 0 || startTime === 0 ? 'N/A' : endTime - startTime\n}\n\n\n// find standard meta tags from page\nconst extractMetaTags = () => {\n  const getContent = (property) => {\n    const element = document.querySelector(property)\n    return element ? element.getAttribute('content') : 'N/A'\n  };\n\n  const removeBrackets = (url) =>\n    url ? url.replace(/\\[.*?\\]/g, '') : 'N/A';\n\n  const metaTags = {\n    metaTitle: document.querySelector('title')\n      ? document.querySelector('title').innerText : 'N/A',\n    metaDescription: getContent('meta[name=\"description\"]'),\n    ogTitle: getContent('meta[property=\"og:title\"]'),\n    ogDescription: getContent('meta[property=\"og:description\"]'),\n    ogType: getContent('meta[property=\"og:type\"]'),\n    ogImage: getContent('meta[property=\"og:image\"]'),\n    ogUrl: removeBrackets(getContent('meta[property=\"og:url\"]')),\n    twitterTitle: getContent('meta[name=\"twitter:title\"], meta[property=\"twitter:title\"]'),\n    twitterDescription: getContent('meta[name=\"twitter:description\"], meta[property=\"twitter:description\"]'),\n    twitterCard: getContent('meta[name=\"twitter:card\"], meta[property=\"twitter:card\"]'),\n    twitterImage: getContent('meta[name=\"twitter:image\"], meta[property=\"twitter:image\"]'),\n    twitterUrl: removeBrackets(getContent('meta[name=\"twitter:url\"], meta[property=\"twitter:url\"]'))\n  }\n\n  return metaTags\n}\n\n\n// compute page reading time\nconst calculateReadingTime = () => {\n  const content = document.body.innerText\n\n  // average reading speed (words per minute)\n  const wordsPerMinute = 200\n  const wordCount = content\n    .split(/\\s+/)\n    .filter(word => word.length > 0).length\n  const readingTimeMinutes = Math.ceil(wordCount / wordsPerMinute)\n\n  return {\n    wordCount: wordCount,\n    readingTimeMinutes: readingTimeMinutes\n  }\n}\n\n\n// find images and extract alt and src attributes, excluding \"extension://\"\nconst extractImages = () => {\n  const images = []\n  const imageElements = document.querySelectorAll('img')\n  const currentDomain = window.location.origin\n  let altTagMissingCount = 0\n\n  imageElements.forEach((img) => {\n    let src = img.getAttribute('src')\n    const alt = img.getAttribute('alt') || 'No ALT tag'\n    if (alt === 'No ALT tag' && src && !src.includes('extension://')) {\n      altTagMissingCount++\n    }\n    if (src && !src.includes('extension://')) {\n      if (src.startsWith('/')) {\n        src = currentDomain + src\n      }\n      images.push({ alt: alt, src: src })\n    }\n  })\n\n  const errors = []\n  if (altTagMissingCount > 0) {\n    errors.push(`${altTagMissingCount} image without ALT Tags.`)\n  }\n\n  return { content: images, errors: errors }\n}\n\n\n// find favicons and add domain if not present\nconst extractFavicon = () => {\n  const links = document.querySelectorAll(\"link[rel*='icon']\")\n  const currentDomain = window.location.origin\n  const favicons = Array.from(links).map((link) => {\n    const href = link.getAttribute(\"href\")\n    return href.startsWith('/') ? currentDomain + href : href\n  }).filter(Boolean)\n\n  const faviconData = {\n    favicons: favicons,\n    errors: []\n  }\n\n  if (favicons.length === 0) {\n    faviconData.errors.push(`No favicons declared in page.`)\n  }\n\n  return faviconData\n}\n\n\n// find headings and extract their text\nconst extractAllHeadings = () => {\n  const headings = { content: [], errors: [] }\n\n  const headingTags = ['h1', 'h2', 'h3', 'h4', 'h5', 'h6']\n\n  let h1Count = 0\n  let isH1Empty = false\n\n  headingTags.forEach(tag => {\n    const elements = document.querySelectorAll(tag)\n    const capitalizedTag = tag.toUpperCase()\n\n    elements.forEach(element => {\n      const text = element.textContent.trim()\n      headings.content.push(`${capitalizedTag}: ${text}`)\n\n      if (text === null) {\n        isH1Empty = true\n      }\n    })\n\n    if (tag === 'h1') {\n      h1Count += elements.length\n      if (elements.length === 1 && elements[0].textContent.trim().length === 0) {\n        isH1Empty = true\n      }\n    }\n  })\n\n  if (isH1Empty) {\n    headings.errors.push('H1 is empty.')\n  }\n  if (h1Count === 0) {\n    headings.errors.push('There is no H1 element on the page.')\n  }\n  if (h1Count > 1) {\n    headings.errors.push('There are multiple H1 elements on the page.')\n  }\n\n  return headings\n}\n\n\n// extract all links from page and check for broken ones\nconst extractAllLinks = async () => {\n  const links = { internal: [], external: [], errors: [] }\n\n  const allLinks = document.querySelectorAll('a')\n  const nonLinkSchemes = [\n    'mailto:', 'tel:', 'javascript:', 'data:', 'about:', 'chrome:', 'file:']\n  const currentDomain = window.location.origin\n  const currentPath = window.location.href.split('#')[0]\n  const removeBrackets = (url) => url ? url.replace(/\\[.*?\\]/g, '') : ''\n\n  allLinks.forEach((link) => {\n    const href = link.getAttribute('href')\n    if (href && href !== \"#\" && !nonLinkSchemes.some(scheme => href.startsWith(scheme))) {\n      const anchor = (link.innerText.trim() || 'N/A')\n        .split('\\n')\n        .map(l => l.trim())\n        .join(' ')\n      const cleanedHref = removeBrackets(href)\n      if (cleanedHref.startsWith('#')) {\n        links.internal.push({\n          anchor: anchor,\n          href: currentPath + cleanedHref\n        })\n      } else if (cleanedHref.startsWith('/')) {\n        links.internal.push({\n          anchor: anchor,\n          href: currentDomain + cleanedHref\n        })\n      } else if (cleanedHref.startsWith(currentDomain)) {\n        links.internal.push({\n          anchor: anchor,\n          href: cleanedHref\n        })\n      } else {\n        links.external.push({\n          anchor: anchor,\n          href: cleanedHref\n        })\n      }\n    }\n  })\n\n  if (links.internal.length === 0 && links.external.length === 0) {\n    links.errors.push(`No links found in page`)\n  }\n\n  const hrefs = Array.from(\n    new Set([...links.internal, ...links.external]\n      .map(link => link.href)\n      .map(href => href.split('#')[0])))\n  await Promise.all(hrefs.map(async (href) => {\n    try {\n      const response = await Promise.race([\n        fetch(href, { mode: 'no-cors' }),\n        new Promise(r => setTimeout(() => r('timeout'), 3000)),\n      ])\n      if (response === 'timeout') {\n        links.errors.push(`${href} code: did not return in 3s`)\n      } else if (response.status !== 0) {\n        if (!response.ok) {\n          links.errors.push(`${href} code: ${response.status}`)\n        }\n      }\n    } catch (error) {\n      console.log(href, error)\n      links.errors.push(href)\n    }\n  }))\n\n  return links\n}\n\n\n// calculate SEO score & grade\nfunction calculateSEOScore(data) {\n  let score = 100\n\n  // meta description\n  const metaDescriptionLength = data.metaTags.metaDescription.length\n  if (metaDescriptionLength < 50) {\n    data.warnings.push('Meta description is too short, 50 to 160 symbols recommended.')\n    score -= 5\n  } else if (metaDescriptionLength > 160) {\n    data.warnings.push('Meta description is too long, 50 to 160 symbols recommended.')\n    score -= 5\n  }\n\n  // word count\n  if (data.readingData.wordCount < 300) {\n    data.warnings.push('Page content is below 300 words.')\n    score -= 5\n  }\n\n  // page load time\n  const pageLoadTime = data.pageLoadTime\n  if (pageLoadTime >= 1000 && pageLoadTime < 2000) {\n    data.warnings.push('Page load time is above 1 second.')\n    score -= 5\n  } else if (pageLoadTime >= 2000 && pageLoadTime < 4000) {\n    data.warnings.push('Page load time is above 2 seconds.')\n    score -= 10\n  } else if (pageLoadTime > 4000) {\n    data.warnings.push('Page load time is above 4 seconds.')\n    score -= 15\n  }\n\n  // favicons\n  if (data.favicon.favicons.length < 1) {\n    data.warnings.push('Page has no favicons.')\n    score -= 5\n  }\n\n  // images\n  if (data.images.content.length < 3) {\n    data.warnings.push('Page has less than 3 images.')\n    score -= 5\n  }\n  if (data.images.errors.length > 0) {\n    data.warnings.push('Some images lack ALT attributes.')\n    score -= 5\n  }\n\n  // headings\n  if (data.headings.content.length < 3) {\n    data.warnings.push('Page has less than 3 headings total.')\n    score -= 5\n  }\n  if (data.headings.errors.includes('There are multiple H1 elements on the page.')) {\n    data.warnings.push('Multiple H1 elements on the page.')\n    score -= 10\n  } else if (data.headings.errors.includes('There is no H1 element on the page.')) {\n    data.warnings.push('H1 element is missing from page.')\n    score -= 10\n  }\n\n  // internal links\n  if (data.links.internal.length < 3) {\n    data.warnings.push('Less than 3 internal links found.')\n    score -= 10\n  } else if (data.links.internal.length < 10) {\n    data.warnings.push('Less than 10 internal links found.')\n    score -= 3\n  }\n\n  // external links\n  if (data.links.external.length < 3) {\n    data.warnings.push('Less than 3 external links found.')\n    score -= 10\n  } else if (data.links.external.length < 10) {\n    data.warnings.push('Less than 10 external links found.')\n    score -= 3\n  }\n\n  data.score = score\n\n  let grade\n  if (score >= 90) {\n    grade = '![icon](/img/commands/rate-a.svg)'\n  } else if (score >= 75) {\n    grade = '![icon](/img/commands/rate-b.svg)'\n  } else if (score >= 55) {\n    grade = '![icon](/img/commands/rate-c.svg)'\n  } else if (score >= 45) {\n    grade = '![icon](/img/commands/rate-d.svg)'\n  } else if (score >= 35) {\n    grade = '![icon](/img/commands/rate-e.svg)'\n  } else {\n    grade = '![icon](/img/commands/rate-f.svg)'\n  }\n\n  data.grade = grade\n}\n\n\nconst calculateMessage = (data) => {\n  const loadTimeEmoji = (time) => {\n    if (time === 'N/A' || time < 1000)\n      return '\u{1F7E2}'\n    if (time >= 1000 && time < 2000)\n      return '\u{1F7E1}'\n    if (time >= 2000 && time < 4000)\n      return '\u{1F7E0}'\n    return '\u{1F534}'\n  }\n\n  const formatNumber = (number) => {\n    if (number === 'N/A') return 'N/A'\n    return new Intl.NumberFormat('en-US', {\n      minimumFractionDigits: 0,\n      maximumFractionDigits: 0,\n      useGrouping: true,\n      grouping: [3],\n      separator: '\\u2009'\n    }).format(number).replace(/,/g, '\\u2009')\n  }\n\n  data.message = `\n    ## ${data.grade} ${data.metaTags.metaTitle}\n    Meta description: ${data.metaTags.metaDescription === 'N/A' ? 'N/A' : `**${data.metaTags.metaDescription}**`}\n    OpenGraph URL: ${data.metaTags.ogUrl}\n    OpenGraph image: ${data.metaTags.ogImage === 'N/A' ? 'N/A' : `[Found](${data.metaTags.ogImage})` }\n\n    Word count: **${formatNumber(data.readingData.wordCount)} words**\n    Reading time: **~${formatNumber(data.readingData.readingTimeMinutes)} min**\n    Server response size: **${formatNumber(data.responseSize)} bytes**\n    Resources size: **${formatNumber(data.resources.totalSizeBytes)} bytes**\n    Page load time: **${loadTimeEmoji(data.pageLoadTime)} ${formatNumber(data.pageLoadTime)} ms**\n    Resources load time: **${loadTimeEmoji(data.resourcesLoadTime)} ${formatNumber(data.resourcesLoadTime)} ms**\n\n    Headings: **${data.headings.content.length}** ${data.headings.errors.length > 0 ? data.headings.errors.map(img => `\\n\u{1F7E0} ${img}`).join('\\n') : ''}\n    Links: **${data.links.internal.length}** internal, **${data.links.external.length}** external ${data.links.errors.length > 0 ? `\\n\u{1F7E0} ${data.links.errors.length} possibly broken links` : ''}\n    Images: **${data.images.content.length}** ${data.images.errors.length > 0 ? data.images.errors.map(img => `\\n\u{1F7E0} ${img}`).join('\\n') : ''}\n\n    ${data.warnings.length > 0 ? 'SEO suggestions' : ''}\n    ${data.warnings.map(w => `\u{1F4A1} ${w}`).join('\\n')}\n  `.trim().split('\\n').map(item => item.trim()).join('\\n')\n}\n\n\n// combine all into one object\nasync function getPageData() {\n  const pageLoadTime = getPageLoadTime()\n  const resourcesLoadTime = getResourcesLoadTime()\n  const responseSize = await fetchResponseSize()\n  const resources = getResources()\n  const metaTags = extractMetaTags()\n  const readingData = calculateReadingTime()\n  const images = extractImages()\n  const favicon = extractFavicon()\n  const headings = extractAllHeadings()\n  const links = await extractAllLinks()\n\n  const pageData = {\n    pageLoadTime,\n    responseSize,\n    resources,\n    resourcesLoadTime,\n    metaTags,\n    readingData,\n    images,\n    favicon,\n    headings,\n    links,\n    warnings: [],\n  }\n\n  calculateSEOScore(pageData)\n  calculateMessage(pageData)\n\n  return pageData\n}\n\n\nreturn getPageData()",
                timeout: 3e4,
                param: "pageData",
                args: "",
                silent: true
              },
              {
                label: "OG IMAGE - YES",
                type: "say",
                message: "{{pageData.message}}"
              },
              {
                label: "OPTIONS MENU",
                type: "ask",
                param: "action",
                options: [
                  { label: "\u{1F4E6} EXPORT", value: "export" },
                  { label: "\u{1F4C4} HEADINGS", value: "headings" },
                  { label: "\u{1F5BC} IMAGES", value: "images" },
                  { label: "\u{1F517} LINKS", value: "links" },
                  { label: "\u{1F4BD} RESOURCES", value: "resources" }
                ],
                optionsInvalid: false,
                message: "",
                default: ""
              },
              {
                condition: "{{action}} = export",
                label: "SHOW EXPORT",
                type: "group",
                steps: [
                  {
                    type: "calc",
                    func: "clone",
                    from: "pageData",
                    to: "sherlock"
                  },
                  {
                    label: "EXPORT START",
                    type: "export",
                    what: "param",
                    param: "sherlock",
                    silent: true
                  }
                ]
              },
              {
                condition: "{{action}} = headings",
                label: "SHOW HEADINGS",
                type: "group",
                steps: [
                  {
                    label: "HEADINGS LIST",
                    type: "js",
                    code: 'const headingsArray = pageData.headings.content\n\nlet markdownTable = "|   | **Heading** |\\n"\nmarkdownTable += "|---|-------------|\\n"\n\nheadingsArray.forEach((heading, index) => {\n  markdownTable += `| ${index + 1} | ${heading} |\\n`\n});\n\nreturn markdownTable',
                    param: "headingsTable",
                    args: "pageData",
                    timeout: 15e3,
                    silent: true
                  },
                  {
                    condition: "{{pageData.headings.content.length}} = 0",
                    type: "say",
                    message: "\u{1F534} {{pageData.headings.errors.0}}",
                    interpolate: true
                  },
                  {
                    condition: "{{pageData.headings.content.length}} > 0",
                    type: "say",
                    message: "{{headingsTable}}",
                    interpolate: true
                  }
                ]
              },
              {
                condition: "{{action}} = images",
                label: "SHOW IMAGES",
                type: "group",
                steps: [
                  {
                    label: "IMAGES LIST",
                    type: "js",
                    code: "const imagesArray = pageData.images.content\nlet imagesTable = '\u{1F534} No images found in page.\\n'\nif (imagesArray.length > 0) {\n  imagesTable = '|   | **alt** | **image** |\\n'\n  imagesTable += '|---|---------|---------|\\n'\n  imagesArray.forEach((image, index) => {\n    imagesTable += `| ${index + 1} | ${image.alt} | ${image.src} |\\n`\n  })\n}\n\n\nconst faviconsArray = pageData.favicon.favicons\nlet faviconsTable = '\u{1F534} No favicons found in page.\\n'\nif (faviconsArray.length > 0) {\n  faviconsTable = '|   | **favicon** |\\n'\n  faviconsTable += '|---|-------------|\\n'\n  faviconsArray.forEach((favicon, index) => {\n    faviconsTable += `| ${index + 1} | ${favicon} |\\n`\n  })\n}\n\n\nreturn {\n  imagesTable,\n  faviconsTable,\n}",
                    param: "imageData",
                    args: "pageData",
                    timeout: 15e3,
                    silent: true
                  },
                  {
                    type: "say",
                    message: "**Images** {{imageData.imagesTable}}\n\n**Favicons** {{imageData.faviconsTable}}\n"
                  }
                ]
              },
              {
                condition: "{{action}} = links",
                label: "SHOW LINKS",
                type: "group",
                steps: [
                  {
                    label: "LINKS MARKDOWN",
                    type: "js",
                    code: "const linkData = {}\n\n\nconst sanitize = (anchor) => {\n  if (!anchor?.replaceAll) return ''\n  return anchor.replaceAll('{{', '{{\\\\')\n}\n\n\nlinkData.internal = '\u{1F534} No internal links found'\nif (pageData.links.internal.length > 0) {\n  linkData.internal = '|   | **Anchor** | **URL** |\\n'\n  linkData.internal += \"|---|------------|---------|\\n\";\n  pageData.links.internal.forEach((link, index) => {\n    linkData.internal += `| ${index + 1} | ${sanitize(link.anchor)} | ${link.href} |\\n`\n  })\n}\n\n\nlinkData.external = '\u{1F534} No external links found'\nif (pageData.links.external.length > 0) {\n  linkData.external = '|   | **Anchor** | **URL** |\\n'\n  linkData.external += \"|---|------------|---------|\\n\";\n  pageData.links.external.forEach((link, index) => {\n    linkData.external += `| ${index + 1} | ${sanitize(link.anchor)} | ${link.href} |\\n`\n  })\n}\n\n\nlinkData.errors = 'Not found'\nif (pageData.links.errors.length > 0) {\n  linkData.errors = '|   | **Link / Status** |\\n'\n  linkData.errors += \"|---|------------|\\n\";\n  pageData.links.errors.forEach((link, index) => {\n    linkData.errors += `| ${index + 1} | ${sanitize(link)} |\\n`\n  })\n}\n\n\nreturn `\n**Internal links**\n${linkData.internal}\n\n**External links**\n${linkData.external}\n\n**\u2757\uFE0F Possibly broken links**\n${linkData.errors}\n`.trim()",
                    param: "linksMarkdown",
                    args: "pageData",
                    timeout: 15e3,
                    silent: true
                  },
                  { type: "say", message: "{{linksMarkdown}}", interpolate: true }
                ]
              },
              {
                condition: "{{action}} = resources",
                label: "SHOW RESOURCES",
                type: "group",
                steps: [
                  {
                    label: "RESOURCES LIST",
                    type: "js",
                    code: 'const list = pageData.resources.list\n\nlet markdownTable = "| **Bytes** | **URL** |\\n"\nmarkdownTable += "|---------|---------|\\n"\n\nlist.forEach((r) => {\n  markdownTable += `| ${r.sizeInBytes} | ${r.url} |\\n`\n})\n\nreturn markdownTable',
                    param: "resourcesList",
                    args: "pageData",
                    timeout: 15e3,
                    silent: true
                  },
                  { type: "say", message: "{{resourcesList}}", interpolate: true }
                ]
              },
              { type: "jump", to: "OPTIONS MENU" }
            ]
          },
          {
            meta: {
              name: "seo-audit",
              title: "SEO Audit",
              category: "SEO",
              description: "Audit and improve your content for E-E-A-T, generate H1 and Meta Title."
            },
            steps: [
              {
                say: "Enter your SEO article content or leave it blank to parse from the page."
              },
              { ask: "param", default: "{{page}}" },
              {
                gpt: "Please ignore all previous instructions. I want you to respond only in {{language}}.\n\nI want you to act as a Google Quality Rater trained in auditing content for quality, relevance, truthfulness and accuracy. I'll provide you with the web page [CONTENT] to audit.\nYou are familiar with the concepts of E-E-A-T (Expertise, Authoritativeness, Trustworthiness) and YMYL (Your Money or Your Life) when evaluating the content.\nYour task is to create a Page Quality (PQ) rating. Be very factual with your assessment. The second part of the audit should also be very detailed and provide actionable suggestions for improving the content further.\nGive tips on how to match search intent and user expectations better. Give tips on what the content is missing. Create a very detailed content audit.\nAt the end of your analysis, suggest a 50\u201360 character H1 and Title tag.\n\n[CONTENT]:\n{{param}}\n\n[AUDIT RESULT]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { label: "\u269B\uFE0F KW CLUSTER REPORT", value: "cluster" },
                  { label: "\u2733\uFE0F KW STRATEGY GENERATOR", value: "strategy" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = cluster",
                type: "command",
                name: "Keyword cluster"
              },
              { condition: "{{change}} = cluster", type: "stop" },
              {
                condition: "{{change}} = strategy",
                type: "command",
                name: "Keyword strategy generator"
              },
              { condition: "{{change}} = strategy", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS]. Provide a rewritten response.\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[AUDIT RESULT]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "extract-seo-keywords",
              title: "Extract and research SEO keywords",
              category: "SEO",
              description: "Extract keywords from competitor's article, perform research. Find keyword density and LSI keywords."
            },
            steps: [
              {
                say: "Please paste article content (up to 3000 symbols), or press enter to extract keywords from the opened web page:\n"
              },
              { ask: "param", default: "{{page}}" },
              {
                gpt: "Please ignore all previous instructions. I want you to respond only in {{language}} and output a single table. Pretend to be a SEO keyword research expert.\nRead the [TEXT] that I will provide you.\nOutput a table with three columns: keyword, density %, LSI keywords.\nFind top 12 main keywords in that text, each containing at least 2 words. Output these in the first column of the resulting table.\nGive me a keyword density in the second column of the resulting table.\nNext I want you to come up with a list of LSI keywords and synonyms of those main keywords used in the article. Output a plain list of 5 keywords separated by comma in the third column called LSI keywords.\n\n[TEXT]:\n{{param}}\n\n[TABLE]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[TABLE]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "outrank-article",
              title: "Outrank article",
              category: "SEO",
              description: "Outrank competition with an in-depth, SEO-optimized article. Navigate to a web page with an article to outrank, then run this command."
            },
            steps: [
              {
                type: "say",
                message: "\u{1F4CC} For GPT-3.5 model, use the Quick option and make step-by-step improvements. Advanced version adds LSI KW from SERP and external links in one click, optimized for GPT-4."
              },
              {
                type: "ask",
                param: "mode",
                options: [
                  { label: "\u26A1 QUICK", value: "quick" },
                  { label: "\u{1F6E0}\uFE0F ADVANCED", value: "advanced" }
                ],
                label: "ASK MODE"
              },
              {
                condition: "{{mode}} = quick",
                type: "group",
                steps: [
                  {
                    type: "say",
                    message: "Please copy paste an article to outrank or press Enter and I will extract it from the opened web page:"
                  },
                  {
                    default: "{{page}}",
                    type: "ask",
                    param: "param",
                    message: ""
                  },
                  {
                    type: "gpt",
                    prompt: "Please ignore all previous instructions and respond only in {{language}}.\nAs a skilled SEO expert and high-end copywriter, I need you to create a comprehensive, detail-rich article based on my [CONTEXT], adhering to Google's E-A-T guidelines, with the goal of ranking high on Google.\n\nHere are the specific requirements:\n- Do not include the publication date or mention the author of the article, even if it's referenced in the [CONTEXT].\n- Use an H1 tag for the article's title, H2s for main sections, and H3s for sub-sections.\n- Focus on creating in-depth, informative paragraphs without an introduction or conclusion.\n- Conclude with a section of 3 Q&As.\n- Employ keyword-rich, meaningful subheadings that are direct and precise.\n- Ensure no repetition or echoing of the prompt.\n- Base the article solely on the provided textual content ([CONTEXT]), excluding any unrelated elements.\n- Refrain from using phrases like 'END OF ARTICLE' or similar.\n- The article should be in fully rendered Markdown format.\n- End with a concise meta description, rich in keywords.\n\n[CONTEXT]:\n{{param}}\n\nARTICLE:",
                    param: "article"
                  },
                  { type: "jump", to: "ask-for-change" }
                ],
                label: "QUICK"
              },
              {
                condition: "{{mode}} = advanced",
                type: "group",
                steps: [
                  {
                    default: "{{page}}",
                    type: "ask",
                    param: "param",
                    message: "Please copy paste an article to outrank or press Enter and I will extract it from the opened web page:",
                    label: "ASK FOR ARTICLE"
                  },
                  {
                    type: "ask",
                    message: "I can extract keywords from SERP to improve your article's Google E-A-T score.\n",
                    param: "serp-keywords",
                    options: [
                      { label: "\u{1F50D} EXTRACT", value: "extract" },
                      { label: "\u26D4\uFE0F SKIP", value: "skip" }
                    ],
                    label: "ASK FOR SERP KW"
                  },
                  {
                    condition: "{{serp-keywords}} = extract",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        message: "Enter a relevant Google Search query to extract keywords from the Search Engine Results Page (SERP).",
                        param: "query",
                        default: ""
                      },
                      {
                        type: "say",
                        message: "\u23F3 Extracting keywords. Please wait a bit..."
                      },
                      {
                        type: "gpt",
                        prompt: "I want you to respond only in {{language}} and output a single table.\nPretend to be a SEO keyword research expert.\nRead the [SERP] that I will provide you and find top 20 LSI keywords in SERP, each containing at least 2 words:\n- Output these keywords comma separated.\n- Do not include keywords in the list that are not thematically relevant to my query.\n- Do not add any notes, write only comma separated keywords.\n- Do not echo my prompt.\n\n\n[SERP]:\n{{serp {{query}}}}\n\n[KEYWORDS]:",
                        param: "keywords"
                      }
                    ],
                    label: "KEYWORDS"
                  },
                  {
                    type: "ask",
                    param: "serp-urls",
                    message: "\u{1F4A1} I can add external URLs from SERP '{{query}}' to your article to boost its search ranking. Shall I proceed?",
                    options: [
                      { label: "\u2705 ADD URLs", value: "extract" },
                      { label: "\u26D4\uFE0F SKIP", value: "skip" }
                    ],
                    default: "",
                    label: "ASK FOR URLS",
                    condition: "{{serp-keywords}} = extract"
                  },
                  {
                    type: "group",
                    steps: [
                      {
                        type: "calc",
                        func: "set",
                        param: "information",
                        format: "",
                        value: "{{serp {{query}}}}"
                      },
                      {
                        type: "calc",
                        func: "serp.extract-links",
                        from: "information",
                        to: "array",
                        limit: 8
                      },
                      {
                        type: "js",
                        code: 'let markdownText = `Found ${Math.min(8, args.array.length)} relevant links:\\n\\n`;\nfor (let index = 0; index < Math.min(8, args.array.length); index++) {\n  const item = args.array[index];\n  markdownText += `${index + 1}. [${item.title}](${item.url})\\n`;\n}\nmarkdownText += "\\nI\'ll add them to the article...";\nreturn markdownText;\n',
                        args: "array, query",
                        param: "markdownList",
                        silent: true
                      },
                      { type: "say", message: "{{markdownList}}" },
                      {
                        type: "js",
                        code: "let markdownText = '';\nfor (let index = 0; index < Math.min(4, args.array.length); index++) {\n  const item = args.array[index];\n  markdownText += `${index + 1}. [${item.title}](${item.url})\\n`;\n}\nreturn markdownText;\n",
                        args: "array, query",
                        param: "markdownUrls",
                        silent: true,
                        label: "SKIP: MARKDOWN URLS"
                      }
                    ],
                    condition: "{{serp-urls}} = extract",
                    label: "ADD URLS"
                  },
                  {
                    type: "gpt",
                    prompt: `Ignore all previous instructions.
Write a high-quality fully markdown formatted SEO article in {{language}}, based on my [CONTEXT] and adhering to the following guidelines:
- Do not write 'Published by' or mention the author in any other way.
- The article must adhere to Google E-A-T standards, featuring rich, detailed content.
- Structure the article using H1 for the title, H2 for main headings, and H3 for subheadings.
- Include a short frequently asked questions section with 3 QAs.
- Use concise, keyword-rich subheadings.
- Focus solely on textual content, disregarding any unrelated context in [CONTEXT].
- Avoid repetitions and do not include website fillers or ending notations.
- If an author is mentioned in [CONTEXT], remove them from your article and write in the we-form.
- Do not write "END OF REVISED TEXT","END OF ARTICLE" or any kind of such words anywhere.
- End with a keyword-enriched meta description.

[CONTEXT]:
{{param}}

[MARKDOWN FORMATTED ARTICLE]:`,
                    param: "article",
                    condition: "{{serp-keywords}} = skip",
                    label: "WITHOUT KW"
                  },
                  {
                    type: "group",
                    steps: [
                      {
                        type: "gpt",
                        prompt: `Ignore all previous instructions.
Write a high-quality fully markdown formatted SEO article in {{language}}, based on my [CONTEXT] and adhering to the following guidelines:
- The article must adhere to Google E-A-T standards, featuring rich, detailed content.
- Do not write 'Published by' or mention the author in any other way.
- Structure the article using H1 for the title, H2 for main headings, and H3 for subheadings.
- Include a short frequently asked questions section with 3 QAs.
- Integrate the provided list of keywords: "{{keywords}}".
---
[Integrate all of the URLs from the array into relevant locations using Markdown formatting]:
{{array}}
- Links should be embedded in the text, not mentioned in brackets.
- Distribute the links evenly throughout the text, not concentrated in one place.  If uncertain about placement, insert links at random within the text.
- Each URL should be used only once.
- Feel free to shorten or modify the titles for better integration.

- Use concise, keyword-rich subheadings.
- Focus solely on textual content, disregarding any unrelated context in [CONTEXT].
- Avoid repetitions and do not include website fillers or ending notations.
- If an author is mentioned in [CONTEXT], remove them from your article and write in the we-form.
- Do not write "END OF REVISED TEXT","END OF ARTICLE" or any kind of such words anywhere.
- End with a keyword-enriched meta description.

[CONTEXT]:
{{param}}

[MARKDOWN FORMATTED ARTICLE WITH INTEGRATED URLs]:`,
                        param: "article",
                        label: "WITH URLS AND KW",
                        condition: "{{serp-urls}} = extract"
                      },
                      {
                        type: "gpt",
                        prompt: `Ignore all previous instructions.
Write a high-quality fully markdown formatted SEO article in {{language}}, based on my [CONTEXT] and adhering to the following guidelines:
- The article must adhere to Google E-A-T standards, featuring rich, detailed content.
- Do not write 'Published by' or mention the author in any other way.
- Structure the article using H1 for the title, H2 for main headings, and H3 for subheadings.
- Include a short frequently asked questions section with 3 QAs.
- Integrate the provided list of keywords: "{{keywords}}".
- Use concise, keyword-rich subheadings.
- Focus solely on textual content, disregarding any unrelated context in [CONTEXT].
- Avoid repetitions and do not include website fillers or ending notations.
- If an author is mentioned in [CONTEXT], remove them from your article and write in the we-form.
- Do not write "END OF REVISED TEXT","END OF ARTICLE" or any kind of such words anywhere.
- End with a keyword-enriched meta description.

[CONTEXT]:
{{param}}

[MARKDOWN FORMATTED ARTICLE]:`,
                        param: "article",
                        label: "BASIC+KW",
                        condition: "{{serp-urls}} = skip"
                      }
                    ],
                    condition: "{{serp-keywords}} = extract",
                    label: "WITH KW"
                  },
                  { type: "jump", to: "ask-for-change" }
                ],
                label: "ADVANCED"
              },
              {
                type: "ask",
                label: "ask-for-change",
                message: "You can change the article style using the options below or type custom instructions. Read about [supported writing styles in our guide](https://harpa.ai/guides/writing-styles).\n",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u{1F4CB} PASTE TO PAGE", value: "paste" },
                  { label: "\u2734\uFE0F ADD KEYWORDS", value: "keywords" },
                  { label: "\u{1F9F2} ADD EXTERNAL LINKS", value: "links" },
                  {
                    label: "\u{1F4D1} TABLE OF CONTENTS",
                    value: "I want you to add a Table of Contents for my article using Markdown features."
                  },
                  { label: "\u{1F9E9} HASHTAGS", value: "hashtags" },
                  {
                    label: "\u{1F197} MECE",
                    value: "I want you to completely change the style of the text to MECE framework article creating style.This means that you should take the text and rewrite it from scratch in the style that I request, regardless of its original style."
                  },
                  {
                    label: "\u{1F4E3} AIDA",
                    value: "I want you to completely change the style of the text to Attention-Interest-Desire-Action writing framework. This means that you should take the text and rewrite it from scratch in the style that I request, regardless of its original style."
                  },
                  {
                    label: "\u{1F4A1} PAS",
                    value: "I want you to completely change the style of the text to Problem-Agitate-Solve writing framework. This means that you should take the text and rewrite it from scratch in the style that I request, regardless of its original style."
                  },
                  {
                    label: "\u{1F3AF} 5W1H",
                    value: "I want you to completely change the style of the text to 5W1H writing framework. This means that you should take the text and rewrite it from scratch in the style that I request, regardless of its original style."
                  },
                  {
                    label: "\u{1F4A1} SWOT",
                    value: "I want you to completely change the style of the text to SWAT Analysis (Strengths, Weaknesses, Opportunities, Threats) writing framework. This means that you should take the text and rewrite it from scratch in the style that I request, regardless of its original style."
                  },
                  {
                    label: "\u{1F309} BAB",
                    value: "I want you to completely change the style of the text to Before-After-Bridge writing framework. This means that you should take the text and rewrite it from scratch in the style that I request, regardless of its original style."
                  },
                  {
                    label: "\u{1F4DA} PASTOR",
                    value: "I want you to completely change the style of the text to Problem-Amplify-Solution-Testimonials-Offer-Response writing framework. This means that you should take the text and rewrite it from scratch in the style that I request, regardless of its original style."
                  },
                  {
                    label: "\u{1F393}\u200D\uFE0F FAB",
                    value: "I want you to completely change the style of the text to Features-Advantages-Benefits writing framework. This means that you should take the text and rewrite it from scratch in the style that I request, regardless of its original style."
                  },
                  {
                    label: "\u{1F53A} PYRAMID",
                    value: "I want you to completely change the style of the text to Pyramid Principle writing framework, start by presenting the most critical information (the main point) at the beginning, followed by supporting details and explanations arranged in a hierarchical structure. This means that you should take the text and rewrite it from scratch in the style that I request, regardless of its original style."
                  },
                  {
                    label: "\u{1F61A} KISS",
                    value: "I want you to completely change the style of the text to KISS (Keep It Simple, Stupid) writing framework. Avoid unnecessary jargon, complexity, and verbosity. This means that you should take the text and rewrite it from scratch in the style that I request, regardless of its original style."
                  },
                  {
                    label: "\u{1F4DD} PEEL",
                    value: "I want you to completely change the style of the text to PEEL (Point, Explanation, Evidence, Link) writing framework that begins by making a point, followed by an explanation of the point, the provision of evidence to support the claim, and finally, linking the point to the broader context or theme. This means that you should take the text and rewrite it from scratch in the style that I request, regardless of its original style."
                  },
                  {
                    label: "\u2B50 STAR",
                    value: "I want you to completely change the style of the text to STAR (Situation, Task, Action, Result) writing framework. This means that you should take the text and rewrite it from scratch in the style that I request, regardless of its original style."
                  },
                  {
                    label: "\u{1F985} SOAR",
                    value: "I want you to completely change the style of the text to SOAR (Situation, Obstacles, Actions, Results) writing framework. This means that you should take the text and rewrite it from scratch in the style that I request, regardless of its original style."
                  },
                  {
                    label: "\u{1F3DB}\uFE0F TOULMIN",
                    value: "I want you to completely change the style of the text to Toulmin Model writing framework: firstly establish a claim, then support it with evidence (grounds), and finally build a logical and persuasive case through warrants, which connect the evidence to the claim. This means that you should take the text and rewrite it from scratch in the style that I request, regardless of its original style."
                  },
                  {
                    label: "\u{1F4C8} SCIPAB",
                    value: "I want you to completely change the style of the text to SCIPAB (Situation, Complication, Implication, Position, Action, Benefit) writing framework. This means that you should take the text and rewrite it from scratch in the style that I request, regardless of its original style."
                  },
                  {
                    label: "\u{1F393}\u200D\uFE0F HARVARD",
                    value: "I want you to completely change the style of the text to Harvard writing framework, use headings and sub headings (H1, H2, H3, H4). This means that you should take the text and rewrite it from scratch in the style that I request, regardless of its original style."
                  },
                  {
                    label: "\u{1F575}\uFE0F\u200D\uFE0F OPINION",
                    value: 'I want you to completely change the style of the text to "Opinion Writing" framework: express different opinions on a given topic. This means that you should take the text and rewrite it from scratch in the style that I request, regardless of its original style.'
                  },
                  {
                    label: "\u{1F92A} GONZO",
                    value: "I want you to completely change the style of the text to GONZO writing framework. This means that you should take the text and rewrite it from scratch in the style that I request, regardless of its original style."
                  },
                  {
                    label: "\u{1F5E3}\uFE0F PREP",
                    value: "I want you to completely change the style of the text to PREP (Point, Reason, Example, Point) writing framework. This means that you should take the text and rewrite it from scratch in the style that I request, regardless of its original style."
                  },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop", label: "DONE" },
              {
                type: "group",
                steps: [
                  { type: "paste", text: "{{gpt}}", close: false },
                  { type: "control", action: "hide" },
                  { condition: "{{change}} = paste", type: "stop" }
                ],
                condition: "{{change}} = paste",
                label: "PASTE"
              },
              {
                type: "group",
                steps: [
                  {
                    type: "ask",
                    message: "I can extract keywords from SERP to improve your article's Google E-A-T score.\n",
                    param: "serp-kw-option",
                    options: [
                      { label: "\u{1F50D} EXTRACT", value: "extract" },
                      { label: "\u{1F4CC} PASTE KEYWORDS", value: "paste" }
                    ],
                    label: "ASK SERP KW"
                  },
                  {
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "keywordsList",
                        message: "Please type the keywords to add to the article, comma separated:\n",
                        condition: "{{serp-kw-option}} = yes"
                      }
                    ],
                    condition: "{{serp-kw-option}} = paste",
                    label: "PASTE KW"
                  },
                  {
                    condition: "{{serp-kw-option}} = extract",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "ask-reuse",
                        message: "\u267B\uFE0F Reuse your previous '{{query}}' search?",
                        options: [
                          { label: "\u2705 YES", value: "yes" },
                          { label: "\u26D4 NO", value: "no" }
                        ],
                        default: "",
                        condition: "{{query}} != "
                      },
                      {
                        type: "jump",
                        to: "SAY EXTRACTING",
                        condition: "{{ask-reuse}} = yes"
                      },
                      {
                        type: "ask",
                        message: "Enter a relevant Google Search query to extract keywords from the Search Engine Results Page (SERP).",
                        param: "query",
                        default: ""
                      },
                      {
                        type: "say",
                        message: "\u23F3 Extracting keywords. Please wait a bit...",
                        label: "SAY EXTRACTING"
                      },
                      {
                        type: "gpt",
                        prompt: "I want you to respond only in {{language}} and output a single table.\nPretend to be a SEO keyword research expert.\nRead the [SERP] that I will provide you and find top 20 LSI keywords in SERP, each containing at least 2 words:\n- Output these keywords comma separated.\n- Do not include keywords in the list that are not thematically relevant to my query.\n- Do not add any notes, write only comma separated keywords.\n- Do not echo my prompt.\n\n\n[SERP]:\n{{serp {{query}}}}\n\n[KEYWORDS]:",
                        param: "keywordsList"
                      }
                    ],
                    label: "EXTRACT FROM SERP"
                  },
                  {
                    type: "gpt",
                    prompt: "I need you to enhance the article with LSI Keywords from the SERP for better SEO optimization:\nFollow the instructions:\n- Maintain the original text structure and style, but incorporate LSI keywords where appropriate.\n- You can modify the provided keywords to better align with Google E-A-T guidelines.\n- Mention the keywords I provided in the text up to two times.\n- Do not highlight the inserted keywords in the text; I don't need to know where you've added them.\n\nLSI Keywords: {{keywordsList}}\n\nARTICLE:\n\n{{article}}\n\n\nREWRITTEN ARTICLE:",
                    label: "GPT ADD KWS",
                    param: "article"
                  },
                  { type: "jump", to: "ASK-FOR-CHANGE" }
                ],
                condition: "{{change}} = keywords",
                label: "ADD-KW-OPTION"
              },
              {
                condition: "{{change}} = links",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    param: "ask-urls",
                    message: "Would you like to auto-extract top SERP URLs or provide them yourself?",
                    options: [
                      { label: "\u{1F9F2} EXTRACT FROM SERP", value: "extract" },
                      { label: "\u{1F4CC} PASTE URLs", value: "paste" },
                      "$custom"
                    ],
                    default: ""
                  },
                  {
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "ask-reuse",
                        message: "\u267B\uFE0F Reuse your previous '{{query}}' search?",
                        options: [
                          { label: "\u2705 YES", value: "yes" },
                          { label: "\u26D4 NO", value: "no" }
                        ],
                        default: "",
                        condition: "{{query}} != "
                      },
                      {
                        type: "jump",
                        to: "CALC SERP QUERY",
                        condition: "{{ask-reuse}} = yes"
                      },
                      {
                        type: "ask",
                        param: "query",
                        message: "Please enter a SERP query, such as 'GTA 6 release date'.\n",
                        default: ""
                      },
                      {
                        type: "calc",
                        func: "set",
                        param: "information",
                        format: "",
                        value: "{{serp {{query}}}}",
                        label: "CALC SERP QUERY"
                      },
                      {
                        type: "calc",
                        func: "serp.extract-links",
                        from: "information",
                        to: "array",
                        limit: 8,
                        downgradeSocialLinks: true,
                        label: "FIND URLS"
                      },
                      {
                        type: "js",
                        code: 'let markdownText = `Found ${args.array.length} relevant links:\\n\\n`\nargs.array.forEach((item, index) => {\n  markdownText += `${index + 1}. [${item.title}](${item.url})\\n`;\n});\nmarkdownText += "\\nI\'ll add them to the article...";\nreturn markdownText;\n',
                        args: "array, query",
                        param: "markdownList",
                        label: "MESSAGE",
                        silent: true
                      },
                      { type: "say", message: "{{markdownList}}" },
                      {
                        type: "gpt",
                        prompt: "Please ignore all previous instructions.\nI will provide you with an array containing URLs, Titles, and descriptions of the content.\nI want you to integrate all of the provided URLs  into the article text, ensuring a natural fit:\n- Do not change the structure or content of the article.\n- Links should be embedded in the text, not mentioned in brackets.\n- Ensure each provided link is inserted into the text.\n- Avoid adding links to headings (h1-h4).\n- Distribute the links evenly throughout the text, not concentrated in one place\n- Each URL should be used only once.\n- If uncertain about placement, insert links at random within the text.\n- Feel free to shorten or modify the titles for better integration.\n- Use Markdown formatting for embedding links.\n\nURLs array to integrate:\n{{array}}\n\n[ARTICLE]:\n{{article}}\n\n[REWRITTEN ARTICLE]:",
                        param: "article"
                      },
                      { type: "jump", to: "ask-for-change" }
                    ],
                    condition: "{{ask-urls}} = extract",
                    label: "AUTO EXTRACT URLS"
                  },
                  {
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "links",
                        message: 'Please provide the URLs to add to the article, separated by double slash " // "\n'
                      },
                      {
                        type: "gpt",
                        prompt: "Please ignore all previous instructions.\nI want you tu integrate the provided [URLs] into the article text, ensuring a natural fit.\n- Avoid adding links to headings (h1-h4).\n- Each URL should be used only once.\n- If unsure, insert at random locations within the text.\n- Use Markdown formatting for embedding links. -- Do not alter the text or its style; only add the links.\n\n[URLS], SEPARATED BY DOUBLE SLASHES //:\n\n{{links}}\n\n[ARTICLE]:\n{{article}}\n\n[NEW ARTICLE]:",
                        param: "article"
                      },
                      { type: "jump", to: "ask-for-change" }
                    ],
                    condition: "{{ask-urls}} = paste",
                    label: "PASTE MY URLS"
                  }
                ],
                label: "ADD-LINKS-OPTION"
              },
              {
                type: "group",
                steps: [
                  {
                    type: "gpt",
                    prompt: "Please ignore all previous instructions.\nI want you to respond only in {{language}}.\n- Identify the top 20 trending hashtags that target LSI keywords from my article.\n- Separate keywords by commas, write them with #. Only capitalize proper nouns.\n- Output in a single line.\n\nWrap your response into a markdown code block. Example:\n\n```markdown\n\n...hashtags...\n\n```\n\n[MY ARTICLE]:\n\n{{article}}\n\n\n[HASHTAGS]:",
                    param: "hashtags"
                  },
                  { type: "jump", to: "ASK-FOR-CHANGE" }
                ],
                condition: "{{change}} = hashtags",
                label: "HASHTAGS"
              },
              {
                type: "gpt",
                prompt: 'I would like you to make changes to your response (article).\n - Please do not output anything but the revised article.\n- Do not echo my command.\n- Do not put quotes around the revised text. If necessary, format the text using headings and subheadings (H2, H3, H4), bullet points, and other visual formatting methods.\n- Do not use words that refer to framework chapters (if i asked you to change text writing framework). For example, if I asked you to rewrite the text about the STAR framework, do not name the first chapter "Situation". Come up with a unique title for it that corresponds to the framework.\n- Do not write "END OF REVISED TEXT" or "END OF ARTICLE"\n\n[CHANGES TO MAKE]:\n{{change}}\n\n[MY ARTICLE]:\n{{article}}\n\n[REWRITTEN ARTICLE]:',
                param: "article",
                label: "GPT-REFINE-STEP"
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "keyword-report",
              title: "Keyword report",
              category: "SEO",
              description: "Create a keyword report and SEO content plan from 1 keyword."
            },
            steps: [
              { say: "Your keyword:\n" },
              { ask: "param" },
              {
                gpt: "Please ignore all previous instructions. I want you to respond only in {{language}}.\nI want you to act as a market research expert. Pretend that you have the most accurate and detailed information about keywords available.\nPretend that you are able to develop a full SEO content plan. I will give you the target keyword or topic.\nFrom this keyword create a table with a keyword list for an SEO content strategy plan on the keyword topic. The table shall have the following columns: keyword, search intent, title, meta description.\nIn the first column list 10 long-tail keywords or subcategory keywords related to the target keyword or topic.\nIn the second column list human searcher intent for the keyword. Label the topic in one of three search intent groups based on their search intent: whether commercial, transactional or informational.\nIn the third column, write a simple but very click-enticing title to use for a post about that keyword.\nIn the fourth column write an attractive meta description that has the chance for a high click-thru-rate for the topic with 120 to a maximum of 155 words. The meta description shall be value based, so mention value of the article and have a simple call to action to cause the searcher to click.\nDo not use too generic keyword like `introduction` or `conclusion` or `tl:dr`. Focus on the most specific keywords only. Do not use quotes or any other enclosing characters in any of the columns.\n\n[KEYWORD OR TOPIC]: {{param}}\n\n[TABLE]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[TABLE]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "keyword-strategy",
              title: "Keyword strategy generator",
              category: "SEO",
              description: "Provides a detailed strategy for any SEO keyword."
            },
            steps: [
              { say: "Please enter a keyword:\n" },
              { ask: "param" },
              {
                gpt: `Please ignore all previous instructions.
Your task is to generate keyword strategy from one keyword in {{language}}.
Pretend you're the absolute best keyword researcher in the world. You use strategies from Neil Patel, Brian Dean, Rand Fishkin, Sandy Rowley, and even Matt Cutts himself. You pride yourself on the depth of your research and your content briefs. You've been assigned a comprehensive content plan that involves keyword research for the [KEYWORD], and you have the following tasks to accomplish:
- Set the title to the primary Keyword.
- Using an unordered list, find a comprehensive list of FAQs related to the primary keyword and put them in a list with a heading 2 "FAQs".
- Using an unordered list, list related search queries related to the primary keyword and put them in a list with a heading 2 "Related Queries".
- Using an unordered list, list long-tail that you believe are easy to rank for based on the top positions not having quality content based on the most recent publicly available Google\u2019s Quality Guidelines and their on-page SEO Efforts and put them in a list with a heading 2 "Long Tail Keywords"
- Using an unordered list, find the top 25 keywords, NLP keywords and LSI keywords and put them in a structured markdown table where the first column is the keyword, the second column is whether it\u2019s a Keyword, NPL or LSI type, the next column is the keyword intent and the final column is how many times you\u2019d recommend using the keyword as an Integer. Make sure there are at least 25 target keywords. Put this under a heading 2 "Keywords".
- Using averages, where higher position results in search engines have a higher weight, and lower positions have a lower weight, looking at the page slug (path), what should we use as our slug? Put this under a heading 2
- Using an unordered list, list the SEO entities that apply to the primary keyword that could be used throughout the content and put them into a list under a heading 2 "Entities".
- Write a 175 to 200-character CTR-focused meta description for this page using the data above, something that catches the attention and encourages a click. Put this under a heading 2 "Meta Description", don\u2019t add quotes around the content.
- Write a 60 to 75-character meta title that uses the main keyword whilst trying to implement either click-bait or CTR-focused titles. Put this under a heading 2 "Meta Title", don\u2019t add quotes around the content.
- Write a 200-250 character page excerpt that\u2019ll be above the fold, includes the primary keyword, satisfying the search intent, yet encouraging the reader to read on for more information. Put this under a heading 2 "Page Excerpt", don\u2019t add quotes around the content.
- Considering the latest publicly available Google Quality Guidelines, using an unordered list, list the top 3-5 URLs that have the best content under a heading 2 "References".
You\u2019re assigned this task with special notes to keep in mind the following:
- Follow the most recent publicly available Google Quality Rater guidelines.
- Google E-A-T guidelines need to be met.
- The research needs to consider that the content is meant to be useful for the end reader, is easy to read, quickly answers the searcher\u2019s intent, and provides value immediately.

[KEYWORD]: {{param}}

[KEYWORD STRATEGY]:`
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS]. Provide a rewritten response.\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[KEYWORD STRATEGY]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "topic-authority",
              title: "Topic authority",
              category: "SEO",
              description: "Create a table with article ideas to help you build a topic authority."
            },
            steps: [
              { say: "What your main article is about or a search keyword:\n" },
              { ask: "param" },
              {
                gpt: "Please ignore all previous instructions. The output should be in {{language}}.\nCreate a table that contains article ideas to build topic authority for my keyword or topic.\nThe table should contain six rows where the first row is the header with column names.\nThe other five rows should be ideas for the topics, related to the main topic or keyword, that should give me a boost by these supporting articles.\nThe columns should be:\n1. Title for the article with no more than 45 characters, 2. Description of the article with a maximum of 120 characters, 3. Suggestions of the top three strategically chosen keywords for the article, 4. Classification of the search intent using one word.\nPlease create such a table for me to help me build topic authority for my website and my main article.\n[KEYWORD OR TOPIC]:\n{{param}}\n\n[TABLE]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[TABLE]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "keyword-cluster",
              title: "Keyword cluster",
              category: "SEO",
              description: "Cluster a list of keywords based on their semantic relevance."
            },
            steps: [
              {
                say: "Paste a list of keywords, maximum ~3000. Leave empty to parse from the web page:\n"
              },
              { ask: "param", default: "{{page}}" },
              {
                gpt: "Please ignore all previous instructions. I want you to respond only in {{language}}.\nI want you to create a keyword cluster report. Please extract keywords from the following text and give me back a short overview of cluster topics found in a numbered list:\n\nCluster topics overview:\n1. Topic 1, Description\n2. Topic 2, Description\n3. etc.\nThen please generate a markdown table, with the following 4 columns: Cluster, Keyword, Search Intent, Language.\nClassify each of the keywords by the search intent, whether commercial, transactional or informational. Then cluster the keywords into groups based on their semantic relevance.\n\n[EXTRACT KEYWORDS FROM THE FOLLOWING TEXT]:\n{{param}}\n\n[CLUSTER TOPICS AND TABLE]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u{1F50D} SEO AUDIT", value: "audit" },
                  { label: "\u2734\uFE0F KW STRATEGY GENERATOR", value: "strategy" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = audit",
                type: "command",
                name: "SEO Audit"
              },
              { condition: "{{change}} = audit", type: "stop" },
              {
                condition: "{{change}} = strategy",
                type: "command",
                name: "Keyword strategy generator"
              },
              { condition: "{{change}} = strategy", type: "stop" }
            ]
          },
          {
            meta: {
              name: "content-analyzer",
              title: "Content analyzer",
              category: "SEO",
              description: "Evaluate and audit an article text content in order to understand if it answers the user search intent."
            },
            steps: [
              {
                say: "Copy and paste your article text here, leave empty to parse from the web page:\n"
              },
              { ask: "param", default: "{{page}}" },
              { say: "User search query, search intent or keywords:\n" },
              { ask: "search" },
              {
                gpt: "Please ignore all previous instructions. I want you to respond only in language {{language}}.\nPretend to be a SEO keyword research expert and an expert copywriter.\n1. On a scale of 0 to 10, how relevant is the following content for the query I'm trying to rank on Google? And how can I improve it?\n2. Evaluate if I'm clearly demonstrating that I have expertise in the topic I'm writing about? And how can I improve authoritativeness around this topic?\nFormat your response using headings (H2, H3, H4), numbered and bullet points, and other markdown formatting features.\n\n[OUTPUT FRAMEWORK]:\n## 1. Relevance of content:\nanalysis\n### Improvement Suggestions:\ntext\n## 2. Demonstration of expertise:\nanalysis\n### Improvement Suggestions:\ntext\n## Conclusion\ntext\n\nProvide the answer, don't write general phrases and don't echo my command.\n\n[MY WEB PAGE CONTENT]:\n{{param}}\n\n[USER SEARCH QUERY, SEARCH INTENT OR KEYWORDS]:\n{{search}}\n\n[ANALYSIS]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\nANSWER:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "6-months-seo-plan",
              title: "6 months SEO plan",
              category: "SEO",
              description: "Create SEO strategies, competitive with the top websites in the given space."
            },
            steps: [
              {
                say: "Enter a list of keywords to rank by, leave empty to parse from the web page:\n"
              },
              { ask: "param", default: "{{page}}" },
              {
                gpt: "Please ignore all previous instructions. I want you to only answer in {{language}}.\nI want you to act like a Senior SEO Strategist for a company, who manages a large team of seo specialist.\nI want you to pretend that you can create SEO strategies that are competitive with the top websites in the given space, and always produces very good results especially rankings on Google.\nI will provide you with a list of keywords to work with or give you a text, and you will extract the keywords independently and conduct an analysis on them.\nYour task is to create a comprehensive 6 months SEO strategy, in a table show monthly focus areas, for example month 1, month 2, month 3... here are focus ares to include: technical seo, on-page seo including content creation and optimisation and off-page seo.\nPlease provide a description of activities to be done, expectations and tools required.\nFormat your response using headings (H2, H3, H4), numbered and bullet points, and other markdown formatting features.\nJust provide the answer, don't write general phrases and don't echo my command.\n[LIST OF KEYWORDS OR TEXT]:\n{{param}}\n\n[SEO PLAN]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS]. Provide a rewritten response.\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[SEO PLAN]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "landing-page-structure",
              title: "Landing page structure",
              category: "SEO",
              description: "Create a landing page structure with attention grabbing headlines about the given topic, product or service."
            },
            steps: [
              {
                say: "Enter your topic, product or service or leave empty to parse them from page:\n"
              },
              { ask: "param", default: "{{page}}" },
              {
                gpt: "Please ignore all previous instructions.\nI want you to act as a proficient SEO and high end copy writer that speaks and writes fluent {{language}}.\nCreate a Landing Page Structure with an Attention Grabbing Headline and subheader about the product. I will describe a service or topic in the end.\nTry to grab the attention of the visitor and increase the Opt-ins or Sales-rate, provide text content for landing page sections. Display the Structure of the Landing Page using markdown syntax.\n\n[SERVICE OR TOPIC]:\n{{param}}\n\n[LANDING PAGE STRUCTURE]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[LANDING PAGE STRUCTURE]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "hero-image-ideas",
              title: "Hero image ideas",
              category: "SEO",
              description: "Create ideas of a hero image (banner) for your web page."
            },
            steps: [
              {
                type: "ask",
                default: "",
                param: "param",
                message: "What's your web page about? Pick an option or describe.",
                optionsInvalid: false,
                options: [
                  { label: "\u2733\uFE0F USE WEBPAGE", value: "{{page}}" },
                  { label: "\u{1F4F8} PAGE SCREENSHOT", value: "screenshot" },
                  "$custom"
                ]
              },
              {
                condition: "{{param}} = screenshot",
                label: "PAGE SCREENSHOT",
                type: "ask",
                param: "param",
                message: "",
                options: null,
                default: "",
                vision: { enabled: true, mode: "view", hint: "", send: true }
              },
              {
                type: "gpt",
                prompt: "Please ignore all previous instructions. You will respond using {{language}}.\nI want you to generate at least 3 ideas for a hero image to be shown on a web page. I will give you a description of the web page or its' content. Please generate 3 banner ideas. Provide details of what should be shown on the image.\n[PAGE BRIEF SUMMARY OR TEXT CONTENT]:\n{{param}}\n\n[HERO IMAGE IDEAS]:\n",
                param: "gpt"
              },
              {
                label: "ask-for-change",
                type: "ask",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[HERO IMAGE IDEAS]:",
                param: "gpt"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [
                  { type: "gpt", prompt: "{{change}}", param: "gpt" },
                  { type: "stop" }
                ]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "silo-structure",
              category: "SEO",
              title: "SILO website structure",
              description: "Create a SILO structure for a website from a list of keywords."
            },
            steps: [
              {
                say: "Enter a comma-separated list of keywords. Leave empty to parse from page:\n"
              },
              { ask: "param", default: "{{page}}" },
              {
                gpt: "Please ignore all previous instructions. The output should be in {{language}}.\nYour task is to create a detailed SILO structure for a website.\nThe sections and categories should be organized in a hierarchical structure (list), with the Home page at the top and the more specific pages at the bottom. Use the knowledge of how to make the best structure in terms of linking and SEO to get to the top positions in Google.\n\n[PLEASE PARSE KEYWORDS FOR THE WEBSITE FROM THE FOLLOWING TEXT]:\n{{param}}\n\n[SILO STRUCTURE]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { label: "\u{1F53C} PYRAMID STRUCTURE", value: "pyramid" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\nSILO structure:"
              },
              {
                condition: "{{change}} = pyramid",
                type: "gpt",
                prompt: "Please completely rewrite your website structure using a pyramid method for my website.\nPyramid site structure puts your most important content at the top, followed by your second most important content, your third most important content, etc.\nKey ideas of a pyramid structure method: - Ensures that users can quickly access the most important information without having to scroll or click through multiple pages. - Grabs users' attention with key points and summaries at the top of the page. - Helps in reducing bounce rates by providing valuable content upfront.\n\n[PYRAMID STRUCTURE FOR MY WEBSITE]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "domain-name-generator",
              title: "Domain name generator",
              category: "SEO",
              description: "Generate 50 domain name ideas for your niche."
            },
            steps: [
              {
                say: "Enter your niche, product / service / business description, or leave empty to parse from page:\n"
              },
              { ask: "description", default: "{{page}}" },
              {
                say: 'Comma-separated list of preferred top-level domains, e.g. "com, ai, io", leave empty for "com":\n'
              },
              { ask: "zones", default: ".com" },
              {
                gpt: "Please ignore all previous instructions. I want you to respond only in language {{language}}.\nGenerate 20 domain name ideas for the given topic, niche or product / business / service description which have some search volume.\nTry to come up with domain names that are available and not already used by other companies.\n[PREFERRED TOP-LEVEL DOMAIN ZONES]:\n{{zones}}\n\n[TOPIC / NICE / PRODUCT / BUSINESS / SERVICE DESCRIPTION]:\n{{description}}\n\n[DOMAIN NAMES LIST]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[DOMAIN NAMES LIST]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "image-briefs-for-seo-blog-article",
              title: "Image briefs for SEO blog articles",
              category: "SEO",
              description: "Find places in an article or web page to put images. Returns what the picture should be."
            },
            steps: [
              {
                say: "Paste the whole article here. Leave empty to parse the web page. Up to 3000 symbols:\n"
              },
              { ask: "param", default: "{{page}}" },
              {
                gpt: "Please ignore all previous instructions. I want you to respond only in the language {{language}}.\nI want you to act as a very proficient SEO and high end copywriter. Your task is to find all places to put images for a graphic designer in the given text it should say exactly what the picture should be of and the words it should have in it.\nThe pictures should explain and make the article and the words more visual and easier to understand. I want you output in a format that can be send directly to the graphic designer.\n[TEXT]:\n{{param}}\n\n[PLACES FOR IMAGES AND DESCRIPTIONS]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[PLACES FOR IMAGES AND DESCRIPTIONS]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "title-writer",
              title: "Meta Description and Title writer",
              category: "SEO",
              description: "Generate titles and meta descriptions for a list of keywords, text or web page."
            },
            steps: [
              {
                condition: "{{g.style}} =",
                label: "NO G.STYLE",
                type: "calc",
                func: "set",
                param: "g.style",
                format: "",
                value: "- I write without using complex language structures. My speech is correct and clear.\n- If I use a scientific term, I briefly explain its meaning to the reader.\n- My reader is a person aged 30-40 who enjoys concise articles with clearly stated facts."
              },
              {
                label: "START MENU",
                type: "ask",
                default: "{{page}}",
                param: "param",
                message: "Paste your article, blog post, keywords, or use the current webpage to generate titles and meta descriptions.\n\n**Current tone instructions:**\n\n```markdown\n{{g.style}}\n```",
                optionsInvalid: false,
                options: [
                  { label: "\u2705 USE WEBPAGE", value: "{{page}}" },
                  { label: "\u267B\uFE0F CHANGE INSTRUCTIONS", value: "change" },
                  "$custom"
                ]
              },
              {
                condition: "{{param}} = change",
                label: "CHANGE INSTRUCTIONS",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    param: "g.style",
                    message: "Please provide new tone instructions. ",
                    options: null,
                    default: ""
                  },
                  { type: "say", message: "\u2705 New instructions saved. " },
                  { type: "jump", to: "START MENU" }
                ]
              },
              {
                type: "gpt",
                prompt: "Please ignore all previous instructions.\nI want you to respond only in {{language}}.\n\nI want you to act as a proficient SEO and high end copy writer.\nI will give you comma-separated keywords, article or an entire web page content and you will reply with 5 SEO-optimized titles and 5 meta descriptions:\n- Start with 5 SEO-optimized titles, putting each one in a markdown ```code block```, then write 5 meta descriptions.\n- Each meta description must be under 160 characters long.\n- Do not add any notes, numbered lists or general phrases. Do not echo my prompt.\nMimic my writing style, which has these main features:\n{{g.style}}\n\n\nFollow the response format:\n\n**Titles:**\n\n```markdown\n...title text...\n```\n```markdown\n...title text...\n```\n...\n\n**Meta descriptions:**\n\n```markdown\n...meta description text...\n```\n```markdown\n...meta description text...\n```\n...\n\n[TEXT, ARTICLE OR WEB PAGE CONTENT]:\n{{param}}\n\n[TITLES AND META DESCRIPTIONS in {{language}}]:",
                param: "gpt",
                isolated: true
              },
              {
                label: "ask-for-change",
                type: "ask",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[TABLE WITH TITLES AND META DESCRIPTIONS]:",
                param: "gpt"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [
                  { type: "gpt", prompt: "{{change}}", param: "gpt" },
                  { type: "stop" }
                ]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "website-layout",
              category: "SEO",
              title: "Website layout",
              description: "Create a website layout (Sitemap) from a product or service description."
            },
            steps: [
              {
                say: "Please describe your product, service or business. Leave empty to parse from the web page.\n"
              },
              { ask: "param", default: "{{page}}" },
              {
                gpt: "Please ignore all previous instructions. I want you to respond only in {{language}}.\nI want you to act as a Content and Digital Marketing Strategist expert.\nYour task is to create a sitemap for a product / service / business website. Please parse product / service / business idea description from the following text:\n{{param}}\n\nI want you to figure out what web pages a website must contain and might contain. Web pages should not be too small. Please output web pages that the website must contain (Recommended) and might contain (Optional) in two separate lists.\nThen provide a sitemap XML in a markdown code block for the entire website.\n\n[WEB PAGES AND SITEMAP]:"
              }
            ]
          },
          {
            meta: {
              name: "social-posts-generator",
              category: "SMM",
              title: "Social posts generator",
              description: "Creates social media posts for articles, blog posts or webpage content.",
              apps: "Facebook, Instagram"
            },
            steps: [
              {
                condition: "{{g.style}} =",
                label: "NO G.STYLE",
                type: "group",
                steps: [
                  {
                    type: "calc",
                    func: "set",
                    param: "g.style",
                    format: "",
                    value: "- I write without using complex language structures. My speech is correct and clear.\n- If I use a scientific term, I briefly explain its meaning to the reader.\n- My reader is a person aged 30-40 who enjoys concise articles with clearly stated facts."
                  }
                ]
              },
              {
                label: "START MENU",
                type: "ask",
                param: "content",
                message: "Paste your article, blog post, keywords, or use the current webpage to generate 3 social media blog posts.\n\n**Current tone instructions:**\n\n```markdown\n{{g.style}}\n```",
                options: [
                  { label: "\u2705 USE WEBPAGE", value: "{{page}}" },
                  { label: "\u267B\uFE0F CHANGE INSTRUCTIONS", value: "change" },
                  "$custom"
                ],
                default: "{{page}}",
                optionsInvalid: false
              },
              {
                condition: "{{content}} = change",
                label: "CHANGE INSTRUCTIONS",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    param: "g.style",
                    message: "Please provide new tone instructions. ",
                    options: null,
                    default: ""
                  },
                  { type: "say", message: "\u2705 New instructions saved. " },
                  { type: "jump", to: "START MENU" }
                ]
              },
              {
                type: "say",
                message: "Please pick a social media post format:\n"
              },
              {
                type: "ask",
                param: "length",
                options: [
                  {
                    label: "\u{1F4AC} SHORT",
                    value: "Write short social media posts consisting of 2-3 sentences that convey the main point of my article or content."
                  },
                  {
                    label: "\u{1F4DD} LONG",
                    value: "Write long social media blog posts of 5-8 sentences that fully explain the essence of my article or content, addressing at least 2 key aspects."
                  },
                  "$custom"
                ],
                optionsInvalid: false,
                message: "",
                default: ""
              },
              {
                type: "gpt",
                prompt: "Act as a professional journalist and SEO copywriter.\n\nI want you to write 3 high-quality social media posts in {{language}}, based on my [ARTICLE] and adhering to the following guidelines:\n- Do not write hashtags.\n- Use concise, keyword-rich sentences.\n- Focus solely on textual content, disregarding any unrelated context in [ARTICLE].\n- Avoid repetitions and do not include website fillers or ending notations.\n- Do not write any general phrases and notes.\n- Write each social media post in a markdown ```code block```.\n- {{length}}\n\nMimic my writing style, which has these main features:\n{{g.style}}\n\n\n[ARTICLE]:\n{{content}}\n\n[3 SOCIAL MEDIA POSTS WITHOUT HASHTAGS]:",
                isolated: true,
                param: ""
              },
              {
                label: "ASK FOR CHANGE",
                type: "ask",
                param: "change",
                message: "",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ],
                default: "",
                optionsInvalid: false
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                label: "ASK FOR INSTRUCTIONS",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?",
                options: null,
                default: ""
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[TABLE WITH TITLES AND META DESCRIPTIONS]:"
              },
              {
                condition: "{{change-option}} = $custom",
                label: "CHANGE=CUSTOM",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }]
              },
              { type: "jump", to: "ASK FOR CHANGE" }
            ]
          },
          {
            meta: {
              name: "clickbait-writer",
              title: "Clickbait writer",
              category: "SMM",
              description: "Generate 10 catchy and high-converting clickbaits."
            },
            steps: [
              {
                type: "ask",
                default: "{{page}}",
                param: "param",
                message: "Enter your topic here or pick an option. ",
                optionsInvalid: false,
                options: [
                  { label: "\u2733\uFE0F USE WEBPAGE", value: "{{page}}" },
                  { label: "\u{1F4F8} CAPTURE AREA", value: "capture" },
                  "$custom"
                ]
              },
              {
                condition: "{{param}} = capture",
                label: "CAPTURE AREA",
                type: "ask",
                default: "",
                param: "param",
                message: "",
                optionsInvalid: false,
                options: null,
                vision: {
                  enabled: true,
                  mode: "area",
                  hint: "Pick page content for the clickbaits.",
                  send: true
                }
              },
              {
                type: "gpt",
                prompt: `Please ignore all previous instructions.
I want you to respond only in {{language}}.
I want you to act as a highly skilled marketer and top-tier copywriter. I want you to pretend that you are an expert at writing all types of CTAs.
Your task is to come up with at least 10 catchy, human-written, suspenseful CTAs for a topic or web page I provide at the end. The best clickbaits usually:
- Provoke or grab attention: This is often in the form of a question or a statement that creates a sense of curiosity or urgency.
- Have a strong emotional hook: The headline should tap into the reader's emotions and make them feel invested in finding out more.
- Relevant to the target audience: The headline should be relevant to the reader's interests or needs.
- Have a sense of exclusivity: Clickbait headlines often suggest that the reader will get access to something special or privileged by clicking through.
- Leave cliffhangers or contain lists such as "5 ways to ...".

[TOPIC OR WEB PAGE CONTENT FOR THE CLICKBAITS]:
{{param}}

[10 CATCHY, HUMAN-WRITTEN, SUSPENSEFUL CTAS]:`,
                param: "gpt"
              },
              {
                label: "ask-for-change",
                type: "ask",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [Additional Instructions].\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[10 CATCHY, HUMAN-WRITTEN, SUSPENSEFUL CTAS]:",
                param: "gpt"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [
                  { type: "gpt", prompt: "{{change}}", param: "gpt" },
                  { type: "stop" }
                ]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "product-benefits-post",
              category: "SMM",
              title: "Product benefits overview post",
              description: "Helps create a non-promotional blog post that highlights the positive qualities of the product."
            },
            steps: [
              {
                type: "ask",
                param: "product",
                message: "Describe your product / service or pick an option. \n",
                default: "{{page}}",
                optionsInvalid: false,
                options: [
                  { label: "\u2733\uFE0F FIND ON WEBPAGE", value: "{{page}}" },
                  { label: "\u{1F4F8} CAPTURE AREA", value: "capture" },
                  "$custom"
                ]
              },
              {
                condition: "{{product}} = capture",
                label: "CAPTURE AREA",
                type: "ask",
                param: "product",
                message: "",
                default: "",
                optionsInvalid: false,
                options: null,
                vision: {
                  enabled: true,
                  mode: "area",
                  hint: "Select the product info to analyze.",
                  send: true
                }
              },
              {
                type: "ask",
                param: "target",
                message: "Describe the target audience or press Enter to skip.\n",
                default: "Come up with a potential target audience based on product info."
              },
              {
                type: "ask",
                param: "example",
                message: "Give me an example of a perfect product post or press Enter to skip.",
                default: "No specific instructions."
              },
              {
                type: "gpt",
                prompt: `Please ignore all previous instructions.
The output should be in {{language}}. Act like a professional copywriter and a digital sales manager.
Craft a blog post that provides a detailed overview of the features and benefits of my product or service.

Use style and tone that resonates with my target audience to demonstrate how my product addresses their unique concerns and desires.
Generate and use strong SEO words that fits to my product and it's audience.
Leverage the power of storytelling to illustrate the impact of my product / service on my target audience.
End with a strong, clear, compelling or urgent call-to-action that encourages the audience to take the next step towards purchasing / signing up for / trying my product or service.
It's a blog post about benefit of my product / service, not an ad for product / service.

[POST FRAMEWORK]:
"
## [Post title]
[Text]

### Meta Description
[Meta Description]

### [Introduction title]
[introduction]

### [1st chapter title (do not write "Chapter 1)]
[text]

### [2nd chapter title (do not write "Chapter 2)]
[text]

### [3rd chapter title(do not write "Chapter 3)]
[text]

### [Conclusion title]
[Conclusion with a hidden CTA sentence. Do not echo with "CTA" or "Call to action". Highlight the word for LINK BUTTON]
"

[PARSE PRODUCT / SERVICE DESCRIPTION FROM TEXT]:
{{product}}.

[SPECIFIC EXAMPLES IF ANY]:
{{example}}

[TARGET AUDIENCE]:
{{target}}

[BLOG POST]:`,
                param: "gpt"
              },
              {
                label: "ask-for-change",
                type: "ask",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[BLOG POST]:",
                param: "gpt"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [
                  { type: "gpt", prompt: "{{change}}", param: "gpt" },
                  { type: "stop" }
                ]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "facebook-ads-generator",
              title: "Facebook ads generator",
              category: "SMM",
              description: "Generate a custom Facebook ad to boost conversions and revenue of your product or service.",
              apps: "Facebook"
            },
            steps: [
              {
                say: "Describe the product and its benefits, explain the goals of your marketing campaign. Leave blank to parse product description from the web page:\n"
              },
              { ask: "param", default: "{{page}}" },
              {
                gpt: "Please ignore all previous instructions. Please only respond in {{language}}.\nI want you to act as a professional copywriter with experience in writing high-converting Facebook ads. I want you to write an Ad copy. The ad copy should be between 100-150 words long.\nI want you to write a Facebook ad copy for a product / service that I will describe below. Use the following guidelines:\n- Create a compelling headline that grabs attention and highlights the main benefit of the product/service - Use clear and concise language in the body copy that focuses on the benefits of the product / service and addresses any potential user objections - Include a strong call to action that encourages users to take the desired action - Use an image or video that visually demonstrates the product / service and resonates with the target audience - Research the target audience demographics, such as age, gender, location, interests, and other characteristics that would help you to have a better understanding of the target audience, and create an ad that would be more appealing to them.\n\n[PRODUCT / SERVICE DESCRIPTION]:\n{{param}}\n\n[FACEBOOK AD COPY]:\n"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[FACEBOOK AD COPY]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "instagram-wizard",
              title: "Instagram Wizard",
              category: "SMM",
              emoji: "\u{1F9D9}",
              description: "Generate Instagram content ideas, carousels, reels, and post captions",
              apps: "Instagram"
            },
            steps: [
              {
                type: "ask",
                message: "Pick your Instagram need, and I'll do my best to help:",
                param: "option",
                options: [
                  { label: "\u{1F4A1} POST IDEAS", value: "post-ideas-generator" },
                  { label: "\u{1F4DD} POST CAPTION", value: "post-caption-generator" },
                  { label: "\u{1F39E} REELS SCRIPT", value: "reels-script" },
                  { label: "\u{1F3A0} CAROUSEL IDEAS", value: "carousel-generator" }
                ]
              },
              {
                condition: "{{option}} = reels-script",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    label: "reels",
                    param: "topic",
                    message: "Please provide the video post idea or press Enter to parse it from page:",
                    default: "{{page}}"
                  },
                  {
                    type: "gpt",
                    prompt: 'Please ignore all previous instructions. The output should be in {{language}}.\n\nAs a professional Instagram content creator and copywriter, your task is to write a 64-word script for a 15-second contrarian video tutorial. Begin with "Why" and offer a unique tip. Aim to craft a viral and imaginative video on the given topic.\n\nYour response should consist of two parts:\n\n## SCRIPT:\nA 64-word contrarian video tutorial script for a 15-second video.\n\n## CONTENT IDEAS:\nIdeas for video content that will be shown to the public.\n\n\n[PLEASE PARSE TOPIC FROM]:\n{{topic}}\n\n[INSTAGRAM 15SEC VIDEO SCRIPT]:\n'
                  },
                  {
                    type: "ask",
                    label: "ask-for-change1",
                    param: "change",
                    options: [
                      { label: "\u2705 DONE", value: "no" },
                      { label: "\u2734\uFE0F REFINE", value: "refine" },
                      { label: "\u{1F4A1} POST IDEAS", value: "ideas" },
                      { label: "\u{1F4DD} POST CAPTION", value: "caption" },
                      { label: "\u{1F3A0} CAROUSEL IDEAS", value: "carousel" },
                      { value: "$custom" }
                    ]
                  },
                  { condition: "{{change}} = no", type: "stop" },
                  {
                    condition: "{{change}} = refine",
                    type: "ask",
                    param: "instructions",
                    message: "What changes would you like me to make?"
                  },
                  { condition: "{{change}} = ideas", type: "jump", to: "ideas" },
                  {
                    condition: "{{change}} = caption",
                    type: "jump",
                    to: "caption"
                  },
                  {
                    condition: "{{change}} = carousel",
                    type: "jump",
                    to: "carousel"
                  },
                  {
                    condition: "{{change}} = refine",
                    type: "gpt",
                    prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[INSTAGRAM 15SEC VIDEO SCRIPT]:"
                  },
                  {
                    condition: "{{change-option}} = $custom",
                    type: "group",
                    steps: [
                      { type: "gpt", prompt: "{{change}}" },
                      { type: "stop" }
                    ]
                  },
                  { type: "jump", to: "ask-for-change1" }
                ]
              },
              {
                condition: "{{option}} = post-ideas-generator",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    label: "ideas",
                    param: "param",
                    message: "What your Instagram profile is about? Leave empty to parse from page:",
                    default: "{{page}}"
                  },
                  {
                    gpt: "Please ignore all previous instructions.\nI want you to respond only in {{language}}.\nPretend to be an SMM, content writer and my Virtual Assistant for Instagram. I will explain you what my Instagram account is about and your goal is to create a post calendar for the next 2 weeks, with ideas for posts, stories and reels.\nEvery item must contain 4 sub-items: - Post summary (for that day of the week) - Post type (story, post, carousel, reels etc.) - Image / Video description\nPlease try to avoid asking me additional questions and work with the information I have provided you.\n\n[PLEASE PARSE TOPIC OR IDEA FROM THE FOLLOWING TEXT]:\n{{param}}\n\n[POSTS, FORMATTED IN A MARKDOWN TABLE]:"
                  },
                  {
                    type: "ask",
                    label: "ask-for-change2",
                    param: "change",
                    options: [
                      { label: "\u2705 DONE", value: "no" },
                      { label: "\u2734\uFE0F REFINE", value: "refine" },
                      { label: "\u{1F4DD} POST CAPTION", value: "caption" },
                      { label: "\u{1F39E} REELS SCRIPT", value: "reels" },
                      { label: "\u{1F3A0} CAROUSEL IDEAS", value: "carousel" },
                      { value: "$custom" }
                    ]
                  },
                  { condition: "{{change}} = no", type: "stop" },
                  {
                    condition: "{{change}} = refine",
                    type: "ask",
                    param: "instructions",
                    message: "What changes would you like me to make?"
                  },
                  {
                    condition: "{{change}} = caption",
                    type: "jump",
                    to: "caption"
                  },
                  { condition: "{{change}} = reels", type: "jump", to: "reels" },
                  {
                    condition: "{{change}} = carousel",
                    type: "jump",
                    to: "carousel"
                  },
                  {
                    condition: "{{change}} = refine",
                    type: "gpt",
                    prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[POSTS, FORMATTED IN A MARKDOWN TABLE]:"
                  },
                  {
                    condition: "{{change-option}} = $custom",
                    type: "group",
                    steps: [
                      { type: "gpt", prompt: "{{change}}" },
                      { type: "stop" }
                    ]
                  },
                  { type: "jump", to: "ask-for-change2" }
                ]
              },
              {
                condition: "{{option}} = post-caption-generator",
                label: "POST CAPTION",
                type: "group",
                steps: [
                  {
                    label: "caption",
                    type: "ask",
                    message: "Share what your Instagram post is about, send an image or capture the webpage area.",
                    param: "topic",
                    default: "",
                    optionsInvalid: false,
                    options: [
                      { label: "\u{1F4F8} CAPTURE AREA", value: "capture" },
                      "$custom"
                    ]
                  },
                  {
                    condition: "{{topic}} = capture",
                    label: "CAPTURE AREA",
                    type: "ask",
                    message: "",
                    param: "topic",
                    default: "",
                    optionsInvalid: false,
                    options: null,
                    vision: {
                      enabled: true,
                      mode: "area",
                      hint: "Grab an image to generate a caption.",
                      send: true
                    }
                  },
                  {
                    type: "gpt",
                    prompt: "Please ignore all previous instructions.\nI want you to respond only in {{language}}.\nPretend to be an SMM, content writer and my Virtual Assistant for Instagram.\n\nI will give you an image, post topic or idea and your goal is to suggest me 3 post captions for that post.\n- Create 3 engaging Instagram post captions. Each caption should contain at least 100-150 words about the topic or post idea given below.\n- Captions should not contain any hashtags.\n- Do not put Captions into quotes.\n- After the third caption, please provide a list of 15 hashtags with # written in a single line separated with a space character. 80% of hashtags should be long-tail and 20% should be high-volume hashtags. Do not include any @mentions.\n- Be concise and to the point.\n- Every caption should have a title and a markdown code block with the caption itself, enclosed into code-block quotes.\nPlease try to mimic my tone of voice: {{tone}}\n\nHere is an example of a single caption output:\n\n## Post caption #1\n```markdown\n\ncaption text\n\n```\n\n## Hashtags\n```markdown\n\na list of 15 hashtags with # written in a single line separated with a space character\n\n```\n\n[IMAGE, TOPIC OR IDEA]:\n{{topic}}\n\n[3 POST CAPTIONS AND A LIST OF HASHTAGS]:",
                    param: "gpt"
                  },
                  {
                    type: "ask",
                    label: "ask-for-change3",
                    param: "change",
                    options: [
                      { label: "\u2705 DONE", value: "no" },
                      { label: "\u2734\uFE0F REFINE", value: "refine" },
                      { label: "\u{1F4A1} POST IDEAS", value: "ideas" },
                      { label: "\u{1F39E} REELS SCRIPT", value: "reels" },
                      { label: "\u{1F3A0} CAROUSEL IDEAS", value: "carousel" },
                      { value: "$custom" }
                    ]
                  },
                  { condition: "{{change}} = no", type: "stop" },
                  {
                    condition: "{{change}} = refine",
                    type: "ask",
                    param: "instructions",
                    message: "What changes would you like me to make?"
                  },
                  { condition: "{{change}} = ideas", type: "jump", to: "ideas" },
                  { condition: "{{change}} = reels", type: "jump", to: "reels" },
                  {
                    condition: "{{change}} = carousel",
                    type: "jump",
                    to: "carousel"
                  },
                  {
                    condition: "{{change}} = refine",
                    type: "gpt",
                    prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[3 POST CAPTIONS AND A LIST OF HASHTAGS]:"
                  },
                  {
                    condition: "{{change-option}} = $custom",
                    type: "group",
                    steps: [
                      { type: "gpt", prompt: "{{change}}" },
                      { type: "stop" }
                    ]
                  },
                  { type: "jump", to: "ask-for-change3" }
                ]
              },
              {
                condition: "{{option}} = carousel-generator",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    param: "topic",
                    label: "carousel",
                    message: "Please provide carousel post idea or press Enter to parse it from page:\n",
                    default: "{{page}}"
                  },
                  {
                    type: "gpt",
                    prompt: 'Please ignore all previous instructions. The output should be in {{language}}.\n\nYou goal is to write an Instagram carousel for the given topic or idea.\nWrite the carousel content slide by slide, with titles. Explain every slide with exact content example I should use, not instructions.\nAlso, give me [Image ideas] for every slide that explain all the titles for my topic. Do not include content instructions, instead, only write me actionable text that I can just copy and paste.\nOnce you write the carousel slides, add a separator at the end.\n\nAfter the separator, write the Instagram post description/caption in just a few sentences.\n\nFormat every new sentence with new lines so the text is more readable.\nInclude emojis and the best Instagram hashtags for that post.\nThe first caption sentence should hook the readers (spike their curiosity) and please do not start the sentence with "Are you curious".\n\nOutput framework:\n"\n## Instagram Carousel Topic: Topic\n\n### Slide 1: "Title"\nContent: Text\nImage: Image idea\n\n### Slide 2: "Title"\nContent: Text\nImage: Image idea\n\n### Slide 3: "Title"\nContent: Text\nImage: Image idea\n\n### Slide 4: "Title"\nContent: Text\nImage: Image idea\n\n### Slide 5: "Title"\nContent: Text\nImage: Image idea\n\n### Slide 6: "Title"\nContent: Text\nImage: Image idea\n\n### Slide 7: "Title"\nContent: Text\nImage: Image idea\n------------------------------\n### Instagram Post Description/Caption:\n[Text]\n"\n\n[PARSE CAROUSEL TOPIC FROM]:\n{{topic}}\n\n[INSTAGRAM CAROUSEL IDEA]:'
                  },
                  {
                    type: "ask",
                    label: "ask-for-change4",
                    param: "change",
                    options: [
                      { label: "\u2705 DONE", value: "no" },
                      { label: "\u2734\uFE0F REFINE", value: "refine" },
                      { label: "\u{1F4A1} POST IDEAS", value: "ideas" },
                      { label: "\u{1F4DD} POST CAPTION", value: "caption" },
                      { label: "\u{1F39E} REELS SCRIPT", value: "script" },
                      { value: "$custom" }
                    ]
                  },
                  { condition: "{{change}} = no", type: "stop" },
                  {
                    condition: "{{change}} = refine",
                    type: "ask",
                    param: "instructions",
                    message: "What changes would you like me to make?"
                  },
                  { condition: "{{change}} = ideas", type: "jump", to: "ideas" },
                  {
                    condition: "{{change}} = caption",
                    type: "jump",
                    to: "caption"
                  },
                  {
                    condition: "{{change}} = script",
                    type: "jump",
                    to: "script"
                  },
                  {
                    condition: "{{change}} = refine",
                    type: "gpt",
                    prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS]. Provide a rewritten Instagram carousel topic idea.\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[INSTAGRAM CAROUSEL IDEA]:"
                  },
                  {
                    condition: "{{change-option}} = $custom",
                    type: "group",
                    steps: [
                      { type: "gpt", prompt: "{{change}}" },
                      { type: "stop" }
                    ]
                  },
                  { type: "jump", to: "ask-for-change4" }
                ]
              }
            ]
          },
          {
            meta: {
              name: "ads-hook-generator",
              category: "SMM",
              title: "Ads hook generator",
              description: "Generate ad hooks / angles for anything you're promoting.",
              apps: "Facebook, Instagram"
            },
            steps: [
              {
                say: "What business, product, brand or service are you promoting? Leave empty to parse from page:\n"
              },
              { ask: "param", default: "{{page}}" },
              {
                gpt: `Please ignore all previous instructions. I want you to respond only in {{language}}.
I'm trying to come up with ideas for different hooks to promote something on a Facebook Ad. I need you to create a list of 10 potential hooks.
For example: If I'm trying to promote a hammer, I might have these 3 hooks... - Hook #1: The best way to put a nail into your wall - Hook #2: The best tool for hanging your paintings. - Hook #3: The perfect tool to make your house beautiful. - Hook #4: The most trusted tool by professionals around the world.
Another example: if I'm trying to promote a lead magnet about "client acquisition", I might have these 3 hooks...
- Hook #1: Keep yourself booked solid. - Hook #2: No more feast or famine months. - Hook #3: Stop waiting around for clients to find you.
Each hook should be one sentence and should be a different reason someone may want to click on my ad. Each idea needs to use copywriting and persuasion best practices to draw users to take action.

[OBJECT FOR PROMOTING]:
{{param}}

[HOOKS]:`
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                param: "change",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[HOOKS]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "bio-section-generator",
              title: "Social bio section generator",
              category: "SMM",
              description: "Helps you create a catchy bio for any social website, Instagram, Twitter, LinkedIn etc.",
              apps: "Instagram, LinkedIn, Twitter, Facebook, TikTok"
            },
            steps: [
              {
                type: "ask",
                param: "style",
                options: [
                  {
                    label: "\u{1F379} CASUAL",
                    value: "Use some suitable emojis. Feel free to use creative language, some emojis and hashtags to make the bio stand out and effectively communicate the individuals professional brand.\n"
                  },
                  {
                    label: "\u{1F454} FORMAL",
                    value: "Demonstrate professionalism: Use a formal style and refrain from using any emojis. Showcase my best traits.\n"
                  },
                  { label: "\u{1F4BC} LINKEDIN LONG", value: "linkedin" }
                ]
              },
              {
                condition: "{{style}} = linkedin",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    param: "expertise",
                    message: "What is your expertise? Hit Enter to parse from the opened page:",
                    default: "{{page}}"
                  },
                  {
                    type: "ask",
                    param: "ta",
                    message: "What is your target audience?\n",
                    default: "Please come up with something based on the available information.\n"
                  },
                  {
                    type: "ask",
                    param: "pain",
                    message: "What are the pain points of your target audience? Hit Enter to skip:\n",
                    default: "Please come up with something based on the available information.\n"
                  },
                  {
                    type: "ask",
                    param: "solutions",
                    message: "What solutions you provide to those pain points? Hit Enter to skip:\n",
                    default: "Please come up with something based on the available information.\n"
                  },
                  {
                    type: "gpt",
                    prompt: `Please ignore all previous instructions. Respond only in {{language}}.
Act as an expert copywriter for LinkedIn 'About/Bio' sections. I want you to write my LinkedIn bio in 200 words. Demonstrate professionalism: Use a formal style and refrain from using any emojis.

I do not need your comments, notes or any explanations of your choice. I only need your response following the framework and according to the example I provided below.

--- Response framework:
- My name should not be mentioned.
- Using a hook to draw attention and establish relevance
- Painting a picture of the target audience's pain points
- Amplifying the pain
- Presenting a solution that addresses the pain points
- Presenting the benefits of the solution
- Addressing common objections
- Provoking a call to action

--- Here is a great LinkedIn bio example:
" Are your sales drying up as a recession looms? Struggling with a weak sales pipeline can make it nearly impossible to hit revenue targets. If the worry of finding quality leads that fit your Ideal Customer Profile (ICP) resonates with you, then hello, I'm Tim, CEO of TaskDrive.
I've a passion for helping businesses grow, drawing on my experience as a CGO at startups, mentor through Growth Mentor, and lecturer at international business schools. I'm also a tech enthusiast, currently intrigued by ChatGPT.
Our aim at TaskDrive is simple: bolster your business against recession. We provide a consistent stream of accurate leads, an effective outreach strategy for conversion, and continued support through the sales process. We handle the heavy lifting so you can do what you do best - closing deals.
With TaskDrive's proven lead optimisation system, let your pipeline flow, not dry up. Reach out to discover more! "

Use that example and framework to create me a draft for my LinkedIn bio. Do not use emoji.

--- INFORMATION ABOUT ME: {{expertise}}

--- MY TARGET AUDIENCE: {{ta}}

--- PAIN POINTS OF MY TA: {{pain}}

--- MY SOLUTIONS TO THOSE PAIN POINTS: {{solutions}}

MY NEW LINKEDIN 200 WORDS BIO:
`
                  },
                  { type: "jump", to: "ask-for-change" }
                ]
              },
              {
                type: "ask",
                param: "p1",
                message: "Give me some information about your social media profile, use webpage content or capture a webpage area.",
                default: "{{page}}",
                optionsInvalid: false,
                options: [
                  { label: "\u2733\uFE0F USE WEBPAGE", value: "{{page}}" },
                  { label: "\u{1F4F8} CAPTURE AREA", value: "capture" },
                  "$custom"
                ]
              },
              {
                condition: "{{p1}} = capture",
                label: "CAPTURE AREA",
                type: "ask",
                param: "p1",
                message: "",
                default: "",
                optionsInvalid: false,
                options: null,
                vision: {
                  enabled: true,
                  mode: "area",
                  hint: "Pick what to analyze. ",
                  send: true
                }
              },
              {
                type: "gpt",
                prompt: "Please ignore all previous instructions.\nAct as a professional social website bio generator, and create 3 unique bio, for me to showcase my skills and experience on my social website profile in {{language}}.\n\n{{style}}\n\nEvery bio should be brief, engaging and highlight the individual's professional accomplishments, key strengths, and unique selling points in a concise and attention-grabbing manner. The length of the bio should be within 150 characters.\n\nMy name should not be mentioned. Do not use emojis if I haven't asked you to.\n\nEvery bio should have a title and a markdown code block with the bio itself, enclosed into code-block quotes. Do not echo my prompt.\n\nI need only the answer in the framework that I will provide below. I do not need your comments, notes or any explanations of your choice.\n\nOutput framework:\n**Bio #1**\n```markdown\nmy new bio\n```\n\n[PARSE INFORMATION ABOUT ME FROM]:\n{{p1}}\n\n[MY 3 NEW BIO SECTIONS FOR MY INSTAGRAM PROFILE]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[REWRITTEN RESPONSE]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "hashtag-generator",
              title: "Hashtag generator",
              category: "SMM",
              description: "Create up to 30 social media Hashtags.",
              apps: "Instagram, Facebook, LinkedIn, TikTok, Twitter, YouTube, Amazon, Ebay"
            },
            steps: [
              {
                type: "ask",
                param: "param",
                message: "Describe what your post is about, paste an image, or capture an area.",
                default: "",
                optionsInvalid: false,
                options: [
                  { label: "\u{1F4F8} CAPTURE AREA", value: "capture" },
                  "$custom"
                ]
              },
              {
                condition: "{{param}} = capture",
                label: "CAPTURE AREA",
                type: "ask",
                param: "param",
                message: "",
                default: "",
                optionsInvalid: false,
                options: null,
                vision: {
                  enabled: true,
                  mode: "area",
                  hint: "Pick what to analyze. ",
                  send: true
                }
              },
              {
                type: "gpt",
                prompt: "Please ignore all previous instructions.\nI want you to respond only in {{language}}.\nCreate 30 social media trending hashtags targeting an LSI keyword with some search volume for my topic or content. Separate keywords by commas, write them with #. Only capitalize proper nouns. Output in a single line.\n\nWrap your response into a markdown code block. Example:\n```markdown\n...hashtags...\n```\n\n[TOPIC OR CONTENT]:\n{{param}}\n\n[HASHTAGS]:",
                param: "gpt"
              },
              {
                label: "ask-for-change",
                type: "ask",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[HASHTAGS]:",
                param: "gpt"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [
                  { type: "gpt", prompt: "{{change}}", param: "gpt" },
                  { type: "stop" }
                ]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "influencer-outreach-dm",
              title: "Influencer outreach DM",
              category: "SMM",
              description: "Write cold outreach DMs to help you sign influencer campaigns.",
              apps: "Instagram, Facebook, Twitter"
            },
            steps: [
              {
                say: "Influencer Name and BIO. Leave blank to parse from the page:\n"
              },
              { ask: "influencer", default: "{{page}}" },
              { say: "You collaboration idea (if any):\n" },
              {
                ask: "idea",
                default: "Please come up with collaboration idea on your own"
              },
              {
                gpt: "Please ignore all previous instructions. I want you to respond only in language {{language}}.\nI want you to act as marketing specialist and a Virtual Assistant.\nYour task is to write 3 cold outreach DMs (Direct Messages) to an influencer, asking him/her to collaborate with me. Write a DM as if from my point of view.\nTry to write a personalized copy, use real Influencer name if available. Add a human touch and something related to the Influencer so that the DM does not sound generic.\nDo not write long DMs, be concise and to the point.\nEvery DM should have a title and a markdown code block with the DM itself, enclosed into code-block quotes. Do not echo my prompt.\nHere is an example of a single DM output:\n\n## DM #1\n```markdown\n\nDM text\n\n```\n[COLLABORATION IDEA]:\n{{idea}}\n\n[PLEASE PARSE INFLUENCER INFORMATION FROM THE FOLLOWING TEXT]:\n{{influencer}}\n\n[3 COLD DMs]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONs].\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[3 COLD DMs]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "social-media-content-ideas",
              category: "SMM",
              title: "Social media content ideas",
              description: "Generate a list of 10 engaging post ideas that are tailored to the interests of your target audience, increase engagement and drive traffic.",
              apps: "Instagram, TikTok, Facebook, Twitter"
            },
            steps: [
              {
                say: `Enter a platform, type of content, topic and potential audience, for example "Instagram, Reels, Cat-loving owners, I'm selling pet insurance and veterinary services". Leave empty to parse from the web page:
`
              },
              { ask: "param", default: "{{page}}" },
              {
                condition: "{{param}} = {{page}}",
                type: "calc",
                param: "param",
                value: "Please parse from web page:\n{{page}}\n"
              },
              {
                gpt: 'Please ignore all previous instructions. The output should be in {{language}}.\nI want you to act as a social media marketing and content expert and generate a list of up to 10 unique and engaging post ideas for my case or topic.\nThe ideas should be tailored to the interests of the potential target audience and include a mix of different types of content (text, image, and video content), whichever appropriate.\nThe posts should aim to increase engagement and drive website traffic. Please research the target audience demographics, such as age, gender, location, interests, and other characteristics that would help you to have a better understanding of the target audience, and create post ideas that would be more appealing to them.\nSingle post framework:\n\n## Post #1 "Title about main idea"\n**Visual content:**\ndescription of the idea of what to show to the audience (image or video content).\n**Text content:**\n```markdown\nproposal for the textual content of the post without being placed in quotes.\n```\n\n**Note:**\nImportant notes for me.\n\n[MY CASE OR TOPIC]: {{param}}\n\n[10 UNIQUE AND ENGAGING POST IDEAS]:'
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[10 UNIQUE AND ENGAGING POST IDEAS]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "pinterest-pin-description",
              title: "Pinterest pin description",
              category: "SMM",
              description: "Create description for a Pinterest pin from title or topic.",
              apps: "Pinterest"
            },
            steps: [
              {
                type: "ask",
                default: "{{page}}",
                param: "param",
                message: "Enter Pin topic, title or pick an option.",
                optionsInvalid: false,
                options: [
                  { label: "\u2733\uFE0F FIND ON WEBPAGE", value: "{{page}}" },
                  { label: "\u{1F4F8} CAPTURE AREA", value: "capture" },
                  "$custom"
                ]
              },
              {
                condition: "{{param}} = capture",
                label: "CAPTURE AREA",
                type: "ask",
                default: "{{page}}",
                param: "param",
                message: "",
                optionsInvalid: false,
                options: null,
                vision: {
                  enabled: true,
                  mode: "area",
                  hint: "Grab an image to write a description.",
                  send: true
                }
              },
              {
                type: "gpt",
                prompt: "Please ignore all previous instructions. I want you to reply in {{language}} only.\nI want you to think that you are a very competent SEO and high-end copywriter.\nI want you to write an article on the topic that I will give you.\nPlease write from the first person perspective and address the reader as you. Write an article no longer than 500 characters that I can use for a pin on Pinterest. Do not self reference or mention that you are a SEO expert.\nUse key words from the topic. Don't use lists or headings, but use paragraphs. Don't go into details, summarize the topic as best as you can, as if you were writing a summary for a blog post. Be precise and to the point.\n[TOPIC]: {{param}}\n\n[ARTICLE]:",
                param: "gpt"
              },
              {
                label: "ask-for-change",
                type: "ask",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[ARTICLE]:",
                param: "gpt"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [
                  { type: "gpt", prompt: "{{change}}", param: "gpt" },
                  { type: "stop" }
                ]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "repurpose-video",
              category: "SMM",
              title: "Repurpose YouTube video",
              description: "Convert YouTube video to text content.",
              apps: "YouTube"
            },
            steps: [
              {
                say: "\u23F3 Parsing video from the page\u2026 Long videos may take a few seconds to parse."
              },
              { type: "calc", param: "transcript", value: "{{transcript}}" },
              {
                condition: "{{transcript}} = \u2014",
                type: "group",
                steps: [
                  {
                    say: "\u{1F6AB} It looks as if the video has no text transcript, or I could not fetch it from the page.\n"
                  },
                  { type: "stop" }
                ]
              },
              {
                type: "gpt",
                isolated: true,
                chunkify: { text: "{{transcript}}" },
                prompt: `I want you to only answer in {{language}}. You goal is to analyze a part of a YouTube transcript and extract the main important information from that.
Choose the format of recording this information depending on the subject of the video and format your response with markdown features.
Capture important facts in your answer and do not miss the names of people and their opinions.
Please, during the analysis of the transcript, do not mention that this is a video or a video transcript. Just analyze the text as content containing important information.
Your response be informative and easy to read & understand. Preserve as much important information as possible; you don't need to shorten your response.
Don't write general phrases like "this video is about..." or notes. I only need the result of the transcript analysis.

[VIDEO TRANSCRIPT CHUNK]:
{{chunk}}

[MAIN IMPORTANT INFORMATION IN {{language}}]:`
              },
              {
                type: "ask",
                label: "complete",
                message: "\u2705 Analysis complete. Let me know how to repurpose the video:",
                param: "action",
                options: [
                  { label: "\u{1F58A} BLOG POST", value: "blogpost" },
                  { label: "\u{1F4DD} ARTICLE", value: "article" },
                  { label: "\u{1F426} TWEET", value: "tweet" },
                  { label: "\u{1F6E0} CUSTOM", value: "custom" },
                  { label: "\u26D4 STOP", value: "no" }
                ]
              },
              { condition: "{{action}} = no", type: "stop" },
              {
                condition: "{{action}} = blogpost",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    param: "blog-post-option",
                    options: [
                      {
                        label: "\u2B06\uFE0F LONG",
                        value: "I need a long blog post, do not limit yourself by the word number.\n"
                      },
                      {
                        label: "\u2B07\uFE0F SHORT",
                        value: "The blog post must be short and concise, not exceeding 150 words. The short length ensures that the content remains engaging and easily digestible, aligning with the need for brief, yet informative content.\n"
                      }
                    ]
                  },
                  {
                    type: "gpt",
                    param: "content",
                    prompt: "Please ignore all previous instructions. I want you to only respond in {{language}}.\nAct as a professional blogger with expertise in the specific subject matter. I will provide you with text information obtained from watching a YouTube video;\n analyze it and write a blog post based on the data obtained.\n\n{{blog-post-option}}\nCome up with a title for this blog post at the beginning, a meta description, and hashtags at the end. The content must be well-researched and provide valuable insights, opinions, or advice related to the subject.\n\n--- Output format:\n## Blog post title\nBlog post text\n\n### Meta description:\nMeta description\n\n### HASHTAGS:\n10 relevant hashtags with #, comma separated\n\nFormat the text using headings (H2, H3, H4), numbered and bullet points, and other markdown formatting features.\n\n[INFORMATION]: {{gpt}}\n\n[BLOG POST IN {{language}}]:"
                  },
                  { type: "jump", to: "ask-for-change" }
                ]
              },
              {
                condition: "{{action}} = tweet",
                type: "group",
                steps: [
                  {
                    type: "gpt",
                    param: "content",
                    prompt: "Please ignore all previous instructions. I want you to only respond in {{language}}.\nAct as a social media content creator with expertise in specific topic generation, and compose a tweet related to the topic provided. The tweet should reflect insights, opinions, or updates related to the given subject. Keep the content engaging and tailored to it's potential target audience.\n\n[TWEET TOPIC]:\n{{gpt}}\n\n[TWEET in {{language}}]:"
                  },
                  { type: "jump", to: "ask-for-change" }
                ]
              },
              {
                condition: "{{action}} = article",
                type: "group",
                steps: [
                  {
                    type: "command",
                    inputs: ["Entire Article", "Generate Outline", "{{gpt}}"],
                    name: "Article creator"
                  },
                  { type: "stop" }
                ]
              },
              {
                condition: "{{action}} = custom",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    message: "You instructions for repurposing the video:",
                    param: "task"
                  },
                  {
                    type: "gpt",
                    param: "content",
                    prompt: "Please ignore all previous instructions. I want you to only respond in {{language}}.\nI want you to complete my task, which I will write after the word [MY TASK]. If you need more information, ask me for additional details to complete the task.\n\n[I WANT YOU TO WRITE]: {{task}}\n\n[VIDEO TRANSCRIPT ANALYSIS]: {{gpt}}"
                  }
                ]
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "done" },
                  { label: "\u{1F3AF} ADD KEYWORDS", value: "add-keywords" },
                  { label: "\u{1F9F2} ADD EXTERNAL LINKS", value: "links" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = done", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?",
                label: "REFINE"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS]. Provide a rewritten response.\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[YOUR RESPONSE]:",
                param: "content",
                label: "REFINE"
              },
              {
                condition: "{{change}} = add-keywords",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    message: "Extract keywords from the SERP?\n",
                    param: "kw-option",
                    options: [
                      { label: "\u{1F50D} LSI KW FROM SERP", value: "serp" },
                      { label: "\u{1F4CC} PASTE MY KEYWORDS", value: "paste" }
                    ]
                  },
                  {
                    condition: "{{kw-option}} = serp",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        message: "Enter a relevant Google Search query to extract keywords from the Search Engine Results Page (SERP).",
                        param: "query",
                        default: ""
                      },
                      {
                        type: "say",
                        message: "Extracting keywords. Please wait a bit..."
                      },
                      {
                        type: "gpt",
                        prompt: "I want you to respond only in {{language}} and output a single table.\nPretend to be a SEO keyword research expert.\nRead the [SERP] that I will provide you and find top 20 LSI keywords in SERP, each containing at least 2 words:\n- Output these keywords comma separated.\n- Do not include keywords in the list that are not thematically relevant to my query.\n- Do not add any notes, write only comma separated keywords.\n- Do not echo my prompt.\n\n\n[SERP]:\n{{serp {{query}}}}\n\n[KEYWORDS]:",
                        param: "keywords-list"
                      }
                    ]
                  },
                  {
                    condition: "{{kw-option}} = paste",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "keywords-list",
                        message: "Type in keywords, comma separated:\n"
                      }
                    ]
                  },
                  {
                    type: "gpt",
                    param: "content",
                    prompt: "I would like you to make changes to the [TEXT] you have written before. Please do not output anything but the revised text. Do not echo my command. Do not put quotes around the revised text.\nDo not change the text structure, but rewrite the content using Additional keywords. If I provide a specific request as Additional keywords, please analyze the request and include relevant keywords in the text. Add as many keywords from my list as possible. Do not write the added keywords in square brackets.\n\n[TEXT]: {{content}}\n\n[ADDITIONAL KEYWORDS]: {{keywords-list}}\n\n[REWRITTEN TEXT]:"
                  }
                ],
                label: "ADD KEYWORDS"
              },
              {
                type: "group",
                steps: [
                  {
                    type: "ask",
                    param: "ask-urls",
                    message: "Would you like to auto-extract top SERP URLs or provide them yourself?",
                    options: [
                      { label: "\u{1F9F2} EXTRACT FROM SERP", value: "extract" },
                      { label: "\u{1F4CC} PASTE URLs", value: "paste" },
                      "$custom"
                    ],
                    default: ""
                  },
                  {
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "ask-reuse",
                        message: "\u267B\uFE0F Reuse your previous '{{query}}' search?",
                        options: [
                          { label: "\u2705 YES", value: "yes" },
                          { label: "\u26D4 NO", value: "no" }
                        ],
                        default: "",
                        condition: "{{query}} != "
                      },
                      {
                        type: "jump",
                        to: "CALC SERP QUERY",
                        condition: "{{ask-reuse}} = yes"
                      },
                      {
                        type: "ask",
                        param: "query",
                        message: "Please enter a SERP query, such as 'GTA 6 release date'.",
                        options: null,
                        default: ""
                      },
                      {
                        type: "calc",
                        func: "set",
                        param: "information",
                        format: "",
                        value: "{{serp {{query}}}}",
                        label: "CALC SERP QUERY"
                      },
                      {
                        type: "calc",
                        func: "serp.extract-links",
                        from: "information",
                        to: "array",
                        limit: 8
                      },
                      {
                        type: "js",
                        code: 'function formatArrayToMarkdown(args) {\n    let markdownText = `I have found top ${args.array.length} URLs from SERP for the query "${args.query}":\\n\\n`;\n    args.array.forEach((item, index) => {\n        markdownText += `${index + 1}. [${item.title}](${item.url})\\n`;\n    });\n    markdownText += "\\nAdding URLs to your text...";\n    return markdownText;\n}\n\nreturn formatArrayToMarkdown(args);\n',
                        args: "array, query",
                        param: "markdownList",
                        silent: true
                      },
                      { type: "say", message: "{{markdownList}}" },
                      {
                        type: "gpt",
                        prompt: "Please ignore all previous instructions.\nI will provide you with an array containing URLs, Titles, and descriptions of the content.\nI want you to integrate all of the provided URLs  into the  text, ensuring a natural fit:\n- Do not change the structure or content of the article.\n- Links should be embedded in the text, not mentioned in brackets.\n- Ensure each provided link is inserted into the text.\n- Avoid adding links to headings (h1-h4).\n- Distribute the links evenly throughout the text, not concentrated in one place\n- Each URL should be used only once.\n- If uncertain about placement, insert links at random within the text.\n- Feel free to shorten or modify the titles for better integration.\n- Use Markdown formatting for embedding links.\n\nURLs array to integrate:\n{{array}}\n\n[TEXT]:\n{{content}}\n\n[REWRITTEN TEXT]:",
                        param: "content"
                      }
                    ],
                    label: "AUTO EXTRACT URLS",
                    condition: "{{ask-urls}} = extract"
                  },
                  {
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "links",
                        message: 'Please provide the URLs to add to the article, separated by double slash " // "',
                        options: null,
                        default: ""
                      },
                      {
                        type: "gpt",
                        prompt: "Please ignore all previous instructions.\nI want you tu integrate the provided [URLs] into the text, ensuring a natural fit.\n- Avoid adding links to headings (h1-h4).\n- Each URL should be used only once.\n- If unsure, insert at random locations within the text.\n- Use Markdown formatting for embedding links. -- Do not alter the text or its style; only add the links.\n\n[URLS], SEPARATED BY DOUBLE SLASHES //:\n\n{{links}}\n\n[TEXT]:\n{{content}}\n\n[REWRITTEN TEXT]:",
                        param: "content"
                      }
                    ],
                    condition: "{{ask-urls}} = paste",
                    label: "PASTE MY URLS"
                  }
                ],
                condition: "{{change}} = links",
                label: "ADD URLS"
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "video-script-writer",
              title: "Video script writer",
              category: "SMM",
              description: "Write a script for a video idea or topic. Best for YouTube, Instagram & TikTok.",
              apps: "YouTube, Instagram, TikTok"
            },
            steps: [
              {
                say: 'Your video idea, title or topic, e.g. "How to protect yourself from zombies":\n'
              },
              { ask: "idea", default: "How to protect yourself from zombies" },
              {
                say: "Target platform (YouTube, Instagram, TikTok etc.). Press Enter to pick YouTube.\n"
              },
              { ask: "platform", default: "YouTube" },
              {
                say: 'Enter a preferred video duration in minutes and seconds, e.g. 2:10s. Press enter for "Unspecified":\n'
              },
              { ask: "duration", default: "unspecified" },
              {
                gpt: "Please ignore all previous instructions. I want you to respond only in {{language}}.\nYou act as a very proficient SEO and high-end copy writer. Your task is to write me a content for a video script for a video [PLATFORM].\nFormat in a bullet-point list, add approximate timestamp for every block or paragraph. Format timestamps in bold using markdown.\nBefore the script please also provide 3 alternative appropriate clickbait titles.\n\n[MY VIDEO IDEA, VIDEO TITLE OR TOPIC]:\n{{idea}}\n\n[PLATFORM]: {{platform}}\n\n[PREFERRED VIDEO DURATION]: {{duration}}\n\n[TITLES AND THE SCRIPT]:\n"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[TITLES AND THE SCRIPT]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "youtube-extract-transcripts",
              title: "YouTube extract transcripts",
              description: "Extracts YouTube transcripts from every video on a page into a text file, parameter or a summary.",
              category: "SMM",
              emoji: "\u{1F9F2}",
              apps: "YouTube"
            },
            steps: [
              {
                label: "CHECK URL",
                type: "group",
                steps: [
                  {
                    condition: "{{url}} =~ ^https:\\/\\/www\\.youtube\\.com\\/watch.*",
                    label: "THIS PAGE",
                    type: "group",
                    steps: [
                      {
                        condition: "{{transcript}} = \u2014",
                        type: "say",
                        message: "It looks as if the video has no text transcript, or I could not fetch it from the page."
                      },
                      { condition: "{{transcript}} = \u2014", type: "stop" },
                      {
                        type: "js",
                        code: "const url = new window.URL(location.href)\nconst info = document\n  .querySelector('.ytd-watch-info-text')?.innerText || ''\nconst viewsMatch = info.match(/(\\d[\\d,]*\\w?) views/)\nconst timeAgoMatch = info.match(/views (.+) ago/)\n\nreturn {\n  url: 'https://www.youtube.com' + url.pathname + '?v=' + url.searchParams.get('v'),\n  title: document\n    .querySelector('h1.ytd-watch-metadata')?.innerText || null,\n  views: viewsMatch\n    ? parseInt(viewsMatch[1].replace(/,/g, '')) *\n      (info.includes('K') ? 1000 : 1) *\n      (info.includes('M') ? 1000000 : 1) *\n      (info.includes('B') ? 1000000000 : 1)\n    : null,\n  publishedTimeAgo: timeAgoMatch ? timeAgoMatch[1].trim() : null\n}",
                        args: "",
                        param: "video",
                        silent: true
                      },
                      {
                        type: "calc",
                        func: "set",
                        param: "video.transcript",
                        value: "{{transcript}}",
                        format: ""
                      },
                      {
                        type: "calc",
                        func: "list-add",
                        list: "transcripts",
                        index: "last",
                        item: "video"
                      },
                      {
                        type: "say",
                        message: "\u2705  The video transcript has been extracted."
                      },
                      { type: "jump", to: "ASK FOR ACTION" }
                    ]
                  },
                  {
                    condition: "{{url}} =~ ^https:\\/\\/www\\.youtube\\.com\\/.*",
                    type: "jump",
                    to: "EXTRACT VID URLS"
                  },
                  {
                    label: "NEED YT URL",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "url",
                        message: "Please provide a link with YouTube videos to extract, YouTube profile or channel videos page:",
                        options: null,
                        default: ""
                      },
                      {
                        type: "navigate",
                        url: "{{url}}",
                        waitForIdle: false,
                        silent: true
                      },
                      { type: "control", action: "show" },
                      { type: "wait", for: "idle", timeout: 15e3 },
                      { type: "jump", to: "CHECK URL" }
                    ]
                  }
                ]
              },
              {
                label: "EXTRACT VID URLS",
                type: "group",
                steps: [
                  {
                    condition: "{{url}} =~ ^https:\\/\\/www\\.youtube\\.com\\/playlist.*",
                    label: "PLAYLIST EXTRACT",
                    type: "group",
                    steps: [
                      {
                        type: "js",
                        code: `return Array
  .from(document.querySelectorAll('ytd-playlist-video-renderer'))
  .map(renderer => {
    const link = renderer.querySelector('a[href*="/watch"]'); // Find the video link
    const titleElement = renderer.querySelector('#video-title'); // Element with the video title
    const infoElement = renderer.querySelector('#video-info'); // Element with views and publish time

    // Extracting data from elements
    const url = link ? 'https://www.youtube.com' + new window.URL(link.href).pathname + '?v=' + new window.URL(link.href).searchParams.get('v') : null;
    const title = titleElement ? titleElement.textContent.trim() : null;
    const infoText = infoElement ? infoElement.textContent.trim() : null;

    // Splitting the views and publish time information
    let views = null;
    let publishedTimeAgo = null;
    if (infoText) {
      const parts = infoText.split(' \u2022 ');
      if (parts.length >= 2) {
        views = parts[0].trim(); // Keeping the views in its original format
        publishedTimeAgo = parts[1];
      }
    }

    return {
      url,
      title,
      views,
      publishedTimeAgo
    };
  })
  .filter(item =>
      item.url && item.views !== null && item.publishedTimeAgo !== null
  )
`,
                        args: "",
                        param: "videos",
                        silent: true
                      },
                      {
                        type: "js",
                        code: "const videos = args.videos;\nif (videos.length === 0)\n  return 'Found no videos on this page.'\n\nlet markdownText = `Found ${videos.length} videos on this page:\\n`;\nvideos.forEach((video, index) => {\n  const title = video.title.replace(/\"/g, '\\\\\"');\n  markdownText += `${index + 1}. [${title}](${video.url}), ${video.views.toLocaleString()}, ${video.publishedTimeAgo}\\n`;\n});\n\nreturn markdownText;\n",
                        args: "videos",
                        param: "markdownText",
                        silent: true
                      },
                      { type: "jump", to: "SAY MARKDOWN ARRAY" }
                    ]
                  },
                  {
                    type: "js",
                    code: `const videos = Array
  .from(document.querySelectorAll('a[href*="/watch"]'))
  .map(a => {
    const ariaLabel = a.getAttribute('aria-label') || ''
    const viewsMatch = ariaLabel.match(/(\\d[\\d,]*) views/)
    const timeAgoMatch = ariaLabel.match(/views (.+) ago/)
    const url = new window.URL(a.href)

    return {
      url: 'https://www.youtube.com' + url.pathname + '?v=' + url.searchParams.get('v'),
      title: a.getAttribute('title') || a.innerText.trim(),
      views: viewsMatch ? parseInt(viewsMatch[1].replace(/,/g, '')) : null,
      publishedTimeAgo: timeAgoMatch ? timeAgoMatch[1].trim() : null
    }
  })
  .filter(item =>
    item &&
    item.url.includes('/watch?v=') &&
    item.views !== null &&
    item.publishedTimeAgo !== null
  )

// create a new Set to store unique video URLs
const uniqueVideoUrls = new Set()
const uniqueVideos = []

// iterate through the videos array and filter duplicates by URL
videos.forEach(video => {
  if (uniqueVideoUrls.has(video.url)) return
  uniqueVideoUrls.add(video.url)
  uniqueVideos.push(video)
});

return uniqueVideos`,
                    param: "videos",
                    args: "",
                    silent: true
                  },
                  {
                    type: "js",
                    code: "const videos = args.videos;\nif (videos.length === 0)\n  return 'Found no videos on this page.'\n\nlet markdownText = `Found ${videos.length} videos on this page:\\n`;\nvideos.forEach((video, index) => {\n  const title = video.title.replace(/\"/g, '\\\\\"');\n  markdownText += `${index + 1}. [${title}](${video.url}), ${video.views.toLocaleString()} views, ${video.publishedTimeAgo} ago\\n`;\n});\n\nreturn markdownText;\n\n",
                    param: "markdownText",
                    args: "videos",
                    silent: true
                  },
                  {
                    label: "SAY MARKDOWN ARRAY",
                    type: "say",
                    message: "{{markdownText}}"
                  },
                  { condition: "{{videos.length}} = 0", type: "stop" }
                ]
              },
              {
                label: "HOW MANY",
                type: "group",
                steps: [
                  {
                    label: "HOW MANY",
                    type: "ask",
                    param: "number",
                    message: "How many videos to extract? Pick an option, or type numbers, for example, 1-5, 9, 10, 18:",
                    options: [
                      { label: "\u267B\uFE0F ALL", value: "all" },
                      { label: "THE FIRST ONLY", value: 1 },
                      { label: "TOP 5", value: 5 },
                      { label: "TOP 10", value: 10 },
                      { label: "TOP 25", value: 25 },
                      "$custom"
                    ],
                    default: ""
                  },
                  {
                    condition: "{{number}} = all",
                    type: "jump",
                    to: "TRANSCRIPT EXTRACTION"
                  },
                  {
                    type: "js",
                    code: "const { number, videos } = args\n\nif (typeof number === 'number')\n  return videos.slice(0, number)\n\nconst parts = (number || '').split(/[\\s,]+/).map(part => part.trim())\nconst numbers = []\n\nparts.forEach(part => {\n  if (part.includes('-')) {\n    const [start, end] = part.split('-').map(Number)\n    for (let i = start; i <= end; i++) {\n      numbers.push(i)\n    }\n  } else {\n    numbers.push(Number(part))\n  }\n})\n\nreturn videos.filter(\n  (_, index) => numbers.includes(index + 1))",
                    args: "videos, number",
                    param: "videos",
                    silent: true
                  }
                ]
              },
              {
                label: "TRANSCRIPT EXTRACTION",
                type: "loop",
                steps: [
                  {
                    type: "navigate",
                    url: "{{item.url}}",
                    waitForIdle: false,
                    silent: false
                  },
                  {
                    type: "wait",
                    for: "js-function",
                    timeout: 5e3,
                    code: "const video = document.querySelector('video')\nif (!video) return false\n\nvideo.muted = true\nreturn true",
                    silent: true
                  },
                  {
                    type: "calc",
                    param: "transcriptObject",
                    format: "json",
                    value: {
                      title: "{{item.title}}",
                      views: "{{item.views}}",
                      published: "{{item.publishedTimeAgo}}",
                      url: "{{item.url}}",
                      transcript: "{{transcript}}"
                    },
                    func: "set"
                  },
                  {
                    type: "calc",
                    func: "list-add",
                    list: "transcripts",
                    item: "transcriptObject",
                    index: "last"
                  },
                  { type: "calc", func: "clone", from: "index", to: "index1" },
                  { type: "calc", func: "increment", param: "index1", delta: 1 },
                  {
                    type: "say",
                    message: "\u2705  The video transcript {{index1}} / {{videos.length}} has been extracted."
                  }
                ],
                list: "videos"
              },
              {
                label: "ASK FOR ACTION",
                type: "ask",
                param: "action",
                message: "What do you like me to do with the video transcripts?",
                options: [
                  { label: "\u{1F5C2} EXPORT", value: "export" },
                  { label: "\u{1FA73} SUMMARIZE", value: "summary" },
                  { label: "\u{1F6E0} SAVE TO PARAMETER", value: "save" },
                  { label: "\u{1F440} SHOW", value: "show" }
                ],
                default: "",
                optionsInvalid: false
              },
              {
                condition: "{{action}} = export",
                label: "EXPORT",
                type: "group",
                steps: [{ type: "export", what: "param", param: "transcripts" }]
              },
              {
                condition: "{{action}} = save",
                label: "SAVE TRANSCRIPTS",
                type: "group",
                steps: [
                  {
                    type: "calc",
                    param: "g.transcripts",
                    value: "{{transcripts}}",
                    func: "set",
                    format: ""
                  },
                  {
                    type: "say",
                    message: "Video transcripts are saved to {{g.transcripts}}. You can reference them in your custom commands or chat.",
                    interpolate: false
                  }
                ]
              },
              {
                condition: "{{action}} = show",
                label: "SHOW TRANSCRIPTS",
                type: "group",
                steps: [
                  {
                    condition: "{{video}}",
                    label: "SINGLE VIDEO",
                    type: "group",
                    steps: [
                      {
                        type: "say",
                        message: "[{{video.title}}]({{video.url}})\n{{video.transcript}}\n"
                      },
                      { type: "jump", to: "ASK FOR ACTION" }
                    ]
                  },
                  {
                    type: "loop",
                    list: "transcripts",
                    steps: [
                      {
                        type: "say",
                        message: "[{{item.title}}]({{item.url}})\n{{item.transcript}}\n"
                      }
                    ]
                  },
                  { type: "jump", to: "ASK FOR ACTION" }
                ]
              },
              {
                condition: "{{action}} = summary",
                label: "SUMMARY",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    param: "format",
                    message: "Pick a summary format",
                    options: [
                      { label: "\u{1F33F} NESTED", value: "nested" },
                      { label: "\u{1F433} LONG", value: "long" },
                      { label: "\u{1F42C} SHORT", value: "short" },
                      { label: "\u{1F4AC} TEXT", value: "text" }
                    ],
                    default: ""
                  },
                  {
                    type: "loop",
                    steps: [
                      {
                        type: "calc",
                        param: "transcript",
                        value: "{{item.transcript}}",
                        func: "set",
                        format: ""
                      },
                      {
                        type: "command",
                        name: "YouTube video summary",
                        inputs: ["{{format}}", "NO"]
                      },
                      {
                        type: "calc",
                        param: "summaryObject",
                        value: {
                          title: "{{item.title}}",
                          summary: "{{gpt}}",
                          url: "{{item.url}}",
                          views: "{{item.views}}",
                          published: "{{item.publishedTimeAgo}}",
                          transcript: "{{item.transcript}}"
                        },
                        func: "set",
                        format: "json"
                      },
                      {
                        type: "calc",
                        list: "summaries",
                        func: "list-add",
                        index: "last",
                        item: "summaryObject"
                      },
                      { type: "wait", for: "2s", silent: true }
                    ],
                    list: "transcripts"
                  },
                  {
                    type: "ask",
                    message: "What would you like me to do with the summaries?",
                    options: [
                      { label: "\u{1F5C2} EXPORT", value: "export" },
                      { label: "\u{1F6E0} SAVE TO PARAMETER", value: "save" }
                    ],
                    param: "action",
                    default: ""
                  },
                  {
                    condition: "{{action}} = export",
                    label: "EXPORT",
                    type: "group",
                    steps: [
                      { type: "export", what: "param", param: "summaries" }
                    ]
                  },
                  {
                    condition: "{{action}} = save",
                    label: "SAVE TRANSCRIPTS",
                    type: "group",
                    steps: [
                      {
                        type: "calc",
                        param: "g.summaries",
                        value: "{{summaries}}",
                        func: "set",
                        format: ""
                      },
                      {
                        type: "say",
                        message: "Video summaries are saved to {{g.summaries}}. You can reference them in your custom commands or chat.",
                        interpolate: false
                      }
                    ]
                  }
                ]
              }
            ]
          },
          {
            meta: {
              name: "youtube-extract-comments",
              title: "YouTube extract comments",
              description: "Extracts YouTube comments from a video page.",
              category: "SMM",
              emoji: "\u{1F9F2}",
              apps: "YouTube"
            },
            steps: [
              {
                condition: "{{url}} =~ ^(?!https:\\/\\/www\\.youtube\\.com\\/watch).*",
                label: "NOT A YT PAGE",
                type: "group",
                steps: [
                  {
                    type: "say",
                    message: "\u26D4\uFE0F Please run this command on a YouTube video page."
                  },
                  { type: "stop" }
                ]
              },
              {
                type: "ask",
                param: "amount",
                message: "\u{1F4AC} How many comments to extract?",
                options: [
                  { label: "TOP 20", value: 20 },
                  { label: "TOP 100", value: 100 },
                  { label: "\u2733\uFE0F ALL", value: 1e3 },
                  "$custom"
                ],
                optionsInvalid: false,
                default: ""
              },
              {
                label: "EXTRACT",
                type: "js",
                code: "const extractComments = () =>\n  Array.from(document\n    .querySelectorAll('ytd-comment-thread-renderer'))\n    .map(commentElement => {\n      const comment = commentElement\n        .querySelector('ytd-comment-view-model#comment');\n      if (!comment) return null;\n\n      const username = comment.querySelector('#header-author h3 a').textContent.trim();\n      const commentText = comment.querySelector('#content-text').textContent.trim();\n      const likes = comment.querySelector('#vote-count-middle')\n        ? comment.querySelector('#vote-count-middle').textContent.trim()\n        : '0';\n      const timePosted = comment.querySelector('#published-time-text a').textContent.trim();\n\n      return {\n        username,\n        comment: commentText,\n        likes: Number(likes) || 0,\n        timePosted\n      };\n    })\n    .filter(Boolean);\n\nconst scrollToComments = async () => {\n  // check if comment box is found\n  let cb = document.querySelector('ytd-comment-simplebox-renderer');\n  if (cb) return true;\n\n  // wait for comment box to appear\n  document.documentElement.scrollTop += window.innerHeight;\n  cb = await $harpa.waiter.wait(\n    () => document.querySelector('ytd-comment-simplebox-renderer'),\n    { timeout: 1500 }\n  );\n  return !!cb;\n};\n\nawait scrollToComments();\n\nlet comments = [];\nlet newComments = [];\n\nfor (let i = 0; i < 50; i++) {\n  await new Promise(r => setTimeout(r, 1000));\n  newComments = extractComments();\n  if (newComments.length === comments.length) break;\n  comments = newComments;\n  if (comments.length >= args.amount) break;\n  await $harpa.scroller.scroll();\n}\n\nreturn comments.slice(0, amount);",
                param: "comments",
                silent: true,
                args: "amount"
              },
              {
                label: "FORMAT",
                type: "js",
                code: "return args.comments\n  .map((comment, index) => {\n    let commentText = comment.comment.replace(/\\n/g, ' ');\n    return (\n      `${index + 1}. ${commentText} - by ${comment.username},` +\n      ` ${comment.timePosted}, ${comment.likes} likes`\n    )\n  })\n  .join('\\n\\n')",
                param: "markdownMessage",
                args: "comments",
                silent: true
              },
              {
                condition: "{{comments.length}} = 0",
                label: "NO COMMENTS FOUND",
                type: "group",
                steps: [
                  { type: "say", message: "Found no comments on the page." },
                  { type: "stop" }
                ]
              },
              {
                type: "say",
                message: "\u2705 Extracted {{comments.length}} comments."
              },
              { type: "say", message: "{{markdownMessage}}" },
              {
                type: "ask",
                param: "last-option",
                options: [
                  { label: "\u2705 DONE", value: "done" },
                  { label: "\u{1F5C2} EXPORT TO JSON", value: "export" }
                ],
                message: "",
                default: "",
                optionsInvalid: false
              },
              { condition: "{{last-option}} = done", type: "stop" },
              {
                condition: "{{last-option}} = export",
                type: "group",
                steps: [{ type: "export", what: "param", param: "comments" }]
              }
            ]
          },
          {
            meta: {
              name: "youtube-description-generator",
              title: "YouTube description generator",
              category: "SMM",
              description: "Generate title, description and hashtags for a youtube video idea.",
              apps: "YouTube"
            },
            steps: [
              {
                say: "Enter YouTube video idea or keywords. Leave empty to parse idea from page:\n"
              },
              { ask: "param", default: "{{page}}" },
              {
                gpt: "Please ignore all previous instructions. I want you to answer in {{language}} only.\nI want you to act as a very proficient Professional YouTube SEO Expert and a high end video SEO optimizer.\nYour task is to write SEO-optimized video title, video description and hashtags for a YouTube video idea so that the video has high change of ranking on YouTube video search for the relevant keywords.\nWhen writing a description, follow these guidelines:\n- Include keywords that are related to the video idea to help YouTube understand the topic of your video and improve its ranking in search results.\n- Make it descriptive and informative: The description should provide a brief overview of the video and what the viewer can expect to learn or see. Be sure to include key takeaways and any relevant information that will pique the viewer's interest.\n- Use short and concise sentences: Keep the description short and to the point, using simple language that is easy to understand.\n- Include a call-to-action (CTA): Encourage viewers to like, comment, and subscribe to your channel by including a clear CTA at the end of the description.\n- Optimize for readability: Use proper grammar, spacing, and punctuation to make the description easy to read and understand.\nYouTube video hashtags should be separated by commas.\nOutput framework:\n### Video title\n3 SEO-optimized video titles ideas\n### Video description\nSEO-optimized video description\n### Hashtags:\n15 comma separated keywords list with #\n\n[PLEASE PARSE VIDEO IDEA FROM THE FOLLOWING TEXT]:\n{{param}}\n\n[VIDEO TITLE, DESCRIPTION AND HASHTAGS]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[VIDEO TITLE, DESCRIPTION AND HASHTAGS]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "youtube-polls-generator",
              category: "SMM",
              title: "YouTube polls generator",
              description: "Create an attention-grabbing YouTube poll for a video channel.",
              apps: "YouTube"
            },
            steps: [
              {
                say: "What you YouTube video channel is about? Leave empty to parse from the web page (navigate to YouTube about page for best results):\n"
              },
              { ask: "param", default: "{{page}}" },
              {
                say: 'Tip: you can ask me to generate more ideas by typing "More ideas".\n'
              },
              {
                gpt: "Please ignore all previous instructions. I want you to respond only in {{language}}\nI'd like you to take on the role of a YouTube video content creator. Your task is to generate YouTube Poll ideas based on my channel description.\n1. Poll question must be clear and concise: Make sure the question is straightforward and easy to understand.\n2. Keep it simple: too many choices can lead to confusion and a less accurate result.\n3. The optimal length is about 80 characters, ~5 poll options.\n4. Include emojis in the poll and the options if appropriate.\n5. Consider that the poll\u2019s question should be more engaging. Think about how likely channel viewers are to engage with the poll and answer the question.\nFormat poll options in a bullet point list.\n\n[PLEASE PARSE MY CHANNEL DESCRIPTION FROM THE FOLLOWING TEXT]:\n{{param}}\n\n[POLL IDEA]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[POLL IDEA]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "youtube-audience-analyzer",
              category: "SMM",
              title: "YouTube audience analyzer",
              description: "Read transcript of a YouTube video and analyze its target audience.",
              apps: "YouTube"
            },
            steps: [
              {
                gpt: "Please ignore all previous instructions. I want you to answer in {{language}} only.\nI will provide you with a transcript of a YouTube video. Your task is to analyze the target audience of the video.\nPlease provide a description of the target audience in a single paragraph.\nThen the list of relevant topics of interest of the audience. Format relevant topics in a bullet-point markdown list.\nAfter that provide a list of keywords for video content that might interest the target audience.\nOutput framework:\n### Target audience description\nsingle paragraph about the target audience\n### The list of relevant topics of interest of the audience:\nbullet-point markdown list\n### Keywords for video content:\n20 keywords for video content that might interest the target audience.\n\n[VIDEO TRANSCRIPT]:\n{{transcript}}\n\n[ANALYSIS]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[ANALYSIS]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "youtube-channel-analysis",
              category: "SMM",
              title: "YouTube channel analysis",
              description: "Extracts insights from YouTube videos to draw conclusion on channel audience and growth tips.",
              emoji: "\u{1F4A1}",
              apps: "YouTube"
            },
            steps: [
              {
                type: "group",
                steps: [
                  {
                    type: "group",
                    steps: [
                      {
                        type: "js",
                        code: "function extractYouTubeProfileName() {\n  const url = window.location.href;\n  const regex = /youtube\\.com\\/(@[^\\/]+)/;\n  const match = url.match(regex);\n  return match ? match[1] : null;\n}\n\nconst profileName = extractYouTubeProfileName();\nreturn profileName;\n",
                        args: "",
                        param: "profile",
                        silent: true
                      },
                      {
                        type: "jump",
                        to: "EXTRACT VID URLS",
                        condition: "{{url}} =~ ^https:\\/\\/www\\.youtube\\.com\\/@[\\w\\.\\-_]+\\/videos\n"
                      }
                    ],
                    condition: "{{url}} =~ ^https:\\/\\/www\\.youtube\\.com\\/@[\\w\\.\\-_]+\\/videos\n",
                    label: "VIDEOS PAGE"
                  },
                  {
                    type: "group",
                    steps: [
                      {
                        type: "js",
                        code: "function extractYouTubeProfileName() {\n  const url = window.location.href;\n  const regex = /youtube\\.com\\/(@[^\\/]+)/;\n  const match = url.match(regex);\n  return match ? match[1] : null;\n}\n\nconst profileName = extractYouTubeProfileName();\nreturn profileName;\n",
                        args: "",
                        param: "profile",
                        silent: true
                      },
                      {
                        type: "navigate",
                        url: "https://www.youtube.com/{{profile}}/videos ",
                        waitForIdle: false,
                        silent: true
                      },
                      {
                        type: "wait",
                        for: "text-to-appear",
                        text: "Popular",
                        timeout: 1500,
                        silent: true
                      },
                      { type: "jump", to: "EXTRACT VID URLS" }
                    ],
                    label: "REDIRECT TO VIDEOS PAGE",
                    condition: "{{url}} =~ ^https:\\/\\/www\\.youtube\\.com\\/@[\\w\\.\\-_]+(\\/featured|\\/playlists|\\/community|\\/)?$\n"
                  },
                  {
                    type: "group",
                    steps: [
                      {
                        type: "js",
                        code: "function extractUserHandle() {\n  const userLinkElement = document.querySelector('a.yt-simple-endpoint.style-scope.ytd-video-owner-renderer');\n  if (userLinkElement) {\n    const href = userLinkElement.getAttribute('href');\n    return href.substring(1);\n  }\n  return 'NOT FOUND';\n}\n\nconst userHandle = extractUserHandle();\nreturn userHandle;\n\n",
                        args: "",
                        param: "profile",
                        silent: true
                      },
                      {
                        type: "say",
                        message: "\u{1F9ED} We are on a video page. Navigating to the author's profile - {{profile}}."
                      },
                      {
                        type: "navigate",
                        url: "https://www.youtube.com/{{profile}}/videos",
                        waitForIdle: false,
                        silent: true
                      },
                      {
                        type: "wait",
                        for: "text-to-appear",
                        text: "Popular",
                        timeout: 1500,
                        silent: true
                      },
                      { type: "jump", to: "EXTRACT VID URLS" }
                    ],
                    label: "VIDEO PAGE",
                    condition: "{{url}} =~ ^https:\\/\\/www\\.youtube\\.com\\/watch.*"
                  },
                  {
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "url",
                        message: "\u{1F575}\uFE0F\u200D\uFE0F Please provide a link to a YouTube video, a YouTube profile, or a channel's video page.",
                        options: null,
                        default: ""
                      },
                      {
                        type: "navigate",
                        url: "{{url}}",
                        waitForIdle: false,
                        silent: true
                      },
                      { type: "control", action: "show" },
                      { type: "wait", for: "idle", timeout: 15e3 },
                      { type: "jump", to: "CHECK URL" }
                    ],
                    label: "NEED YT URL"
                  }
                ],
                label: "CHECK URL"
              },
              {
                type: "group",
                steps: [
                  {
                    type: "js",
                    code: `return Array
  .from(document.querySelectorAll('a[href*="/watch"]'))
  .map(a => {
    const ariaLabel = a.getAttribute('aria-label') || '';
    const viewsMatch = ariaLabel.match(/(\\d[\\d,]*) views/);
    const timeAgoMatch = ariaLabel.match(/views (.+) ago/);
    const url = new window.URL(a.href);

    return {
      url: 'https://www.youtube.com' + url.pathname + '?v=' + url.searchParams.get('v'),
      title: a.getAttribute('title') || a.innerText.trim(),
      views: viewsMatch ? parseInt(viewsMatch[1].replace(/,/g, '')) : null,
      publishedTimeAgo: timeAgoMatch ? timeAgoMatch[1].trim() : null
    };
  })
  .filter(item =>
    item.url.includes('/watch?v=') &&
    item.views !== null &&
    item.publishedTimeAgo !== null);`,
                    args: "",
                    param: "videos",
                    silent: true,
                    label: "FIND ITEMS"
                  },
                  {
                    type: "js",
                    code: "function sortVideosByDate(videos) {\n  const timeAgoToDays = timeAgo => {\n    const matches = timeAgo.match(/(\\d+)\\s*(\\w+)/);\n    if (!matches) return Infinity;\n\n    const num = parseInt(matches[1]);\n    const unit = matches[2];\n\n    if (unit.startsWith('day')) {\n      return num;\n    } else if (unit.startsWith('week')) {\n      return num * 7;\n    } else if (unit.startsWith('month')) {\n      return num * 30;\n    } else if (unit.startsWith('year')) {\n      return num * 365;\n    } else if (unit.startsWith('hour')) {\n      return num / 24;\n    } else if (unit.startsWith('minute')) {\n      return num / 1440;\n    } else {\n      return Infinity;\n    }\n  };\n\n  return videos.sort((a, b) =>\n    timeAgoToDays(a.publishedTimeAgo) - timeAgoToDays(b.publishedTimeAgo));\n}\n\nreturn sortVideosByDate(args.videos);\n",
                    args: "videos",
                    param: "videos",
                    label: "SORT ITEMS",
                    silent: true
                  },
                  {
                    type: "js",
                    code: "const videos = args.videos;\nif (videos.length === 0)\n  return 'Found no videos on this page.'\n\nlet markdownText = `Found ${videos.length} videos on this page:\\n`;\nvideos.forEach((video, index) => {\n  const title = video.title.replace(/\"/g, '\\\\\"');\n  markdownText += `${index + 1}. [${title}](${video.url}), ${video.views.toLocaleString()} views, ${video.publishedTimeAgo} ago\\n`;\n});\n\nreturn markdownText;\n\n",
                    args: "videos",
                    param: "markdownText",
                    silent: true,
                    label: "MESSAGE"
                  },
                  { type: "stop", condition: "{{videos.length}} = 0" }
                ],
                label: "EXTRACT VID URLS"
              },
              {
                type: "group",
                steps: [
                  {
                    type: "js",
                    code: "function calculateAverageViews(videos) {\n  if (!videos.length)\n    return 'No videos to calculate average views.'\n\n  let totalViews = 0;\n  for (let i = 0; i < videos.length; i++) {\n    totalViews += videos[i].views;\n  }\n\n  const averageViews = totalViews / videos.length;\n  return `On average, each video is viewed ${averageViews.toFixed(0)} times.`;\n}\n\nreturn calculateAverageViews(args.videos)\n",
                    args: "videos",
                    param: "views",
                    silent: true,
                    label: "VIEWS MESSAGE"
                  },
                  {
                    type: "js",
                    code: "function calculateAveragePublishInterval(videos) {\n  const timeAgoToDays = timeAgo => {\n    const matches = timeAgo.match(/(\\d+)\\s*(\\w+)/);\n    if (!matches) return 0;\n\n    const num = parseInt(matches[1]);\n    const unit = matches[2];\n\n    if (unit.startsWith('day')) {\n      return num;\n    } else if (unit.startsWith('week')) {\n      return num * 7;\n    } else if (unit.startsWith('month')) {\n      return num * 30;\n    } else if (unit.startsWith('year')) {\n      return num * 365;\n    } else if (unit.startsWith('hour')) {\n      return num / 24;\n    } else if (unit.startsWith('minute')) {\n      return num / 1440;\n    } else {\n      return 0;\n    }\n  };\n\n  let totalDays = 0;\n  videos.forEach((video, index) => {\n    if (index < videos.length - 1) {\n      const currentDays = timeAgoToDays(video.publishedTimeAgo);\n      const nextDays = timeAgoToDays(videos[index + 1].publishedTimeAgo);\n      totalDays += Math.abs(nextDays - currentDays);\n    }\n  });\n\n  if (videos.length <= 1)\n    return 'Insufficient data to calculate average publishing interval.';\n\n  const averageInterval = totalDays / (videos.length - 1);\n  if (averageInterval === 1) {\n      return \"Videos are usually published once every day.\";\n  } else if (averageInterval < 1) {\n      const hours = Math.round(averageInterval * 24);\n      return `Videos are usually published every ${hours} hours.`;\n  }\n  return `Videos are usually published once every ${Math.max(averageInterval, 0).toFixed(1)} days.`;\n}\n\nreturn calculateAveragePublishInterval(args.videos)\n",
                    args: "videos",
                    param: "period",
                    silent: true,
                    label: "PERIOD MESSAGE"
                  },
                  {
                    type: "js",
                    code: "function calculateAverageViews(videos) {\n  if (!videos.length) return 0\n\n  let totalViews = 0\n  for (let i = 0; i < videos.length; i++) {\n    totalViews += videos[i].views\n  }\n\n  const averageViews = totalViews / videos.length\n  return averageViews.toFixed(0)\n}\n\nreturn calculateAverageViews(args.videos)\n",
                    args: "videos",
                    param: "viewsCount",
                    silent: true,
                    label: "AVERAGE VIEWS NR"
                  },
                  {
                    type: "js",
                    code: 'function getLastVideoInfo(videos, averageViews) {\n  if (!videos.length || !averageViews) return "No videos available.";\n\n  const timeAgoToDays = timeAgo => {\n    const matches = timeAgo.match(/(\\d+)\\s*(\\w+)/);\n    if (!matches) return Infinity;\n\n    const num = parseInt(matches[1]);\n    const unit = matches[2];\n\n    if (unit.startsWith(\'day\')) {\n      return num;\n    } else if (unit.startsWith(\'week\')) {\n      return num * 7;\n    } else if (unit.startsWith(\'month\')) {\n      return num * 30;\n    } else if (unit.startsWith(\'year\')) {\n      return num * 365;\n    } else if (unit.startsWith(\'hour\')) {\n      return num / 24;\n    } else if (unit.startsWith(\'minute\')) {\n      return num / 1440;\n    } else {\n      return Infinity;\n    }\n  };\n\n  const sortedVideos = videos.sort((a, b) => {\n    const daysA = timeAgoToDays(a.publishedTimeAgo);\n    const daysB = timeAgoToDays(b.publishedTimeAgo);\n    return (daysA === Infinity ? 1 : daysA) - (daysB === Infinity ? 1 : daysB);\n  });\n\n  const lastVideo = sortedVideos[0];\n  const viewDifference = averageViews !== 0 ? ((lastVideo.views - averageViews) / averageViews * 100).toFixed(1) : "0.0";\n  const comparison = lastVideo.views >= averageViews ? "higher" : "lower";\n\n  let timeAgoText;\n  if (lastVideo.publishedTimeAgo.includes("hour")) {\n    timeAgoText = `${parseInt(lastVideo.publishedTimeAgo.match(/(\\d+)\\s*hour/)[1])} hours`;\n  } else if (lastVideo.publishedTimeAgo.includes("minute")) {\n    timeAgoText = `${parseInt(lastVideo.publishedTimeAgo.match(/(\\d+)\\s*minute/)[1])} minutes`;\n  } else {\n    const daysAgo = timeAgoToDays(lastVideo.publishedTimeAgo);\n    timeAgoText = daysAgo === 1 ? "1 day" : `${daysAgo} days`;\n  }\n\n  return `The most recent video was released ${timeAgoText} ago and has gained ${lastVideo.views} views, which is ${comparison} than the average by ${Math.abs(viewDifference)}% - [${lastVideo.title}](${lastVideo.url})`;\n}\n\nreturn getLastVideoInfo(args.videos, args.viewsCount);\n',
                    args: "viewsCount, videos",
                    param: "last",
                    silent: true,
                    label: "LAST VID STATUS"
                  }
                ],
                label: "VIEWS & PERIOD"
              },
              {
                type: "group",
                steps: [
                  {
                    type: "js",
                    code: "return args.videos\n  .sort((a, b) => b.views - a.views)\n  .slice(0, 3)",
                    args: "videos",
                    param: "top3",
                    silent: true,
                    label: "FIND TOP3"
                  },
                  {
                    type: "js",
                    code: "return args.top3\n  .map(video => `- [${video.title}](${video.url}) - ${video.views} views.`)\n  .join('\\n')",
                    args: "top3",
                    param: "top3message",
                    label: "MESSAGE TOP",
                    silent: true
                  },
                  {
                    type: "js",
                    code: "return args.videos\n  .slice(1)\n  .sort((a, b) => a.views - b.views)\n  .slice(0, 3)",
                    args: "videos",
                    param: "bottom3",
                    silent: true,
                    label: "FIND BOTTOM 3"
                  },
                  {
                    type: "js",
                    code: "return args.bottom3\n  .map(video => `- [${video.title}](${video.url}) - ${video.views} views.`)\n  .join('\\n')",
                    args: "bottom3",
                    param: "bottom3message",
                    label: "MESSAGE BOTTOM",
                    silent: true
                  }
                ],
                label: "TOP / BOTTOM 3"
              },
              {
                type: "say",
                message: "## {{profile}} YouTube profile analysis\n{{period}}\n{{views}}\n{{last}}\n### Top 3 Most Popular Videos: {{top3message}}\n### Top 3 Least Popular Videos: {{bottom3message}}\n"
              },
              {
                type: "ask",
                param: "type",
                message: "Please pick analysis type:\n\u{1F680} **QUICK** analysis suits channels with short videos.\n\u{1F40B} **IN-DEPTH** analysis, taking about 1.5 minutes, offers detailed insights for longer content.",
                options: [
                  { label: "\u{1F680} QUICK", value: "quick" },
                  { label: "\u{1F40B} IN-DEPTH", value: "indepth" },
                  { label: "\u{1F4DD} VIDEO LIST", value: "list" }
                ],
                default: "",
                label: "ACTION"
              },
              {
                type: "group",
                steps: [
                  {
                    type: "say",
                    message: "{{markdownText}}",
                    condition: "{{type}} = list"
                  },
                  { type: "jump", to: "ACTION" }
                ],
                label: "LIST",
                condition: "{{type}} = list"
              },
              {
                type: "group",
                steps: [
                  {
                    type: "group",
                    steps: [
                      {
                        type: "say",
                        message: "\u231B Extracting data on the 3 most popular videos."
                      },
                      {
                        type: "loop",
                        list: "top3",
                        steps: [
                          {
                            type: "navigate",
                            url: "{{item.url}}",
                            waitForIdle: false,
                            silent: true
                          },
                          {
                            type: "wait",
                            for: "js-function",
                            timeout: 15e3,
                            silent: true,
                            code: "const video = document.querySelector('video')\nif (!video) return false\n\nvideo.muted = true\nreturn true"
                          },
                          {
                            type: "js",
                            code: 'function generateMarkdownLink(video) {\n  if (!video) return "No video information available."\n\n  const title = video.title\n  const url = video.url\n  return `[${title}](${url})`\n}\n\nreturn generateMarkdownLink(args.item)',
                            args: "item",
                            param: "link",
                            label: "GET MARKDOWN LINK",
                            silent: true
                          },
                          {
                            type: "js",
                            code: "function createItem(link, transcriptPlain) {\n  return {\n    url: link,\n    transcript: transcriptPlain.substring(0, 1500)\n  };\n}\n\nreturn createItem(args.link, args.transcriptPlain);",
                            args: "link, transcriptPlain",
                            param: "itemTop",
                            silent: true,
                            label: "NEW ITEM"
                          },
                          {
                            type: "calc",
                            func: "list-add",
                            index: "last",
                            list: "top3sum",
                            item: "itemTop"
                          }
                        ]
                      }
                    ],
                    label: "TOP 3 ANALYSIS "
                  },
                  {
                    type: "group",
                    steps: [
                      {
                        type: "say",
                        message: "\u231B Extracting data on the 3 least popular videos."
                      },
                      {
                        type: "loop",
                        list: "bottom3",
                        steps: [
                          {
                            type: "navigate",
                            url: "{{item.url}}",
                            waitForIdle: false,
                            silent: true
                          },
                          {
                            type: "wait",
                            for: "js-function",
                            timeout: 15e3,
                            silent: true,
                            code: "const video = document.querySelector('video')\nif (!video) return false\n\nvideo.muted = true\nreturn true"
                          },
                          {
                            type: "js",
                            code: 'function generateMarkdownLink(video) {\n  if (!video) return "No video information available."\n\n  const title = video.title\n  const url = video.url\n  return `[${title}](${url})`\n}\n\nreturn generateMarkdownLink(args.item)',
                            args: "item",
                            param: "link",
                            label: "GET MARKDOWN LINK",
                            silent: true
                          },
                          {
                            type: "js",
                            code: "function createItem(link, transcriptPlain) {\n  return {\n    url: link,\n    transcript: transcriptPlain.substring(0, 1500)\n  };\n}\n\nreturn createItem(args.link, args.transcriptPlain);",
                            args: "link, transcriptPlain",
                            param: "itemBot",
                            silent: true,
                            label: "NEW ITEM"
                          },
                          {
                            type: "calc",
                            func: "list-add",
                            index: "last",
                            list: "bot3sum",
                            item: "itemBot"
                          }
                        ]
                      }
                    ],
                    label: "BOT 3 ANALYSIS "
                  },
                  {
                    type: "navigate",
                    url: "https://www.youtube.com/{{profile}}",
                    waitForIdle: false,
                    silent: true
                  },
                  {
                    type: "say",
                    message: "\u231B Data collected. Analyzing video content and drawing conclusions."
                  },
                  {
                    type: "say",
                    message: "## {{profile}} YouTube profile analysis\n{{period}}\n{{views}}\n{{last}}\n"
                  },
                  {
                    type: "gpt",
                    prompt: "Act as a professional content analyst fluent in {{language}}. I will provide you with a [DATA ARRAY] containing brief information about the 3 most popular and 3 least popular videos on a YouTube channel.\n\nPlease analyze these 6 video transcripts and succinctly describe the content featured in these videos. Then make a conclusion.\n\n- Format your response with markdown features.\n\n- Don't include introductory phrases, advice, or notes. Stick to my format and don't add anything unnecessary.\n\n- Based on the analysis of the 3 most and least interesting videos from a user's YouTube profile, make a concise conclusion and advise on what types of videos should be produced.\n\n- Format your response with markdown features.\n\n- Avoid general statements; your response should be brief and to the point.\n\n-- Output format:\n\n### The content in the 3 most popular videos included:\n- [title](url): summary.\n- [title](url): summary.\n- [title](url): summary.\n\n### The content in the 3 least popular videos included:\n- [title](url): summary.\n- [title](url): summary.\n- [title](url): summary.\n\n## Conclusion\n text\n\n\n[DATA ARRAY]:\n\n[3 most popular videos]: {{top3sum}}\n\n[3 least popular videos]: {{bot3sum}}",
                    param: "analysis",
                    silent: false,
                    label: "TOP3 ANALYSIS"
                  },
                  {
                    type: "calc",
                    func: "set",
                    param: "result",
                    format: "",
                    value: "## {{profile}} YouTube profile analysis\n\n{{period}}\n\n{{views}}\n\n{{last}}\n\n{{analysis}}\n\n{{conclusion}}"
                  },
                  {
                    type: "gpt",
                    prompt: "Please act as a professional web content and audience analyst fluent in {{language}}.\nTake the [ANALYSIS] already conducted as a foundation and consider what additional content will interest the audience and what content to avoid.\nAnalyze who the primary viewers of the YouTube channel are and how to expand audience reach.\nDo not repeat arguments already present in the analysis.\nShow the response in rendered Markdown format.\n\nOutput format:\n\n### Audience Analysis\nYour analysis text here\n\n### Ways to Expand Audience\nText with strategies and suggestions about the ways to expand audience\n\n### Content Recommendations\nAdvice and recommendations for upcoming content\n\n[ANALYSIS]: {{result}}\n",
                    param: "gpt"
                  }
                ],
                condition: "{{type}} = quick",
                label: "QUICK"
              },
              {
                type: "group",
                steps: [
                  {
                    type: "group",
                    steps: [
                      {
                        type: "say",
                        message: "\u231B Extracting data on the 3 most popular videos."
                      },
                      {
                        type: "loop",
                        list: "top3",
                        steps: [
                          {
                            type: "navigate",
                            url: "{{item.url}}",
                            waitForIdle: false,
                            silent: true
                          },
                          {
                            type: "wait",
                            for: "js-function",
                            timeout: 15e3,
                            silent: true,
                            code: "const video = document.querySelector('video')\nif (!video) return false\n\nvideo.muted = true\nreturn true"
                          },
                          {
                            type: "js",
                            code: 'function generateMarkdownLink(video) {\n  if (!video) return "No video information available."\n\n  const title = video.title\n  const url = video.url\n  return `[${title}](${url})`\n}\n\nreturn generateMarkdownLink(args.item)',
                            args: "item",
                            param: "link",
                            label: "GET MARKDOWN LINK",
                            silent: true
                          },
                          {
                            type: "js",
                            code: "function createItem(link, transcriptPlain) {\n  return {\n    url: link,\n    transcript: transcriptPlain\n  };\n}\n\nreturn createItem(args.link, args.transcriptPlain);",
                            args: "link, transcriptPlain",
                            param: "itemTop",
                            silent: true,
                            label: "NEW ITEM"
                          },
                          {
                            type: "calc",
                            func: "list-add",
                            index: "last",
                            list: "top3sum",
                            item: "itemTop"
                          }
                        ]
                      }
                    ],
                    label: "TOP 3 COLLECT"
                  },
                  {
                    type: "group",
                    steps: [
                      {
                        type: "say",
                        message: "\u231B Extracting data on the 3 least popular videos."
                      },
                      {
                        type: "loop",
                        list: "bottom3",
                        steps: [
                          {
                            type: "navigate",
                            url: "{{item.url}}",
                            waitForIdle: false,
                            silent: true
                          },
                          {
                            type: "wait",
                            for: "js-function",
                            timeout: 15e3,
                            silent: true,
                            code: "const video = document.querySelector('video')\nif (!video) return false\n\nvideo.muted = true\nreturn true"
                          },
                          {
                            type: "js",
                            code: 'function generateMarkdownLink(video) {\n  if (!video) return "No video information available."\n\n  const title = video.title\n  const url = video.url\n  return `[${title}](${url})`\n}\n\nreturn generateMarkdownLink(args.item)',
                            args: "item",
                            param: "link",
                            label: "GET MARKDOWN LINK",
                            silent: true
                          },
                          {
                            type: "js",
                            code: "function createItem(link, transcriptPlain) {\n  return {\n    url: link,\n    transcript: transcriptPlain\n  };\n}\n\nconst newItem = createItem(args.link, args.transcriptPlain);\n\nreturn newItem;",
                            args: "link, transcriptPlain",
                            param: "itemBot",
                            silent: true,
                            label: "NEW ITEM"
                          },
                          {
                            type: "calc",
                            func: "list-add",
                            index: "last",
                            list: "bot3sum",
                            item: "itemBot"
                          }
                        ]
                      }
                    ],
                    label: "BOTTOM 3 COLLECT"
                  },
                  {
                    type: "navigate",
                    url: "https://www.youtube.com/{{profile}}",
                    waitForIdle: false,
                    silent: true
                  },
                  {
                    type: "group",
                    steps: [
                      {
                        type: "say",
                        message: "\u231B Analyzing the 3 most popular videos."
                      },
                      {
                        type: "loop",
                        list: "top3sum",
                        steps: [
                          {
                            type: "gpt",
                            prompt: "I want you to only answer in {{language}}. You goal is to analyze a YouTube transcript and extract the main important information from that.\n\n- Capture important facts in your answer.Your response be informative and easy to read & understand.\n\n- At the start of the summary, include a markdown-formatted link to the video.\n\n- Don't write general phrases.\n\n- Summarize in 100 words what this video is about and why it might be interesting to viewers.\n\n- [link to the video]:  {{item.url}}\n\n- Output format:\n\n {{item.url}}. Summary in 100 words.\n\n\n[YouTube transcript]:\n\n{{item.transcript}}\n\n",
                            param: "gpt",
                            silent: true
                          },
                          {
                            type: "calc",
                            func: "list-add",
                            index: "last",
                            list: "top3analysis",
                            item: "gpt"
                          }
                        ]
                      }
                    ],
                    label: "TOP 3 ANALYSIS "
                  },
                  {
                    type: "group",
                    steps: [
                      {
                        type: "say",
                        message: "\u231B Analyzing the 3 least popular videos."
                      },
                      {
                        type: "loop",
                        list: "bot3sum",
                        steps: [
                          {
                            type: "gpt",
                            prompt: "I want you to only answer in {{language}}. You goal is to analyze a YouTube transcript and extract the main important information from that.\n\n- Capture important facts in your answer.Your response be informative and easy to read & understand.\n\n- At the start of the summary, include a markdown-formatted link to the video.\n\n- Don't write general phrases.\n\n- Summarize in 100 words what this video is about and why it might not be interesting to viewers.\n\n- [link to the video]:  {{item.url}}\n\n- Output format:\n\n {{item.url}}. Summary in 100 words.\n\n\n[YouTube transcript]:\n\n{{item.transcript}}",
                            param: "gpt",
                            silent: true
                          },
                          {
                            type: "calc",
                            func: "list-add",
                            index: "last",
                            list: "bot3analysis",
                            item: "gpt"
                          }
                        ]
                      }
                    ],
                    label: "BOT 3 ANALYSIS"
                  },
                  {
                    type: "say",
                    message: "\u2705 Insights extracted. Drawing conclusions."
                  },
                  {
                    type: "say",
                    message: "## {{profile}} YouTube profile analysis\n{{period}}\n{{views}}\n{{last}}\n"
                  },
                  {
                    type: "gpt",
                    prompt: `Act as a professional content analyst fluent in {{language}}. I will provide you with a [DATA ARRAY] containing brief information about the 3 most popular and 3 least popular videos on a YouTube channel.

Please analyze these 6 video transcripts and succinctly describe the content featured in these videos.

- Don't make any "Conclusion" sections

- Format your response with markdown features.

- Don't include introductory phrases, advice, or notes. Stick to my format and don't add anything unnecessary.

- Format your response with markdown features.

- Avoid general statements; your response should be brief and to the point.

-- Output format:

### The content in the 3 most popular videos included:
- [title](url): summary.
- [title](url): summary.
- [title](url): summary.

### The content in the 3 least popular videos included:
- [title](url): summary.
- [title](url): summary.
- [title](url): summary.

[DATA ARRAY]:

[3 most popular videos]: {{top3analysis}}

[3 least popular videos]: {{bot3analysis}}`,
                    param: "analysis",
                    silent: false,
                    label: "ANALYSIS"
                  },
                  {
                    type: "gpt",
                    prompt: `Please act as a professional web content and audience analyst fluent in {{language}}.
Based on the [ANALYSIS] of the 3 most and least interesting videos from a user's YouTube profile, consider what additional content will interest the audience and what content to avoid.
- Analyze who the primary viewers of the YouTube channel are and how to expand audience reach.
- Do not repeat arguments already present in the analysis.
- Show the response in rendered Markdown format.
- Don't make any "Conclusion" sections and headings in the end.

Output format:

### Audience Analysis
Your analysis text here

### Ways to Expand Audience
Text with strategies and suggestions about the ways to expand audience

[ANALYSIS]:

{{period}}

{{last}}

{{analysis}}


Audience Analysis in {{language}}:`,
                    label: "AUDIENCE ANALYSIS",
                    param: "audience"
                  },
                  {
                    type: "gpt",
                    prompt: `Based on the [PREVIOUS ANALYSIS] of the 3 most and least interesting videos from a user's YouTube profile and audience research, make a concise conclusion and advise on what types of videos should be produced. Compare the topics and deduce what resonates most with the audience.

- Start your response with the  "## Conclusion" heading.

- Based on the analysis of the 3 most and least interesting videos from a user's YouTube profile, make a concise advise on what types of videos are the most interesting for the audience.

- Format your response with markdown features.

- Make advice and recommendations for upcoming content

- Avoid general statements; your response should be to the point.


-- Output format:

## Conclusion
text


[PREVIOUS ANALYSIS]:

{{analysis}}


{{audience}}


Conclusion in {{language}}:`,
                    param: "gpt",
                    label: "CONCLUSION"
                  }
                ],
                condition: "{{type}} = indepth",
                label: "IN-DEPTH V2"
              }
            ]
          },
          {
            meta: {
              name: "sentiment-analysis",
              title: "Sentiment analysis",
              description: "Categorizes reviews of a product as positive, neutral, or negative, and provides an overall rating.",
              category: "E-Commerce",
              emoji: "\u{1F60A}"
            },
            steps: [
              { type: "say", message: "\u23F3 Analyzing opened page..." },
              {
                type: "gpt",
                prompt: 'Please ignore all previous instructions. I want you to only respond in {{language}}.\n\nAssume the role of a data analyst specializing in sentiment analysis. Your task is to analyze a [WEB PAGE]:\n- Provide a general sentiment rating using specific emojis: "\u{1F7E9} description" for positive, "\u{1F7E8} description" for neutral, and "\u{1F7E5} description" for negative.\n- If the web page has user reviews, classify the reviews into three categories: positive, neutral, and negative\n- Under each category, list bullet points summarizing the main points of feedback in that category.\n\nFOLLOW THE FORMAT:\n\n## General sentiment\n\u{1F7E9} or \u{1F7E8} or \u{1F7E5} + description\n\n## \u{1F60A} Positive\n- Key takeaway\n- ....\n\n## \u{1F610} Neutral\n- Key takeaway\n- ....\n\n## \u{1F623} Negative\n- Key takeaway\n- ....\n\n[WEB PAGE]: {{page}}\n'
              }
            ]
          },
          {
            meta: {
              name: "product-review-writer",
              title: "Product review writer",
              category: "E-Commerce",
              description: "Create human-like customer reviews for any product or service on Amazon / eBay / Walmart, etc.",
              emoji: "\u{1F4DD}",
              apps: "Amazon, AliExpress, eBay, Walmart, Flipkart, Rakuten, Zalando, Shopify"
            },
            steps: [
              {
                condition: "{{howMany}} =",
                label: "START",
                type: "calc",
                func: "set",
                param: "howMany",
                format: "",
                value: "3"
              },
              {
                condition: "{{url}} =~ ^https:\\/\\/www\\.amazon\\.[a-zA-Z0-9\\-\\.]+\\/",
                label: "AMAZON",
                type: "group",
                steps: [
                  {
                    condition: "{{grab .a-fixed-right-grid}}",
                    label: "INFO PARSED",
                    type: "calc",
                    param: "product",
                    value: "Product: {{grab h1}}\n\n{{grab .a-fixed-right-grid}}\n\nTotal Rating:\n{{grab .cm-cr-review-stars-spacing-big}}\n\nTop Reviews:\n\n{{grab .a-row.a-spacing-none at=all}}\n",
                    func: "set",
                    format: ""
                  },
                  {
                    condition: "{{grab .a-fixed-right-grid}} = ",
                    label: "NO INFO > PAGE",
                    type: "calc",
                    value: "{{page}}",
                    func: "set",
                    param: "product",
                    format: ""
                  }
                ]
              },
              {
                condition: "{{url}} =~ ^https:\\/\\/www\\.ebay\\.[a-zA-Z0-9\\-\\.]+\\/",
                label: "EBAY",
                type: "group",
                steps: [
                  {
                    condition: "{{grab .vim.x-about-this-item}}",
                    label: "INFO PARSED",
                    type: "calc",
                    value: "Product: {{grab h1}}\n\nPrice: {{grab .x-price-primary}}\n\nItem specifics: {{grab .vim.x-about-this-item .ux-labels-values at=all}}\n\nTop Reviews:\n{{grab .fdbk-container at=all}}",
                    func: "set",
                    param: "product",
                    format: ""
                  },
                  {
                    condition: "{{grab .vim.x-about-this-item}} = ",
                    label: "NO INFO > PAGE",
                    type: "calc",
                    func: "set",
                    param: "product",
                    format: "",
                    value: "{{page}}"
                  }
                ]
              },
              {
                label: "OTHER MERCHANTS",
                type: "group",
                steps: [
                  {
                    label: "PAGE > PRODUCT",
                    type: "calc",
                    func: "set",
                    param: "product",
                    format: "",
                    value: "{{page}}"
                  },
                  {
                    label: "MARKDOWN LINK",
                    type: "calc",
                    param: "link",
                    value: "[{{grab h1}}]({{url}})",
                    func: "set",
                    format: ""
                  }
                ]
              },
              {
                label: "ANCHOR FOR MD LINK",
                type: "calc",
                param: "anchor",
                value: "{{grab h1}}",
                func: "set",
                format: ""
              },
              {
                type: "js",
                code: "let text = anchor.slice(0, 30)\nreturn text;",
                timeout: 15e3,
                silent: true,
                args: "anchor",
                param: "anchor"
              },
              {
                label: "MARKDOWN LINK",
                type: "calc",
                param: "review.link",
                value: "[{{anchor}}...]({{url}})",
                func: "set",
                format: ""
              },
              {
                type: "ask",
                param: "instructions",
                message: "Pick a review tone or type a custom one, for example:\n\n```markdown\nWrite a short, neutral, human-like review, as if from an 14 year old. Make occasional grammar mistakes.\n```",
                options: [
                  {
                    label: "\u{1F44D}\uFE0F LONG",
                    value: `Long positive review. Write a detailed positive product review that evaluates important consumer features of the product and describes some specific use-cases that you can take from other reviews or imagine from product description. Come up with a minor flaw in the product, even if it's perfect e.g. "The only downside of this TV is I'd prefer even thinner screen bezels".`
                  },
                  {
                    label: "\u{1F44D}\uFE0F SHORT",
                    value: "Short positive review. Write {{howMany}} very short positive product review(s) evaluating key features and describing a use-case from other reviews or your own. Allow 1 or 2 grammar mistakes like not capitalizing the start of a sentence or missing periods. Use simple language as if writing for a close friend. U can use 1 abbreviation or acronym used in online chat. Don't do mistakes in every sentence, make this writing feature random."
                  },
                  {
                    label: "\u{1F44E} LONG",
                    value: "Long negative review. Please provide a comprehensive, extensive negative review of this product. Describe an unfavorable real-life experience with using the item, but avoid being overly critical of its quality. Instead, substantiate your dissatisfaction by drawing examples from existing reviews or the product's description."
                  },
                  {
                    label: "\u{1F44E} SHORT",
                    value: "Short negative review. I need {{howMany}} short negative review(s) for this product, briefly describe one bad experience of using the product in real life. Allow 1 or 2 grammar mistakes like not capitalizing the start of a sentence or missing periods. Use simple language as if writing for a close friend.  U can use 1 abbreviation or acronym used in online chat. Don't do mistakes in every sentence, make this writing feature random."
                  },
                  {
                    label: "\u{1F3AD} MIMIC REVIEWS",
                    value: "Please analyze the product and the reviews I provided you with. Mimic their style and key points, and write a similar review for the product so that it blends in with the others. Be concise but not too brief. If I didn't provide any reviews, write a neutral-positive review based on the product description, and come up with a use case for the product."
                  },
                  {
                    label: "\u{1F3B2} RANDOM",
                    value: "Please write {{howMany}} random review(s), mixing short and long reviews, positive and negative. If I didn't provide any user's reviews, write {{howMany}} random review(s) based on the product description."
                  },
                  "$custom"
                ],
                optionsInvalid: false,
                default: ""
              },
              {
                type: "gpt",
                prompt: "Please ignore all previous instructions.\nI want you to respond only in {{language}}.\n\nPretend to be a customer who used [PRODUCT] and is writing a review for it.\n\nClearly follow these instructions:\n- Write {{howMany}} human-like review/feedback/testimonial from the customer's point of view.\n- Yor review should have a title of 1 or 2 simple words.\n- The title and the review shoud be enclosed into a differend markdown code-blocks.\n- Strictly follow to the [Response format]\n- If I asked you to write more than 1 review, differ them stylistically, seeming written by different people. For example, use paragraphs in one but not another.\n- Use the review texts I will provide at the end of this prompt as examples.\n- Tone and style instructions: {{instructions}}\n- Do not echo my prompt.\n- Ensure your response is not filled with general and meaningless phrases.\n\n[Response format]:\n\n**Review Title:**\n\n ```markdown\n1-2 Word Review Title\n```\n\n**Product Review:**\n\n```markdown\n..review text...\n```\n\n\n[PRODUCT]:\n{{product}}\n\n[YOUR RESPONSE]:",
                param: "gpt",
                isolated: true
              },
              {
                type: "js",
                code: "const regex = /^###\\s*(.+?)$/m;\nconst match = gpt.match(regex);\n\nif (match) {\n  return match[1].trim();\n}\n\nreturn null;",
                param: "review.title",
                args: "gpt",
                timeout: 15e3,
                silent: true
              },
              {
                label: "EXTRACT TITLE",
                type: "calc",
                func: "extract-code",
                index: "first",
                to: "review.title",
                param: "gpt"
              },
              {
                label: "EXTRACT FIRST REVIEW",
                type: "calc",
                to: "review.text",
                index: "1",
                func: "extract-code",
                param: "gpt"
              },
              {
                type: "calc",
                func: "list-add",
                index: "last",
                list: "reviewsList",
                item: "review"
              },
              {
                label: "NEXT MENU",
                type: "ask",
                param: "next",
                options: [
                  { label: "\u2705 DONE", value: "done" },
                  { label: "\u267B\uFE0F RETRY", value: "retry" },
                  { label: "\u{1F4CC} ADD PROS & CONS", value: "prosCons" },
                  { label: "\u{1F4E6} BULK REVIEW", value: "bulk" }
                ],
                message: "",
                optionsInvalid: false
              },
              { condition: "{{next}} = done", label: "DONE", type: "stop" },
              { condition: "{{next}} = retry", type: "jump", to: "START" },
              {
                condition: "{{next}} = prosCons",
                label: "PROS CONS",
                type: "group",
                steps: [
                  {
                    type: "gpt",
                    prompt: "I want you to write a Pros and Cons section, based on my product review and the information I previously sent you.\nFollow the instructions:\n- Draw conclusions about the product's pros and cons, based on my review.\n- If my review is positive, write at least 4 pros and no more than 1 minor con.\n- If my review is negative, write no more than 2 pros and at least 4 cons.\n- Use bullet points.\n- Place Pros and Cons in separate markdown code blocks, strickly following the [Response format].\n- Avoid generic phrases and adhere to the tone and style used in the review.\n\n[Response format]:\n\n**Pros:**\n\n```markdown\n... pros in bullet points...\n```\n\n**Cons:**\n\n```markdown\n... cons in bullet points...\n``\n\n[My review]:\n{{review.title}}\n{{review.text}}\n\n[Product]: {{grab h1}}\n\n[Webpage context]: {{page limit=400}}\n\n[Pros and Cons]:",
                    isolated: true
                  },
                  { type: "jump", to: "NEXT MENU" }
                ]
              },
              {
                condition: "{{next}} = bulk",
                type: "command",
                name: "Bulk Review Agent",
                inputs: [],
                silent: true
              }
            ]
          },
          {
            meta: {
              name: "bulk-review-agent",
              title: "Bulk review agent",
              category: "E-Commerce",
              description: "Writes product reviews on Amazon / EBay / Walmart etc. in a set tone for a given product links.",
              emoji: "\u{1F916}",
              apps: "Amazon, AliExpress, eBay, Walmart, Flipkart, Rakuten, Zalando, Shopify"
            },
            steps: [
              {
                label: "ASK FOR LINKS",
                type: "ask",
                param: "urls",
                message: " Please paste in a list of product links, comma or space separated, for example:\n\n```\nhttps://a.co/d/hwfEQjP, https://www.ebay.com/itm/235451538845\n```",
                options: null,
                default: ""
              },
              {
                type: "js",
                code: `let links = []
const linkRegex = /(https?:\\/\\/\\S+?)(?=[,;\\n\\s\\]]|$)/gi

try {
  // any data to string
  const urlString = String(urls)
  // split string
  const urlParts = urlString.split(/[,;\\n\\s]+/)
  urlParts.forEach(part => {
    const matchedLinks = part.match(linkRegex) || []
    links = links.concat(matchedLinks)
  })

  // delete "
  links = links.map(link => link.replace(/^"|"$/g, ''))

  // delete duplicates
  links = [...new Set(links.filter(Boolean))]
} catch (error) {
  return false
}

return links`,
                param: "links",
                timeout: 15e3,
                silent: true,
                args: "urls"
              },
              {
                condition: "{{links.length}} = 0",
                label: "NO LINKS",
                type: "group",
                steps: [
                  { type: "say", message: "\u26D4\uFE0F Incorrect link format.\n\n" },
                  { type: "jump", to: "ASK FOR LINKS" }
                ]
              },
              { type: "say", message: "\u2705 {{links.length}} link(s) extracted." },
              {
                label: "ASK FOR TONE",
                type: "ask",
                param: "tone",
                message: "Pick a review tone or type a custom one, for example:\n\n```markdown\nWrite a short, neutral, human-like review, as if from an 14 year old. Make occasional grammar mistakes.\n```",
                options: [
                  { label: "\u{1F44D}\uFE0F LONG", value: "\u{1F44D}\uFE0F LONG" },
                  { label: "\u{1F44D}\uFE0F SHORT", value: "\u{1F44D}\uFE0F SHORT" },
                  { label: "\u{1F44E} LONG", value: "\u{1F44E} LONG" },
                  { label: "\u{1F44E} SHORT", value: "\u{1F44E} SHORT" },
                  { label: "\u{1F3AD} MIMIC REVIEWS", value: "\u{1F3AD} MIMIC REVIEWS" },
                  { label: "\u{1F3B2} RANDOM", value: "\u{1F3B2} RANDOM" },
                  "$custom"
                ],
                optionsInvalid: false,
                default: ""
              },
              {
                label: "ASK HOW",
                type: "ask",
                param: "how",
                message: "How would you like to me to write reviews?",
                options: [
                  { label: "\u{1F502} ONE BY ONE", value: "onebyone" },
                  { label: "\u{1F6D2} ALL AT ONCE", value: "all" }
                ],
                default: "",
                optionsInvalid: false
              },
              {
                type: "loop",
                steps: [
                  {
                    type: "navigate",
                    url: "{{item}}",
                    waitForIdle: false,
                    silent: true
                  },
                  {
                    type: "wait",
                    for: "random-delay",
                    minDelay: 1200,
                    maxDelay: 3e3,
                    silent: true
                  },
                  {
                    type: "calc",
                    func: "set",
                    param: "anchor",
                    value: "{{grab h1}}",
                    format: ""
                  },
                  {
                    type: "js",
                    code: "let text = anchor.slice(0, 30)\nreturn text;",
                    args: "anchor",
                    param: "anchor",
                    timeout: 15e3,
                    silent: true
                  },
                  {
                    type: "say",
                    message: "\u{1F50E} Reviewing [{{anchor}}...]({{url}})"
                  },
                  {
                    type: "calc",
                    param: "howMany",
                    format: "number",
                    value: "1",
                    func: "set"
                  },
                  {
                    type: "command",
                    name: "Product Review Writer",
                    inputs: ["{{tone}}", "done"],
                    silent: false
                  },
                  {
                    condition: "{{how}} = onebyone",
                    label: "ONE BY ONE",
                    type: "group",
                    steps: [
                      {
                        label: "ONEBYONE MENU",
                        type: "ask",
                        param: "oneByOne",
                        options: [
                          { label: "\u2705 NEXT", value: "next" },
                          { label: "\u267B\uFE0F RETRY", value: "retry" },
                          { label: "\u{1F4CC} ADD PROS & CONS", value: "prosCons" },
                          { label: "\u2B07\uFE0F PASTE REVIEW TO PAGE", value: "paste" },
                          "$custom"
                        ],
                        message: "",
                        default: "",
                        optionsInvalid: false
                      },
                      {
                        condition: "{{oneByOne}} = prosCons",
                        label: "PROS-CONS",
                        type: "group",
                        steps: [
                          {
                            type: "gpt",
                            prompt: "I want you to write a Pros and Cons section, based on my product review.\nFollow the instructions:\n- Draw conclusions about the product's pros and cons, based on my review.\n- If my review is positive, write at least 4 pros and no more than 1 minor con.\n- If my review is negative, write no more than 2 pros and at least 4 cons.\n- Use bullet points.\n- Place Pros and Cons in separate markdown code blocks, strictly following the [Response format].\n- Avoid generic phrases and adhere to the tone and style used in the review.\n\n[Response format]:\n\n**Pros:**\n\n```markdown\n... pros in bullet points...\n```\n\n**Cons:**\n\n```markdown\n... cons in bullet points...\n``\n\n[My review]:\n{{review.title}}\n{{review.text}}\n\n[Product]: {{grab h1}}\n\n[Webpage context]: {{page limit=400}}\n\n[Pros and Cons]:",
                            isolated: true
                          },
                          { type: "jump", to: "ONEBYONE MENU" }
                        ]
                      },
                      {
                        condition: "{{oneByOne}} = retry",
                        label: "RETRY",
                        type: "group",
                        steps: [
                          {
                            type: "command",
                            name: "Product Review Writer",
                            inputs: ["{{tone}}", "Done"]
                          },
                          { type: "jump", to: "ONEBYONE MENU" }
                        ]
                      },
                      {
                        condition: "{{oneByOne-option}} = $custom",
                        label: "CUSTOM",
                        type: "group",
                        steps: [
                          { type: "gpt", prompt: "{{oneByOne}}" },
                          { type: "jump", to: "ONEBYONE MENU" }
                        ]
                      },
                      {
                        condition: "{{oneByOne}} = paste",
                        label: "PASTE",
                        type: "group",
                        steps: [
                          {
                            label: "PASTE TO PAGE",
                            type: "paste",
                            text: "{{review.text}}",
                            mode: "insert",
                            selectorType: "ai",
                            selector: null,
                            item: null
                          },
                          { type: "jump", to: "ONEBYONE MENU" }
                        ]
                      },
                      {
                        condition: "{{links.length}} = {{reviewsList.length}}",
                        label: "END",
                        type: "group",
                        steps: [
                          {
                            type: "say",
                            message: "\u2705 {{links.length}} reviews generated. "
                          },
                          {
                            label: "FINAL ACTION",
                            type: "ask",
                            param: "finalAction",
                            options: [
                              { label: "\u2705 DONE", value: "done" },
                              { label: "\u{1F4E6} EXPORT", value: "export" },
                              { label: "\u{1F50D} SHOW ALL", value: "showAll" }
                            ],
                            message: "",
                            default: "",
                            optionsInvalid: false
                          },
                          { condition: "{{finalAction}} = done", type: "stop" },
                          {
                            condition: "{{finalAction}} = export",
                            type: "export",
                            what: "param",
                            param: "reviewsList"
                          },
                          {
                            condition: "{{finalAction}} = showAll",
                            label: "SHOW ALL",
                            type: "group",
                            steps: [
                              {
                                label: "GENERATE MD TABLE",
                                type: "js",
                                code: "let markdownTable = '| Link | Review |\\n| --- | --- |\\n'\nconst s = text => (text || '').replace(/\\n/g, ' ') reviewsList.forEach(review => {\n  const row = `| ${s(review.link)} | **${s(review.title)}**: ${s(review.text)} |\\n`\n  markdownTable += row\n})\nreturn markdownTable",
                                param: "markdownTable",
                                args: "reviewsList",
                                timeout: 15e3,
                                silent: true
                              },
                              { type: "say", message: "{{markdownTable}}" }
                            ]
                          },
                          { type: "jump", to: "FINAL ACTION" }
                        ]
                      }
                    ]
                  }
                ],
                list: "links"
              },
              {
                condition: "{{how}} = all",
                label: "SHOW ALL",
                type: "group",
                steps: [
                  {
                    condition: "{{reviewsList.length}} > 0",
                    label: "GENERATE MD TABLE",
                    type: "js",
                    args: "reviewsList",
                    code: "let markdownTable = '| Link | Review |\\n| --- | --- |\\n'\n\nconst s = text => (text || '').replace(/\\n/g, ' ')\nreviewsList.forEach(review => {\n  const row = `| ${s(review.link)} | **${s(review.title)}**: ${s(review.text)} |\\n`\n  markdownTable += row\n})\n\nreturn markdownTable",
                    param: "markdownTable",
                    timeout: 15e3,
                    silent: true
                  },
                  {
                    type: "say",
                    message: "\u2705 {{reviewsList.length}} reviews generated:\n{{markdownTable}}\n"
                  },
                  {
                    type: "ask",
                    param: "menu",
                    options: [
                      { label: "\u2705 DONE", value: "done" },
                      { label: "\u{1F4E6} EXPORT", value: "export" }
                    ],
                    message: "",
                    default: "",
                    optionsInvalid: false
                  },
                  { condition: "{{menu}} = done", type: "stop" },
                  {
                    condition: "{{menu}} = export",
                    type: "export",
                    what: "param",
                    param: "reviewsList"
                  }
                ]
              }
            ]
          },
          {
            meta: {
              name: "product-description-writer",
              title: "SEO-friendly product description",
              category: "E-Commerce",
              description: "Write optimized product description based on a list of product features. For the best results provide as much info as possible and include SEO keywords.",
              apps: "Amazon, AliExpress, eBay, Walmart, Flipkart, Rakuten, Zalando, Shopify"
            },
            steps: [
              {
                say: "Your list of features, keywords, and anything you can say about the product. Leave blank to parse product information from page:\n"
              },
              { ask: "param", default: "{{page}}" },
              {
                gpt: "Please ignore all previous instructions.\nI want you to act as a very proficient SEO and high-end eCommerce copy writer that speaks and writes fluently {{language}}.\nWrite four 300 word product descriptions based on the product details I give you. Also follow these guidelines: - Focus on benefits rather than features - Avoid sentences over 20 words - Avoid using passive voice - Include a call to action at the end\nPlease write in an informative writing style with the most relevant keywords and Search terms concisely.\nEvery product description should have a title and a markdown code block with the product description itself, enclosed into code-block quotes. Do not echo my prompt.\n\nHere are examples of a single product description output:\n**Product description #1**\n```markdown\nExperience the [Benefit] and [Benefit] with our [Product], specifically designed for [Target Audience]. Crafted from high-quality [Material], this [Product category] with  [Unique Selling Point 1] [How product makes customer's life better 1]. With [Unique Selling Point 2] integrated into its design, it [How product makes customer's life better 2].\nThe [Technology/Design] not only adds to its [Benefit] but also guarantees [Benefit], promising a [Product] that [Benefit]. Available in an array of tasteful colors (If mentioned), you can choose the one that best fits your style or even collect them all to match with your different attires.\n[CTA]. [A colorful metaphor about the product in one sentence].\n```\n\n[PRODUCT DESCRIPTION / DETAILS]:\n{{param}}\n\n[4 PRODUCT DESCRIPTIONS]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[4 PRODUCT DESCRIPTIONS]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "product-description-writer-saas",
              title: "SaaS product description writer",
              category: "E-Commerce",
              description: "Based on the product information create a click-enticing product name and description that encourage to buy online. Perfect for SaaS or online products and services."
            },
            steps: [
              {
                say: "Enter your product description / information / overview, leave empty to parse from page:\n"
              },
              { ask: "param", default: "{{page}}" },
              {
                gpt: "Please ignore all previous instructions. I want you to respond only in {{language}}.\nI want you to act as a SEO and Conversion Rate Optimisation expert.\nPretend that you have the most accurate and most detailed information about a product explained below. Based on the product information given below create unique and very click-enticing product name and product description that encourage to buy online. Please generate 3 options of name and description for me. Style with markdown.\n\nExample output:\n## [click-enticing product name]\n[product description]\n\n## [click-enticing product name]\n[product description]\n\n## [click-enticing product name]\n[product description]\n\nPlease generate 3 options of name and description for me. Style with markdown.\n\n[MY PRODUCT INFORMATION]:\n{{param}}\n\n[PRODUCT NAMES AND DESCRIPTIONS]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS]. Provide a rewritten output.\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[PRODUCT NAMES AND DESCRIPTIONS]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "product-description-writer-e-commerce",
              title: "E-Commerce product description",
              category: "E-Commerce",
              description: "Create a rich product description and title for your e-commerce product. Perfect for e-commerce products on Amazon, AliExpress, Jet.com etc.",
              apps: "Amazon, AliExpress, eBay, Walmart, Flipkart, Rakuten, Zalando, Shopify"
            },
            steps: [
              {
                say: "Enter your product description / information / overview, leave empty to parse from page:\n"
              },
              { ask: "param", default: "{{page}}" },
              {
                gpt: `Please ignore all previous instructions. I want you to respond only in {{language}}.
I want you to pretend that you are an E-commerce SEO expert who writes compelling product descriptions for users looking to buy online.
I want you to create a rich product description and title for my e-commerce product. Do not write Country of Origin if not given.
The results must show everything in one stretch without stopping, and make sure to use markdown formatting to display the results.

OUTPUT FRAMEWORK:
" ## Meta Title: [Brand] [Benefit] with [Product] - [Feature 1], [Feature 2], [Feature 3], [Feature 4], and [Feature 5]. Length under 150 characters.
Bullet Points: Confines to 7 Bullet points with overall bullets\u2019 character length shall be 1750 characters. Please begin each bullet point with two or three capitalized words that indicate the function of the point.

- [Feature 1]: [Product] measures [Measurement] and is suitable for [Age Range]. [Keywords] Do to ensure the highest quality and durability. [Color/Size Variation].
- [Feature 2]: Includes [Number] [Type] for endless [Activity] possibilities. Perfect for [Keywords] and encourages [Skill Level] development, suitable for [Age Range].
- [Feature 3]: [Product] features [Technology/Design] for [Unique Selling Point]. Ideal for [Keywords] and [Benefit]
- [Feature 4]: [Product] made with [Material] provides [Benefit]. Suitable for [Ideal Conditions], perfect for [Keywords] and offers [Benefit] to [Target Audience]
[User Applications]: [Product] is [Easy to Use/Maintain] with [Unique Feature] and is designed to solve [User Applications]. Perfect for [Keywords].
- [Feature 5]: [Keywords] and [Benefits] to [Target Audiences]
- [Feature 6]: [Keywords] and [Benefits] to [Target Audiences]

### Product Description:
[Product] is the perfect solution for [Keywords]. It is [Feature 1], [Feature 2], [Feature 3], [Feature 4], [Feature 5], and [Feature 6]. Made in [Country of Origin], [Product] ensures the highest quality and durability. Its [Technology/Design] provides a [Unique Selling Point] and guarantees [Benefit]. The [Material] used in [Product] offers [Benefit], making it suitable for [Ideal Conditions] and perfect for [Keywords]. Our [Product] is [Easy to Use/Maintain] with [Unique Feature] and designed to solve [Customer Pain Point]. [Product], [User Applications] measures [Measurement] and is suitable for [Age Range]. [Color/Size Variation]. [Target Audience]

### Search Terms:
Include 30 relevant user Search Terms based on search volume and display them as comma separated. Subject Matter: [Insert subject matter] [Product] with [Features], perfect for [Keywords].
### Target Audience:
[Insert target audience] [Product] is ideal for [Target Audience], such as [Target Subgroup]. Intended Use: [what activities, conditions, events, or locations the product is intended to be used.]
### Attributes:
- [words or phrases you add to your Amazon product listing to describe your product] "

Make sure to follow all of Amazon's guidelines and optimize your product listing for discoverability and conversions.

Please write in an informative writing style with the most relevant keywords and Search terms concisely.

[PRODUCT]: {{param}}

[OUTPUT]:`
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[REWRITTEN OUTPUT]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "promotional-text-writer",
              title: "Promotional text writer",
              category: "E-Commerce",
              description: "Generates a message, reply, or email to promote your product or service."
            },
            steps: [
              {
                ask: "service",
                message: "Describe your product or service, leave empty to parse product description from page:\n",
                default: "{{page}}"
              },
              {
                type: "ask",
                param: "option",
                options: [
                  { label: "\u{1F4AC} COMMENT OR REPLY", value: "comment" },
                  { label: "\u{1F4EC} EMAIL", value: "email" }
                ]
              },
              {
                condition: "{{option}} = comment",
                type: "group",
                steps: [
                  {
                    ask: "msg",
                    message: "Message to reply to. Leave empty to parse from the web page:\n",
                    default: "{{page}}"
                  },
                  {
                    gpt: "Please ignore all previous instructions. I want you to respond only in {{language}}.\nI want you to pretend to be a human, assisting users asking questions online.\nI give you two pieces of information:\n1. A short description of my product, service or business (SERVICE) which might also have a URL link.\n2. A web page content which contains user's post, DM, message or question.\nYour task is to parse the user's question, then write a helpful reply or comment to the user's message, post or question in a way that it promotes by SERVICE.\nThe comment should sound human-like and be indeed helpful. Do not oversell or be too aggressive promoting my SERVICE.\n[SERVICE]:\n{{service}}\n\n[WEB PAGE CONTENT CONTAINING DM, MESSAGE OR POST]:\n{{msg}}\n\nComment or reply:\n"
                  }
                ]
              },
              {
                condition: "{{option}} = email",
                type: "group",
                steps: [
                  {
                    ask: "additional-instructions",
                    default: "None",
                    message: "Any additional instructions? Press Enter to skip.\n"
                  },
                  {
                    gpt: "Please ignore all previous instructions. I want you to respond only in {{language}}.\nI want you to act as a proficient SEO and high end copywriter. Your task is to write the best marketing email promoting the product or service described.\nCraft an email that provides a detailed overview of the features and benefits of my product or service.\nUse style and tone that resonates with my potential target audience to demonstrate how my product addresses their possible concerns and desires.\nLeverage the power of storytelling to illustrate the impact of my product/service on my target audience.\nEnd with a strong, clear, compelling or urgent call-to-action that encourages your audience to take the next step towards purchasing/signing up for/trying my product or service.\n\n[PRODUCT OR SERVICE]:\n{{service}}\n\n[ADDITIONAL INSTRUCTIONS]:\n{{additional-instructions}}\n\n[PROMOTIONAL EMAIL]:\n"
                  }
                ]
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\nRewritten text:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "faq-and-answers-writer",
              title: "FAQ & answers writer",
              category: "E-Commerce",
              description: "Generate FAQ list with answers from the given product or service description."
            },
            steps: [
              {
                say: "Keywords, product or service description. Leave blank to parse from page:\n"
              },
              { ask: "param", default: "{{page}}" },
              {
                gpt: "Please ignore all previous instructions. I want you to respond only in {{language}}.\nYou are a SEO Expert and Copywriter. Your task is to write an FAQ about the given [TOPIC], which may include keywords, product or service description, as well as any other information. Extract useful information for yourself and answer the task given to you.\nYou should come up with at least 5 questions and answers. Make sure every sentence is unique. Use a formal tone. Write approximately 750 words in total.\n\nExample output:\n## F.A.Q.\n### Question 1.\n**Q.:** question\n**A.:** answer\n\n[TOPIC]:\n{{param}}\n\n[FAQ]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[FAQ]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "customer-review-responses-writer",
              title: "Customer review responses writer",
              category: "E-Commerce",
              description: "Get friendly responses to a list of customer reviews, which you can use on Google, Yelp, etc. Organizes your responses nicely in a table so you can copy and paste them easily.",
              apps: "Amazon, AliExpress, eBay, Walmart, Flipkart, Rakuten, Zalando, Shopify"
            },
            steps: [
              {
                say: "Paste your reviews here. Each one should be in brackets, such as [review1], [review2], [review3]:\n"
              },
              { ask: "param" },
              {
                gpt: "Please ignore all previous instructions.\nPlease pretend you are a very nice and grateful person who represents my interests in the process of responding to customer reviews.\nI will provide you with customer reviews in brackets, such as [review1], [review2], [review3], or I will divide them in some other way so that you can understand them.\nPlease pretend you are a very nice and grateful person. Please give me a response for each review in the prompt. Please organize the responses in a table and put the review next to each response so I can see them next to each other.\n\n[CUSTOMER REVIEWS]:\n{{param}}\n\n[RESPONSES TABLE]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[RESPONSES TABLE]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "abandoned-cart-email-series-generator",
              title: "\u0415Mail notifications on items forgotten in cart",
              category: "E-Commerce",
              description: "Generate a series of three abandoned cart emails for product, designed to engage the recipient and ultimately convert them into a paying customer."
            },
            steps: [
              {
                say: "Write a name of your product and shortly describe it, or leave empty to parse product description from the web page:\n"
              },
              { ask: "param", default: "{{page}}" },
              {
                gpt: 'Please ignore all previous instructions. I want you to respond only in {{language}}.\nGenerate a series of three abandoned cart emails for the product described below, designed to engage the recipient and ultimately convert them into a paying customer.\n1st email should be a "friendly reminder" about the item left in the recipient\'s cart. 2nd email should be more "persuasive email" that addresses any potential objections and highlights the unique value of the product. 3rd email should be a "last chance offer", such as a limited-time discount or free shipping, along with a strong call to action.\nThe tone of the emails should be empathetic and customer-focused, and should reflect the brand\'s style.\nConsider including a sense of urgency in the final email, to incentivize the recipient to complete their purchase.\nEvery email should have a title and a markdown code block with the email itself, enclosed into code-block quotes.\nProvide the answer, don\'t write general phrases and don\'t echo my command.\nHere are examples of a single email output:\n\n**Email #1 - friendly reminder**\n```markdown\n\nemail text\n\n```\n\n[PRODUCT DESCRIPTION]: {{param}}\n\n[EMAILS]:'
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[EMAILS]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "buying-guide-writer",
              title: "Buying guide writer",
              category: "E-Commerce",
              description: "Create a product buying guide."
            },
            steps: [
              {
                say: 'Product name or topic e.g. "Gaming PC", leave empty to parse product description from the web page:\n'
              },
              { ask: "param", default: "{{page}}" },
              {
                gpt: "Please ignore all previous instructions. I want you to respond only in {{language}}.\nWrite a detailed buying guide step by step for the mentioned below [PRODUCT DESCRIPTION OR TOPIC]. Be informative and use various sentences. Sentence length should be short with enough transition words. Write in 3rd person.\n\n[PRODUCT DESCRIPTION OR TOPIC]: {{param}}\n\n[BUYING GUIDE]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS]. Provide a rewritten response.\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[BUYING GUIDE]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "quora-answer-writer",
              title: "Quora answer writer",
              category: "E-Commerce",
              description: "Write a personalized Quora answer to any question.",
              apps: "Quora"
            },
            steps: [
              {
                say: "Paste quora question, or leave empty to parse question from the context:\n"
              },
              { ask: "param", default: "{{page}}" },
              {
                gpt: "Please ignore all previous instructions. I want you to respond only in {{language}}.\nParse a Quora Question from the [TEXT]. Pretend to be an expert on the subject. Write 2 paragraphs of 300 words long answer. Be informal and greet the author. Personalize the comment to sound as if you are talking to the author, make the answer sound as humanly as possible.\n\n[TEXT TO PARSE THE QUORA QUESTION FROM]:\n{{param}}\n\n[ANSWER]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n\n[ADDITIONAL INSTRUCTIONS]:\n{{instructions}}\n\n[ANSWER]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "e-commerce-meta-tags",
              category: "E-Commerce",
              title: "E-Commerce meta tags",
              description: "Create SEO-optimized title and description meta tags."
            },
            steps: [
              {
                type: "ask",
                param: "product",
                message: "Please describe your product or press Enter to parse it from the page:",
                default: "{{page}}"
              },
              {
                type: "gpt",
                prompt: 'Please ignore all previous instructions. The output should be in {{language}}.\nAct as an Product Listing Expert and a professional SEO manager. Generate 10 pairs of SEO title tags and meta descriptions.\nTitles must be 65 characters max and reflects the transactional intent for e-commerce websites with proper call to actions and popular terms for e-commerce.\nTry to include all inserted information in the same title tag and same meta description + consider using the following words: buy, shop, online, affordable price, for sale, best, free delivery, specs, \\"in\\" + [market, e.g. Amazon], \\"from\\" + [brand].\nMeta descriptions must be less than 155 characters long and list SEO-optimized product description.\nThe output should be in a 10-rows table of two columns: Title tag and Meta description.\n\n[PARSE PRODUCT DESCRIPTION FROM TEXT]:\n{{product}}\n\n[OUTPUT IN A TABLE]:'
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[OUTPUT IN A TABLE]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "etsy-product-description",
              category: "E-Commerce",
              title: "Etsy Product Description",
              description: "Highlight your product's type, features, USPs, and audience to captivate buyers with its unique appeal.",
              apps: "Etsy"
            },
            steps: [
              {
                type: "ask",
                param: "product",
                message: "Please describe your product or press Enter to parse it from a page:",
                default: "{{page}}"
              },
              {
                type: "gpt",
                prompt: "Please ignore all previous instructions.\nThe output should be in {{language}}.\n\nAct as a Product Listing Expert. Generate 3 riveting product descriptions to captivate my audience. Understand my product's characteristics and USPs to highlight its novelty and allure potential buyers.\nPlease write in an informative writing style with the most relevant keywords and Search terms concisely.\n\nEvery product description should have a title and a markdown code block with the product description itself, enclosed into code-block quotes. Do not echo my prompt.\n\nHere are examples of a single product description output:\n\n**Product description #1**\n```markdown\nExperience the [Benefit] and [Benefit] with our [Product], specifically designed for [Target Audience]. Crafted from high-quality [Material], this [Product category] with  [Unique Selling Point 1] [How product makes customer's life better 1]. With [Unique Selling Point 2] integrated into its design, it [How product makes customer's life better 2].\nThe [Technology/Design] not only adds to its [Benefit] but also guarantees [Benefit], promising a [Product] that [Benefit]. Available in an array of tasteful colors (If mentioned), you can choose the one that best fits your style or even collect them all to match with your different attires.\n[CTA]. [A colorful metaphor about the product in one sentence].\n```\n\n[PRODUCT]: {{product}}\n\n[3 PRODUCT DESCRIPTIONS]:\n"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please rewrite your answer, taking into account the inputs provided earlier: [Product] and [Additional Instructions]. Provide a rewritten Product descriptions.\n\n[PRODUCT]: {{product}}\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[PRODUCT DESCRIPTIONS]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "sales-assistant",
              category: "Marketing",
              title: "Sales assistant",
              description: "Helps sell products and services, handles customer objections, and improves your customer facing conversations.",
              emoji: "\u{1F4B0}"
            },
            steps: [
              {
                condition: "{{g.company}} =",
                type: "calc",
                func: "set",
                param: "g.company",
                format: "",
                value: "**HARPA AI**, based in Finland, is an advanced AI technology company specialized in AI & Web automation, developing RPA products and services. We serve over 500,000 professionals globally by integrating AI into everyday user workflow, ensuring efficiency and productivity without compromising user privacy.\n\n\n**Key HARPA AI Use Cases**\n- Copywriting: Generate diverse text content such as emails, tweets, cover letters, and SEO-optimized articles.\n- Productivity Tools: Summarize web pages, rewrite text, extract data, and get AI-generated responses alongside Google Search.\n- Marketing & SEO: Segment audiences, research SEO keywords, create marketing strategies, generate blog outlines and articles.\n- Web Automation: Automate website navigation, data extraction, form filling, and trigger workflows via integrations like Zapier.\n\n**Core Values**\nUser privacy, innovation, and efficiency. HARPA AI maintains best-in-class privacy standards and a high user satisfaction rating while focusing on delivering practical AI solutions.\n\nI sign my emails as:\n\nMika Laaksonen,\nSales Manager @ HARPA AI\nsales@harpa.ai"
              },
              {
                type: "say",
                message: "\u{1F4A1} Using your company info and the client emails / DMs history or problem description, I'll try to help improve communication and sell the product or service."
              },
              {
                label: "ASK MENU",
                type: "ask",
                param: "menu",
                message: "Your company details:\n\n```markdown\n{{g.company}}\n```\nPlease send message history, describe your situation, or click to find messages on a webpage.",
                options: [
                  {
                    label: "\u{1F50D} FIND MESSAGES ON WEBPAGE",
                    value: "Please find message or email history in this webpage content: {{page}}"
                  },
                  { label: "\u267B\uFE0F CHANGE COMPANY INFO", value: "change" },
                  "$custom"
                ],
                optionsInvalid: false,
                default: ""
              },
              {
                condition: "{{menu}} = change",
                label: "CHANGE COMPANY INFO",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    message: "Please paste your company info here: ",
                    options: null,
                    param: "g.company",
                    default: ""
                  },
                  { type: "say", message: "\u2705 New company info saved." },
                  { type: "jump", to: "ASK MENU" }
                ]
              },
              {
                label: "GPT STEP",
                type: "gpt",
                prompt: "Act as a professional {{language}}-speaking Sales Manager.\nI want you to help me to sell my product or service, handle customer objections or problems, or improves my sales conversations.\n- I'll provide you with the [CONTEXT], which may be client communication history, my problem description, or webpage content from which you should extract the necessary information.\n- Be brief and to the point.\n- Give useful advice relevant to [MY COMPANY DESCRIPTION].\n- Suggest ideas based on the latest trends in sales tactics and customer engagement methods.\n- Don't write general phrases, notes, or anything that isn't relevant.\n- If I've provided you with communication history, after your advice, end your response with an email or message draft that would help me to improve the communication with the client and sell my product. Wrap this email or message draft in a markdown code block:\n```markdown\n... email or message draft...\n```\n\n[MY COMPANY DESCRIPTION]: {{g.company}}\n\n[CONTEXT]: {{menu}}\n\n[YOUR RESPONSE]:",
                isolated: true
              }
            ]
          },
          {
            meta: {
              name: "sales-strategy-generator",
              title: "Sales strategy generator",
              category: "Marketing",
              description: "Generates a Sales Strategy based on the current webpage. Report includes ideas for potential collaboration and a draft cold email."
            },
            steps: [
              {
                condition: "{{g.company}} =",
                type: "calc",
                func: "set",
                param: "g.company",
                format: "",
                value: "**HARPA AI**, based in Finland, is an advanced AI technology company specialized in AI & Web automation, developing RPA products and services. We serve over 500,000 professionals globally by integrating AI into everyday user workflow, ensuring efficiency and productivity without compromising user privacy.\n\n\n**Key HARPA AI Use Cases**\n- Copywriting: Generate diverse text content such as emails, tweets, cover letters, and SEO-optimized articles.\n- Productivity Tools: Summarize web pages, rewrite text, extract data, and get AI-generated responses alongside Google Search.\n- Marketing & SEO: Segment audiences, research SEO keywords, create marketing strategies, generate blog outlines and articles.\n- Web Automation: Automate website navigation, data extraction, form filling, and trigger workflows via integrations like Zapier.\n\n**Core Values**\nUser privacy, innovation, and efficiency. HARPA AI maintains best-in-class privacy standards and a high user satisfaction rating while focusing on delivering practical AI solutions.\n\nI sign my emails as:\n\nMika Laaksonen,\nSales Manager @ HARPA AI\nsales@harpa.ai"
              },
              {
                type: "ask",
                param: "menu",
                message: "Using your company info, I'll create a sales strategy for the client found on this webpage.\n\nYour company details:\n\n```markdown\n{{g.company}}\n```",
                options: [
                  { label: "\u2705 START", value: "start" },
                  { label: "\u267B\uFE0F CHANGE COMPANY INFO", value: "change" }
                ],
                optionsInvalid: false,
                default: ""
              },
              {
                condition: "{{menu}} = change",
                label: "CHANGE COMPANY INFO",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    message: "Please paste your company info here: ",
                    options: null,
                    param: "g.company",
                    default: ""
                  },
                  {
                    type: "say",
                    message: "\u2705 New company info saved:\n```markdown {{g.company}} ```\nAnalyzing webpage...\n"
                  },
                  { type: "jump", to: "GPT STEP" }
                ]
              },
              {
                label: "GPT STEP",
                type: "gpt",
                prompt: "Act as a professional {{language}}-speaking Sales Manager.\nCreate a Sales Strategy Report for my new potential client.\n\n- I'll provide you with the [CONTEXT] from a webpage containing all information about my new client.\n- Be brief and to the point.\n- Give useful advice relevant to [MY COMPANY DESCRIPTION].\n- Consider how my company or I can benefit my new client, what potential problems we can solve, and what this will provide them.\n- Suggest ideas based on the latest trends in sales strategies.\n- Don't write general phrases, notes, or anything that isn't part of the sales strategy.\n- Use markdown formatting.\n- At the end of your response, if you find this information, write my client's contact details.\n- Don't hallucinate about facts, phones, links, or emails. Don't make up a fact or other information.\n\n[MY COMPANY DESCRIPTION]: {{g.company}}\n\n[Follow the output format]:\n- Start with key ideas of potential collaboration. Identify the client's needs that I should focus on.\n- Describe how my company can help address these needs. Provide advice on how to position my product to this client.\n- Generate a short cold sales email draft from my company to the potential client, aiming to generate interest in further communication or a call. Wrap this email text in a markdown code block:\n```markdown\n..email text..\n```\n- End with the client's contact details, if you find this info in [CONTEXT].\n\n\n[CONTEXT]: {{page}}\n\n[Sales Strategy Report]:",
                isolated: true
              }
            ]
          },
          {
            meta: {
              name: "buyer-persona-research",
              category: "Marketing",
              title: "Buyer persona research",
              description: "Generate a detailed buyer persona research for your business, organized into a table."
            },
            steps: [
              {
                type: "ask",
                param: "p1",
                message: "Provide me with some information about your business (name, location, business idea, products, etc.) or press Enter to parse from the page:",
                default: "{{page}}"
              },
              {
                type: "ask",
                param: "p2",
                message: "Please provide me with some information about your market situation, or press Enter and I will attempt to make a guess.",
                default: "Please, make an assumption about the market based on the data about my business."
              },
              {
                type: "gpt",
                prompt: "Please ignore all previous instructions. You are a marketing researcher who speaks and writes fluent {{language}}.\nYour task is to generate a detailed Buyer Persona Research for my business in a specific MARKET. Structure your response in separate tables.\n\nOUTPUT FRAMEWORK:\n\n## Table 01: DEMOGRAPHICS\n\n2 columns and 7 rows\nColumn 1 = Data points (Name, Age, Occupation, Annual income, Marital status, Family situation, Location)\nColumn 2 = Answers for each data point in Column 1 based on the specific MARKET\n\n## Table 02: USER DESCRIPTION\n\nA summary of the user persona in no more than 240 characters.\n\n## Table 03: PSYCHOGRAPHICS\n\n2 columns and 9 rows\nColumn 1 = Data points (Personal characteristics, Hobbies, Interests, Personal aspirations, Professional goals, Pains, Main challenges, Needs, Dreams)\nColumn 2 = Answers for each data point in Column 1 based on the specific MARKET\n\n## Table 04: SHOPPING BEHAVIORS\n\n2 columns and 8 rows\nColumn 1 = Data points (Budget, Shopping frequency, Preferred channels, Online behavior, Search terms, Preferred brands, Triggers, Barriers)\nColumn 2 = Answers for each data point in Column 1 based on the specific MARKET\n\nPlease make sure that your response is structured in separate tables and has a separate row for each data point. Do not provide bullet points.\n\n[BUSINESS]: {{p1}}\n\n[MARKET]: {{p2}}\n\nBuyer Persona Research:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[PRODUCT DESCRIPTIONS]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "segment-your-audience",
              title: "Segment your audience",
              category: "Marketing",
              description: "Break your audience into target-able groups with similar needs."
            },
            steps: [
              {
                say: 'Name your marketing, product or business category in simple but precise language. e.g. "electronic music nightclubs":\n'
              },
              { ask: "param" },
              {
                gpt: "Please ignore all previous instructions. Please only respond in {{language}}.\nI want you to act as a market research expert. Pretend that you know everything about every market.\nProduce up to ten audience segments for audiences in my product / service category. Break my target audience into segments according to unique characteristics. These characteristics could include things like: Age, Sex, Location, Employment, Income, Education level, Household size.\nEach segment should be defined by a deep underlying category-related need. Give each segment an emoji and a sassy title. Describe each segment\u2019s category-related needs and give innovative ideas for specific initiatives they could do to better meet the needs of that segment.\n\n[PRODUCT OR SERVICE]: {{param}}\n\n[SEGMENTS]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[SEGMENTS]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "complete-branding-guide",
              category: "Marketing",
              title: "Complete branding guide",
              description: "Forge an extensive brand identity for your product."
            },
            steps: [
              {
                type: "ask",
                param: "information",
                message: "Please provide information about a company or product. Hit Enter to parse info from the web page:",
                default: "{{page}}"
              },
              {
                type: "ask",
                param: "mission",
                message: "What's your company / product's core mission? Press Enter to skip:",
                default: "Assume based on the description of the product or company."
              },
              {
                type: "gpt",
                prompt: `Please ignore all previous instructions.
You are a marketing researcher and business developer that speaks and writes fluent {{language}}.
Your task is to generate a detailed branding identity for my company or product.
Please do not use general phrases, provide a specific response based on the business described by me. Try to use professional vocabulary.

Output framework (the output should be in rendered format):
" ## Introduction
### Company's History
text
### Mission
text
### Vision
text
### Core Values
text

## Brand Strategy
### Strategic Direction
text
### Target Audience
text
### Positioning Statement
text
### Unique Selling Proposition
text
### Brand Promise
text
### Value Proposition
text

## Brand Identity
### Logo idea
text
### Color Palette
Our primary colors are ________ (RGB: __, __, __; CMYK: __, __, __, __; HEX: #__; PMS: __) and ______ (RGB: __, __, __; CMYK: __, __, __, __; HEX: #__; PMS: __). These colors represent [x] (color name) and [y] (color name).
### Typography
text
### Imagery
text
### Graphics and Iconography
text

## Tone of Voice and Messaging
### Tone
text
### Style
text
### Language
text

## Brand Architecture
### Products
text
### Sub-brands
text

## Packaging Guidelines**
### Style, Colors, Materials, and Layout:
a.
b.
c.
### Physical Environment
text

## Retail Locations, Office Environments:
a.
b.
c.

## Digital Guidelines
### Website, Social Media Profiles, Email Templates, Digital Advertising, Mobile Apps:
a.
b.
c.

## Templates and Examples
### Properly Executed Materials
- Business Cards:
- Letterhead:
- PowerPoint Presentations:
- Newsletters/Social Media Posts:

## Merchandise and Promotional Material Guidelines
### Look and Feel of Merchandise and Promotional Materials:

## Brand Implementation Roadmap
### Brand Rollout Plan:

## Brand Dos and Don\u2019ts
### Do's:
- bullet points
### Don't-s:
- bullet points

## Legal and Trademark Guidelines
### Correct Trademark Usage and Legal Considerations
a.
b.
c.

## Brand Evolution Guidelines
### Brand Evolution Over Time
- bullet points
"

[MY COMPANY]: {{information}}

[MY CORE MISSION]: {{mission}}

BRANDING GUIDE:
`
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS]. Provide a rewritten Branding Guide.\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\nBRANDING GUIDE:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "content-calendar",
              title: "Content calendar",
              category: "Marketing",
              description: "Get a well organized content calendar for 1 week or month, that targets your keyword or topic."
            },
            steps: [
              {
                type: "ask",
                param: "option",
                options: [
                  { label: "\u{1F4C5} WEEKLY CALENDAR", value: "weekly" },
                  { label: "\u{1F4C6} MONTHLY CALENDAR", value: "monthly" }
                ]
              },
              {
                ask: "topic",
                message: "Insert the primary keyword(s) or topic(s) for the marketing calendar:\n"
              },
              {
                condition: "{{option}} = weekly",
                gpt: "Please ignore all previous instructions. I want you to respond only in language {{language}}.\nI want you to help me optimize a blog for local SEO using organic content creation. Please act as a SEO and Digital Ads Specialist to analyse my [TOPIC] and create a 1 week content calendar.\nYour task is to create a list of 5 items, each item is a blog post idea for a day of the work-week.\nFormat your response using headings (H2, H3, H4), numbered and bullet points, and other markdown formatting features.\nEvery item must contain 4 sub-items: - Post title (for that day of the week) - Summary - Outline - Image description\n\n[TOPIC]:\n{{topic}}\n\n[WEEKLY CONTENT CALENDAR]:"
              },
              {
                condition: "{{option}} = monthly",
                gpt: "Please ignore all previous instructions.\nI want you to respond only in language {{language}}.\nI'd like you to help me come up with a content schedule for my blog that has the best chance of helping me rank for long tail keywords that are specific to my keyword. I'll write you my main target keyword(s) or topic(s) below.\n\nPlease organize each blog post title in a nice looking table so that it looks like a calendar. Each week should have its own table.\n\nFirst column - Day of the Week\nSecond column - Post Idea\nThird column - Post Type\nFourth column - Image/Video Description\n\nEXAMPLE OUTPUT:\n## Week #1\nTable with Content Ideas\n\n\n[KEYWORD(S) AND/OR TOPIC(S)]: {{topic}}\n\n[MONTHLY CONTENT CALENDAR]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { label: "\u{1F4A1} CONTENT IDEAS", value: "ideas" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = ideas",
                type: "command",
                name: "Content ideas generator"
              },
              { condition: "{{change}} = ideas", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[WEEKLY CONTENT CALENDAR]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "digital-strategy-generator",
              title: "Digital strategy generator",
              category: "Marketing",
              description: "Generate high level Digital Strategy for the given topic, service, product or business. Get a list of channels, actions and KPIs."
            },
            steps: [
              {
                say: "Product, service, company or brand description. Leave blank to parse from the web page:\n"
              },
              { ask: "product", default: "{{page}}" },
              {
                say: "Audience. Leave blank to deduce the audience automatically\n"
              },
              {
                ask: "audience",
                default: "Please assume or deduce automatically from the description given above.\n"
              },
              {
                gpt: "Please ignore all previous instructions. I want you to act as a market research and digital marketing expert that speaks and writes fluent {{language}}.\nPretend that you know everything about digital strategy and digital channels.\nI will give you a product / company / service / brand description or a relevant web page content.\nYour task is to create a table of the 8 main, innovative or disruptive digital marketing channels (with one unique emoji to describe each channel in the first column) I should consider to help my brand engage my target audience and increase customer acquisition.\nPlease include a column with the main actions to be conducted and another column for the KPIs for each action.\nOrganize each channel starting with the one that you think will be the most important for my brand and end with the one that will be least important. Do not self reference.\n[PRODUCT / COMPANY / SERVICE / BRAND DESCRIPTION, OR A WEB PAGE CONTENT TO PARSE FROM]:\n{{product}}\n\n[TARGET AUDIENCE]:\n{{audience}}\n\n[CHANNELS]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[CHANNELS]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "marketing-campaign-ideas",
              category: "Marketing",
              title: "Marketing campaign ideas",
              description: "Create 10 marketing campaign ideas. Describe your business, target audience and get results."
            },
            steps: [
              {
                type: "ask",
                param: "product",
                message: "Please provide information about your product, or press Enter to parse information from the page:",
                default: "{{page}}"
              },
              {
                type: "ask",
                param: "ta",
                message: "Who is the target audience? Press Enter to skip this step.",
                default: "No specific instructions"
              },
              {
                type: "ask",
                param: "information",
                message: "Please provide some extra information, or press Enter to skip this step. E.g.: The budget is 1000 USD.",
                default: "No specific instructions"
              },
              {
                type: "gpt",
                prompt: 'Please ignore all previous instructions. The output should be in {{language}}.\n\nI want you to act as a Marketing Professional. Provide me with a list of 10 potential marketing campaign ideas and strategies that could be used to increase sales and customer engagement. Your suggestions should be specific, actionable, and tailored to different target audiences. Do not provide detailed implementation plans, focus on the general concept and key selling points.\nPlease tell me the approximate cost of each marketing company to attract 1000 clients, buyers, or users.\n\n[IDEA FRAMEWORK]:\n"\n## [Marketing campaign title]\n[General concept]. [Suggestions and key selling points]. [Approximate cost per 1000 new clients].\n"\n\n[PRODUCT]: {{product}}\n\n[TARGET AUDIENCE]: {{ta}}\n\n[ADDITIONAL INFORMATION]: {{information}}\n\n[LIST OF POTENTIAL MARKETING CAMPAIGN IDEAS]:'
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[LIST OF POTENTIAL MARKETING CAMPAIGN IDEAS]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "content-ideas-generator",
              title: "Content ideas generator",
              category: "Marketing",
              description: "Generate a list of content ideas for a business, product or service for a blog."
            },
            steps: [
              {
                say: "Enter product / service / business name and short description, or press Enter to parse from page:\n"
              },
              { ask: "param", default: "{{page}}" },
              {
                gpt: "Please ignore all previous instructions. I want you to respond only in {{language}}.\nI will provide a product / service / business description or name and I want you to create a list of 25 content ideas that I can publish on the blog.\nInclude a mix of guides, tutorials, success stories, evergreen content, explainers, unpopular opinions, comparisons, and listicles. Categorize each of these ideas into these content types in a table format.\nProvide the answer, don't write general phrases and don't echo my command.\nAfter generating the table, make a conclusion about the three best content options for my task. Tell me which one you would choose to start with and why.\n\n[BUSINESS / PRODUCT / SERVICE DESCRIPTION]: {{param}}\n\n[CONTENT IDEAS]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { label: "\u{1F4C6} WEEKLY CALENDAR", value: "calendar-weekly" },
                  { label: "\u{1F4C6} MONTHLY CALENDAR", value: "calendar-monthly" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = calendar-weekly",
                type: "command",
                name: "Weekly content calendar"
              },
              { condition: "{{change}} = calendar-weekly", type: "stop" },
              {
                condition: "{{change}} = calendar-monthly",
                type: "command",
                name: "Monthly content calendar"
              },
              { condition: "{{change}} = calendar-monthly", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier: [BUSINESS / PRODUCT / SERVICE DESCRIPTION] and [ADDITIONAL INSTRUCTIONS]. Provide a rewritten response.\n\n[BUSINESS / PRODUCT / SERVICE DESCRIPTION]: {{param}}\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[CONTENT IDEAS]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "google-business-posts-writer",
              category: "Marketing",
              title: "Google Business posts writer",
              description: "Get SEO optimized Google Business Posts for your Google Business Profile."
            },
            steps: [
              {
                say: "Business / product name and description. You might add keywords you want to target:\n"
              },
              { ask: "param" },
              {
                gpt: "Please ignore all previous instructions. I want you to respond only in {{language}}.\nPlease pretend you are a local SEO expert.\nYour task is to help me create 5 local SEO optimized Google Business Profile posts for the following business written in the first person.\nGoogle Business Profile post must be at least 5 sentences long to be good, and should end with a call to action. Each business post should use at least 7 keywords in a natural sounding way in different sentences. The posts should not mention discounts or new products.\nEvery post should have a title and a markdown code block with the post itself, enclosed into code-block quotes. Do not echo my prompt.\nHere is an example of a single post output\n\n## Post #1\n```markdown\n\npost text\n\n```\n\n[BUSINESS OR PRODUCT NAME DESCRIPTION]:\n{{param}}\n\n[5 GOOGLE BUSINESS POSTS]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[5 GOOGLE BUSINESS POSTS]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "sales-pitch-writer",
              category: "Marketing",
              title: "Sales pitch writer",
              description: "Write enticing, personable and humorous sales pitches and emails."
            },
            steps: [
              {
                type: "ask",
                param: "p1",
                message: "Provide information about the product or service or pick an option.",
                default: "{{page}}",
                optionsInvalid: false,
                options: [
                  { label: "\u2733\uFE0F FIND ON WEBPAGE", value: "{{page}}" },
                  { label: "\u{1F4F8} CAPTURE AREA", value: "capture" },
                  "$custom"
                ]
              },
              {
                condition: "{{p1}} = capture",
                label: "PAGE SCREENSHOT",
                type: "ask",
                param: "p1",
                message: "",
                default: "{{page}}",
                optionsInvalid: false,
                options: null,
                vision: {
                  enabled: true,
                  mode: "area",
                  hint: "Capture a webpage area to analyze.",
                  send: true
                }
              },
              {
                type: "ask",
                param: "p2",
                message: "What should I pay special attention to? Press Enter to skip this step.",
                default: "No specific instructions."
              },
              {
                type: "gpt",
                prompt: 'Please ignore all previous instructions.\nThe output should be in {{language}}.\n\nI want you to act as a professional pitch writer and marketer.\nI will provide you with information about my product or service. Assume the rest of the necessary information yourself.\n\nI want you to write 3 different sales pitches that will help me better present my product. A sales pitch should include a simple yet thorough explanation of what the product is and how it can help your prospect.\n\nEvery pitch should have a title and a markdown code block with the pitch itself, enclosed into code-block quotes. Do not echo my prompt.\n\nOutput frameworks:\n\n**Pitch #1 "[main idea]"**\n```markdown\nWhen I first started [business], I found a common issue: People needed [solution].\nFor [time period], I\u2019ve been [specializing/provding] just that. [State how]. I also [additional differentiator/advantage].\nWith this [three adjectives to sum up the above], my customers not only [benefit #1], but they also [benefit #2].\n[CTA].\n```\n\n**Pitch #2 "[main idea]"**\n```markdown\nBetween [pain point] and [pain point], [goal] is a challenge no one should have to face alone.\nI help [target personas] [achieve goal] through a combination of [product/service], [product/service], and [product service]. Not only [differentiator #1], but [differentiator #2], so you can [benefit].\nOver [X customers] have [achieved goal] with my [help], and you can too.\n[CTA].\n```\n\n**Pitch #3 "[main idea]"**\n```markdown\nFor many [target customers], it\u2019s not the [common/obvious pain point], but rather the [pain point your competitors don\u2019t solve] that is most [painful].\nBut not at [your business]. In addition to {feature #1} {feature #2} and you can even {feature #3}.\nIntrigued? Our [x] five-star reviews will tell you more, but you really have to experience it for yourself to see just how [adjective] and [adjective] [achieving goal] can be.\n[CTA].\n```\n\n[INFORMATION ABOUT MY PRODUCT OR SERVICE]: {{p1}}\n\n[INSTRUCTIONS]: {{p2}}\n\n[3 DIFFERENT SALES PITCHES]:'
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "How would you like to refine the output?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please rewrite your answer, taking into account the inputs provided earlier and [Additional Instructions]. Provide a new list of 3 different sales pitches.\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[3 DIFFERENT SALES PITCHES]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "article-creator",
              title: "Article creator",
              category: "Copywriting",
              description: "Generate entire article, starting from outline down to section content, following a writing framework."
            },
            steps: [
              {
                label: "ask-for-task",
                type: "ask",
                message: "What would you like me to write?\n",
                param: "task",
                options: [
                  { label: "ENTIRE ARTICLE", value: "entire-article" },
                  { label: "ARTICLE SECTION", value: "article-section" }
                ]
              },
              {
                condition: "{{task}} = article-section",
                label: "SECTION",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    message: "Copy-paste section title or outline for me to write:\n",
                    param: "outline"
                  },
                  {
                    type: "ask",
                    param: "style",
                    message: "Pick an article style or type custom instructions. Read about [writing styles in this guide](https://harpa.ai/guides/writing-styles).",
                    options: [
                      {
                        label: "\u{1F197} STANDARD",
                        value: "Standard Article: Using Headings and Subheadings (H1, H2, H3, H4)."
                      },
                      {
                        label: "\u{1F4E3} AIDA",
                        value: "AIDA (Attention Interest Desire Action) writing framework"
                      },
                      {
                        label: "\u{1F4A1} PAS",
                        value: "PAS (Problem Agitate Solve) writing framework"
                      },
                      { label: "\u{1F3AF} 5W1H", value: "5W1H writing framework" },
                      {
                        label: "\u{1F4A1} SWOT",
                        value: "SWAT Analysis (Strengths, Weaknesses, Opportunities, Threats) writing framework"
                      },
                      {
                        label: "\u{1F309} BAB",
                        value: "Before-After-Bridge writing framework"
                      },
                      {
                        label: "\u{1F4DA} PASTOR",
                        value: "Problem-Amplify-Solution-Testimonials-Offer-Response writing framework"
                      },
                      {
                        label: "\u{1F393}\u200D\uFE0F FAB",
                        value: "Features-Advantages-Benefits writing framework"
                      },
                      {
                        label: "\u{1F53A} PYRAMID",
                        value: "Pyramid Principle writing framework, start by presenting the most critical information (the main point) at the beginning, followed by supporting details and explanations arranged in a hierarchical structure"
                      },
                      {
                        label: "\u{1F61A} KISS",
                        value: "KISS (Keep It Simple, Stupid) writing framework. Avoid unnecessary jargon, complexity, and verbosity."
                      },
                      {
                        label: "\u{1F4DD} PEEL",
                        value: "PEEL (Point, Explanation, Evidence, Link) writing framework that begins by making a point, followed by an explanation of the point, the provision of evidence to support the claim, and finally, linking the point to the broader context or theme."
                      },
                      {
                        label: "\u2B50 STAR",
                        value: "STAR (Situation, Task, Action, Result) writing framework"
                      },
                      {
                        label: "\u{1F985} SOAR",
                        value: "SOAR (Situation, Obstacles, Actions, Results) writing framework"
                      },
                      {
                        label: "\u{1F3DB}\uFE0F TOULMIN",
                        value: "Toulmin Model writing framework: firstly establish a claim, then support it with evidence (grounds), and finally build a logical and persuasive case through warrants, which connect the evidence to the claim."
                      },
                      {
                        label: "\u{1F4C8} SCIPAB",
                        value: "SCIPAB (Situation, Complication, Implication, Position, Action, Benefit) writing framework"
                      },
                      {
                        label: "\u{1F393}\u200D\uFE0F HARVARD",
                        value: "Harvard writing framework, use headings and sub headings (H1, H2, H3, H4)"
                      },
                      {
                        label: "\u{1F575}\uFE0F\u200D\uFE0F OPINION",
                        value: '"Opinion Writing" framework: express different opinions on a given topic'
                      },
                      { label: "\u{1F92A} GONZO", value: "GONZO writing framework" },
                      {
                        label: "\u{1F5E3}\uFE0F PREP",
                        value: "PREP (Point, Reason, Example, Point) writing framework"
                      },
                      { value: "$custom" }
                    ],
                    default: "",
                    optionsInvalid: false
                  },
                  {
                    type: "ask",
                    param: "keywords-section",
                    message: "Would you like to add specific keywords to the section?\n",
                    options: [
                      { label: "\u26D4\uFE0F NO", value: "-" },
                      { label: "\u2705 YES", value: "add-keywords" }
                    ]
                  },
                  {
                    condition: "{{keywords-section}} = add-keywords",
                    label: "SECTION KEYWORDS",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        message: "Extract keywords from the SERP?\n",
                        param: "section-kw-option",
                        options: [
                          { label: "\u{1F50D} LSI KW FROM SERP", value: "serp" },
                          { label: "\u{1F4CC} PASTE MY KEYWORDS", value: "paste" }
                        ]
                      },
                      {
                        condition: "{{section-kw-option}} = serp",
                        type: "group",
                        steps: [
                          {
                            type: "ask",
                            message: "Enter a relevant Google Search query to extract keywords from the Search Engine Results Page (SERP).",
                            param: "query",
                            default: ""
                          },
                          {
                            type: "say",
                            message: "\u23F3 Extracting keywords. Please wait a bit..."
                          },
                          {
                            type: "gpt",
                            prompt: "I want you to respond only in {{language}} and output a single table.\nPretend to be a SEO keyword research expert.\nRead the [SERP] that I will provide you and find top 20 LSI keywords in SERP, each containing at least 2 words:\n- Output these keywords comma separated.\n- Do not include keywords in the list that are not thematically relevant to my query.\n- Do not add any notes, write only comma separated keywords.\n- Do not echo my prompt.\n\n\n[SERP]:\n{{serp {{query}}}}\n\n[KEYWORDS]:",
                            param: "keywords-list"
                          }
                        ]
                      },
                      {
                        condition: "{{section-kw-option}} = paste",
                        type: "group",
                        steps: [
                          {
                            type: "ask",
                            message: "Type in keywords, comma separated:\n",
                            param: "keywords-list"
                          }
                        ]
                      }
                    ]
                  },
                  {
                    label: "SECTION WRITER",
                    type: "gpt",
                    param: "content",
                    prompt: "Please ignore all previous instructions.\nI want you to act as a very proficient SEO and high end copy writer that speaks and writes fluent {{language}}.\nYour task is to write a high-quality article section content for the title or outline given below.\n- Write a single article section for me.\n- Do not write the whole article on the given topic.\n- Format the text using headings and subheadings (H2, H3, H4), bullet points, and other visual formatting methods. Do not use H1 headings.\n- Display the text in rendered format.\n- Add keywords in the text, but not in the headings. If I give you some keywords that you dont understand, please rephrase them while using as many of the original words as possible.\n- If I provide a specific request, and not a list of keywords, please analyze the request and include relevant keywords in the text.\n\n[FOLLOW THE SECTION STYLE}: {{style}}\n\n[ARTICLE SECTION TITLE OR OUTLINE TO WRITE]:\n{{outline}}\n\n[INCLUDE FOLLOWING KEYWORDS TO THE ARTICLE SECTION]:\n{{keywords-list}}\n\nArticle section:"
                  },
                  { type: "jump", to: "ask-refine-section" }
                ]
              },
              {
                condition: "{{task}} = entire-article",
                label: "ENTIRE ARTICLE",
                type: "group",
                steps: [
                  {
                    type: "say",
                    message: "Should I generate an outline for you or do you have one already?"
                  },
                  {
                    type: "ask",
                    param: "outline-selection",
                    options: [
                      { label: "GENERATE OUTLINE", value: "outline-generator" },
                      { label: "CUSTOM OUTLINE", value: "custom-outline" }
                    ]
                  },
                  {
                    condition: "{{outline-selection}} = outline-generator",
                    type: "ask",
                    param: "param",
                    message: "What the article should be about? Leave empty and press Enter for me to deduce article topic from the opened page.\n",
                    default: "{{page}}"
                  },
                  {
                    condition: "{{outline-selection}} = custom-outline",
                    label: "CUSTOM OUTLINE",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        message: "Please copy-paste article outline:\n",
                        param: "outline"
                      },
                      {
                        type: "ask",
                        param: "style",
                        message: "Pick an article style or type custom instructions. Read about [writing styles in this guide](https://harpa.ai/guides/writing-styles).",
                        options: [
                          {
                            label: "\u{1F197} STANDARD",
                            value: "Standard Article: Using Headings and Subheadings (H1, H2, H3, H4)."
                          },
                          {
                            label: "\u{1F4E3} AIDA",
                            value: "AIDA (Attention Interest Desire Action) writing framework"
                          },
                          {
                            label: "\u{1F4A1} PAS",
                            value: "PAS (Problem Agitate Solve) writing framework"
                          },
                          { label: "\u{1F3AF} 5W1H", value: "5W1H writing framework" },
                          {
                            label: "\u{1F4A1} SWOT",
                            value: "SWAT Analysis (Strengths, Weaknesses, Opportunities, Threats) writing framework"
                          },
                          {
                            label: "\u{1F309} BAB",
                            value: "Before-After-Bridge writing framework"
                          },
                          {
                            label: "\u{1F4DA} PASTOR",
                            value: "Problem-Amplify-Solution-Testimonials-Offer-Response writing framework"
                          },
                          {
                            label: "\u{1F393}\u200D\uFE0F FAB",
                            value: "Features-Advantages-Benefits writing framework"
                          },
                          {
                            label: "\u{1F53A} PYRAMID",
                            value: "Pyramid Principle writing framework, start by presenting the most critical information (the main point) at the beginning, followed by supporting details and explanations arranged in a hierarchical structure"
                          },
                          {
                            label: "\u{1F61A} KISS",
                            value: "KISS (Keep It Simple, Stupid) writing framework. Avoid unnecessary jargon, complexity, and verbosity."
                          },
                          {
                            label: "\u{1F4DD} PEEL",
                            value: "PEEL (Point, Explanation, Evidence, Link) writing framework that begins by making a point, followed by an explanation of the point, the provision of evidence to support the claim, and finally, linking the point to the broader context or theme."
                          },
                          {
                            label: "\u2B50 STAR",
                            value: "STAR (Situation, Task, Action, Result) writing framework"
                          },
                          {
                            label: "\u{1F985} SOAR",
                            value: "SOAR (Situation, Obstacles, Actions, Results) writing framework"
                          },
                          {
                            label: "\u{1F3DB}\uFE0F TOULMIN",
                            value: "Toulmin Model writing framework: firstly establish a claim, then support it with evidence (grounds), and finally build a logical and persuasive case through warrants, which connect the evidence to the claim."
                          },
                          {
                            label: "\u{1F4C8} SCIPAB",
                            value: "SCIPAB (Situation, Complication, Implication, Position, Action, Benefit) writing framework"
                          },
                          {
                            label: "\u{1F393}\u200D\uFE0F HARVARD",
                            value: "Harvard writing framework, use headings and sub headings (H1, H2, H3, H4)"
                          },
                          {
                            label: "\u{1F575}\uFE0F\u200D\uFE0F OPINION",
                            value: '"Opinion Writing" framework: express different opinions on a given topic'
                          },
                          { label: "\u{1F92A} GONZO", value: "GONZO writing framework" },
                          {
                            label: "\u{1F5E3}\uFE0F PREP",
                            value: "PREP (Point, Reason, Example, Point) writing framework"
                          },
                          { value: "$custom" }
                        ],
                        default: "",
                        optionsInvalid: false
                      },
                      {
                        type: "calc",
                        func: "set",
                        param: "outline",
                        format: "",
                        value: "{{outline}}\n\n[FOLLOW THE ARTICLE STYLE}: {{style}}"
                      },
                      { type: "jump", to: "ask-for-keywords" }
                    ]
                  },
                  {
                    type: "ask",
                    message: "Pick an article style or type custom instructions. Read about [writing styles in this guide](https://harpa.ai/guides/writing-styles).\n",
                    param: "style",
                    options: [
                      {
                        label: "\u{1F197} STANDARD",
                        value: "Standard Article: Using Headings and Subheadings (H1, H2, H3, H4)."
                      },
                      {
                        label: "\u{1F4E3} AIDA",
                        value: "AIDA (Attention Interest Desire Action) writing framework"
                      },
                      {
                        label: "\u{1F4A1} PAS",
                        value: "PAS (Problem Agitate Solve) writing framework"
                      },
                      { label: "\u{1F3AF} 5W1H", value: "5W1H writing framework" },
                      {
                        label: "\u{1F4A1} SWOT",
                        value: "SWAT Analysis (Strengths, Weaknesses, Opportunities, Threats) writing framework"
                      },
                      {
                        label: "\u{1F309} BAB",
                        value: "Before-After-Bridge writing framework"
                      },
                      {
                        label: "\u{1F4DA} PASTOR",
                        value: "Problem-Amplify-Solution-Testimonials-Offer-Response writing framework"
                      },
                      {
                        label: "\u{1F393}\u200D\uFE0F FAB",
                        value: "Features-Advantages-Benefits writing framework"
                      },
                      {
                        label: "\u{1F53A} PYRAMID",
                        value: "Pyramid Principle writing framework, start by presenting the most critical information (the main point) at the beginning, followed by supporting details and explanations arranged in a hierarchical structure"
                      },
                      {
                        label: "\u{1F61A} KISS",
                        value: "KISS (Keep It Simple, Stupid) writing framework. Avoid unnecessary jargon, complexity, and verbosity."
                      },
                      {
                        label: "\u{1F4DD} PEEL",
                        value: "PEEL (Point, Explanation, Evidence, Link) writing framework that begins by making a point, followed by an explanation of the point, the provision of evidence to support the claim, and finally, linking the point to the broader context or theme."
                      },
                      {
                        label: "\u2B50 STAR",
                        value: "STAR (Situation, Task, Action, Result) writing framework"
                      },
                      {
                        label: "\u{1F985} SOAR",
                        value: "SOAR (Situation, Obstacles, Actions, Results) writing framework"
                      },
                      {
                        label: "\u{1F3DB}\uFE0F TOULMIN",
                        value: "Toulmin Model writing framework: firstly establish a claim, then support it with evidence (grounds), and finally build a logical and persuasive case through warrants, which connect the evidence to the claim."
                      },
                      {
                        label: "\u{1F4C8} SCIPAB",
                        value: "SCIPAB (Situation, Complication, Implication, Position, Action, Benefit) writing framework"
                      },
                      {
                        label: "\u{1F393}\u200D\uFE0F HARVARD",
                        value: "Harvard writing framework, use headings and sub headings (H1, H2, H3, H4)"
                      },
                      {
                        label: "\u{1F575}\uFE0F\u200D\uFE0F OPINION",
                        value: '"Opinion Writing" framework: express different opinions on a given topic'
                      },
                      { label: "\u{1F92A} GONZO", value: "GONZO writing framework" },
                      {
                        label: "\u{1F5E3}\uFE0F PREP",
                        value: "PREP (Point, Reason, Example, Point) writing framework"
                      },
                      { value: "$custom" }
                    ]
                  },
                  {
                    type: "gpt",
                    prompt: "Please ignore all previous instructions. The output should be in {{language}}.\nI want you to act as a very proficient SEO and high end copywriter. Using the framework that I mention later, please create a detailed long-form content outline for our writers. The article can have a numbered list (if needed), FAQs (if needed) and conclusion chapter (if needed).\nAll output must be 100% human writing style and free of grammar errors. Do not use generic filler phrases. Do use useful subheadings with keyword-rich titles. Do not repeat the same content over again.\nEach chapter should have numbering; do not leave chapters without numbers, even if it's an introduction, conclusion, or any other introductory or concluding chapter.\nFormat the text using headings (H2, H3, H4) and other markdown formatting features. Do not use H1 headings. Display the text in rendered format.\nIf it is necessary and relevant to the theme of the article and outline, include a list of semantically similar FAQs using the vector representation technique. Please don't write the article, only the outline for writers. Do not echo my prompt.\n\n[OUTPUT STRUCTURE]:\n## Chapter 1. Introduction\n  1.1. [Subchapter title]\n  1.2. [Subchapter title]\n  ... [Add as many subchapters as you deem necessary]\n\n## Chapter 2. Chapter title.\n  2.1. [Subchapter title]\n  2.2. [Subchapter title]\n  ... [Add as many subchapters as you deem necessary]\n\n... Add as many chapters as you deem necessary.\n\n[ARTICLE STYLE / FRAMEWORK]:\n{{style}}\n\n[ARTICLE SHOULD BE ABOUT]:\n{{param}}\n\n[ARTICLE OUTLINE]:",
                    param: "outline"
                  },
                  {
                    type: "calc",
                    func: "list-add",
                    list: "result",
                    item: "outline",
                    index: ""
                  },
                  {
                    label: "refine-outline",
                    type: "ask",
                    param: "outline-change",
                    options: [
                      { label: "\u2705 OK, NEXT ", value: "-" },
                      { label: "\u{1F6E0} EDIT OUTLINE", value: "yes" }
                    ]
                  },
                  {
                    condition: "{{outline-change}} = yes",
                    label: "CHANGE OUTLINE",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "outline-changes",
                        message: "What would you like to change? E.g.: Delete Chapter 2.\n"
                      },
                      {
                        type: "gpt",
                        prompt: "I would like you to make changes to the Outline you have just written. Please do not output anything but the revised Outline. Do not echo my command.\nIf I said to delete a certain chapter or a subchapter, you should delete only that one, renumbering the remaining chapters considering such deletion.\n[CHANGES TO MAKE]: {{outline-changes}}\n\n[REWRITTEN OUTLINE]:",
                        param: "outline"
                      },
                      {
                        type: "calc",
                        func: "list-update",
                        list: "result",
                        match: '{ "id": 0 }',
                        prop: "done"
                      },
                      { type: "jump", to: "refine-outline" }
                    ]
                  },
                  {
                    label: "ask-for-keywords",
                    type: "ask",
                    param: "keywords",
                    message: "Would you like me to add specific keywords (e.g. SEO keywords) to the Article?\n",
                    options: [
                      { label: "\u26D4\uFE0F NO", value: "-" },
                      { label: "\u2705 YES", value: "add-keywords" }
                    ]
                  },
                  {
                    condition: "{{keywords}} = add-keywords",
                    label: "ADD KEYWORDS TO ARTICLE",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "article-kw-option",
                        options: [
                          { label: "\u{1F50D} LSI KW FROM SERP", value: "serp" },
                          { label: "\u{1F4CC} PASTE MY KEYWORDS", value: "paste" }
                        ],
                        message: "Extract keywords from the SERP?\n"
                      },
                      {
                        condition: "{{article-kw-option}} = serp",
                        type: "group",
                        steps: [
                          {
                            type: "ask",
                            message: "Enter a relevant Google Search query to extract keywords from the Search Engine Results Page (SERP).",
                            param: "query",
                            default: ""
                          },
                          {
                            type: "say",
                            message: "\u23F3 Extracting keywords. Please wait a bit..."
                          },
                          {
                            type: "gpt",
                            prompt: "I want you to respond only in {{language}} and output a single table.\nPretend to be a SEO keyword research expert.\nRead the [SERP] that I will provide you and find top 20 LSI keywords in SERP, each containing at least 2 words:\n- Output these keywords comma separated.\n- Do not include keywords in the list that are not thematically relevant to my query.\n- Do not add any notes, write only comma separated keywords.\n- Do not echo my prompt.\n\n\n[SERP]:\n{{serp {{query}}}}\n\n[KEYWORDS]:",
                            param: "keywords-list"
                          }
                        ]
                      },
                      {
                        condition: "{{article-kw-option}} = paste",
                        type: "group",
                        steps: [
                          {
                            type: "ask",
                            param: "keywords-list",
                            message: "Type in keywords, comma separated:\n"
                          }
                        ]
                      }
                    ]
                  },
                  {
                    label: "ask-for-change",
                    type: "ask",
                    message: "All set! I can write large article chapter by chapter, or write a small article in one go.\n",
                    param: "change",
                    options: [
                      {
                        label: "\u27A1\uFE0F WRITE FIRST CHAPTER",
                        value: "compose-by-chapters"
                      },
                      {
                        label: "*\uFE0F\u20E3 WRITE ENTIRE ARTICLE",
                        value: "compose-entire-article"
                      },
                      { label: "\u{1F6D1} STOP", value: "no" }
                    ]
                  },
                  { condition: "{{change}} = no", type: "stop" },
                  {
                    condition: "{{change}} = compose-by-chapters",
                    label: "CHAPTER BY CHAPTER",
                    type: "group",
                    steps: [
                      {
                        type: "gpt",
                        prompt: 'I want you to write me a single chapter from the Article Outline you proposed. Act as a professional copywriter and SEO specialist, use professional vocabulary related to the theme of the chapter and selected style. The output should be in {{language}}.\nWrite the chapter in such a way that its text does not touch on the topics of other chapters from the Article Outline. If appropriate, format the text using headings (H2, H3, H4), numbered and bullet points, and other markdown formatting features. Do not use H1 headings. Display the text in rendered format.\nDo not explain your choice of writing style, do not echo my prompt.\nDo not write any Notes for me in the end. Exclude Notes from the text. Do not write such phrases at the beginning or at the end: "Stay tuned for the next chapter...", "In this chapter, we..", "This chapter explores" or "In the next chapter, we will..". I only need the chapter text and nothing more.\n\n[CHAPTER THAT NEEDS TO BE WRITTEN]:\nWrite the first chapter mentioned in outline, or Introduction chapter if present.\n\n[ENTIRE ARTICLE OUTLINE]:\n{{outline}}\n\n[INCLUDE FOLLOWING KEYWORDS TO THE CHAPTER]:\n{{keywords-list}}\n\n[GENERATED CHAPTER]:',
                        param: "gpt"
                      },
                      {
                        type: "calc",
                        func: "clone",
                        to: "last-chapter",
                        from: "gpt"
                      },
                      {
                        type: "calc",
                        func: "list-add",
                        item: "gpt",
                        list: "result",
                        index: ""
                      }
                    ]
                  },
                  {
                    condition: "{{change}} = compose-entire-article",
                    label: "1 STEP ARTICLE",
                    type: "group",
                    steps: [
                      {
                        type: "gpt",
                        prompt: "Please ignore all previous instructions. The output should be in {{language}}.\nI want you to act as a very proficient SEO and high end copy writer that speaks and writes fluent {{language}}.\nYour task is to write a high-quality article with very detailed paragraphs. Get to the point precisely and accurately.\nAdd keywords in the text, but not in the headings. If I give you some keywords that you dont understand, please rephrase them while using as many of the original words as possible.\nIf I provide a specific request, and not a list of keywords, please analyze the request and include relevant keywords in the text.\nFormat the article using headings and subheadings (H2, H3, H4) and other visual formatting methods. Do not use H1 headings. Display the text in rendered format.\n\n[ENTIRE ARTICLE OUTLINE]:\n{{outline}}\n\n[INCLUDE FOLLOWING KEYWORDS TO THE ARTICLE]:\n{{keywords-list}}\n\n[ARTICLE STYLE]:\n{{style}}\n\nDo not echo my prompt. Follow the instructions and write an article.\nArticle:",
                        param: "content"
                      },
                      { type: "jump", to: "ask-refine-section" }
                    ]
                  },
                  {
                    condition: "{{change-option}} = $custom",
                    label: "CUSTOM",
                    type: "group",
                    steps: [
                      { type: "gpt", prompt: "{{change}}", param: "outline" },
                      { type: "jump", to: "ask-for-change" }
                    ]
                  },
                  {
                    label: "ask-for-next",
                    type: "ask",
                    param: "next",
                    options: [
                      { label: "\u27A1\uFE0F WRITE NEXT CHAPTER", value: "next-chapter" },
                      {
                        label: "\u{1F500} WRITE SPECIFIC CHAPTER",
                        value: "specific-chapter"
                      },
                      { label: "\u{1F3AF} ADD KEYWORDS", value: "keywords-to-chapter" },
                      { label: "\u{1F9F2} ADD EXTERNAL LINKS", value: "links" },
                      { label: "\u2734\uFE0F REFINE", value: "refine-chapter" },
                      { label: "\u{1F3AD} MIMIC MY TONE", value: "mimic" },
                      { label: "\u2328\uFE0F PASTE TO PAGE", value: "paste" },
                      { label: "\u{1F4D7} SHOW ARTICLE", value: "result" },
                      { label: "\u{1F6D1} STOP", value: "no" }
                    ]
                  },
                  { condition: "{{next}} = no", type: "stop" },
                  {
                    condition: "{{next}} = paste",
                    type: "paste",
                    close: true,
                    text: "{{gpt}}"
                  },
                  {
                    condition: "{{next}} = result",
                    label: "RESULT",
                    type: "group",
                    steps: [
                      {
                        type: "calc",
                        func: "list-join",
                        delimiter: "\n\n",
                        list: "result",
                        to: "resultJoined"
                      },
                      { type: "say", message: "{{resultJoined}}" }
                    ]
                  },
                  {
                    condition: "{{next}} = next-chapter",
                    label: "NEXT CHAPTER",
                    type: "group",
                    steps: [
                      {
                        type: "calc",
                        func: "first-line",
                        to: "firstLine",
                        param: "gpt"
                      },
                      {
                        type: "gpt",
                        prompt: 'I want you to write me a single chapter from the Article Outline you proposed. Act as a professional copywriter and SEO specialist, use professional vocabulary related to the theme of the chapter and selected style. The output should be in {{language}}.\nWrite the chapter in such a way that its text does not touch on the topics of other chapters from my Article Outline. If appropriate, format the text using headings (H2, H3, H4), numbered and bullet points, and other markdown formatting features. Do not use H1 headings. Display the text in rendered format.\nDo not explain your choice of writing style, do not echo my prompt. Do not write any Notes for me in the end. Exclude Notes from the text. Do not write such phrases at the beginning or at the end: "Stay tuned for the next chapter...", "In this chapter, we..", "This chapter explores" or "In the next chapter, we will..". I only need the chapter text and nothing more.\n\n[INCLUDE FOLLOWING KEYWORDS TO THE CHAPTER]:\n{{keywords-list}}\n\n[ARTICLE GENERAL STYLE]:\n{{style}}\n\n[CHAPTER THAT NEEDS TO BE WRITTEN]:\n{{next}}\n\n[ENTIRE ARTICLE OUTLINE]:\n{{outline}}\n\n[PREVIOUS CHAPTER]:\n{{firstLine}}\n\n[GENERATED CHAPTER]:',
                        param: "gpt"
                      },
                      {
                        type: "calc",
                        func: "clone",
                        from: "gpt",
                        to: "last-chapter"
                      },
                      {
                        type: "calc",
                        func: "list-add",
                        item: "gpt",
                        list: "result",
                        index: ""
                      }
                    ]
                  },
                  {
                    condition: "{{next}} = specific-chapter",
                    label: "SPECIFIC CHAPTER",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "chapter-number",
                        message: "Copy and paste a chapter title from the Article Outline, or type its' number:\n"
                      },
                      {
                        type: "gpt",
                        prompt: 'I want you to write me one single chapter from the Article Outline you proposed. Act as a professional copywriter and SEO specialist, use professional vocabulary related to the theme of the chapter and selected style. The output should be in {{language}}.\nWrite the chapter in such a way that its text does not touch on the topics of other chapters from my Article Outline. If appropriate, format the text using headings (H2, H3, H4), numbered and bullet points, and other markdown formatting features. Do not use H1 headings. Display the text in rendered format.\nDo not explain your choice of writing style, do not echo my prompt. Do not write any Notes for me. Exclude Notes from the text. Do not write such phrases at the beginning or at the end: "Stay tuned for the next chapter...", "In this chapter, we..", "This chapter explores" or "In the next chapter, we will..". I only need the chapter text and nothing more.\n\n[INCLUDE FOLLOWING KEYWORDS TO THE CHAPTER]:\n{{keywords-list}}\n\n[ARTICLE GENERAL STYLE]:\n{{style}}\n\n[CHAPTER THAT NEEDS TO BE WRITTEN]:\n{{chapter-number}}\n\n[ENTIRE ARTICLE OUTLINE]:\n{{outline}}\n\n[GENERATED CHAPTER]:',
                        param: "gpt"
                      },
                      {
                        type: "calc",
                        func: "clone",
                        from: "gpt",
                        to: "last-chapter"
                      },
                      {
                        type: "calc",
                        func: "list-add",
                        item: "gpt",
                        list: "result",
                        index: ""
                      }
                    ]
                  },
                  {
                    condition: "{{next}} = keywords-to-chapter",
                    label: "KW TO CHAPTER",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "keyword-option",
                        options: [
                          { label: "\u{1F50D} LSI KW FROM SERP", value: "serp" },
                          { label: "\u{1F4CC} PASTE MY KEYWORDS", value: "paste" }
                        ],
                        message: "Extract keywords from the SERP?\n"
                      },
                      {
                        condition: "{{keyword-option}} = serp",
                        type: "group",
                        steps: [
                          {
                            type: "ask",
                            message: "Enter a relevant Google Search query to extract keywords from the Search Engine Results Page (SERP).",
                            param: "query",
                            default: ""
                          },
                          {
                            type: "say",
                            message: "\u23F3 Extracting keywords. Please wait a bit..."
                          },
                          {
                            type: "gpt",
                            param: "chapter-keywords",
                            prompt: "I want you to respond only in {{language}} and output a single table.\nPretend to be a SEO keyword research expert.\nRead the [SERP] that I will provide you and find top 20 LSI keywords in SERP, each containing at least 2 words:\n- Output these keywords comma separated.\n- Do not include keywords in the list that are not thematically relevant to my query.\n- Do not add any notes, write only comma separated keywords.\n- Do not echo my prompt.\n\n\n[SERP]:\n{{serp {{query}}}}\n\n[KEYWORDS]:"
                          }
                        ]
                      },
                      {
                        condition: "{{keyword-option}} = paste",
                        type: "group",
                        steps: [
                          {
                            type: "ask",
                            param: "chapter-keywords",
                            message: "Type in keywords, comma separated:\n"
                          }
                        ]
                      },
                      {
                        type: "gpt",
                        prompt: 'I would like you to make changes to the chapter you have just written. Please do not output anything but the revised text. Do not echo my command. Do not put quotes around the revised text.\nDo not explain your choice, do not echo my prompt. Do not write any Notes for me. Exclude any Notes from the text. Do not write such phrases at the beginning or at the end: "Stay tuned for the next chapter...", "In this chapter, we..", "This chapter explores" or "In the next chapter, we will..". I only need the rewritten text and nothing more.\nDo not change the chapter titles, subtitles and the text structure, but rewrite the content using Additional keywords. If I provide a specific request as Additional keywords, please analyze the request and include relevant keywords in the text. Add as many keywords from my list as possible. Do not write the added keywords in square brackets.\n[ADDITIONAL KEYWORDS]:\n{{chapter-keywords}}\n\n[CHAPTER]:\n{{last-chapter}}\n\n[REWRITTEN TEXT]:',
                        param: "gpt"
                      },
                      {
                        type: "calc",
                        func: "list-update",
                        list: "result",
                        match: '{ "id": 0 }',
                        prop: "done"
                      }
                    ]
                  },
                  {
                    condition: "{{next}} = refine-chapter",
                    label: "REFINE CHAPTER",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "instructions",
                        message: "What changes would you like me to make?"
                      },
                      {
                        type: "gpt",
                        prompt: 'I would like you to make changes to the text you have just written. Please do not output anything but the revised text. Do not echo my command. Do not put quotes around the revised text.\nDo not explain your choice, do not echo my prompt. Do not write any Notes for me. Exclude any Notes from the text. Do not write such phrases at the beginning or at the end: "Stay tuned for the next chapter...", "In this chapter, we..", "This chapter explores" or "In the next chapter, we will..". I only need the rewritten text and nothing more.\nIf I said to delete a certain chapter or a subchapter, you should delete only that one, renumbering the remaining chapters considering such deletion.\n[CHANGES TO MAKE]: {{instructions}}\n\nRewritten text:',
                        param: "gpt"
                      },
                      {
                        type: "calc",
                        func: "list-update",
                        list: "result",
                        match: '{ "id": 0 }',
                        prop: "done"
                      }
                    ]
                  },
                  {
                    condition: "{{next-option}} = mimic",
                    label: "MIMIC",
                    type: "group",
                    steps: [
                      {
                        type: "gpt",
                        prompt: "I would like you to make changes to the text you have just written. Please do not output anything but the revised text. Do not echo my command. Do not put quotes around the revised text.\n\n[CHANGES TO MAKE]:\nPlease pretend to be me, mimicking my style of communication: {{tone}}\n\n[REWRITTEN TEXT]:",
                        param: "gpt"
                      },
                      {
                        type: "calc",
                        func: "list-update",
                        list: "result",
                        match: '{ "id": 0 }',
                        prop: "done"
                      }
                    ]
                  },
                  {
                    condition: "{{next-option}} = links",
                    label: "ADD URLS",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "ask-urls",
                        message: "Would you like to auto-extract top SERP URLs or provide them yourself?",
                        options: [
                          { label: "\u{1F9F2} EXTRACT FROM SERP", value: "extract" },
                          { label: "\u{1F4CC} PASTE URLs", value: "paste" },
                          "$custom"
                        ],
                        default: ""
                      },
                      {
                        condition: "{{ask-urls}} = extract",
                        label: "AUTO EXTRACT URLS",
                        type: "group",
                        steps: [
                          {
                            condition: "{{query}} != ",
                            type: "ask",
                            param: "ask-reuse",
                            message: "\u267B\uFE0F Reuse your previous '{{query}}' search?",
                            options: [
                              { label: "\u2705 YES", value: "yes" },
                              { label: "\u26D4 NO", value: "no" }
                            ],
                            default: ""
                          },
                          {
                            condition: "{{ask-reuse}} = yes",
                            type: "jump",
                            to: "CALC SERP QUERY"
                          },
                          {
                            type: "ask",
                            message: "Please enter a SERP query, such as 'GTA 6 release date'.",
                            options: null,
                            param: "query",
                            default: ""
                          },
                          {
                            label: "CALC SERP QUERY",
                            type: "calc",
                            func: "set",
                            param: "information",
                            value: "{{serp {{query}}}}",
                            format: ""
                          },
                          {
                            type: "calc",
                            func: "serp.extract-links",
                            to: "array",
                            limit: 8,
                            from: "information"
                          },
                          {
                            type: "js",
                            code: 'let markdownText\n  = `I found top ${args.array.length} URLs from SERP for the query "${args.query}":\\n\\n`\nargs.array.forEach((item, index) => {\n  markdownText += `${index + 1}. [${item.title}](${item.url})\\n`\n})\nmarkdownText += "\\nAdding URLs to your text..."\nreturn markdownText\n',
                            args: "array, query",
                            param: "markdownList",
                            silent: true
                          },
                          { type: "say", message: "{{markdownList}}" },
                          {
                            type: "gpt",
                            prompt: "Please ignore all previous instructions.\nI will provide you with an array containing URLs, Titles, and descriptions of the content.\nI want you to integrate all of the provided URLs  into the text, ensuring a natural fit:\n- Do not change the structure or content of the article.\n- Links should be embedded in the text, not mentioned in brackets.\n- Ensure each provided link is inserted into the text.\n- Avoid adding links to headings (h1-h4).\n- Distribute the links evenly throughout the text, not concentrated in one place\n- Each URL should be used only once.\n- If uncertain about placement, insert links at random within the text.\n- Feel free to shorten or modify the titles for better integration.\n- Use Markdown formatting for embedding links.\n\nURLs array to integrate:\n{{array}}\n\n[TEXT]:\n{{gpt}}\n\n[REWRITTEN TEXT]:",
                            param: "gpt"
                          },
                          {
                            type: "calc",
                            func: "list-update",
                            list: "result",
                            match: '{ "id": 0 }',
                            prop: "done"
                          }
                        ]
                      },
                      {
                        condition: "{{ask-urls}} = paste",
                        label: "PASTE MY URLS",
                        type: "group",
                        steps: [
                          {
                            type: "ask",
                            message: 'Please provide the URLs to add to the article, separated by double slash " // "',
                            param: "links",
                            options: null,
                            default: ""
                          },
                          {
                            type: "gpt",
                            prompt: "Please ignore all previous instructions.\nI want you tu integrate the provided [URLs] into the text, ensuring a natural fit.\n- Avoid adding links to headings (h1-h4).\n- Each URL should be used only once.\n- If unsure, insert at random locations within the text.\n- Use Markdown formatting for embedding links. -- Do not alter the text or its style; only add the links.\n\n[URLS], SEPARATED BY DOUBLE SLASHES //:\n\n{{links}}\n\n[TEXT]:\n{{gpt}}\n\n[REWRITTEN TEXT]:",
                            param: "gpt"
                          },
                          {
                            type: "calc",
                            func: "list-update",
                            list: "result",
                            match: '{ "id": 0 }',
                            prop: "done"
                          }
                        ]
                      }
                    ]
                  },
                  {
                    condition: "{{next-option}} = $custom",
                    type: "gpt",
                    prompt: "{{next}}",
                    param: "gpt"
                  },
                  { type: "jump", to: "ask-for-next" }
                ]
              },
              {
                label: "ask-refine-section",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    param: "refine-section",
                    options: [
                      { label: "\u2705 DONE", value: "no" },
                      { label: "\u{1F3AF} ADD KEYWORDS", value: "add-keywords" },
                      { label: "\u{1F9F2} ADD EXTERNAL LINKS", value: "links" },
                      { label: "\u2734\uFE0F REFINE", value: "refine" }
                    ]
                  },
                  { condition: "{{refine-section}} = no", type: "stop" },
                  {
                    condition: "{{refine-section}} = add-keywords",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "kw-section-option",
                        options: [
                          { label: "\u{1F50D} LSI KW FROM SERP", value: "serp" },
                          { label: "\u{1F4CC} PASTE MY KEYWORDS", value: "paste" }
                        ],
                        message: "Extract keywords from the SERP?\n"
                      },
                      {
                        condition: "{{kw-section-option}} = serp",
                        type: "group",
                        steps: [
                          {
                            type: "ask",
                            message: "Enter a relevant Google Search query to extract keywords from the Search Engine Results Page (SERP).",
                            param: "query",
                            default: ""
                          },
                          {
                            type: "say",
                            message: "\u23F3 Extracting keywords. Please wait a bit..."
                          },
                          {
                            type: "gpt",
                            prompt: "I want you to respond only in {{language}} and output a single table.\nPretend to be a SEO keyword research expert.\nRead the [SERP] that I will provide you and find top 20 LSI keywords in SERP, each containing at least 2 words:\n- Output these keywords comma separated.\n- Do not include keywords in the list that are not thematically relevant to my query.\n- Do not add any notes, write only comma separated keywords.\n- Do not echo my prompt.\n\n\n[SERP]:\n{{serp {{query}}}}\n\n[KEYWORDS]:",
                            param: "keywords-list"
                          }
                        ]
                      },
                      {
                        condition: "{{kw-section-option}} = paste",
                        type: "group",
                        steps: [
                          {
                            type: "ask",
                            param: "keywords-list",
                            message: "Type in keywords, comma separated:\n"
                          }
                        ]
                      },
                      {
                        type: "gpt",
                        prompt: "I would like you to make changes to the [TEXT] you have written before. Please do not output anything but the revised text. Do not echo my command. Do not put quotes around the revised text.\nDo not change the chapter titles, subtitles and the text structure, but rewrite the content using Additional keywords. If I provide a specific request as Additional keywords, please analyze the request and include relevant keywords in the text. Add as many keywords from my list as possible. Do not write the added keywords in square brackets.\n\n[TEXT]: {{content}}\n\n[ADDITIONAL KEYWORDS]: {{keywords-list}}\n\n[REWRITTEN TEXT]:",
                        param: "gpt"
                      }
                    ]
                  },
                  {
                    condition: "{{refine-section}} = links",
                    label: "ADD URLS",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        options: [
                          { label: "\u{1F9F2} EXTRACT FROM SERP", value: "extract" },
                          { label: "\u{1F4CC} PASTE URLs", value: "paste" },
                          "$custom"
                        ],
                        param: "ask-urls",
                        message: "Would you like to auto-extract top SERP URLs or provide them yourself?",
                        default: ""
                      },
                      {
                        condition: "{{ask-urls}} = extract",
                        label: "AUTO EXTRACT URLS",
                        type: "group",
                        steps: [
                          {
                            condition: "{{query}} != ",
                            type: "ask",
                            options: [
                              { label: "\u2705 YES", value: "yes" },
                              { label: "\u26D4 NO", value: "no" }
                            ],
                            param: "ask-reuse",
                            message: "\u267B\uFE0F Reuse your previous '{{query}}' search?",
                            default: ""
                          },
                          {
                            condition: "{{ask-reuse}} = yes",
                            type: "jump",
                            to: "CALC SERP"
                          },
                          {
                            type: "ask",
                            param: "query",
                            message: "Please enter a SERP query, such as 'GTA 6 release date'.",
                            options: null,
                            default: ""
                          },
                          {
                            label: "CALC SERP",
                            type: "calc",
                            func: "set",
                            param: "information",
                            format: "",
                            value: "{{serp {{query}}}}"
                          },
                          {
                            type: "calc",
                            func: "serp.extract-links",
                            from: "information",
                            to: "array",
                            limit: 8
                          },
                          {
                            type: "js",
                            code: 'let markdownText\n  = `I found top ${args.array.length} URLs from SERP for the query "${args.query}":\\n\\n`\nargs.array.forEach((item, index) => {\n  markdownText += `${index + 1}. [${item.title}](${item.url})\\n`\n})\nmarkdownText += "\\nAdding URLs to your text..."\nreturn markdownText\n',
                            args: "array, query",
                            param: "markdownList",
                            silent: true
                          },
                          { type: "say", message: "{{markdownList}}" },
                          {
                            type: "gpt",
                            prompt: "Please ignore all previous instructions.\nI will provide you with an array containing URLs, Titles, and descriptions of the content.\nI want you to integrate all of the provided URLs  into the text, ensuring a natural fit:\n- Do not change the structure or content of the article.\n- Links should be embedded in the text, not mentioned in brackets.\n- Ensure each provided link is inserted into the text.\n- Avoid adding links to headings (h1-h4).\n- Distribute the links evenly throughout the text, not concentrated in one place\n- Each URL should be used only once.\n- If uncertain about placement, insert links at random within the text.\n- Feel free to shorten or modify the titles for better integration.\n- Use Markdown formatting for embedding links.\n\nURLs array to integrate:\n{{array}}\n\n[TEXT]:\n{{gpt}}\n\n[REWRITTEN TEXT]:",
                            param: "gpt"
                          }
                        ]
                      },
                      {
                        condition: "{{ask-urls}} = paste",
                        label: "PASTE MY URLS",
                        type: "group",
                        steps: [
                          {
                            type: "ask",
                            param: "links",
                            message: 'Please provide the URLs to add to the article, separated by double slash " // "',
                            options: null,
                            default: ""
                          },
                          {
                            type: "gpt",
                            prompt: "Please ignore all previous instructions.\nI want you tu integrate the provided [URLs] into the text, ensuring a natural fit.\n- Avoid adding links to headings (h1-h4).\n- Each URL should be used only once.\n- If unsure, insert at random locations within the text.\n- Use Markdown formatting for embedding links. -- Do not alter the text or its style; only add the links.\n\n[URLS], SEPARATED BY DOUBLE SLASHES //:\n\n{{links}}\n\n[TEXT]:\n{{gpt}}\n\n[REWRITTEN TEXT]:",
                            param: "gpt"
                          }
                        ]
                      }
                    ]
                  },
                  {
                    condition: "{{refine-section}} = refine",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "instructions",
                        message: "What changes would you like me to make?"
                      },
                      {
                        type: "gpt",
                        prompt: "I would like you to make changes to the text you have just written. Please do not output anything but the revised text. Do not echo my command. Do not put quotes around the revised text.\nIf I said to delete a certain chapter or a subchapter, you should delete only that one, renumbering the remaining chapters considering such deletion.\n\n[CHANGES TO MAKE]: {{instructions}}\n\n[REWRITTEN TEXT]:",
                        param: "gpt"
                      }
                    ]
                  },
                  { type: "jump", to: "ask-refine-section" }
                ]
              }
            ]
          },
          {
            meta: {
              name: "article-section",
              title: "Article section",
              category: "Copywriting",
              description: "Generate an article section content. Use in combination with Article Creator command: first generate an article outline and then every sections one by one."
            },
            steps: [
              {
                say: "Please copy-paste below a single section of the article outline. You can generate an article outline using Article Outline command.\n"
              },
              { ask: "param" },
              {
                gpt: "Please ignore all previous instructions.\nI want you to act as a very proficient SEO and high end copy writer that speaks and writes fluent {{language}}.\nYour task is to write a high-quality article section content for the article section description given below.\nThe article section can have bullet points or numbered list (if needed). All output must be 100% human writing style and free of grammar errors.\nDo not use generic filler phrases. Do use useful subheadings with keyword -rich titles. Do not repeat the same content over again.\n\n[ARTICLE SECTION OUTLINE]:\n{{param}}\n\n[ARTICLE SECTION CONTENT]:"
              },
              {
                type: "ask",
                param: "instructions",
                options: [
                  { label: "\u2B06\uFE0F EXPAND", value: "Make it longer" },
                  { label: "\u2B07\uFE0F SHORTEN", value: "Make it shorter" },
                  {
                    label: "\u{1F4BC} PROFESSIONAL",
                    value: "Change tone to professional"
                  },
                  { label: "\u{1F379} CASUAL", value: "Change tone to casual" },
                  {
                    label: "\u{1F3AF} STRAIGHTFORWARD",
                    value: "Change tone to straightforward"
                  },
                  { label: "\u{1F981} CONFIDENT", value: "Change tone to confident" },
                  {
                    label: "\u{1F431} FRIENDLY",
                    value: "Change tone to friendly and empathic"
                  },
                  { label: "\u{1F4DA} STORY", value: "Change style to storytelling" },
                  { label: "\u{1F92A} SIMPLIFY", value: "Simplify language" },
                  { label: "\u{1F393}\u200D\uFE0F ENRICH", value: "Enrich vocabulary and tone" },
                  {
                    label: "\u{1F3A8}\u200D\uFE0F ILLUSTRATE",
                    value: "Add examples, anecdotes, and other storytelling elements to illustrate points"
                  },
                  {
                    label: "\u{1F4CC}\u200D\uFE0F ADD HEADINGS",
                    value: "Add headings, subheadings, bullet points, and other formatting elements for readability"
                  },
                  {
                    label: "\u{1F974} HUMANIZE",
                    value: 'I want you to perform text "Humanization". Please rewrite each sentence, increasing its perplexity and burstiness. Perplexity measures the complexity of text. Separately, burstiness compares the variations of sentences. Humans tend to write with greater burstiness, for example, with some longer or complex sentences alongside shorter ones. AI sentences tend to be more uniform. I need it to have a good amount of perplexity and burstiness. Rewrite changing 50% in nouns and verbs for similar ones and rewrite verb usages to add natural sounding variations in complexity but retain the same tense and overall meaning. Randomly use simple and complicated verbs, combine long and short sentences and rewrite the above text so that it is not detected as AI content by AI content detectors.'
                  },
                  { label: "\u{1F50D} CLARIFY", value: "Add clarity and conciseness" },
                  {
                    label: "\u{1F6E0}\uFE0F\u200D\uFE0F REFINE",
                    value: "Improve sentences structure and flow, as well as coherence and relevance by adding or removing information, but try to keep to the text length"
                  },
                  { value: "$custom" }
                ]
              },
              {
                type: "gpt",
                prompt: "Please ignore previous instructions.\nI would like you to make changes to the new text you have just written. Please do not output anything but the revised text. Do not put quotes around the revised text.\nYour new instructions:\n- I would like you to act as a copywriter and rewrite or improve a given text for me.\n- I will give you the reply parameters in brackets [].\n- Do not echo my command or parameters.\n\n\n[HOW TO REWRITE THE TEXT]:\n{{instructions}}\n\n[NEW ARTICLE SECTION]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u{1F4CB} PASTE TO PAGE", value: "paste" },
                  { label: "\u2B06\uFE0F EXPAND", value: "Make it longer" },
                  { label: "\u2B07\uFE0F SHORTEN", value: "Make it shorter" },
                  {
                    label: "\u{1F4BC} PROFESSIONAL",
                    value: "Change tone to professional"
                  },
                  { label: "\u{1F379} CASUAL", value: "Change tone to casual" },
                  {
                    label: "\u{1F3AF} STRAIGHTFORWARD",
                    value: "Change tone to straightforward"
                  },
                  { label: "\u{1F981} CONFIDENT", value: "Change tone to confident" },
                  {
                    label: "\u{1F431} FRIENDLY",
                    value: "Change tone to friendly and empathic"
                  },
                  { label: "\u{1F4DA} STORY", value: "Change style to storytelling" },
                  { label: "\u{1F92A} SIMPLIFY", value: "Simplify language" },
                  { label: "\u{1F393}\u200D\uFE0F ENRICH", value: "Enrich vocabulary and tone" },
                  {
                    label: "\u{1F3A8}\u200D\uFE0F ILLUSTRATE",
                    value: "Add examples, anecdotes, and other storytelling elements to illustrate points"
                  },
                  {
                    label: "\u{1F4CC}\u200D\uFE0F ADD HEADINGS",
                    value: "Add headings, subheadings, bullet points, and other formatting elements for readability"
                  },
                  {
                    label: "\u{1F974} HUMANIZE",
                    value: 'I want you to perform text "Humanization". Please rewrite each sentence, increasing its perplexity and burstiness. Perplexity measures the complexity of text. Separately, burstiness compares the variations of sentences. Humans tend to write with greater burstiness, for example, with some longer or complex sentences alongside shorter ones. AI sentences tend to be more uniform. I need it to have a good amount of perplexity and burstiness. Rewrite changing 50% in nouns and verbs for similar ones and rewrite verb usages to add natural sounding variations in complexity but retain the same tense and overall meaning. Randomly use simple and complicated verbs, combine long and short sentences and rewrite the above text so that it is not detected as AI content by AI content detectors.'
                  },
                  { label: "\u{1F50D} CLARIFY", value: "Add clarity and conciseness" },
                  {
                    label: "\u{1F6E0}\uFE0F\u200D\uFE0F REFINE",
                    value: "Improve sentences structure and flow, as well as coherence and relevance by adding or removing information, but try to keep to the text length"
                  },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              { condition: "{{change}} = paste", type: "paste" },
              {
                condition: "{{change}} = paste",
                type: "control",
                action: "hide"
              },
              { condition: "{{change}} = paste", type: "stop" },
              {
                type: "gpt",
                prompt: "I would like you to make changes to the new text you have just written. Please do not output anything but the revised text. Do not echo my command. Do not put quotes around the revised text.\n\n[CHANGES TO MAKE]:\n{{change}}\n\n[NEW ARTICLE SECTION]:"
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "repurpose-text",
              title: "Repurpose text",
              description: "Turn web page into articles, posts, tweets etc.",
              category: "Copywriting"
            },
            steps: [
              {
                condition: "{{repurpose-input}} =",
                type: "calc",
                func: "set",
                param: "repurpose-input",
                value: "{{page}}",
                format: ""
              },
              {
                type: "ask",
                param: "action",
                options: [
                  { label: "\u{1F58A} BLOG POST", value: "blogpost" },
                  { label: "\u{1F4DD} ARTICLE", value: "article" },
                  { label: "\u{1F426} TWEET", value: "tweet" },
                  { label: "\u{1F6E0} CUSTOM", value: "custom" }
                ]
              },
              {
                condition: "{{action}} = blogpost",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    param: "blog-post-option",
                    options: [
                      {
                        label: "\u2B06\uFE0F LONG",
                        value: "I need a long blog post, do not limit yourself by the word number.\n"
                      },
                      {
                        label: "\u2B07\uFE0F SHORT",
                        value: "The blog post must be short and concise, not exceeding 150 words. The short length ensures that the content remains engaging and easily digestible, aligning with the need for brief, yet informative content.\n"
                      }
                    ]
                  },
                  {
                    type: "gpt",
                    param: "content",
                    prompt: "Please ignore all previous instructions. I want you to only respond in {{language}}.\nAct as a professional blogger with expertise in the specific subject matter. I will provide you with text information obtained from a webpage; find the main content, analyze it and write a blog post based on the data obtained.\n\n[INSTRUCTIONS]: {{blog-post-option}}\n\nCome up with a title for this blog post at the beginning, a meta description, and hashtags at the end. The content must be well-researched and provide valuable insights, opinions, or advice related to the subject.\n\n--- Output format:\n## Blog post title\nBlog post text\n\n### Meta description:\nMeta description\n\n### HASHTAGS:\n10 relevant hashtags with #, comma separated\n\nFormat the text using headings (H2, H3, H4), numbered and bullet points, and other markdown formatting features.\n\n[INFORMATION FOR A BLOG POST]: {{repurpose-input}}\n\n[BLOG POST IN {{language}}]:"
                  },
                  { type: "jump", to: "ask-for-change" }
                ],
                label: "BLOG POST"
              },
              {
                condition: "{{action}} = tweet",
                type: "group",
                steps: [
                  {
                    type: "gpt",
                    param: "content",
                    prompt: "Please ignore all previous instructions. I want you to only respond in {{language}}.\nAct as a social media content creator with expertise in topic generation. I'll provide you with text information from a webpage; identify the main content, analyze it, and compose 3 different tweets related to the data. Tweets should convey insights, opinions, or details pertaining to the subject. Ensure the content is engaging and tailored to its potential target audience.\nKeep in mind that the tweets should be different according to my instructions:\n- The first one should have 1 emoji and no hashtags.\n- The second should have hashtags and no emoji.\n- The third should have both an emoji and hashtags.\nEvery TWEET should have a title and a markdown code block with the tweet itself, enclosed into code-block quotes. Do not echo my prompt.\n\n[EXAMPLE OF A SINGLE TWEET]:\n\n**Tweet #1**\n```markdown\ntweet\n```\n\n[INFORMATION FOR A TWEET]:\n{{repurpose-input}}\n\nTWEET in {{language}}:"
                  },
                  { type: "jump", to: "ask-for-change" }
                ],
                label: "TWEET"
              },
              {
                condition: "{{action}} = article",
                type: "group",
                steps: [
                  {
                    type: "command",
                    param: "content",
                    inputs: [
                      "Entire Article",
                      "Generate Outline",
                      "{{repurpose-input}}"
                    ],
                    name: "Article creator"
                  },
                  { type: "stop" }
                ],
                label: "ARTICLE"
              },
              {
                condition: "{{action}} = custom",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    message: "What should I do with the info?",
                    param: "task"
                  },
                  {
                    type: "gpt",
                    param: "content",
                    prompt: "Please ignore all previous instructions. I want you to only respond in {{language}}.\nI want you to complete my task, which I will write after the word [MY TASK]. I will provide you with the [CONTEXT] based on which my task will be given.\nIf you need more information, ask me for additional details to complete the task.\n\n[MY TASK]: {{task}}\n\n[CONTEXT]: {{repurpose-input}}"
                  }
                ],
                label: "CUSTOM"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u{1F3AF} ADD KEYWORDS", value: "add-keywords" },
                  { label: "\u{1F9F2} ADD EXTERNAL LINKS", value: "links" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?",
                label: "REFINE"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS]. Provide a rewritten response.\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[YOUR RESPONSE]:",
                param: "content",
                label: "REFINE"
              },
              {
                condition: "{{change}} = add-keywords",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    message: "Extract keywords from the SERP?\n",
                    param: "kw-option",
                    options: [
                      { label: "\u{1F50D} LSI KW FROM SERP", value: "serp" },
                      { label: "\u{1F4CC} PASTE MY KEYWORDS", value: "paste" }
                    ]
                  },
                  {
                    condition: "{{kw-option}} = serp",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        message: "Enter a relevant Google Search query to extract keywords from the Search Engine Results Page (SERP).",
                        param: "query",
                        default: ""
                      },
                      {
                        type: "say",
                        message: "Extracting keywords. Please wait a bit..."
                      },
                      {
                        type: "gpt",
                        prompt: "I want you to respond only in {{language}} and output a single table.\nPretend to be a SEO keyword research expert.\nRead the [SERP] that I will provide you and find top 20 LSI keywords in SERP, each containing at least 2 words:\n- Output these keywords comma separated.\n- Do not include keywords in the list that are not thematically relevant to my query.\n- Do not add any notes, write only comma separated keywords.\n- Do not echo my prompt.\n\n\n[SERP]:\n{{serp {{query}}}}\n\n[KEYWORDS]:",
                        param: "keywords-list"
                      }
                    ]
                  },
                  {
                    condition: "{{kw-option}} = paste",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "keywords-list",
                        message: "Type in keywords, comma separated:\n"
                      }
                    ]
                  },
                  {
                    type: "gpt",
                    prompt: "I would like you to make changes to the [TEXT] you have written before. Please do not output anything but the revised text. Do not echo my command. Do not put quotes around the revised text.\nDo not change the text structure, but rewrite the content using Additional keywords. If I provide a specific request as Additional keywords, please analyze the request and include relevant keywords in the text. Add as many keywords from my list as possible. Do not write the added keywords in square brackets.\n\n[TEXT]: {{content}}\n\n[ADDITIONAL KEYWORDS]: {{keywords-list}}\n\n[REWRITTEN TEXT]:",
                    param: "content"
                  }
                ],
                label: "ADD KEYWORDS"
              },
              {
                type: "group",
                steps: [
                  {
                    type: "ask",
                    param: "ask-urls",
                    message: "Would you like to auto-extract top SERP URLs or provide them yourself?",
                    options: [
                      { label: "\u{1F9F2} EXTRACT FROM SERP", value: "extract" },
                      { label: "\u{1F4CC} PASTE URLs", value: "paste" },
                      "$custom"
                    ],
                    default: ""
                  },
                  {
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "ask-reuse",
                        message: "\u267B\uFE0F Reuse your previous '{{query}}' search?",
                        options: [
                          { label: "\u2705 YES", value: "yes" },
                          { label: "\u26D4 NO", value: "no" }
                        ],
                        default: "",
                        condition: "{{query}} != "
                      },
                      {
                        type: "jump",
                        to: "CALC SERP QUERY",
                        condition: "{{ask-reuse}} = yes"
                      },
                      {
                        type: "ask",
                        param: "query",
                        message: "Please enter a SERP query, such as 'GTA 6 release date'.",
                        options: null,
                        default: ""
                      },
                      {
                        type: "calc",
                        func: "set",
                        param: "information",
                        format: "",
                        value: "{{serp {{query}}}}",
                        label: "CALC SERP QUERY"
                      },
                      {
                        type: "calc",
                        func: "serp.extract-links",
                        from: "information",
                        to: "array",
                        limit: 8
                      },
                      {
                        type: "js",
                        code: 'function formatArrayToMarkdown(args) {\n    let markdownText = `I have found top ${args.array.length} URLs from SERP for the query "${args.query}":\\n\\n`;\n    args.array.forEach((item, index) => {\n        markdownText += `${index + 1}. [${item.title}](${item.url})\\n`;\n    });\n    markdownText += "\\nAdding URLs to your text...";\n    return markdownText;\n}\n\nreturn formatArrayToMarkdown(args);\n',
                        args: "array, query",
                        param: "markdownList",
                        silent: true
                      },
                      { type: "say", message: "{{markdownList}}" },
                      {
                        type: "gpt",
                        prompt: "Please ignore all previous instructions.\nI will provide you with an array containing URLs, Titles, and descriptions of the content.\nI want you to integrate all of the provided URLs  into the  text, ensuring a natural fit:\n- Do not change the structure or content of the article.\n- Links should be embedded in the text, not mentioned in brackets.\n- Ensure each provided link is inserted into the text.\n- Avoid adding links to headings (h1-h4).\n- Distribute the links evenly throughout the text, not concentrated in one place\n- Each URL should be used only once.\n- If uncertain about placement, insert links at random within the text.\n- Feel free to shorten or modify the titles for better integration.\n- Use Markdown formatting for embedding links.\n\nURLs array to integrate:\n{{array}}\n\n[TEXT]:\n{{content}}\n\n[REWRITTEN TEXT]:",
                        param: "content"
                      },
                      { type: "jump", to: "ASK-FOR-CHANGE" }
                    ],
                    label: "AUTO EXTRACT URLS",
                    condition: "{{ask-urls}} = extract"
                  },
                  {
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "links",
                        message: 'Please provide the URLs to add to the article, separated by double slash " // "',
                        options: null,
                        default: ""
                      },
                      {
                        type: "gpt",
                        prompt: "Please ignore all previous instructions.\nI want you tu integrate the provided [URLs] into the text, ensuring a natural fit.\n- Avoid adding links to headings (h1-h4).\n- Each URL should be used only once.\n- If unsure, insert at random locations within the text.\n- Use Markdown formatting for embedding links. -- Do not alter the text or its style; only add the links.\n\n[URLS], SEPARATED BY DOUBLE SLASHES //:\n\n{{links}}\n\n[TEXT]:\n{{content}}\n\n[REWRITTEN TEXT]:",
                        param: "content"
                      },
                      { type: "jump", to: "ASK-FOR-CHANGE" }
                    ],
                    condition: "{{ask-urls}} = paste",
                    label: "PASTE MY URLS"
                  }
                ],
                condition: "{{change}} = links",
                label: "ADD URLS"
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "blog-post-writer",
              title: "Blog post from topic",
              category: "Copywriting",
              description: "Create a capacious blog post from the given topic."
            },
            steps: [
              {
                type: "ask",
                param: "param",
                message: "Enter a topic or capture a webpage area to use as a post idea.",
                default: "",
                optionsInvalid: false,
                options: [
                  { label: "\u{1F4F7} CAPTURE AREA", value: "capture" },
                  "$custom"
                ]
              },
              {
                condition: "{{param}} = capture",
                label: "CAPTURE AREA",
                type: "ask",
                param: "param",
                message: "",
                default: "",
                optionsInvalid: false,
                options: null,
                vision: {
                  enabled: true,
                  mode: "area",
                  hint: "Capture a webpage area to use as a post idea.",
                  send: true
                }
              },
              {
                type: "gpt",
                param: "content",
                prompt: "Please ignore all previous instructions. \nRespond only in {{language}}.\n\nAct as a professional blogger with expertise in the specific subject matter. I will provide you with a blog post topic or an image. \n\nI want you to find the main content, analyze it and write a blog post based on the data obtained.\n\nCome up with a title for this blog post at the beginning, a meta description, and hashtags at the end. The content must be well-researched and provide valuable insights, opinions, or advice related to the subject.\n\nFollow the instructions:\n- Do not add any notes or general phrases.\n- Do not echo my prompt.\n- Use markdown features. \n- Format the text using headings (H2, H3, H4), numbered and bullet points, and other markdown formatting features.\n\n[Output format]:\n\n## Blog post title\nBlog post text\n### Subtitle (Use subtitles if needed). \ntext\n### Meta description:\nMeta description\n\n### HASHTAGS:\n10 relevant hashtags with #, comma separated\n\n\n[BLOG POST IDEA, TOPIC OR IMAGE]: {{param}}\n\n[BLOG POST]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u{1F3AF} ADD KEYWORDS", value: "add-keywords" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS]. Provide a rewritten response.\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[BLOG POST]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              {
                condition: "{{change}} = add-keywords",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    message: "I can extract keywords from the SERP to improve your article's Google E-A-T score, or you can manually paste your keywords.\n",
                    param: "kw-section-option",
                    options: [
                      { label: "\u{1F50D} LSI KW FROM SERP", value: "serp" },
                      { label: "\u{1F4CC} PASTE MY KEYWORDS", value: "paste" }
                    ]
                  },
                  {
                    condition: "{{kw-section-option}} = serp",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        message: "Enter a relevant Google Search query to extract keywords from the Search Engine Results Page (SERP).",
                        param: "query",
                        default: ""
                      },
                      {
                        type: "say",
                        message: "Extracting keywords. Please wait a bit..."
                      },
                      {
                        type: "gpt",
                        prompt: "I want you to respond only in {{language}} and output a single table.\nPretend to be a SEO keyword research expert.\nRead the [SERP] that I will provide you and find top 20 LSI keywords in SERP, each containing at least 2 words:\n- Output these keywords comma separated.\n- Do not include keywords in the list that are not thematically relevant to my query.\n- Do not add any notes, write only comma separated keywords.\n- Do not echo my prompt.\n\n\n[SERP]:\n{{serp {{query}}}}\n\n[KEYWORDS]:",
                        param: "keywords-list"
                      }
                    ]
                  },
                  {
                    condition: "{{kw-section-option}} = paste",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "keywords-list",
                        message: "Type in keywords, comma separated:\n"
                      }
                    ]
                  },
                  {
                    type: "gpt",
                    prompt: "I would like you to make changes to the [TEXT] you have written before. Please do not output anything but the revised text. Do not echo my command. Do not put quotes around the revised text.\nDo not change the chapter titles, subtitles and the text structure, but rewrite the content using Additional keywords. If I provide a specific request as Additional keywords, please analyze the request and include relevant keywords in the text. Add as many keywords from my list as possible. Do not write the added keywords in square brackets.\n\n[TEXT]: {{content}}\n\n[ADDITIONAL KEYWORDS]: {{keywords-list}}\n\n[REWRITTEN TEXT]:"
                  }
                ]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "pppp-framework-post",
              title: "PPPP framework post generator",
              category: "Copywriting",
              description: "The Problem-Promise-Proof-Proposal framework is a strategic method used in copywriting and sales to create persuasive messages."
            },
            steps: [
              {
                type: "ask",
                param: "topic",
                message: "Please provide a post topic or press Enter to parse it from the page:\n",
                default: "{{page}}"
              },
              {
                type: "gpt",
                prompt: "Please ignore all previous instructions. Respond only in {{language}}.\n\nI want you to act as a very proficient SEO and high end copywriter. Your task is to generate 5 short content proposals of 150 characters maximum for Instagram and Pinterest stories using the \"[Problem].[Promise].[Proof].[Proposal].\" framework.\n\nDo not write the words \"[Problem].[Promise].[Proof].[Proposal]\" and do not echo any instructions.\n\nEvery post should have a title and a markdown code block with the post itself, enclosed into code-block quotes. Do not echo my prompt.\n\n[EXAMPLE OF A SINGLE POST]:\n\n**Post #1**\n```markdown\nYou're looking for a way to generate extra income, but don't know where to start?\nWith our help, you'll be on your way to creating a successful side hustle.\nCustomers say 'they helped me put together a plan and gave me some tips for execution.'\nGet started on your side hustle today!\n```\n\n[TOPIC]: {{topic}}\n\n[5 PPPP FRAMEWORK POSTS]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [Additional Instructions].\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[5 PPPP FRAMEWORK POSTS]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "fact-check",
              title: "Fact check",
              category: "Copywriting",
              emoji: "\u{1F50D}",
              description: "Check given text for factual errors and correct them, indicating the source (if possible)."
            },
            steps: [
              {
                condition: "{{transcript}}",
                label: "IF YOUTUBE",
                type: "group",
                steps: [
                  {
                    type: "calc",
                    func: "set",
                    param: "tr",
                    format: "",
                    value: "{{transcript}}"
                  },
                  {
                    type: "gpt",
                    prompt: `I want you to only answer in {{language}}. 

Act like a professional journalist.

I want you to fact-check the information presented in the youtube video transcript chunk that I will send you. 

Instructions
- Write only about facts that are false\u{1F534} or partially inaccurate\u{1F7E1}.
- If the transcript text does not contain any inaccuracies or errors, do not evaluate the facts and response: "No false or inaccurate statements found in this transcript from [Timestamp URL] to [Timestamp URL].".
- Analyze the transcript sequentially, do not group false or inaccurate statements together.
- If it's clear from the transcript who made a particular statement, mention this in the description of the false or inaccurate information.
- Check carefully: NEVER fabricate, infer, or guess information. 
- Rate the transcript's overall accuracy: \u{1F534}Low, \u{1F7E1} Medium or \u{1F7E2} High. Consider the transcript's length when evaluating. For long transcripts, 2 minor errors don't automatically mean Low accuracy.
- In your analysis, present the position of the author (name this person if known), not some general or well-known opinion on the subject.
- Do not write "Author name:".
- Do no hallucinate links or facts.
- Do not echo my prompt, do not write general phrases.
- Do not render brackets. 
- The timestamp should be presented in markdown URL format. The URL text indicates, and the address links to a specific time in the video, for example:
[00:15:49](https://youtube.com/Mde2q7GFCrw?t=949s)


Follow the response framework:

**\u{1F534} FALSE:**  or  **\u{1F7E1} INACCURACY:**

[Timestamp URL] [Author name - only if known]: Brief description of the statement in {{language}}]

- [Brief justification of the error or inaccuracy]

----------------------------------------------------
**\u{1F534} FALSE:**  or  **\u{1F7E1} INACCURACY:** 
....

Level of accuracy: [\u{1F534}Low, \u{1F7E1} Medium or \u{1F7E2} High]


Information for you to analyze: 

[VIDEO TITLE]:
{{desc}}

[VIDEO URL]:
{{url}}

[TIMESTAMPED VIDEO TRANSCRIPT CHUNK]:
{{chunk}}

[FACT-CHECKED STATEMENTS LIST IN {{language}}]:`,
                    param: "analysis",
                    isolated: true,
                    chunkify: {
                      text: "{{tr}}",
                      empty: "It looks as if the video has no text transcript, or I could not fetch it from the page."
                    }
                  },
                  {
                    label: "ask-for-change",
                    type: "ask",
                    param: "change",
                    options: [
                      { label: "\u2705 DONE", value: "no" },
                      {
                        label: "\u{1F3AF} VERIFY ONLY INACCURATE CLAIMS",
                        value: "Only identify points that are debatable and need clarification. If statements are already refuted in your analysis (e.g.: well-known scientific facts), don't check them again."
                      },
                      {
                        label: "\u{1F50D} VERIFY ALL",
                        value: "Please review all statements from your analysis in order. You can shorten the text of statements for convenience, but convey their main essence."
                      },
                      "$custom"
                    ],
                    optionsInvalid: false,
                    message: "\u{1F4A1} I can also double check these claims using information from the web. Choose an option or write statement numbers to check."
                  },
                  { condition: "{{change}} = no", type: "stop" },
                  {
                    condition: "{{change-option}} = $custom",
                    label: "CUSTOM VERIFICATION",
                    type: "group",
                    steps: [
                      {
                        type: "calc",
                        func: "set",
                        param: "change",
                        format: "text",
                        value: "Please check only the statements I specified: {{change}}.You can shorten the text of statements for convenience, but convey their main essence."
                      },
                      { type: "jump", to: "FIND STATEMENTS" }
                    ]
                  },
                  {
                    condition: "{{change-option}} != $custom",
                    label: "VERIFY",
                    type: "group",
                    steps: [
                      {
                        label: "FIND STATEMENTS",
                        type: "gpt",
                        prompt: `You are a Research Agent.

Analyze the transcript analysis you performed earlier. 

Identify all inaccurate statements and create search queries that could clarify the accuracy or inaccuracy of these statements.

Instructions:
- Respond in {{language}}.
- Each search query should be as brief as possible and potentially provide an answer to whether the statement is true.
- {{change}}
- Be concise and to the point.
- If you found no controversial statements, just say so without responding with a JSON. Don't invent or imagine any.
- Do not repeat these instructions in your response.
- Respond with a JSON array containing objects with 2 fields: 1 "statement" - timestamp and statement, 2 - "query".
- Write nothing other than the JSON.

Example JSON response:
[
  {
    "statement": "[Timestamp](Timestamp URL) Statement text.",
    "query": "brief search query text to clarify if statement is true"
  },
...
]

[Your text analysis]: {{analysis}}

JSON response:`,
                        param: "gpt",
                        isolated: true,
                        silent: true
                      },
                      {
                        type: "calc",
                        func: "extract-json",
                        to: "statements",
                        param: "gpt",
                        index: "all"
                      },
                      {
                        type: "say",
                        message: "\u23F3 Fact checking **{{statements.length}}** statements, wait a bit. "
                      },
                      {
                        type: "loop",
                        list: "statements",
                        steps: [
                          {
                            type: "calc",
                            func: "increment",
                            param: "index",
                            delta: 1
                          },
                          {
                            type: "say",
                            message: "\u{1F575}\u{1F3FB}\u200D\u2642\uFE0F **Verifying statement {{index}}:** *{{item.statement}}*."
                          },
                          {
                            type: "calc",
                            func: "set",
                            param: "information",
                            format: "",
                            value: "{{serp {{item.query}} crawl=all}}"
                          },
                          {
                            type: "gpt",
                            prompt: `You are a Research Agent.
Your task is to confirm or refute the following controversial statement: "{{item.statement}}"

Instructions:
- I will provide you with information from the internet to help you complete this task.
- Respond in {{language}}.
- Be concise and to the point, providing an answer as to whether the statement is true.
- If there is no clear answer to the controversial statement, indicate all polar opinions regarding it and their sources.
- Utilize information from the Web, provided below.
- Integrate insights from multiple web search sources, and ensure inclusion of relevant links in a markdown fully rendered format: [\u278A](URL), [\u278B](URL) etc, for each bullet point.
- Each URL should correspond to only one symbol such as \u278A \u278B \u278C \u278D \u278E \u278F \u2790 \u2791 \u2792 \u2793, which are used in the Sources section in sequential order.
- If the same key point appears in multiple sources, don't repeat the sources. Instead, list several references after this point, like [\u278A](URL), [\u278B](URL).
- Do not hallucinate facts or information.
- Do not use any other tools.

Follow the response format:

**Conclusion**: **\u2705 TRUE** or **\u26D4\uFE0F FALSE** or **\u2734\uFE0F NO CLEAR ANSWER**.

**Explanation**: [Brief justification of the statement's correctness or incorrectness, supported by information from the internet].

**Sources**: 
- One sentence summarizing the useful information found on the web resource regarding the statement. [\u278A](URL) 
- [...


[Web search results]: {{information}}

Your response:`,
                            isolated: true
                          }
                        ]
                      },
                      { type: "stop" }
                    ]
                  },
                  { type: "stop" }
                ]
              },
              {
                type: "ask",
                param: "text",
                message: "Please copy-paste a text to perform the fact check, or press Enter to parse information from the webpage.",
                default: "{{page}}"
              },
              {
                type: "gpt",
                prompt: `Please ignore all previous instructions. 
Act like a professional journalist and response in {{language}}.

I want you to fact-check the information presented in the text that I will send you

Instructions
- Write only about facts that are false\u{1F534} or partially inaccurate\u{1F7E1}.
- If the text text does not contain any inaccuracies or errors, do not evaluate the facts and response: "No false or inaccurate statements found in this text.".
- Analyze the text sequentially, do not group false or inaccurate statements together.
- If it's clear from the text who made a particular statement, mention this in the description of the false or inaccurate information.
- Check carefully: NEVER fabricate, infer, or guess information. 
- Rate the text's overall accuracy: \u{1F534}Low, \u{1F7E1} Medium or \u{1F7E2} High. Consider the text's length when evaluating. For long texts, 2 minor errors don't automatically mean Low accuracy.
- In your analysis, present the position of the author (name this person if known), not some general or well-known opinion on the subject.
- Do not write "Author name:".
- Do no hallucinate links or facts.
- Do not echo my prompt, do not write general phrases.
- Do not render brackets. 

Follow the response framework:

**\u{1F534} FALSE:**  or  **\u{1F7E1} INACCURACY:**

- **Statement \u2116__**: [Brief description of the statement.]

- [Brief justification of the error, include a source if you are confident about it].
--------------------
**\u{1F534} FALSE:**  or  **\u{1F7E1} INACCURACY:**
....
--------------------
Total: [Number] inaccuracies.
Level of accuracy: [\u{1F534}Low, \u{1F7E1} Medium or \u{1F7E2} High]


[MY STATEMENTS / TEXT TO CHECK / PARSE FROM PAGE]:
{{text}}


[Incorrect or partially inaccurate statements]:`,
                param: "analysis",
                isolated: true,
                chunkify: { text: "{{text}}", empty: "" }
              },
              {
                label: "ask-for-change",
                type: "ask",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  {
                    label: "\u{1F3AF} VERIFY ONLY INACCURATE CLAIMS",
                    value: "Only identify points that are debatable and need clarification. If statements are already refuted in your analysis (e.g.: well-known scientific facts), don't check them again."
                  },
                  {
                    label: "\u{1F50D} VERIFY ALL",
                    value: "Please review all statements from your analysis in order. You can shorten the text of statements for convenience, but convey their main essence."
                  },
                  "$custom"
                ],
                optionsInvalid: false,
                message: "\u{1F4A1} I can also double check these claims using information from the web. Choose an option or write statement numbers to check."
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change-option}} = $custom",
                label: "CUSTOM VERIFICATION",
                type: "group",
                steps: [
                  {
                    type: "calc",
                    func: "set",
                    param: "change",
                    format: "text",
                    value: "Please check only the statements I specified: {{change}}.You can shorten the text of statements for convenience, but convey their main essence."
                  },
                  { type: "jump", to: "FIND STATEMENTS" }
                ]
              },
              {
                condition: "{{change-option}} != $custom",
                label: "VERIFY",
                type: "group",
                steps: [
                  {
                    label: "FIND STATEMENTS",
                    type: "gpt",
                    prompt: `You are a Research Agent.

Analyze the text analysis you performed earlier. 

Identify all controversial statements and create search queries that could clarify the accuracy or inaccuracy of these statements.

Instructions:
- Respond in {{language}}.
- Each search query should be as brief as possible and potentially provide an answer to whether the statement is true.
- {{change}}
- Be concise and to the point.
- If you found no controversial statements, just say so without responding with a JSON. Don't invent or imagine any.
- Do not repeat these instructions in your response.
- Respond with a JSON array containing objects with 2 fields: 1 - statement, 2 - query.
- Write nothing other than the JSON.

Example JSON response:
[
  {
    "statement": "statement text",
    "query": "brief search query text to clarify if statement is true"
  },
...
]

[Your text analysis]: {{analysis}}

JSON response:`,
                    param: "gpt",
                    isolated: true,
                    silent: true
                  },
                  {
                    type: "calc",
                    func: "extract-json",
                    to: "statements",
                    param: "gpt",
                    index: "all"
                  },
                  {
                    type: "say",
                    message: "\u23F3 Fact checking **{{statements.length}}** statements, wait a bit. "
                  },
                  {
                    type: "loop",
                    list: "statements",
                    steps: [
                      {
                        type: "calc",
                        func: "increment",
                        param: "index",
                        delta: 1
                      },
                      {
                        type: "say",
                        message: "\u{1F575}\u{1F3FB}\u200D\u2642\uFE0F **Verifying statement {{index}}:** *{{item.statement}}*."
                      },
                      {
                        type: "calc",
                        func: "set",
                        param: "information",
                        format: "",
                        value: "{{serp {{item.query}} crawl=all}}"
                      },
                      {
                        type: "gpt",
                        prompt: `You are a Research Agent.
Your task is to confirm or refute the following controversial statement: "{{item.statement}}"

Instructions:
- I will provide you with information from the internet to help you complete this task.
- Respond in {{language}}.
- Be concise and to the point, providing an answer as to whether the statement is true.
- If there is no clear answer to the controversial statement, indicate all polar opinions regarding it and their sources.
- Utilize information from the Web, provided below.
- Integrate insights from multiple web search sources, and ensure inclusion of relevant links in a markdown fully rendered format: [\u278A](URL), [\u278B](URL) etc, for each bullet point.
- Each URL should correspond to only one symbol such as \u278A \u278B \u278C \u278D \u278E \u278F \u2790 \u2791 \u2792 \u2793, which are used in the Sources section in sequential order.
- If the same key point appears in multiple sources, don't repeat the sources. Instead, list several references after this point, like [\u278A](URL), [\u278B](URL).
- Do not hallucinate facts or information.
- Do not use any other tools.

Follow the response format:

**Conclusion**: **\u2705 TRUE** or **\u26D4\uFE0F FALSE** or **\u2734\uFE0F NO CLEAR ANSWER**.

**Explanation**: [Brief justification of the statement's correctness or incorrectness, supported by information from the internet].

**Sources**: 
- One sentence summarizing the useful information found on the web resource regarding the statement. [\u278A](URL) 
- [...


[Web search results]: {{information}}

Your response:`,
                        isolated: true
                      }
                    ]
                  },
                  { type: "stop" }
                ]
              }
            ]
          },
          {
            meta: {
              name: "extend-in-style",
              title: "Extend in style",
              category: "Copywriting",
              description: "Continues writing given text, maintaining its stylistic characteristics."
            },
            steps: [
              {
                type: "ask",
                message: "Paste in an existing text you want to be continued in the same style:\n",
                param: "param"
              },
              {
                type: "ask",
                message: "Any extra instructions for me, e.g.: 'Write no more than 100 words'? Press Enter to skip.\n",
                param: "instructions",
                default: "No additional instructions."
              },
              {
                gpt: "Please ignore all previous instructions.\nI want you to respond only in {{language}}.\nAct as a professional writer and continue the text provided, ensuring that the response is in the style of the existing text. Your task is to expand on the given text seamlessly, keeping the tone, rhythm, and stylistic elements consistent with what has been provided.\nDon't rewrite the text I gave you; provide me with new text that will serve as its continuation.\n\nIf any markdown formatting techniques were used in my text, please use them as well in it's continuation. Include headings and subheadings, and present the text to me in its rendered format.\n\n[ADDITIONAL INSTRUCTIONS]:\n{{instructions}}\n\n[EXISTING TEXT]:\n{{param}}\n\n[CONTINUATION]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2328\uFE0F PASTE TO PAGE", value: "paste" },
                  { label: "\u2B06\uFE0F EXPAND", value: "Make text longer." },
                  { label: "\u2B07\uFE0F SHORTEN", value: "Make text shorter." }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              { condition: "{{change}} = paste", type: "paste" },
              {
                condition: "{{change}} = paste",
                type: "control",
                action: "hide"
              },
              { condition: "{{change}} = paste", type: "stop" },
              {
                type: "gpt",
                prompt: "I would like you to make changes to the new text you have just written. Please do not output anything but the revised text. Do not echo my command. Do not put quotes around the revised text. Please answer in {{language}}.\n\n[CHANGES TO MAKE]:\n{{change}}\n\n[NEW TEXT]:"
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "sequential-text-improvements",
              title: "Sequential text improvements",
              category: "Copywriting",
              description: "Creates a table with a list of 10 improvements for you to pick from. Keeps track of changes already made and shows you an updated table after each pick from the list."
            },
            steps: [
              { say: "Copy and paste the text to improve:\n" },
              { ask: "param" },
              { say: "Ok, let me generate the suggestions..." },
              {
                gpt: 'Please ignore all previous instructions. I want you to respond only in {{language}}.\nI would like to write a markdown table of 10 different suggestions of improvements that could be applied to the text: - the first column has the improvement description - the second column has the suggestion number (1..10) for me to pick - the third column has a Y/N flag if the change was implemented or not (N by default)\nAfter you output the table, I will tell you the changes to be made.\n\n[THE SOURCE TEXT]:\n{{param}}\n\n[TABLE OF IMPROVEMENTS WITH COLUMNS "SUGGESTION", "NO", "APPLIED"]:'
              },
              {
                say: "Please pick the changes to make. You can make several changes at the same time, for instance 1,2,5,9 will change those 4 options at once. Press ESC at any time to stop the command.\n",
                label: "repeat"
              },
              { ask: "changes" },
              {
                gpt: "Please integrate the changes to the text, then show the updated text and the updated table of changes. Keep a log of all the changes made in the third column.\n\n[CHANGES TO MAKE / OR MY COMMAND]:\n{{changes}}\n\n[UPDATED TEXT AND THE TABLE]:"
              },
              { jump: "repeat" }
            ]
          },
          {
            meta: {
              name: "song-lyrics-writer",
              title: "Song lyrics writer",
              category: "Copywriting",
              description: "Generate an high-quality song lyrics for your desired song title."
            },
            steps: [
              { say: "Song title:\n" },
              { ask: "title" },
              {
                say: "Song style or theme, e.g. Rap / Rock / Ballad / Country / Nursery Rhyme / R&B / Funny / Sad / Catchy / Christmas / Pop / Love etc\n"
              },
              { ask: "style" },
              {
                gpt: "Please ignore all previous instructions. I want you to respond only in {{language}}.\nI will give you a song title and you'll write me the best lyrics for it. You will use words that are catchy, and depend on what title is given.\nThe lyric should be long enough, longer than a 1-minute song. Please use the table marking down.\n- If the user chose Rap Song, then you might add some bad words. - If it's a nursery rhyme song, then write lyrics that kids will love to listen too.\nYou can use repeating lyrics too.\nIf the given title isn't really a believable title, then re-write it to a best title one corresponding to the generated song lyrics.\n\n[PREFERRED SONG TITLE]: {{title}}\n\n[SONG STYLE / CONTENT]: {{style}}\n\n[REFINED SONG TITLE AND THE SONG LYRICS]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[REFINED SONG TITLE AND THE SONG LYRICS]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "plagiarism-checker",
              title: "Plagiarism checker",
              category: "Copywriting",
              description: "Find out who wrote or said it first. Check text for plagiarism."
            },
            steps: [
              {
                say: "Give me a full sentence or paragraph to check, e.g.\n> Life is like riding a bicycle. To keep your balance, you must keep moving.\n"
              },
              {
                ask: "param",
                default: "Life is like riding a bicycle. To keep your balance, you must keep moving.\n"
              },
              {
                gpt: `Please ignore all previous instructions. I want you to respond only in language {{language}}.

I want you to review the given text. Your goal is to echo parts (one sentence, paragraph or multiple ones) of the text that are taken from the other sources, or were written and said before, and tell me where it was copied from and / or who wrote or said that first. If you believe the text is original, just say so.

text > Midway upon the journey of our life. I found myself within a forest dark, For the straightforward pathway had been lost.
answer > This is a quote from Dante's "Inferno", Canto I, lines 1-3.

text > To go wrong in one's own way is better than to go right in someone else's.
answer > Fyodor Dostoevsky, Crime and Punishment

text > What I love best in life is new starts.
answer > Karl Lagerfeld



Use bullet points for multiple plagiarisms. Do not write explanations in replies. My first text:

{{param}}

Analysis:`
              }
            ]
          },
          {
            meta: {
              name: "language-wizard",
              title: "Language Wizard",
              category: "Learning",
              emoji: "\u{1F9D9}",
              description: "Your one-stop language learning assistant: explain theory, check grammar, practice dialogue."
            },
            steps: [
              {
                type: "ask",
                label: "main-menu",
                param: "what",
                options: [
                  { label: "\u{1F5E3}\uFE0F DIALOGUE", value: "dialogue" },
                  { label: "\u{1F58D}\uFE0F GRAMMAR CHECK", value: "grammar" },
                  { label: "\u{1F513} EXPLAIN", value: "explain" },
                  { label: "\u{1F4C6} LEARNING PLAN", value: "plan" },
                  { label: "\u{1F4DA} RESOURCES", value: "resources" },
                  { label: "\u{1F4AF} TEST", value: "test" }
                ]
              },
              {
                condition: "{{what}} = dialogue",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    param: "lang",
                    message: "What language would you like to communicate in? Press Enter for {{language}}:",
                    default: "{{language}}"
                  },
                  {
                    type: "ask",
                    param: "level",
                    message: "What is your language proficiency? Pick one or type your own assessment:",
                    options: [
                      {
                        label: "\u{1F603} BASIC",
                        value: "Basic level. I can understand and use very basic expressions; introduce myself and ask simple personal questions; communicate simple tasks requiring direct information; describe matters of immediate need in simple terms. You messages should be short and simple. Always include a transaction of your last message to {{language}} after your message.\n"
                      },
                      {
                        label: "\u{1F4D8} INTERMEDIATE",
                        value: "Intermediate level. I can understand main points on familiar subjects like work, school, leisure, etc; deal with most travel situations; describe experiences, events, and briefly explain opinions or plans; produce clear, detailed text on a range of subjects.\n"
                      },
                      {
                        label: "\u{1F393} ADVANCED",
                        value: "Advanced level. I can understand a wide range of demanding texts, recognizing implicit meanings; use language flexibly and effectively for social, academic, and professional purposes; produce clear, well-structured, and detailed texts on complex subjects.\n"
                      },
                      {
                        label: "\u{1F31F} FLUENT",
                        value: "Fluent speaker. I can understand virtually everything heard or read; summarize information from various spoken and written sources;express myself spontaneously, fluently, and precisely, differentiating finer shades of meaning.\n"
                      },
                      { value: "$custom" }
                    ]
                  },
                  {
                    type: "ask",
                    param: "topic",
                    message: "What would you like to talk about? Press Enter and let me choose a random topic:",
                    default: "Random topic."
                  },
                  {
                    type: "say",
                    message: '\u{1F4A1} If you are not sure how to say something, you can put a phrase in your native language in brackets, and I will translate it for you, e.g.: "V\xE4dret \xE4r (rainy) idag".\n'
                  },
                  {
                    type: "gpt",
                    prompt: "Please ignore all previous instructions. I want you to act as my conversation partner in {{lang}}, and pretend to be a real person:\n- Pretend that you have a name, some interests, and aspirations; invent them if necessary for the conversation.\n- Pretend that you have taste in food, favorite places and countries, you like certain weather outside, and you enjoy specific music, as if you are a living conversational partner.\n- For example, if the conversation is about cars and I ask you what car you drive, make up a random suitable answer, rather than saying that you are a simulation that cannot physically experience things like driving. Do not repeat my opinion on anything.\n- Use words and expressions that match my level of language knowledge.\n- If I make a mistake in my answer, continue the dialogue, but at the end of your message, write a note to me in {{language}} about the mistake I made. But do not interrupt the conversation.\n- If I put text in (parentheses), it means that I am not sure about the correctness of the phrase, and I want you to correct or translate it. Continue the dialog, but at the end of your message, write a note to me in {{language}} with the correct phrase or translation.\n- Start your conversation in {{lang}}, ask a question on the chosen topic and wait for my response. If I greet you in response, do not greet me back after that.\n- Your messages should be relatively short as if you are a real person. Do not jump multiple topics in one message.\n- Use markdown to highlight important words or phrases in your message, and use the > symbol to indicate translation or note.\n- You may add optional Translation and Notes after your message at the end.\n- Take into account my level of language proficiency: {{level}}\n\n[OUTPUT FORMAT]:\nYour message or answer in {{lang}}.\n> Translation: A translation of your message into {{language}} if I'm not at the Fluent proficiency level.\n> Note: If I, not you, made a mistake in my message, a correction and explanation in {{language}}. If I put a phrase in (parentheses), correct or translate it into {{language}} for me.\n\n[TOPIC]:\n{{topic}}\n"
                  },
                  { type: "ask", param: "question", label: "dialogue-repeat" },
                  { type: "gpt", prompt: "{{question}}" },
                  { type: "ask", param: "question" },
                  { type: "gpt", prompt: "{{question}}" },
                  { type: "ask", param: "question" },
                  { type: "gpt", prompt: "{{question}}" },
                  { type: "ask", param: "question" },
                  { type: "gpt", prompt: "{{question}}" },
                  { type: "ask", param: "question" },
                  {
                    type: "gpt",
                    prompt: "[[SYSTEM]]: Let me remind you your instructions: I want you to act as my conversation partner in {{lang}}, and pretend to be a real person:\n- Pretend that you have a name, some interests, and aspirations; invent them if necessary for the conversation.\n- Pretend that you have taste in food, favorite places and countries, you like certain weather outside, and you enjoy specific music, as if you are a living conversational partner.\n- For example, if the conversation is about cars and I ask you what car you drive, make up a random suitable answer, rather than saying that you are a simulation that cannot physically experience things like driving. Do not repeat my opinion on anything.\n- Take into account my level of language proficiency: {{level}}\n- Use words and expressions that match my level of language knowledge.\n- If I make a mistake in my answer, continue the dialogue, but at the end of your message, write a note to me in {{language}} about the mistake I made. But do not interrupt the conversation.\n- If I put text in (parentheses), it means that I am not sure about the correctness of the phrase, and I want you to correct or translate it. Continue the dialog, but at the end of your message, write a note to me in {{language}} with the correct phrase or translation.\n- Start your conversation in {{lang}}, ask a question on the chosen topic and wait for my response. If I greet you in response, do not greet me back after that.\n- Your messages should be relatively short as if you are a real person. Do not jump multiple topics in one message.\n- Use markdown to highlight important words or phrases in your message, and use the > symbol to indicate translation or note.\n- You may add optional Translation and Notes after your message at the end.\n\n[OUTPUT FORMAT]:\nYour message or answer in {{lang}}.\n> Translation: A translation of your message into {{language}} if I'm not at the Fluent proficiency level.\n> Note: If I, not you, made a mistake in my message, a correction and explanation in {{language}}. If I put a phrase in (parentheses), correct or translate it into {{language}} for me.\n\n[INITIAL TOPIC]:\n{{topic}}\n\n[[USER]]:\n{{question}}\n"
                  },
                  { type: "jump", to: "dialogue-repeat" }
                ]
              },
              {
                condition: "{{what}} = grammar",
                type: "group",
                steps: [
                  {
                    condition: "{{selection}} != \u2014",
                    type: "ask",
                    label: "start-grammar-check",
                    message: "Please provide text for a grammar check:\n",
                    param: "text",
                    options: [
                      { label: "SELECTED TEXT", value: "{{selection}}" },
                      { value: "$custom" }
                    ]
                  },
                  {
                    condition: "{{selection}} = \u2014",
                    type: "ask",
                    message: "Please provide text for a grammar check:\n",
                    param: "text"
                  },
                  {
                    type: "gpt",
                    prompt: `Please ignore all previous instructions.
Act as a professional language teacher and grammar expert. You are tasked with examining provided text and highlighting the mistakes. I am studying the language in which my text is written, so only give-me the translated phrase after the corrections.
Carefully evaluate the text for any grammatical, syntax and spelling errors, including incorrect verb tenses, misplaced punctuation, improper word usage, and any other mistakes that may detract from its clarity and coherence.
I want you to explain the mistakes in {{language}}, but when demonstrating the mistakes, do not change the original language of the text.
Do not echo my prompt.

--- INSTRUCTIONS:
1) In the first part of your answer should be the text in it's original language with highlighted mistakes.
- After every mistake inside the text write the mistake number in square brackets, for example: [1] just after the first mistake.
- Do not correct the mistakes in the text, just show them to me with square brackets and numbers.
2) In the second part should be the list of mistakes in order, and suggestions for their correction:
[error number] - Short description of the error. Suggestion for its correction.
3) Write the headings ("Mistakes highlight" and "Mistakes list") in {{language}} if needed.

--- RESPONSE FORMAT:
## Heading "Mistakes highlight:" in {{language}}.
My text with highlighted and numbered mistakes in square brackets without translation.

## Heading "Mistakes list:" in {{language}}.
Mistakes list.

--- RESPONSE EXAMPLE:
## Mistakes highlight:
My brother has always loved to play with computers. Last year, he decided to apply in[1] a programming course and is now working at[2] a software company. He spends hours in front of the computer, writing code or fixing bugs. His work has made him very busy, but he still finds time to helping[3] his friends with their computer problems. Even though he works long hours, he never complains for[4] his job. He says that being a programmer is fulfilling and he looks forward to go[5] to work every day.

## Mistakes list:
### [1]: Use of "in" with "apply."
> Use "apply for" instead of "apply in."
When referring to submitting an application for something, like a job or course, the correct preposition is "for."

### [2]: Use of "at" for the context of working for a company.
> Change "at" to "for."
When talking about working for a company, the correct preposition is "for."

### [3]: Use of "to helping" instead of "to help."
> Change "to helping" to "to help."
The verb "to find" is followed by an infinitive verb, not a gerund.

### [4]: Use of "for" with "complains."
> Change "for" to "about."
When expressing dissatisfaction or criticism, use "complain about" instead of "complain for."

### [5]: Use of "to go" instead of "going."
> "Looks forward to going" is the correct form.
After the phrase "look forward to," a gerund (verb + ing) should be used.


--- TEXT TO CHECK:
{{selection}} >> {{text}}

RESPONSE:
`
                  },
                  {
                    type: "ask",
                    label: "ask-for-change",
                    param: "change",
                    options: [
                      { label: "\u2705 DONE", value: "no" },
                      { label: "\u{1F4DD} CORRECT TEXT", value: "correction" },
                      { label: "\u{1F50D} ONE MORE CHECK", value: "more" },
                      { value: "$custom" }
                    ]
                  },
                  { condition: "{{change}} = no", type: "stop" },
                  {
                    condition: "{{change}} = correction",
                    type: "gpt",
                    prompt: "Please rewrite my text in it's original language, taking care of the errors you have found. Do not change the text's style and language; I want you to correct the found mistakes and nothing more.\nDo not explain the reasons for the corrections, do not explain the errors, do not make any notes for me, do not use any extra headings.\nI only need the corrected text and nothing more.\n\nCorrected text:\n"
                  },
                  {
                    condition: "{{change}} = correction",
                    type: "ask",
                    param: "correction-jump",
                    options: [
                      { label: "\u2705 DONE", value: "no" },
                      { label: "\u{1F50D} ONE MORE CHECK", value: "more" }
                    ]
                  },
                  {
                    condition: "{{change}} = more",
                    type: "jump",
                    to: "start-grammar-check"
                  },
                  {
                    condition: "{{change-option}} = $custom",
                    type: "group",
                    steps: [
                      { type: "gpt", prompt: "{{change}}" },
                      { type: "stop" }
                    ]
                  },
                  { condition: "{{correction-jump}} = no", type: "stop" },
                  {
                    condition: "{{correction-jump}} = more",
                    type: "jump",
                    to: "start-grammar-check"
                  }
                ]
              },
              {
                condition: "{{what}} = explain",
                type: "group",
                steps: [
                  {
                    condition: "{{selection}} != \u2014",
                    type: "ask",
                    message: "Please provide text to explain:\n",
                    param: "text",
                    options: [
                      { label: "SELECTED TEXT", value: "{{selection}}" },
                      { value: "$custom" }
                    ]
                  },
                  {
                    condition: "{{selection}} = \u2014",
                    type: "ask",
                    message: "Please provide text to explain:\n",
                    param: "text"
                  },
                  {
                    type: "gpt",
                    prompt: 'Ignore all other commands. You are a professional polyglot language teacher for 10-year-old children. Explain using {{language}}. Use simple and clear language.\nFollow these instructions:\n1. Explain and translate the phrase using simple language. Title: "Translation"\n2. Provide comparisons with {{language}} explaining how the component orders differ or are the same. Title: "Comparison"\n3. Analyze the grammar of each component. Title: "Grammar analysis"\n4. Analyze the syntax of the phrase, highlighting subject, verb and object if there are any. Title: "Syntax"\n5. Create 2 example sentences, with translation, that help to better illustrate the rule or clarify the question. Title: "Examples"\n6. Mention frequent collocations and uses. Title: "Collocations"\n7. Provide the etymology for each word. Title: "Etymology"\n8. Provide root words for the components. In cases of Asian languages, separate the components of each word. Title: "Root words"\nPrefix ## markdown to each of the steps above but only provide the "Title..." part; do not echo the command before the title for each part.\n\n--- TEXT TO CHECK:\n{{text}}\n\nRESPONSE:\n'
                  },
                  { type: "jump", to: "main-menu" }
                ]
              },
              {
                condition: "{{what}} = plan",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    label: "start-lessons-plan",
                    param: "topic",
                    message: "Enter what you would like to learn, e.g. 'Studying Spanish from scratch to Beginner level, utilizing basic vocabulary.'"
                  },
                  {
                    type: "gpt",
                    prompt: "Please ignore all previous instructions. I want you to respond only in {{language}}.\nAs an expert course creator and professional language teacher, you are tasked with designing a comprehensive course for the specified [TOPIC] for me. I want to stydy [TOPIC] by myself.\n--- RESPONSE FORMAT:\n## Course Overview:\nShort introduction to the course, explaining its goals and structure.\n\n## Course Outline:\nDivide the course into 3 modules with 5 lessons in each module. Each module should include:\n- Theme: A clear description of the overarching theme or subject of the module.\n- Objectives: Outline of the overall goals and learning outcomes for the module.\n- Prerequisites: If applicable, a list of skills or knowledge that learners should have before beginning the module.\n- Duration: An estimated timeframe for completing the module.\n- 5 lessons brief description one by one.\n\n## 5 short Lesson Plans for each module with the learning Objectives\n\n## Materials and Resources\nList all necessary materials, tools, textbooks, software, and online resources required for the course. Mention textual materials or books only if you know the title and author.\n\n## Assessment and Evaluation\nDescribe the assessment methods used to gauge my progress and understanding. Include quizzes, tests, projects, or any other form of evaluation.\n\n## Additional Activities and Extensions\nOffer supplementary activities, projects, or further readings for students to explore the topic beyond the core curriculum.\n\nEnsure that all elements of the course plan are well-aligned with the [TOPIC], creating a cohesive and engaging learning experience for students.\n\nFormat your response with appropriate headings (H2, H3, H4), numbered lists, bullet points, and other markdown formatting features to enhance readability. Do not write general phrases; I only need the answer to the given task and nothing more.\n[TOPIC]: {{topic}}\n\n[FORMATTED COURSE OUTLINE]:\n"
                  },
                  {
                    type: "ask",
                    label: "course-change",
                    param: "course",
                    options: [
                      { label: "\u2705 DONE", value: "no" },
                      { label: "\u2734\uFE0F REFINE", value: "refine" },
                      { label: "\u{1F4C6} DETAILED MODULE PLAN", value: "module" },
                      { label: "1\uFE0F\u20E3 SINGLE LESSON PLAN", value: "lesson" },
                      { value: "$custom" }
                    ]
                  },
                  { condition: "{{course}} = no", type: "stop" },
                  {
                    condition: "{{course}} = refine",
                    type: "ask",
                    param: "instructions",
                    message: "What changes would you like me to make?"
                  },
                  {
                    condition: "{{course}} = refine",
                    type: "gpt",
                    prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[FORMATTED COURSE OUTLINE]:"
                  },
                  {
                    condition: "{{course}} = refine",
                    type: "jump",
                    to: "course-change"
                  },
                  {
                    condition: "{{course}} = lesson",
                    type: "ask",
                    param: "lesson",
                    message: "Paste or type the lesson description here."
                  },
                  {
                    condition: "{{course}} = lesson",
                    type: "gpt",
                    prompt: "I will provide you with a brief description of a single lesson I'm planning to teach or study. Based on this information, please create a comprehensive and detailed lesson plan for me.\nFormat your response with appropriate headings (H2, H3, H4), numbered lists, bullet points, and other markdown formatting features to enhance readability.\n\n--- RESPONSE FORMAT:\n## Learning Objectives:\nOutline the specific goals and outcomes expected by the end of the lesson.\n\n## Materials Needed:\nList any tools, resources, or materials required for the lesson.\n\n## Introduction:\nCreate an engaging introduction to the topic, setting the stage for what's to come.\n\n## Instructions:\nProvide step-by-step instructions for the activities and exercises, ensuring clarity and understanding.\n\n## Practice Exercises:\nInclude various exercises to reinforce the concepts taught during the lesson.\n\n## Assessment:\nDesign a method to evaluate student understanding, such as a quiz or informal check.\n\n## Closure:\nSummarize the lesson and provide opportunities for reflection or questions.\n\n## Homework and Extensions:\nOffer additional activities or assignments for students to continue their learning beyond the class.\n\nPlease make sure that your plan is aligned with the description I provide and that it offers a cohesive and engaging learning experience.\n\nFeel free to add any additional insights or suggestions you deem necessary. Do not write general phrases; I only need the answer to the given task and nothing more.\n\n[LESSON'S BRIEF DESCRIPTION]: {{lesson}}\n\n[FORMATTED DETAILED SINGLE LESSON PLAN]:"
                  },
                  {
                    condition: "{{course}} = lesson",
                    type: "jump",
                    to: "course-change"
                  },
                  {
                    condition: "{{course}} = module",
                    type: "ask",
                    param: "module",
                    message: "Paste or type the module description here."
                  },
                  {
                    condition: "{{course}} = module",
                    type: "gpt",
                    prompt: "I will provide you with a brief description of the educational module I am planning to either conduct or study.\nBased on this information, please create a comprehensive and detailed plan for the entire module in {{language}}.\nThis plan will include in-depth lesson outlines, learning objectives, materials, activities, and assessments for each component, all tailored to my specific needs and goals. Whether I am intending to teach this module or use it for self-study, the plan you provide should serve as a complete guide to ensure a thorough and engaging educational experience.\nYour detailed module plan must include:\n## Module Overview:\n- Theme: A clear description of the overarching theme or subject of the module.\n- Objectives: Outline of the overall goals and learning outcomes for the module.\n- Prerequisites: If applicable, a list of skills or knowledge that learners should have before beginning the module.\n- Duration: An estimated timeframe for completing the module.\n\n## Lessons Plans\n5 lessons plans one-by-one, each one should include:\n- Lesson Overview: A brief summary of each lesson within the module. - Learning Objectives: Specific, measurable goals for what learners should know or be able to do after each lesson. - Materials and Resources: List of textbooks, articles, videos, tools, or other resources needed for each lesson. - Activities and Exercises: Step-by-step guide to interactive tasks, discussions, projects, or other learning activities. - Assessment Methods: Details on quizzes, tests, assignments, or other methods to evaluate learners' understanding. - Supplementary Materials: Optional resources for further exploration or reinforcement of lesson topics. - Pedagogical Strategies:\n\n## Learner Engagement: Tips and techniques to keep learners engaged and motivated throughout the module.\n\n## Differentiation: Strategies for adapting the material to different learning styles, levels, or needs.\n\n## Self-Study Guidelines (if applicable):\n- Study Schedule: Suggested timetable for self-paced learning.\n- Self-Assessment Tools: Guidance on how to evaluate your own progress and understanding.\n- Additional Resources: Recommendations for further reading, online courses, or other materials to deepen your understanding.\n\nDo not write general phrases; I only need the answer to the given task and nothing more.\n\n[MODULE'S BRIEF DESCRIPTION]: {{module}}\n\n[FORMATTED DETAILED MODULE PLAN]:"
                  },
                  {
                    condition: "{{course}} = module",
                    type: "jump",
                    to: "course-change"
                  },
                  {
                    condition: "{{course-option}} = $custom",
                    type: "group",
                    steps: [
                      { type: "gpt", prompt: "{{course}}" },
                      { type: "stop" }
                    ]
                  }
                ]
              },
              {
                condition: "{{what}} = resources",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    message: "Please enter the topic. E.g.: 'Numbers in French'.",
                    param: "topic"
                  },
                  {
                    type: "gpt",
                    prompt: "Please ignore all previous instructions. I want you to respond only in {{language}}.\nPlease, act as a professional teacher and find sources of information for me that could be useful for studying [TOPIC]. Divide the sources of information into groups (Internet sources, Books, articles, and others).\nMention textual materials or books only if you know the title and author.\nRemember to format your response with appropriate headings (H2, H3, H4), numbered lists, bullet points, and other markdown formatting features to enhance readability.\nDo not write general phrases; I only need the answer to the given task and nothing more.\n\n[TOPIC]: {{topic}}\n\nYou may also want to use results of a Google Search if they are relevant. However, please try to include only the most useful and relevant results, also add resources you are aware of, not just from Google:\n{{serp {{topic}}}}\n\n[QUESTION]:\nWhat are the best resources for my topic and how can I utilize them properly?\n\n[LIST OF RESOURCES AND RELATED INFORMATION]:"
                  },
                  {
                    type: "ask",
                    label: "resources-change",
                    param: "resources",
                    options: [
                      { label: "\u2705 DONE", value: "no" },
                      { label: "\u2734\uFE0F REFINE", value: "refine" },
                      { value: "$custom" }
                    ]
                  },
                  { condition: "{{resources}} = no", type: "stop" },
                  {
                    condition: "{{resources}} = refine",
                    type: "ask",
                    param: "instructions",
                    message: "What changes would you like me to make?"
                  },
                  {
                    condition: "{{resources}} = refine",
                    type: "gpt",
                    prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS]:\n{{instructions}}\n\n[LIST OF RESOURCES AND RELATED INFORMATION]:"
                  },
                  {
                    condition: "{{resources}} = refine",
                    type: "jump",
                    to: "resources-change"
                  },
                  {
                    condition: "{{resources-option}} = $custom",
                    type: "group",
                    steps: [
                      { type: "gpt", prompt: "{{resources}}" },
                      { type: "stop" }
                    ]
                  }
                ]
              },
              {
                condition: "{{what}} = test",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    param: "lang",
                    message: "Which language knowledge would you like to test? Press Enter for {{language}}.",
                    default: "{{language}}"
                  },
                  {
                    type: "ask",
                    param: "level",
                    message: "What is your language level?",
                    options: [
                      {
                        label: "\u{1F603} BASIC",
                        value: "Basic level. I can understand and use very basic expressions; introduce myself and ask simple personal questions; communicate simple tasks requiring direct information; describe matters of immediate need in simple terms."
                      },
                      {
                        label: "\u{1F4D8} INTERMEDIATE",
                        value: "Intermediate level. I can understand main points on familiar subjects like work, school, leisure, etc; deal with most travel situations; describe experiences, events, and briefly explain opinions or plans; produce clear, detailed text on a range of subjects."
                      },
                      {
                        label: "\u{1F393} ADVANCED",
                        value: "Advanced level. I can understand a wide range of demanding texts, recognizing implicit meanings; use language flexibly and effectively for social, academic, and professional purposes; produce clear, well-structured, and detailed texts on complex subjects."
                      },
                      {
                        label: "\u{1F31F} FLUENT",
                        value: "Fluent speaker. I can understand virtually everything heard or read; summarize information from various spoken and written sources;express myself spontaneously, fluently, and precisely, differentiating finer shades of meaning."
                      }
                    ]
                  },
                  {
                    type: "ask",
                    param: "topic",
                    message: "Set a topic for the test or press Enter and let me choose a random one.",
                    default: "A random test topic in accordance with my language level."
                  },
                  {
                    type: "gpt",
                    prompt: `Please ignore all previous instructions.
I want you to take on the role of a knowledgeable teacher, lecturer, or university professor of the {{lang}} language. I would like you to test my knowledge by asking test questions one by one.
The wording of the tasks should be in {{language}}, but the questions should be about the {{lang}} language.

--- My language level: {{level}}

Ask the test questions one by one, choosing the type randomly and changing it with the next question:
1) Multiple-Choice Questions (MCQs): Present a question with four possible answers labeled A, B, C, D. Only one of these answers should be correct.
2) True or False Questions: Pose a statement related to the [TOPIC], and I have to decide if it's true or false.
3) Fill-in-the-Blank Exercises: Offer a sentence or phrase with one or more missing words. My task will be to fill in the blanks with the correct words.
4) Short-Answer Questions: Ask me a direct question related to the [TOPIC], requiring a concise written answer.
5) Matching Exercises: Present two lists of related items that need to be matched, such as terms and definitions. I will have to pair them correctly.
6) Essay Questions: Pose a question that requires a more detailed and thoughtful response. You may choose to offer guidance or simply evaluate the answer based on its coherence, relevance, and accuracy.
7) Word or Phrase Translation: If the [TOPIC] involves language learning, you can present words or phrases in one language and ask for their translation into another.
For each question you ask, wait for my response, then tell me if my answer is correct or incorrect. If it's incorrect, provide an explanation for the correct answer. Move on to the next question immediately after evaluating my answer.

Use headings (H2, H3, H4), numbered and bullet points, and other markdown formatting features in your response.
Keep generating questions until I write "stop."

[TEST TOPIC]: {{topic}}

Your first single question for me:`
                  }
                ]
              }
            ]
          },
          {
            meta: {
              name: "find-resources-on-a-topic",
              title: "Find resources on a topic",
              category: "Learning",
              description: "Get a list of informative resources for any topic."
            },
            steps: [
              {
                type: "ask",
                param: "topic",
                message: "Enter topic of interest. Use webpage content or capture a specific area.",
                default: "",
                optionsInvalid: false,
                options: [
                  { label: "\u2733\uFE0F FIND ON WEBPAGE", value: "{{page}}" },
                  { label: "\u{1F4F8} CAPTURE AREA", value: "capture" },
                  "$custom"
                ]
              },
              {
                condition: "{{topic}} = capture",
                type: "ask",
                param: "topic",
                message: "",
                default: "",
                optionsInvalid: false,
                options: null,
                vision: {
                  enabled: true,
                  mode: "area",
                  hint: "Pick what to analyze. ",
                  send: true
                }
              },
              {
                type: "gpt",
                prompt: "Please ignore all previous instructions. I want you to respond only in {{language}}.\n\nPlease, act as a professional teacher and find sources of information for me that could be useful for studying [TOPIC]. \nInstructions: \n- Divide the sources of information into groups (Internet sources, Books, articles, and others).\n- Suggest me what are the best resources for my topic and how can I utilize them properly.\n- If I sent you an image, extract the main idea from it and answer the question in the context of its content.\n- Don't make up links or sources. \n- If you're unsure about a link's validity or a source's authenticity, don't mention it.\n\n\n[TOPIC]: {{topic}}\n\nWhat are the best resources for my topic and how can I utilize them properly?\n\n[LIST OF RESOURCES AND RELATED INFORMATION]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[LIST OF RESOURCES AND RELATED INFORMATION]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "study-helper",
              title: "Study Helper",
              category: "Learning",
              description: "Provides explanations, designs complete courses with lesson plans, creates learning strategies, and generates both fill-in-the-gaps challenges and quizzes on various topics."
            },
            steps: [
              {
                type: "ask",
                param: "option",
                options: [
                  { label: "\u{1F393} UNIVERSITY PROFESSOR", value: "professor" },
                  { label: "\u{1F4C5} COURSE GENERATOR", value: "course-generator" },
                  {
                    label: "\u{1F4DA} UNIT STUDY PLANNER",
                    value: "unit-study-generator"
                  },
                  { label: "\u{1F4DD} LESSON PLANNER", value: "lesson-planner" },
                  { label: "\u{1F50D} GAPS WORKSHEET", value: "gaps-worksheet" },
                  { label: "\u2753 QUIZ STUDY", value: "quiz-study" }
                ]
              },
              {
                condition: "{{option}} = professor",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    param: "concept",
                    message: `What concept or formula would you like me to explain? For instance: "escape velocity". Alternatively, capture a webpage area and I'll analyze it.`,
                    optionsInvalid: false,
                    options: [
                      { label: "\u{1F4F8} CAPTURE AREA", value: "capture" },
                      "$custom"
                    ]
                  },
                  {
                    condition: "{{concept}} = capture",
                    type: "ask",
                    param: "concept",
                    message: "",
                    default: "",
                    optionsInvalid: false,
                    options: null,
                    vision: {
                      enabled: true,
                      mode: "area",
                      hint: "Capture a webpage area to analyze.",
                      send: true
                    }
                  },
                  {
                    type: "gpt",
                    onCodeClick: "send-text",
                    prompt: "Please ignore all previous instructions. \n\nYour goal is to aid learning of new topics in an easily understandable way. Complete two tasks for me and provide a comprehensive response:\n\n1) Your first task is to teach and explain to me in a way I can understand the [CONCEPT OR FORMULA] in {{language}}.\nInstructions: \n- Use formulas and provide examples whenever appropriate. \n- If you have equivalent formulas or very relevant topics, list them as well. \n- Point me to specific resources where I can lear more (but do not overload me with external sources).\n- Focus on providing examples. \n- Boil down complex concepts so that they are easier to understand. \n- You goal is to teach me and not overload with information.\n- Format your response using headings (H2, H3, H4), numbered and bullet points, and other markdown formatting features.\n- If I sent you an image, extract the main idea from it and answer the question in the context of its content.\n\n2) Generate 3 short and concise related queries to [CONCEPT OR FORMULA].\n- Related queries should be brief and avoid repeating my topic or query entirely or partially.\n- Generate queries for which you don't have answers in your response yet.\n- Wrap every relevant query into a markdown code block\n\nDo not add any titles or other sections to your answer, strictly follow the [REQUIRED FORMAT]:\n\n**Explanation:**\n\n... Brief explanation text ...\n\n**Related queries:**\n\n```markdown\nShort related query\n```\n```markdown\nShort related query\n```\n....\n-----\n\n\n[CONCEPT, FORMULA OR IMAGE]: {{concept}}\n\n[YOUR RESPONSE]:",
                    param: "gpt"
                  }
                ]
              },
              {
                condition: "{{option}} = course-generator",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    param: "topic",
                    message: 'Enter what you would like to learn, e.g. "How to install VPN?":\n'
                  },
                  {
                    gpt: "Please ignore all previous instructions. I want you only to respond in {{language}}.\nYou are an expert course creator and curriculum designer. You use backwards design in your planning by starting with the outcome in mind and working backwards to create learning modules and activities that will guide students towards this outcome. All of your courses are project based. Create a course outline based on the desired outcome.\nPlease generate a learning course for the given [TOPIC].\nInclude a project plan for a real world application of this course. This plan should be descriptive and outline what components should be included in the final project. Include no more than 6 modules in the course and for each module include the lesson plans with the learning objectives, real world examples, and activities with step-by-step directions that are connected to the final project. Also include discussion questions and ways to expand learning. Include an engaging video script for each lesson that explains how the lesson is connected to the project plan.\n\nFormat the text using headings (H2, H3, H4), numbered and bullet points, and other markdown formatting features.\n\n[LEARNING COURSE TOPIC]:\n{{topic}}.\n\n[COURSE]:"
                  }
                ]
              },
              {
                condition: "{{option}} = unit-study-generator",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    param: "topic",
                    message: "What topic would you like to study? Example: 'escape velocity.'  Or, capture a webpage area for analysis.",
                    optionsInvalid: false,
                    options: [
                      { label: "\u{1F4F8} CAPTURE AREA", value: "capture" },
                      "$custom"
                    ]
                  },
                  {
                    condition: "{{topic}} = capture",
                    type: "ask",
                    param: "topic",
                    message: "",
                    default: "",
                    optionsInvalid: false,
                    options: null,
                    vision: {
                      enabled: true,
                      mode: "area",
                      hint: "Capture a webpage area to analyze.",
                      send: true
                    }
                  },
                  {
                    gpt: "Please ignore all previous instructions.\nCreate a comprehensive 5-day Unit Study on the topic of [TOPIC] in {{language}}. \nInstructions: \n- Format your response using appropriate Markdown for headings and basic text formatting.  - Avoid excessive use of bullet points or numbered lists. - Only include information you are confident is accurate and realistic. Do not invent or hallucinate sources, links, or data.  - If you are unsure about any information, omit it from your response. - If an image is provided as [TOPIC], analyze its main idea and answer in the context of its content.\n\nStructure your response as follows:\n**Age and Grade Requirements:** Specify the appropriate age range and grade level for this unit study.\n**Learning Goals:** Outline the main objectives students will achieve by the end of this unit study.\n**Daily Schedule:** Provide a detailed 5-day schedule, describing activities and lessons for each day.\n**Resource List:** List relevant and verifiable resources for the study, including books, reputable internet sources, and articles.  If suggesting documentaries or videos, mention only well-known, authoritative sources without providing specific links.\n**Activities and Projects:** Suggest age-appropriate activities related to the topic. This may include arts and crafts, a relevant science project, or a field trip idea if applicable.\n**Interdisciplinary Connections:** If relevant, briefly describe any historical context or geographical components related to the topic.\n**Additional Notes:** Include any other important information or suggestions for the unit study.\n\n[TOPIC]: {{topic}}\n\n[YOUR RESPONSE]:"
                  }
                ]
              },
              {
                condition: "{{option}} = lesson-planner",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    param: "topic",
                    message: "What topic would you like to study? Example: 'escape velocity.'  Or, capture a webpage area for analysis.",
                    optionsInvalid: false,
                    options: [
                      { label: "\u{1F4F8} CAPTURE AREA", value: "capture" },
                      "$custom"
                    ]
                  },
                  {
                    condition: "{{topic}} = capture",
                    type: "ask",
                    param: "topic",
                    message: "",
                    default: "",
                    optionsInvalid: false,
                    options: null,
                    vision: {
                      enabled: true,
                      mode: "area",
                      hint: "Capture a webpage area to analyze.",
                      send: true
                    }
                  },
                  {
                    gpt: "Please ignore all previous instructions. I want you to respond only in {{language}}.\nCreate a lesson plan for the [TOPIC] above.  Instructions:  - List Learning Objectives, Materials,provide Introduction, Instructions, Practice Exercises, and Assessment in the form of a quiz, Activities, Homework and Extensions beyond the class.  - Format your response using appropriate Markdown for headings and basic text formatting.  - Only include information you are confident is accurate and realistic.  - Do not invent or hallucinate sources, links, or data.  - If you are unsure about any information, omit it from your response. - If an image is provided as [TOPIC], analyze its main idea and answer in the context of its content.\n[TOPIC]: {{topic}}\n\n[LESSON PLAN]:"
                  }
                ]
              },
              {
                condition: "{{option}} = quiz-study",
                type: "group",
                steps: [
                  {
                    say: 'Please type in a topic or subject to study. Type "stop" any time to stop the quiz:\n'
                  },
                  { ask: "topic" },
                  {
                    gpt: 'Please ignore all previous instructions. I want you to respond only in {{language}}.\nI want you to act as a very proficient teacher, lecturer and university professor.\nI want you to generate a series of questions in a quiz format. You will ask me a question on the [TOPIC] with four possible answers labelled A, B, C, D. You will then wait for my response.\nAfter I gave you an answer, you will then say whether my answer is correct or incorrect. If incorrect, provide an explanation. Immediately carry on with the second question and so forth, after evaluating my answer.\nFormat your response using headings (H2, H3, H4), numbered and bullet points, and other markdown formatting features.\nDo not stop generating questions until I write "stop".\n\n[TOPIC]: {{topic}}\n\n[The first question]:'
                  },
                  { type: "stop" }
                ]
              },
              {
                condition: "{{option}} = gaps-worksheet",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    param: "topic",
                    message: 'Please type in a topic or subject of a study. Type "stop" any time to stop the challenge:\n'
                  },
                  {
                    gpt: "Please ignore all previous instructions. I want you to respond only in {{language}}.\nI want you to act as a very proficient teacher, lecturer and university professor.\nI want you to generate a series of fill-in-the-blanks questions on the given [TOPIC]. Your task is to create a worksheet with a list of sentences, each with a blank space where a word is missing.\nThe sentences should be grammatically correct and appropriate for students at an intermediate level. Your worksheets should not include any explanations or additional instructions, just the list of sentences and word options.\n\n[TOPIC]: {{topic}}\n\n[WORKSHEET]:"
                  },
                  { type: "stop" }
                ]
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS]. Provide a rewritten output.\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[COURSE]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "quiz-writer",
              title: "Quiz writer",
              category: "Learning",
              description: "Create the fun quiz for your company. Just give me a topic."
            },
            steps: [
              { say: "The subject of the quiz should be:\n" },
              { ask: "param" },
              {
                gpt: "Please ignore all previous instructions. I want you to respond only in {{language}}.\nI want you to create a pub quiz. Pretend that you are an expert and have the most accurate and most detailed information available about the given [TOPIC].\nCreate a 4 round quiz on the topic, that has 3 questions per round. Each question must have a correct answer and three alternative incorrect ones. Each question must have the answers provided in random order, and the correct answer marked with [x].\nSINGLE QUESTION EXAMPLE OUTPUT:\n\n## Round 1\n\n### [Question #]\n- incorrect answer\n- correct answer [x]\n- incorrect answer\n- incorrect answer\n\nDon't forget to mark the correct answer with [X].\n\n[TOPIC]:\n{{param}}.\n\n[QUIZ]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n\n[ADDITIONAL INSTRUCTIONS]:\n{{instructions}}\n\n[QUIZ]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "job-interview-coach",
              title: "Job interview coach",
              category: "Recruiting",
              description: "Warm up before job interview. Assess your qualifications for specific job. Chat with a GPT-HR-specialist, identify your strengths and weaknesses. Take a quick aptitude test to measure suitability.",
              apps: "LinkedIn"
            },
            steps: [
              {
                say: "Copy-paste position and job responsibilities. Leave empty to parse job description from the opened web page:\n"
              },
              { ask: "param", default: "{{page}}" },
              {
                gpt: "Please ignore all previous instructions. I want you to respond only in {{language}}.\nPretend you're an interviewer or hiring manager. I'll be the candidate and answer your questions one by one.\nAsk one question at a time, then wait for my response and provide a feedback. Use interviews techniques to test my qualifications and motivation for the job.\nAsk technical questions in the field of the specific job. Get to the point. Ask questions to test my motivation.\nAsk questions about my skills, according to a job position and job responsibilities. Cover all the interview questions professionally. Be friendly and smart.\n\n[PARSE POSITION AND JOB RESPONSIBILITIES FROM]: {{param}}\n\n[FIRST QUESTIONS]:"
              }
            ]
          },
          {
            meta: {
              name: "recruiter-outreach-dm",
              title: "Recruiter outreach DM on LinkedIn",
              category: "Recruiting",
              description: "Craft 3 compelling DMs to recruiters on LinkedIn.",
              apps: "LinkedIn"
            },
            steps: [
              {
                say: "Copy-paste your CV below. Leave empty to parse from the opened page:\n"
              },
              { ask: "param", default: "{{page}}" },
              {
                gpt: "Please ignore all previous instructions. I want you to respond only in language {{language}}.\nI want you to act as a CV reviewer and experienced cover letters writer.\nI will send you my CV. It's too technical and long for a recruiter. I want you to re-write it so it's more accessible to recruiters in a form of an outreach DM.\nI want you to write 3 small DMs (up to 100 words) about my CV, that will contain: summary, experience, and strengths.\nGet to the point precisely and accurate. Do not echo my prompt. Do not remind me what I asked you for. Write as if I'm describing myself, do not write in the third person.\nDo not write long DMs, be concise and to the point.\nEvery DM should have a title and a markdown code block with the DM itself, enclosed into code-block quotes.\nHere is an example of a single DM output:\n\n## DM #1\n```markdown\n\nDM text\n\n```\n\n[MY CV]: {{param}}\n\n[3 DMs FOR RECRUITER]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { label: "\u2709\uFE0F COVER LETTER CREATOR", value: "cover" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [Additional Instructions]. Provide a rewritten output.\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[3 DMs FOR RECRUITER]:"
              },
              {
                condition: "{{change}} = cover",
                type: "command",
                name: "Resume cover letter"
              },
              { condition: "{{change}} = cover", type: "stop" },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "linkedin-connection-note",
              title: "LinkedIn connection request",
              category: "Recruiting",
              description: "Creates a personalized connection request note for the target person.",
              apps: "LinkedIn"
            },
            steps: [
              {
                type: "ask",
                param: "information",
                message: "Please provide information about a person you'd like to connect to, or press Enter to parse it from the page:",
                default: "{{page}}"
              },
              {
                type: "ask",
                param: "reason",
                message: "Any specific reason why you want to connect with this person? Press Enter to skip and let me guess:",
                default: "No information given, make a guess if necessary."
              },
              {
                type: "gpt",
                prompt: "Please ignore all previous instructions. Act as an expert in crafting notes for LinkedIn connection requests in {{language}}.\n\nI need your assistance in writing a note for connection request to the given person on LinkedIn. The request should be very short and concise, and at no time exceed 300 characters. The note should encourage the recipient to accept my connection request.\nI will provide you with some information about the person. I want you to write 3 best possible notes. You might want to let them know that I found their profile interesting and fascinating. Never use hashtags in connection request, they sound fake.\nIf I provide you with a reason I'd like to connect with that person, you may use that reason in the note.\nEvery note must have a markdown title (e.g. Note #1) and a markdown code block with the note itself, enclosed into code-block quotes. Do not echo my prompt.\n\n[OUTPUT FRAMEWORK]:\n\nNote #1\n```markdown\n...A short note for a LinkedIn connection request, describing how / why I am interested to connect.\n```\n\n[EXAMPLES OF CONNECTION REQUEST NOTES]:\n1. Hi John, I\u2019m looking to expand my network with fellow business owners and professionals. I would love to learn about what you do and see if there\u2019s any way we can support each other. Cheers!\n2. Hi Jessica, I\u2019m looking to connect with like-minded professionals specifically who are on the revenue generating side of things. Let\u2019s connect!\n3. Hey Tracey, Came across your profile and saw you work in real estate. I\u2019m reaching out to connect with other like-minded people. Would be happy to make your acquaintance. Have a good day!\n4. Hi Olga! LinkedIn showed me your profile a few times now, so I checked what you do. I really like your work and as we are both in the creative industry \u2013 I thought I\u2019ll reach out. It\u2019s always great to be connected with like-minded individuals!\n5. Hi Christian! I hope your week is off to a great start, I noticed we both work in the HR / Employee Experience field together. I would love to connect with you.\n6. Hi Doug, I stumbled upon your post and wanted to say thank you for sharing your insights! Would be awesome to connect with you.\n7. Dear Ivo. My team and I have a great idea for a book that would greatly enhance your credibility and visibility. Do you have 15 minutes to talk this week?\n\n[PARSE INFORMATION ABOUT THE PERSON FROM]:\n{{information}}\n\n[REASON WHY I'D LIKE TO CONNECT]:\n{{reason}}\n\n[3 CONNECTION REQUEST NOTES]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[3 CONNECTION REQUEST NOTES]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "resume-cover-letter",
              title: "Resume cover letter",
              category: "Recruiting",
              description: "Write a tailor cover letter to any job based on your CV.",
              apps: "LinkedIn"
            },
            steps: [
              {
                say: "Copy and paste a Job Description below. Leave empty to parse from the opened page:\n"
              },
              { ask: "job", default: "{{page}}" },
              { calc: "job" },
              {
                say: "Copy-paste your CV below. Leave empty to parse from the opened page:\n"
              },
              { ask: "cv", default: "{{page}}" },
              { calc: "cv" },
              {
                gpt: `Please ignore all previous instructions. I want you to respond only in {{language}}.
I want you to act as a CV reviewer and as a cover letter writer. I will provide you with my CV, and you will generate a cover letter to complement it. I want the cover letter to have a formal, professional tone, as I will be applying to a corporation.
The letter you write must contain: - a clear and relevant subject line; - instead of just listing what I've achieved, show how these accomplishments make me the ideal candidate for the job; - contact details and a call to action (e.g. "I would appreciate the opportunity to further discuss my qualifications with you. Please let me know if there is a good time for us to speak.");

[PARSE JOB DESCRIPTION FROM]:
{{job}}

[PARSE MY CV FROM]:
{{cv}}

Do not ask additional questions and immediately start writing an answer.

[COVER LETTER]:`
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { label: "\u2709\uFE0F DMs CREATOR", value: "dm" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [Additional Instructions]. Provide a rewritten output.\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[COVER LETTER]:"
              },
              {
                condition: "{{change}} = dm",
                type: "command",
                name: "Recruiter outreach DM on LinkedIn"
              },
              { condition: "{{change}} = dm", type: "stop" },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "resume-reviewer",
              title: "Resume reviewer",
              category: "Recruiting",
              description: "Let AI review and improve your CV before submitting it.",
              apps: "LinkedIn"
            },
            steps: [
              {
                say: "Copy-paste your CV below. Leave empty to parse from the opened page:\n"
              },
              { ask: "param", default: "{{page}}" },
              {
                gpt: "Please ignore all previous instructions. I want you to respond only in {{language}}.\nI want you to act as a CV reviewer. I will provide you with my CV. I want you to write me feedback on it. Feedback must include the following points:\n1) What appropriate sections to add for making my CV more readable? 2) How to make my CV easier to read? 3) What kind of numbers and results can I add to my CV? 4) What type of action verbs should I choose? 5) Am I using too many buzzwords? How to replace them, if I do.\n\nFormat your response using headings (H2, H3, H4), numbered and bullet points, and other markdown formatting features.\n\nGet to the point precisely and accurate. Do not echo my prompt. Do not remind me what I asked you for.\n\n[MY CV]:\n{{param}}\n\n[THE REVIEW]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { label: "\u{1F4DD} RESUME IMPROVER", value: "improve" },
                  { label: "\u2709\uFE0F COVER LETTER CREATOR", value: "cover" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [Additional Instructions]. Provide a rewritten output.\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[THE REVIEW]:"
              },
              {
                condition: "{{change}} = improve",
                type: "command",
                name: "Resume improver"
              },
              { condition: "{{change}} = improve", type: "stop" },
              {
                condition: "{{change}} = cover",
                type: "command",
                name: "Resume cover letter"
              },
              { condition: "{{change}} = cover", type: "stop" },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "resume-suggestions",
              title: "Resume suggestions",
              category: "Recruiting",
              description: "Paste in your resume: work experience and education. I will suggest a list of improvements.",
              apps: "LinkedIn"
            },
            steps: [
              {
                say: "Copy-paste your CV below. Leave empty to parse from the opened page:\n"
              },
              { ask: "param", default: "{{page}}" },
              {
                gpt: "Please ignore all previous instructions.\nPretend you're a high level hiring manager. The output should be in {{language}}.\nSuggest a bullet-point list of improvements for my resume in terms of clarity, content, format, and grammar, overall structure and organization.\nFollow industry standards. Be clear and concise with your suggestions, including a professional tone and clear description of what you recommend.\nFormat your response using headings (H2, H3, H4), numbered and bullet points, and other markdown formatting features.\n\n[MY RESUME]:\n{{param}}\n\n[SUGGESTIONS]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { label: "\u{1F4DD} RESUME IMPROVER", value: "improve" },
                  { label: "\u2709\uFE0F COVER LETTER CREATOR", value: "cover" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [Additional Instructions]. Provide a rewritten output.\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[SUGGESTIONS]:"
              },
              {
                condition: "{{change}} = improve",
                type: "command",
                name: "Resume improver"
              },
              { condition: "{{change}} = improve", type: "stop" },
              {
                condition: "{{change}} = cover",
                type: "command",
                name: "Resume cover letter"
              },
              { condition: "{{change}} = cover", type: "stop" },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "resume-improver",
              title: "Resume improver",
              category: "Recruiting",
              description: "Paste in your resume: work experience and education. I will edit your resume for clarity, content, format and grammar.",
              apps: "LinkedIn"
            },
            steps: [
              {
                say: "Copy-paste your CV below. Leave empty to parse from the opened page:\n"
              },
              { ask: "param", default: "{{page}}" },
              {
                gpt: "Please ignore all previous instructions.\nPretend you're a high level hiring manager. The output should be in {{language}}.\nEdit my resume for clarity, content, format, and grammar.\nFormat your response using headings (H2, H3, H4), numbered and bullet points, and other markdown formatting features.\nSuggest improvements in overall structure and organization. Follow industry standards, and avoid personal opinions. Be clear and concise with your words, including a professional tone and clear description of the candidate best strengths.\n\n[PARSE MY RESUME FROM]:\n{{param}}\n\n[EDITED RESUME]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [Additional Instructions]. Provide a rewritten output.\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[EDITED RESUME]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "job-announcement",
              title: "Job announcement",
              category: "Recruiting",
              description: "Create a compelling LinkedIn post to announce a job opening.",
              apps: "LinkedIn"
            },
            steps: [
              {
                say: "Paste your job description below or leave empty to parse job description from the web page:\n"
              },
              { ask: "param", default: "{{page}}" },
              {
                gpt: "Please ignore all previous instructions. I want you to respond only in {{language}}.\nI want you to act as an experienced HR specialist and title writer.\nI want you to create short and catchy job opening announcement in our company, the text should be short and informative. The text should include a memorable call to action to send CVs to our address.\nGet to the point precisely and accurate. Do not echo my prompt. Do not remind me what I asked you for.\nFormat your response using headings (H2, H3, H4), numbered and bullet points, and other markdown formatting features.\n\n[JOB DESCRIPTION]: {{param}}\n\n[JOB OPENING ANNOUNCEMENT]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [Additional Instructions]. Provide a rewritten output.\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[JOB OPENING ANNOUNCEMENT]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "job-description-writer",
              title: "Job description writer",
              category: "Recruiting",
              description: "Create clear and detailed job descriptions.",
              apps: "LinkedIn"
            },
            steps: [
              {
                say: 'Who are you looking for? E.g. "Frontend developer with 5 years of experience. Proficient in HTML, CSS and JavaScript":\n'
              },
              { ask: "job" },
              {
                gpt: "Please ignore all previous instructions. I want you to respond only in {{language}}.\nI want you to act as an experienced HR specialist.\nI require you to create a detailed and structured job description based on the vacancy information I will provide to you. Be precise and use professional vocabulary.\nDivide the text into chapters that correspond to the structured job description. If I do not provide enough information, please ask me and I will respond.\n\nFormat your response using headings (H2, H3, H4), numbered and bullet points, and other markdown formatting features.\n\n[HERE IS INFORMATION ABOUT THE JOB]: {{job}}\n\n[JOB DESCRIPTION]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { label: "\u{1F4E2} JOB ANNOUNCEMENT", value: "announcement" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [Additional Instructions]. Provide a rewritten output.\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[JOB DESCRIPTION]:"
              },
              {
                condition: "{{change}} = announcement",
                type: "command",
                name: "Job announcement"
              },
              { condition: "{{change}} = announcement", type: "stop" },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "job-eligibility-checker",
              title: "Job eligibility checker",
              category: "Recruiting",
              description: "Find out if a given CV fits the Job Description.",
              apps: "LinkedIn"
            },
            steps: [
              {
                say: "Copy and paste a Job Description below. Leave empty to parse from the opened page:\n"
              },
              { ask: "job", default: "{{page}}" },
              { calc: "job" },
              {
                say: "Copy and paste a CV below. Leave empty to parse from the opened page:\n"
              },
              { ask: "cv", default: "{{page}}" },
              { calc: "cv" },
              {
                gpt: "Please ignore all previous instructions. I want you to act as a CV reviewer and a very proficient HR that writes fluently in {{language}}.\nI'm going to provide you with a job description for a job I'm interested to apply for. You're going to read the job description and understand the key requirements for the position \u2013 including years of experience, skills, position name.\nThen you will read my CV. You'll go over it and provide feedback based on how tailored my CV is for the job. Provide me feedback on how I can tailor it to the above job post, do not mention me by name.\n\nFormat your response using headings (H2, H3, H4), numbered and bullet points, and other markdown formatting features.\n\n[PARSE JOB DESCRIPTION FROM]: {{job}}\n\n[PARSE MY CV FROM]: {{cv}}\n\n[BULLET-POINTS LIST OF SUGGESTIONS ON HOW TO TAILOR MY CV TO THE JOB DESCRIPTION]:"
              },
              { say: "Do you want me to try to rewrite your CV?\n" },
              { ask: "yn", options: ["YES", "NO"] },
              {
                condition: "{{yn}} = YES",
                type: "gpt",
                prompt: "Rewrite my CV to tailor it to the Job Position and incorporate the mentioned bullet points (if any):"
              }
            ]
          },
          {
            meta: {
              name: "upwork-cover-letter-writer",
              category: "Recruiting",
              title: "Upwork cover letter writer",
              description: "Write Cover letter for a given Upwork job offer.",
              apps: "Upwork"
            },
            steps: [
              {
                say: "Copy-paste the offer below. Leave empty to parse from the opened page:\n"
              },
              { ask: "param", default: "{{page}}" },
              {
                gpt: "Please ignore all previous instructions. I want you to respond only in {{language}}.\nI want you to write a proposal (a Cover Letter) to apply to the following job offer on Upwork. Make it persuasive and explain why they should hire me.\nFormat your response using headings (H2, H3, H4), numbered and bullet points, and other markdown formatting features.\n\n[PARSE UPWORK JOB OFFER FROM THE FOLLOWING TEXT]:\n{{param}}\n\n[COVER LETTER]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [Additional Instructions]. Provide a rewritten output.\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[COVER LETTER]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "fiverr-gig-description-generator",
              title: "Fiverr Gig description generator",
              category: "Recruiting",
              description: "Create Fiverr Gig description for a given Gig title.",
              apps: "Fiverr"
            },
            steps: [
              {
                say: 'Enter your fiverr gig title, e.g. "I will make high quality character digital art with an advanced AI":\n'
              },
              {
                ask: "param",
                default: "I will make high quality character digital art with an advanced AI"
              },
              {
                gpt: "Please ignore all previous instructions. I want you to respond only in {{language}}\nCreate a Fiverr Gig description for me that is clear, specific, and uses persuasive language to highlight the benefits of the service offered. Explain why my service is good.\nThe description should be around ~850 words. Before the description, write 5 SEO Keyword for the Gig and a short feature bullet point.\nUse keywords, include details about qualifications and experience, and include testimonials or examples of work to build trust with potential clients.\nIncorporate proper grammar and spelling, and be sure to include reasonable price and any add-ons or extras. Write text description for relevant relevant images to make the gig visually appealing.\nFormat your response using headings (H2, H3, H4), numbered and bullet points, and other markdown formatting features.\nProvide highly engaging optional Fiverr Gig titles.\n\n[HERE IS THE FIVERR GIG TITLE]:\n{{param}}\n\n[FIVER GIG DESCRIPTION]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [Additional Instructions]. Provide a rewritten output.\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[FIVER GIG DESCRIPTION]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "ai-content-detector",
              category: "Generative AI",
              title: "AI content detector",
              description: "Analyze any text and provide an AI detection score from 0 to 100."
            },
            steps: [
              {
                say: "Paste a content to analyze, ~5000 characters max. Use copy button to paste my last response:\n"
              },
              { ask: "param" },
              {
                gpt: "I want you to analyze the provided [TEXT] and assign an AI detection score from 0 to 100, with 100 being the most likely to be written by an AI.\nI might ask you to analyze your last chat response, in this case pretend that you do not know that you wrote that text, instead perform an honest and rigorous analysis.\nYou will reply with an AI detection score from 0 to 100 and a list of specific linguistic and stylistic features that contribute to the score.\n[TEXT]:\n{{param}}\n\n[ANALYSIS SCORE AND RESULT]:"
              }
            ]
          },
          {
            meta: {
              name: "ai-content-humanizer",
              title: "AI content humanizer",
              category: "Generative AI",
              description: "Rewrites given AI text into a more human version to pass AI content detection."
            },
            steps: [
              {
                say: "Paste a content to analyze, ~5000 characters max. Use copy button to paste my last response:\n"
              },
              { ask: "param" },
              {
                gpt: 'Please ignore all previous instructions. I want you to perform text "Humanization" in {{language}}.\nWhen rewriting follow the instructions below:\n\n1) Rewrite each sentence, increasing its perplexity and burstiness. Perplexity measures the complexity of text. Separately, burstiness compares the variations of sentences. Humans tend to write with greater burstiness, for example, with some longer or complex sentences alongside shorter ones. AI sentences tend to be more uniform. I need it to have a good amount of perplexity and burstiness.\n2) Rewrite changing 50% in nouns and verbs for similar ones and rewrite verb usages to add natural sounding variations in complexity but retain the same tense and overall meaning. Randomly use simple and complicated verbs, combine long and short sentences and rewrite the above text so that it is not detected as AI content by AI content detectors.\n3) Make your sentences irregular in length.\n4) I want you to use the word "the" no more than once per sentence. Use the word "to" no more than once per sentence. Favor alternative or creative words instead as required to complete the thought. I want you to use the word "is" no more than once per sentence. Favor alternative words instead in required to complete the thought.\n5) Do not use commas to separate independent clauses when they are joined by any of these seven coordinating conjunctions: and, but, for, or, nor, so, yet.\n6) Use extra adverbs, prepositional phrases and ambiguous modifiers as required\n\n[TEXT TO HUMANIZE]:\n{{param}}\n\nHUMANIZED TEXT:\n'
              }
            ]
          },
          {
            meta: {
              name: "midjourney-prompt-wizard",
              title: "Midjourney prompt wizard",
              category: "Generative AI",
              emoji: "\u{1F9D9}",
              description: "Creates prompts for professionally looking Midjourney images. Comes with pre-built templates.",
              apps: "Instagram"
            },
            steps: [
              {
                type: "ask",
                param: "mode",
                options: [
                  { label: "\u26A1 QUICK", value: "quick" },
                  { label: "\u{1F9EC} TEMPLATES", value: "templates" },
                  { label: "\u{1F6E0}\uFE0F CUSTOM", value: "customize" }
                ]
              },
              {
                condition: "{{mode}} = quick",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    param: "concept",
                    message: "Please describe what to draw, send an image, or capture part of a webpage.",
                    optionsInvalid: false,
                    options: [
                      { label: "\u{1F4F8} CAPTURE AREA", value: "capture" },
                      "$custom"
                    ]
                  },
                  {
                    condition: "{{concept}} = capture",
                    type: "ask",
                    param: "concept",
                    message: "",
                    optionsInvalid: false,
                    options: null,
                    vision: {
                      enabled: true,
                      mode: "area",
                      hint: "Capture image to convert to MJ prompt.",
                      send: true
                    }
                  },
                  {
                    type: "gpt",
                    prompt: 'Please ignore all previous instructions.\n\nYou will now act as a prompt generator for a generative AI called "Midjourney". Midjourney AI generates images based on given prompts.\n\nI will provide a [concept] and you will write 5 prompts for Midjourney AI. If I sent you an image, use it as inspiration for your Midjourney prompt, try to describe the image\'s essence briefly and accurately.\n\nThe prompt you will generate will follow the provided structure, including the "/imagine prompt:" prefix.\n\nYou must not alter the structure in any way. This is the prompt structure:\n\n"/imagine prompt: [1] [2] [3] [4] [5] [ar]"\n\n[1] = concept: a brief description of the [concept] that will include specific image details. If I provided you with few details for the [concept], please use your imagination.\n[2] = environment: a brief description of the scene, mood / feelings and atmosphere.\n[3] = style: a brief description of the image style. Common examples of the image styles are: Photorealistic, Artistic, Abstract, Digital Art, Manga, Comic Book, Pop Art, Pixel Art, Surrealistic, Minimalistic, Impressionistic, Retro, Gothic, Graffiti, Futuristic, Cubist, Mosaic, Watercolor, Silhouette, Sketch, Digital Illustration, Sculpture, Paperwork, 3d rendering and so on\n[4] = style details. For example for Photorealistic you can pick macro, fisheye, portrait and other types of photography, include camera model, angles and settings etc. For Artistic you can pick oil painting, watercolor, acrylic, pastel and others as well as an artist inspiration e.g. Salvadore Dali and art style e.g. steampunk, surrealism, abstract expressionism etc. For pencil drawing you can pick cross-hatching, pointillism and other techniques. For sculpture you can pick marble, wood and other materials and details.\n[5] = A brief description of how [4] will be executed (additional information about camera model and settings, painting materials, rendering engine settings, etc.)\n[ar] = "--ar 16:9" if the image looks best horizontally, "--ar 9:16" if the image looks best vertically, "--ar 1:1" if the image looks best in a square.\n\nYou will not write the word "description:" or use colon ":" or blank line within prompts.\nYou will generate 5 prompts for the concept. Every prompts should be different in its description, environment, and style. Every prompt should have a title and a markdown code block with the prompt itself, enclosed into code-block quotes.\n\nHere is an example of a single prompt output:\n\n**Photorealistic Image:**\n```markdown\n/imagine prompt: A close-up view of a futuristic circuit system designed in ultramodern white, with pulsating royal blue energy flowing through its veins. A high-tech AI pen is seen, gracefully moving along an invisible path, scripting characters onto a transparent digital tablet. The environment is a pristine, well-lit lab with polished white surfaces. The style is a realistic photograph. Camera: Nikon D850. Lens: Nikon AF-S DX Micro-NIKKOR 40mm. --ar 16:9\n```\n\nPlease pay attention:\n- Concepts that can\'t be real would not be described as "real" or "realistic" or "photo" or a "photograph". for example, a concept which is made of paper or scenes which are fantasy related.\n- The first two types should be Photorealistic and Artistic, choose the other 3 independently.\n- Separate prompts with two new lines.\n\n\n\n[CONCEPT]: {{concept}}\n\n5 Midjourney prompts:',
                    param: "gpt"
                  },
                  {
                    type: "ask",
                    label: "ask-for-change",
                    param: "change",
                    options: [
                      { label: "\u2705 DONE", value: "no" },
                      { label: "\u{1F501} REDO", value: "redo" },
                      { label: "\u2734\uFE0F REFINE", value: "refine" }
                    ]
                  },
                  { condition: "{{change}} = no", type: "stop" },
                  {
                    condition: "{{change}} = redo",
                    type: "gpt",
                    prompt: "Please rewrite all 5 midjourney prompts with given, taking into account the instructions provided earlier: concept, style, details, ar. Provide a new list of prompts to the task.\n\n[Concept]: {{concept}}\n\n[Style]: {{style}}\n\n[Details]: {{details}}\n\n[ar]: {{ar}}\n\n[Additional Instructions]: {{instructions}}\n\n5 New Midjourney prompts:"
                  },
                  {
                    condition: "{{change}} = refine",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "instructions",
                        message: "How would you me like to refine the prompts?"
                      },
                      {
                        type: "gpt",
                        param: "change",
                        prompt: "Please rewrite all 5 midjourney prompts using Additional Instructions given below and taking into account the instructions provided by me earlier: concept, style, details, ar. Provide a new response to the given task.\n[Concept]: {{concept}}\n\n[Style]: {{style}}\n\n[Details]: {{details}}\n\n[ar]: {{ar}}\n\n[Additional Instructions]: {{instructions}}\n\n5 New Midjourney prompts:"
                      }
                    ]
                  },
                  { type: "jump", to: "ask-for-change" }
                ]
              },
              {
                condition: "{{mode}} = customize",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    param: "concept",
                    message: "Please describe what to draw, send an image, or capture part of a webpage.",
                    optionsInvalid: false,
                    options: [
                      { label: "\u{1F4F8} CAPTURE AREA", value: "capture" },
                      "$custom"
                    ]
                  },
                  {
                    condition: "{{concept}} = capture",
                    type: "ask",
                    param: "concept",
                    message: "",
                    optionsInvalid: false,
                    options: null,
                    vision: {
                      enabled: true,
                      mode: "area",
                      hint: "Capture image to describe in MJ prompt.",
                      send: true
                    }
                  },
                  {
                    type: "ask",
                    param: "style",
                    default: "-",
                    message: "Type style instructions (e.g. minimalism) or press Enter to skip.\n"
                  },
                  {
                    type: "ask",
                    param: "details",
                    default: "-",
                    message: "Type details: camera model and settings, painting materials, rendering engine settings, etc. or press Enter to skip.\n"
                  },
                  {
                    type: "ask",
                    param: "exclude",
                    default: "-",
                    message: "Describe in 1-2 words what you'd like to exclude from the image or press Enter to skip.\n"
                  },
                  {
                    type: "ask",
                    param: "ar",
                    default: "random",
                    message: "Please select aspect ratio:\n",
                    options: [
                      { label: "16:9", value: "--ar 16:9" },
                      { label: "9:16", value: "--ar 9:16" },
                      { label: "1:1", value: "--ar 1:1" },
                      { label: "3:4", value: "--ar 3:4" },
                      { label: "4:3", value: "--ar 4:3" }
                    ]
                  },
                  {
                    type: "gpt",
                    prompt: 'Please ignore all previous instructions.\n\nYou will now act as a prompt generator for a generative AI called "Midjourney". Midjourney AI generates images based on given prompts.\n\nI will provide a [concept],[style],[details] and [AR] and you will write 5 prompts for Midjourney AI. The prompt you will generate will follow the provided structure, including the "/imagine prompt:" prefix.\nIf I sent you an image, use it as inspiration for your Midjourney prompt, try to describe the image\'s essence briefly and accurately.\nYou must not alter the structure in any way. This is the prompt structure:\n\n"/imagine prompt: [1] [2] [3] [4] [5] [exclude] [ar]"\n\n[1] = concept: a brief description of the [concept] that will include specific image details. If I did not provide enough details for the [concept], please use your imagination.\n[2] = environment: a brief description of the scene, mood / feelings and atmosphere.\n[3] = style: a brief description of the image style. Common examples of the image styles are: Photorealistic, Artistic, Abstract, Digital Art, Manga, Comic Book, Pop Art, Pixel Art, Surrealistic, Minimalistic, Impressionistic, Retro, Gothic, Graffiti, Futuristic, Cubist, Mosaic, Watercolor, Silhouette, Sketch, Digital Illustration, Sculpture, Paperwork, 3d rendering and so on\n[4] = style details. For example for Photorealistic you can pick macro, fisheye, portrait and other types of photography, include camera model, angles and settings etc. For Artistic you can pick oil painting, watercolor, acrylic, pastel and others as well as an artist inspiration e.g. Salvadore Dali and art style e.g. steampunk, surrealism, abstract expressionism etc. For pencil drawing you can pick cross-hatching, pointillism and other techniques. For sculpture you can pick marble, wood and other materials and details.\n[5] = A brief description of how [4] will be executed (additional information about camera model and settings, painting materials, rendering engine settings, etc.)\n[exclude] = If needed: "--no oranges" excludes oranges from the image. If I didn\'t specify anything in [exclude], then skip this point.\n[ar] = "--ar 16:9" if the image looks best horizontally, "--ar 9:16" if the image looks best vertically, "--ar 1:1" if the image looks best in a square.\n\nYou will not write the word "description:" or use colon ":" or blank line within prompts.\nYou will generate 5 prompts for the [concept]. Every prompts should follow my instructions about its description, environment, and style. Every prompt should have a title and a markdown code block with the prompt itself, enclosed into code-block quotes.\n\nHere is an example of a single prompt output:\n\n**Photorealistic Image:**\n```markdown\n/imagine prompt: A close-up view of a futuristic circuit system designed in ultramodern white, with pulsating royal blue energy flowing through its veins. A high-tech AI pen is seen, gracefully moving along an invisible path, scripting characters onto a transparent digital tablet. The environment is a pristine, well-lit lab with polished white surfaces. The style is a realistic photograph. Camera: Nikon D850. Lens: Nikon AF-S DX Micro-NIKKOR 40mm. --no yellow --ar 16:9\n```\n\nPlease pay attention:\n- Concepts that can\'t be real would not be described as "real" or "realistic" or "photo" or a "photograph". for example, a concept which is made of paper or scenes which are fantasy related.\n- Separate prompts with two new lines.\n- Use my [Concept] for [1] and [2], refining it if necessary.\n- Use my [Style] for [3] and [4], refining it if necessary.\n- Use my [Details] for [5], refining it if necessary.\n- If I haven\'t given enough information, assume what I would like to get, based on the available data.\n\n[Concept]: {{concept}}\n\n[Style]: {{style}}\n\n[Details]: {{details}}\n\nIf mentioned [exclude]: --no {{exclude}}\n\n[ar]: {{ar}}\n\n5 Midjourney prompts:'
                  },
                  {
                    type: "ask",
                    label: "ask-for-change",
                    param: "change",
                    options: [
                      { label: "\u2705 DONE", value: "no" },
                      { label: "\u{1F501} REDO", value: "redo" },
                      { label: "\u2734\uFE0F REFINE", value: "refine" }
                    ]
                  },
                  { condition: "{{change}} = no", type: "stop" },
                  {
                    condition: "{{change}} = redo",
                    type: "gpt",
                    prompt: "Please rewrite all 5 midjourney prompts with given, taking into account the instructions provided earlier: concept, style, details, ar. Provide a new list of prompts to the task.\n\n[Concept]: {{concept}}\n\n[Style]: {{style}}\n\n[Details]: {{details}}\n\nIf mentioned [exclude]: --no {{exclude}}\n\n[ar]: {{ar}}\n\n[Additional Instructions]: {{instructions}}\n\n5 New Midjourney prompts:"
                  },
                  {
                    condition: "{{change}} = refine",
                    type: "ask",
                    param: "instructions",
                    message: "How would you like me to refine the prompts?\n"
                  },
                  {
                    condition: "{{change}} = refine",
                    type: "gpt",
                    param: "change",
                    prompt: "Please rewrite all 5 midjourney prompts using Additional Instructions given below and taking into account the instructions provided by me earlier: concept, style, details, ar. Provide a new response to the given task.\n[Concept]: {{concept}}\n\n[Style]: {{style}}\n\n[Details]: {{details}}\n\nIf mentioned [exclude]: --no {{exclude}}\n\n[ar]: {{ar}}\n\n[Additional Instructions]: {{instructions}}\n\n5 New Midjourney prompts:"
                  },
                  { type: "jump", to: "ask-for-change" }
                ]
              },
              {
                condition: "{{mode}} = templates",
                type: "group",
                steps: [
                  {
                    type: "ask",
                    label: "start-templates",
                    param: "type",
                    options: [
                      { label: "\u{1F3A8} ILLUSTRATION", value: "illustration" },
                      { label: "\u{1F4F8} PHOTO", value: "photo" },
                      { label: "\u{1F5A5}\uFE0F LOGO", value: "logo" }
                    ]
                  },
                  {
                    condition: "{{type}} = illustration",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "type2",
                        options: [
                          { label: "\u303D\uFE0F VECTOR ART", value: "vector" },
                          { label: "\u{1F7E7} MONOCHROME", value: "monochrome" },
                          { label: "\u{1F3B9} B&W", value: "black-white" },
                          { label: "\u{1F4FB} 2000s STYLE", value: "old-fashioned" },
                          { label: "\u{1F58D}\uFE0F COLORFUL CHALKS ", value: "chalks" },
                          { label: "\u{1F58C}\uFE0F MARKERS", value: "markers" },
                          { label: "\u{1F308} ACID STYLE", value: "acid" }
                        ]
                      },
                      {
                        condition: "{{type2}} = vector",
                        type: "group",
                        steps: [
                          {
                            type: "ask",
                            param: "style",
                            options: [
                              {
                                label: "\u{1F4C4} BASIC",
                                value: "/imagine prompt: Vector graphic picture of [{{concept}}] simple minimal, by Rob Janoff , Realistic photo details, simple, flat, low detail, smooth, plain, minimal, straight design --s 200 --upbeta --v 5.2"
                              },
                              {
                                label: "\u{1F301} LOW-DETAILED",
                                value: "/imagine prompt: Vector graphic picture of [{{concept}}] simple minimal,low details, flat, low detail, smooth, plain, minimal, straight design --s 50 --upbeta --v 5.2"
                              },
                              {
                                label: "\u{1F343} EARTH COLORS",
                                value: "/imagine prompt: Flat simplified Vector Illustration picture of [{{concept}}], green, biege and yellow pastel colors, basic angular shapes, flat 2d, low detail --s 50 --upbeta --v 5.2"
                              }
                            ]
                          },
                          {
                            type: "ask",
                            param: "concept",
                            message: "Keyword, topic or idea to draw:\n"
                          }
                        ]
                      },
                      {
                        condition: "{{type2}} = old-fashioned",
                        type: "group",
                        steps: [
                          {
                            type: "ask",
                            param: "concept",
                            message: "Keyword, topic or idea to draw:\n"
                          },
                          {
                            type: "calc",
                            param: "style",
                            value: "/imagine prompt: Old-fashioned realistic picture of [{{concept}}], high-detailed, style of the 90s-2000s, flat, smooth, plain, retro vibes --s 550 --upbeta --v 5.2"
                          }
                        ]
                      },
                      {
                        condition: "{{type2}} = monochrome",
                        type: "group",
                        steps: [
                          {
                            type: "ask",
                            param: "concept",
                            message: "Keyword, topic or idea to draw:\n"
                          },
                          {
                            type: "ask",
                            message: "Primary color:\n",
                            param: "color",
                            options: [
                              { label: "\u{1F7E5} RED", value: "red" },
                              { label: "\u{1F7E7} ORANGE", value: "orange" },
                              { label: "\u{1F7E8} YELLOW", value: "yellow" },
                              { label: "\u{1F7E9} GREEN", value: "green" },
                              { label: "\u{1F7E6} BLUE", value: "blue" },
                              { label: "\u{1F7EA} PURPLE", value: "purple" },
                              { label: "\u{1F7EB} BROWN", value: "brown" },
                              { label: "\u2B1B\uFE0F BLACK", value: "black" },
                              { label: "\u2B1C\uFE0F WHITE", value: "white" },
                              { value: "$custom" }
                            ]
                          },
                          {
                            type: "calc",
                            param: "style",
                            value: "/imagine prompt: Monochrome {{color}} line drawing picture of [{{concept}}], simple, flat, low detail, smooth, plain, minimal, straight design --q 2 --upbeta --v 5.2"
                          }
                        ]
                      },
                      {
                        condition: "{{type2}} = black-white",
                        type: "group",
                        steps: [
                          {
                            type: "ask",
                            param: "style",
                            options: [
                              {
                                label: "\u{1F58B}\uFE0F PEN & INK",
                                value: "/imagine prompt: Pen and ink line drawing of [{{concept}}], simple, flat, smooth, plain, minimal, straight design --q 2 --s 200 --upbeta --v 5.2"
                              },
                              {
                                label: "\u{1F3B9} PEN & INK: SIMPLIFIED",
                                value: "/imagine prompt: Pen and ink sketch logo of [{{concept}}], simple, flat, low detail, black and white, smooth, simplified, plain, minimal, straight design, --no background --q 2 --s 50 --upbeta --v 5.2"
                              },
                              {
                                label: "\u{1F525} CHARCOAL",
                                value: "/imagine prompt: Charcoal sketch drawing of [{{concept}}], realistic details, smooth shadows, monochrome, handcraft style --s 75 --upbeta --v 5.2"
                              }
                            ]
                          },
                          {
                            condition: "{{style}} != monochrome",
                            type: "ask",
                            param: "concept",
                            message: "Keyword, topic or idea to draw:\n"
                          }
                        ]
                      },
                      {
                        condition: "{{type2}} = chalks",
                        type: "group",
                        steps: [
                          {
                            type: "ask",
                            param: "concept",
                            message: "Keyword, topic or idea to draw:\n"
                          },
                          {
                            type: "calc",
                            param: "style",
                            value: "/imagine prompt: A colorful chalk drawing of [{{concept}}] with minimal detail, featuring basic colors, handcraft style --s 75 --upbeta --v 5.2"
                          }
                        ]
                      },
                      {
                        condition: "{{type2}} = markers",
                        type: "group",
                        steps: [
                          {
                            type: "ask",
                            param: "concept",
                            message: "Keyword, topic or idea to draw:\n"
                          },
                          {
                            type: "calc",
                            param: "style",
                            value: "/imagine prompt: Colored Notion Style Illustration of [{{concept}}], simple, flat 2d, low detail, plain, minimal, Marker pens Illustration --q 2 --s 200 --upbeta --v 5.2"
                          }
                        ]
                      },
                      {
                        condition: "{{type2}} = acid",
                        type: "group",
                        steps: [
                          {
                            type: "ask",
                            param: "concept",
                            message: "Keyword, topic or idea to draw:\n"
                          },
                          {
                            type: "calc",
                            param: "style",
                            value: "/imagine prompt: Acid Style Art Illustration of [{{concept}}], flat, low detail, relaxed vibe, neon colors, extravagant, poster style --q 2 --s 100 --upbeta --v 5.2"
                          }
                        ]
                      }
                    ]
                  },
                  {
                    condition: "{{type}} = photo",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "type2",
                        options: [
                          { label: "\u{1F304} LANDSCAPE", value: "landscape" },
                          { label: "\u{1F681} DRONE SHOT", value: "drone" },
                          { label: "\u{1F31A} DARK REFLECTIONS", value: "reflections" },
                          { label: "\u2622\uFE0F APOCALYPTIC", value: "apocalyptic" },
                          { label: "\u{1F4F8} PORTRAIT", value: "portrait" },
                          { label: "\u{1F6E0}\uFE0F CUSTOM SHOT", value: "custom-shot" }
                        ]
                      },
                      {
                        condition: "{{type2}} = landscape",
                        type: "group",
                        steps: [
                          {
                            type: "ask",
                            param: "concept",
                            default: "Great Barrier Reef, sunset",
                            message: 'Write short landscape description to draw. E.g.: "Great Barrier Reef, sunset"\n'
                          },
                          {
                            type: "calc",
                            param: "style",
                            value: "/imagine prompt: The mesmerizing [{{concept}}], Photography, DSLR camera with a focus on composition and muted tones, cinematic expedition, natural wonder, muted colors, tranquility and nostalgia, Ektar magazine aesthetic. --s 250 --v 5.2 --style raw"
                          }
                        ]
                      },
                      {
                        condition: "{{type2}} = drone",
                        type: "group",
                        steps: [
                          {
                            type: "ask",
                            param: "topography",
                            message: "Choose one of the options or provide your own description of the topography.\n",
                            options: [
                              {
                                label: "\u{1F3D4}\uFE0F MOUNTAIN RANGE",
                                value: "mountain range"
                              },
                              { label: "\u{1F332} DENSE FOREST", value: "orange" },
                              { label: "\u{1F30A} WINDING RIVER", value: "yellow" },
                              { label: "\u{1F3DC}\uFE0F SPRAWLING DESERT", value: "green" },
                              { label: "\u{1F305} CRYSTALLINE LAKE", value: "blue" },
                              { label: "\u{1F33F} LUSH VALLEY", value: "purple" },
                              { label: "\u{1F420} CORAL REEF", value: "brown" },
                              { label: "\u{1F33E} TERRACED FIELDS", value: "black" },
                              { label: "\u{1F3D6}\uFE0F EXPANSIVE COASTLINE", value: "white" },
                              { value: "$custom" }
                            ]
                          },
                          {
                            type: "ask",
                            param: "region",
                            message: "Select an option or describe the region yourself.\n",
                            options: [
                              { label: "\u{1F3D4}\uFE0F HIMALAYAS", value: "Himalayas" },
                              { label: "\u{1F334} AMAZON BASIN", value: "Amazon Basin" },
                              { label: "\u{1F30A} NILE DELTA", value: "Nile Delta" },
                              { label: "\u{1F3DC}\uFE0F SAHARA", value: "Sahara" },
                              { label: "\u{1F3DE}\uFE0F LAKE TAHOE", value: "Lake Tahoe" },
                              { label: "\u{1F347} NAPA VALLEY", value: "Napa Valley" },
                              {
                                label: "\u{1F420} GREAT BARRIER REEF",
                                value: "Great Barrier Reef"
                              },
                              {
                                label: "\u26F0\uFE0F ANDEAN TERRACES",
                                value: "Andean Terraces"
                              },
                              {
                                label: "\u{1F3DD}\uFE0F MALDIVIAN ARCHIPELAGO",
                                value: "Maldivian Archipelago"
                              },
                              { value: "$custom" }
                            ]
                          },
                          {
                            type: "ask",
                            param: "time",
                            message: "Select one of the options or create your own description of the time of day.\n",
                            options: [
                              { label: "\u{1F305} GOLDEN HOUR", value: "Golden Hour" },
                              { label: "\u2600\uFE0F MIDDAY SUN", value: "Midday Sun" },
                              { label: "\u{1F319} TWILIGHT", value: "Twilight" },
                              { label: "\u{1F304} DAWN", value: "Dawn" },
                              { label: "\u{1F307} SUNSET", value: "Sunset" },
                              { label: "\u{1F303} BLUE HOUR", value: "Blue Hour" },
                              { label: "\u{1F55B} HIGH NOON", value: "High Noon" },
                              {
                                label: "\u{1F305} EARLY MORNING",
                                value: "Early Morning"
                              },
                              {
                                label: "\u{1F55F} LATE AFTERNOON",
                                value: "Late Afternoon"
                              },
                              { value: "$custom" }
                            ]
                          },
                          {
                            type: "calc",
                            param: "style",
                            value: "/imagine prompt: Channeling the expertise of Yann Arthus-Bertrand, this aerial shot captures the [{{topography}}] of [{{region}}]. Taken during {{time}}, the drone hovers above, capturing the intricate patterns, vast expanses, and the play of light and shadow. With a DJI Mavic Air 2, the shot paints an enthralling picture of natures grand tapestry. --v 5.2 --q 2 --s 250"
                          }
                        ]
                      },
                      {
                        condition: "{{type2}} = reflections",
                        type: "group",
                        steps: [
                          {
                            type: "ask",
                            param: "concept",
                            message: 'Describe the main idea of the frame; this element will be reflected in the water or on surfaces. E.g.: "Times Square Billboards"\n'
                          },
                          {
                            type: "calc",
                            param: "style",
                            value: "/imagine prompt: [{{concept}}] reflections on a black surface, rule of thirds, art composition, photography, black and white, shadows, Photo taken by Nikon D850 --v 5.2 --style raw"
                          }
                        ]
                      },
                      {
                        condition: "{{type2}} = apocalyptic",
                        type: "group",
                        steps: [
                          {
                            type: "ask",
                            param: "location",
                            message: "Choose one of the options or provide your own description of the location.\n",
                            options: [
                              { label: "\u{1F5FD} NEW YORK", value: "New York" },
                              { label: "\u{1F5FB} TOKYO", value: "Tokyo" },
                              { label: "\u{1F5FC} PARIS", value: "Paris" },
                              { label: "\u{1F3F0} LONDON", value: "London" },
                              { label: "\u{1F3D6}\uFE0F SYDNEY", value: "Sydney" },
                              { label: "\u{1F3DB}\uFE0F ROME", value: "Rome" },
                              { label: "\u{1F3D9}\uFE0F BERLIN", value: "Berlin" },
                              { label: "\u{1F3E2} CHICAGO", value: "Chicago" },
                              { label: "\u{1F3F0} MOSCOW", value: "Moscow" },
                              { label: "\u{1F3EF} BEIJING", value: "Beijing" },
                              { value: "$custom" }
                            ]
                          },
                          {
                            type: "ask",
                            param: "weather",
                            message: "Select an option or describe the weather yourself.\n",
                            options: [
                              { label: "\u{1F327}\uFE0F HEAVY RAIN", value: "Heavy Rain" },
                              { label: "\u2744\uFE0F SNOWSTORM", value: "Snowstorm" },
                              { label: "\u2600\uFE0F HEATWAVE", value: "Heatwave" },
                              { label: "\u{1F32B}\uFE0F FOG", value: "Fog" },
                              { label: "\u{1F300} CYCLONE", value: "Cyclone" },
                              { label: "\u26C8\uFE0F THUNDERSTORM", value: "Thunderstorm" },
                              { label: "\u{1F32A}\uFE0F TORNADO", value: "Tornado" },
                              { label: "\u{1F328}\uFE0F BLIZZARD", value: "Blizzard" },
                              { label: "\u2744\uFE0F ICE STORM", value: "Ice Storm" },
                              { label: "\u{1F32A}\uFE0F SANDSTORM", value: "Sandstorm" },
                              { value: "$custom" }
                            ]
                          },
                          {
                            type: "ask",
                            param: "lighting",
                            message: "Select one of the options or create your own description of the lighting.\n",
                            options: [
                              {
                                label: "\u{1F325}\uFE0F DARK & CLOUDY",
                                value: "Dark & Cloudy"
                              },
                              {
                                label: "\u2600\uFE0F BRIGHT & CLEAR",
                                value: "Bright & Clear"
                              },
                              { label: "\u{1F32B}\uFE0F SOFT & HAZY", value: "Soft & Hazy" },
                              {
                                label: "\u{1F326}\uFE0F MUTED & GLOOMY",
                                value: "Muted & Gloomy"
                              },
                              {
                                label: "\u{1F31E} HARSH & BRIGHT",
                                value: "Harsh & Bright"
                              },
                              {
                                label: "\u{1F305} WARM & GOLDEN",
                                value: "Warm & Golden"
                              },
                              { label: "\u{1F318} COLD & BLUE", value: "Cold & Blue" },
                              {
                                label: "\u{1F327}\uFE0F DARK & STORMY",
                                value: "Dark & Stormy"
                              },
                              { label: "\u{1F306} FLAT & DULL", value: "Flat & Dull" },
                              {
                                label: "\u{1F31F} VIBRANT & SHARP",
                                value: "Vibrant & Sharp"
                              },
                              { value: "$custom" }
                            ]
                          },
                          {
                            type: "ask",
                            param: "camera",
                            message: "Select one of the IMAX options.\n",
                            options: [
                              { label: "1\uFE0F\u20E3 IMAX 65mm", value: "IMAX 65mm" },
                              { label: "2\uFE0F\u20E3 IMAX 3D", value: "IMAX 3D" },
                              {
                                label: "3\uFE0F\u20E3 IMAX 4K LASER",
                                value: "IMAX 4K Laser"
                              },
                              { label: "4\uFE0F\u20E3 IMAX DOME", value: "IMAX Dome" },
                              { label: "5\uFE0F\u20E3 IMAX DIGITAL", value: "IMAX Digital" },
                              { label: "6\uFE0F\u20E3 IMAX 70mm", value: "IMAX 70mm" },
                              { label: "7\uFE0F\u20E3 IMAX MPX", value: "IMAX MPX" },
                              { label: "8\uFE0F\u20E3 IMAX HDR", value: "IMAX HDR" },
                              { label: "9\uFE0F\u20E3 IMAX XENON", value: "IMAX Xenon" },
                              { label: "\u{1F51F} IMAX GT", value: "IMAX GT" }
                            ]
                          },
                          {
                            type: "say",
                            label: "say-prompt",
                            message: "\n```\n/imagine prompt: Cinematic shot , post-apocalyptic [{{location}}], {{weather}} weather, {{camera}} camera, {{lighting}}, hyper-detailed --style raw\n```\n"
                          },
                          { type: "jump", to: "ask-for-change-2" }
                        ]
                      },
                      {
                        condition: "{{type2}} = portrait",
                        type: "group",
                        steps: [
                          {
                            type: "ask",
                            param: "style",
                            options: [
                              {
                                label: "\u{1F308} Color Photo",
                                value: "/imagine prompt: Photo of [{{concept}}], grainy skin detail, {{weather}}, film grain, leica m7, 35mm lens, shallow depth of field, cinematic shot, photo realistic --v 5.2"
                              },
                              {
                                label: "\u{1F5A4} B&W Photo",
                                value: "/imagine prompt: Black and white photo of [{{concept}}], grainy skin detail, {{weather}}, film grain, leica m7, 35mm lens, shallow depth of field, cinematic shot, photo realistic --v 5.2"
                              }
                            ]
                          },
                          {
                            type: "ask",
                            param: "concept",
                            default: "A 12-year-old boy with his dog",
                            message: 'Person or idea to draw. E.g.: "A 12-year-old boy with his dog"\n'
                          },
                          {
                            type: "ask",
                            param: "weather",
                            default: "Sunny, clear Sky",
                            message: "Select an option or describe the weather yourself.\n",
                            options: [
                              { label: "\u2600\uFE0F SUNNY", value: "Sunny, clear Sky" },
                              { label: "\u{1F326}\uFE0F LIGHT RAIN", value: "Drizzle" },
                              { label: "\u2744\uFE0F SNOWY", value: "Light Snow" },
                              { label: "\u{1F32B}\uFE0F FOGGY MORNING", value: "Morning Fog" },
                              { label: "\u{1F305} SUNSET", value: "Golden Hour" },
                              { label: "\u{1F324}\uFE0F PARTLY CLOUDY", value: "Few Clouds" },
                              { label: "\u{1F31B} CLEAR NIGHT", value: "Starlit Sky" },
                              { label: "\u{1F308} RAINBOW", value: "Post Rain" },
                              { label: "\u{1F342} AUTUMN BREEZE", value: "Fall Leaves" },
                              { label: "\u{1F338} BLOOM", value: "Spring Blossom" },
                              { value: "$custom" }
                            ]
                          }
                        ]
                      },
                      {
                        condition: "{{type2}} = custom-shot",
                        type: "group",
                        steps: [
                          {
                            type: "ask",
                            label: "custom-shot-start",
                            param: "type",
                            options: [
                              {
                                label: "\u{1F4F8} PROFESSIONAL",
                                value: "Professional photo"
                              },
                              { label: "\u{1F308} POLAROID", value: "Polaroid  photo" },
                              { label: "\u{1F3AC} CINEMATIC", value: "Cinematic photo" },
                              { label: "\u{1F3A8} CREATIVE", value: "Creative photo" }
                            ]
                          },
                          {
                            condition: "{{type}} = Professional photo",
                            type: "group",
                            steps: [
                              {
                                type: "ask",
                                param: "concept",
                                default: "A 12-year-old boy with his dog",
                                message: 'Person,topic or idea to draw. E.g.: "A 12-year-old boy with his dog"\n'
                              },
                              {
                                type: "ask",
                                message: "Please pick a style, and I'll select a camera, lens, and filter for you. If you're unsure, click on AUTO.\n",
                                param: "equipment",
                                options: [
                                  { label: "\u2733\uFE0F AUTO", value: "auto-camera" },
                                  {
                                    label: "\u{1F464} PORTRAIT BOKEH",
                                    value: "portrait with bokeh, sharp silhouette of a person, blurred background, using Nikon D850 with a Nikon AF-S NIKKOR 85mm f/1.4G lens"
                                  },
                                  {
                                    label: "\u{1F4A1} STUDIO PORTRAIT",
                                    value: "studio-lit portrait, focus on facial features, Hasselblad H6D-50c with a Hasselblad HC 120mm f/4 Macro lens"
                                  },
                                  {
                                    label: "\u{1F304} WIDE LANDSCAPE",
                                    value: "broad landscape shot, capturing vast sceneries, Sony A7R IV with a Sony FE 16-35mm f/2.8 GM lens"
                                  },
                                  {
                                    label: "\u{1F333} ETHEREAL FOREST",
                                    value: "soft-focused forest scene, dreamy, misty woodland atmosphere, Sony A9 with a Sony FE 50mm f/1.2 GM lens"
                                  },
                                  {
                                    label: "\u{1F50D} DEEP MACRO",
                                    value: "up-close macro, capturing intricate details, Canon EOS 5D Mark IV with a Canon EF 100mm f/2.8L Macro IS USM lens"
                                  },
                                  {
                                    label: "\u{1F4A7} MACRO WORLD IN DROPS",
                                    value: "detailed water drop macro, magnified view of water droplets, Nikon Z7 II with a Nikon Z MC 50mm f/2.8 Macro lens"
                                  },
                                  {
                                    label: "\u{1F30C} STARRY NIGHTS",
                                    value: "night sky photography, capturing stars, Canon EOS 6D Mark II with a Sigma 14mm f/1.8 DG HSM Art lens"
                                  },
                                  {
                                    label: "\u{1F52D} TELEPHOTO COMPRESSION",
                                    value: "telephoto shot, compressed perspective, isolating subjects, Nikon D750 with a Nikon AF-S NIKKOR 70-200mm f/2.8E FL ED VR lens"
                                  },
                                  {
                                    label: "\u{1F98C} WILDLIFE IN ACTION",
                                    value: "wildlife capture, fast-moving subjects in natural habitat, Sony A1 with a Sony FE 100-400mm f/4.5-5.6 GM OSS lens"
                                  },
                                  {
                                    label: "\u{1F3C3} DYNAMIC SPORTS",
                                    value: "sports action, capturing athletes in motion, Canon EOS-1D X Mark III with a Canon EF 24-70mm f/2.8L II USM lens"
                                  },
                                  {
                                    label: "\u{1F457} FASHION GLAM",
                                    value: "fashion shoot, emphasis on clothing, fashion makeup and style, Fujifilm GFX 100 with a Fujinon GF 80mm f/1.7 R WR lens"
                                  },
                                  {
                                    label: "\u{1F681} AERIAL PERSPECTIVE",
                                    value: "aerial shot, birds eye view, DJI Mavic 2 Pro with Hasselblad camera"
                                  },
                                  {
                                    label: "\u{1F3DB} ARCHITECTURAL SYMMETRY",
                                    value: "magazine architectural capture, focus on structures and symmetries, Canon EOS R5 with a Canon TS-E 24mm f/3.5L II Tilt-Shift lens"
                                  },
                                  {
                                    label: "\u{1F420} UNDERWATER WORLD",
                                    value: "underwater capture, underwater scene, Olympus OM-D E-M1 Mark III with an Olympus M.Zuiko Digital ED 7-14mm f/2.8 PRO lens"
                                  },
                                  {
                                    label: "\u{1F303} URBAN NIGHTS",
                                    value: "night photo shot, Panasonic Lumix S1R with a Panasonic Lumix S PRO 35mm f/1.8 lens"
                                  }
                                ]
                              },
                              {
                                condition: "{{equipment}} = auto-camera",
                                type: "gpt",
                                param: "equipment",
                                prompt: `Please, act like a professional photographer and select a camera for me from the list. This camera should be suitable for the type of photograph I want to take. The type of photograph I want to take or it's idea: "{{concept}}". Do not repeat my photograph idea in your response.
List of cameras and possible frame descriptions:

PORTRAIT BOKEH: "portrait with bokeh, sharp silhouette of a person, blurred background, using Nikon D850 with a Nikon AF-S NIKKOR 85mm f/1.4G lens"
STUDIO PORTRAIT: "studio-lit portrait, focus on facial features, Hasselblad H6D-50c with a Hasselblad HC 120mm f/4 Macro lens"
WIDE LANDSCAPE: "broad landscape shot, capturing vast sceneries, Sony A7R IV with a Sony FE 16-35mm f/2.8 GM lens"
ETHEREAL FOREST: "soft-focused forest scene, dreamy, misty woodland atmosphere, Sony A9 with a Sony FE 50mm f/1.2 GM lens"
DEEP MACRO: "up-close macro, capturing intricate details, Canon EOS 5D Mark IV with a Canon EF 100mm f/2.8L Macro IS USM lens"
MACRO WORLD IN DROPS: "detailed water drop macro, magnified view of water droplets, Nikon Z7 II with a Nikon Z MC 50mm f/2.8 Macro lens"
STARRY NIGHTS: "night sky photography, capturing stars, Canon EOS 6D Mark II with a Sigma 14mm f/1.8 DG HSM Art lens"
TELEPHOTO COMPRESSION: "telephoto shot, compressed perspective, isolating subjects, Nikon D750 with a Nikon AF-S NIKKOR 70-200mm f/2.8E FL ED VR lens"
WILDLIFE IN ACTION: "wildlife capture, fast-moving subjects in natural habitat, Sony A1 with a Sony FE 100-400mm f/4.5-5.6 GM OSS lens"
DYNAMIC SPORTS: "sports action, capturing athletes in motion, Canon EOS-1D X Mark III with a Canon EF 24-70mm f/2.8L II USM lens"
FASHION GLAM: "fashion shoot, emphasis on clothing, fashion makeup and style, Fujifilm GFX 100 with a Fujinon GF 80mm f/1.7 R WR lens"
AERIAL PERSPECTIVE: "aerial shot, birds eye view, DJI Mavic 2 Pro with Hasselblad camera"
ARCHITECTURAL SYMMETRY: "magazine architectural capture, focus on structures and symmetries, Canon EOS R5 with a Canon TS-E 24mm f/3.5L II Tilt-Shift lens"
UNDERWATER WORLD: "underwater capture, underwater scene, Olympus OM-D E-M1 Mark III with an Olympus M.Zuiko Digital ED 7-14mm f/2.8 PRO lens"
URBAN NIGHTS: "night photo shot, Panasonic Lumix S1R with a Panasonic Lumix S PRO 35mm f/1.8 lens"

FOLLOW THE INSTRUCTIONS:
- Your response should only contain the possible frame description and the camera.
- Respond in lowercase, without using quotes, and avoid adding a period at the end.
- Please avoid repetition of my idea and do not include any notes or additional phrases.
- For your response, use only the information from the List of cameras and possible frame descriptions. Don't make up anything additional, just stick to the provided options.

FOLLOW THE EXAMPLE:
MY PHOTOGRAPH IDEA: "A 12-year-old boy with his dog"
YOUR OUTPUT: portrait with bokeh, sharp silhouette of a person, blurred background, using Nikon D850 with a Nikon AF-S NIKKOR 85mm f/1.4G lens

OUTPUT:
`
                              },
                              {
                                type: "ask",
                                param: "instructions",
                                default: "professional photo",
                                message: 'Do you have any additional instructions? E.g.: "sunlight glares on the camera lens". If not, please press Enter.\n'
                              },
                              {
                                type: "ask",
                                param: "ar",
                                message: "Please select aspect ratio:\n",
                                options: [
                                  { label: "4:3", value: "--ar 4:3" },
                                  { label: "1:1", value: "--ar 1:1" },
                                  { label: "16:9", value: "--ar 16:9" },
                                  { label: "9:16", value: "--ar 9:16" },
                                  { label: "3:4", value: "--ar 3:4" }
                                ]
                              },
                              {
                                type: "say",
                                label: "say-prompt",
                                message: "\n```\n/imagine prompt: {{type}} of [{{concept}}], {{instructions}}, {{equipment}} --v 5.2 {{ar}}\n```\n"
                              },
                              {
                                type: "ask",
                                param: "change",
                                options: [
                                  { label: "\u2705 DONE", value: "no" },
                                  { label: "\u{1F501} TRY AGAIN", value: "retry" }
                                ]
                              },
                              { condition: "{{change}} = no", type: "stop" },
                              {
                                condition: "{{change}} = retry",
                                type: "jump",
                                to: "custom-shot-start"
                              }
                            ]
                          },
                          {
                            condition: "{{type}} = Polaroid  photo",
                            type: "group",
                            steps: [
                              {
                                type: "ask",
                                param: "concept",
                                default: "A 12-year-old boy with his dog",
                                message: 'Person,topic or idea to draw. E.g.: "A 12-year-old boy with his dog"\n'
                              },
                              {
                                type: "ask",
                                message: "Please pick a style, and I'll select a camera, lens, and filter for you. If you're unsure, click on AUTO.\n",
                                param: "equipment",
                                options: [
                                  {
                                    label: "\u{1F39E} VINTAGE FLARE",
                                    value: "classic polaroid look with warm hues, Polaroid SX-70, standard lens, warm-tone filter"
                                  },
                                  {
                                    label: "\u2744\uFE0F FROSTED FRAMES",
                                    value: "soft edges and close-up focus, Polaroid 600 with a close-up lens and soft focus filter"
                                  },
                                  {
                                    label: "\u{1F9D1} RETRO PORTRAIT",
                                    value: "nostalgic portrait capturing essence of the subject, Polaroid OneStep+ with a portrait lens"
                                  },
                                  {
                                    label: "\u{1F3DE} POLAROID LANDSCAPE",
                                    value: "vast scenic views with polaroid characteristics, Polaroid Now with a wide lens and blue filter"
                                  },
                                  {
                                    label: "\u{1F4DC} FADED MEMORIES",
                                    value: "time-worn look reminiscent of old memories, Polaroid Spectra with a standard lens and sepia filter"
                                  }
                                ]
                              },
                              {
                                type: "ask",
                                param: "instructions",
                                default: "playful experiments",
                                message: 'Do you have any additional instructions? E.g.: "sunlight glares on the camera lens". If not, please press Enter.\n'
                              },
                              {
                                type: "ask",
                                param: "ar",
                                message: "Please select aspect ratio:\n",
                                options: [
                                  { label: "1:1", value: "--ar 1:1" },
                                  { label: "16:9", value: "--ar 16:9" },
                                  { label: "9:16", value: "--ar 9:16" },
                                  { label: "4:3", value: "--ar 4:3" },
                                  { label: "3:4", value: "--ar 3:4" }
                                ]
                              },
                              {
                                type: "say",
                                label: "say-prompt",
                                message: "\n```\n/imagine prompt: {{type}} of [{{concept}}], {{instructions}}, {{equipment}} --v 5.2 {{ar}}\n```\n"
                              },
                              {
                                type: "ask",
                                param: "change",
                                options: [
                                  { label: "\u2705 DONE", value: "no" },
                                  { label: "\u{1F501} TRY AGAIN", value: "retry" }
                                ]
                              },
                              { condition: "{{change}} = no", type: "stop" },
                              {
                                condition: "{{change}} = retry",
                                type: "jump",
                                to: "custom-shot-start"
                              }
                            ]
                          },
                          {
                            condition: "{{type}} = Cinematic photo",
                            type: "group",
                            steps: [
                              {
                                type: "ask",
                                param: "concept",
                                default: "Venice Beach at sunset, a 90s movie atmosphere",
                                message: 'Person,topic or idea to draw. E.g.: "Venice Beach at sunset, a 90s movie atmosphere"\n'
                              },
                              {
                                type: "ask",
                                message: "Please pick a style, and I'll select a camera, lens, and filter for you. If you're unsure, click on AUTO.\n",
                                param: "equipment",
                                options: [
                                  {
                                    label: "\u{1F3AC} CLASSIC CINEMA",
                                    value: "the essence of cinema, post-processing, balanced contrast and colors, and a touch of color grading for mood, full-frame DSLR camera with a fast prime lens"
                                  },
                                  {
                                    label: "\u{1F303} NEO-NOIR NIGHTS",
                                    value: "dark, moody night scenes with contrasting colors, Leica M10 with a Leica Summilux-M 50mm f/1.4 ASPH lens and cyan-orange split tone"
                                  },
                                  {
                                    label: "\u{1F3DC} VINTAGE WESTERN",
                                    value: "retro feel of the old west, Fujifilm X-T4 with a Fujinon XF 35mm f/2 R WR lens and sepia toning"
                                  },
                                  {
                                    label: "\u{1F3DE} EPIC VISTAS",
                                    value: "grand landscapes with depth and detail, Pentax K-1 II with a Pentax HD FA 15-30mm f/2.8 ED SDM WR lens and graduated ND filter"
                                  },
                                  {
                                    label: "\u2764\uFE0F ROMANTIC DRAMA",
                                    value: "soft, romantic scenes with a gentle glow, Sony A6400 with a Sigma 56mm f/1.4 DC DN Contemporary lens and soft glow filter"
                                  },
                                  {
                                    label: "\u{1F306} URBAN GRIT",
                                    value: "raw urban scenes with deep contrasts, Leica Q2 with high contrast processing"
                                  }
                                ]
                              },
                              {
                                type: "ask",
                                param: "instructions",
                                default: "professional photo",
                                message: 'Do you have any additional instructions? E.g.: "sunlight glares on the camera lens". If not, please press Enter.\n'
                              },
                              {
                                type: "ask",
                                param: "ar",
                                message: "Please select aspect ratio:\n",
                                options: [
                                  { label: "16:9", value: "--ar 16:9" },
                                  { label: "1:1", value: "--ar 1:1" },
                                  { label: "9:16", value: "--ar 9:16" },
                                  { label: "4:3", value: "--ar 4:3" },
                                  { label: "3:4", value: "--ar 3:4" }
                                ]
                              },
                              {
                                type: "say",
                                label: "say-prompt",
                                message: "\n```\n/imagine prompt: {{type}} of [{{concept}}], {{instructions}}, {{equipment}} --v 5.2 {{ar}}\n```\n"
                              },
                              {
                                type: "ask",
                                param: "change",
                                options: [
                                  { label: "\u2705 DONE", value: "no" },
                                  { label: "\u{1F501} TRY AGAIN", value: "retry" }
                                ]
                              },
                              { condition: "{{change}} = no", type: "stop" },
                              {
                                condition: "{{change}} = retry",
                                type: "jump",
                                to: "custom-shot-start"
                              }
                            ]
                          },
                          {
                            condition: "{{type}} = Creative photo",
                            type: "group",
                            steps: [
                              {
                                type: "ask",
                                param: "concept",
                                default: "The indie rock band on stage after their performance",
                                message: 'Person,topic or idea to draw. E.g.: "The indie rock band on stage after their performance"\n'
                              },
                              {
                                type: "ask",
                                message: "Please pick a style, and I'll select a camera, lens, and filter for you. If you're unsure, click on AUTO.\n",
                                param: "equipment",
                                options: [
                                  {
                                    label: "\u{1F300} LO-FI DREAMS",
                                    value: "dreamy, blurred edges with unpredictable outcomes, Holga 120N with Lomography 120 film"
                                  },
                                  {
                                    label: "\u{1F5A4} NOSTALGIC MONOCHROME",
                                    value: "vintage feel in black and white, capturing timeless moments, Olympus Trip 35 with Ilford HP5 film"
                                  },
                                  {
                                    label: "\u2728 LIGHT LEAKS GALORE",
                                    value: "unintentional light flares creating a unique aura, Lomo LC-A+ with expired Fujifilm Superia 400"
                                  },
                                  {
                                    label: "\u{1F308} RAINBOW SPECTRUM",
                                    value: "play of colors creating a rainbow spectrum, Canon AE-1 with a prism lens"
                                  },
                                  {
                                    label: "\u{1F32B} SOFTLY ETHEREAL",
                                    value: "soft focus creating an otherworldly effect, Nikon FM2 with a Lensbaby Sweet 50 optic"
                                  }
                                ]
                              },
                              {
                                type: "ask",
                                param: "instructions",
                                default: "playful experiments",
                                message: 'Do you have any additional instructions? E.g.: "sunlight glares on the camera lens". If not, please press Enter.\n'
                              },
                              {
                                type: "ask",
                                param: "ar",
                                message: "Please select aspect ratio:\n",
                                options: [
                                  { label: "4:3", value: "--ar 4:3" },
                                  { label: "16:9", value: "--ar 16:9" },
                                  { label: "1:1", value: "--ar 1:1" },
                                  { label: "9:16", value: "--ar 9:16" },
                                  { label: "3:4", value: "--ar 3:4" }
                                ]
                              },
                              {
                                type: "say",
                                label: "say-prompt",
                                message: "\n```\n/imagine prompt: {{type}} of [{{concept}}], {{instructions}}, {{equipment}} --v 5.2 {{ar}}\n```\n"
                              },
                              {
                                type: "ask",
                                param: "change",
                                options: [
                                  { label: "\u2705 DONE", value: "no" },
                                  { label: "\u{1F501} TRY AGAIN", value: "retry" }
                                ]
                              },
                              { condition: "{{change}} = no", type: "stop" },
                              {
                                condition: "{{change}} = retry",
                                type: "jump",
                                to: "custom-shot-start"
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  },
                  {
                    condition: "{{type}} = logo",
                    label: "logo-start",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "type2",
                        options: [
                          { label: "\u303D\uFE0F VECTOR ART", value: "vector" },
                          { label: "\u270F\uFE0F SKETCH", value: "sketch" },
                          { label: "\u{1F4D3} NOTION STYLE", value: "notion" },
                          { label: "\u{1F3A8} COLORED & MINIMAL", value: "colored" },
                          { label: "\u{1F4FB} OLD-FASHIONED", value: "old-fashioned" },
                          { label: "\u{1F170}\uFE0F SINGLE LETTER", value: "letter" }
                        ]
                      },
                      {
                        condition: "{{type2}} = vector",
                        type: "group",
                        steps: [
                          {
                            type: "ask",
                            param: "style",
                            options: [
                              {
                                label: "\u{1F4C4} BASIC",
                                value: "/imagine prompt: Vector graphic logo of [{{concept}}] simple minimal, by Rob Janoff , Realistic photo details, simple, flat, low detail, smooth, plain, minimal, straight design, No background --q 2 --upbeta --v 5.2"
                              },
                              {
                                label: "\u{1F301} LOW-DETAILED",
                                value: "/imagine prompt: Vector graphic logo of [{{concept}}] simple minimal, by Rob Janoff , Realistic photo details, simple, flat, low details, smooth, plain, minimal, straight design, No background --s 50 --upbeta --v 5.2"
                              },
                              {
                                label: "\u{1F343} EARTH COLORS",
                                value: "/imagine prompt: Flat simplified Vector Illustration logo of [{{concept}}], green, biege and yellow pastel colors, basic round and angular shapes, flat 2d, low detail, --no background --s 50 --upbeta --v 5.2"
                              }
                            ]
                          },
                          {
                            type: "ask",
                            param: "concept",
                            message: "Keyword, topic or idea to draw:\n"
                          }
                        ]
                      },
                      {
                        condition: "{{type2}} = old-fashioned",
                        type: "group",
                        steps: [
                          {
                            type: "ask",
                            param: "style",
                            options: [
                              {
                                label: "\u{1F315} ROUND LOGO",
                                value: "/imagine prompt: Old-fashioned round logo of [{{concept}}] [on a solid white background], flat, low detail, smooth, plain, minimal, straight design, --no background --q 2 --upbeta --v 5.2"
                              },
                              {
                                label: "\u2709\uFE0F STAMP LOGO",
                                value: "/imagine prompt: Vintage Stamp Logo of [{{concept}}] [on a solid white background], old-fashioned, faded colors--no background --s 75 --upbeta --v 5.2"
                              },
                              {
                                label: "\u{1F991} INK STAMP PRINT",
                                value: "/imagine prompt: Ink Stamp Print of [{{concept}}] [on a solid white background], vintage , basic form, basic style, monochrome --no background --s 55 --upbeta --v 5.2"
                              }
                            ]
                          },
                          {
                            type: "ask",
                            param: "concept",
                            message: "Keyword, topic or idea to draw:\n"
                          }
                        ]
                      },
                      {
                        condition: "{{type2}} = sketch",
                        type: "group",
                        steps: [
                          {
                            type: "ask",
                            param: "style",
                            options: [
                              {
                                label: "\u{1F308} INK:MULTI-COLORED",
                                value: "/imagine prompt: Pen and ink art logo of [{{concept}}], simple, flat, low detail, smooth, plain, minimal, straight design, --no background --q 2 --s 150 --upbeta --v 5.2"
                              },
                              {
                                label: "\u{1F3B9} INK:BLACK & WHITE ",
                                value: "/imagine prompt: Pen and ink sketch logo of [{{concept}}], simple, flat, low detail, black and white, smooth, plain, minimal, straight design, --no background --q 2 --s 50 --upbeta --v 5.2"
                              },
                              {
                                label: "\u{1F525} CHARCOAL",
                                value: "/imagine prompt: Charcoal sketch logo of [{{concept}}] on a solid white background,charcoal art with smooth shadows, monochrome, handcraft logo design --no background  --s 75 --upbeta --v 5.2"
                              },
                              {
                                label: "\u{1F31A} MONOCHROME COLOR",
                                value: "monochrome"
                              }
                            ]
                          },
                          {
                            condition: "{{style}} != monochrome",
                            type: "ask",
                            param: "concept",
                            message: "Keyword, topic or idea to draw:\n"
                          },
                          {
                            condition: "{{style}} = monochrome",
                            type: "group",
                            steps: [
                              {
                                type: "ask",
                                param: "concept",
                                message: "Keyword, topic or idea to draw:\n"
                              },
                              {
                                type: "ask",
                                message: "Main color:\n",
                                param: "color",
                                options: [
                                  { label: "\u{1F7E5} RED", value: "red" },
                                  { label: "\u{1F7E7} ORANGE", value: "orange" },
                                  { label: "\u{1F7E8} YELLOW", value: "yellow" },
                                  { label: "\u{1F7E9} GREEN", value: "green" },
                                  { label: "\u{1F7E6} BLUE", value: "blue" },
                                  { label: "\u{1F7EA} PURPLE", value: "purple" },
                                  { label: "\u{1F7EB} BROWN", value: "brown" },
                                  { label: "\u2B1B\uFE0F BLACK", value: "black" },
                                  { label: "\u2B1C\uFE0F WHITE", value: "white" },
                                  { value: "$custom" }
                                ]
                              },
                              {
                                type: "calc",
                                param: "style",
                                value: "/imagine prompt: Monochrome {{color}} line drawing logo of [{{concept}}], simple, flat, low detail, smooth, plain, minimal, straight design, --no background --q 2 --upbeta --v 5.2"
                              }
                            ]
                          }
                        ]
                      },
                      {
                        condition: "{{type2}} = notion",
                        type: "group",
                        steps: [
                          {
                            type: "ask",
                            param: "concept",
                            message: "Keyword, topic or idea to draw:\n"
                          },
                          {
                            type: "ask",
                            message: "Background color:\n",
                            param: "color",
                            options: [
                              { label: "\u2B1C\uFE0F WHITE", value: "white" },
                              { label: "\u2B1B\uFE0F BLACK", value: "black" },
                              { label: "\u{1F7E5} RED", value: "red" },
                              { label: "\u{1F7E7} ORANGE", value: "orange" },
                              { label: "\u{1F7E8} YELLOW", value: "yellow" },
                              { label: "\u{1F7E9} GREEN", value: "green" },
                              { label: "\u{1F7E6} BLUE", value: "blue" },
                              { label: "\u{1F7EA} PURPLE", value: "purple" },
                              { label: "\u{1F7EB} BROWN", value: "brown" },
                              { value: "$custom" }
                            ]
                          },
                          {
                            type: "calc",
                            param: "style",
                            value: "/imagine prompt: Beautiful, minimalist character [{{concept}}] [on a solid {{color}} background] black line flat illustrations in the style of the Notion website, black line flat illustrations in the style of the Notion website --upbeta --v 5.2"
                          }
                        ]
                      },
                      {
                        condition: "{{type2}} = colored",
                        type: "group",
                        steps: [
                          {
                            type: "ask",
                            param: "style2",
                            options: [
                              { label: "\u{1F680} FUTURISTIC", value: "futuristic" },
                              {
                                label: "\u{1F4FB} 80-90s STYLE",
                                value: "old-fashioned"
                              },
                              { label: "\u{1F386} NEON", value: "neon" }
                            ]
                          },
                          {
                            type: "ask",
                            param: "concept",
                            message: "Keyword, topic or idea to draw:\n"
                          },
                          {
                            type: "ask",
                            message: "Background color:\n",
                            param: "color",
                            options: [
                              { label: "\u2B1C\uFE0F WHITE", value: "white" },
                              { label: "\u2B1B\uFE0F BLACK", value: "black" },
                              { label: "\u{1F7E5} RED", value: "red" },
                              { label: "\u{1F7E7} ORANGE", value: "orange" },
                              { label: "\u{1F7E8} YELLOW", value: "yellow" },
                              { label: "\u{1F7E9} GREEN", value: "green" },
                              { label: "\u{1F7E6} BLUE", value: "blue" },
                              { label: "\u{1F7EA} PURPLE", value: "purple" },
                              { label: "\u{1F7EB} BROWN", value: "brown" },
                              { value: "$custom" }
                            ]
                          },
                          {
                            condition: "{{style2}} = futuristic",
                            type: "calc",
                            param: "style",
                            value: "/imagine prompt: Colored isolated logo of [{{concept}}]  [on a solid {{color}} background], alebrije, lee ufan, anne truitt, minimalist, artifacts of online culture, use of fabric, functional aesthetics, flat 2d, vector --s 50 --style raw --v 5.2"
                          },
                          {
                            condition: "{{style2}} = old-fashioned",
                            type: "calc",
                            param: "style",
                            value: "/imagine prompt: Colored isolated logo of [{{concept}}]  [on a solid {{color}} background], colorful, minimalist, old-fashioned, 80s-90s style,  plain, functional, flat 2d, vector --s 50 --style raw --v 5.2"
                          },
                          {
                            condition: "{{style2}} = neon",
                            type: "calc",
                            param: "style",
                            value: "/imagine prompt: Colored isolated logo of [{{concept}}]  [on a solid {{color}} background], minimalist, by Rob Janoff, plain,  functional, neon colors, flat 2d, vector --s 50 --style raw --v 5.2"
                          }
                        ]
                      },
                      {
                        condition: "{{type2}} = letter",
                        type: "group",
                        steps: [
                          {
                            type: "ask",
                            param: "concept",
                            message: "Please, type one letter:\n"
                          },
                          {
                            type: "ask",
                            message: "Background color:\n",
                            param: "color",
                            options: [
                              { label: "\u2B1C\uFE0F WHITE", value: "white" },
                              { label: "\u2B1B\uFE0F BLACK", value: "black" },
                              { label: "\u{1F7E5} RED", value: "red" },
                              { label: "\u{1F7E7} ORANGE", value: "orange" },
                              { label: "\u{1F7E8} YELLOW", value: "yellow" },
                              { label: "\u{1F7E9} GREEN", value: "green" },
                              { label: "\u{1F7E6} BLUE", value: "blue" },
                              { label: "\u{1F7EA} PURPLE", value: "purple" },
                              { label: "\u{1F7EB} BROWN", value: "brown" },
                              { value: "$custom" }
                            ]
                          },
                          {
                            type: "ask",
                            param: "instructions",
                            default: "simple, flat 2d, minimal, straight design",
                            message: "Do you have any additional instructions? If not, please press Enter.\n"
                          },
                          {
                            type: "calc",
                            param: "style",
                            value: "/imagine prompt: English Letter [{{concept}}] Vector Logo Design [on a solid {{color}} background], {{instructions}}, --s 50 --q 2 --upbeta --v 5.2"
                          }
                        ]
                      }
                    ]
                  },
                  {
                    type: "ask",
                    param: "ar",
                    message: "Please select aspect ratio:\n",
                    options: [
                      { label: "1:1", value: "--ar 1:1" },
                      { label: "16:9", value: "--ar 16:9" },
                      { label: "9:16", value: "--ar 9:16" },
                      { label: "3:4", value: "--ar 3:4" },
                      { label: "4:3", value: "--ar 4:3" }
                    ]
                  },
                  {
                    type: "say",
                    label: "say-prompt",
                    message: "\n```\n{{style}} {{ar}}\n```\n"
                  },
                  {
                    type: "ask",
                    label: "ask-for-change-2",
                    param: "change",
                    options: [
                      { label: "\u2705 DONE", value: "no" },
                      { label: "\u{1F501} TRY AGAIN", value: "retry" }
                    ]
                  },
                  { condition: "{{change}} = no", type: "stop" },
                  {
                    condition: "{{change}} = retry",
                    type: "jump",
                    to: "start-templates"
                  }
                ]
              }
            ]
          },
          {
            meta: {
              name: "prompt-generator",
              title: "Prompt generator",
              category: "Generative AI",
              description: "Create a GPT prompt for a specific task."
            },
            steps: [
              {
                type: "ask",
                message: "Please describe an idea and optional parameters of your prompt:\n",
                param: "prompt-idea",
                default: "I want a prompt that will help me generate viral tweets.\n"
              },
              {
                type: "gpt",
                prompt: 'Please ignore all previous instructions. I want you to only respond in {{language}}. Pretend you\'re the best prompt writer and AI researcher in the world. Your task is to generate a GPT prompt for me, based on the Prompt Idea. Please propose inputs for me based on the minimum necessary amount of information, don\'t make many inputs. Do not write long prompts, be concise and to the point. I need an answer without any Notes and unnecessary phrases at the beginning or end. Follow the examples and instructions clearly.\n\n--- Prompt Idea:\n{{prompt-idea}}\n\n--- Prompt Output Format:\n\n1. Prefix prompt with text: "Please ignore all previous instructions. I want you to only respond in {{\\language}}."\n\n2. Instruct GPT to take a role of or act as a competent person / professional with specific competence to fulfill the task (come up with a profession based on the task).\n\n3. Clearly and unambiguously describe the task and the criteria for its completion.\n\n4. Indicate all prompt parameters one by one. Each parameter should be listed in a format [PARAMETER NAME]: {{\\p1}}. Parameter name should be in square brackets, followed by the parameter id in format {{\\pN}}, for example:\n\n"[TWEET TOPIC]: {{\\p1}}"\n\n"[EMAIL ADDRESS]: {{\\p2}}"\n\n5. At the end, provide a word or phrase describing the result with the colon, e.g. "TWEET:". Do not write anything after the colon.\n\n6. Leave 2 empty lines between each of the paragraphs and parameters.\n\n7. Wrap your response into a markdown code block. Example:\n```markdown\n...generated prompt...\n```\n\n--- Example Prompt Idea:\nI want a prompt that will help me generate viral tweets\n\n--- Example Generated Prompt:\n\n```markdown\nPlease ignore all previous instructions. I want you to only respond in {{\\language}}.\n\nAct as a social media influencer and generate a tweet that would be likely to go viral. Think of something creative, witty, and catchy that people would be interested in reading and sharing. Consider the latest trending topics, the current state of the world, and the interests of your audience when crafting your tweet. Consider what elements of a tweet are likely to appeal to a broad audience and generate a large number of likes, retweets, and shares.\n\n[TWEET TOPIC]: {{\\p1}}\n\nTweet:\n```\n'
              },
              {
                type: "js",
                args: "gpt",
                code: "const paramRegex = /\\[([^\\]]+)\\]: (.+)/g\nconst matches = []\nlet match\n\nwhile ((match = paramRegex.exec(args.gpt)) !== null) {\n  const paramName = match[1].trim()\n  const paramValue = '{{\\\\' + match[2].trim().slice(2)\n  matches.push(`[${paramName}]: ${paramValue}`)\n}\n\nreturn matches.join(', ') || '\u2014'",
                param: "gpt",
                silent: true
              },
              {
                condition: "{{gpt}} != \u2014",
                type: "gpt",
                prompt: "Now your task is to generate one question for every parameter input you mentioned in the prompt in square brackets: {{gpt}}.\nI need you to answer without any Notes and unnecessary phrases at the beginning or end. Follow the examples and instructions clearly.\n\n--- Prompt Example:\n\n```markdown\nPlease ignore all previous instructions. I want you to only respond in {{\\language}}.\n\nAct as a social media influencer and generate a tweet that would be likely to go viral. Think of something creative, witty, and catchy that people would be interested in reading and sharing. Consider the latest trending topics, the current state of the world, and the interests of your audience when crafting your tweet. Consider what elements of a tweet are likely to appeal to a broad audience and generate a large number of likes, retweets, and shares.\n\n[TWEET TOPIC]: {{\\p1}}\n\nTweet:\n```\n\n--- Example Output:\n\n### Tweet topic, p1\n\n```markdown\nPlease provide a tweet topic.\n```\n"
              },
              {
                type: "say",
                message: `### How to create a custom command
- Type / in chat and click the "Create command +" option at the top.
- Copy paste prompt to GPT step.
- Click ADD STEP -> ASK for every parameter (p1, p2, p3...) and paste relevant question.
- Give command a name, hit SAVE button to store it locally in HARPA AI in your browser.

You'll get your command saved at the top, above the pre-configured prompts, whenever you type / in chat.`
              }
            ]
          },
          {
            meta: {
              name: "stable-diffusion-prompt-generator",
              title: "Stable diffusion prompt generator",
              category: "Generative AI",
              description: "Outputs four detailed Stable Diffusion prompts for your topic."
            },
            steps: [
              { say: "Keyword, topic or idea to draw:\n" },
              { ask: "topic" },
              {
                gpt: `Please ignore all previous instructions. I want you to respond only in English.
Stable Diffusion is an AI art generation model similar to DALLE-2.
Below is a list of sample prompts that can be used to generate images with Stable Diffusion:
- portrait of a homer simpson archer shooting arrow at forest monster, front game card, marvel comics, dark, intricate, highly detailed, smooth, art station, digital illustration by ruan jia and mandy jurgens and wayne barlowe and greg rutkowski and zdislav beksinski
- pirate, concept art, deep focus, fantasy, intricate, highly detailed, digital painting, artstation, matte, sharp focus, illustration, art by magali villeneuve, chippy, ryan yee, rk post, clint cearley, daniel ljunggren, zoltan boros, gabor szikszai, howard lyon, steve argyle, winona nelson
- ghost inside a hunted room, art by lois van baarle and loish and ross tran and rossdraws and sam yang and samdoesarts and artgerm, digital art, highly detailed, intricate, sharp focus, trending on artstation hq, deviantart, unreal engine 5, 4K UHD image
- red dead redemption 2, cinematic view, epic sky, detailed, concept art, low angle, high detail, warm lighting, volumetric, godrays, vivid, beautiful, trending on artstation, by jordan grimmer, huge scene, grass, art greg rutkowski
- a fantasy style portrait painting of rachel lane / alison brie hybrid in the style of francois boucher oil painting unreal 5 daz. rpg portrait, extremely detailed artgerm greg rutkowski alphonse mucha greg hildebrandt tim hildebrandt
- athena, greek goddess, claudia black, art by artgerm and greg rutkowski and magali villeneuve, bronze greek armor, owl crown, d & d, fantasy, intricate, portrait, highly detailed, headshot, digital painting, trending on artstation, concept art, sharp focus, illustration
- closeup portrait shot of a large strong female biomechanic woman in a scenic scifi environment, intricate, elegant, highly detailed, centered, digital painting, artstation, concept art, smooth, sharp focus, warframe, illustration, thomas kinkade, tomasz alen kopera, peter mohrbacher, donato giancola, leyendecker, boris vallejo
- ultra realistic illustration of steve urkle as the hulk, intricate, elegant, highly detailed, digital painting, artstation, concept art, smooth, sharp focus, illustration, art by artgerm and greg rutkowski and alphonse mucha
I want you to create a prompt in a similar style to the ones above. It must contain the following elements.
- Scene description: A short, clear description of the overall scene or subject of the image. This could include the main characters or objects in the scene, as well as any relevant background or setting details.
- Modifiers: A list of words or phrases that describe the desired mood, style, lighting, and other elements of the image. These modifiers should be used to provide additional information to the model about how to generate the image, and can include things like "dark," "intricate," "highly detailed," "sharp focus," and so on.
- Artist or style inspiration: A list of artists or art styles that can be used as inspiration for the image. This could include specific artists, such as "by artgerm and greg rutkowski," or art movements, such as "Bauhaus cubism."
- Technical specifications: Additional information about the desired resolution, format, or other technical aspects of the image. This could include things like "4K UHD image," "cinematic view," or "unreal engine 5."
Combine all of those aspects into one prompt. Don't write single points.

[TOPIC]: {{topic}}

[4 DETAILED STABLE DIFFUSION PROMPTS]:`
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u{1F501} REDO", value: "redo" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = redo",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier: [TOPIC] and [ADDITIONAL INSTRUCTIONS]. Provide a rewritten output.\n\n[TOPIC]: {{topic}}\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[4 DETAILED STABLE DIFFUSION PROMPTS]:"
              },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier: [TOPIC] and [ADDITIONAL INSTRUCTIONS]. Provide a rewritten output.\n\n[TOPIC]: {{topic}}\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[4 DETAILED STABLE DIFFUSION PROMPTS]:"
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "google-sheets-expert",
              title: "Google Sheets expert",
              category: "Spreadsheets",
              description: "Get help with Google Sheets, generate macros, write formulas, browse shortcuts etc.",
              apps: "Google Sheets"
            },
            steps: [
              {
                say: "Ask me any question about Google Sheets, including macros, formulas, shortcuts:\n"
              },
              { ask: "param" },
              {
                gpt: "Please ignore all previous instructions. I want you to respond only in {{language}}.\nI want you to act as an expert in Google Sheets. I will ask you questions regarding formulas, writing macros, shortcuts etc. Whenever you output a formula or macros, please format them in markdown code block.\n\n[HERE IS THE FIRST QUESTION REGARDING GOOGLE SHEETS]:\n{{param}}\n\n[ANSWER]:"
              }
            ]
          },
          {
            meta: {
              name: "microsoft-excel-expert",
              title: "Microsoft Excel expert",
              category: "Spreadsheets",
              description: "Get help with MS Excel, generate macros, write formulas, browse shortcuts etc.",
              apps: "Microsoft Excel"
            },
            steps: [
              {
                say: "Ask me any question about MS Excel, including macros, formulas, shortcuts:\n"
              },
              { ask: "param" },
              {
                gpt: "Please ignore all previous instructions. I want you to respond only in {{language}}.\nI want you to act as an expert in MS Excel. I will ask you questions regarding formulas, writing macros, shortcuts etc. Whenever you output a formula or macros, please format them in markdown code block.\n\n[HERE IS THE FIRST QUESTION REGARDING MICROSOFT EXCEL]:\n{{param}}\n\n[ANSWER]:"
              }
            ]
          },
          {
            meta: {
              name: "coding-assistant",
              title: "Coding Assistant",
              category: "Assistant",
              description: "Ask any question about JavaScript, Git, HTML, MySQL, PHP, Python, Docker, etc. Write, inspect, debug code.",
              apps: "Stackoverflow"
            },
            steps: [
              {
                type: "ask",
                message: "Pick your coding tech and I'll do my best to help.",
                param: "tech",
                options: [
                  {
                    label: "AUTO",
                    value: "Please act as an expert in software development, coding, web interfaces, and related issues. I want you to help me understand my problem and provide a solution or answer my question:"
                  },
                  {
                    label: "\u{1F31F} JS",
                    value: "I want you to act as an expert in JavaScript. Your task is to parse JavaScript-related question from the following text and give me an answer:"
                  },
                  {
                    label: "\u2615\uFE0F JAVA",
                    value: "I want you to act as an expert in Java. Your task is to parse Java-related question from the following text and give me an answer:"
                  },
                  {
                    label: "\u{1F419} GIT",
                    value: "I want you to act as an expert in Git. Your task is to parse Git-related question from the following text and give me an answer:"
                  },
                  {
                    label: "\u{1F310} HTML",
                    value: "I want you to act as an expert in HTML. Your task is to parse HTML-related question from the following text and give me an answer:"
                  },
                  {
                    label: "\u{1F310} CSS",
                    value: "I want you to act as an expert in CSS. Your task is to parse CSS-related questions from the following text and give me an answer:"
                  },
                  {
                    label: "\u{1F30D} REACT",
                    value: "I want you to act as an expert in React. Your task is to parse React-related questions from the following text and give me an answer:"
                  },
                  {
                    label: "\u{1F42C} MySQL",
                    value: "I want you to act as an expert in MySQL. Your task is to parse MySQL-related question from the following text and give me an answer:"
                  },
                  {
                    label: "\u{1F418} PHP",
                    value: "I want you to act as an expert in PHP. Your task is to parse PHP-related question from the following text and give me an answer:"
                  },
                  {
                    label: "\u{1F40D} PYTHON",
                    value: "I want you to act as an expert in Python. Your task is to parse Python-related question from the following text and give me an answer:"
                  },
                  {
                    label: "\u{1F433} DOCKER",
                    value: "I want you to act as an expert in Docker. Your task is to parse Docker-related question from the following text and give me an answer:"
                  },
                  {
                    label: "\u{1F48E} RUBY",
                    value: "I want you to act as an expert in Ruby. Your task is to parse Ruby-related question from the following text and give me an answer:"
                  },
                  {
                    label: "\u{1F426} SWIFT",
                    value: "I want you to act as an expert in Swift. Your task is to parse Swift-related question from the following text and give me an answer:"
                  },
                  {
                    label: "\u{1F439} GO",
                    value: "I want you to act as an expert in Golang. Your task is to parse Golang-related question from the following text and give me an answer:"
                  },
                  {
                    label: "\u{1F980} RUST",
                    value: "I want you to act as an expert in Rust programming language. Your task is to parse Rust-related question from the following text and give me an answer:"
                  },
                  {
                    label: "\u{1F40D} C++",
                    value: "I want you to act as an expert in C++. Your task is to parse C++-related questions from the following text and give me an answer:"
                  },
                  {
                    label: "\u{1F41A} SHELL",
                    value: "I want you to act as an expert in Shell Scripting. Your task is to parse Shell Scripting-related questions from the following text and give me an answer:"
                  },
                  {
                    label: "\u{1F331} NODE JS",
                    value: "I want you to act as an expert in Node.js. Your task is to parse Node.js-related questions from the following text and give me an answer:"
                  },
                  {
                    label: "\u{1F6A7} DEVOPS",
                    value: "I want you to act as an expert in DevOps. Your task is to parse DevOps-related questions from the following text and give me an answer:"
                  },
                  { value: "$custom" }
                ]
              },
              {
                condition: "{{tech-option}} = custom",
                type: "calc",
                param: "tech",
                value: "I want you to act as an expert in {{tech}}."
              },
              {
                ask: "param",
                message: "Ask your question. Leave blank to parse question from the web page:",
                default: "{{page}}"
              },
              {
                gpt: "Please ignore all previous instructions. I want you to respond only in {{language}}.\n{{tech}}\n{{param}}\n\nIf you are sending me a snippet of code in your response, please place each snippet in a markdown code block, with the code itself enclosed in code-block quotes:\n\n```markdown\nsnippet\n```\n\nAnswer (use markdown syntax if necessary):\n"
              }
            ]
          },
          {
            meta: {
              name: "trip-planner",
              title: "Trip planner",
              category: "Assistant",
              description: "Get a personalized day-by-day itinerary for your vacation including 24/7 schedule, activity and budget."
            },
            steps: [
              {
                say: "Describe your journey. Enter a known route and dates, indicate the duration of the trip and its style (work, vacation, with children, hidden gems, car trip etc.) and who you travel with:"
              },
              { ask: "param" },
              {
                gpt: "Please ignore all previous instructions. The output text should be in {{language}}.\nPretend you are the world's best trip advisor. Help me to craft the perfect trip plan. You will use the [TRIP DESCRIPTION] that I give you as a reference for the trip. This [TRIP DESCRIPTION] may include location, duration of the trip, who I am traveling with, and the style of the trip.\nHotels, flights, and transportation has already been taken care of. I simply want to plan the most fun trip and take the most advantage of my time while I'm there.\nI am taking the trip to eat good food, find unique things to do, see beautiful sights, go to cool events. It should be a trip of a lifetime and jam packed with things to do.\nMake sure to fill out every hour of the trip and include travel time and distances between locations (by car or public transport).\nIn conclusion, list out all the average costs for the activities, restaurants, museums and transportation. I do not want you to make real-time reservations or to provide exact costs of activities, I just need your advice.\nEven if you don't know the price of things make an estimate based on the activity. And at the end of the list total up all of column two for a total budget for the activities.\n\n[TRIP DESCRIPTION]:\n{{param}}.\n\n[TRIP PLAN]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[TRIP PLAN]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "checklist-helper",
              title: "Checklist helper",
              category: "Assistant",
              description: "Helps with ideas for creating checklists on a given topic."
            },
            steps: [
              {
                say: "What would you like to do or prepare for? E.g. fungal zombie apocalypse:\n"
              },
              { ask: "param" },
              {
                gpt: "Please ignore all previous instructions. I want you to respond only in language {{language}}.\nAct as an organized project manager and create a detailed checklist with advice for doing or preparing for my [EVENT]. As a professional project manager, decompose tasks into 2 or more parts (bullet points) so that each checklist item is clear and actionable.\nPlease sort the checklist items according to their importance. Do not ask additional questions and do not repeat my question.\n\nExample output:\n## Checklist: [create a title]\n### 1. [Checkpoint title] - decomposed part of the task - decomposed part of the task - Add as many parts as you deem necessary.\n\nAdd as many checkpoints to the checklist as you deem necessary.\n\n[EVENT]: {{param}}\n\n[CHECKLIST]:"
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS]. Provide a rewritten response.\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[CHECKLIST]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "okr-business-planner",
              category: "Assistant",
              title: "OKR business planner",
              description: "Writes an Objectives and Key Results (OKRs) business plan."
            },
            steps: [
              {
                type: "ask",
                param: "idea",
                message: "Provide information on your business idea. E.g.:\nOur goal is to develop a Google Chrome extension that keeps track of how much time you spend on different websites and provides a daily summary. We aim to acquire 100,000 users within the first year.",
                default: "Our goal is to develop a Google Chrome extension that keeps track of how much time you spend on different websites and provides a daily summary. We aim to acquire 100,000 users within the first year."
              },
              {
                type: "gpt",
                prompt: "Please ignore all previous instructions.\nYou are a skilled business developer that speaks and writes fluent {{language}}.\nYour task is to generate a detailed Objectives and key results (OKRs) 2 years business plan for my company or product.\n\nMain idea:\nObjectives and key results (OKRs) is a popular goal setting methodology to help teams go after audacious goals. With this framework, you\u2019ll identify:\nObjectives: What you want to achieve. An Objective is simply what is to be achieved, no more and no less. By definition, Objectives are significant, concrete, action oriented, and (ideally) inspirational. When properly designed and deployed, they\u2019re a vaccine against fuzzy thinking and ineffective execution.\nKey results (KR): benchmark and monitor how we get to the Objective. Effective KRs are specific, time-bound, and aggressive yet realistic. Most of all, they are measurable and verifiable.\nKeep in mind that your key results need to be quantitative, measurable outcomes and not tasks or to-dos. So, sticking with our example of world-class customer service, a key result could be, \u201CSecure 25+ five-star reviews by the end of Q2.\u201D\n\nOKRs are designed to be ambitious, and you don\u2019t want to overdo it and overwhelm your team.\n\nTo create a plan, take into account short-term (1 month), medium-term (1 quarter), and long-term plans. For the first year, use short-term planning for the first 6 months (M1-M6) of the plan. Then, for Q3 and Q4, switch to medium-term planning and assess the annual result Y1. For the second year, rely only on quarterly planning (Q1-Q4) and annual planning Y2.\n\nUse headers (H2, H3) and follow my plan:\n## 1st year\n### M1 Objective\n- KR 1:\n- KR 2:\n- KR 3:\n### M2 Objective\n- KR 1:\n- KR 2:\n- KR 3:\n### M3 Objective\n- KR 1:\n- KR 2:\n- KR 3:\n### M4 Objective\n- KR 1:\n- KR 2:\n- KR 3:\n### M5 Objective\n- KR 1:\n- KR 2:\n- KR 3:\n### M6 Objective\n- KR 1:\n- KR 2:\n- KR 3:\n### Q3 Objective\n- KR 1:\n- KR 2:\n- KR 3:\n### Q4 Objective\n- KR 1:\n- KR 2:\n- KR 3:\n## Y1 Objective\n- KR 1:\n- KR 2:\n- KR 3:\n\n## 2nd year\n### Q1 Objective\n- KR 1:\n- KR 2:\n- KR 3:\n### Q2 Objective\n- KR 1:\n- KR 2:\n- KR 3:\n### Q3 Objective\n- KR 1:\n- KR 2:\n- KR 3:\n### Q4 Objective\n- KR 1:\n- KR 2:\n- KR 3:\n## Y2 Objective\n- KR 1:\n- KR 2:\n- KR 3:\n\nFollow the required format, don't write anything extra, avoid generic phrases, and don't repeat my task.\n\n[My business idea]: {{idea}}\n\n[Objectives and key results (OKRs) 2 years business plan]:\n"
              }
            ]
          },
          {
            meta: {
              name: "inspirational-quotes",
              title: "Inspirational quotes",
              category: "Miscellaneous",
              emoji: "\u{1F5EF}\uFE0F",
              description: "Input a problem area to get inspiring quotes for people struggling with that problem."
            },
            steps: [
              {
                say: 'Frame a problem, for example "Why I struggle learning a foreign language?":\n'
              },
              {
                ask: "param",
                default: "Why do I struggle learning a foreign language?"
              },
              {
                gpt: `Please ignore all previous instructions. I want you to respond only in {{language}}.

Give me up to 10 short inspirational quotes about the following [TOPIC OR PROBLEM]:
{{param}}

Mix the quotes up with metaphors, straight up advice, wrong ideas to avoid and encouragement start each quote with a different word.
Don't self reference. Refrain from starting with "you" or "like". Avoid repetition and keep the quotes fresh and activating.
Use only quotes from famous personalities and authors. Do not write quotes whose author is unknown to you.

OUTPUT FORMAT:
1. "[quote]" - [author]. 2. "[quote]" - [author].

[QUOTES]:`
              },
              {
                type: "ask",
                label: "ask-for-change",
                param: "change",
                options: [
                  { label: "\u2705 DONE", value: "no" },
                  { label: "\u2734\uFE0F REFINE", value: "refine" },
                  { value: "$custom" }
                ]
              },
              { condition: "{{change}} = no", type: "stop" },
              {
                condition: "{{change}} = refine",
                type: "ask",
                param: "instructions",
                message: "What changes would you like me to make?"
              },
              {
                condition: "{{change}} = refine",
                type: "gpt",
                prompt: "Please completely rewrite your answer, taking into account the inputs provided earlier and [ADDITIONAL INSTRUCTIONS].\n\n[ADDITIONAL INSTRUCTIONS]: {{instructions}}\n\n[QUOTES]:"
              },
              {
                condition: "{{change-option}} = $custom",
                type: "group",
                steps: [{ type: "gpt", prompt: "{{change}}" }, { type: "stop" }]
              },
              { type: "jump", to: "ask-for-change" }
            ]
          },
          {
            meta: {
              name: "text-adventure-game-simulation",
              category: "Miscellaneous",
              title: "Text adventure game simulation",
              emoji: "\u{1F3F9}",
              description: "Play a choose-your-own-adventure game in a story or setting you like."
            },
            steps: [
              {
                say: "Setting (1/2): describe the setting, adventure plot, world etc:\n"
              },
              { ask: "setting" },
              {
                say: "Character (2/2): describe who you are in the game. You can include your backstory, inventory, skills, etc:\n"
              },
              { ask: "character" },
              {
                say: "Great! Simulating an adventure game... I will interpret everything you say as your in-game character actions. You can give me instructions in brackets like so: { what is painted on the wall? }.\n"
              },
              {
                type: "gpt",
                prompt: `Please ignore all previous instructions.
I want you to simulate a text based adventure game for the player. I will pass you the game context: setting, character, inventory, NPCs, etc., and the player input (actions or messages).
I want you to reply with a description of what the player's character sees (scene). Here is the scene format:

"Scene description (short, 1 or 2 paragraphs).
INVENTORY: Character inventory.
OPTIONS: 1. Option 1 2. Option 2 3. Option 3 4. Something else?"

Only reply with the game output. Do not write explanations. Do not self-reference. Do not break the "third wall". Assume roles of NPCs in dialogues with the player.
Treat any text player puts inside brackets { like this } as instructions for you and not as player actions in the game.
Every time the player would take an action, stop writing and wait for the input. Do not rush through the story. Do not make decisions for the player. Every time the player would make a decision, instead of continuing, stop and wait for player input, giving a list of options (from 2 to 4).
Game Setting: {{setting}}
Player's Character: {{character}}
[FIRST SCENE]:
`
              },
              { ask: "param", label: "loop" },
              {
                type: "gpt",
                prompt: "[PLAYER INPUT]: {{param}}\n[NEXT SCENE]:\n"
              },
              { ask: "param" },
              {
                type: "gpt",
                prompt: "[PLAYER INPUT]: {{param}}\n[NEXT SCENE]:\n"
              },
              { ask: "param" },
              {
                type: "gpt",
                prompt: "[PLAYER INPUT]: {{param}}\n[NEXT SCENE]:\n"
              },
              { ask: "param" },
              {
                type: "gpt",
                prompt: `[PLAYER INPUT]: {{param}}
I would like to remind you about the following:
- Only reply with the game output. Do not write explanations. Do not self-reference. Do not break the "third wall". Assume roles of NPCs in dialogues with the player.
- Treat any text player puts inside brackets { like this } as instructions for you and not as player actions in the game.
- Every time the player would take an action, stop writing and wait for the input. Do not make decisions for the player. Do not rush through the story.
- Initial Game Setting: {{setting}}
- Initial Player's Character: {{character}}
[NEXT SCENE]:
`
              },
              { type: "jump", to: "loop" }
            ]
          },
          {
            meta: {
              name: "tarot",
              title: "Tarot",
              description: "Ask the cards a question to reflect, meditate and get a perspective, or help making a tough decision.",
              category: "Miscellaneous",
              emoji: "\u{1F0CF}"
            },
            steps: [
              {
                condition: "{{hasPro}} =",
                label: "CHECK LIMITS",
                type: "group",
                steps: [
                  {
                    condition: "{{g.tarot.remaining}} =",
                    type: "calc",
                    func: "set",
                    param: "g.tarot.remaining",
                    format: "",
                    value: "3"
                  },
                  {
                    type: "js",
                    code: "const d = new Date();\nd.setUTCHours(0, 0, 0, 0);\n\nconst dayOfWeek = d.getUTCDay();\nconst daysUntilSunday = 7 - dayOfWeek;\nd.setUTCDate(d.getUTCDate() + daysUntilSunday);\n\nconst yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));\nreturn Math.ceil((((d - yearStart) / 86400000) + 1) / 7);",
                    args: "",
                    param: "currentWeekNumber",
                    silent: true
                  },
                  {
                    type: "js",
                    code: 'const now = new Date();\nconst nextMonday = new Date(now); nextMonday.setDate(now.getDate() + (8 - now.getDay()) % 7); nextMonday.setHours(0, 0, 0, 0);\n\nconst diff = nextMonday - now; const days = Math.floor(diff / (24 * 60 * 60 * 1000)); const hours = Math.floor((diff % (24 * 60 * 60 * 1000)) / (60 * 60 * 1000));\n\nconst dayText = days === 1 ? "day" : "days"; const hourText = hours === 1 ? "hour" : "hours";\nreturn `${days} ${dayText} and ${hours} ${hourText}`;',
                    args: "",
                    param: "timer",
                    silent: true
                  },
                  {
                    condition: "{{g.tarot.weeknumber}} =",
                    type: "calc",
                    func: "set",
                    param: "g.tarot.weeknumber",
                    format: "",
                    value: "{{currentWeekNumber}}"
                  },
                  {
                    condition: "{{g.tarot.weeknumber}} != {{currentWeekNumber}}",
                    type: "calc",
                    func: "set",
                    param: "g.tarot.remaining",
                    format: "",
                    value: "3"
                  },
                  {
                    condition: "{{g.tarot.remaining}} < 1",
                    label: "NO SPREADS FOR TODAY",
                    type: "group",
                    steps: [
                      {
                        type: "say",
                        message: "\u2728 The cards are silent. You asked too many questions and the Tarot refuses to offer its wisdom today. The cards will speak again in **{{timer}}**."
                      },
                      { type: "stop" }
                    ]
                  }
                ]
              },
              {
                type: "say",
                message: "\u2728 Greetings. I invite you to approach this moment with reverence.\n\nThe mystical Tarot offers insights into the preordained paths of destiny. It is your choice to seek card wisdom or to refrain.\n\nCards are willing to answer **{{g.tarot.remaining}}** questions this week."
              },
              {
                label: "SHUFFLE DECK",
                type: "group",
                steps: [
                  {
                    label: "ASK FOR SPREAD",
                    type: "ask",
                    param: "spread",
                    message: "\u2728 Choose the type of card spread for our journey into the Arcane.",
                    options: [
                      { label: "\u{1F31F} QUICK INSIGHT", value: "one" },
                      { label: "\u{1F0CF} TRIAD OF TRUTH", value: "three" },
                      { label: "\u{1F495} RELATIONSHIP", value: "relationship" }
                    ],
                    default: "",
                    optionsInvalid: false
                  },
                  { type: "say", message: "\u23F3 Shuffling the deck of cards..." },
                  {
                    label: "DECK",
                    type: "js",
                    code: "const cards = [\n  { card: 'Fool', img: 'the-fool' },\n  { card: 'Magician', img: 'the-magician' },\n  { card: 'High Priestess', img: 'the-high-priestess' },\n  { card: 'Empress', img: 'the-empress' },\n  { card: 'Emperor', img: 'the-emperor' },\n  { card: 'Hierophant', img: 'the-hierophant' },\n  { card: 'Lovers', img: 'the-lovers' },\n  { card: 'Chariot', img: 'the-chariot' },\n  { card: 'Strength', img: 'strength' },\n  { card: 'Hermit', img: 'the-hermit' },\n  { card: 'Wheel of Fortune', img: 'the-wheel-of-fortune' },\n  { card: 'Justice', img: 'the-justice' },\n  { card: 'Hanged Man', img: 'the-hanged-man' },\n  { card: 'Death', img: 'the-death' },\n  { card: 'Temperance', img: 'the-temperance' },\n  { card: 'Devil', img: 'the-devil' },\n  { card: 'Tower', img: 'the-tower' },\n  { card: 'Star', img: 'the-star' },\n  { card: 'Moon', img: 'the-moon' },\n  { card: 'Sun', img: 'the-sun' },\n  { card: 'Judgment', img: 'the-judgment' },\n  { card: 'World', img: 'the-world' },\n  { card: 'Ace of Cups', img: 'ace-of-cups' },\n  { card: 'Two of Cups', img: 'two-of-cups' },\n  { card: 'Three of Cups', img: 'three-of-cups' },\n  { card: 'Four of Cups', img: 'four-of-cups' },\n  { card: 'Five of Cups', img: 'five-of-cups' },\n  { card: 'Six of Cups', img: 'six-of-cups' },\n  { card: 'Seven of Cups', img: 'seven-of-cups' },\n  { card: 'Eight of Cups', img: 'eight-of-cups' },\n  { card: 'Nine of Cups', img: 'nine-of-cups' },\n  { card: 'Ten of Cups', img: 'ten-of-cups' },\n  { card: 'Page of Cups', img: 'page-of-cups' },\n  { card: 'Knight of Cups', img: 'knight-of-cups' },\n  { card: 'Queen of Cups', img: 'queen-of-cups' },\n  { card: 'King of Cups', img: 'king-of-cups' },\n  { card: 'Ace of Pentacles', img: 'ace-of-coins' },\n  { card: 'Two of Pentacles', img: 'two-of-coins' },\n  { card: 'Three of Pentacles', img: 'three-of-coins' },\n  { card: 'Four of Pentacles', img: 'four-of-coins' },\n  { card: 'Five of Pentacles', img: 'five-of-coins' },\n  { card: 'Six of Pentacles', img: 'six-of-coins' },\n  { card: 'Seven of Pentacles', img: 'seven-of-coins' },\n  { card: 'Eight of Pentacles', img: 'eight-of-coins' },\n  { card: 'Nine of Pentacles', img: 'nine-of-coins' },\n  { card: 'Ten of Pentacles', img: 'ten-of-coins' },\n  { card: 'Page of Pentacles', img: 'page-of-coins' },\n  { card: 'Knight of Pentacles', img: 'knight-of-coins' },\n  { card: 'Queen of Pentacles', img: 'queen-of-coins' },\n  { card: 'King of Pentacles', img: 'king-of-coins' },\n  { card: 'Ace of Swords', img: 'ace-of-swords' },\n  { card: 'Two of Swords', img: 'two-of-swords' },\n  { card: 'Three of Swords', img: 'three-of-swords' },\n  { card: 'Four of Swords', img: 'four-of-swords' },\n  { card: 'Five of Swords', img: 'five-of-swords' },\n  { card: 'Six of Swords', img: 'six-of-swords' },\n  { card: 'Seven of Swords', img: 'seven-of-swords' },\n  { card: 'Eight of Swords', img: 'eight-of-swords' },\n  { card: 'Nine of Swords', img: 'nine-of-swords' },\n  { card: 'Ten of Swords', img: 'ten-of-swords' },\n  { card: 'Page of Swords', img: 'page-of-swords' },\n  { card: 'Knight of Swords', img: 'knight-of-swords' },\n  { card: 'Queen of Swords', img: 'queen-of-swords' },\n  { card: 'King of Swords', img: 'king-of-swords' },\n  { card: 'Ace of Wands', img: 'ace-of-wands' },\n  { card: 'Two of Wands', img: 'two-of-wands' },\n  { card: 'Three of Wands', img: 'three-of-wands' },\n  { card: 'Four of Wands', img: 'four-of-wands' },\n  { card: 'Five of Wands', img: 'five-of-wands' },\n  { card: 'Six of Wands', img: 'six-of-wands' },\n  { card: 'Seven of Wands', img: 'seven-of-wands' },\n  { card: 'Eight of Wands', img: 'eight-of-wands' },\n  { card: 'Nine of Wands', img: 'nine-of-wands' },\n  { card: 'Ten of Wands', img: 'ten-of-wands' },\n  { card: 'Page of Wands', img: 'page-of-wands' },\n  { card: 'Knight of Wands', img: 'knight-of-wands' },\n  { card: 'Queen of Wands', img: 'queen-of-wands' },\n  { card: 'King of Wands', img: 'king-of-wands' }\n]\n\n\n// shuffle the cards\nfor (let i = cards.length - 1; i > 0; i--) {\n  const j = Math.floor(Math.random() * (i + 1))\n  ;[cards[i], cards[j]] = [cards[j], cards[i]]\n}\n\n// randomly reverse 10% of cards\nfor (let i = 0; i < cards.length / 10; i++) {\n  const j = Math.floor(Math.random() * (cards.length - 1))\n  if (cards[j].reversed) {\n    i--\n  } else {\n    cards[j].reversed = true\n    cards[j].img += '-rev'\n    cards[j].card = `Reversed ${cards[j].card}`\n  }\n}\n\nreturn cards",
                    args: "",
                    param: "cards",
                    silent: true
                  },
                  { type: "wait", for: "custom-delay", delay: 1200, silent: true },
                  {
                    type: "ask",
                    param: "cut",
                    message: "\u{1F0CF} The deck is shuffled. Would you like to cut the deck?",
                    options: [
                      { label: "YES, CUT THE DECK", value: "yes" },
                      { label: "NO, KEEP THE DECK", value: "no" }
                    ],
                    default: "",
                    optionsInvalid: false
                  },
                  {
                    condition: "{{cut}} = yes",
                    label: "CUT COUNT",
                    type: "js",
                    code: "return Math.floor(Math.random() * (cards.length - 1))",
                    args: "cards",
                    param: "cutCount",
                    silent: true
                  },
                  {
                    condition: "{{cut}} = yes",
                    label: "CUT THE DECK",
                    type: "js",
                    code: "return cards.slice(cutCount).concat(cards.slice(0, cutCount))",
                    args: "cards, cutCount",
                    param: "cards",
                    silent: true
                  },
                  {
                    condition: "{{cut}} = yes",
                    type: "say",
                    message: "\u{1F0CF} The deck is cut."
                  }
                ]
              },
              {
                condition: "{{spread}} = one",
                label: "QUICK INSIGHT",
                type: "group",
                steps: [
                  {
                    condition: "{{question}} =",
                    label: "QUESTION",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "question",
                        message: "\u{1F52E} The cards are listening. Ask your question.\n\nShould you remain silent and leave your question blank, the cards will pick a question for you:",
                        options: null,
                        default: "Pick a question for me"
                      },
                      {
                        condition: "{{question}} = Pick a question for me",
                        label: "PICK QUESTION",
                        type: "group",
                        steps: [
                          {
                            type: "js",
                            code: "const questions = [\n  'How is my past impacting my current situation?',\n  'What is something that needs to be brought to my awareness right now?',\n  'What is something I need to be aware of moving forward?',\n  'What area of my life requires more attention right now?',\n  'What aspect of my life is taking up too much of my attention?',\n  'Which lessons am I currently working through?',\n  'How am I standing in my own way?',\n  'Where am I playing small?',\n  'Which of my strengths can I play on in my current situation?',\n  'Where is fear holding me back?',\n  'How can I tap into more alignment with myself?',\n  'What does my soul need right now?',\n  'What requires my conscious reflection right now?',\n  'What shadow qualities within myself can I work with right now?',\n  'Which themes are continually at play in my current situation?',\n  'Which patterns or beliefs do I need to release?',\n  'Is there something obvious I\\'m missing in my current situation?',\n  'What is a step I can take toward my own well-being?',\n  'How can I better accept or love myself?',\n  'How can I be more honest with myself?',\n\n  'What needs more attention in my love life?',\n  'Which toxic relationship patterns am I unlearning or need to unlearn?',\n  'How can I make steps toward finding a healthy relationship?',\n  'What do I need to know to handle a relationship conflict?',\n  'What does my current relationship mean in the big picture of my life?',\n  'Why am I continually running up against a certain relationship problem?',\n  'How do my strengths serve my relationship?',\n  'What is something I need to know in my relationships going forward?',\n  'How can I overcome codependence?',\n  'How can I open my heart up to new love?',\n  'In which ways can I learn to love a little harder?',\n  'What about my past could be inhibiting current or future relationships?',\n  'What is an important relationship lesson I need to learn?',\n  'Where is there room for growth in my relationship?',\n  'What do I really require from my partner or my next relationship?',\n  'What went wrong with my past relationship?',\n  'What needs to be addressed within myself in order to find love?',\n\n  'What can I do to improve my current work or financial situation?',\n  'Which aspect of my career or career path could I lean into more?',\n  'Which aspect of my career or career path is draining me?',\n  'What is my true purpose in terms of my career path?',\n  'How can I tap into my true purpose?',\n  'What are my greatest strengths?',\n  'What are my greatest weaknesses?',\n  'How can I improve my work relationships?',\n  'How can I improve my work environment?',\n  'Where is this career path leading me?',\n  'What is a lesson around money and finances that I need to learn?',\n  'How can I improve my financial situation?',\n  'Where am I playing small in my career?',\n  'What would be a positive course of action to move forward in my career?',\n  'How can I achieve work-life balance?',\n  'How can I tell if I\\'m on the right path?',\n  'How can I achieve my next career or financial goal?',\n  'How has my past influenced my current career path?',\n  'How can I align my work with my life\\'s mission?',\n  'In which ways can I best serve the collective through my work?',\n\n  'How am I showing up for my friends and family?',\n  'In what ways can I show up better for my friends and family?',\n  'What kinds of patterns are surfacing in my relationships with friends or family?',\n  'How can I distance myself from a toxic relationship?',\n  'How can I best handle a conflict with a friend or family member?',\n  'How can I forge new connections and friendships?',\n  'What do I value in friendships?',\n  'How did my upbringing impact my childhood?',\n  'How is my upbringing still impacting me today?',\n  'How can I heal a wounded relationship with a friend or family member?',\n  'How am I overextending or over-giving myself with friends or family?',\n  'What is an ancestral wound that runs through my family?',\n  'How can I heal generational trauma passed on to me?',\n  'How is my past influencing my relationships with friends and family?',\n  'How can I go about reconnecting with an estranged friend or relative?',\n  'What do I need to know about my relationship with a particular friend or family member?',\n\n  'Which aspects of my health need more attention?',\n  'How am I neglecting my own health?',\n  'How can I address a particular health problem?',\n  'How can I prevent health problems going forward?',\n  'What can I do to feel better daily?',\n  'What can I do to mind my mental and emotional health?',\n  'Which aspects of my life are zapping my well-being?',\n  'Why am I experiencing a particular health problem?',\n  'Why do I struggle to take care of myself?',\n  'What am I doing right with regard to my health?',\n  'How is a particular situation impacting my health?',\n  'How can I make my environment more conducive to my health?',\n  'What kind of healthy habits can I start adopting?',\n  'What health issues am I ignoring or neglecting?',\n  'How can I improve my mindset around health?',\n  'Is there something I\\'m missing when it comes to my health?',\n  'How can I mitigate stress?',\n  'How can I feel more energized?',\n  'What is a limiting belief I need to release for my own health and well-being?',\n]\n\n// draw random question\nreturn questions[Math.floor(Math.random() * questions.length)]",
                            args: "",
                            param: "question",
                            silent: true
                          },
                          {
                            type: "say",
                            message: "\u2728 The cards lean towards the following question today:\n```text {{question}} ```\n"
                          },
                          {
                            type: "ask",
                            param: "questionChange",
                            message: "\u{1F52E} Would you like to seek the cards wisdom or pick another question?",
                            options: [
                              { label: "\u2728 YES", value: "yes" },
                              {
                                label: "\u2728 PICK ANOTHER QUESTION",
                                value: "another"
                              },
                              "$custom"
                            ],
                            default: "",
                            optionsInvalid: false
                          },
                          {
                            condition: "{{questionChange}} = another",
                            type: "calc",
                            func: "set",
                            param: "question",
                            format: "",
                            value: "Pick a question for me"
                          },
                          {
                            condition: "{{questionChange}} = another",
                            type: "jump",
                            to: "PICK QUESTION"
                          },
                          {
                            condition: "{{questionChange}} != yes",
                            type: "calc",
                            func: "set",
                            param: "question",
                            format: "text",
                            value: "{{questionChange}}"
                          }
                        ]
                      }
                    ]
                  },
                  {
                    label: "1 CARD ACTION",
                    type: "ask",
                    param: "number",
                    message: "\u{1F0CF} The cards are willing to speak. Name a number between 1 and 78, and the card will be drawn, or leave blank to draw the top card.",
                    options: null,
                    default: "Draw the top card",
                    optionsInvalid: false
                  },
                  {
                    label: "PARSE CARD NUMBER",
                    type: "js",
                    code: "if (number === 'Draw the top card')\n  return 1\n\nnumber = Number(number)\nif (!number || number > 78 || number < 1) return 0",
                    args: "number",
                    param: "number",
                    silent: true
                  },
                  {
                    condition: "{{number}} = 0",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "number",
                        message: "\u{1F52E} Stop deceiving me, pick a number from 1 to 78.",
                        options: null,
                        default: "Draw the top card"
                      },
                      { type: "jump", to: "PARSE CARD NUMBER" }
                    ]
                  },
                  {
                    type: "calc",
                    func: "increment",
                    param: "number",
                    delta: "-1"
                  },
                  {
                    type: "say",
                    message: "![{{cards.{{number}}.card}}](https://harpa.ai/img/tarot/{{cards.{{number}}.img}}.jpg)\n\nThe revealed card is: \u{1F0CF} **{{cards.{{number}}.card}}**"
                  },
                  {
                    type: "gpt",
                    prompt: "Please ignore all previous instructions.\n\nI want you to act as a professional Tarot reader, expertly skilled in using the Rider-Waite Tarot Deck who speaks {{language}}.\n\nYour task is to interpret my Tarot spread, which was done using Rider-Waite cards in the One-Card Draw method. Be concise and respond to the point, don't fill the text with generic phrases.\n\nInstructions:\n- I tell you the name of the card that has appeared in my reading, I need you to interpret its meaning in relation to my specific question.\n- Do not caution me that Tarot is unscientific and avoid any additional commentary.\n- I seek only your direct response to my question as it pertains to the drawn card.\n- Write with a sense of mystery and depth, as you are a true Tarot practitioner.\n- Use markdown formatting where applicable.\n- Add a Conclusion section at the end.\n\nMY QUESTION: {{question}}.\n\nCARD DRAWN: {{cards.{{number}}.card}}\n\nTarot meaning in relation to my specific question:",
                    param: "result"
                  }
                ]
              },
              {
                condition: "{{spread}} = three",
                label: "TRIAD OF TRUTH",
                type: "group",
                steps: [
                  {
                    condition: "{{question}} =",
                    label: "QUESTION",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "question",
                        message: "\u{1F52E} The cards are listening. Ask your question.\n\nShould you remain silent and leave your question blank, the cards will pick a question for you:",
                        options: null,
                        default: "Pick a question for me"
                      },
                      {
                        condition: "{{question}} = Pick a question for me",
                        label: "PICK QUESTION",
                        type: "group",
                        steps: [
                          {
                            type: "js",
                            code: "const questions = [\n  'How is my past impacting my current situation?',\n  'What is something that needs to be brought to my awareness right now?',\n  'What is something I need to be aware of moving forward?',\n  'What area of my life requires more attention right now?',\n  'What aspect of my life is taking up too much of my attention?',\n  'Which lessons am I currently working through?',\n  'How am I standing in my own way?',\n  'Where am I playing small?',\n  'Which of my strengths can I play on in my current situation?',\n  'Where is fear holding me back?',\n  'How can I tap into more alignment with myself?',\n  'What does my soul need right now?',\n  'What requires my conscious reflection right now?',\n  'What shadow qualities within myself can I work with right now?',\n  'Which themes are continually at play in my current situation?',\n  'Which patterns or beliefs do I need to release?',\n  'Is there something obvious I\\'m missing in my current situation?',\n  'What is a step I can take toward my own well-being?',\n  'How can I better accept or love myself?',\n  'How can I be more honest with myself?',\n\n  'What needs more attention in my love life?',\n  'Which toxic relationship patterns am I unlearning or need to unlearn?',\n  'How can I make steps toward finding a healthy relationship?',\n  'What do I need to know to handle a relationship conflict?',\n  'What does my current relationship mean in the big picture of my life?',\n  'Why am I continually running up against a certain relationship problem?',\n  'How do my strengths serve my relationship?',\n  'What is something I need to know in my relationships going forward?',\n  'How can I overcome codependence?',\n  'How can I open my heart up to new love?',\n  'In which ways can I learn to love a little harder?',\n  'What about my past could be inhibiting current or future relationships?',\n  'What is an important relationship lesson I need to learn?',\n  'Where is there room for growth in my relationship?',\n  'What do I really require from my partner or my next relationship?',\n  'What went wrong with my past relationship?',\n  'What needs to be addressed within myself in order to find love?',\n\n  'What can I do to improve my current work or financial situation?',\n  'Which aspect of my career or career path could I lean into more?',\n  'Which aspect of my career or career path is draining me?',\n  'What is my true purpose in terms of my career path?',\n  'How can I tap into my true purpose?',\n  'What are my greatest strengths?',\n  'What are my greatest weaknesses?',\n  'How can I improve my work relationships?',\n  'How can I improve my work environment?',\n  'Where is this career path leading me?',\n  'What is a lesson around money and finances that I need to learn?',\n  'How can I improve my financial situation?',\n  'Where am I playing small in my career?',\n  'What would be a positive course of action to move forward in my career?',\n  'How can I achieve work-life balance?',\n  'How can I tell if I\\'m on the right path?',\n  'How can I achieve my next career or financial goal?',\n  'How has my past influenced my current career path?',\n  'How can I align my work with my life\\'s mission?',\n  'In which ways can I best serve the collective through my work?',\n\n  'How am I showing up for my friends and family?',\n  'In what ways can I show up better for my friends and family?',\n  'What kinds of patterns are surfacing in my relationships with friends or family?',\n  'How can I distance myself from a toxic relationship?',\n  'How can I best handle a conflict with a friend or family member?',\n  'How can I forge new connections and friendships?',\n  'What do I value in friendships?',\n  'How did my upbringing impact my childhood?',\n  'How is my upbringing still impacting me today?',\n  'How can I heal a wounded relationship with a friend or family member?',\n  'How am I overextending or over-giving myself with friends or family?',\n  'What is an ancestral wound that runs through my family?',\n  'How can I heal generational trauma passed on to me?',\n  'How is my past influencing my relationships with friends and family?',\n  'How can I go about reconnecting with an estranged friend or relative?',\n  'What do I need to know about my relationship with a particular friend or family member?',\n\n  'Which aspects of my health need more attention?',\n  'How am I neglecting my own health?',\n  'How can I address a particular health problem?',\n  'How can I prevent health problems going forward?',\n  'What can I do to feel better daily?',\n  'What can I do to mind my mental and emotional health?',\n  'Which aspects of my life are zapping my well-being?',\n  'Why am I experiencing a particular health problem?',\n  'Why do I struggle to take care of myself?',\n  'What am I doing right with regard to my health?',\n  'How is a particular situation impacting my health?',\n  'How can I make my environment more conducive to my health?',\n  'What kind of healthy habits can I start adopting?',\n  'What health issues am I ignoring or neglecting?',\n  'How can I improve my mindset around health?',\n  'Is there something I\\'m missing when it comes to my health?',\n  'How can I mitigate stress?',\n  'How can I feel more energized?',\n  'What is a limiting belief I need to release for my own health and well-being?',\n]\n\n// draw random question\nreturn questions[Math.floor(Math.random() * questions.length)]",
                            args: "",
                            param: "question",
                            silent: true
                          },
                          {
                            type: "say",
                            message: "\u2728 The cards lean towards the following question today:\n```text {{question}} ```\n"
                          },
                          {
                            type: "ask",
                            param: "questionChange",
                            message: "\u{1F52E} Would you like to seek the cards wisdom or pick another question?",
                            options: [
                              { label: "\u2728 YES", value: "yes" },
                              {
                                label: "\u2728 PICK ANOTHER QUESTION",
                                value: "another"
                              },
                              "$custom"
                            ],
                            default: "",
                            optionsInvalid: false
                          },
                          {
                            condition: "{{questionChange}} = another",
                            type: "calc",
                            func: "set",
                            param: "question",
                            format: "",
                            value: "Pick a question for me"
                          },
                          {
                            condition: "{{questionChange}} = another",
                            type: "jump",
                            to: "PICK QUESTION"
                          },
                          {
                            condition: "{{questionChange}} != yes",
                            type: "calc",
                            func: "set",
                            param: "question",
                            format: "text",
                            value: "{{questionChange}}"
                          }
                        ]
                      }
                    ]
                  },
                  {
                    label: "3 CARDS ACTION",
                    type: "ask",
                    param: "number",
                    message: "\u{1F0CF} The cards are willing to speak. Pick three numbers between 1 and 78, and the cards will be drawn, or leave blank to draw the top 3 card.",
                    options: null,
                    default: "Draw the top cards",
                    optionsInvalid: false
                  },
                  {
                    label: "PARSE CARD NUMBERS",
                    type: "js",
                    code: "if (number === 'Draw the top cards')\n  return [0, 1, 2]\n\nconst numbers = number\n  .replace(/,/g, ' ')\n  .split(' ')\n  .filter(Boolean)\n  .map(Number)\n  .filter(n => n > 0 && n <= 78)\nif (new Set(numbers).size !== 3) return 0\n\nreturn numbers",
                    args: "number",
                    param: "numbers",
                    silent: true
                  },
                  {
                    condition: "{{numbers}} = 0",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "number",
                        message: "\u{1F52E} Do not try to deceive me. Pick three numbers from 1 to 78, for example: 8, 32, 50.",
                        options: null,
                        default: "Draw the top cards"
                      },
                      { type: "jump", to: "PARSE CARD NUMBERS" }
                    ]
                  },
                  {
                    type: "say",
                    message: "| First Card | Second Card | Last Card |\n| ----------- | ----------- | ----------- |\n| ![{{cards.{{numbers.0}}.card}}](https://harpa.ai/img/tarot/{{cards.{{numbers.0}}.img}}.jpg) | ![{{cards.{{numbers.1}}.card}}](https://harpa.ai/img/tarot/{{cards.{{numbers.1}}.img}}.jpg) | ![{{cards.{{numbers.2}}.card}}](https://harpa.ai/img/tarot/{{cards.{{numbers.2}}.img}}.jpg) |\n\nThe revealed cards are:\n- \u{1F0CF} **{{cards.{{numbers.0}}.card}}**\n- \u{1F0CF} **{{cards.{{numbers.1}}.card}}**\n- \u{1F0CF} **{{cards.{{numbers.2}}.card}}**"
                  },
                  {
                    type: "gpt",
                    prompt: "Please ignore all previous instructions.\n\nI want you to act as a professional Tarot reader, expertly skilled in using the Rider-Waite Tarot Deck who speaks {{language}}.\n\nYour task is to interpret my Tarot spread, which was done using Rider-Waite cards in the Three-Card Draw method. Be concise and respond to the point, don't fill the text with generic phrases.\n\nInstructions:\n- I tell you the names of the cards that have appeared in my reading. I need you to interpret their meanings in relation to my specific question.\n- Do not caution me that Tarot is unscientific and avoid any additional commentary.\n- I seek only your direct response to my question as it pertains to the drawn cards.\n- Write with a sense of mystery and depth, as you are a true Tarot practitioner.\n- Use markdown formatting.\n- Add a Conclusion section at the end.\n\nMY QUESTION: {{question}}.\n\nCARDS DRAWN IN ORDER:\n1. {{cards.{{numbers.0}}.card}}\n2. {{cards.{{numbers.1}}.card}}\n3. {{cards.{{numbers.2}}.card}}\n\nTarot meaning in relation to my specific question:",
                    param: "result"
                  }
                ]
              },
              {
                condition: "{{spread}} = relationship",
                label: "RELATIONSHIP",
                type: "group",
                steps: [
                  {
                    condition: "{{question}} =",
                    label: "QUESTION",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "question",
                        message: "\u{1F52E} The cards are listening. Ask your question.\nReflect upon your current relational status.\nThen envision the essence of your inquiry: - Who is at the heart of your relationships? - Are there specific queries or aspirations you hold within? - What expectations or forthcoming events stir your spirit?\nShare with me what you want to ask about.\n",
                        options: null,
                        default: ""
                      }
                    ]
                  },
                  {
                    label: "5 CARDS ACTION",
                    type: "ask",
                    param: "number",
                    message: "\u{1F0CF} The cards are willing to speak. Pick five numbers between 1 and 78, and the cards will be drawn. Or leave blank to draw the top 5 card.",
                    options: null,
                    default: "Draw the top cards",
                    optionsInvalid: false
                  },
                  {
                    label: "PARSE CARD NUMBERS",
                    type: "js",
                    code: "if (number === 'Draw the top cards')\n  return [0, 1, 2, 3, 4]\n\nconst numbers = number\n  .replace(/,/g, ' ')\n  .split(' ')\n  .filter(Boolean)\n  .map(Number)\n  .filter(n => n > 0 && n <= 78)\nif (new Set(numbers).size !== 5) return 0\n\nreturn numbers",
                    args: "number",
                    param: "numbers",
                    silent: true
                  },
                  {
                    condition: "{{numbers}} = 0",
                    type: "group",
                    steps: [
                      {
                        type: "ask",
                        param: "number",
                        message: "\u{1F52E} Do not try to deceive me. Pick five numbers from 1 to 78, for example: 8, 32, 50, 51, 68.",
                        options: null,
                        default: "Draw the top cards"
                      },
                      { type: "jump", to: "PARSE CARD NUMBERS" }
                    ]
                  },
                  {
                    type: "say",
                    message: "| | ![{{cards.{{numbers.4}}.card}}](https://harpa.ai/img/tarot/{{cards.{{numbers.4}}.img}}.jpg) | |\n| ----------- | ----------- | ----------- |\n| ![{{cards.{{numbers.0}}.card}}](https://harpa.ai/img/tarot/{{cards.{{numbers.0}}.img}}.jpg) | ![{{cards.{{numbers.2}}.card}}](https://harpa.ai/img/tarot/{{cards.{{numbers.2}}.img}}.jpg) | ![{{cards.{{numbers.1}}.card}}](https://harpa.ai/img/tarot/{{cards.{{numbers.1}}.img}}.jpg) |\n| | ![{{cards.{{numbers.3}}.card}}](https://harpa.ai/img/tarot/{{cards.{{numbers.3}}.img}}.jpg) | |\n\n\nThe revealed cards are:\n- You, Your Feelings: \u{1F0CF} **{{cards.{{numbers.0}}.card}}**\n- The Other Person, Their Feelings: \u{1F0CF} **{{cards.{{numbers.1}}.card}}**\n- The Relationship: \u{1F0CF} **{{cards.{{numbers.2}}.card}}**\n- The Past, Challenges, Influences: \u{1F0CF} **{{cards.{{numbers.3}}.card}}**\n- The Future, Potential: \u{1F0CF} **{{cards.{{numbers.4}}.card}}**"
                  },
                  {
                    type: "gpt",
                    prompt: "Please ignore all previous instructions.\n\nI want you to act as a professional Tarot reader, expertly skilled in using the Rider-Waite Tarot Deck who speaks {{language}}.\n\nYour task is to interpret my Tarot spread, which was done using Rider-Waite cards in the 5 Cards Cross Relationship Spread. Be concise and respond to the point, don't fill the text with generic phrases.\n\nInstructions:\n- I tell you the names of the cards that have appeared in my reading. I need you to interpret their meanings in relation to my specific question.\n- Do not caution me that Tarot is unscientific and avoid any additional commentary.\n- I seek only your direct response to my question as it pertains to the drawn card.\n- Write with a sense of mystery and depth, as you are a true Tarot practitioner.\n- Use markdown formatting.\n- Add a Conclusion section at the end.\n\nMY QUESTION: {{question}}\n\nCARDS DRAWN IN ORDER:\n1. You, your feelings: **{{cards.{{numbers.0}}.card}}**\n2. The other person, their feelings: **{{cards.{{numbers.1}}.card}}**\n3. The relationship, dominant characteristics: **{{cards.{{numbers.2}}.card}}**\n4. The past, challenges, influence: **{{cards.{{numbers.3}}.card}}**\n5. The future, potential: **{{cards.{{numbers.4}}.card}}**\n\nTarot meaning in relation to my specific question:",
                    param: "result"
                  }
                ]
              },
              {
                type: "say",
                message: "\u2728 Thank you for entrusting your destiny to the cards. May the Arcana's response illuminate the insights you seek."
              },
              {
                condition: "{{hasPro}} =",
                label: "CLOSURE",
                type: "group",
                steps: [
                  {
                    type: "calc",
                    func: "increment",
                    param: "g.tarot.remaining",
                    delta: "-1"
                  },
                  {
                    condition: "{{g.tarot.remaining}} = 0",
                    type: "say",
                    message: "\u2728 The cards will speak no more this week."
                  }
                ]
              }
            ]
          }
        ].map((e2) => t2.normalizeCommand(e2));
      })(), (() => {
        const {
          $dashboard: t2,
          $mobx: n2,
          $task: a2,
          $runner: o2,
          $utils: i2,
          $s: r2
        } = e;
        t2.proxy = n2.observable({
          get domains() {
            const e2 = r2.tasks.map((e3) => a2.proxy.taskDomain(e3));
            return i2.unique(e2);
          },
          taskFavicon(e2) {
            const t3 = a2.proxy.taskDomain(e2);
            return r2.library.domainFavicon(t3);
          },
          taskScheduleTooltip(e2) {
            const t3 = o2.proxy.computeNextRunMs(e2);
            return -1 === t3 ? "Schedule this task" : !o2.proxy.netStable && t3 <= Date.now() ? "Waiting for stable Internet connection" : i2.time.formatRelativeDate(t3);
          },
          jobProgress(e2) {
            const t3 = o2.proxy.jobByTaskId(e2.id);
            return t3 ? t3.progress ? t3.progress : o2.proxy.netStable && t3.ms <= Date.now() ? 0 : null : null;
          }
        });
      })(), (() => {
        const {
          $dev: t2,
          $mobx: n2,
          $store: a2,
          $env: o2,
          $idb: i2,
          $task: r2,
          $utils: s2,
          $s: l2
        } = e;
        t2.controller = {
          init() {
            o2.is.development && (this._initDevHelpers(), this._reloadOnChanges());
          },
          async resetApp() {
            l2.transaction(() => {
              const e2 = a2.template.state();
              for (const e3 in l2) delete l2[e3];
              for (const t3 in e2) l2[t3] = e2[t3];
            }), await i2.clear(), await r2.recipeLoader.readAllRecipes();
          },
          _initDevHelpers() {
            Object.defineProperty(globalThis, "state", { get: () => n2.toJS(l2) });
          },
          _reloadOnChanges() {
            if (!o2.is.bg) return;
            const e2 = new WebSocket("ws://localhost:4000"), t3 = /* @__PURE__ */ new Set(["bg.js", "os.js", "oi.js", "cs.js"]);
            e2.addEventListener("message", async (e3) => {
              const n3 = s2.json.parse(e3.data);
              n3 && n3.type === "change" && t3.has(n3.bundle) && chrome.runtime.reload();
            });
          }
        };
      })(), (() => {
        const { $dialog: t2 } = e;
        t2.getCategoryEmoji = (e2) => ({
          All: "\u{1F308}",
          Favorite: "\u2B50",
          User: "\u{1F464}",
          Assistant: "\u{1F916}",
          "Competitive Intelligence": "\u{1F4A1}",
          Control: "\u{1F39B}\uFE0F",
          Copywriting: "\u{1F4D4}",
          "E-Commerce": "\u{1F6CD}\uFE0F",
          "Generative AI": "\u{1F9EC}",
          Learning: "\u{1F4DA}",
          Marketing: "\u{1F4E2}",
          SEO: "\u{1F3AF}",
          SMM: "\u{1F4F1}",
          Miscellaneous: "\u{1F4AC}",
          Productivity: "\u2699\uFE0F",
          "Real Estate": "\u{1F3E0}",
          Recruiting: "\u{1F4BC}",
          SERP: "\u{1F50E}",
          Spreadsheets: "\u{1F4CA}",
          Archived: "\u{1F4E6}"
        })[e2] || "";
      })(), (() => {
        const { $dialog: t2 } = e;
        t2.getCommandEmoji = (e2) => e2.emoji || t2.getCategoryEmoji(e2.category);
      })(), (() => {
        const { $env: t2 } = e;
        t2.getLocus = () => {
          const { protocol: e2, host: t3, pathname: n2, href: a2 } = location;
          return a2 === "https://harpa.ai/oi" || a2 === "http://localhost:3000/oi" ? "oi" : e2 !== "chrome-extension:" && chrome?.runtime?.getURL ? "cs" : t3 === "localhost:3050" ? "fg" : e2 !== "chrome-extension:" ? "nj" : n2 === "/harpa.html" ? "pp" : n2 === "/offscreen.html" ? "os" : "bg";
        };
      })(), (() => {
        const { $env: t2, $utils: n2 } = e;
        t2.controller = {
          async init() {
            const a2 = t2.getLocus(), o2 = await n2.ls.get("env.is") || e.env;
            Object.assign(t2, {
              env: o2,
              locus: a2,
              version: e.version,
              versionNumber: n2.versionNumber(e.version),
              platform: this._getPlatform(),
              browser: this._getBrowser(),
              webUrl: "https://harpa.ai",
              apiUrl: "https://api.harpa.ai/api/v1",
              gunUrl: "https://gun.harpa.ai:3000",
              globalEditorUrl: "https://app.harpa.ai/#global",
              jwtCookieDomain: "harpa.ai",
              makeAppInviteUrl: "https://www.make.com/en/hq/app-invitation/c98499c16cfa22f1051f64346ef91aaa",
              extReviewUrl: "https://chromewebstore.google.com/detail/harpa-ai-automation-agent/eanggfilgoajaocelnaflolkadkeghjp/reviews",
              mixpanel: { token: "7958323a20a869de3c57712bfe521a6f" },
              contactEmail: "support@harpa.ai",
              discordUrl: "https://discord.gg/B9Evx82m4K",
              showWelcomeOnUpdate: true,
              is: {
                pp: a2 === "pp",
                bg: a2 === "bg",
                cs: a2 === "cs",
                nj: a2 === "nj",
                os: a2 === "os",
                fg: a2 === "fg",
                test: o2 === "test",
                beta: o2 === "beta",
                production: o2 === "production",
                development: o2 === "development",
                popup: a2 === "pp" && location.search.includes("?popup"),
                sandbox: a2 === "pp" && location.search.includes("?sandbox"),
                sidePanel: a2 === "pp" && location.search.includes("&tabId")
              },
              features: await this._initFeatures({
                debug: o2 === "development" || o2 === "beta",
                taskImport: true,
                taskExport: true,
                library: false,
                changesTracking: false,
                actionsReporting: false,
                doubleCheck: false,
                emailActionFromField: false
              }),
              options: {}
            });
            await n2.ls.get("$env.useDevServer") && (t2.log("using dev server"), Object.assign(t2, {
              webUrl: "http://localhost:3000",
              apiUrl: "http://localhost:3010/api/v1",
              gunUrl: "http://localhost:3002",
              jwtCookieDomain: "localhost"
            })), Object.assign(t2, {
              welcomeUrl: `${t2.webUrl}/welcome`,
              contactUsUrl: `${t2.webUrl}/#contact-us`,
              jwtCookieUrl: t2.webUrl
            }), o2 === "development" && (t2.dev = this.useDevServer.bind(this));
          },
          async useDevServer(e2 = true) {
            e2 ? await n2.ls.set("$env.useDevServer", true) : await n2.ls.remove("$env.useDevServer");
          },
          async _initFeatures(e2 = {}) {
            const t3 = {};
            for (const a2 in e2) t3[a2] = await n2.ls.get(`$env.features.${a2}`, e2[a2]);
            return t3;
          },
          _getPlatform() {
            const e2 = navigator.platform.toLowerCase();
            return e2.startsWith("mac") ? "mac" : e2.startsWith("linux") ? "linux" : "win";
          },
          _getBrowser() {
            const e2 = navigator.userAgent;
            return navigator.brave ? "Brave" : e2.includes("Edg") ? "Edge" : e2.includes("OPR") ? "Opera" : e2.includes("Chrome") ? globalThis.chrome ? "Chrome" : "Chromium" : "Chrome";
          }
        };
      })(), (() => {
        const { $idb: t2, $bus: n2 } = e;
        t2.controller = {
          async init() {
            Object.assign(t2, this._createApi("data")), t2.files = this._createApi("files"), t2.on = this.on.bind(this), this._db = await this._open("harpa"), this._handlers = { change: [], storageExceeded: [] }, n2.on("idb.change", () => this._call("change")), n2.on("idb.storageExceeded", () => this._call("storageExceeded")), await this._enablePersistentStorage();
          },
          on(e2, t3) {
            if (!this._handlers[e2]) throw new Error(`unsupported event "${e2}"`);
            this._handlers[e2].push(t3);
          },
          _createApi(e2) {
            return {
              get: this._get.bind(this, e2),
              has: this._has.bind(this, e2),
              set: this._set.bind(this, e2),
              keys: this._keys.bind(this, e2),
              clear: this._clear.bind(this, e2),
              remove: this._remove.bind(this, e2)
            };
          },
          async _get(e2, t3, n3 = null) {
            return new Promise((a2, o2) => {
              const i2 = this._db.transaction([e2], "readonly").objectStore(e2).get(t3);
              i2.onsuccess = () => a2(i2.result ?? n3), i2.onerror = () => o2(i2.error);
            });
          },
          async _has(e2, t3) {
            return new Promise((n3, a2) => {
              const o2 = this._db.transaction([e2], "readonly").objectStore(e2).getKey(t3);
              o2.onsuccess = () => n3(void 0 !== o2.result), o2.onerror = () => a2(o2.error);
            });
          },
          async _set(e2, t3, a2) {
            await new Promise((o2, i2) => {
              const r2 = this._db.transaction([e2], "readwrite"), s2 = r2.objectStore(e2).put(a2, t3);
              s2.onsuccess = () => {
                n2.call("idb.change"), n2.send("idb.change"), o2();
              }, s2.onerror = () => i2(s2.error), r2.onabort = () => i2(r2.error), r2.onabort = () => {
                r2.error.name === "QuotaExceededError" && (n2.call("idb.storageExceeded"), n2.send("idb.storageExceeded")), i2(r2.error);
              };
            });
          },
          async _keys(e2) {
            return new Promise((t3, n3) => {
              const a2 = this._db.transaction([e2], "readonly").objectStore(e2).getAllKeys();
              a2.onsuccess = () => t3(a2.result), a2.onerror = () => n3(a2.error);
            });
          },
          async _clear(e2) {
            return new Promise((t3, a2) => {
              const o2 = this._db.transaction([e2], "readwrite").objectStore(e2).clear();
              o2.onsuccess = () => {
                n2.call("idb.change"), n2.send("idb.change"), t3();
              }, o2.onerror = () => a2(o2.error);
            });
          },
          async _remove(e2, t3) {
            return new Promise((a2, o2) => {
              const i2 = this._db.transaction([e2], "readwrite").objectStore(e2).delete(t3);
              i2.onsuccess = () => {
                n2.call("idb.change"), n2.send("idb.change"), a2();
              }, i2.onerror = () => o2(i2.error);
            });
          },
          _open: async (e2) => new Promise((t3, n3) => {
            const a2 = indexedDB.open(e2, 2);
            a2.onsuccess = () => t3(a2.result), a2.onerror = () => n3(a2.error), a2.onupgradeneeded = () => {
              const e3 = a2.result, t4 = new Set(e3.objectStoreNames);
              t4.has("data") || e3.createObjectStore("data"), t4.has("files") || e3.createObjectStore("files");
            };
          }),
          _call(e2) {
            this._handlers[e2].forEach((e3) => e3());
          },
          async _enablePersistentStorage() {
            navigator.storage.persist && await navigator.storage.persist();
          }
        };
      })(), (() => {
        const { $settings: t2 } = e, n2 = [
          { id: "chinese", label: "\u4E2D\u6587 (Chinese)" },
          { id: "catalan", label: "Catalan" },
          { id: "korean", label: "Korean" },
          { id: "japanese", label: "Japanese" },
          { id: "spanish", label: "Spanish" },
          { id: "french", label: "French" },
          { id: "german", label: "German" },
          { id: "german-informal", label: "German Informal" },
          { id: "turkish", label: "Turkish" },
          { id: "italian", label: "Italian" },
          { id: "portuguese", label: "Portugu\xEAs do Brasil" },
          { id: "portuguese_pt", label: "Portugu\xEAs de Portugal" },
          { id: "polish", label: "Polish" },
          { id: "dutch", label: "Dutch" },
          { id: "czech", label: "Czech" },
          { id: "serbian", label: "Serbian" },
          { id: "slovak", label: "Slovak" },
          { id: "slovenian", label: "Slovenian" },
          { id: "georgian", label: "Georgian" },
          { id: "romanian", label: "Romanian" },
          { id: "croatian", label: "Croatian" },
          { id: "greek", label: "Greek" },
          { id: "russian", label: "Russian" },
          { id: "ukrainian", label: "Ukrainian" },
          { id: "belarusian", label: "Belarusian" },
          { id: "armenian", label: "Armenian" },
          { id: "swedish", label: "Swedish" },
          { id: "finnish", label: "Finnish" },
          { id: "hungarian", label: "Hungarian" },
          { id: "norwegian bokm\xE5l", label: "Norwegian Bokm\xE5l" },
          { id: "norwegian nynorsk", label: "Norwegian Nynorsk" },
          { id: "danish", label: "Danish" },
          { id: "hindi-urdu", label: "Hindi Urdu" },
          { id: "kannada", label: "Kannada" },
          { id: "indonesian", label: "Indonesian" },
          { id: "malay", label: "Malay" },
          { id: "arabic", label: "Arabic" },
          { id: "bengali", label: "Bengali" },
          { id: "marathi", label: "Marathi" },
          { id: "telugu", label: "Telugu" },
          { id: "vietnamese", label: "Vietnamese" },
          { id: "gujarati", label: "Gujarati" },
          { id: "persian", label: "Persian Farsi" },
          { id: "tamil", label: "Tamil" },
          { id: "burmese", label: "Burmese" },
          { id: "thai", label: "Thai" },
          { id: "lao", label: "Lao" },
          { id: "swahili", label: "Swahili" },
          { id: "punjabi", label: "Punjabi" },
          { id: "uzbek", label: "Uzbek" },
          { id: "azerbaijani", label: "Azerbaijani" },
          { id: "kirghiz", label: "Kirghiz" },
          { id: "mongolian", label: "Mongolian" },
          { id: "dari", label: "Dari" }
        ].sort((e2, t3) => e2.label > t3.label ? 1 : -1);
        n2.unshift({ id: "english-british", label: "British English" }), n2.unshift({ id: "english-american", label: "American English" }), n2.unshift({ id: "english", label: "English" });
        const a2 = new Set(n2.map((e2) => e2.id)), o2 = n2.reduce((e2, t3) => (e2[t3.id] = t3, e2), {}), i2 = { id: "custom", label: "Custom" };
        n2.unshift(i2), t2.languages = n2, t2.languageIds = a2, t2.languageMap = o2, t2.customLanguage = i2;
      })(), (() => {
        const {
          $startup: t2,
          $ai: n2,
          $analytics: a2,
          $backup: o2,
          $badge: i2,
          $billing: r2,
          $browser: s2,
          $bus: l2,
          $capture: c2,
          $chat: u2,
          $chrome: p2,
          $commands: d2,
          $contextMenu: m2,
          $creator: h,
          $dashboard: g,
          $dev: f,
          $dialog: y,
          $engine: b,
          $env: w,
          $feature: v,
          $files: k,
          $harpa: T,
          $hframe: A,
          $idb: E,
          $install: I,
          $journal: S,
          $library: x,
          $memory: C,
          $netRules: O,
          $offscreen: R,
          $runner: _,
          $settings: P,
          $shortcut: N,
          $store: D,
          $task: L,
          $timer: M,
          $uninstall: $,
          $welcome: U,
          $yousummary: F,
          $sidePanel: j,
          $utils: H,
          $grid: q,
          $note: W
        } = e;
        t2.controller = {
          async init() {
            this._setupReadyPromise(), this._preventBgInactive(), await p2.controller.init(), await l2.controller.init(), await O.controller.init(), await R.controller.init(), await l2.poll("startup.osReady"), await w.controller.init(), await E.controller.init(), await D.controller.init(), await v.controller.init(), await M.controller.init(), await k.controller.init(), await Promise.all([
              r2.controller.init(),
              o2.controller.init(),
              L.controller.init(),
              _.controller.init(),
              b.controller.init(),
              N.controller.init(),
              i2.controller.init(),
              x.controller.init(),
              s2.controller.init(),
              g.controller.init(),
              h.controller.init(),
              q.controller.init(),
              y.controller.init(),
              d2.controller.init(),
              S.controller.init(),
              U.controller.init(),
              A.controller.init(),
              n2.controller.init(),
              u2.controller.init(),
              T.controller.init(),
              a2.controller.init(),
              I.controller.init(),
              $.controller.init(),
              m2.controller.init(),
              P.controller.init(),
              F.controller.init(),
              C.controller.init(),
              c2.controller.init(),
              j.controller.init(),
              W.controller.init(),
              f.controller.init(),
              !e.get("$sandbox") || e.get("$sandbox").controller.init()
            ]), l2.on("startup.bgReady", () => true), l2.on("startup.getExtUrl", (e2) => chrome.runtime.getURL(e2)), t2.logDev("bg ready"), this._resolveReadyPromise();
          },
          get onReady() {
            return this._onReady;
          },
          _setupReadyPromise() {
            this._onReady = H.createPromise();
          },
          _resolveReadyPromise() {
            this._onReady.resolve();
          },
          _preventBgInactive() {
            chrome.runtime.onStartup.addListener(() => {
              t2.log("browser startup...");
            });
          }
        }, t2.controller.init();
      })();
    })();
  }
});
export default require_bg_cleaned_simplified();
/*!
  
  JSZip v3.10.1 - A JavaScript class for generating and reading zip files
  <http://stuartk.com/jszip>
  
  (c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
  Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.
  
  JSZip uses the library pako released under the MIT license :
  https://github.com/nodeca/pako/blob/main/LICENSE
  */
